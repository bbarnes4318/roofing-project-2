/*! For license information please see main.1c9149c7.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,r)=>{e.exports=r(202)},51:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(526);function s(e,t,r){return(t=(0,n.A)(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}},67:(e,t,r)=>{e.exports=r(612)},122:e=>{e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,s,a;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(s=n;0!==s--;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(a=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(s=n;0!==s--;)if(!Object.prototype.hasOwnProperty.call(r,a[s]))return!1;for(s=n;0!==s--;){var o=a[s];if(!e(t[o],r[o]))return!1}return!0}return t!==t&&r!==r}},153:(e,t,r)=>{var n=r(43),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,d=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:d,props:a,_owner:i.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},202:(e,t)=>{var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,f={};function x(e,t,r){this.props=e,this.context=t,this.refs=f,this.updater=r||p}function v(){}function y(e,t,r){this.props=e,this.context=t,this.refs=f,this.updater=r||p}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=x.prototype;var b=y.prototype=new v;b.constructor=y,g(b,x.prototype),b.isPureReactComponent=!0;var w=Array.isArray,j=Object.prototype.hasOwnProperty,N={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,n){var s,a={},o=null,i=null;if(null!=t)for(s in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(o=""+t.key),t)j.call(t,s)&&!S.hasOwnProperty(s)&&(a[s]=t[s]);var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===a[s]&&(a[s]=l[s]);return{$$typeof:r,type:e,key:o,ref:i,props:a,_owner:N.current}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function P(e,t,s,a,o){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var l=!1;if(null===e)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case r:case n:l=!0}}if(l)return o=o(l=e),e=""===a?"."+E(l,0):a,w(o)?(s="",null!=e&&(s=e.replace(C,"$&/")+"/"),P(o,t,s,"",function(e){return e})):null!=o&&(A(o)&&(o=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,s+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(l=0,a=""===a?".":a+":",w(e))for(var c=0;c<e.length;c++){var d=a+E(i=e[c],c);l+=P(i,t,s,d,o)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=m&&e[m]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(i=e.next()).done;)l+=P(i=i.value,t,s,d=a+E(i,c++),o);else if("object"===i)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,r){if(null==e)return e;var n=[],s=0;return P(e,n,"","",function(e){return t.call(r,e,s++)}),n}function T(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},M={transition:null},_={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:M,ReactCurrentOwner:N};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:I,forEach:function(e,t,r){I(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=x,t.Fragment=s,t.Profiler=o,t.PureComponent=y,t.StrictMode=a,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_,t.act=O,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=g({},e.props),a=e.key,o=e.ref,i=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,i=N.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)j.call(t,c)&&!S.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:r,type:e.type,key:a,ref:o,props:s,_owner:i}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:i,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:T}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,r){return D.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,r){return D.current.useReducer(e,t,r)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return D.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},210:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(829)),a=n(r(736));class o{constructor(e){let{headers:t={},schema:r,fetch:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=n}from(e){const t=new URL("".concat(this.url,"/").concat(e));return new s.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new o(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:r=!1,get:n=!1,count:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var o;let i;const l=new URL("".concat(this.url,"/rpc/").concat(e));let c;r||n?(i=r?"HEAD":"GET",Object.entries(t).filter(e=>{let[t,r]=e;return void 0!==r}).map(e=>{let[t,r]=e;return[t,Array.isArray(r)?"{".concat(r.join(","),"}"):"".concat(r)]}).forEach(e=>{let[t,r]=e;l.searchParams.append(t,r)})):(i="POST",c=t);const d=new Headers(this.headers);return s&&d.set("Prefer","count=".concat(s)),new a.default({method:i,url:l,headers:d,schema:this.schemaName,body:c,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}}t.default=o},286:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(630)),a=n(r(611));t.default=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:"undefined"===typeof fetch?this.fetch=s.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,n,s;let o=null,i=null,l=null,c=e.status,d=e.statusText;if(e.ok){if("HEAD"!==this.method){const r=await e.text();""===r||(i="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}const s=null===(r=this.headers.get("Prefer"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),a=null===(n=e.headers.get("content-range"))||void 0===n?void 0:n.split("/");s&&a&&a.length>1&&(l=parseInt(a[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(o={code:"PGRST116",details:"Results contain ".concat(i.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,l=null,c=406,d="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=await e.text();try{o=JSON.parse(t),Array.isArray(o)&&404===e.status&&(i=[],o=null,c=200,d="OK")}catch(u){404===e.status&&""===t?(c=204,d="No Content"):o={message:t}}if(o&&this.isMaybeSingle&&(null===(s=null===o||void 0===o?void 0:o.details)||void 0===s?void 0:s.includes("0 rows"))&&(o=null,c=200,d="OK"),o&&this.shouldThrowOnError)throw new a.default(o)}return{error:o,data:i,count:l,status:c,statusText:d}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,n;return{error:{message:"".concat(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),details:"".concat(null!==(r=null===e||void 0===e?void 0:e.stack)&&void 0!==r?r:""),hint:"",code:"".concat(null!==(n=null===e||void 0===e?void 0:e.code)&&void 0!==n?n:"")},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}}},298:(e,t,r)=>{r.r(t),r.d(t,{PERMISSIONS:()=>n,ROLE_HIERARCHY:()=>u,ROLE_PERMISSIONS:()=>s,canAccessDataLevel:()=>c,default:()=>g,filterDataByPermissions:()=>d,getRoleColor:()=>p,getRoleDisplayName:()=>m,getRolePermissions:()=>l,hasAllPermissions:()=>i,hasAnyPermission:()=>o,hasPermission:()=>a,isRoleHigher:()=>h});const n={PROJECTS_CREATE:"projects.create",PROJECTS_READ:"projects.read",PROJECTS_UPDATE:"projects.update",PROJECTS_DELETE:"projects.delete",PROJECTS_ASSIGN:"projects.assign",PROJECTS_VIEW_ALL:"projects.view_all",PROJECTS_VIEW_ASSIGNED:"projects.view_assigned",USERS_CREATE:"users.create",USERS_READ:"users.read",USERS_UPDATE:"users.update",USERS_DELETE:"users.delete",USERS_MANAGE_ROLES:"users.manage_roles",USERS_VIEW_ALL:"users.view_all",FINANCES_VIEW:"finances.view",FINANCES_EDIT:"finances.edit",FINANCES_APPROVE:"finances.approve",FINANCES_EXPORT:"finances.export",FINANCES_DELETE:"finances.delete",DOCUMENTS_UPLOAD:"documents.upload",DOCUMENTS_DOWNLOAD:"documents.download",DOCUMENTS_DELETE:"documents.delete",DOCUMENTS_SHARE:"documents.share",DOCUMENTS_VIEW_ALL:"documents.view_all",REPORTS_VIEW:"reports.view",REPORTS_GENERATE:"reports.generate",REPORTS_EXPORT:"reports.export",REPORTS_ADVANCED:"reports.advanced",AI_BUBBLES:"ai.bubbles",AI_ADVANCED:"ai.advanced",AI_MANAGE_SETTINGS:"ai.manage_settings",SETTINGS_VIEW:"settings.view",SETTINGS_EDIT:"settings.edit",SETTINGS_MANAGE_INTEGRATIONS:"settings.manage_integrations",SETTINGS_SYSTEM_CONFIG:"settings.system_config",CALENDAR_VIEW:"calendar.view",CALENDAR_EDIT:"calendar.edit",CALENDAR_MANAGE:"calendar.manage",WORKFLOW_VIEW:"workflow.view",WORKFLOW_EDIT:"workflow.edit",WORKFLOW_MANAGE:"workflow.manage",WORKFLOW_APPROVE:"workflow.approve",COMMUNICATION_SEND:"communication.send",COMMUNICATION_MANAGE:"communication.manage",COMMUNICATION_BULK:"communication.bulk",DATA_PUBLIC:"data.public",DATA_INTERNAL:"data.internal",DATA_CONFIDENTIAL:"data.confidential",DATA_RESTRICTED:"data.restricted"},s={ADMIN:[n.PROJECTS_CREATE,n.PROJECTS_READ,n.PROJECTS_UPDATE,n.PROJECTS_DELETE,n.PROJECTS_ASSIGN,n.PROJECTS_VIEW_ALL,n.USERS_CREATE,n.USERS_READ,n.USERS_UPDATE,n.USERS_DELETE,n.USERS_MANAGE_ROLES,n.USERS_VIEW_ALL,n.FINANCES_VIEW,n.FINANCES_EDIT,n.FINANCES_APPROVE,n.FINANCES_EXPORT,n.FINANCES_DELETE,n.DOCUMENTS_UPLOAD,n.DOCUMENTS_DOWNLOAD,n.DOCUMENTS_DELETE,n.DOCUMENTS_SHARE,n.DOCUMENTS_VIEW_ALL,n.REPORTS_VIEW,n.REPORTS_GENERATE,n.REPORTS_EXPORT,n.REPORTS_ADVANCED,n.AI_BUBBLES,n.AI_ADVANCED,n.AI_MANAGE_SETTINGS,n.SETTINGS_VIEW,n.SETTINGS_EDIT,n.SETTINGS_MANAGE_INTEGRATIONS,n.SETTINGS_SYSTEM_CONFIG,n.CALENDAR_VIEW,n.CALENDAR_EDIT,n.CALENDAR_MANAGE,n.WORKFLOW_VIEW,n.WORKFLOW_EDIT,n.WORKFLOW_MANAGE,n.WORKFLOW_APPROVE,n.COMMUNICATION_SEND,n.COMMUNICATION_MANAGE,n.COMMUNICATION_BULK,n.DATA_PUBLIC,n.DATA_INTERNAL,n.DATA_CONFIDENTIAL,n.DATA_RESTRICTED],MANAGER:[n.PROJECTS_CREATE,n.PROJECTS_READ,n.PROJECTS_UPDATE,n.PROJECTS_ASSIGN,n.PROJECTS_VIEW_ALL,n.USERS_READ,n.USERS_UPDATE,n.USERS_VIEW_ALL,n.FINANCES_VIEW,n.FINANCES_EDIT,n.FINANCES_EXPORT,n.DOCUMENTS_UPLOAD,n.DOCUMENTS_DOWNLOAD,n.DOCUMENTS_SHARE,n.DOCUMENTS_VIEW_ALL,n.REPORTS_VIEW,n.REPORTS_GENERATE,n.REPORTS_EXPORT,n.AI_BUBBLES,n.AI_ADVANCED,n.SETTINGS_VIEW,n.SETTINGS_EDIT,n.CALENDAR_VIEW,n.CALENDAR_EDIT,n.CALENDAR_MANAGE,n.WORKFLOW_VIEW,n.WORKFLOW_EDIT,n.WORKFLOW_MANAGE,n.COMMUNICATION_SEND,n.COMMUNICATION_MANAGE,n.COMMUNICATION_BULK,n.DATA_PUBLIC,n.DATA_INTERNAL,n.DATA_CONFIDENTIAL],PROJECT_MANAGER:[n.PROJECTS_CREATE,n.PROJECTS_READ,n.PROJECTS_UPDATE,n.PROJECTS_VIEW_ASSIGNED,n.USERS_READ,n.FINANCES_VIEW,n.DOCUMENTS_UPLOAD,n.DOCUMENTS_DOWNLOAD,n.DOCUMENTS_SHARE,n.REPORTS_VIEW,n.REPORTS_GENERATE,n.AI_BUBBLES,n.SETTINGS_VIEW,n.CALENDAR_VIEW,n.CALENDAR_EDIT,n.WORKFLOW_VIEW,n.WORKFLOW_EDIT,n.COMMUNICATION_SEND,n.DATA_PUBLIC,n.DATA_INTERNAL],FOREMAN:[n.PROJECTS_READ,n.PROJECTS_VIEW_ASSIGNED,n.DOCUMENTS_UPLOAD,n.DOCUMENTS_DOWNLOAD,n.REPORTS_VIEW,n.AI_BUBBLES,n.CALENDAR_VIEW,n.WORKFLOW_VIEW,n.WORKFLOW_EDIT,n.COMMUNICATION_SEND,n.DATA_PUBLIC,n.DATA_INTERNAL],WORKER:[n.PROJECTS_READ,n.PROJECTS_VIEW_ASSIGNED,n.DOCUMENTS_DOWNLOAD,n.CALENDAR_VIEW,n.WORKFLOW_VIEW,n.DATA_PUBLIC],CLIENT:[n.PROJECTS_READ,n.PROJECTS_VIEW_ASSIGNED,n.DOCUMENTS_DOWNLOAD,n.REPORTS_VIEW,n.CALENDAR_VIEW,n.DATA_PUBLIC],SUBCONTRACTOR:[n.PROJECTS_READ,n.PROJECTS_VIEW_ASSIGNED,n.DOCUMENTS_DOWNLOAD,n.CALENDAR_VIEW,n.WORKFLOW_VIEW,n.DATA_PUBLIC]},a=(e,t)=>{if(!e||!t)return!1;return(s[e.toUpperCase()]||[]).includes(t)},o=(e,t)=>!!(e&&t&&Array.isArray(t))&&t.some(t=>a(e,t)),i=(e,t)=>!!(e&&t&&Array.isArray(t))&&t.every(t=>a(e,t)),l=e=>e&&s[e.toUpperCase()]||[],c=(e,t)=>{const r={public:[n.DATA_PUBLIC],internal:[n.DATA_PUBLIC,n.DATA_INTERNAL],confidential:[n.DATA_PUBLIC,n.DATA_INTERNAL,n.DATA_CONFIDENTIAL],restricted:[n.DATA_PUBLIC,n.DATA_INTERNAL,n.DATA_CONFIDENTIAL,n.DATA_RESTRICTED]};return o(e,r[t]||[])},d=(e,t,r)=>c(e,r)?t:[],u={ADMIN:100,MANAGER:80,PROJECT_MANAGER:60,FOREMAN:40,WORKER:20,CLIENT:10,SUBCONTRACTOR:10},h=(e,t)=>(u[null===e||void 0===e?void 0:e.toUpperCase()]||0)>(u[null===t||void 0===t?void 0:t.toUpperCase()]||0),m=e=>({ADMIN:"Administrator",MANAGER:"Manager",PROJECT_MANAGER:"Project Manager",FOREMAN:"Foreman",WORKER:"Worker",CLIENT:"Client",SUBCONTRACTOR:"Subcontractor"}[null===e||void 0===e?void 0:e.toUpperCase()]||e),p=e=>({ADMIN:"red",MANAGER:"purple",PROJECT_MANAGER:"blue",FOREMAN:"orange",WORKER:"green",CLIENT:"gray",SUBCONTRACTOR:"yellow"}[null===e||void 0===e?void 0:e.toUpperCase()]||"gray"),g={PERMISSIONS:n,ROLE_PERMISSIONS:s,hasPermission:a,hasAnyPermission:o,hasAllPermissions:i,getRolePermissions:l,canAccessDataLevel:c,filterDataByPermissions:d,ROLE_HIERARCHY:u,isRoleHigher:h,getRoleDisplayName:m,getRoleColor:p}},374:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(286));class a extends s.default{select(e){let t=!1;const r=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e){let{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:s=n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=s?"".concat(s,".order"):"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,"".concat(o?"".concat(o,","):"").concat(e,".").concat(t?"asc":"desc").concat(void 0===r?"":r?".nullsfirst":".nullslast")),this}limit(e){let{foreignTable:t,referencedTable:r=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n="undefined"===typeof r?"limit":"".concat(r,".limit");return this.url.searchParams.set(n,"".concat(e)),this}range(e,t){let{foreignTable:r,referencedTable:n=r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s="undefined"===typeof n?"offset":"".concat(n,".offset"),a="undefined"===typeof n?"limit":"".concat(n,".limit");return this.url.searchParams.set(s,"".concat(e)),this.url.searchParams.set(a,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain(){let{analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:s=!1,format:a="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var o;const i=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(a,'; for="').concat(l,'"; options=').concat(i,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}}t.default=a},391:(e,t,r)=>{var n=r(950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},505:(e,t,r)=>{r.r(t),r.d(t,{API_BASE_URL:()=>a,API_ORIGIN:()=>o,activitiesService:()=>g,aiService:()=>j,authService:()=>d,bubblesService:()=>N,calendarService:()=>w,companyDocsService:()=>f,customersService:()=>p,default:()=>D,documentsService:()=>y,feedbackService:()=>T,healthService:()=>A,messagesService:()=>x,notificationsService:()=>b,onboardingService:()=>u,phaseOverrideService:()=>P,projectMessagesService:()=>v,projectsService:()=>h,rolesService:()=>E,tasksService:()=>m,usersService:()=>C,workflowAlertsService:()=>S,workflowImportService:()=>I,workflowService:()=>k});var n=r(51),s=r(722);const a=(()=>{if("undefined"!==typeof window){const e=window.location.host;if(console.log("\ud83d\udd0d API CONFIG: Current host:",e),e.includes("ondigitalocean.app")){const t="".concat(window.location.protocol,"//").concat(e,"/api");return console.log("\ud83d\udd0d API CONFIG: Using production API:",t),t}}return{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL?(console.log("\ud83d\udd0d API CONFIG: Using env var API:",{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL),{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL):(console.log("\ud83d\udd0d API CONFIG: Using localhost fallback"),"http://localhost:5000/api")})(),o=(()=>{try{if(a.endsWith("/api"))return a.slice(0,-4)}catch(Pr){}return a})(),i=(()=>{try{if("undefined"!==typeof window)return"".concat(window.location.protocol,"//").concat(window.location.host,"/api")}catch(Pr){}return null})(),l=new Map,c=s.A.create({baseURL:a,timeout:2e4,headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{if("get"===e.method){const t="".concat(e.url).concat(JSON.stringify(e.params||{})),r=l.get(t);if(r&&Date.now()-r.timestamp<5e3)return Promise.reject({cached:!0,data:r.data,config:e})}const t=sessionStorage.getItem("authToken")||localStorage.getItem("authToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>{if("get"===e.config.method){const t="".concat(e.config.url).concat(JSON.stringify(e.config.params||{}));if(l.set(t,{timestamp:Date.now(),data:e.data}),l.size>100){const e=Date.now();for(const[t,r]of l.entries())e-r.timestamp>15e3&&l.delete(t)}}return e},e=>{var t,r,s,o,d,u,h,m,p,g;const f=!e.response||"Network Error"===e.message||"ERR_NETWORK"===e.code,x="ECONNABORTED"===e.code||/timeout/i.test(e.message||"");if((f||x)&&(null===(t=e.config)||void 0===t||!t.__triedSameOrigin)&&i&&c.defaults.baseURL!==i)try{const t=(0,n.A)((0,n.A)({},e.config),{},{baseURL:i,__triedSameOrigin:!0});return c.request(t)}catch(Pr){}if((null===(r=e.response)||void 0===r?void 0:r.status)>=500&&"get"===(null===(s=e.config)||void 0===s?void 0:s.method)){const t="".concat(e.config.url).concat(JSON.stringify(e.config.params||{})),r=l.get(t);if(r)return Promise.resolve({data:r.data,config:e.config,cached:!0})}if(e.cached)return Promise.resolve({data:e.data,config:e.config,cached:!0});if(console.error("\ud83d\udea8 API ERROR:",{url:null===(o=e.config)||void 0===o?void 0:o.url,method:null===(d=e.config)||void 0===d?void 0:d.method,status:null===(u=e.response)||void 0===u?void 0:u.status,statusText:null===(h=e.response)||void 0===h?void 0:h.statusText,data:null===(m=e.response)||void 0===m?void 0:m.data,message:e.message}),f||x){const t=e.config&&(e.config.baseURL||c.defaults.baseURL)||a||"server";e.message="Network error: Cannot reach ".concat(t,". Please ensure the backend is running.")}else(null===(p=e.response)||void 0===p?void 0:p.status)>=500?e.message="Server error: The server is experiencing issues. Please try again later.":404===(null===(g=e.response)||void 0===g?void 0:g.status)&&(e.message="Not found: The requested resource could not be found.");return Promise.reject(e)});const d={register:async e=>{const t=await c.post("/auth/register",e);return t.data.data&&t.data.data.token&&(localStorage.setItem("authToken",t.data.data.token),localStorage.setItem("user",JSON.stringify(t.data.data.user))),t.data},login:async e=>{const t=await c.post("/auth/login",e);return t.data.data&&t.data.data.token&&(localStorage.setItem("authToken",t.data.data.token),localStorage.setItem("user",JSON.stringify(t.data.data.user))),t.data},logout:()=>{try{localStorage.removeItem("authToken"),localStorage.removeItem("token"),localStorage.removeItem("user")}catch(Pr){}try{sessionStorage.removeItem("authToken"),sessionStorage.removeItem("token"),sessionStorage.removeItem("user")}catch(Pr){}},getCurrentUser:async()=>(await c.get("/auth/me")).data,isAuthenticated:()=>{const e=sessionStorage.getItem("authToken")||localStorage.getItem("authToken")||sessionStorage.getItem("token")||localStorage.getItem("token");return Boolean(e)},getStoredUser:()=>{const e=localStorage.getItem("user");if(e)try{return JSON.parse(e)}catch(Pr){}const t=sessionStorage.getItem("user");if(t)try{return JSON.parse(t)}catch(Pr){}return null},updateUserProfile:async e=>{const t=await c.put("/auth/profile",e);return t.data.data&&t.data.data.user&&localStorage.setItem("user",JSON.stringify(t.data.data.user)),t.data}},u={getOnboardingStatus:async()=>(await c.get("/onboarding/status")).data,updateRole:async e=>{const t=await c.put("/onboarding/role",e);return t.data.data&&t.data.data.user&&localStorage.setItem("user",JSON.stringify(t.data.data.user)),t.data},completeOnboarding:async e=>{const t=await c.post("/onboarding/complete",{onboardingData:e});return t.data.data&&t.data.data.user&&localStorage.setItem("user",JSON.stringify(t.data.data.user)),t.data},getAvailableRoles:async()=>(await c.get("/onboarding/roles")).data,resetOnboarding:async()=>{const e=await c.post("/onboarding/reset");return e.data.data&&e.data.data.user&&localStorage.setItem("user",JSON.stringify(e.data.data.user)),e.data}},h={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/projects",{params:e})).data},getById:async e=>(await c.get("/projects/".concat(e))).data,create:async e=>(await c.post("/projects",e)).data,update:async(e,t)=>(await c.put("/projects/".concat(e),t)).data,delete:async e=>(await c.delete("/projects/".concat(e))).data,archive:async e=>(await c.patch("/projects/".concat(e,"/archive"))).data,getArchived:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/projects",{params:(0,n.A)((0,n.A)({},e),{},{includeArchived:"only"})})).data},updateProgress:async(e,t)=>(await c.patch("/projects/".concat(e,"/progress"),{progress:t})).data,updateStatus:async(e,t)=>(await c.patch("/projects/".concat(e,"/status"),{status:t})).data,getStats:async()=>(await c.get("/projects/stats/overview")).data,search:async e=>(await c.get("/projects/search/query?q=".concat(encodeURIComponent(e)))).data,getWorkflow:async e=>(await c.get("/test/workflow/".concat(e))).data,updateWorkflowStep:async(e,t,r)=>(await c.put("/test/workflow/".concat(e,"/step/").concat(t),r)).data},m={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/tasks",{params:e})).data},getById:async e=>(await c.get("/tasks/".concat(e))).data,create:async e=>(await c.post("/tasks",e)).data,update:async(e,t)=>(await c.put("/tasks/".concat(e),t)).data,delete:async e=>(await c.delete("/tasks/".concat(e))).data,updateStatus:async(e,t)=>(await c.patch("/tasks/".concat(e,"/status"),{status:t})).data,assign:async(e,t)=>(await c.patch("/tasks/".concat(e,"/assign"),{assignedTo:t})).data,getByProject:async e=>(await c.get("/tasks/project/".concat(e))).data,getAssignedToUser:async e=>(await c.get("/tasks/assigned/".concat(e))).data,addComment:async(e,t)=>(await c.post("/tasks/".concat(e,"/comments"),{content:t})).data},p={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/customers",{params:e})).data},getById:async e=>(await c.get("/customers/".concat(e))).data,create:async e=>(await c.post("/customers",e)).data,update:async(e,t)=>(await c.put("/customers/".concat(e),t)).data,delete:async e=>(await c.delete("/customers/".concat(e))).data,search:async e=>(await c.get("/customers/search/query?q=".concat(encodeURIComponent(e)))).data},g={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/activities",{params:e})).data},getRecent:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return(await c.get("/activities/recent",{params:{limit:e}})).data},getByProject:async e=>(await c.get("/activities/project/".concat(e))).data,create:async e=>(await c.post("/activities",e)).data},f={listAssets:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/company-docs/assets",{params:e})).data},uploadAsset:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new FormData;r.append("file",e),t.title&&r.append("title",t.title),t.description&&r.append("description",t.description),t.tags&&r.append("tags",JSON.stringify(t.tags)),t.section&&r.append("section",t.section),t.parentId&&r.append("parentId",t.parentId),void 0!==t.sortOrder&&r.append("sortOrder",t.sortOrder.toString());return(await c.post("/company-docs/assets/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data},deleteAsset:async e=>(await c.delete("/company-docs/assets/".concat(e))).data,downloadAsset:async e=>await c.get("/company-docs/assets/".concat(e,"/download"),{responseType:"blob"}),getAssetPreview:async e=>(await c.get("/company-docs/assets/".concat(e,"/preview"))).data,generateThumbnail:async e=>(await c.post("/company-docs/assets/".concat(e,"/thumbnail"))).data,getAssetVersions:async e=>(await c.get("/company-docs/assets/".concat(e,"/versions"))).data,createAssetVersion:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new FormData;n.append("file",t),r.description&&n.append("description",r.description),r.versionNumber&&n.append("versionNumber",r.versionNumber);return(await c.post("/company-docs/assets/".concat(e,"/versions"),n,{headers:{"Content-Type":"multipart/form-data"}})).data},getAssetStats:async()=>(await c.get("/company-docs/assets/stats")).data,searchAssets:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/company-docs/assets/search",{params:e})).data},createFolder:async e=>(await c.post("/company-docs/folders",e)).data,updateAsset:async(e,t)=>(await c.patch("/company-docs/assets/".concat(e),t)).data,reorderAssets:async e=>(await c.patch("/company-docs/assets/reorder",{updates:e})).data,bulkDeleteAssets:async e=>(await c.delete("/company-docs/assets/bulk",{data:{ids:e}})).data,bulkMoveAssets:async(e,t)=>(await c.patch("/company-docs/assets/bulk-move",{ids:e,parentId:t})).data,renameAsset:async(e,t)=>(await c.patch("/company-docs/assets/".concat(e),{title:t})).data,moveAsset:async(e,t)=>(await c.patch("/company-docs/assets/".concat(e),{parentId:t})).data,toggleFavorite:async e=>(await c.post("/company-docs/assets/".concat(e,"/favorite"))).data,listTemplates:async()=>(await c.get("/company-docs/templates")).data,createTemplate:async(e,t)=>{const r=new FormData;if(r.append("file",e),r.append("name",t.name),t.description&&r.append("description",t.description),t.format&&r.append("format",t.format),t.section&&r.append("section",t.section),void 0!==t.fields){const e="string"===typeof t.fields?t.fields:JSON.stringify(t.fields);r.append("fields",e)}return(await c.post("/company-docs/templates",r,{headers:{"Content-Type":"multipart/form-data"}})).data},generate:async e=>(await c.post("/company-docs/generate",e)).data,deleteTemplate:async e=>(await c.delete("/company-docs/templates/".concat(e))).data,updateTemplate:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new FormData;if(t.name&&n.append("name",t.name),void 0!==t.description&&n.append("description",t.description),t.format&&n.append("format",t.format),void 0!==t.section&&n.append("section",t.section),void 0!==t.fields){const e="string"===typeof t.fields?t.fields:JSON.stringify(t.fields);n.append("fields",e)}r&&n.append("file",r);return(await c.patch("/company-docs/templates/".concat(e),n,{headers:{"Content-Type":"multipart/form-data"}})).data}},x={getConversation:async e=>(await c.get("/messages/".concat(e))).data,send:async e=>(await c.post("/messages",e)).data,getConversations:async()=>(await c.get("/messages/conversations")).data},v={getByProject:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await c.get("/project-messages/".concat(e),{params:t})).data},create:async function(e){let{content:t,subject:r,priority:n="MEDIUM",parentMessageId:s,recipients:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o={content:t,subject:r,priority:n};s&&(o.parentMessageId=s),Array.isArray(a)&&a.length>0&&(o.recipients=a);return(await c.post("/project-messages/".concat(e),o)).data},markRead:async e=>(await c.patch("/project-messages/".concat(e,"/read"))).data,getThread:async e=>(await c.get("/project-messages/thread/".concat(e))).data,delete:async e=>(await c.delete("/project-messages/".concat(e))).data},y={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/documents",{params:e})).data},getByProject:async e=>(await c.get("/documents/project/".concat(e))).data,upload:async e=>(await c.post("/documents/upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,delete:async e=>(await c.delete("/documents/".concat(e))).data,download:async e=>await c.get("/documents/".concat(e,"/download"),{responseType:"blob"})},b={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/notifications",{params:e})).data},getUnreadCount:async()=>(await c.get("/notifications/unread/count")).data,markAsRead:async e=>(await c.post("/notifications/".concat(e,"/read"))).data,markAllAsRead:async()=>(await c.post("/notifications/read-all")).data,create:async e=>(await c.post("/notifications",e)).data},w={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/calendar-events",{params:e})).data},create:async e=>(await c.post("/calendar-events",e)).data,update:async(e,t)=>(await c.put("/calendar-events/".concat(e),t)).data,delete:async e=>(await c.delete("/calendar-events/".concat(e))).data},j={chat:async e=>(await c.post("/ai/chat",{message:e})).data,getCapabilities:async()=>(await c.get("/ai/capabilities")).data,analyzeProject:async e=>(await c.post("/ai/analyze-project",{projectId:e})).data},N={chat:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r={message:e,context:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}};null!==t&&void 0!==t&&""!==String(t).trim()&&(r.projectId=String(t));return(await c.post("/bubbles/chat",r)).data},completeAction:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return(await c.post("/bubbles/complete-action",{pendingAction:e,selectedRecipientIds:t,customEmails:r})).data},getCurrentStep:async e=>(await c.get("/bubbles/project/".concat(e,"/current-step"))).data,executeAction:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await c.post("/bubbles/action",{actionType:e,parameters:t})).data},getHistory:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return(await c.get("/bubbles/history",{params:{limit:e}})).data},resetContext:async()=>(await c.post("/bubbles/reset")).data,getStatus:async()=>(await c.get("/bubbles/status")).data,quickActions:{completeTask:async(e,t)=>await N.executeAction("complete_task",{projectId:e,lineItemId:t}),createAlert:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MEDIUM";return await N.executeAction("create_alert",{projectId:e,message:t,priority:r})},listProjects:async()=>await N.executeAction("list_projects"),checkAlerts:async()=>await N.executeAction("check_alerts")},insights:{getProjectInsights:async e=>(await c.get("/bubbles/insights/project/".concat(e))).data,getPortfolioInsights:async()=>(await c.get("/bubbles/insights/portfolio")).data,getProjectPrediction:async e=>(await c.get("/bubbles/insights/prediction/".concat(e))).data,getProjectRisks:async e=>(await c.get("/bubbles/insights/risks/".concat(e))).data,getOptimizationRecommendations:async e=>(await c.get("/bubbles/insights/optimization/".concat(e))).data}},S={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/alerts",{params:e})).data},getByProject:async e=>(await c.get("/alerts/project/".concat(e))).data,getByUser:async e=>(await c.get("/alerts",{params:{userId:e}})).data,getByPriority:async e=>(await c.get("/alerts",{params:{priority:e}})).data,getSummary:async()=>(await c.get("/alerts/stats")).data,acknowledge:async e=>(await c.patch("/alerts/".concat(e,"/read"))).data,dismiss:async e=>(await c.delete("/alerts/".concat(e))).data,completeStep:async function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return(await c.post("/workflows/complete-item",{projectId:t,lineItemId:r,notes:n,alertId:e})).data},markAllAsRead:async()=>(await c.patch("/alerts/read-all")).data,create:async e=>(await c.post("/alerts",e)).data,triggerManualCheck:async()=>(await c.post("/alerts/check-workflow")).data,getWorkflowStats:async()=>(await c.get("/alerts/workflow-stats")).data,assignAlert:async(e,t)=>(await c.patch("/alerts/".concat(e,"/assign"),{assignedTo:t})).data,dismissAlert:async e=>(await c.patch("/alerts/".concat(e,"/dismiss"))).data,completeAlert:async e=>(await c.patch("/alerts/".concat(e,"/complete"))).data},k={getByProject:async e=>(await c.get("/workflows/project/".concat(e))).data,create:async(e,t)=>(await c.post("/workflows/project/".concat(e),t)).data,updateStep:async(e,t,r)=>(await c.put("/workflows/".concat(e,"/steps/").concat(t),r)).data,completeStep:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";console.log("\ud83d\ude80 Frontend: Completing line item ".concat(t," for project ").concat(e));return(await c.post("/workflows/complete-item",{projectId:e,lineItemId:t,notes:r||""})).data},completeSubTask:async(e,t,r)=>(await c.post("/workflows/".concat(e,"/steps/").concat(t,"/subtasks/").concat(r,"/complete"))).data,assignTeamMember:async(e,t,r)=>(await c.put("/workflows/".concat(e,"/steps/").concat(t,"/assign"),{assignedTo:r})).data,getProgress:async e=>(await c.get("/workflows/project/".concat(e,"/alerts"))).data,getStats:async()=>(await c.get("/workflows/stats")).data},A={getHealth:async()=>(await c.get("/health")).data,getDetailedHealth:async()=>(await c.get("/health/detailed")).data},C={getTeamMembers:async()=>(await c.get("/users/team-members")).data},E={getUsers:async()=>(await c.get("/roles/users")).data},P={getAvailablePhases:async()=>(await c.get("/phase-override/phases")).data,getProjectPhaseStatus:async e=>(await c.get("/phase-override/project/".concat(e,"/status"))).data,overrideProjectPhase:async(e,t,r,n)=>(await c.post("/phase-override/project/".concat(e,"/override"),{toPhase:t,reason:r,userId:n})).data,revertPhaseOverride:async(e,t,r)=>(await c.post("/phase-override/project/".concat(e,"/revert"),{overrideId:t,userId:r})).data,getSuppressedAlerts:async e=>(await c.get("/phase-override/project/".concat(e,"/suppressed-alerts"))).data},I={uploadFile:async e=>(await c.post("/workflow-import/upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,getPreview:async e=>(await c.get("/workflow-import/preview/".concat(e))).data,confirmImport:async(e,t)=>(await c.post("/workflow-import/confirm/".concat(e),t)).data,downloadTemplate:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xlsx";const t=await c.get("/workflow-import/template",{params:{format:e},responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=r,n.setAttribute("download","workflow_template.".concat(e)),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)},cancelImport:async e=>(await c.delete("/workflow-import/cancel/".concat(e))).data},T={getFeedback:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c.get("/feedback",{params:e})},getFeedbackById:e=>c.get("/feedback/".concat(e)),createFeedback:e=>c.post("/feedback",e),updateFeedback:(e,t)=>c.patch("/feedback/".concat(e),t),deleteFeedback:e=>c.delete("/feedback/".concat(e)),vote:(e,t)=>c.post("/feedback/".concat(e,"/vote"),{action:t}),updateStatus:(e,t)=>c.patch("/feedback/".concat(e,"/status"),t),addComment:(e,t)=>c.post("/feedback/".concat(e,"/comments"),t),getComments:e=>c.get("/feedback/".concat(e,"/comments")),uploadFile:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"attachment";const r=new FormData;return r.append("file",e),r.append("type",t),c.post("/upload",r,{headers:{"Content-Type":"multipart/form-data"}})},getNotifications:e=>c.get("/users/".concat(e,"/notifications")),markNotificationAsRead:e=>c.patch("/notifications/".concat(e,"/read")),markAllNotificationsAsRead:e=>c.patch("/users/".concat(e,"/notifications/read-all")),subscribeToFeedback:e=>c.post("/feedback/".concat(e,"/subscribe")),unsubscribeFromFeedback:e=>c.delete("/feedback/".concat(e,"/subscribe")),getFeedbackAnalytics:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c.get("/feedback/analytics",{params:e})},getFeedbackStats:()=>c.get("/feedback/stats"),searchFeedback:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c.get("/feedback/search",{params:(0,n.A)({q:e},t)})},getTags:()=>c.get("/tags"),createTag:e=>c.post("/tags",e),findDuplicates:e=>c.get("/feedback/".concat(e,"/duplicates")),mergeFeedback:(e,t)=>c.post("/feedback/".concat(e,"/merge"),{targetId:t})},D=c},526:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function s(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.d(t,{A:()=>s})},579:(e,t,r)=>{e.exports=r(153)},611:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=r},612:(e,t)=>{function r(e,t){var r=e.length;e.push(t);e:for(;0<r;){var n=r-1>>>1,s=e[n];if(!(0<a(s,t)))break e;e[n]=t,e[r]=s,r=n}}function n(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,s=e.length,o=s>>>1;n<o;){var i=2*(n+1)-1,l=e[i],c=i+1,d=e[c];if(0>a(l,r))c<s&&0>a(d,l)?(e[n]=d,e[c]=r,n=c):(e[n]=l,e[i]=r,n=i);else{if(!(c<s&&0>a(d,r)))break e;e[n]=d,e[c]=r,n=c}}}return t}function a(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();t.unstable_now=function(){return i.now()-l}}var c=[],d=[],u=1,h=null,m=3,p=!1,g=!1,f=!1,x="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=n(d);null!==t;){if(null===t.callback)s(d);else{if(!(t.startTime<=e))break;s(d),t.sortIndex=t.expirationTime,r(c,t)}t=n(d)}}function w(e){if(f=!1,b(e),!g)if(null!==n(c))g=!0,M(j);else{var t=n(d);null!==t&&_(w,t.startTime-e)}}function j(e,r){g=!1,f&&(f=!1,v(A),A=-1),p=!0;var a=m;try{for(b(r),h=n(c);null!==h&&(!(h.expirationTime>r)||e&&!P());){var o=h.callback;if("function"===typeof o){h.callback=null,m=h.priorityLevel;var i=o(h.expirationTime<=r);r=t.unstable_now(),"function"===typeof i?h.callback=i:h===n(c)&&s(c),b(r)}else s(c);h=n(c)}if(null!==h)var l=!0;else{var u=n(d);null!==u&&_(w,u.startTime-r),l=!1}return l}finally{h=null,m=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var N,S=!1,k=null,A=-1,C=5,E=-1;function P(){return!(t.unstable_now()-E<C)}function I(){if(null!==k){var e=t.unstable_now();E=e;var r=!0;try{r=k(!0,e)}finally{r?N():(S=!1,k=null)}}else S=!1}if("function"===typeof y)N=function(){y(I)};else if("undefined"!==typeof MessageChannel){var T=new MessageChannel,D=T.port2;T.port1.onmessage=I,N=function(){D.postMessage(null)}}else N=function(){x(I,0)};function M(e){k=e,S||(S=!0,N())}function _(e,r){A=x(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,M(j))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var r=m;m=t;try{return e()}finally{m=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=m;m=e;try{return t()}finally{m=r}},t.unstable_scheduleCallback=function(e,s,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return e={id:u++,callback:s,priorityLevel:e,startTime:a,expirationTime:i=a+i,sortIndex:-1},a>o?(e.sortIndex=a,r(d,e),null===n(c)&&e===n(d)&&(f?(v(A),A=-1):f=!0,_(w,a-o))):(e.sortIndex=i,r(c,e),g||p||(g=!0,M(j))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=m;return function(){var r=m;m=t;try{return e.apply(this,arguments)}finally{m=r}}}},630:(e,t,r)=>{r.r(t),r.d(t,{Headers:()=>o,Request:()=>i,Response:()=>l,default:()=>a,fetch:()=>s});var n=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof r.g)return r.g;throw new Error("unable to locate global object")}();const s=n.fetch,a=n.fetch.bind(n),o=n.Headers,i=n.Request,l=n.Response},722:(e,t,r)=>{r.d(t,{A:()=>Pt});var n={};function s(e,t){return function(){return e.apply(t,arguments)}}r.r(n),r.d(n,{hasBrowserEnv:()=>ce,hasStandardBrowserEnv:()=>ue,hasStandardBrowserWebWorkerEnv:()=>he,navigator:()=>de,origin:()=>me});const{toString:a}=Object.prototype,{getPrototypeOf:o}=Object,{iterator:i,toStringTag:l}=Symbol,c=(e=>t=>{const r=a.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),d=e=>(e=e.toLowerCase(),t=>c(t)===e),u=e=>t=>typeof t===e,{isArray:h}=Array,m=u("undefined");function p(e){return null!==e&&!m(e)&&null!==e.constructor&&!m(e.constructor)&&x(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const g=d("ArrayBuffer");const f=u("string"),x=u("function"),v=u("number"),y=e=>null!==e&&"object"===typeof e,b=e=>{if("object"!==c(e))return!1;const t=o(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(l in e)&&!(i in e)},w=d("Date"),j=d("File"),N=d("Blob"),S=d("FileList"),k=d("URLSearchParams"),[A,C,E,P]=["ReadableStream","Request","Response","Headers"].map(d);function I(e,t){let r,n,{allOwnKeys:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),h(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{if(p(e))return;const n=s?Object.getOwnPropertyNames(e):Object.keys(e),a=n.length;let o;for(r=0;r<a;r++)o=n[r],t.call(null,e[o],o,e)}}function T(e,t){if(p(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n,s=r.length;for(;s-- >0;)if(n=r[s],t===n.toLowerCase())return n;return null}const D="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,M=e=>!m(e)&&e!==D;const _=(O="undefined"!==typeof Uint8Array&&o(Uint8Array),e=>O&&e instanceof O);var O;const L=d("HTMLFormElement"),R=(e=>{let{hasOwnProperty:t}=e;return(e,r)=>t.call(e,r)})(Object.prototype),F=d("RegExp"),U=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};I(r,(r,s)=>{let a;!1!==(a=t(r,s,e))&&(n[s]=a||r)}),Object.defineProperties(e,n)};const B=d("AsyncFunction"),W=((e,t)=>{return e?setImmediate:t?(r="axios@".concat(Math.random()),n=[],D.addEventListener("message",e=>{let{source:t,data:s}=e;t===D&&s===r&&n.length&&n.shift()()},!1),e=>{n.push(e),D.postMessage(r,"*")}):e=>setTimeout(e);var r,n})("function"===typeof setImmediate,x(D.postMessage)),z="undefined"!==typeof queueMicrotask?queueMicrotask.bind(D):"undefined"!==typeof process&&process.nextTick||W,V={isArray:h,isArrayBuffer:g,isBuffer:p,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||x(e.append)&&("formdata"===(t=c(e))||"object"===t&&x(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&g(e.buffer),t},isString:f,isNumber:v,isBoolean:e=>!0===e||!1===e,isObject:y,isPlainObject:b,isEmptyObject:e=>{if(!y(e)||p(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(It){return!1}},isReadableStream:A,isRequest:C,isResponse:E,isHeaders:P,isUndefined:m,isDate:w,isFile:j,isBlob:N,isRegExp:F,isFunction:x,isStream:e=>y(e)&&x(e.pipe),isURLSearchParams:k,isTypedArray:_,isFileList:S,forEach:I,merge:function e(){const{caseless:t}=M(this)&&this||{},r={},n=(n,s)=>{const a=t&&T(r,s)||s;b(r[a])&&b(n)?r[a]=e(r[a],n):b(n)?r[a]=e({},n):h(n)?r[a]=n.slice():r[a]=n};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&I(arguments[s],n);return r},extend:function(e,t,r){let{allOwnKeys:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return I(t,(t,n)=>{r&&x(t)?e[n]=s(t,r):e[n]=t},{allOwnKeys:n}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let s,a,i;const l={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),a=s.length;a-- >0;)i=s[a],n&&!n(i,e,t)||l[i]||(t[i]=e[i],l[i]=!0);e=!1!==r&&o(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:c,kindOfTest:d,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(h(e))return e;let t=e.length;if(!v(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[i]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:L,hasOwnProperty:R,hasOwnProp:R,reduceDescriptors:U,freezeMethods:e=>{U(e,(t,r)=>{if(x(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];x(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach(e=>{r[e]=!0})};return h(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:T,global:D,isContextDefined:M,isSpecCompliantForm:function(e){return!!(e&&x(e.append)&&"FormData"===e[l]&&e[i])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(y(e)){if(t.indexOf(e)>=0)return;if(p(e))return e;if(!("toJSON"in e)){t[n]=e;const s=h(e)?[]:{};return I(e,(e,t)=>{const a=r(e,n+1);!m(a)&&(s[t]=a)}),t[n]=void 0,s}}return e};return r(e,0)},isAsyncFn:B,isThenable:e=>e&&(y(e)||x(e))&&x(e.then)&&x(e.catch),setImmediate:W,asap:z,isIterable:e=>null!=e&&x(e[i])};function H(e,t,r,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}V.inherits(H,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:V.toJSONObject(this.config),code:this.code,status:this.status}}});const q=H.prototype,K={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{K[e]={value:e}}),Object.defineProperties(H,K),Object.defineProperty(q,"isAxiosError",{value:!0}),H.from=(e,t,r,n,s,a)=>{const o=Object.create(q);return V.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),H.call(o,e.message,t,r,n,s),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};const G=H;function J(e){return V.isPlainObject(e)||V.isArray(e)}function Y(e){return V.endsWith(e,"[]")?e.slice(0,-2):e}function Q(e,t,r){return e?e.concat(t).map(function(e,t){return e=Y(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}const X=V.toFlatObject(V,{},null,function(e){return/^is[A-Z]/.test(e)});const $=function(e,t,r){if(!V.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=V.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!V.isUndefined(t[e])})).metaTokens,s=r.visitor||c,a=r.dots,o=r.indexes,i=(r.Blob||"undefined"!==typeof Blob&&Blob)&&V.isSpecCompliantForm(t);if(!V.isFunction(s))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(V.isDate(e))return e.toISOString();if(V.isBoolean(e))return e.toString();if(!i&&V.isBlob(e))throw new G("Blob is not supported. Use a Buffer instead.");return V.isArrayBuffer(e)||V.isTypedArray(e)?i&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,s){let i=e;if(e&&!s&&"object"===typeof e)if(V.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(V.isArray(e)&&function(e){return V.isArray(e)&&!e.some(J)}(e)||(V.isFileList(e)||V.endsWith(r,"[]"))&&(i=V.toArray(e)))return r=Y(r),i.forEach(function(e,n){!V.isUndefined(e)&&null!==e&&t.append(!0===o?Q([r],n,a):null===o?r:r+"[]",l(e))}),!1;return!!J(e)||(t.append(Q(s,r,a),l(e)),!1)}const d=[],u=Object.assign(X,{defaultVisitor:c,convertValue:l,isVisitable:J});if(!V.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!V.isUndefined(r)){if(-1!==d.indexOf(r))throw Error("Circular reference detected in "+n.join("."));d.push(r),V.forEach(r,function(r,a){!0===(!(V.isUndefined(r)||null===r)&&s.call(t,r,V.isString(a)?a.trim():a,n,u))&&e(r,n?n.concat(a):[a])}),d.pop()}}(e),t};function Z(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function ee(e,t){this._pairs=[],e&&$(e,this,t)}const te=ee.prototype;te.append=function(e,t){this._pairs.push([e,t])},te.toString=function(e){const t=e?function(t){return e.call(this,t,Z)}:Z;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const re=ee;function ne(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function se(e,t,r){if(!t)return e;const n=r&&r.encode||ne;V.isFunction(r)&&(r={serialize:r});const s=r&&r.serialize;let a;if(a=s?s(t,r):V.isURLSearchParams(t)?t.toString():new re(t,r).toString(n),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const ae=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){V.forEach(this.handlers,function(t){null!==t&&e(t)})}},oe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var ie=r(51);const le={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:re,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ce="undefined"!==typeof window&&"undefined"!==typeof document,de="object"===typeof navigator&&navigator||void 0,ue=ce&&(!de||["ReactNative","NativeScript","NS"].indexOf(de.product)<0),he="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,me=ce&&window.location.href||"http://localhost",pe=(0,ie.A)((0,ie.A)({},n),le);const ge=function(e){function t(e,r,n,s){let a=e[s++];if("__proto__"===a)return!0;const o=Number.isFinite(+a),i=s>=e.length;if(a=!a&&V.isArray(n)?n.length:a,i)return V.hasOwnProp(n,a)?n[a]=[n[a],r]:n[a]=r,!o;n[a]&&V.isObject(n[a])||(n[a]=[]);return t(e,r,n[a],s)&&V.isArray(n[a])&&(n[a]=function(e){const t={},r=Object.keys(e);let n;const s=r.length;let a;for(n=0;n<s;n++)a=r[n],t[a]=e[a];return t}(n[a])),!o}if(V.isFormData(e)&&V.isFunction(e.entries)){const r={};return V.forEachEntry(e,(e,n)=>{t(function(e){return V.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,r,0)}),r}return null};const fe={transitional:oe,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,s=V.isObject(e);s&&V.isHTMLForm(e)&&(e=new FormData(e));if(V.isFormData(e))return n?JSON.stringify(ge(e)):e;if(V.isArrayBuffer(e)||V.isBuffer(e)||V.isStream(e)||V.isFile(e)||V.isBlob(e)||V.isReadableStream(e))return e;if(V.isArrayBufferView(e))return e.buffer;if(V.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return $(e,new pe.classes.URLSearchParams,(0,ie.A)({visitor:function(e,t,r,n){return pe.isNode&&V.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=V.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return $(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||n?(t.setContentType("application/json",!1),function(e,t,r){if(V.isString(e))try{return(t||JSON.parse)(e),V.trim(e)}catch(It){if("SyntaxError"!==It.name)throw It}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||fe.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(V.isResponse(e)||V.isReadableStream(e))return e;if(e&&V.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(It){if(r){if("SyntaxError"===It.name)throw G.from(It,G.ERR_BAD_RESPONSE,this,null,this.response);throw It}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:pe.classes.FormData,Blob:pe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};V.forEach(["delete","get","head","post","put","patch"],e=>{fe.headers[e]={}});const xe=fe,ve=V.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ye=Symbol("internals");function be(e){return e&&String(e).trim().toLowerCase()}function we(e){return!1===e||null==e?e:V.isArray(e)?e.map(we):String(e)}function je(e,t,r,n,s){return V.isFunction(n)?n.call(this,t,r):(s&&(t=r),V.isString(t)?V.isString(n)?-1!==t.indexOf(n):V.isRegExp(n)?n.test(t):void 0:void 0)}class Ne{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function s(e,t,r){const s=be(t);if(!s)throw new Error("header name must be a non-empty string");const a=V.findKey(n,s);(!a||void 0===n[a]||!0===r||void 0===r&&!1!==n[a])&&(n[a||t]=we(e))}const a=(e,t)=>V.forEach(e,(e,r)=>s(e,r,t));if(V.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(V.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let r,n,s;return e&&e.split("\n").forEach(function(e){s=e.indexOf(":"),r=e.substring(0,s).trim().toLowerCase(),n=e.substring(s+1).trim(),!r||t[r]&&ve[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t})(e),t);else if(V.isObject(e)&&V.isIterable(e)){let r,n,s={};for(const t of e){if(!V.isArray(t))throw TypeError("Object iterator must return a key-value pair");s[n=t[0]]=(r=s[n])?V.isArray(r)?[...r,t[1]]:[r,t[1]]:t[1]}a(s,t)}else null!=e&&s(t,e,r);return this}get(e,t){if(e=be(e)){const r=V.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(V.isFunction(t))return t.call(this,e,r);if(V.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=be(e)){const r=V.findKey(this,e);return!(!r||void 0===this[r]||t&&!je(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function s(e){if(e=be(e)){const s=V.findKey(r,e);!s||t&&!je(0,r[s],s,t)||(delete r[s],n=!0)}}return V.isArray(e)?e.forEach(s):s(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const s=t[r];e&&!je(0,this[s],s,e,!0)||(delete this[s],n=!0)}return n}normalize(e){const t=this,r={};return V.forEach(this,(n,s)=>{const a=V.findKey(r,s);if(a)return t[a]=we(n),void delete t[s];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}(s):String(s).trim();o!==s&&delete t[s],t[o]=we(n),r[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return V.forEach(this,(r,n)=>{null!=r&&!1!==r&&(t[n]=e&&V.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,r]=e;return t+": "+r}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return n.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[ye]=this[ye]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=be(e);t[n]||(!function(e,t){const r=V.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(e,r,s){return this[n].call(this,t,e,r,s)},configurable:!0})})}(r,e),t[n]=!0)}return V.isArray(e)?e.forEach(n):n(e),this}}Ne.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),V.reduceDescriptors(Ne.prototype,(e,t)=>{let{value:r}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(e){this[n]=e}}}),V.freezeMethods(Ne);const Se=Ne;function ke(e,t){const r=this||xe,n=t||r,s=Se.from(n.headers);let a=n.data;return V.forEach(e,function(e){a=e.call(r,a,s.normalize(),t?t.status:void 0)}),s.normalize(),a}function Ae(e){return!(!e||!e.__CANCEL__)}function Ce(e,t,r){G.call(this,null==e?"canceled":e,G.ERR_CANCELED,t,r),this.name="CanceledError"}V.inherits(Ce,G,{__CANCEL__:!0});const Ee=Ce;function Pe(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new G("Request failed with status code "+r.status,[G.ERR_BAD_REQUEST,G.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}const Ie=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let s,a=0,o=0;return t=void 0!==t?t:1e3,function(i){const l=Date.now(),c=n[o];s||(s=l),r[a]=i,n[a]=l;let d=o,u=0;for(;d!==a;)u+=r[d++],d%=e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),l-s<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}};const Te=function(e,t){let r,n,s=0,a=1e3/t;const o=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();s=a,r=null,n&&(clearTimeout(n),n=null),e(...t)};return[function(){const e=Date.now(),t=e-s;for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];t>=a?o(l,e):(r=l,n||(n=setTimeout(()=>{n=null,o(r)},a-t)))},()=>r&&o(r)]},De=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0;const s=Ie(50,250);return Te(r=>{const a=r.loaded,o=r.lengthComputable?r.total:void 0,i=a-n,l=s(i);n=a;e({loaded:a,total:o,progress:o?a/o:void 0,bytes:i,rate:l||void 0,estimated:l&&o&&a<=o?(o-a)/l:void 0,event:r,lengthComputable:null!=o,[t?"download":"upload"]:!0})},r)},Me=(e,t)=>{const r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},_e=e=>function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return V.asap(()=>e(...r))},Oe=pe.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,pe.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(pe.origin),pe.navigator&&/(msie|trident)/i.test(pe.navigator.userAgent)):()=>!0,Le=pe.hasStandardBrowserEnv?{write(e,t,r,n,s,a){const o=[e+"="+encodeURIComponent(t)];V.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),V.isString(n)&&o.push("path="+n),V.isString(s)&&o.push("domain="+s),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Re(e,t,r){let n=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(n||0==r)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Fe=e=>e instanceof Se?(0,ie.A)({},e):e;function Ue(e,t){t=t||{};const r={};function n(e,t,r,n){return V.isPlainObject(e)&&V.isPlainObject(t)?V.merge.call({caseless:n},e,t):V.isPlainObject(t)?V.merge({},t):V.isArray(t)?t.slice():t}function s(e,t,r,s){return V.isUndefined(t)?V.isUndefined(e)?void 0:n(void 0,e,0,s):n(e,t,0,s)}function a(e,t){if(!V.isUndefined(t))return n(void 0,t)}function o(e,t){return V.isUndefined(t)?V.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function i(r,s,a){return a in t?n(r,s):a in e?n(void 0,r):void 0}const l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:i,headers:(e,t,r)=>s(Fe(e),Fe(t),0,!0)};return V.forEach(Object.keys((0,ie.A)((0,ie.A)({},e),t)),function(n){const a=l[n]||s,o=a(e[n],t[n],n);V.isUndefined(o)&&a!==i||(r[n]=o)}),r}const Be=e=>{const t=Ue({},e);let r,{data:n,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:o,headers:i,auth:l}=t;if(t.headers=i=Se.from(i),t.url=se(Re(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&i.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),V.isFormData(n))if(pe.hasStandardBrowserEnv||pe.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(!1!==(r=i.getContentType())){const[e,...t]=r?r.split(";").map(e=>e.trim()).filter(Boolean):[];i.setContentType([e||"multipart/form-data",...t].join("; "))}if(pe.hasStandardBrowserEnv&&(s&&V.isFunction(s)&&(s=s(t)),s||!1!==s&&Oe(t.url))){const e=a&&o&&Le.read(o);e&&i.set(a,e)}return t},We="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,r){const n=Be(e);let s=n.data;const a=Se.from(n.headers).normalize();let o,i,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:m}=n;function p(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let g=new XMLHttpRequest;function f(){if(!g)return;const n=Se.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders());Pe(function(e){t(e),p()},function(e){r(e),p()},{data:u&&"text"!==u&&"json"!==u?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:n,config:e,request:g}),g=null}g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout,"onloadend"in g?g.onloadend=f:g.onreadystatechange=function(){g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))&&setTimeout(f)},g.onabort=function(){g&&(r(new G("Request aborted",G.ECONNABORTED,e,g)),g=null)},g.onerror=function(){r(new G("Network Error",G.ERR_NETWORK,e,g)),g=null},g.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const s=n.transitional||oe;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),r(new G(t,s.clarifyTimeoutError?G.ETIMEDOUT:G.ECONNABORTED,e,g)),g=null},void 0===s&&a.setContentType(null),"setRequestHeader"in g&&V.forEach(a.toJSON(),function(e,t){g.setRequestHeader(t,e)}),V.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),u&&"json"!==u&&(g.responseType=n.responseType),m&&([l,d]=De(m,!0),g.addEventListener("progress",l)),h&&g.upload&&([i,c]=De(h),g.upload.addEventListener("progress",i),g.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{g&&(r(!t||t.type?new Ee(null,e,g):t),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const x=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);x&&-1===pe.protocols.indexOf(x)?r(new G("Unsupported protocol "+x+":",G.ERR_BAD_REQUEST,e)):g.send(s||null)})},ze=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController;const s=function(e){if(!r){r=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof G?t:new Ee(t instanceof Error?t.message:t))}};let a=t&&setTimeout(()=>{a=null,s(new G("timeout ".concat(t," of ms exceeded"),G.ETIMEDOUT))},t);const o=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(s):e.removeEventListener("abort",s)}),e=null)};e.forEach(e=>e.addEventListener("abort",s));const{signal:i}=n;return i.unsubscribe=()=>V.asap(o),i}};function Ve(e,t){this.v=e,this.k=t}function He(e){return function(){return new qe(e.apply(this,arguments))}}function qe(e){var t,r;function n(t,r){try{var a=e[t](r),o=a.value,i=o instanceof Ve;Promise.resolve(i?o.v:o).then(function(r){if(i){var l="return"===t?"return":"next";if(!o.k||r.done)return n(l,r);r=e[l](r).value}s(a.done?"return":"normal",r)},function(e){n("throw",e)})}catch(e){s("throw",e)}}function s(e,s){switch(e){case"return":t.resolve({value:s,done:!0});break;case"throw":t.reject(s);break;default:t.resolve({value:s,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,s){return new Promise(function(a,o){var i={key:e,arg:s,resolve:a,reject:o,next:null};r?r=r.next=i:(t=r=i,n(e,s))})},"function"!=typeof e.return&&(this.return=void 0)}function Ke(e){return new Ve(e,0)}function Ge(e){var t={},r=!1;function n(t,n){return r=!0,n=new Promise(function(r){r(e[t](n))}),{done:!1,value:new Ve(n,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):n("return",e)}),t}function Je(e){var t,r,n,s=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);s--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new Ye(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Ye(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Ye=function(e){this.s=e,this.n=e.next},Ye.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new Ye(e)}qe.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},qe.prototype.next=function(e){return this._invoke("next",e)},qe.prototype.throw=function(e){return this._invoke("throw",e)},qe.prototype.return=function(e){return this._invoke("return",e)};const Qe=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let n,s=0;for(;s<r;)n=s+t,yield e.slice(s,n),s=n},Xe=function(){var e=He(function*(e,t){var r,n=!1,s=!1;try{for(var a,o=Je($e(e));n=!(a=yield Ke(o.next())).done;n=!1){const e=a.value;yield*Ge(Je(Qe(e,t)))}}catch(i){s=!0,r=i}finally{try{n&&null!=o.return&&(yield Ke(o.return()))}finally{if(s)throw r}}});return function(t,r){return e.apply(this,arguments)}}(),$e=function(){var e=He(function*(e){if(e[Symbol.asyncIterator])return void(yield*Ge(Je(e)));const t=e.getReader();try{for(;;){const{done:e,value:r}=yield Ke(t.read());if(e)break;yield r}}finally{yield Ke(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Ze=(e,t,r,n)=>{const s=Xe(e,t);let a,o=0,i=e=>{a||(a=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await s.next();if(t)return i(),void e.close();let a=n.byteLength;if(r){let e=o+=a;r(e)}e.enqueue(new Uint8Array(n))}catch(t){throw i(t),t}},cancel:e=>(i(e),s.return())},{highWaterMark:2})},et="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,tt=et&&"function"===typeof ReadableStream,rt=et&&("function"===typeof TextEncoder?(nt=new TextEncoder,e=>nt.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var nt;const st=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return!!e(...r)}catch(It){return!1}},at=tt&&st(()=>{let e=!1;const t=new Request(pe.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),ot=tt&&st(()=>V.isReadableStream(new Response("").body)),it={stream:ot&&(e=>e.body)};var lt;et&&(lt=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!it[e]&&(it[e]=V.isFunction(lt[e])?t=>t[e]():(t,r)=>{throw new G("Response type '".concat(e,"' is not supported"),G.ERR_NOT_SUPPORT,r)})}));const ct=async(e,t)=>{const r=V.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(V.isBlob(e))return e.size;if(V.isSpecCompliantForm(e)){const t=new Request(pe.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return V.isArrayBufferView(e)||V.isArrayBuffer(e)?e.byteLength:(V.isURLSearchParams(e)&&(e+=""),V.isString(e)?(await rt(e)).byteLength:void 0)})(t):r},dt=et&&(async e=>{let{url:t,method:r,data:n,signal:s,cancelToken:a,timeout:o,onDownloadProgress:i,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=Be(e);c=c?(c+"").toLowerCase():"text";let m,p=ze([s,a&&a.toAbortSignal()],o);const g=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let f;try{if(l&&at&&"get"!==r&&"head"!==r&&0!==(f=await ct(d,n))){let e,r=new Request(t,{method:"POST",body:n,duplex:"half"});if(V.isFormData(n)&&(e=r.headers.get("content-type"))&&d.setContentType(e),r.body){const[e,t]=Me(f,De(_e(l)));n=Ze(r.body,65536,e,t)}}V.isString(u)||(u=u?"include":"omit");const s="credentials"in Request.prototype;m=new Request(t,(0,ie.A)((0,ie.A)({},h),{},{signal:p,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:s?u:void 0}));let a=await fetch(m,h);const o=ot&&("stream"===c||"response"===c);if(ot&&(i||o&&g)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=a[t]});const t=V.toFiniteNumber(a.headers.get("content-length")),[r,n]=i&&Me(t,De(_e(i),!0))||[];a=new Response(Ze(a.body,65536,r,()=>{n&&n(),g&&g()}),e)}c=c||"text";let x=await it[V.findKey(it,c)||"text"](a,e);return!o&&g&&g(),await new Promise((t,r)=>{Pe(t,r,{data:x,headers:Se.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:m})})}catch(x){if(g&&g(),x&&"TypeError"===x.name&&/Load failed|fetch/i.test(x.message))throw Object.assign(new G("Network Error",G.ERR_NETWORK,e,m),{cause:x.cause||x});throw G.from(x,x&&x.code,e,m)}}),ut={http:null,xhr:We,fetch:dt};V.forEach(ut,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(It){}Object.defineProperty(e,"adapterName",{value:t})}});const ht=e=>"- ".concat(e),mt=e=>V.isFunction(e)||null===e||!1===e,pt=e=>{e=V.isArray(e)?e:[e];const{length:t}=e;let r,n;const s={};for(let a=0;a<t;a++){let t;if(r=e[a],n=r,!mt(r)&&(n=ut[(t=String(r)).toLowerCase()],void 0===n))throw new G("Unknown adapter '".concat(t,"'"));if(n)break;s[t||"#"+a]=n}if(!n){const e=Object.entries(s).map(e=>{let[t,r]=e;return"adapter ".concat(t," ")+(!1===r?"is not supported by the environment":"is not available in the build")});let r=t?e.length>1?"since :\n"+e.map(ht).join("\n"):" "+ht(e[0]):"as no adapter specified";throw new G("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return n};function gt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ee(null,e)}function ft(e){gt(e),e.headers=Se.from(e.headers),e.data=ke.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return pt(e.adapter||xe.adapter)(e).then(function(t){return gt(e),t.data=ke.call(e,e.transformResponse,t),t.headers=Se.from(t.headers),t},function(t){return Ae(t)||(gt(e),t&&t.response&&(t.response.data=ke.call(e,e.transformResponse,t.response),t.response.headers=Se.from(t.response.headers))),Promise.reject(t)})}const xt="1.11.0",vt={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{vt[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const yt={};vt.transitional=function(e,t,r){function n(e,t){return"[Axios v"+xt+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,s,a)=>{if(!1===e)throw new G(n(s," has been removed"+(t?" in "+t:"")),G.ERR_DEPRECATED);return t&&!yt[s]&&(yt[s]=!0,console.warn(n(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,s,a)}},vt.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};const bt={assertOptions:function(e,t,r){if("object"!==typeof e)throw new G("options must be an object",G.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let s=n.length;for(;s-- >0;){const a=n[s],o=t[a];if(o){const t=e[a],r=void 0===t||o(t,a,e);if(!0!==r)throw new G("option "+a+" must be "+r,G.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new G("Unknown option "+a,G.ERR_BAD_OPTION)}},validators:vt},wt=bt.validators;class jt{constructor(e){this.defaults=e||{},this.interceptors={request:new ae,response:new ae}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{r.stack?t&&!String(r.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+t):r.stack=t}catch(It){}}throw r}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=Ue(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:s}=t;void 0!==r&&bt.assertOptions(r,{silentJSONParsing:wt.transitional(wt.boolean),forcedJSONParsing:wt.transitional(wt.boolean),clarifyTimeoutError:wt.transitional(wt.boolean)},!1),null!=n&&(V.isFunction(n)?t.paramsSerializer={serialize:n}:bt.assertOptions(n,{encode:wt.function,serialize:wt.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),bt.assertOptions(t,{baseUrl:wt.spelling("baseURL"),withXsrfToken:wt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=s&&V.merge(s.common,s[t.method]);s&&V.forEach(["delete","get","head","post","put","patch","common"],e=>{delete s[e]}),t.headers=Se.concat(a,s);const o=[];let i=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!i){const e=[ft.bind(this),void 0];for(e.unshift(...o),e.push(...l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(m){t.call(this,m);break}}try{c=ft.call(this,h)}catch(m){return Promise.reject(m)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return se(Re((e=Ue(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}V.forEach(["delete","get","head","options"],function(e){jt.prototype[e]=function(t,r){return this.request(Ue(r||{},{method:e,url:t,data:(r||{}).data}))}}),V.forEach(["post","put","patch"],function(e){function t(t){return function(r,n,s){return this.request(Ue(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}jt.prototype[e]=t(),jt.prototype[e+"Form"]=t(!0)});const Nt=jt;class St{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,n,s){r.reason||(r.reason=new Ee(e,n,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;const t=new St(function(t){e=t});return{token:t,cancel:e}}}const kt=St;const At={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(At).forEach(e=>{let[t,r]=e;At[r]=t});const Ct=At;const Et=function e(t){const r=new Nt(t),n=s(Nt.prototype.request,r);return V.extend(n,Nt.prototype,r,{allOwnKeys:!0}),V.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e(Ue(t,r))},n}(xe);Et.Axios=Nt,Et.CanceledError=Ee,Et.CancelToken=kt,Et.isCancel=Ae,Et.VERSION=xt,Et.toFormData=$,Et.AxiosError=G,Et.Cancel=Et.CanceledError,Et.all=function(e){return Promise.all(e)},Et.spread=function(e){return function(t){return e.apply(null,t)}},Et.isAxiosError=function(e){return V.isObject(e)&&!0===e.isAxiosError},Et.mergeConfig=Ue,Et.AxiosHeaders=Se,Et.formToJSON=e=>ge(V.isHTMLForm(e)?new FormData(e):e),Et.getAdapter=pt,Et.HttpStatusCode=Ct,Et.default=Et;const Pt=Et},730:(e,t,r)=>{var n=r(43),s=r(67);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,i={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(i[e]=t,e=0;e<t.length;e++)o.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},p={};function g(e,t,r,n,s,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var f={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){f[e]=new g(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];f[t]=new g(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){f[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){f[e]=new g(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){f[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){f[e]=new g(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){f[e]=new g(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){f[e]=new g(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){f[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)});var x=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function y(e,t,r,n){var s=f.hasOwnProperty(t)?f[t]:null;(null!==s?0!==s.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,r,n){if(null===t||"undefined"===typeof t||function(e,t,r,n){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,r,s,n)&&(r=null),n||null===s?function(e){return!!u.call(p,e)||!u.call(m,e)&&(h.test(e)?p[e]=!0:(m[e]=!0,!1))}(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=null===r?3!==s.type&&"":r:(t=s.attributeName,n=s.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(s=s.type)||4===s&&!0===r?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(x,v);f[t]=new g(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(x,v);f[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(x,v);f[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){f[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)}),f.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){f[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),j=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var _=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=_&&e[_]||e["@@iterator"])?e:null}var L,R=Object.assign;function F(e){if(void 0===L)try{throw Error()}catch(Lt){var t=Lt.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var U=!1;function B(e,t){if(!e||U)return"";U=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(Dt){var n=Dt}Reflect.construct(e,[],t)}else{try{t.call()}catch(Dt){n=Dt}e.call(t.prototype)}else{try{throw Error()}catch(Dt){n=Dt}e()}}catch(Dt){if(Dt&&n&&"string"===typeof Dt.stack){for(var s=Dt.stack.split("\n"),a=n.stack.split("\n"),o=s.length-1,i=a.length-1;1<=o&&0<=i&&s[o]!==a[i];)i--;for(;1<=o&&0<=i;o--,i--)if(s[o]!==a[i]){if(1!==o||1!==i)do{if(o--,0>--i||s[o]!==a[i]){var l="\n"+s[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=i);break}}}finally{U=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?F(e):""}function W(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case N:return"Fragment";case j:return"Portal";case k:return"Profiler";case S:return"StrictMode";case P:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case T:return null!==(t=e.displayName||null)?t:z(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return z(e(t))}catch(Lt){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var s=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){n=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=q(e)?e.checked?"true":"false":e.value),(e=n)!==r&&(t.setValue(e),!0)}function J(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var r=t.checked;return R({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function Q(e,t){var r=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;r=H(null!=t.value?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function X(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function $(e,t){X(e,t);var r=H(t.value),n=t.type;if(null!=r)"number"===n?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,r):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function ee(e,t,r){"number"===t&&J(e.ownerDocument)===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var te=Array.isArray;function re(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+H(r),t=null,s=0;s<e.length;s++){if(e[s].value===r)return e[s].selected=!0,void(n&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return R({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(a(92));if(te(r)){if(1<r.length)throw Error(a(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:H(r)}}function ae(e,t){var r=H(t.value),n=H(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=n&&(e.defaultValue=""+n)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ie(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ie(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r)})}:e}(function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ue(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function pe(e,t,r){return null==t||"boolean"===typeof t||""===t?"":r||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function ge(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var n=0===r.indexOf("--"),s=pe(r,t[r],n);"float"===r&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}Object.keys(he).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]})});var fe=R({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xe(e,t){if(t){if(fe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,je=null,Ne=null;function Se(e){if(e=Es(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=Is(t),we(e.stateNode,e.type,t))}}function ke(e){je?Ne?Ne.push(e):Ne=[e]:je=e}function Ae(){if(je){var e=je,t=Ne;if(Ne=je=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Ce(e,t){return e(t)}function Ee(){}var Pe=!1;function Ie(e,t,r){if(Pe)return e(t,r);Pe=!0;try{return Ce(e,t,r)}finally{Pe=!1,(null!==je||null!==Ne)&&(Ee(),Ae())}}function Te(e,t){var r=e.stateNode;if(null===r)return null;var n=Is(r);if(null===n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(r&&"function"!==typeof r)throw Error(a(231,t,typeof r));return r}var De=!1;if(d)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){De=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch(Mt){De=!1}function _e(e,t,r,n,s,a,o,i,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(d){this.onError(d)}}var Oe=!1,Le=null,Re=!1,Fe=null,Ue={onError:function(e){Oe=!0,Le=e}};function Be(e,t,r,n,s,a,o,i,l){Oe=!1,Le=null,_e.apply(Ue,arguments)}function We(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(We(e)!==e)throw Error(a(188))}function He(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(a(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(null===s)break;var o=s.alternate;if(null===o){if(null!==(n=s.return)){r=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===r)return Ve(s),e;if(o===n)return Ve(s),t;o=o.sibling}throw Error(a(188))}if(r.return!==n.return)r=s,n=o;else{for(var i=!1,l=s.child;l;){if(l===r){i=!0,r=s,n=o;break}if(l===n){i=!0,n=s,r=o;break}l=l.sibling}if(!i){for(l=o.child;l;){if(l===r){i=!0,r=o,n=s;break}if(l===n){i=!0,n=o,r=s;break}l=l.sibling}if(!i)throw Error(a(189))}}if(r.alternate!==n)throw Error(a(190))}if(3!==r.tag)throw Error(a(188));return r.stateNode.current===r?e:t}(e),null!==e?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=s.unstable_scheduleCallback,Ge=s.unstable_cancelCallback,Je=s.unstable_shouldYield,Ye=s.unstable_requestPaint,Qe=s.unstable_now,Xe=s.unstable_getCurrentPriorityLevel,$e=s.unstable_ImmediatePriority,Ze=s.unstable_UserBlockingPriority,et=s.unstable_NormalPriority,tt=s.unstable_LowPriority,rt=s.unstable_IdlePriority,nt=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/it|0)|0},ot=Math.log,it=Math.LN2;var lt=64,ct=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ut(e,t){var r=e.pendingLanes;if(0===r)return 0;var n=0,s=e.suspendedLanes,a=e.pingedLanes,o=268435455&r;if(0!==o){var i=o&~s;0!==i?n=dt(i):0!==(a&=o)&&(n=dt(a))}else 0!==(o=r&~s)?n=dt(o):0!==a&&(n=dt(a));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&s)&&((s=n&-n)>=(a=t&-t)||16===s&&0!==(4194240&a)))return t;if(0!==(4&n)&&(n|=16&r),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)s=1<<(r=31-at(t)),n|=e[r],t&=~s;return n}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function ft(e,t,r){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=r}function xt(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-at(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var vt=0;function yt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,jt,Nt,St,kt=!1,At=[],Ct=null,Et=null,Pt=null,_t=new Map,Ot=new Map,Rt=[],Ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ut(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":Et=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":_t.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ot.delete(t.pointerId)}}function zt(e,t,r,n,s,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:a,targetContainers:[s]},null!==t&&(null!==(t=Es(t))&&wt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Ht(e){var t=Cs(e.target);if(null!==t){var r=We(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=ze(r)))return e.blockedOn=t,void St(e.priority,function(){jt(r)})}else if(3===t&&r.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function qt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=rr(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==r)return null!==(t=Es(r))&&wt(t),e.blockedOn=r,!1;var n=new(r=e.nativeEvent).constructor(r.type,r);ye=n,r.target.dispatchEvent(n),ye=null,t.shift()}return!0}function Kt(e,t,r){qt(e)&&r.delete(t)}function Gt(){kt=!1,null!==Ct&&qt(Ct)&&(Ct=null),null!==Et&&qt(Et)&&(Et=null),null!==Pt&&qt(Pt)&&(Pt=null),_t.forEach(Kt),Ot.forEach(Kt)}function Jt(e,t){e.blockedOn===t&&(e.blockedOn=null,kt||(kt=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Gt)))}function Yt(e){function t(t){return Jt(t,e)}if(0<At.length){Jt(At[0],e);for(var r=1;r<At.length;r++){var n=At[r];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Ct&&Jt(Ct,e),null!==Et&&Jt(Et,e),null!==Pt&&Jt(Pt,e),_t.forEach(t),Ot.forEach(t),r=0;r<Rt.length;r++)(n=Rt[r]).blockedOn===e&&(n.blockedOn=null);for(;0<Rt.length&&null===(r=Rt[0]).blockedOn;)Ht(r),null===r.blockedOn&&Rt.shift()}var Qt=b.ReactCurrentBatchConfig,Xt=!0;function $t(e,t,r,n){var s=vt,a=Qt.transition;Qt.transition=null;try{vt=1,er(e,t,r,n)}finally{vt=s,Qt.transition=a}}function Zt(e,t,r,n){var s=vt,a=Qt.transition;Qt.transition=null;try{vt=4,er(e,t,r,n)}finally{vt=s,Qt.transition=a}}function er(e,t,r,n){if(Xt){var s=rr(e,t,r,n);if(null===s)Zn(e,t,n,tr,r),Ut(e,n);else if(function(e,t,r,n,s){switch(t){case"focusin":return Ct=zt(Ct,e,t,r,n,s),!0;case"dragenter":return Et=zt(Et,e,t,r,n,s),!0;case"mouseover":return Pt=zt(Pt,e,t,r,n,s),!0;case"pointerover":var a=s.pointerId;return _t.set(a,zt(_t.get(a)||null,e,t,r,n,s)),!0;case"gotpointercapture":return a=s.pointerId,Ot.set(a,zt(Ot.get(a)||null,e,t,r,n,s)),!0}return!1}(s,e,t,r,n))n.stopPropagation();else if(Ut(e,n),4&t&&-1<Ft.indexOf(e)){for(;null!==s;){var a=Es(s);if(null!==a&&bt(a),null===(a=rr(e,t,r,n))&&Zn(e,t,n,tr,r),a===s)break;s=a}null!==s&&n.stopPropagation()}else Zn(e,t,n,null,r)}}var tr=null;function rr(e,t,r,n){if(tr=null,null!==(e=Cs(e=be(n))))if(null===(t=We(e)))e=null;else if(13===(r=t.tag)){if(null!==(e=ze(t)))return e;e=null}else if(3===r){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return tr=e,null}function nr(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case $e:return 1;case Ze:return 4;case et:case tt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var sr=null,ar=null,or=null;function ir(){if(or)return or;var e,t,r=ar,n=r.length,s="value"in sr?sr.value:sr.textContent,a=s.length;for(e=0;e<n&&r[e]===s[e];e++);var o=n-e;for(t=1;t<=o&&r[n-t]===s[a-t];t++);return or=s.slice(e,1<t?1-t:void 0)}function cr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function dr(){return!0}function ur(){return!1}function hr(e){function t(t,r,n,s,a){for(var o in this._reactName=t,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?dr:ur,this.isPropagationStopped=ur,this}return R(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=dr)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=dr)},persist:function(){},isPersistent:dr}),t}var mr,pr,gr,fr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xr=hr(fr),vr=R({},fr,{view:0,detail:0}),yr=hr(vr),br=R({},vr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mr,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==gr&&(gr&&"mousemove"===e.type?(mr=e.screenX-gr.screenX,pr=e.screenY-gr.screenY):pr=mr=0,gr=e),mr)},movementY:function(e){return"movementY"in e?e.movementY:pr}}),wr=hr(br),jr=hr(R({},br,{dataTransfer:0})),Nr=hr(R({},vr,{relatedTarget:0})),kr=hr(R({},fr,{animationName:0,elapsedTime:0,pseudoElement:0})),Ar=R({},fr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Cr=hr(Ar),Er=hr(R({},fr,{data:0})),Pr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ir={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Dr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tr[e])&&!!t[e]}function Mr(){return Dr}var _r=R({},vr,{key:function(e){if(e.key){var t=Pr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=cr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Ir[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mr,charCode:function(e){return"keypress"===e.type?cr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?cr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Or=hr(_r),Lr=hr(R({},br,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rr=hr(R({},vr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mr})),Fr=hr(R({},fr,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ur=R({},br,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Br=hr(Ur),Wr=[9,13,27,32],zr=d&&"CompositionEvent"in window,Vr=null;d&&"documentMode"in document&&(Vr=document.documentMode);var Hr=d&&"TextEvent"in window&&!Vr,qr=d&&(!zr||Vr&&8<Vr&&11>=Vr),Kr=String.fromCharCode(32),Gr=!1;function Jr(e,t){switch(e){case"keyup":return-1!==Wr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Qr=!1;var Xr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $r(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Xr[e.type]:"textarea"===t}function Zr(e,t,r,n){ke(n),0<(t=ts(t,"onChange")).length&&(r=new xr("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var en=null,tn=null;function rn(e){Gn(e,0)}function nn(e){if(G(Ps(e)))return e}function sn(e,t){if("change"===e)return t}var an=!1;if(d){var on;if(d){var ln="oninput"in document;if(!ln){var cn=document.createElement("div");cn.setAttribute("oninput","return;"),ln="function"===typeof cn.oninput}on=ln}else on=!1;an=on&&(!document.documentMode||9<document.documentMode)}function dn(){en&&(en.detachEvent("onpropertychange",un),tn=en=null)}function un(e){if("value"===e.propertyName&&nn(tn)){var t=[];Zr(t,tn,e,be(e)),Ie(rn,t)}}function hn(e,t,r){"focusin"===e?(dn(),tn=r,(en=t).attachEvent("onpropertychange",un)):"focusout"===e&&dn()}function mn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return nn(tn)}function pn(e,t){if("click"===e)return nn(t)}function gn(e,t){if("input"===e||"change"===e)return nn(t)}var fn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function xn(e,t){if(fn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!u.call(t,s)||!fn(e[s],t[s]))return!1}return!0}function vn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function yn(e,t){var r,n=vn(e);for(e=0;n;){if(3===n.nodeType){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=vn(n)}}function bn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?bn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function wn(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var r="string"===typeof t.contentWindow.location.href}catch(Bt){r=!1}if(!r)break;t=J((e=t.contentWindow).document)}return t}function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function Nn(e){var t=wn(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&bn(r.ownerDocument.documentElement,r)){if(null!==n&&jn(r))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if((e=(t=r.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=r.textContent.length,a=Math.min(n.start,s);n=void 0===n.end?a:Math.min(n.end,s),!e.extend&&a>n&&(s=n,n=a,a=s),s=yn(r,a);var o=yn(r,n);s&&o&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),a>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=r;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof r.focus&&r.focus(),r=0;r<t.length;r++)(e=t[r]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Sn=d&&"documentMode"in document&&11>=document.documentMode,kn=null,An=null,Cn=null,En=!1;function Pn(e,t,r){var n=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;En||null==kn||kn!==J(n)||("selectionStart"in(n=kn)&&jn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Cn&&xn(Cn,n)||(Cn=n,0<(n=ts(An,"onSelect")).length&&(t=new xr("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=kn)))}function In(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Tn={animationend:In("Animation","AnimationEnd"),animationiteration:In("Animation","AnimationIteration"),animationstart:In("Animation","AnimationStart"),transitionend:In("Transition","TransitionEnd")},Dn={},Mn={};function _n(e){if(Dn[e])return Dn[e];if(!Tn[e])return e;var t,r=Tn[e];for(t in r)if(r.hasOwnProperty(t)&&t in Mn)return Dn[e]=r[t];return e}d&&(Mn=document.createElement("div").style,"AnimationEvent"in window||(delete Tn.animationend.animation,delete Tn.animationiteration.animation,delete Tn.animationstart.animation),"TransitionEvent"in window||delete Tn.transitionend.transition);var On=_n("animationend"),Ln=_n("animationiteration"),Rn=_n("animationstart"),Fn=_n("transitionend"),Un=new Map,Bn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wn(e,t){Un.set(e,t),l(t,[e])}for(var zn=0;zn<Bn.length;zn++){var Vn=Bn[zn];Wn(Vn.toLowerCase(),"on"+(Vn[0].toUpperCase()+Vn.slice(1)))}Wn(On,"onAnimationEnd"),Wn(Ln,"onAnimationIteration"),Wn(Rn,"onAnimationStart"),Wn("dblclick","onDoubleClick"),Wn("focusin","onFocus"),Wn("focusout","onBlur"),Wn(Fn,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hn));function Kn(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,function(e,t,r,n,s,o,i,l,c){if(Be.apply(this,arguments),Oe){if(!Oe)throw Error(a(198));var d=Le;Oe=!1,Le=null,Re||(Re=!0,Fe=d)}}(n,t,void 0,e),e.currentTarget=null}function Gn(e,t){t=0!==(4&t);for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var a=void 0;if(t)for(var o=n.length-1;0<=o;o--){var i=n[o],l=i.instance,c=i.currentTarget;if(i=i.listener,l!==a&&s.isPropagationStopped())break e;Kn(s,i,c),a=l}else for(o=0;o<n.length;o++){if(l=(i=n[o]).instance,c=i.currentTarget,i=i.listener,l!==a&&s.isPropagationStopped())break e;Kn(s,i,c),a=l}}}if(Re)throw e=Fe,Re=!1,Fe=null,e}function Jn(e,t){var r=t[Ss];void 0===r&&(r=t[Ss]=new Set);var n=e+"__bubble";r.has(n)||($n(t,e,2,!1),r.add(n))}function Yn(e,t,r){var n=0;t&&(n|=4),$n(r,e,n,t)}var Qn="_reactListening"+Math.random().toString(36).slice(2);function Xn(e){if(!e[Qn]){e[Qn]=!0,o.forEach(function(t){"selectionchange"!==t&&(qn.has(t)||Yn(t,!1,e),Yn(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Qn]||(t[Qn]=!0,Yn("selectionchange",!1,t))}}function $n(e,t,r,n){switch(nr(t)){case 1:var s=$t;break;case 4:s=Zt;break;default:s=er}r=s.bind(null,t,r,e),s=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),n?void 0!==s?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):void 0!==s?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function Zn(e,t,r,n,s){var a=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var o=n.tag;if(3===o||4===o){var i=n.stateNode.containerInfo;if(i===s||8===i.nodeType&&i.parentNode===s)break;if(4===o)for(o=n.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;o=o.return}for(;null!==i;){if(null===(o=Cs(i)))return;if(5===(l=o.tag)||6===l){n=a=o;continue e}i=i.parentNode}}n=n.return}Ie(function(){var n=a,s=be(r),o=[];e:{var i=Un.get(e);if(void 0!==i){var l=xr,c=e;switch(e){case"keypress":if(0===cr(r))break e;case"keydown":case"keyup":l=Or;break;case"focusin":c="focus",l=Nr;break;case"focusout":c="blur",l=Nr;break;case"beforeblur":case"afterblur":l=Nr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=wr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=jr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Rr;break;case On:case Ln:case Rn:l=kr;break;case Fn:l=Fr;break;case"scroll":l=yr;break;case"wheel":l=Br;break;case"copy":case"cut":case"paste":l=Cr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Lr}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==i?i+"Capture":null:i;d=[];for(var m,p=n;null!==p;){var g=(m=p).stateNode;if(5===m.tag&&null!==g&&(m=g,null!==h&&(null!=(g=Te(p,h))&&d.push(es(p,g,m)))),u)break;p=p.return}0<d.length&&(i=new l(i,c,null,r,s),o.push({event:i,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(i="mouseover"===e||"pointerover"===e)||r===ye||!(c=r.relatedTarget||r.fromElement)||!Cs(c)&&!c[Ns])&&(l||i)&&(i=s.window===s?s:(i=s.ownerDocument)?i.defaultView||i.parentWindow:window,l?(l=n,null!==(c=(c=r.relatedTarget||r.toElement)?Cs(c):null)&&(c!==(u=We(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(d=wr,g="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(d=Lr,g="onPointerLeave",h="onPointerEnter",p="pointer"),u=null==l?i:Ps(l),m=null==c?i:Ps(c),(i=new d(g,p+"leave",l,r,s)).target=u,i.relatedTarget=m,g=null,Cs(s)===n&&((d=new d(h,p+"enter",c,r,s)).target=m,d.relatedTarget=u,g=d),u=g,l&&c)e:{for(h=c,p=0,m=d=l;m;m=rs(m))p++;for(m=0,g=h;g;g=rs(g))m++;for(;0<p-m;)d=rs(d),p--;for(;0<m-p;)h=rs(h),m--;for(;p--;){if(d===h||null!==h&&d===h.alternate)break e;d=rs(d),h=rs(h)}d=null}else d=null;null!==l&&ns(o,i,l,d,!1),null!==c&&null!==u&&ns(o,u,c,d,!0)}if("select"===(l=(i=n?Ps(n):window).nodeName&&i.nodeName.toLowerCase())||"input"===l&&"file"===i.type)var f=sn;else if($r(i))if(an)f=gn;else{f=mn;var x=hn}else(l=i.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(f=pn);switch(f&&(f=f(e,n))?Zr(o,f,r,s):(x&&x(e,i,n),"focusout"===e&&(x=i._wrapperState)&&x.controlled&&"number"===i.type&&ee(i,"number",i.value)),x=n?Ps(n):window,e){case"focusin":($r(x)||"true"===x.contentEditable)&&(kn=x,An=n,Cn=null);break;case"focusout":Cn=An=kn=null;break;case"mousedown":En=!0;break;case"contextmenu":case"mouseup":case"dragend":En=!1,Pn(o,r,s);break;case"selectionchange":if(Sn)break;case"keydown":case"keyup":Pn(o,r,s)}var v;if(zr)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Qr?Jr(e,r)&&(y="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(y="onCompositionStart");y&&(qr&&"ko"!==r.locale&&(Qr||"onCompositionStart"!==y?"onCompositionEnd"===y&&Qr&&(v=ir()):(ar="value"in(sr=s)?sr.value:sr.textContent,Qr=!0)),0<(x=ts(n,y)).length&&(y=new Er(y,e,null,r,s),o.push({event:y,listeners:x}),v?y.data=v:null!==(v=Yr(r))&&(y.data=v))),(v=Hr?function(e,t){switch(e){case"compositionend":return Yr(t);case"keypress":return 32!==t.which?null:(Gr=!0,Kr);case"textInput":return(e=t.data)===Kr&&Gr?null:e;default:return null}}(e,r):function(e,t){if(Qr)return"compositionend"===e||!zr&&Jr(e,t)?(e=ir(),or=ar=sr=null,Qr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return qr&&"ko"!==t.locale?null:t.data}}(e,r))&&(0<(n=ts(n,"onBeforeInput")).length&&(s=new Er("onBeforeInput","beforeinput",null,r,s),o.push({event:s,listeners:n}),s.data=v))}Gn(o,t)})}function es(e,t,r){return{instance:e,listener:t,currentTarget:r}}function ts(e,t){for(var r=t+"Capture",n=[];null!==e;){var s=e,a=s.stateNode;5===s.tag&&null!==a&&(s=a,null!=(a=Te(e,r))&&n.unshift(es(e,a,s)),null!=(a=Te(e,t))&&n.push(es(e,a,s))),e=e.return}return n}function rs(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function ns(e,t,r,n,s){for(var a=t._reactName,o=[];null!==r&&r!==n;){var i=r,l=i.alternate,c=i.stateNode;if(null!==l&&l===n)break;5===i.tag&&null!==c&&(i=c,s?null!=(l=Te(r,a))&&o.unshift(es(r,l,i)):s||null!=(l=Te(r,a))&&o.push(es(r,l,i))),r=r.return}0!==o.length&&e.push({event:t,listeners:o})}var ss=/\r\n?/g,as=/\u0000|\uFFFD/g;function os(e){return("string"===typeof e?e:""+e).replace(ss,"\n").replace(as,"")}function is(e,t,r){if(t=os(t),os(e)!==t&&r)throw Error(a(425))}function ls(){}var cs=null,ds=null;function us(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var hs="function"===typeof setTimeout?setTimeout:void 0,ms="function"===typeof clearTimeout?clearTimeout:void 0,ps="function"===typeof Promise?Promise:void 0,gs="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ps?function(e){return ps.resolve(null).then(e).catch(fs)}:hs;function fs(e){setTimeout(function(){throw e})}function xs(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&8===s.nodeType)if("/$"===(r=s.data)){if(0===n)return e.removeChild(s),void Yt(t);n--}else"$"!==r&&"$?"!==r&&"$!"!==r||n++;r=s}while(r);Yt(t)}function vs(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ys(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r){if(0===t)return e;t--}else"/$"===r&&t++}e=e.previousSibling}return null}var bs=Math.random().toString(36).slice(2),ws="__reactFiber$"+bs,js="__reactProps$"+bs,Ns="__reactContainer$"+bs,Ss="__reactEvents$"+bs,ks="__reactListeners$"+bs,As="__reactHandles$"+bs;function Cs(e){var t=e[ws];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Ns]||r[ws]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=ys(e);null!==e;){if(r=e[ws])return r;e=ys(e)}return t}r=(e=r).parentNode}return null}function Es(e){return!(e=e[ws]||e[Ns])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ps(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function Is(e){return e[js]||null}var Ts=[],Ds=-1;function Ms(e){return{current:e}}function _s(e){0>Ds||(e.current=Ts[Ds],Ts[Ds]=null,Ds--)}function Os(e,t){Ds++,Ts[Ds]=e.current,e.current=t}var Ls={},Rs=Ms(Ls),Fs=Ms(!1),Us=Ls;function Bs(e,t){var r=e.type.contextTypes;if(!r)return Ls;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s,a={};for(s in r)a[s]=t[s];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ws(e){return null!==(e=e.childContextTypes)&&void 0!==e}function zs(){_s(Fs),_s(Rs)}function Vs(e,t,r){if(Rs.current!==Ls)throw Error(a(168));Os(Rs,t),Os(Fs,r)}function Hs(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return r;for(var s in n=n.getChildContext())if(!(s in t))throw Error(a(108,V(e)||"Unknown",s));return R({},r,n)}function qs(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ls,Us=Rs.current,Os(Rs,e),Os(Fs,Fs.current),!0}function Ks(e,t,r){var n=e.stateNode;if(!n)throw Error(a(169));r?(e=Hs(e,t,Us),n.__reactInternalMemoizedMergedChildContext=e,_s(Fs),_s(Rs),Os(Rs,e)):_s(Fs),Os(Fs,r)}var Gs=null,Js=!1,Ys=!1;function Qs(e){null===Gs?Gs=[e]:Gs.push(e)}function Xs(){if(!Ys&&null!==Gs){Ys=!0;var e=0,t=vt;try{var r=Gs;for(vt=1;e<r.length;e++){var n=r[e];do{n=n(!0)}while(null!==n)}Gs=null,Js=!1}catch(It){throw null!==Gs&&(Gs=Gs.slice(e+1)),Ke($e,Xs),It}finally{vt=t,Ys=!1}}return null}var $s=[],Zs=0,ea=null,ta=0,ra=[],na=0,sa=null,aa=1,oa="";function ia(e,t){$s[Zs++]=ta,$s[Zs++]=ea,ea=e,ta=t}function la(e,t,r){ra[na++]=aa,ra[na++]=oa,ra[na++]=sa,sa=e;var n=aa;e=oa;var s=32-at(n)-1;n&=~(1<<s),r+=1;var a=32-at(t)+s;if(30<a){var o=s-s%5;a=(n&(1<<o)-1).toString(32),n>>=o,s-=o,aa=1<<32-at(t)+s|r<<s|n,oa=a+e}else aa=1<<a|r<<s|n,oa=e}function ca(e){null!==e.return&&(ia(e,1),la(e,1,0))}function da(e){for(;e===ea;)ea=$s[--Zs],$s[Zs]=null,ta=$s[--Zs],$s[Zs]=null;for(;e===sa;)sa=ra[--na],ra[na]=null,oa=ra[--na],ra[na]=null,aa=ra[--na],ra[na]=null}var ua=null,ha=null,ma=!1,pa=null;function ga(e,t){var r=Bc(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,null===(t=e.deletions)?(e.deletions=[r],e.flags|=16):t.push(r)}function fa(e,t){switch(e.tag){case 5:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ua=e,ha=vs(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ua=e,ha=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(r=null!==sa?{id:aa,overflow:oa}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},(r=Bc(18,null,null,0)).stateNode=t,r.return=e,e.child=r,ua=e,ha=null,!0);default:return!1}}function xa(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function va(e){if(ma){var t=ha;if(t){var r=t;if(!fa(e,t)){if(xa(e))throw Error(a(418));t=vs(r.nextSibling);var n=ua;t&&fa(e,t)?ga(n,r):(e.flags=-4097&e.flags|2,ma=!1,ua=e)}}else{if(xa(e))throw Error(a(418));e.flags=-4097&e.flags|2,ma=!1,ua=e}}}function ya(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ua=e}function ba(e){if(e!==ua)return!1;if(!ma)return ya(e),ma=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!us(e.type,e.memoizedProps)),t&&(t=ha)){if(xa(e))throw wa(),Error(a(418));for(;t;)ga(e,t),t=vs(t.nextSibling)}if(ya(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r){if(0===t){ha=vs(e.nextSibling);break e}t--}else"$"!==r&&"$!"!==r&&"$?"!==r||t++}e=e.nextSibling}ha=null}}else ha=ua?vs(e.stateNode.nextSibling):null;return!0}function wa(){for(var e=ha;e;)e=vs(e.nextSibling)}function ja(){ha=ua=null,ma=!1}function Na(e){null===pa?pa=[e]:pa.push(e)}var Sa=b.ReactCurrentBatchConfig;function ka(e,t,r){if(null!==(e=r.ref)&&"function"!==typeof e&&"object"!==typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(a(309));var n=r.stateNode}if(!n)throw Error(a(147,e));var s=n,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=s.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!r._owner)throw Error(a(290,e))}return e}function Aa(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ca(e){return(0,e._init)(e._payload)}function Ea(e){function t(t,r){if(e){var n=t.deletions;null===n?(t.deletions=[r],t.flags|=16):n.push(r)}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=zc(e,t)).index=0,e.sibling=null,e}function o(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.flags|=2,r):n:(t.flags|=2,r):(t.flags|=1048576,r)}function i(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,r,n){return null===t||6!==t.tag?((t=Kc(r,e.mode,n)).return=e,t):((t=s(t,r)).return=e,t)}function c(e,t,r,n){var a=r.type;return a===N?u(e,t,r.props.children,n,r.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===D&&Ca(a)===t.type)?((n=s(t,r.props)).ref=ka(e,t,r),n.return=e,n):((n=Vc(r.type,r.key,r.props,null,e.mode,n)).ref=ka(e,t,r),n.return=e,n)}function d(e,t,r,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Gc(r,e.mode,n)).return=e,t):((t=s(t,r.children||[])).return=e,t)}function u(e,t,r,n,a){return null===t||7!==t.tag?((t=Hc(r,e.mode,n,a)).return=e,t):((t=s(t,r)).return=e,t)}function h(e,t,r){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Kc(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(r=Vc(t.type,t.key,t.props,null,e.mode,r)).ref=ka(e,null,t),r.return=e,r;case j:return(t=Gc(t,e.mode,r)).return=e,t;case D:return h(e,(0,t._init)(t._payload),r)}if(te(t)||O(t))return(t=Hc(t,e.mode,r,null)).return=e,t;Aa(e,t)}return null}function m(e,t,r,n){var s=null!==t?t.key:null;if("string"===typeof r&&""!==r||"number"===typeof r)return null!==s?null:l(e,t,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return r.key===s?c(e,t,r,n):null;case j:return r.key===s?d(e,t,r,n):null;case D:return m(e,t,(s=r._init)(r._payload),n)}if(te(r)||O(r))return null!==s?null:u(e,t,r,n,null);Aa(e,r)}return null}function p(e,t,r,n,s){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(r)||null,""+n,s);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return c(t,e=e.get(null===n.key?r:n.key)||null,n,s);case j:return d(t,e=e.get(null===n.key?r:n.key)||null,n,s);case D:return p(e,t,r,(0,n._init)(n._payload),s)}if(te(n)||O(n))return u(t,e=e.get(r)||null,n,s,null);Aa(t,n)}return null}function g(s,a,i,l){for(var c=null,d=null,u=a,g=a=0,f=null;null!==u&&g<i.length;g++){u.index>g?(f=u,u=null):f=u.sibling;var x=m(s,u,i[g],l);if(null===x){null===u&&(u=f);break}e&&u&&null===x.alternate&&t(s,u),a=o(x,a,g),null===d?c=x:d.sibling=x,d=x,u=f}if(g===i.length)return r(s,u),ma&&ia(s,g),c;if(null===u){for(;g<i.length;g++)null!==(u=h(s,i[g],l))&&(a=o(u,a,g),null===d?c=u:d.sibling=u,d=u);return ma&&ia(s,g),c}for(u=n(s,u);g<i.length;g++)null!==(f=p(u,s,g,i[g],l))&&(e&&null!==f.alternate&&u.delete(null===f.key?g:f.key),a=o(f,a,g),null===d?c=f:d.sibling=f,d=f);return e&&u.forEach(function(e){return t(s,e)}),ma&&ia(s,g),c}function f(s,i,l,c){var d=O(l);if("function"!==typeof d)throw Error(a(150));if(null==(l=d.call(l)))throw Error(a(151));for(var u=d=null,g=i,f=i=0,x=null,v=l.next();null!==g&&!v.done;f++,v=l.next()){g.index>f?(x=g,g=null):x=g.sibling;var y=m(s,g,v.value,c);if(null===y){null===g&&(g=x);break}e&&g&&null===y.alternate&&t(s,g),i=o(y,i,f),null===u?d=y:u.sibling=y,u=y,g=x}if(v.done)return r(s,g),ma&&ia(s,f),d;if(null===g){for(;!v.done;f++,v=l.next())null!==(v=h(s,v.value,c))&&(i=o(v,i,f),null===u?d=v:u.sibling=v,u=v);return ma&&ia(s,f),d}for(g=n(s,g);!v.done;f++,v=l.next())null!==(v=p(g,s,f,v.value,c))&&(e&&null!==v.alternate&&g.delete(null===v.key?f:v.key),i=o(v,i,f),null===u?d=v:u.sibling=v,u=v);return e&&g.forEach(function(e){return t(s,e)}),ma&&ia(s,f),d}return function e(n,a,o,l){if("object"===typeof o&&null!==o&&o.type===N&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var c=o.key,d=a;null!==d;){if(d.key===c){if((c=o.type)===N){if(7===d.tag){r(n,d.sibling),(a=s(d,o.props.children)).return=n,n=a;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&Ca(c)===d.type){r(n,d.sibling),(a=s(d,o.props)).ref=ka(n,d,o),a.return=n,n=a;break e}r(n,d);break}t(n,d),d=d.sibling}o.type===N?((a=Hc(o.props.children,n.mode,l,o.key)).return=n,n=a):((l=Vc(o.type,o.key,o.props,null,n.mode,l)).ref=ka(n,a,o),l.return=n,n=l)}return i(n);case j:e:{for(d=o.key;null!==a;){if(a.key===d){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){r(n,a.sibling),(a=s(a,o.children||[])).return=n,n=a;break e}r(n,a);break}t(n,a),a=a.sibling}(a=Gc(o,n.mode,l)).return=n,n=a}return i(n);case D:return e(n,a,(d=o._init)(o._payload),l)}if(te(o))return g(n,a,o,l);if(O(o))return f(n,a,o,l);Aa(n,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(r(n,a.sibling),(a=s(a,o)).return=n,n=a):(r(n,a),(a=Kc(o,n.mode,l)).return=n,n=a),i(n)):r(n,a)}}var Pa=Ea(!0),Ia=Ea(!1),Ta=Ms(null),Da=null,Ma=null,_a=null;function Oa(){_a=Ma=Da=null}function La(e){var t=Ta.current;_s(Ta),e._currentValue=t}function Ra(e,t,r){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Fa(e,t){Da=e,_a=Ma=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ei=!0),e.firstContext=null)}function Ua(e){var t=e._currentValue;if(_a!==e)if(e={context:e,memoizedValue:t,next:null},null===Ma){if(null===Da)throw Error(a(308));Ma=e,Da.dependencies={lanes:0,firstContext:e}}else Ma=Ma.next=e;return t}var Ba=null;function Wa(e){null===Ba?Ba=[e]:Ba.push(e)}function za(e,t,r,n){var s=t.interleaved;return null===s?(r.next=r,Wa(t)):(r.next=s.next,s.next=r),t.interleaved=r,Va(e,n)}function Va(e,t){e.lanes|=t;var r=e.alternate;for(null!==r&&(r.lanes|=t),r=e,e=e.return;null!==e;)e.childLanes|=t,null!==(r=e.alternate)&&(r.childLanes|=t),r=e,e=e.return;return 3===r.tag?r.stateNode:null}var Ha=!1;function qa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ka(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ga(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ja(e,t,r){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Rl)){var s=n.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),n.pending=t,Va(e,r)}return null===(s=n.interleaved)?(t.next=t,Wa(n)):(t.next=s.next,s.next=t),n.interleaved=t,Va(e,r)}function Ya(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&r))){var n=t.lanes;r|=n&=e.pendingLanes,t.lanes=r,xt(e,r)}}function Qa(e,t){var r=e.updateQueue,n=e.alternate;if(null!==n&&r===(n=n.updateQueue)){var s=null,a=null;if(null!==(r=r.firstBaseUpdate)){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===a?s=a=o:a=a.next=o,r=r.next}while(null!==r);null===a?s=a=t:a=a.next=t}else s=a=t;return r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:n.shared,effects:n.effects},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Xa(e,t,r,n){var s=e.updateQueue;Ha=!1;var a=s.firstBaseUpdate,o=s.lastBaseUpdate,i=s.shared.pending;if(null!==i){s.shared.pending=null;var l=i,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var d=e.alternate;null!==d&&((i=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===i?d.firstBaseUpdate=c:i.next=c,d.lastBaseUpdate=l))}if(null!==a){var u=s.baseState;for(o=0,d=c=l=null,i=a;;){var h=i.lane,m=i.eventTime;if((n&h)===h){null!==d&&(d=d.next={eventTime:m,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var p=e,g=i;switch(h=t,m=r,g.tag){case 1:if("function"===typeof(p=g.payload)){u=p.call(m,u,h);break e}u=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=g.payload)?p.call(m,u,h):p)||void 0===h)break e;u=R({},u,h);break e;case 2:Ha=!0}}null!==i.callback&&0!==i.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[i]:h.push(i))}else m={eventTime:m,lane:h,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===d?(c=d=m,l=u):d=d.next=m,o|=h;if(null===(i=i.next)){if(null===(i=s.shared.pending))break;i=(h=i).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===d&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,null!==(t=s.shared.interleaved)){s=t;do{o|=s.lane,s=s.next}while(s!==t)}else null===a&&(s.shared.lanes=0);ql|=o,e.lanes=o,e.memoizedState=u}}function $a(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(null!==s){if(n.callback=null,n=r,"function"!==typeof s)throw Error(a(191,s));s.call(n)}}}var Za={},eo=Ms(Za),to=Ms(Za),ro=Ms(Za);function no(e){if(e===Za)throw Error(a(174));return e}function so(e,t){switch(Os(ro,t),Os(to,e),Os(eo,Za),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}_s(eo),Os(eo,t)}function ao(){_s(eo),_s(to),_s(ro)}function oo(e){no(ro.current);var t=no(eo.current),r=le(t,e.type);t!==r&&(Os(to,e),Os(eo,r))}function io(e){to.current===e&&(_s(eo),_s(to))}var lo=Ms(0);function co(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var uo=[];function ho(){for(var e=0;e<uo.length;e++)uo[e]._workInProgressVersionPrimary=null;uo.length=0}var mo=b.ReactCurrentDispatcher,po=b.ReactCurrentBatchConfig,go=0,fo=null,xo=null,vo=null,yo=!1,bo=!1,wo=0,jo=0;function No(){throw Error(a(321))}function So(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!fn(e[r],t[r]))return!1;return!0}function ko(e,t,r,n,s,o){if(go=o,fo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,mo.current=null===e||null===e.memoizedState?li:ci,e=r(n,s),bo){o=0;do{if(bo=!1,wo=0,25<=o)throw Error(a(301));o+=1,vo=xo=null,t.updateQueue=null,mo.current=di,e=r(n,s)}while(bo)}if(mo.current=ii,t=null!==xo&&null!==xo.next,go=0,vo=xo=fo=null,yo=!1,t)throw Error(a(300));return e}function Ao(){var e=0!==wo;return wo=0,e}function Co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===vo?fo.memoizedState=vo=e:vo=vo.next=e,vo}function Eo(){if(null===xo){var e=fo.alternate;e=null!==e?e.memoizedState:null}else e=xo.next;var t=null===vo?fo.memoizedState:vo.next;if(null!==t)vo=t,xo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(xo=e).memoizedState,baseState:xo.baseState,baseQueue:xo.baseQueue,queue:xo.queue,next:null},null===vo?fo.memoizedState=vo=e:vo=vo.next=e}return vo}function Po(e,t){return"function"===typeof t?t(e):t}function Io(e){var t=Eo(),r=t.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=e;var n=xo,s=n.baseQueue,o=r.pending;if(null!==o){if(null!==s){var i=s.next;s.next=o.next,o.next=i}n.baseQueue=s=o,r.pending=null}if(null!==s){o=s.next,n=n.baseState;var l=i=null,c=null,d=o;do{var u=d.lane;if((go&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,i=n):c=c.next=h,fo.lanes|=u,ql|=u}d=d.next}while(null!==d&&d!==o);null===c?i=n:c.next=l,fn(n,t.memoizedState)||(Ei=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=c,r.lastRenderedState=n}if(null!==(e=r.interleaved)){s=e;do{o=s.lane,fo.lanes|=o,ql|=o,s=s.next}while(s!==e)}else null===s&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function To(e){var t=Eo(),r=t.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,o=t.memoizedState;if(null!==s){r.pending=null;var i=s=s.next;do{o=e(o,i.action),i=i.next}while(i!==s);fn(o,t.memoizedState)||(Ei=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function Do(){}function Mo(e,t){var r=fo,n=Eo(),s=t(),o=!fn(n.memoizedState,s);if(o&&(n.memoizedState=s,Ei=!0),n=n.queue,qo(Lo.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||null!==vo&&1&vo.memoizedState.tag){if(r.flags|=2048,Bo(9,Oo.bind(null,r,n,s,t),void 0,null),null===Fl)throw Error(a(349));0!==(30&go)||_o(r,t,s)}return s}function _o(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=fo.updateQueue)?(t={lastEffect:null,stores:null},fo.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function Oo(e,t,r,n){t.value=r,t.getSnapshot=n,Ro(t)&&Fo(e)}function Lo(e,t,r){return r(function(){Ro(t)&&Fo(e)})}function Ro(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!fn(e,r)}catch(Bt){return!0}}function Fo(e){var t=Va(e,1);null!==t&&uc(t,e,1,-1)}function Uo(e){var t=Co();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Po,lastRenderedState:e},t.queue=e,e=e.dispatch=ni.bind(null,fo,e),[t.memoizedState,e]}function Bo(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},null===(t=fo.updateQueue)?(t={lastEffect:null,stores:null},fo.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e),e}function Wo(){return Eo().memoizedState}function zo(e,t,r,n){var s=Co();fo.flags|=e,s.memoizedState=Bo(1|t,r,void 0,void 0===n?null:n)}function Vo(e,t,r,n){var s=Eo();n=void 0===n?null:n;var a=void 0;if(null!==xo){var o=xo.memoizedState;if(a=o.destroy,null!==n&&So(n,o.deps))return void(s.memoizedState=Bo(t,r,a,n))}fo.flags|=e,s.memoizedState=Bo(1|t,r,a,n)}function Ho(e,t){return zo(8390656,8,e,t)}function qo(e,t){return Vo(2048,8,e,t)}function Ko(e,t){return Vo(4,2,e,t)}function Go(e,t){return Vo(4,4,e,t)}function Jo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Yo(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Vo(4,4,Jo.bind(null,t,e),r)}function Qo(){}function Xo(e,t){var r=Eo();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&So(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function $o(e,t){var r=Eo();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&So(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function Zo(e,t,r){return 0===(21&go)?(e.baseState&&(e.baseState=!1,Ei=!0),e.memoizedState=r):(fn(r,t)||(r=pt(),fo.lanes|=r,ql|=r,e.baseState=!0),t)}function ei(e,t){var r=vt;vt=0!==r&&4>r?r:4,e(!0);var n=po.transition;po.transition={};try{e(!1),t()}finally{vt=r,po.transition=n}}function ti(){return Eo().memoizedState}function ri(e,t,r){var n=dc(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},si(e))ai(t,r);else if(null!==(r=za(e,t,r,n))){uc(r,e,n,cc()),oi(r,t,n)}}function ni(e,t,r){var n=dc(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(si(e))ai(t,s);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,i=a(o,r);if(s.hasEagerState=!0,s.eagerState=i,fn(i,o)){var l=t.interleaved;return null===l?(s.next=s,Wa(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(Dt){}null!==(r=za(e,t,s,n))&&(uc(r,e,n,s=cc()),oi(r,t,n))}}function si(e){var t=e.alternate;return e===fo||null!==t&&t===fo}function ai(e,t){bo=yo=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function oi(e,t,r){if(0!==(4194240&r)){var n=t.lanes;r|=n&=e.pendingLanes,t.lanes=r,xt(e,r)}}var ii={readContext:Ua,useCallback:No,useContext:No,useEffect:No,useImperativeHandle:No,useInsertionEffect:No,useLayoutEffect:No,useMemo:No,useReducer:No,useRef:No,useState:No,useDebugValue:No,useDeferredValue:No,useTransition:No,useMutableSource:No,useSyncExternalStore:No,useId:No,unstable_isNewReconciler:!1},li={readContext:Ua,useCallback:function(e,t){return Co().memoizedState=[e,void 0===t?null:t],e},useContext:Ua,useEffect:Ho,useImperativeHandle:function(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,zo(4194308,4,Jo.bind(null,t,e),r)},useLayoutEffect:function(e,t){return zo(4194308,4,e,t)},useInsertionEffect:function(e,t){return zo(4,2,e,t)},useMemo:function(e,t){var r=Co();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Co();return t=void 0!==r?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=ri.bind(null,fo,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},Co().memoizedState=e},useState:Uo,useDebugValue:Qo,useDeferredValue:function(e){return Co().memoizedState=e},useTransition:function(){var e=Uo(!1),t=e[0];return e=ei.bind(null,e[1]),Co().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=fo,s=Co();if(ma){if(void 0===r)throw Error(a(407));r=r()}else{if(r=t(),null===Fl)throw Error(a(349));0!==(30&go)||_o(n,t,r)}s.memoizedState=r;var o={value:r,getSnapshot:t};return s.queue=o,Ho(Lo.bind(null,n,o,e),[e]),n.flags|=2048,Bo(9,Oo.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=Co(),t=Fl.identifierPrefix;if(ma){var r=oa;t=":"+t+"R"+(r=(aa&~(1<<32-at(aa)-1)).toString(32)+r),0<(r=wo++)&&(t+="H"+r.toString(32)),t+=":"}else t=":"+t+"r"+(r=jo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ci={readContext:Ua,useCallback:Xo,useContext:Ua,useEffect:qo,useImperativeHandle:Yo,useInsertionEffect:Ko,useLayoutEffect:Go,useMemo:$o,useReducer:Io,useRef:Wo,useState:function(){return Io(Po)},useDebugValue:Qo,useDeferredValue:function(e){return Zo(Eo(),xo.memoizedState,e)},useTransition:function(){return[Io(Po)[0],Eo().memoizedState]},useMutableSource:Do,useSyncExternalStore:Mo,useId:ti,unstable_isNewReconciler:!1},di={readContext:Ua,useCallback:Xo,useContext:Ua,useEffect:qo,useImperativeHandle:Yo,useInsertionEffect:Ko,useLayoutEffect:Go,useMemo:$o,useReducer:To,useRef:Wo,useState:function(){return To(Po)},useDebugValue:Qo,useDeferredValue:function(e){var t=Eo();return null===xo?t.memoizedState=e:Zo(t,xo.memoizedState,e)},useTransition:function(){return[To(Po)[0],Eo().memoizedState]},useMutableSource:Do,useSyncExternalStore:Mo,useId:ti,unstable_isNewReconciler:!1};function ui(e,t){if(e&&e.defaultProps){for(var r in t=R({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}return t}function hi(e,t,r,n){r=null===(r=r(n,t=e.memoizedState))||void 0===r?t:R({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}var mi={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=cc(),s=dc(e),a=Ga(n,s);a.payload=t,void 0!==r&&null!==r&&(a.callback=r),null!==(t=Ja(e,a,s))&&(uc(t,e,s,n),Ya(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=cc(),s=dc(e),a=Ga(n,s);a.tag=1,a.payload=t,void 0!==r&&null!==r&&(a.callback=r),null!==(t=Ja(e,a,s))&&(uc(t,e,s,n),Ya(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=cc(),n=dc(e),s=Ga(r,n);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Ja(e,s,n))&&(uc(t,e,n,r),Ya(t,e,n))}};function pi(e,t,r,n,s,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!xn(r,n)||!xn(s,a))}function gi(e,t,r){var n=!1,s=Ls,a=t.contextType;return"object"===typeof a&&null!==a?a=Ua(a):(s=Ws(t)?Us:Rs.current,a=(n=null!==(n=t.contextTypes)&&void 0!==n)?Bs(e,s):Ls),t=new t(r,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=mi,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=a),t}function fi(e,t,r,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&mi.enqueueReplaceState(t,t.state,null)}function xi(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},qa(e);var a=t.contextType;"object"===typeof a&&null!==a?s.context=Ua(a):(a=Ws(t)?Us:Rs.current,s.context=Bs(e,a)),s.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(hi(e,t,a,r),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&mi.enqueueReplaceState(s,s.state,null),Xa(e,r,s,n),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function vi(e,t){try{var r="",n=t;do{r+=W(n),n=n.return}while(n);var s=r}catch(Wt){s="\nError generating stack: "+Wt.message+"\n"+Wt.stack}return{value:e,source:t,stack:s,digest:null}}function yi(e,t,r){return{value:e,source:null,stack:null!=r?r:null,digest:null!=t?t:null}}function bi(e,t){try{console.error(t.value)}catch(Lt){setTimeout(function(){throw Lt})}}var wi="function"===typeof WeakMap?WeakMap:Map;function ji(e,t,r){(r=Ga(-1,r)).tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Zl||(Zl=!0,ec=n),bi(0,t)},r}function Ni(e,t,r){(r=Ga(-1,r)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){bi(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(r.callback=function(){bi(0,t),"function"!==typeof n&&(null===tc?tc=new Set([this]):tc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),r}function Si(e,t,r){var n=e.pingCache;if(null===n){n=e.pingCache=new wi;var s=new Set;n.set(t,s)}else void 0===(s=n.get(t))&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=_c.bind(null,e,t,r),t.then(e,e))}function ki(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ai(e,t,r,n,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,1===r.tag&&(null===r.alternate?r.tag=17:((t=Ga(-1,1)).tag=2,Ja(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var Ci=b.ReactCurrentOwner,Ei=!1;function Pi(e,t,r,n){t.child=null===e?Ia(t,null,r,n):Pa(t,e.child,r,n)}function Ii(e,t,r,n,s){r=r.render;var a=t.ref;return Fa(t,s),n=ko(e,t,r,n,a,s),r=Ao(),null===e||Ei?(ma&&r&&ca(t),t.flags|=1,Pi(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Zi(e,t,s))}function Ti(e,t,r,n,s){if(null===e){var a=r.type;return"function"!==typeof a||Wc(a)||void 0!==a.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=Vc(r.type,null,n,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Di(e,t,a,n,s))}if(a=e.child,0===(e.lanes&s)){var o=a.memoizedProps;if((r=null!==(r=r.compare)?r:xn)(o,n)&&e.ref===t.ref)return Zi(e,t,s)}return t.flags|=1,(e=zc(a,n)).ref=t.ref,e.return=t,t.child=e}function Di(e,t,r,n,s){if(null!==e){var a=e.memoizedProps;if(xn(a,n)&&e.ref===t.ref){if(Ei=!1,t.pendingProps=n=a,0===(e.lanes&s))return t.lanes=e.lanes,Zi(e,t,s);0!==(131072&e.flags)&&(Ei=!0)}}return Oi(e,t,r,n,s)}function Mi(e,t,r){var n=t.pendingProps,s=n.children,a=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Os(zl,Wl),Wl|=r;else{if(0===(1073741824&r))return e=null!==a?a.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Os(zl,Wl),Wl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==a?a.baseLanes:r,Os(zl,Wl),Wl|=n}else null!==a?(n=a.baseLanes|r,t.memoizedState=null):n=r,Os(zl,Wl),Wl|=n;return Pi(e,t,s,r),t.child}function _i(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Oi(e,t,r,n,s){var a=Ws(r)?Us:Rs.current;return a=Bs(t,a),Fa(t,s),r=ko(e,t,r,n,a,s),n=Ao(),null===e||Ei?(ma&&n&&ca(t),t.flags|=1,Pi(e,t,r,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Zi(e,t,s))}function Li(e,t,r,n,s){if(Ws(r)){var a=!0;qs(t)}else a=!1;if(Fa(t,s),null===t.stateNode)$i(e,t),gi(t,r,n),xi(t,r,n,s),n=!0;else if(null===e){var o=t.stateNode,i=t.memoizedProps;o.props=i;var l=o.context,c=r.contextType;"object"===typeof c&&null!==c?c=Ua(c):c=Bs(t,c=Ws(r)?Us:Rs.current);var d=r.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate;u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(i!==n||l!==c)&&fi(t,o,n,c),Ha=!1;var h=t.memoizedState;o.state=h,Xa(t,n,o,s),l=t.memoizedState,i!==n||h!==l||Fs.current||Ha?("function"===typeof d&&(hi(t,r,d,n),l=t.memoizedState),(i=Ha||pi(t,r,i,n,h,l,c))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),o.props=n,o.state=l,o.context=c,n=i):("function"===typeof o.componentDidMount&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,Ka(e,t),i=t.memoizedProps,c=t.type===t.elementType?i:ui(t.type,i),o.props=c,u=t.pendingProps,h=o.context,"object"===typeof(l=r.contextType)&&null!==l?l=Ua(l):l=Bs(t,l=Ws(r)?Us:Rs.current);var m=r.getDerivedStateFromProps;(d="function"===typeof m||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(i!==u||h!==l)&&fi(t,o,n,l),Ha=!1,h=t.memoizedState,o.state=h,Xa(t,n,o,s);var p=t.memoizedState;i!==u||h!==p||Fs.current||Ha?("function"===typeof m&&(hi(t,r,m,n),p=t.memoizedState),(c=Ha||pi(t,r,c,n,h,p,l)||!1)?(d||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(n,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(n,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=p),o.props=n,o.state=p,o.context=l,n=c):("function"!==typeof o.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return Ri(e,t,r,n,a,s)}function Ri(e,t,r,n,s,a){_i(e,t);var o=0!==(128&t.flags);if(!n&&!o)return s&&Ks(t,r,!1),Zi(e,t,a);n=t.stateNode,Ci.current=t;var i=o&&"function"!==typeof r.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&o?(t.child=Pa(t,e.child,null,a),t.child=Pa(t,null,i,a)):Pi(e,t,i,a),t.memoizedState=n.state,s&&Ks(t,r,!0),t.child}function Fi(e){var t=e.stateNode;t.pendingContext?Vs(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Vs(0,t.context,!1),so(e,t.containerInfo)}function Ui(e,t,r,n,s){return ja(),Na(s),t.flags|=256,Pi(e,t,r,n),t.child}var Bi,Wi,zi,Vi,Hi={dehydrated:null,treeContext:null,retryLane:0};function qi(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ki(e,t,r){var n,s=t.pendingProps,o=lo.current,i=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&o)),n?(i=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Os(lo,1&o),null===e)return va(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,i?(s=t.mode,i=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==i?(i.childLanes=0,i.pendingProps=l):i=qc(l,s,0,null),e=Hc(e,s,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=qi(r),t.memoizedState=Hi,e):Gi(t,l));if(null!==(o=e.memoizedState)&&null!==(n=o.dehydrated))return function(e,t,r,n,s,o,i){if(r)return 256&t.flags?(t.flags&=-257,Ji(e,t,i,n=yi(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=n.fallback,s=t.mode,n=qc({mode:"visible",children:n.children},s,0,null),(o=Hc(o,s,i,null)).flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,0!==(1&t.mode)&&Pa(t,e.child,null,i),t.child.memoizedState=qi(i),t.memoizedState=Hi,o);if(0===(1&t.mode))return Ji(e,t,i,null);if("$!"===s.data){if(n=s.nextSibling&&s.nextSibling.dataset)var l=n.dgst;return n=l,Ji(e,t,i,n=yi(o=Error(a(419)),n,void 0))}if(l=0!==(i&e.childLanes),Ei||l){if(null!==(n=Fl)){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(n.suspendedLanes|i))?0:s)&&s!==o.retryLane&&(o.retryLane=s,Va(e,s),uc(n,e,s,-1))}return Sc(),Ji(e,t,i,n=yi(Error(a(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Lc.bind(null,e),s._reactRetry=t,null):(e=o.treeContext,ha=vs(s.nextSibling),ua=t,ma=!0,pa=null,null!==e&&(ra[na++]=aa,ra[na++]=oa,ra[na++]=sa,aa=e.id,oa=e.overflow,sa=t),t=Gi(t,n.children),t.flags|=4096,t)}(e,t,l,s,n,o,r);if(i){i=s.fallback,l=t.mode,n=(o=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==o?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=zc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==n?i=zc(n,i):(i=Hc(i,l,r,null)).flags|=2,i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,l=null===(l=e.child.memoizedState)?qi(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=e.childLanes&~r,t.memoizedState=Hi,s}return e=(i=e.child).sibling,s=zc(i,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=r),s.return=t,s.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=s,t.memoizedState=null,s}function Gi(e,t){return(t=qc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ji(e,t,r,n){return null!==n&&Na(n),Pa(t,e.child,null,r),(e=Gi(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Yi(e,t,r){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Ra(e.return,t,r)}function Qi(e,t,r,n,s){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=r,a.tailMode=s)}function Xi(e,t,r){var n=t.pendingProps,s=n.revealOrder,a=n.tail;if(Pi(e,t,n.children,r),0!==(2&(n=lo.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Yi(e,r,t);else if(19===e.tag)Yi(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Os(lo,n),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;null!==r;)null!==(e=r.alternate)&&null===co(e)&&(s=r),r=r.sibling;null===(r=s)?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),Qi(t,!1,s,r,a);break;case"backwards":for(r=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===co(e)){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}Qi(t,!0,r,null,a);break;case"together":Qi(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function $i(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Zi(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),ql|=t.lanes,0===(r&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(r=zc(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=zc(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function el(e,t){if(!ma)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function tl(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;null!==s;)r|=s.lanes|s.childLanes,n|=14680064&s.subtreeFlags,n|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function rl(e,t,r){var n=t.pendingProps;switch(da(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tl(t),null;case 1:case 17:return Ws(t.type)&&zs(),tl(t),null;case 3:return n=t.stateNode,ao(),_s(Fs),_s(Rs),ho(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ba(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==pa&&(gc(pa),pa=null))),Wi(e,t),tl(t),null;case 5:io(t);var s=no(ro.current);if(r=t.type,null!==e&&null!=t.stateNode)zi(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(a(166));return tl(t),null}if(e=no(eo.current),ba(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[ws]=t,n[js]=o,e=0!==(1&t.mode),r){case"dialog":Jn("cancel",n),Jn("close",n);break;case"iframe":case"object":case"embed":Jn("load",n);break;case"video":case"audio":for(s=0;s<Hn.length;s++)Jn(Hn[s],n);break;case"source":Jn("error",n);break;case"img":case"image":case"link":Jn("error",n),Jn("load",n);break;case"details":Jn("toggle",n);break;case"input":Q(n,o),Jn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Jn("invalid",n);break;case"textarea":se(n,o),Jn("invalid",n)}for(var l in xe(r,o),s=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==o.suppressHydrationWarning&&is(n.textContent,c,e),s=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&is(n.textContent,c,e),s=["children",""+c]):i.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Jn("scroll",n)}switch(r){case"input":K(n),Z(n,o,!0);break;case"textarea":K(n),oe(n);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(n.onclick=ls)}n=s,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ie(r)),"http://www.w3.org/1999/xhtml"===e?"script"===r?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(r,{is:n.is}):(e=l.createElement(r),"select"===r&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,r),e[ws]=t,e[js]=n,Bi(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(r,n),r){case"dialog":Jn("cancel",e),Jn("close",e),s=n;break;case"iframe":case"object":case"embed":Jn("load",e),s=n;break;case"video":case"audio":for(s=0;s<Hn.length;s++)Jn(Hn[s],e);s=n;break;case"source":Jn("error",e),s=n;break;case"img":case"image":case"link":Jn("error",e),Jn("load",e),s=n;break;case"details":Jn("toggle",e),s=n;break;case"input":Q(e,n),s=Y(e,n),Jn("invalid",e);break;case"option":default:s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=R({},n,{value:void 0}),Jn("invalid",e);break;case"textarea":se(e,n),s=ne(e,n),Jn("invalid",e)}for(o in xe(r,s),c=s)if(c.hasOwnProperty(o)){var d=c[o];"style"===o?ge(e,d):"dangerouslySetInnerHTML"===o?null!=(d=d?d.__html:void 0)&&de(e,d):"children"===o?"string"===typeof d?("textarea"!==r||""!==d)&&ue(e,d):"number"===typeof d&&ue(e,""+d):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(i.hasOwnProperty(o)?null!=d&&"onScroll"===o&&Jn("scroll",e):null!=d&&y(e,o,d,l))}switch(r){case"input":K(e),Z(e,n,!1);break;case"textarea":K(e),oe(e);break;case"option":null!=n.value&&e.setAttribute("value",""+H(n.value));break;case"select":e.multiple=!!n.multiple,null!=(o=n.value)?re(e,!!n.multiple,o,!1):null!=n.defaultValue&&re(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=ls)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return tl(t),null;case 6:if(e&&null!=t.stateNode)Vi(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(a(166));if(r=no(ro.current),no(eo.current),ba(t)){if(n=t.stateNode,r=t.memoizedProps,n[ws]=t,(o=n.nodeValue!==r)&&null!==(e=ua))switch(e.tag){case 3:is(n.nodeValue,r,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&is(n.nodeValue,r,0!==(1&e.mode))}o&&(t.flags|=4)}else(n=(9===r.nodeType?r:r.ownerDocument).createTextNode(n))[ws]=t,t.stateNode=n}return tl(t),null;case 13:if(_s(lo),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ma&&null!==ha&&0!==(1&t.mode)&&0===(128&t.flags))wa(),ja(),t.flags|=98560,o=!1;else if(o=ba(t),null!==n&&null!==n.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[ws]=t}else ja(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;tl(t),o=!1}else null!==pa&&(gc(pa),pa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=r,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&lo.current)?0===Vl&&(Vl=3):Sc())),null!==t.updateQueue&&(t.flags|=4),tl(t),null);case 4:return ao(),Wi(e,t),null===e&&Xn(t.stateNode.containerInfo),tl(t),null;case 10:return La(t.type._context),tl(t),null;case 19:if(_s(lo),null===(o=t.memoizedState))return tl(t),null;if(n=0!==(128&t.flags),null===(l=o.rendering))if(n)el(o,!1);else{if(0!==Vl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=co(e))){for(t.flags|=128,el(o,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;null!==r;)e=n,(o=r).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Os(lo,1&lo.current|2),t.child}e=e.sibling}null!==o.tail&&Qe()>Xl&&(t.flags|=128,n=!0,el(o,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=co(l))){if(t.flags|=128,n=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.flags|=4),el(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ma)return tl(t),null}else 2*Qe()-o.renderingStartTime>Xl&&1073741824!==r&&(t.flags|=128,n=!0,el(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(r=o.last)?r.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Qe(),t.sibling=null,r=lo.current,Os(lo,n?1&r|2:1&r),t):(tl(t),null);case 22:case 23:return bc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&Wl)&&(tl(t),6&t.subtreeFlags&&(t.flags|=8192)):tl(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function nl(e,t){switch(da(t),t.tag){case 1:return Ws(t.type)&&zs(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),_s(Fs),_s(Rs),ho(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return io(t),null;case 13:if(_s(lo),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ja()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return _s(lo),null;case 4:return ao(),null;case 10:return La(t.type._context),null;case 22:case 23:return bc(),null;default:return null}}Bi=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},Wi=function(){},zi=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,no(eo.current);var a,o=null;switch(r){case"input":s=Y(e,s),n=Y(e,n),o=[];break;case"select":s=R({},s,{value:void 0}),n=R({},n,{value:void 0}),o=[];break;case"textarea":s=ne(e,s),n=ne(e,n),o=[];break;default:"function"!==typeof s.onClick&&"function"===typeof n.onClick&&(e.onclick=ls)}for(d in xe(r,n),r=null,s)if(!n.hasOwnProperty(d)&&s.hasOwnProperty(d)&&null!=s[d])if("style"===d){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(i.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in n){var c=n[d];if(l=null!=s?s[d]:void 0,n.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(r||(r={}),r[a]=c[a])}else r||(o||(o=[]),o.push(d,r)),r=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(i.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Jn("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}r&&(o=o||[]).push("style",r);var d=o;(t.updateQueue=d)&&(t.flags|=4)}},Vi=function(e,t,r,n){r!==n&&(t.flags|=4)};var sl=!1,al=!1,ol="function"===typeof WeakSet?WeakSet:Set,il=null;function ll(e,t){var r=e.ref;if(null!==r)if("function"===typeof r)try{r(null)}catch(Bt){Mc(e,t,Bt)}else r.current=null}function cl(e,t,r){try{r()}catch(Bt){Mc(e,t,Bt)}}var dl=!1;function ul(e,t,r){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var s=n=n.next;do{if((s.tag&e)===e){var a=s.destroy;s.destroy=void 0,void 0!==a&&cl(t,r,a)}s=s.next}while(s!==n)}}function hl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function ml(e){var t=e.ref;if(null!==t){var r=e.stateNode;e.tag,e=r,"function"===typeof t?t(e):t.current=e}}function pl(e){var t=e.alternate;null!==t&&(e.alternate=null,pl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ws],delete t[js],delete t[Ss],delete t[ks],delete t[As])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function gl(e){return 5===e.tag||3===e.tag||4===e.tag}function fl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||gl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function xl(e,t,r){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!==(r=r._reactRootContainer)&&void 0!==r||null!==t.onclick||(t.onclick=ls));else if(4!==n&&null!==(e=e.child))for(xl(e,t,r),e=e.sibling;null!==e;)xl(e,t,r),e=e.sibling}function vl(e,t,r){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==n&&null!==(e=e.child))for(vl(e,t,r),e=e.sibling;null!==e;)vl(e,t,r),e=e.sibling}var yl=null,bl=!1;function wl(e,t,r){for(r=r.child;null!==r;)jl(e,t,r),r=r.sibling}function jl(e,t,r){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(nt,r)}catch(Vt){}switch(r.tag){case 5:al||ll(r,t);case 6:var n=yl,s=bl;yl=null,wl(e,t,r),bl=s,null!==(yl=n)&&(bl?(e=yl,r=r.stateNode,8===e.nodeType?e.parentNode.removeChild(r):e.removeChild(r)):yl.removeChild(r.stateNode));break;case 18:null!==yl&&(bl?(e=yl,r=r.stateNode,8===e.nodeType?xs(e.parentNode,r):1===e.nodeType&&xs(e,r),Yt(e)):xs(yl,r.stateNode));break;case 4:n=yl,s=bl,yl=r.stateNode.containerInfo,bl=!0,wl(e,t,r),yl=n,bl=s;break;case 0:case 11:case 14:case 15:if(!al&&(null!==(n=r.updateQueue)&&null!==(n=n.lastEffect))){s=n=n.next;do{var a=s,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&cl(r,t,o),s=s.next}while(s!==n)}wl(e,t,r);break;case 1:if(!al&&(ll(r,t),"function"===typeof(n=r.stateNode).componentWillUnmount))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(Vt){Mc(r,t,Vt)}wl(e,t,r);break;case 21:wl(e,t,r);break;case 22:1&r.mode?(al=(n=al)||null!==r.memoizedState,wl(e,t,r),al=n):wl(e,t,r);break;default:wl(e,t,r)}}function Nl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new ol),t.forEach(function(t){var n=Rc.bind(null,e,t);r.has(t)||(r.add(t),t.then(n,n))})}}function Sl(e,t){var r=t.deletions;if(null!==r)for(var n=0;n<r.length;n++){var s=r[n];try{var o=e,i=t,l=i;e:for(;null!==l;){switch(l.tag){case 5:yl=l.stateNode,bl=!1;break e;case 3:case 4:yl=l.stateNode.containerInfo,bl=!0;break e}l=l.return}if(null===yl)throw Error(a(160));jl(o,i,s),yl=null,bl=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(Dt){Mc(s,t,Dt)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)kl(t,e),t=t.sibling}function kl(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Sl(t,e),Al(e),4&n){try{ul(3,e,e.return),hl(3,e)}catch(Tt){Mc(e,e.return,Tt)}try{ul(5,e,e.return)}catch(Tt){Mc(e,e.return,Tt)}}break;case 1:Sl(t,e),Al(e),512&n&&null!==r&&ll(r,r.return);break;case 5:if(Sl(t,e),Al(e),512&n&&null!==r&&ll(r,r.return),32&e.flags){var s=e.stateNode;try{ue(s,"")}catch(Tt){Mc(e,e.return,Tt)}}if(4&n&&null!=(s=e.stateNode)){var o=e.memoizedProps,i=null!==r?r.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&X(s,o),ve(l,i);var d=ve(l,o);for(i=0;i<c.length;i+=2){var u=c[i],h=c[i+1];"style"===u?ge(s,h):"dangerouslySetInnerHTML"===u?de(s,h):"children"===u?ue(s,h):y(s,u,h,d)}switch(l){case"input":$(s,o);break;case"textarea":ae(s,o);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?re(s,!!o.multiple,p,!1):m!==!!o.multiple&&(null!=o.defaultValue?re(s,!!o.multiple,o.defaultValue,!0):re(s,!!o.multiple,o.multiple?[]:"",!1))}s[js]=o}catch(Tt){Mc(e,e.return,Tt)}}break;case 6:if(Sl(t,e),Al(e),4&n){if(null===e.stateNode)throw Error(a(162));s=e.stateNode,o=e.memoizedProps;try{s.nodeValue=o}catch(Tt){Mc(e,e.return,Tt)}}break;case 3:if(Sl(t,e),Al(e),4&n&&null!==r&&r.memoizedState.isDehydrated)try{Yt(t.containerInfo)}catch(Tt){Mc(e,e.return,Tt)}break;case 4:default:Sl(t,e),Al(e);break;case 13:Sl(t,e),Al(e),8192&(s=e.child).flags&&(o=null!==s.memoizedState,s.stateNode.isHidden=o,!o||null!==s.alternate&&null!==s.alternate.memoizedState||(Ql=Qe())),4&n&&Nl(e);break;case 22:if(u=null!==r&&null!==r.memoizedState,1&e.mode?(al=(d=al)||u,Sl(t,e),al=d):Sl(t,e),Al(e),8192&n){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(il=e,u=e.child;null!==u;){for(h=il=u;null!==il;){switch(p=(m=il).child,m.tag){case 0:case 11:case 14:case 15:ul(4,m,m.return);break;case 1:ll(m,m.return);var g=m.stateNode;if("function"===typeof g.componentWillUnmount){n=m,r=m.return;try{t=n,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(Tt){Mc(n,r,Tt)}}break;case 5:ll(m,m.return);break;case 22:if(null!==m.memoizedState){Il(h);continue}}null!==p?(p.return=m,il=p):Il(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{s=h.stateNode,d?"function"===typeof(o=s.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=h.stateNode,i=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",i))}catch(Tt){Mc(e,e.return,Tt)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(Tt){Mc(e,e.return,Tt)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Sl(t,e),Al(e),4&n&&Nl(e);case 21:}}function Al(e){var t=e.flags;if(2&t){try{e:{for(var r=e.return;null!==r;){if(gl(r)){var n=r;break e}r=r.return}throw Error(a(160))}switch(n.tag){case 5:var s=n.stateNode;32&n.flags&&(ue(s,""),n.flags&=-33),vl(e,fl(e),s);break;case 3:case 4:var o=n.stateNode.containerInfo;xl(e,fl(e),o);break;default:throw Error(a(161))}}catch(Sr){Mc(e,e.return,Sr)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Cl(e,t,r){il=e,El(e,t,r)}function El(e,t,r){for(var n=0!==(1&e.mode);null!==il;){var s=il,a=s.child;if(22===s.tag&&n){var o=null!==s.memoizedState||sl;if(!o){var i=s.alternate,l=null!==i&&null!==i.memoizedState||al;i=sl;var c=al;if(sl=o,(al=l)&&!c)for(il=s;null!==il;)l=(o=il).child,22===o.tag&&null!==o.memoizedState?Tl(s):null!==l?(l.return=o,il=l):Tl(s);for(;null!==a;)il=a,El(a,t,r),a=a.sibling;il=s,sl=i,al=c}Pl(e)}else 0!==(8772&s.subtreeFlags)&&null!==a?(a.return=s,il=a):Pl(e)}}function Pl(e){for(;null!==il;){var t=il;if(0!==(8772&t.flags)){var r=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:al||hl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!al)if(null===r)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:ui(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&$a(t,o,n);break;case 3:var i=t.updateQueue;if(null!==i){if(r=null,null!==t.child)switch(t.child.tag){case 5:case 1:r=t.child.stateNode}$a(t,i,r)}break;case 5:var l=t.stateNode;if(null===r&&4&t.flags){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Yt(h)}}}break;default:throw Error(a(163))}al||512&t.flags&&ml(t)}catch(m){Mc(t,t.return,m)}}if(t===e){il=null;break}if(null!==(r=t.sibling)){r.return=t.return,il=r;break}il=t.return}}function Il(e){for(;null!==il;){var t=il;if(t===e){il=null;break}var r=t.sibling;if(null!==r){r.return=t.return,il=r;break}il=t.return}}function Tl(e){for(;null!==il;){var t=il;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{hl(4,t)}catch(Sr){Mc(t,r,Sr)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var s=t.return;try{n.componentDidMount()}catch(Sr){Mc(t,s,Sr)}}var a=t.return;try{ml(t)}catch(Sr){Mc(t,a,Sr)}break;case 5:var o=t.return;try{ml(t)}catch(Sr){Mc(t,o,Sr)}}}catch(Sr){Mc(t,t.return,Sr)}if(t===e){il=null;break}var i=t.sibling;if(null!==i){i.return=t.return,il=i;break}il=t.return}}var Dl,Ml=Math.ceil,_l=b.ReactCurrentDispatcher,Ol=b.ReactCurrentOwner,Ll=b.ReactCurrentBatchConfig,Rl=0,Fl=null,Ul=null,Bl=0,Wl=0,zl=Ms(0),Vl=0,Hl=null,ql=0,Kl=0,Gl=0,Jl=null,Yl=null,Ql=0,Xl=1/0,$l=null,Zl=!1,ec=null,tc=null,rc=!1,nc=null,sc=0,ac=0,oc=null,ic=-1,lc=0;function cc(){return 0!==(6&Rl)?Qe():-1!==ic?ic:ic=Qe()}function dc(e){return 0===(1&e.mode)?1:0!==(2&Rl)&&0!==Bl?Bl&-Bl:null!==Sa.transition?(0===lc&&(lc=pt()),lc):0!==(e=vt)?e:e=void 0===(e=window.event)?16:nr(e.type)}function uc(e,t,r,n){if(50<ac)throw ac=0,oc=null,Error(a(185));ft(e,r,n),0!==(2&Rl)&&e===Fl||(e===Fl&&(0===(2&Rl)&&(Kl|=r),4===Vl&&fc(e,Bl)),hc(e,n),1===r&&0===Rl&&0===(1&t.mode)&&(Xl=Qe()+500,Js&&Xs()))}function hc(e,t){var r=e.callbackNode;!function(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-at(a),i=1<<o,l=s[o];-1===l?0!==(i&r)&&0===(i&n)||(s[o]=ht(i,t)):l<=t&&(e.expiredLanes|=i),a&=~i}}(e,t);var n=ut(e,e===Fl?Bl:0);if(0===n)null!==r&&Ge(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=r&&Ge(r),1===t)0===e.tag?function(e){Js=!0,Qs(e)}(xc.bind(null,e)):Qs(xc.bind(null,e)),gs(function(){0===(6&Rl)&&Xs()}),r=null;else{switch(yt(n)){case 1:r=$e;break;case 4:r=Ze;break;case 16:default:r=et;break;case 536870912:r=rt}r=Fc(r,mc.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function mc(e,t){if(ic=-1,lc=0,0!==(6&Rl))throw Error(a(327));var r=e.callbackNode;if(Tc()&&e.callbackNode!==r)return null;var n=ut(e,e===Fl?Bl:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=kc(e,n);else{t=n;var s=Rl;Rl|=2;var o=Nc();for(Fl===e&&Bl===t||($l=null,Xl=Qe()+500,wc(e,t));;)try{Cc();break}catch(Vt){jc(e,Vt)}Oa(),_l.current=o,Rl=s,null!==Ul?t=0:(Fl=null,Bl=0,t=Vl)}if(0!==t){if(2===t&&(0!==(s=mt(e))&&(n=s,t=pc(e,s))),1===t)throw r=Hl,wc(e,0),fc(e,n),hc(e,Qe()),r;if(6===t)fc(e,n);else{if(s=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var r=t.updateQueue;if(null!==r&&null!==(r=r.stores))for(var n=0;n<r.length;n++){var s=r[n],a=s.getSnapshot;s=s.value;try{if(!fn(a(),s))return!1}catch(i){return!1}}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=kc(e,n))&&(0!==(o=mt(e))&&(n=o,t=pc(e,o))),1===t))throw r=Hl,wc(e,0),fc(e,n),hc(e,Qe()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(a(345));case 2:case 5:Ic(e,Yl,$l);break;case 3:if(fc(e,n),(130023424&n)===n&&10<(t=Ql+500-Qe())){if(0!==ut(e,0))break;if(((s=e.suspendedLanes)&n)!==n){cc(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=hs(Ic.bind(null,e,Yl,$l),t);break}Ic(e,Yl,$l);break;case 4:if(fc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,s=-1;0<n;){var i=31-at(n);o=1<<i,(i=t[i])>s&&(s=i),n&=~o}if(n=s,10<(n=(120>(n=Qe()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ml(n/1960))-n)){e.timeoutHandle=hs(Ic.bind(null,e,Yl,$l),n);break}Ic(e,Yl,$l);break;default:throw Error(a(329))}}}return hc(e,Qe()),e.callbackNode===r?mc.bind(null,e):null}function pc(e,t){var r=Jl;return e.current.memoizedState.isDehydrated&&(wc(e,t).flags|=256),2!==(e=kc(e,t))&&(t=Yl,Yl=r,null!==t&&gc(t)),e}function gc(e){null===Yl?Yl=e:Yl.push.apply(Yl,e)}function fc(e,t){for(t&=~Gl,t&=~Kl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-at(t),n=1<<r;e[r]=-1,t&=~n}}function xc(e){if(0!==(6&Rl))throw Error(a(327));Tc();var t=ut(e,0);if(0===(1&t))return hc(e,Qe()),null;var r=kc(e,t);if(0!==e.tag&&2===r){var n=mt(e);0!==n&&(t=n,r=pc(e,n))}if(1===r)throw r=Hl,wc(e,0),fc(e,t),hc(e,Qe()),r;if(6===r)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ic(e,Yl,$l),hc(e,Qe()),null}function vc(e,t){var r=Rl;Rl|=1;try{return e(t)}finally{0===(Rl=r)&&(Xl=Qe()+500,Js&&Xs())}}function yc(e){null!==nc&&0===nc.tag&&0===(6&Rl)&&Tc();var t=Rl;Rl|=1;var r=Ll.transition,n=vt;try{if(Ll.transition=null,vt=1,e)return e()}finally{vt=n,Ll.transition=r,0===(6&(Rl=t))&&Xs()}}function bc(){Wl=zl.current,_s(zl)}function wc(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(-1!==r&&(e.timeoutHandle=-1,ms(r)),null!==Ul)for(r=Ul.return;null!==r;){var n=r;switch(da(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&zs();break;case 3:ao(),_s(Fs),_s(Rs),ho();break;case 5:io(n);break;case 4:ao();break;case 13:case 19:_s(lo);break;case 10:La(n.type._context);break;case 22:case 23:bc()}r=r.return}if(Fl=e,Ul=e=zc(e.current,null),Bl=Wl=t,Vl=0,Hl=null,Gl=Kl=ql=0,Yl=Jl=null,null!==Ba){for(t=0;t<Ba.length;t++)if(null!==(n=(r=Ba[t]).interleaved)){r.interleaved=null;var s=n.next,a=r.pending;if(null!==a){var o=a.next;a.next=s,n.next=o}r.pending=n}Ba=null}return e}function jc(e,t){for(;;){var r=Ul;try{if(Oa(),mo.current=ii,yo){for(var n=fo.memoizedState;null!==n;){var s=n.queue;null!==s&&(s.pending=null),n=n.next}yo=!1}if(go=0,vo=xo=fo=null,bo=!1,wo=0,Ol.current=null,null===r||null===r.return){Vl=1,Hl=t,Ul=null;break}e:{var o=e,i=r.return,l=r,c=t;if(t=Bl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=ki(i);if(null!==p){p.flags&=-257,Ai(p,i,l,0,t),1&p.mode&&Si(o,d,t),c=d;var g=(t=p).updateQueue;if(null===g){var f=new Set;f.add(c),t.updateQueue=f}else g.add(c);break e}if(0===(1&t)){Si(o,d,t),Sc();break e}c=Error(a(426))}else if(ma&&1&l.mode){var x=ki(i);if(null!==x){0===(65536&x.flags)&&(x.flags|=256),Ai(x,i,l,0,t),Na(vi(c,l));break e}}o=c=vi(c,l),4!==Vl&&(Vl=2),null===Jl?Jl=[o]:Jl.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Qa(o,ji(0,c,t));break e;case 1:l=c;var v=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof v.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===tc||!tc.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,Qa(o,Ni(o,l,t));break e}}o=o.return}while(null!==o)}Pc(r)}catch(b){t=b,Ul===r&&null!==r&&(Ul=r=r.return);continue}break}}function Nc(){var e=_l.current;return _l.current=ii,null===e?ii:e}function Sc(){0!==Vl&&3!==Vl&&2!==Vl||(Vl=4),null===Fl||0===(268435455&ql)&&0===(268435455&Kl)||fc(Fl,Bl)}function kc(e,t){var r=Rl;Rl|=2;var n=Nc();for(Fl===e&&Bl===t||($l=null,wc(e,t));;)try{Ac();break}catch(It){jc(e,It)}if(Oa(),Rl=r,_l.current=n,null!==Ul)throw Error(a(261));return Fl=null,Bl=0,Vl}function Ac(){for(;null!==Ul;)Ec(Ul)}function Cc(){for(;null!==Ul&&!Je();)Ec(Ul)}function Ec(e){var t=Dl(e.alternate,e,Wl);e.memoizedProps=e.pendingProps,null===t?Pc(e):Ul=t,Ol.current=null}function Pc(e){var t=e;do{var r=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(r=rl(r,t,Wl)))return void(Ul=r)}else{if(null!==(r=nl(r,t)))return r.flags&=32767,void(Ul=r);if(null===e)return Vl=6,void(Ul=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ul=t);Ul=t=e}while(null!==t);0===Vl&&(Vl=5)}function Ic(e,t,r){var n=vt,s=Ll.transition;try{Ll.transition=null,vt=1,function(e,t,r,n){do{Tc()}while(null!==nc);if(0!==(6&Rl))throw Error(a(327));r=e.finishedWork;var s=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(function(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-at(r),a=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~a}}(e,o),e===Fl&&(Ul=Fl=null,Bl=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||rc||(rc=!0,Fc(et,function(){return Tc(),null})),o=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||o){o=Ll.transition,Ll.transition=null;var i=vt;vt=1;var l=Rl;Rl|=4,Ol.current=null,function(e,t){if(cs=Xt,jn(e=wn())){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(n&&0!==n.rangeCount){r=n.anchorNode;var s=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch(lr){r=null;break e}var i=0,l=-1,c=-1,d=0,u=0,h=e,m=null;t:for(;;){for(var p;h!==r||0!==s&&3!==h.nodeType||(l=i+s),h!==o||0!==n&&3!==h.nodeType||(c=i+n),3===h.nodeType&&(i+=h.nodeValue.length),null!==(p=h.firstChild);)m=h,h=p;for(;;){if(h===e)break t;if(m===r&&++d===s&&(l=i),m===o&&++u===n&&(c=i),null!==(p=h.nextSibling))break;m=(h=m).parentNode}h=p}r=-1===l||-1===c?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(ds={focusedElem:e,selectionRange:r},Xt=!1,il=t;null!==il;)if(e=(t=il).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,il=e;else for(;null!==il;){t=il;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var f=g.memoizedProps,x=g.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?f:ui(t.type,f),x);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(lr){Mc(t,t.return,lr)}if(null!==(e=t.sibling)){e.return=t.return,il=e;break}il=t.return}g=dl,dl=!1}(e,r),kl(r,e),Nn(ds),Xt=!!cs,ds=cs=null,e.current=r,Cl(r,e,s),Ye(),Rl=l,vt=i,Ll.transition=o}else e.current=r;if(rc&&(rc=!1,nc=e,sc=s),o=e.pendingLanes,0===o&&(tc=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(nt,e,void 0,128===(128&e.current.flags))}catch(t){}}(r.stateNode),hc(e,Qe()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(Zl)throw Zl=!1,e=ec,ec=null,e;0!==(1&sc)&&0!==e.tag&&Tc(),o=e.pendingLanes,0!==(1&o)?e===oc?ac++:(ac=0,oc=e):ac=0,Xs()}(e,t,r,n)}finally{Ll.transition=s,vt=n}return null}function Tc(){if(null!==nc){var e=yt(sc),t=Ll.transition,r=vt;try{if(Ll.transition=null,vt=16>e?16:e,null===nc)var n=!1;else{if(e=nc,nc=null,sc=0,0!==(6&Rl))throw Error(a(331));var s=Rl;for(Rl|=4,il=e.current;null!==il;){var o=il,i=o.child;if(0!==(16&il.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(il=d;null!==il;){var u=il;switch(u.tag){case 0:case 11:case 15:ul(8,u,o)}var h=u.child;if(null!==h)h.return=u,il=h;else for(;null!==il;){var m=(u=il).sibling,p=u.return;if(pl(u),u===d){il=null;break}if(null!==m){m.return=p,il=m;break}il=p}}}var g=o.alternate;if(null!==g){var f=g.child;if(null!==f){g.child=null;do{var x=f.sibling;f.sibling=null,f=x}while(null!==f)}}il=o}}if(0!==(2064&o.subtreeFlags)&&null!==i)i.return=o,il=i;else e:for(;null!==il;){if(0!==(2048&(o=il).flags))switch(o.tag){case 0:case 11:case 15:ul(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,il=v;break e}il=o.return}}var y=e.current;for(il=y;null!==il;){var b=(i=il).child;if(0!==(2064&i.subtreeFlags)&&null!==b)b.return=i,il=b;else e:for(i=y;null!==il;){if(0!==(2048&(l=il).flags))try{switch(l.tag){case 0:case 11:case 15:hl(9,l)}}catch(j){Mc(l,l.return,j)}if(l===i){il=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,il=w;break e}il=l.return}}if(Rl=s,Xs(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(nt,e)}catch(j){}n=!0}return n}finally{vt=r,Ll.transition=t}}return!1}function Dc(e,t,r){e=Ja(e,t=ji(0,t=vi(r,t),1),1),t=cc(),null!==e&&(ft(e,1,t),hc(e,t))}function Mc(e,t,r){if(3===e.tag)Dc(e,e,r);else for(;null!==t;){if(3===t.tag){Dc(t,e,r);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===tc||!tc.has(n))){t=Ja(t,e=Ni(t,e=vi(r,e),1),1),e=cc(),null!==t&&(ft(t,1,e),hc(t,e));break}}t=t.return}}function _c(e,t,r){var n=e.pingCache;null!==n&&n.delete(t),t=cc(),e.pingedLanes|=e.suspendedLanes&r,Fl===e&&(Bl&r)===r&&(4===Vl||3===Vl&&(130023424&Bl)===Bl&&500>Qe()-Ql?wc(e,0):Gl|=r),hc(e,t)}function Oc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var r=cc();null!==(e=Va(e,t))&&(ft(e,t,r),hc(e,r))}function Lc(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),Oc(e,r)}function Rc(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;null!==s&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(a(314))}null!==n&&n.delete(t),Oc(e,r)}function Fc(e,t){return Ke(e,t)}function Uc(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bc(e,t,r,n){return new Uc(e,t,r,n)}function Wc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zc(e,t){var r=e.alternate;return null===r?((r=Bc(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=14680064&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Vc(e,t,r,n,s,o){var i=2;if(n=e,"function"===typeof e)Wc(e)&&(i=1);else if("string"===typeof e)i=5;else e:switch(e){case N:return Hc(r.children,s,o,t);case S:i=8,s|=8;break;case k:return(e=Bc(12,r,t,2|s)).elementType=k,e.lanes=o,e;case P:return(e=Bc(13,r,t,s)).elementType=P,e.lanes=o,e;case I:return(e=Bc(19,r,t,s)).elementType=I,e.lanes=o,e;case M:return qc(r,s,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:i=10;break e;case C:i=9;break e;case E:i=11;break e;case T:i=14;break e;case D:i=16,n=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Bc(i,r,t,s)).elementType=e,t.type=n,t.lanes=o,t}function Hc(e,t,r,n){return(e=Bc(7,e,n,t)).lanes=r,e}function qc(e,t,r,n){return(e=Bc(22,e,n,t)).elementType=M,e.lanes=r,e.stateNode={isHidden:!1},e}function Kc(e,t,r){return(e=Bc(6,e,null,t)).lanes=r,e}function Gc(e,t,r){return(t=Bc(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Jc(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Yc(e,t,r,n,s,a,o,i,l){return e=new Jc(e,t,r,i,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Bc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},qa(a),e}function Qc(e){if(!e)return Ls;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ws(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var r=e.type;if(Ws(r))return Hs(e,r,t)}return t}function Xc(e,t,r,n,s,a,o,i,l){return(e=Yc(r,n,!0,e,0,a,0,i,l)).context=Qc(null),r=e.current,(a=Ga(n=cc(),s=dc(r))).callback=void 0!==t&&null!==t?t:null,Ja(r,a,s),e.current.lanes=s,ft(e,s,n),hc(e,n),e}function $c(e,t,r,n){var s=t.current,a=cc(),o=dc(s);return r=Qc(r),null===t.context?t.context=r:t.pendingContext=r,(t=Ga(a,o)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Ja(s,t,o))&&(uc(e,s,o,a),Ya(e,s,o)),o}function Zc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function ed(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function td(e,t){ed(e,t),(e=e.alternate)&&ed(e,t)}Dl=function(e,t,r){if(null!==e)if(e.memoizedProps!==t.pendingProps||Fs.current)Ei=!0;else{if(0===(e.lanes&r)&&0===(128&t.flags))return Ei=!1,function(e,t,r){switch(t.tag){case 3:Fi(t),ja();break;case 5:oo(t);break;case 1:Ws(t.type)&&qs(t);break;case 4:so(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;Os(Ta,n._currentValue),n._currentValue=s;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Os(lo,1&lo.current),t.flags|=128,null):0!==(r&t.child.childLanes)?Ki(e,t,r):(Os(lo,1&lo.current),null!==(e=Zi(e,t,r))?e.sibling:null);Os(lo,1&lo.current);break;case 19:if(n=0!==(r&t.childLanes),0!==(128&e.flags)){if(n)return Xi(e,t,r);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Os(lo,lo.current),n)break;return null;case 22:case 23:return t.lanes=0,Mi(e,t,r)}return Zi(e,t,r)}(e,t,r);Ei=0!==(131072&e.flags)}else Ei=!1,ma&&0!==(1048576&t.flags)&&la(t,ta,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;$i(e,t),e=t.pendingProps;var s=Bs(t,Rs.current);Fa(t,r),s=ko(null,t,n,e,s,r);var o=Ao();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ws(n)?(o=!0,qs(t)):o=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,qa(t),s.updater=mi,t.stateNode=s,s._reactInternals=t,xi(t,n,e,r),t=Ri(null,t,n,!0,o,r)):(t.tag=0,ma&&o&&ca(t),Pi(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch($i(e,t),e=t.pendingProps,n=(s=n._init)(n._payload),t.type=n,s=t.tag=function(e){if("function"===typeof e)return Wc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===T)return 14}return 2}(n),e=ui(n,e),s){case 0:t=Oi(null,t,n,e,r);break e;case 1:t=Li(null,t,n,e,r);break e;case 11:t=Ii(null,t,n,e,r);break e;case 14:t=Ti(null,t,n,ui(n.type,e),r);break e}throw Error(a(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,Oi(e,t,n,s=t.elementType===n?s:ui(n,s),r);case 1:return n=t.type,s=t.pendingProps,Li(e,t,n,s=t.elementType===n?s:ui(n,s),r);case 3:e:{if(Fi(t),null===e)throw Error(a(387));n=t.pendingProps,s=(o=t.memoizedState).element,Ka(e,t),Xa(t,n,null,r);var i=t.memoizedState;if(n=i.element,o.isDehydrated){if(o={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ui(e,t,n,r,s=vi(Error(a(423)),t));break e}if(n!==s){t=Ui(e,t,n,r,s=vi(Error(a(424)),t));break e}for(ha=vs(t.stateNode.containerInfo.firstChild),ua=t,ma=!0,pa=null,r=Ia(t,null,n,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(ja(),n===s){t=Zi(e,t,r);break e}Pi(e,t,n,r)}t=t.child}return t;case 5:return oo(t),null===e&&va(t),n=t.type,s=t.pendingProps,o=null!==e?e.memoizedProps:null,i=s.children,us(n,s)?i=null:null!==o&&us(n,o)&&(t.flags|=32),_i(e,t),Pi(e,t,i,r),t.child;case 6:return null===e&&va(t),null;case 13:return Ki(e,t,r);case 4:return so(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Pa(t,null,n,r):Pi(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,Ii(e,t,n,s=t.elementType===n?s:ui(n,s),r);case 7:return Pi(e,t,t.pendingProps,r),t.child;case 8:case 12:return Pi(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,o=t.memoizedProps,i=s.value,Os(Ta,n._currentValue),n._currentValue=i,null!==o)if(fn(o.value,i)){if(o.children===s.children&&!Fs.current){t=Zi(e,t,r);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){i=o.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===o.tag){(c=Ga(-1,r&-r)).tag=2;var d=o.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}o.lanes|=r,null!==(c=o.alternate)&&(c.lanes|=r),Ra(o.return,r,t),l.lanes|=r;break}c=c.next}}else if(10===o.tag)i=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(i=o.return))throw Error(a(341));i.lanes|=r,null!==(l=i.alternate)&&(l.lanes|=r),Ra(i,r,t),i=o.sibling}else i=o.child;if(null!==i)i.return=o;else for(i=o;null!==i;){if(i===t){i=null;break}if(null!==(o=i.sibling)){o.return=i.return,i=o;break}i=i.return}o=i}Pi(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,Fa(t,r),n=n(s=Ua(s)),t.flags|=1,Pi(e,t,n,r),t.child;case 14:return s=ui(n=t.type,t.pendingProps),Ti(e,t,n,s=ui(n.type,s),r);case 15:return Di(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:ui(n,s),$i(e,t),t.tag=1,Ws(n)?(e=!0,qs(t)):e=!1,Fa(t,r),gi(t,n,s),xi(t,n,s,r),Ri(null,t,n,!0,e,r);case 19:return Xi(e,t,r);case 22:return Mi(e,t,r)}throw Error(a(156,t.tag))};var rd="function"===typeof reportError?reportError:function(e){console.error(e)};function nd(e){this._internalRoot=e}function sd(e){this._internalRoot=e}function ad(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function od(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function id(){}function ld(e,t,r,n,s){var a=r._reactRootContainer;if(a){var o=a;if("function"===typeof s){var i=s;s=function(){var e=Zc(o);i.call(e)}}$c(t,o,e,s)}else o=function(e,t,r,n,s){if(s){if("function"===typeof n){var a=n;n=function(){var e=Zc(o);a.call(e)}}var o=Xc(t,n,e,0,null,!1,0,"",id);return e._reactRootContainer=o,e[Ns]=o.current,Xn(8===e.nodeType?e.parentNode:e),yc(),o}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof n){var i=n;n=function(){var e=Zc(l);i.call(e)}}var l=Yc(e,0,!1,null,0,!1,0,"",id);return e._reactRootContainer=l,e[Ns]=l.current,Xn(8===e.nodeType?e.parentNode:e),yc(function(){$c(t,l,r,n)}),l}(r,t,e,s,n);return Zc(o)}sd.prototype.render=nd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));$c(e,t,null,null)},sd.prototype.unmount=nd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;yc(function(){$c(null,e,null,null)}),t[Ns]=null}},sd.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Rt.length&&0!==t&&t<Rt[r].priority;r++);Rt.splice(r,0,e),0===r&&Ht(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=dt(t.pendingLanes);0!==r&&(xt(t,1|r),hc(t,Qe()),0===(6&Rl)&&(Xl=Qe()+500,Xs()))}break;case 13:yc(function(){var t=Va(e,1);if(null!==t){var r=cc();uc(t,e,1,r)}}),td(e,1)}},wt=function(e){if(13===e.tag){var t=Va(e,134217728);if(null!==t)uc(t,e,134217728,cc());td(e,134217728)}},jt=function(e){if(13===e.tag){var t=dc(e),r=Va(e,t);if(null!==r)uc(r,e,t,cc());td(e,t)}},Nt=function(){return vt},St=function(e,t){var r=vt;try{return vt=e,t()}finally{vt=r}},we=function(e,t,r){switch(t){case"input":if($(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=Is(n);if(!s)throw Error(a(90));G(n),$(n,s)}}}break;case"textarea":ae(e,r);break;case"select":null!=(t=r.value)&&re(e,!!r.multiple,t,!1)}},Ce=vc,Ee=yc;var cd={usingClientEntryPoint:!1,Events:[Es,Ps,Is,ke,Ae,vc]},dd={findFiberByHostInstance:Cs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ud={bundleType:dd.bundleType,version:dd.version,rendererPackageName:dd.rendererPackageName,rendererConfig:dd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:dd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var hd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hd.isDisabled&&hd.supportsFiber)try{nt=hd.inject(ud),st=hd}catch(Mt){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cd,t.createPortal=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ad(t))throw Error(a(200));return function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:j,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}}(e,t,null,r)},t.createRoot=function(e,t){if(!ad(e))throw Error(a(299));var r=!1,n="",s=rd;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Yc(e,1,!1,null,0,r,0,n,s),e[Ns]=t.current,Xn(8===e.nodeType?e.parentNode:e),new nd(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return yc(e)},t.hydrate=function(e,t,r){if(!od(t))throw Error(a(200));return ld(null,e,t,!0,r)},t.hydrateRoot=function(e,t,r){if(!ad(e))throw Error(a(405));var n=null!=r&&r.hydratedSources||null,s=!1,o="",i=rd;if(null!==r&&void 0!==r&&(!0===r.unstable_strictMode&&(s=!0),void 0!==r.identifierPrefix&&(o=r.identifierPrefix),void 0!==r.onRecoverableError&&(i=r.onRecoverableError)),t=Xc(t,null,e,1,null!=r?r:null,s,0,o,i),e[Ns]=t.current,Xn(e),n)for(e=0;e<n.length;e++)s=(s=(r=n[e])._getVersion)(r._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new sd(t)},t.render=function(e,t,r){if(!od(t))throw Error(a(200));return ld(null,e,t,!1,r)},t.unmountComponentAtNode=function(e){if(!od(e))throw Error(a(40));return!!e._reactRootContainer&&(yc(function(){ld(null,null,e,!1,function(){e._reactRootContainer=null,e[Ns]=null})}),!0)},t.unstable_batchedUpdates=vc,t.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!od(r))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return ld(e,t,r,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},736:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(374));class a extends s.default{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"===typeof e&&new RegExp("[,()]").test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"in.(".concat(r,")")),this}contains(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return"string"===typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t){let{config:r,type:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s="";"plain"===n?s="pl":"phrase"===n?s="ph":"websearch"===n&&(s="w");const a=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append(e,"".concat(s,"fts").concat(a,".").concat(t)),this}match(e){return Object.entries(e).forEach(e=>{let[t,r]=e;this.url.searchParams.append(t,"eq.".concat(r))}),this}not(e,t,r){return this.url.searchParams.append(e,"not.".concat(t,".").concat(r)),this}or(e){let{foreignTable:t,referencedTable:r=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=r?"".concat(r,".or"):"or";return this.url.searchParams.append(n,"(".concat(e,")")),this}filter(e,t,r){return this.url.searchParams.append(e,"".concat(t,".").concat(r)),this}}t.default=a},759:(e,t,r)=>{r.d(t,{HW:()=>sr,mJ:()=>ar,J1:()=>ir,CI:()=>or,supabase:()=>nr,f3:()=>lr});class n extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",r=arguments.length>2?arguments[2]:void 0;super(e),this.name=t,this.context=r}}class s extends n{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class a extends n{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class o extends n{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var i;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(i||(i={}));var l=function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{l(n.next(e))}catch(It){a(It)}}function i(e){try{l(n.throw(e))}catch(It){a(It)}}function l(e){e.done?s(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};class c{constructor(e){let{headers:t={},customFetch:n,region:s=i.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then(r.bind(r,630)).then(e=>{let{default:r}=e;return r(...t)})}:fetch),function(){return t(...arguments)}})(n)}setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;return l(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:l}=t;let c={},{region:d}=t;d||(d=this.region);const u=new URL("".concat(this.url,"/").concat(e));let h;d&&"any"!==d&&(c["x-region"]=d,u.searchParams.set("forceFunctionRegion",d)),l&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&("undefined"!==typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",h=l):"string"===typeof l?(c["Content-Type"]="text/plain",h=l):"undefined"!==typeof FormData&&l instanceof FormData?h=l:(c["Content-Type"]="application/json",h=JSON.stringify(l)));const m=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:h}).catch(e=>{throw new s(e)}),p=m.headers.get("x-relay-error");if(p&&"true"===p)throw new a(m);if(!m.ok)throw new o(m);let g,f=(null!==(r=m.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return g="application/json"===f?yield m.json():"application/octet-stream"===f?yield m.blob():"text/event-stream"===f?m:"multipart/form-data"===f?yield m.formData():yield m.text(),{data:g,error:null,response:m}}catch(n){return{data:null,error:n,response:n instanceof o||n instanceof a?n.context:void 0}}})}}var d=r(980);const{PostgrestClient:u,PostgrestQueryBuilder:h,PostgrestFilterBuilder:m,PostgrestTransformBuilder:p,PostgrestBuilder:g,PostgrestError:f}=d;const x=class{static detectEnvironment(){var e;if("undefined"!==typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!==typeof r.g&&"undefined"!==typeof r.g.WebSocket)return{type:"native",constructor:r.g.WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocketPair&&"undefined"===typeof globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!==typeof globalThis&&globalThis.EdgeRuntime||"undefined"!==typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!==typeof process&&process.versions&&process.versions.node){const e=parseInt(process.versions.node.split(".")[0]);return e>=22?"undefined"!==typeof globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(e," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(e," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},v="realtime-js/".concat("2.15.1"),y=1e4;var b,w,j,N,S,k;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(b||(b={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(w||(w={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(j||(j={})),function(e){e.websocket="websocket"}(N||(N={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(S||(S={}));class A{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"===typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),s=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+n));a+=n;const i=r.decode(e.slice(a,a+s));a+=s;return{ref:null,topic:o,event:i,payload:JSON.parse(r.decode(e.slice(a,e.byteLength)))}}}class C{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(k||(k={}));const E=function(e,t){var r;const n=null!==(r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce((r,s)=>(r[s]=P(s,e,t,n),r),{})},P=(e,t,r,n)=>{const s=t.find(t=>t.name===e),a=null===s||void 0===s?void 0:s.type,o=r[e];return a&&!n.includes(a)?I(a,o):T(o)},I=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return O(t,r)}switch(e){case k.bool:return D(t);case k.float4:case k.float8:case k.int2:case k.int4:case k.int8:case k.numeric:case k.oid:return M(t);case k.json:case k.jsonb:return _(t);case k.timestamp:return L(t);case k.abstime:case k.date:case k.daterange:case k.int4range:case k.int8range:case k.money:case k.reltime:case k.text:case k.time:case k.timestamptz:case k.timetz:case k.tsrange:case k.tstzrange:default:return T(t)}},T=e=>e,D=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},M=e=>{if("string"===typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},_=e=>{if("string"===typeof e)try{return JSON.parse(e)}catch(t){return console.log("JSON parse error: ".concat(t)),e}return e},O=(e,t)=>{if("string"!==typeof e)return e;const r=e.length-1,n=e[r];if("{"===e[0]&&"}"===n){let n;const s=e.slice(1,r);try{n=JSON.parse("["+s+"]")}catch(Pr){n=s?s.split(","):[]}return n.map(e=>I(t,e))}return e},L=e=>"string"===typeof e?e.replace(" ","T"):e,R=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class F{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y;this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(e){let{status:t,response:r}=e;this.recHooks.filter(e=>e.status===t).forEach(e=>e.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var U,B,W,z;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(U||(U={}));class V{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null===t||void 0===t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.joinRef=this.channel._joinRef(),this.state=V.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=V.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],n()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=V.syncDiff(this.state,e,t,r),n())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const s=this.cloneDeep(e),a=this.transformState(t),o={},i={};return this.map(s,(e,t)=>{a[e]||(i[e]=t)}),this.map(a,(e,t)=>{const r=s[e];if(r){const n=t.map(e=>e.presence_ref),s=r.map(e=>e.presence_ref),a=t.filter(e=>s.indexOf(e.presence_ref)<0),l=r.filter(e=>n.indexOf(e.presence_ref)<0);a.length>0&&(o[e]=a),l.length>0&&(i[e]=l)}else o[e]=t}),this.syncDiff(s,{joins:o,leaves:i},r,n)}static syncDiff(e,t,r,n){const{joins:s,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(s,(t,n)=>{var s;const a=null!==(s=e[t])&&void 0!==s?s:[];if(e[t]=this.cloneDeep(n),a.length>0){const r=e[t].map(e=>e.presence_ref),n=a.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...n)}r(t,a,n)}),this.map(a,(t,r)=>{let s=e[t];if(!s)return;const a=r.map(e=>e.presence_ref);s=s.filter(e=>a.indexOf(e.presence_ref)<0),e[t]=s,n(t,s,r),0===s.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return t[r]="metas"in n?n.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(B||(B={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(W||(W={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(z||(z={}));class H{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},r=arguments.length>2?arguments[2]:void 0;this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=w.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new F(this,j.join,this.params,this.timeout),this.rejoinTimer=new C(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=w.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=w.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=w.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=w.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=w.errored,this.rejoinTimer.scheduleTimeout())}),this._on(j.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new V(this),this.broadcastEndpointURL=R(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==w.closed){const{config:{broadcast:s,presence:a,private:o}}=this.params,i=null!==(n=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==n?n:[],l=!!this.bindings[W.PRESENCE]&&this.bindings[W.PRESENCE].length>0,c={},d={broadcast:s,presence:Object.assign(Object.assign({},a),{enabled:l}),postgres_changes:i,private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null===e||void 0===e?void 0:e(z.CHANNEL_ERROR,t)),this._onClose(()=>null===e||void 0===e?void 0:e(z.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async t=>{let{postgres_changes:r}=t;var n;if(this.socket.setAuth(),void 0!==r){const t=this.bindings.postgres_changes,s=null!==(n=null===t||void 0===t?void 0:t.length)&&void 0!==n?n:0,a=[];for(let n=0;n<s;n++){const s=t[n],{filter:{event:o,schema:i,table:l,filter:c}}=s,d=r&&r[n];if(!d||d.event!==o||d.schema!==i||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=w.errored,void(null===e||void 0===e||e(z.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},s),{id:d.id}))}return this.bindings.postgres_changes=a,void(e&&e(z.SUBSCRIBED))}null===e||void 0===e||e(z.SUBSCRIBED)}).receive("error",t=>{this.state=w.errored,null===e||void 0===e||e(z.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null===e||void 0===e||e(z.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===w.joined&&e===W.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,n;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var n,s,a;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(s=null===(n=this.params)||void 0===n?void 0:n.config)||void 0===s?void 0:s.broadcast)||void 0===a?void 0:a.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:a,payload:o}=e,i={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:o,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(n=e.body)||void 0===n?void 0:n.cancel()),e.ok?"ok":"error"}catch(s){return"AbortError"===s.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=w.leaving;const t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger(j.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new F(this,j.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null===r||void 0===r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=w.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const n=new AbortController,s=setTimeout(()=>n.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(s),a}_push(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let n=new F(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(e.event),e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,s;const a=e.toLocaleLowerCase(),{close:o,error:i,leave:l,join:c}=j;if(r&&[o,i,l,c].indexOf(a)>=0&&r!==this._joinRef())return;let d=this._onMessage(a,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(e=>{var t,r,n;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(n=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===n?void 0:n.toLocaleLowerCase())===a}).map(e=>e.callback(d,r)):null===(s=this.bindings[a])||void 0===s||s.filter(e=>{var r,n,s,o,i,l;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return a&&(null===(n=t.ids)||void 0===n?void 0:n.includes(a))&&("*"===o||(null===o||void 0===o?void 0:o.toLocaleLowerCase())===(null===(s=t.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}{const r=null===(i=null===(o=null===e||void 0===e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===i?void 0:i.toLocaleLowerCase();return"*"===r||r===(null===(l=null===t||void 0===t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a}).map(e=>{if("object"===typeof d&&"ids"in d){const e=d.data,{schema:t,table:r,commit_timestamp:n,type:s,errors:a}=e,o={schema:t,table:r,commit_timestamp:n,eventType:s,new:{},old:{},errors:a};d=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(d,r)})}_isClosed(){return this.state===w.closed}_isJoined(){return this.state===w.joined}_isJoining(){return this.state===w.joining}_isLeaving(){return this.state===w.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,r){const n=e.toLocaleLowerCase(),s={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var n;return!((null===(n=e.type)||void 0===n?void 0:n.toLocaleLowerCase())===r&&H.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(j.close,{},e)}_onError(e){this._on(j.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=w.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=E(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=E(e.columns,e.old_record)),t}}const q=()=>{},K=25e3,G=10,J=100,Y=[1e3,2e3,5e3,1e4];class Q{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=y,this.transport=null,this.heartbeatIntervalMs=K,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=q,this.ref=0,this.reconnectTimer=null,this.logger=q,this.conn=null,this.sendBuffer=[],this.serializer=new A,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then(r.bind(r,630)).then(e=>{let{default:r}=e;return r(...t)}).catch(e=>{throw new Error("Failed to load @supabase/node-fetch: ".concat(e.message,". ")+"This is required for HTTP requests in Node.js environments without native fetch.")})}:fetch),function(){return t(...arguments)}},!(null===(n=null===t||void 0===t?void 0:t.params)||void 0===n?void 0:n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint="".concat(e,"/").concat(N.websocket),this.httpEndpoint=R(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null===t||void 0===t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=x.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error("".concat(t,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw new Error("WebSocket not available: ".concat(t))}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,null!==t&&void 0!==t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case b.connecting:return S.Connecting;case b.open:return S.Open;case b.closing:return S.Closing;default:return S.Closed}}isConnected(){return this.connectionState()===S.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};const r="realtime:".concat(e),n=this.getChannels().find(e=>e.topic===r);if(n)return n;{const r=new H("realtime:".concat(e),t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:n,ref:s}=e,a=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push","".concat(t," ").concat(r," (").concat(s,")"),n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},J);this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{"phoenix"===e.topic&&"phx_reply"===e.event&&this.heartbeatCallback("ok"===e.payload.status?"ok":"error"),e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:r,payload:n,ref:s}=e,a=s?"(".concat(s,")"):"",o=n.status||"";this.log("receive","".concat(o," ").concat(t," ").concat(r," ").concat(a).trim(),n),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,n,s)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL())),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(j.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return"".concat(e).concat(r).concat(n)}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=t||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const r={access_token:e,version:v};e&&t.updateJoinPayload(r),t.joinedOnce&&t._isJoined()&&t._push(j.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this.setAuth().catch(t=>{this.log("error","error setting auth in ".concat(e),t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(It){this.log("error","error in ".concat(e," callback"),It)}})}catch(It){this.log("error","error triggering ".concat(e," callbacks"),It)}}_setupReconnectionTimer(){this.reconnectTimer=new C(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},G)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,s,a,o,i,l;if(this.transport=null!==(t=null===e||void 0===e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null===e||void 0===e?void 0:e.timeout)&&void 0!==r?r:y,this.heartbeatIntervalMs=null!==(n=null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&void 0!==n?n:K,this.worker=null!==(s=null===e||void 0===e?void 0:e.worker)&&void 0!==s&&s,this.accessToken=null!==(a=null===e||void 0===e?void 0:e.accessToken)&&void 0!==a?a:null,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),((null===e||void 0===e?void 0:e.logLevel)||(null===e||void 0===e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(o=null===e||void 0===e?void 0:e.reconnectAfterMs)&&void 0!==o?o:e=>Y[e-1]||1e4,this.encode=null!==(i=null===e||void 0===e?void 0:e.encode)&&void 0!==i?i:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(l=null===e||void 0===e?void 0:e.decode)&&void 0!==l?l:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}}}class X extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function $(e){return"object"===typeof e&&null!==e&&"__isStorageError"in e}class Z extends X{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ee extends X{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var te=function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{l(n.next(e))}catch(It){a(It)}}function i(e){try{l(n.throw(e))}catch(It){a(It)}}function l(e){e.done?s(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const re=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then(r.bind(r,630)).then(e=>{let{default:r}=e;return r(...t)})}:fetch),function(){return t(...arguments)}},ne=e=>{if(Array.isArray(e))return e.map(e=>ne(e));if("function"===typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(e=>{let[r,n]=e;const s=r.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=ne(n)}),t};var se=function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{l(n.next(e))}catch(It){a(It)}}function i(e){try{l(n.throw(e))}catch(It){a(It)}}function l(e){e.done?s(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const ae=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),oe=(e,t,n)=>se(void 0,void 0,void 0,function*(){const s=yield te(void 0,void 0,void 0,function*(){return"undefined"===typeof Response?(yield Promise.resolve().then(r.bind(r,630))).Response:Response});e instanceof s&&!(null===n||void 0===n?void 0:n.noResolveJson)?e.json().then(r=>{const n=e.status||500,s=(null===r||void 0===r?void 0:r.statusCode)||n+"";t(new Z(ae(r),n,s))}).catch(e=>{t(new ee(ae(e),e))}):t(new ee(ae(e),e))}),ie=(e,t,r,n)=>{const s={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(n)?(s.headers=Object.assign({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,(null===t||void 0===t?void 0:t.duplex)&&(s.duplex=t.duplex),Object.assign(Object.assign({},s),r)):s};function le(e,t,r,n,s,a){return se(this,void 0,void 0,function*(){return new Promise((o,i)=>{e(r,ie(t,n,s,a)).then(e=>{if(!e.ok)throw e;return(null===n||void 0===n?void 0:n.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>oe(e,i,n))})})}function ce(e,t,r,n){return se(this,void 0,void 0,function*(){return le(e,"GET",t,r,n)})}function de(e,t,r,n,s){return se(this,void 0,void 0,function*(){return le(e,"POST",t,n,s,r)})}function ue(e,t,r,n,s){return se(this,void 0,void 0,function*(){return le(e,"PUT",t,n,s,r)})}function he(e,t,r,n,s){return se(this,void 0,void 0,function*(){return le(e,"DELETE",t,n,s,r)})}var me=function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{l(n.next(e))}catch(It){a(It)}}function i(e){try{l(n.throw(e))}catch(It){a(It)}}function l(e){e.done?s(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const pe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ge={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class fe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.url=e,this.headers=t,this.bucketId=r,this.fetch=re(n)}uploadOrUpdate(e,t,r,n){return me(this,void 0,void 0,function*(){try{let s;const a=Object.assign(Object.assign({},ge),n);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const i=a.metadata;"undefined"!==typeof Blob&&r instanceof Blob?(s=new FormData,s.append("cacheControl",a.cacheControl),i&&s.append("metadata",this.encodeMetadata(i)),s.append("",r)):"undefined"!==typeof FormData&&r instanceof FormData?(s=r,s.append("cacheControl",a.cacheControl),i&&s.append("metadata",this.encodeMetadata(i))):(s=r,o["cache-control"]="max-age=".concat(a.cacheControl),o["content-type"]=a.contentType,i&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(i)))),(null===n||void 0===n?void 0:n.headers)&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield("PUT"==e?ue:de)(this.fetch,"".concat(this.url,"/object/").concat(c),s,Object.assign({headers:o},(null===a||void 0===a?void 0:a.duplex)?{duplex:a.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(s){if($(s))return{data:null,error:s};throw s}})}upload(e,t,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return me(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),a=this._getFinalPath(s),o=new URL(this.url+"/object/upload/sign/".concat(a));o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:ge.upsert},n),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!==typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!==typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,a["cache-control"]="max-age=".concat(t.cacheControl),a["content-type"]=t.contentType);return{data:{path:s,fullPath:(yield ue(this.fetch,o.toString(),e,{headers:a})).Key},error:null}}catch(i){if($(i))return{data:null,error:i};throw i}})}createSignedUploadUrl(e,t){return me(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);(null===t||void 0===t?void 0:t.upsert)&&(n["x-upsert"]="true");const s=yield de(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(r),{},{headers:n}),a=new URL(this.url+s.url),o=a.searchParams.get("token");if(!o)throw new X("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(r){if($(r))return{data:null,error:r};throw r}})}update(e,t,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return me(this,void 0,void 0,function*(){try{return{data:yield de(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===r||void 0===r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if($(n))return{data:null,error:n};throw n}})}copy(e,t,r){return me(this,void 0,void 0,function*(){try{return{data:{path:(yield de(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===r||void 0===r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if($(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return me(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),s=yield de(this.fetch,"".concat(this.url,"/object/sign/").concat(n),Object.assign({expiresIn:t},(null===r||void 0===r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const a=(null===r||void 0===r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"";return s={signedUrl:encodeURI("".concat(this.url).concat(s.signedURL).concat(a))},{data:s,error:null}}catch(n){if($(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return me(this,void 0,void 0,function*(){try{const n=yield de(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers}),s=(null===r||void 0===r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"";return{data:n.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI("".concat(this.url).concat(e.signedURL).concat(s)):null})),error:null}}catch(n){if($(n))return{data:null,error:n};throw n}})}download(e,t){return me(this,void 0,void 0,function*(){const r="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{}),s=n?"?".concat(n):"";try{const t=this._getFinalPath(e),n=yield ce(this.fetch,"".concat(this.url,"/").concat(r,"/").concat(t).concat(s),{headers:this.headers,noResolveJson:!0});return{data:yield n.blob(),error:null}}catch(a){if($(a))return{data:null,error:a};throw a}})}info(e){return me(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield ce(this.fetch,"".concat(this.url,"/object/info/").concat(t),{headers:this.headers});return{data:ne(e),error:null}}catch(r){if($(r))return{data:null,error:r};throw r}})}exists(e){return me(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r,n){return se(this,void 0,void 0,function*(){return le(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}(this.fetch,"".concat(this.url,"/object/").concat(t),{headers:this.headers}),{data:!0,error:null}}catch(r){if($(r)&&r instanceof ee){const e=r.originalError;if([400,404].includes(null===e||void 0===e?void 0:e.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],s=(null===t||void 0===t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==s&&n.push(s);const a="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{});""!==o&&n.push(o);let i=n.join("&");return""!==i&&(i="?".concat(i)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(a,"/public/").concat(r).concat(i))}}}remove(e){return me(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}})}list(e,t,r){return me(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},pe),t),{prefix:e||""});return{data:yield de(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),n,{headers:this.headers},r),error:null}}catch(n){if($(n))return{data:null,error:n};throw n}})}listV2(e,t){return me(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield de(this.fetch,"".concat(this.url,"/object/list-v2/").concat(this.bucketId),r,{headers:this.headers},t),error:null}}catch(r){if($(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!==typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}}const xe={"X-Client-Info":"storage-js/".concat("2.11.0")};var ve=function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{l(n.next(e))}catch(It){a(It)}}function i(e){try{l(n.throw(e))}catch(It){a(It)}}function l(e){e.done?s(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};class ye{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const s=new URL(e);if(null===n||void 0===n?void 0:n.useNewHostname){/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase."))}this.url=s.href,this.headers=Object.assign(Object.assign({},xe),t),this.fetch=re(r)}listBuckets(){return ve(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers}),error:null}}catch(e){if($(e))return{data:null,error:e};throw e}})}getBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}})}createBucket(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return ve(this,void 0,void 0,function*(){try{return{data:yield de(this.fetch,"".concat(this.url,"/bucket"),{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if($(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ve(this,void 0,void 0,function*(){try{return{data:yield ue(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if($(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield de(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}})}}class be extends ye{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}from(e){return new fe(this.url,this.headers,e,this.fetch)}}let we="";we="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const je={headers:{"X-Client-Info":"supabase-js-".concat(we,"/").concat("2.56.0")}},Ne={schema:"public"},Se={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ke={};var Ae=r(630),Ce=function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{l(n.next(e))}catch(It){a(It)}}function i(e){try{l(n.throw(e))}catch(It){a(It)}}function l(e){e.done?s(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const Ee=e=>{let t;return t=e||("undefined"===typeof fetch?Ae.default:fetch),function(){return t(...arguments)}},Pe=(e,t,r)=>{const n=Ee(r),s="undefined"===typeof Headers?Ae.Headers:Headers;return(r,a)=>Ce(void 0,void 0,void 0,function*(){var o;const i=null!==(o=yield t())&&void 0!==o?o:e;let l=new s(null===a||void 0===a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization","Bearer ".concat(i)),n(r,Object.assign(Object.assign({},a),{headers:l}))})};var Ie=function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{l(n.next(e))}catch(It){a(It)}}function i(e){try{l(n.throw(e))}catch(It){a(It)}}function l(e){e.done?s(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const Te="2.71.1",De=3e4,Me=9e4,_e={"X-Client-Info":"gotrue-js/".concat(Te)},Oe="X-Supabase-Api-Version",Le={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Re=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Fe extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Ue(e){return"object"===typeof e&&null!==e&&"__isAuthError"in e}class Be extends Fe{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class We extends Fe{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ze extends Fe{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class Ve extends ze{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class He extends ze{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qe extends ze{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ke extends ze{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ge extends ze{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Je extends ze{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ye(e){return Ue(e)&&"AuthRetryableFetchError"===e.name}class Qe extends ze{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Xe extends ze{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const $e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ze=" \t\n\r=".split(""),et=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Ze.length;t+=1)e[Ze[t].charCodeAt(0)]=-2;for(let t=0;t<$e.length;t+=1)e[$e[t].charCodeAt(0)]=t;return e})();function tt(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r($e[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r($e[e]),t.queuedBits-=6}}function rt(e,t,r){const n=et[e];if(!(n>-1)){if(-2===n)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function nt(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},a=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(0===(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,n,r)};for(let o=0;o<e.length;o+=1)rt(e.charCodeAt(o),s,a);return t.join("")}function st(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}t(e)}function at(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const t=1024*(n-55296)&65535;n=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}st(n,t)}}function ot(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};for(let s=0;s<e.length;s+=1)rt(e.charCodeAt(s),r,n);return new Uint8Array(t)}function it(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};return e.forEach(e=>tt(e,r,n)),tt(null,r,n),t.join("")}const lt=()=>"undefined"!==typeof window&&"undefined"!==typeof document,ct={tested:!1,writable:!1},dt=()=>{if(!lt())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(It){return!1}if(ct.tested)return ct.writable;const e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ct.tested=!0,ct.writable=!0}catch(It){ct.tested=!0,ct.writable=!1}return ct.writable};const ut=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then(r.bind(r,630)).then(e=>{let{default:r}=e;return r(...t)})}:fetch),function(){return t(...arguments)}},ht=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},mt=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(n){return r}},pt=async(e,t)=>{await e.removeItem(t)};class gt{constructor(){this.promise=new gt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function ft(e){const t=e.split(".");if(3!==t.length)throw new Xe("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!Re.test(t[r]))throw new Xe("JWT not in base64url format");return{header:JSON.parse(nt(t[0])),payload:JSON.parse(nt(t[1])),signature:ot(t[2]),raw:{header:t[0],payload:t[1]}}}function xt(e){return("0"+e.toString(16)).substr(-2)}async function vt(e){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function yt(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=function(){const e=new Uint32Array(56);if("undefined"===typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let n=0;n<56;n++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,xt).join("")}();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await ht(e,"".concat(t,"-code-verifier"),s);const a=await vt(n);return[a,n===a?"plain":"s256"]}gt.promiseConstructor=Promise;const bt=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const wt=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function jt(e){if(!wt.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Nt(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"===typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function St(e){return JSON.parse(JSON.stringify(e))}var kt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r};const At=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ct=[502,503,504];async function Et(e){var t,r;if(!("object"===typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"===typeof r.json))throw new Je(At(e),0);if(Ct.includes(e.status))throw new Je(At(e),e.status);let n,s;try{n=await e.json()}catch(It){throw new We(At(It),It)}const a=function(e){const t=e.headers.get(Oe);if(!t)return null;if(!t.match(bt))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(It){return null}}(e);if(a&&a.getTime()>=Le.timestamp&&"object"===typeof n&&n&&"string"===typeof n.code?s=n.code:"object"===typeof n&&n&&"string"===typeof n.error_code&&(s=n.error_code),s){if("weak_password"===s)throw new Qe(At(n),e.status,(null===(t=n.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===s)throw new Ve}else if("object"===typeof n&&n&&"object"===typeof n.weak_password&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0))throw new Qe(At(n),e.status,n.weak_password.reasons);throw new Be(At(n),e.status||500,s)}async function Pt(e,t,r,n){var s;const a=Object.assign({},null===n||void 0===n?void 0:n.headers);a[Oe]||(a[Oe]=Le.name),(null===n||void 0===n?void 0:n.jwt)&&(a.Authorization="Bearer ".concat(n.jwt));const o=null!==(s=null===n||void 0===n?void 0:n.query)&&void 0!==s?s:{};(null===n||void 0===n?void 0:n.redirectTo)&&(o.redirect_to=n.redirectTo);const i=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,r,n,s,a){const o=((e,t,r,n)=>{const s={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===t||void 0===t?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))})(t,n,s,a);let i;try{i=await e(r,Object.assign({},o))}catch(It){throw console.error(It),new Je(At(It),0)}i.ok||await Et(i);if(null===n||void 0===n?void 0:n.noResolveJson)return i;try{return await i.json()}catch(It){await Et(It)}}(e,t,r+i,{headers:a,noResolveJson:null===n||void 0===n?void 0:n.noResolveJson},{},null===n||void 0===n?void 0:n.body);return(null===n||void 0===n?void 0:n.xform)?null===n||void 0===n?void 0:n.xform(l):{data:Object.assign({},l),error:null}}function Tt(e){var t;let r=null;var n;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(n=e.expires_in,Math.round(Date.now()/1e3)+n)));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Dt(e){const t=Tt(e);return!t.error&&e.weak_password&&"object"===typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"===typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Mt(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function _t(e){return{data:e,error:null}}function Ot(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:a}=e,o=kt(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:a},user:Object.assign({},o)},error:null}}function Lt(e){return e}const Rt=["global","local","others"];var Ft=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r};class Ut{constructor(e){let{url:t="",headers:r={},fetch:n}=e;this.url=t,this.headers=r,this.fetch=ut(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rt[0];if(Rt.indexOf(t)<0)throw new Error("@supabase/auth-js: Parameter scope must be one of ".concat(Rt.join(", ")));try{return await Pt(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await Pt(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Mt})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ft(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=null===r||void 0===r?void 0:r.newEmail,delete n.newEmail),await Pt(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:n,headers:this.headers,xform:Ot,redirectTo:null===t||void 0===t?void 0:t.redirectTo})}catch(t){if(Ue(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Pt(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:Mt})}catch(t){if(Ue(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,s,a,o,i;try{const l={nextPage:null,lastPage:0,total:0},c=await Pt(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(n=null===e||void 0===e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==s?s:""},xform:Lt});if(c.error)throw c.error;const d=await c.json(),u=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(i=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==i?i:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(r,"Page")]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Ue(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){jt(e);try{return await Pt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:Mt})}catch(t){if(Ue(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){jt(e);try{return await Pt(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:Mt})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async deleteUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];jt(e);try{return await Pt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:Mt})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){jt(e.userId);try{const{data:t,error:r}=await Pt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async _deleteFactor(e){jt(e.userId),jt(e.id);try{return{data:await Pt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}}}function Bt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Wt=!!(globalThis&&dt()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class zt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Vt extends zt{}async function Ht(e,t,r){Wt&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Wt&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async n=>{if(!n){if(0===t)throw Wt&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Vt('Acquiring an exclusive Navigator LockManager lock "'.concat(e,'" immediately failed'));if(Wt)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(It){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",It)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}Wt&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,n.name);try{return await r()}finally{Wt&&console.log("@supabase/gotrue-js: navigatorLock: released",e,n.name)}}))}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(It){"undefined"!==typeof self&&(self.globalThis=self)}}();const qt={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:_e,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Kt(e,t,r){return await r()}const Gt={};class Jt{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jt.nextInstanceID,Jt.nextInstanceID+=1,this.instanceID>0&&lt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},qt),e);if(this.logDebugMessages=!!n.debug,"function"===typeof n.debug&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Ut({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=ut(n.fetch),this.lock=n.lock||Kt,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:lt()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Ht:this.lock=Kt,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:dt()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Bt(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Bt(this.memoryStorage)),lt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(It){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",It)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=Gt[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Gt[this.storageKey]=Object.assign(Object.assign({},Gt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Gt[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Gt[this.storageKey]=Object.assign(Object.assign({},Gt[this.storageKey]),{cachedAt:e})}_debug(){if(this.logDebugMessages){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger("GoTrueClient@".concat(this.instanceID," (").concat(Te,") ").concat((new Date).toISOString()),...t)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(It){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),lt()&&this.detectSessionInUrl&&"none"!==r){const{data:n,error:s}=await this._getSessionFromURL(t,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),function(e){return Ue(e)&&"AuthImplicitGrantRedirectError"===e.name}(s)){const t=null===(e=s.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:s}}return await this._removeSession(),{error:s}}const{session:a,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Ue(t)?{error:t}:{error:new We("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const s=await Pt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(r=null===(t=null===e||void 0===e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(n=null===e||void 0===e?void 0:e.options)||void 0===n?void 0:n.captchaToken}},xform:Tt}),{data:a,error:o}=s;if(o||!a)return{data:{user:null,session:null},error:o};const i=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(s){if(Ue(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var t,r,n;try{let s;if("email"in e){const{email:r,password:n,options:a}=e;let o=null,i=null;"pkce"===this.flowType&&([o,i]=await yt(this.storage,this.storageKey)),s=await Pt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null===a||void 0===a?void 0:a.emailRedirectTo,body:{email:r,password:n,data:null!==(t=null===a||void 0===a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken},code_challenge:o,code_challenge_method:i},xform:Tt})}else{if(!("phone"in e))throw new qe("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:o}=e;s=await Pt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:t,password:a,data:null!==(r=null===o||void 0===o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(n=null===o||void 0===o?void 0:o.channel)&&void 0!==n?n:"sms",gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}},xform:Tt})}}const{data:a,error:o}=s;if(o||!a)return{data:{user:null,session:null},error:o};const i=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(s){if(Ue(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:n,options:s}=e;t=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:r,password:n,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},xform:Dt})}else{if(!("phone"in e))throw new qe("You must provide either an email or phone number and a password");{const{phone:r,password:n,options:s}=e;t=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:r,password:n,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},xform:Dt})}}const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n}):{data:{user:null,session:null},error:new He}}catch(t){if(Ue(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,s;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:null===(s=e.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error('@supabase/auth-js: Unsupported chain "'.concat(t,'"'))}async signInWithSolana(e){var t,r,n,s,a,o,i,l,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:g,options:f}=e;let x;if(lt())if("object"===typeof h)x=h;else{const e=window;if(!("solana"in e)||"object"!==typeof e.solana||!("signIn"in e.solana&&"function"===typeof e.solana.signIn||"signMessage"in e.solana&&"function"===typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");x=e.solana}else{if("object"!==typeof h||!(null===f||void 0===f?void 0:f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=h}const v=new URL(null!==(t=null===f||void 0===f?void 0:f.url)&&void 0!==t?t:window.location.href);if("signIn"in x&&x.signIn){const e=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null===f||void 0===f?void 0:f.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"===typeof e[0])t=e[0];else{if(!(e&&"object"===typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"===typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"===typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in x)||"function"!==typeof x.signMessage||!("publicKey"in x)||"object"!==typeof x||!x.publicKey||!("toBase58"in x.publicKey)||"function"!==typeof x.publicKey.toBase58)throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=["".concat(v.host," wants you to sign in with your Solana account:"),x.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1","URI: ".concat(v.href),"Issued At: ".concat(null!==(n=null===(r=null===f||void 0===f?void 0:f.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==n?n:(new Date).toISOString()),...(null===(s=null===f||void 0===f?void 0:f.signInWithSolana)||void 0===s?void 0:s.notBefore)?["Not Before: ".concat(f.signInWithSolana.notBefore)]:[],...(null===(a=null===f||void 0===f?void 0:f.signInWithSolana)||void 0===a?void 0:a.expirationTime)?["Expiration Time: ".concat(f.signInWithSolana.expirationTime)]:[],...(null===(o=null===f||void 0===f?void 0:f.signInWithSolana)||void 0===o?void 0:o.chainId)?["Chain ID: ".concat(f.signInWithSolana.chainId)]:[],...(null===(i=null===f||void 0===f?void 0:f.signInWithSolana)||void 0===i?void 0:i.nonce)?["Nonce: ".concat(f.signInWithSolana.nonce)]:[],...(null===(l=null===f||void 0===f?void 0:f.signInWithSolana)||void 0===l?void 0:l.requestId)?["Request ID: ".concat(f.signInWithSolana.requestId)]:[],...(null===(d=null===(c=null===f||void 0===f?void 0:f.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...f.signInWithSolana.resources.map(e=>"- ".concat(e))]:[]].join("\n");const e=await x.signMessage((new TextEncoder).encode(m),"utf8");if(!e||!(e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:r}=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:it(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Tt});if(r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:r}):{data:{user:null,session:null},error:new He}}catch(g){if(Ue(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await mt(this.storage,"".concat(this.storageKey,"-code-verifier")),[r,n]=(null!==t&&void 0!==t?t:"").split("/");try{const{data:t,error:s}=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Tt});if(await pt(this.storage,"".concat(this.storageKey,"-code-verifier")),s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!==n&&void 0!==n?n:null}),error:s}):{data:{user:null,session:null,redirectType:null},error:new He}}catch(s){if(Ue(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:s,nonce:a}=e,o=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:r,id_token:n,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:null===t||void 0===t?void 0:t.captchaToken}},xform:Tt}),{data:i,error:l}=o;return l?{data:{user:null,session:null},error:l}:i&&i.session&&i.user?(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:i,error:l}):{data:{user:null,session:null},error:new He}}catch(t){if(Ue(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,s,a;try{if("email"in e){const{email:n,options:s}=e;let a=null,o=null;"pkce"===this.flowType&&([a,o]=await yt(this.storage,this.storageKey));const{error:i}=await Pt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:n,data:null!==(t=null===s||void 0===s?void 0:s.data)&&void 0!==t?t:{},create_user:null===(r=null===s||void 0===s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken},code_challenge:a,code_challenge_method:o},redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:i}=await Pt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:t,data:null!==(n=null===r||void 0===r?void 0:r.data)&&void 0!==n?n:{},create_user:null===(s=null===r||void 0===r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken},channel:null!==(a=null===r||void 0===r?void 0:r.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null===o||void 0===o?void 0:o.message_id},error:i}}throw new qe("You must provide either an email or phone number.")}catch(o){if(Ue(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let n,s;"options"in e&&(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo,s=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:a,error:o}=await Pt(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:n,xform:Tt});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const i=a.session,l=a.user;return(null===i||void 0===i?void 0:i.access_token)&&(await this._saveSession(i),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(n){if(Ue(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let s=null,a=null;return"pkce"===this.flowType&&([s,a]=await yt(this.storage,this.storageKey)),await Pt(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(n=null===e||void 0===e?void 0:e.options)||void 0===n?void 0:n.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:_t})}catch(s){if(Ue(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Ve;const{error:n}=await Pt(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(Ue(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t="".concat(this.url,"/resend");if("email"in e){const{email:r,type:n,options:s}=e,{error:a}=await Pt(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:r,type:n,options:s}=e,{data:a,error:o}=await Pt(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:null===a||void 0===a?void 0:a.message_id},error:o}}throw new qe("You must provide either an email or phone number and a type")}catch(t){if(Ue(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(It){}})()),r}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(It){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await mt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<Me;if(this._debug("#__loadSession()","session has".concat(r?"":" not"," expired"),"expires_at",e.expires_at),!r){if(this.userStorage){const t=await mt(this.userStorage,this.storageKey+"-user");(null===t||void 0===t?void 0:t.user)?e.user=t.user:e.user=Nt()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,r,n)=>(t||"user"!==r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,r,n))})}return{data:{session:e},error:null}}const{session:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Pt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:Mt}):await this._useSession(async e=>{var t,r,n;const{data:s,error:a}=e;if(a)throw a;return(null===(t=s.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Pt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!==(n=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0,xform:Mt}):{data:{user:null},error:new Ve}})}catch(t){if(Ue(t))return function(e){return Ue(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await pt(this.storage,"".concat(this.storageKey,"-code-verifier"))),{data:{user:null},error:t};throw t}}async updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async r=>{const{data:n,error:s}=r;if(s)throw s;if(!n.session)throw new Ve;const a=n.session;let o=null,i=null;"pkce"===this.flowType&&null!=e.email&&([o,i]=await yt(this.storage,this.storageKey));const{data:l,error:c}=await Pt(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null===t||void 0===t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:i}),jwt:a.access_token,xform:Mt});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ve;const t=Date.now()/1e3;let r=t,n=!0,s=null;const{payload:a}=ft(e.access_token);if(a.exp&&(r=a.exp,n=r<=t),n){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};s=t}else{const{data:n,error:a}=await this._getUser(e.access_token);if(a)throw a;s={access_token:e.access_token,refresh_token:e.refresh_token,user:n.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(Ue(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:n,error:s}=t;if(s)throw s;e=null!==(r=n.session)&&void 0!==r?r:void 0}if(!(null===e||void 0===e?void 0:e.refresh_token))throw new Ve;const{session:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Ue(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!lt())throw new Ke("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ke(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Ge("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Ke("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ge("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const n=new URL(window.location.href);return n.searchParams.delete("code"),window.history.replaceState(window.history.state,"",n.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:s,refresh_token:a,expires_in:o,expires_at:i,token_type:l}=e;if(!s||!o||!a||!l)throw new Ke("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(o);let u=c+d;i&&(u=parseInt(i));const h=u-c;1e3*h<=De&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(h,"s, should have been closer to ").concat(d,"s"));const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:g}=await this._getUser(s);if(g)throw g;const f={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:d,expires_at:u,refresh_token:a,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:f,redirectType:e.type},error:null}}catch(r){if(Ue(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await mt(this.storage,"".concat(this.storageKey,"-code-verifier"));return!(!e.code||!t)}async signOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return{error:s};const a=null===(r=n.session)||void 0===r?void 0:r.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return Ue(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await pt(this.storage,"".concat(this.storageKey,"-code-verifier"))),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:n},error:s}=t;if(s)throw s;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(s){await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,n=null;"pkce"===this.flowType&&([r,n]=await yt(this.storage,this.storageKey,!0));try{return await Pt(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(Ue(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async t=>{var r,n,s,a,o;const{data:i,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await Pt(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(a=i.session)||void 0===a?void 0:a.access_token)&&void 0!==o?o:void 0})});if(n)throw n;return lt()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null===r||void 0===r?void 0:r.url),{data:{provider:e.provider,url:null===r||void 0===r?void 0:r.url},error:null}}catch(r){if(Ue(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:s,error:a}=t;if(a)throw a;return await Pt(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:null!==(n=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{const r=Date.now();return await function(e,t){const r=new Promise((r,n)=>{(async()=>{for(let s=0;s<1/0;s++)try{const n=await e(s);if(!t(s,null,n))return void r(n)}catch(It){if(!t(s,It))return void n(It)}})()});return r}(async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:Tt})),(e,t)=>{const n=200*Math.pow(2,e);return t&&Ye(t)&&Date.now()+n-r<De})}catch(r){if(this._debug(t,"error",r),Ue(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return"object"===typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),lt()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await mt(this.storage,this.storageKey);if(s&&this.userStorage){let t=await mt(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:s.user},await ht(this.userStorage,this.storageKey+"-user",t)),s.user=null!==(e=null===t||void 0===t?void 0:t.user)&&void 0!==e?e:Nt()}else if(s&&!s.user&&!s.user){const e=await mt(this.storage,this.storageKey+"-user");e&&(null===e||void 0===e?void 0:e.user)?(s.user=e.user,await pt(this.storage,this.storageKey+"-user"),await ht(this.storage,this.storageKey,s)):s.user=Nt()}if(this._debug(r,"session from storage",s),!this._isValidSession(s))return this._debug(r,"session is not valid"),void(null!==s&&await this._removeSession());const a=1e3*(null!==(t=s.expires_at)&&void 0!==t?t:1/0)-Date.now()<Me;if(this._debug(r,"session has".concat(a?"":" not"," expired with margin of ").concat(Me,"s")),a){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),Ye(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(s.access_token);!t&&(null===e||void 0===e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(n){console.error("Error getting user data:",n),this._debug(r,"error getting user data, skipping SIGNED_IN notification",n)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return this._debug(r,"error",s),void console.error(s)}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Ve;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(n,"begin");try{this.refreshingDeferred=new gt;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new Ve;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const n={session:t.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(s){if(this._debug(n,"error",s),Ue(s)){const e={session:null,error:s};return Ye(s)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n="#_notifyAllSubscribers(".concat(e,")");this._debug(n,"begin",t,"broadcast = ".concat(r));try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],s=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(It){n.push(It)}});if(await Promise.all(s),n.length>0){for(let e=0;e<n.length;e+=1)console.error(n[e]);throw n[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await ht(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const n=St(e);await ht(this.storage,this.storageKey,n)}else{const e=St(t);await ht(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await pt(this.storage,this.storageKey),await pt(this.storage,this.storageKey+"-code-verifier"),await pt(this.storage,this.storageKey+"-user"),this.userStorage&&await pt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&lt()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(It){console.error("removing visibilitychange callback failed",It)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),De);this.autoRefreshTicker=e,e&&"object"===typeof e&&"function"===typeof e.unref?e.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const n=Math.floor((1e3*r.expires_at-e)/De);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(n," ticks, a tick lasts ").concat(De,"ms, refresh threshold is ").concat(3," ticks")),n<=3&&await this._callRefreshToken(r.refresh_token)})}catch(It){console.error("Auto refresh tick failed with error. This is likely a transient error.",It)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(It){if(!(It.isAcquireTimeout||It instanceof zt))throw It;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!lt()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=["provider=".concat(encodeURIComponent(t))];if((null===r||void 0===r?void 0:r.redirectTo)&&n.push("redirect_to=".concat(encodeURIComponent(r.redirectTo))),(null===r||void 0===r?void 0:r.scopes)&&n.push("scopes=".concat(encodeURIComponent(r.scopes))),"pkce"===this.flowType){const[e,t]=await yt(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(e)),code_challenge_method:"".concat(encodeURIComponent(t))});n.push(r.toString())}if(null===r||void 0===r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);n.push(e.toString())}return(null===r||void 0===r?void 0:r.skipBrowserRedirect)&&n.push("skip_http_redirect=".concat(r.skipBrowserRedirect)),"".concat(e,"?").concat(n.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;return s?{data:null,error:s}:await Pt(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null===(r=null===n||void 0===n?void 0:n.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:s,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:i,error:l}=await Pt(this.fetch,"POST","".concat(this.url,"/factors"),{body:o,headers:this.headers,jwt:null===(r=null===s||void 0===s?void 0:s.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(n=null===i||void 0===i?void 0:i.totp)||void 0===n?void 0:n.qr_code)&&(i.totp.qr_code="data:image/svg+xml;utf-8,".concat(i.totp.qr_code)),{data:i,error:null})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return{data:null,error:s};const{data:a,error:o}=await Pt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null===n||void 0===n?void 0:n.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;return s?{data:null,error:s}:await Pt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:{channel:e.channel},headers:this.headers,jwt:null===(r=null===n||void 0===n?void 0:n.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null===e||void 0===e?void 0:e.factors)||[],n=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status),s=r.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:n,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:s}=e;if(s)return{data:null,error:s};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=ft(n.access_token);let o=null;a.aal&&(o=a.aal);let i=o;(null!==(r=null===(t=n.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(i="aal2");return{data:{currentLevel:o,nextLevel:i,currentAuthenticationMethods:a.amr||[]},error:null}}))}async fetchJwk(e){let t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]}).keys.find(t=>t.kid===e);if(t)return t;const r=Date.now();if(t=this.jwks.keys.find(t=>t.kid===e),t&&this.jwks_cached_at+6e5>r)return t;const{data:n,error:s}=await Pt(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(s)throw s;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=r,t=n.keys.find(t=>t.kid===e),t||null):null}async getClaims(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};r=e.session.access_token}const{header:n,payload:s,signature:a,raw:{header:o,payload:i}}=ft(r);(null===t||void 0===t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const l=n.alg&&!n.alg.startsWith("HS")&&n.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(n.kid,(null===t||void 0===t?void 0:t.keys)?{keys:t.keys}:null===t||void 0===t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:s,header:n,signature:a},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(n.alg),d=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,a,function(e){const t=[];return at(e,e=>t.push(e)),new Uint8Array(t)}("".concat(o,".").concat(i))))throw new Xe("Invalid JWT signature");return{data:{claims:s,header:n,signature:a},error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}}}Jt.nextInstanceID=0;const Yt=Jt;class Qt extends Yt{constructor(e){super(e)}}var Xt=function(e,t,r,n){return new(r||(r=Promise))(function(s,a){function o(e){try{l(n.next(e))}catch(It){a(It)}}function i(e){try{l(n.throw(e))}catch(It){a(It)}}function l(e){e.done?s(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};class $t{constructor(e,t,r){var n,s,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=function(e){return e.endsWith("/")?e:e+"/"}(e),i=new URL(o);this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const l="sb-".concat(i.hostname.split(".")[0],"-auth-token"),c=function(e,t){var r,n;const{db:s,auth:a,realtime:o,global:i}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),a),realtime:Object.assign(Object.assign({},d),o),storage:{},global:Object.assign(Object.assign(Object.assign({},u),i),{headers:Object.assign(Object.assign({},null!==(r=null===u||void 0===u?void 0:u.headers)&&void 0!==r?r:{}),null!==(n=null===i||void 0===i?void 0:i.headers)&&void 0!==n?n:{})}),accessToken:()=>Ie(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!==r&&void 0!==r?r:{},{db:Ne,realtime:ke,auth:Object.assign(Object.assign({},Se),{storageKey:l}),global:je});this.storageKey=null!==(n=c.auth.storageKey)&&void 0!==n?n:"",this.headers=null!==(s=c.global.headers)&&void 0!==s?s:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(a=c.auth)&&void 0!==a?a:{},this.headers,c.global.fetch),this.fetch=Pe(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.rest=new u(new URL("rest/v1",i).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new be(this.storageUrl.href,this.headers,this.fetch,null===r||void 0===r?void 0:r.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new c(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.rest.rpc(e,t,r)}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Xt(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient(e,t,r){let{autoRefreshToken:n,persistSession:s,detectSessionInUrl:a,storage:o,storageKey:i,flowType:l,lock:c,debug:d}=e;const u={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new Qt({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),t),storageKey:i,autoRefreshToken:n,persistSession:s,detectSessionInUrl:a,storage:o,flowType:l,lock:c,debug:d,fetch:r,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Q(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null===e||void 0===e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null===t||void 0===t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=r}}(function(){if("undefined"!==typeof window)return!1;if("undefined"===typeof process)return!1;const e=process.version;if(void 0===e||null===e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("\u26a0\ufe0f  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Zt="https://kqotdxuhptpkmbsrvjga.supabase.co",er="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",tr=Boolean(Zt&&er);tr||console.warn("Supabase env not set. Define REACT_APP_SUPABASE_URL and REACT_APP_SUPABASE_ANON_KEY.");let rr=null;tr&&(rr=((e,t,r)=>new $t(e,t,r))(Zt,er,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"}}));const nr=rr||{auth:{onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}}),signOut:async()=>({error:null}),signUp:async()=>{throw new Error("Supabase is not configured")},signInWithPassword:async()=>{throw new Error("Supabase is not configured")},resetPasswordForEmail:async()=>{throw new Error("Supabase is not configured")},getUser:async()=>({data:{user:null},error:null})}},sr=async()=>{if(!tr)return null;const{data:{user:e},error:t}=await nr.auth.getUser();return t?(console.error("Error getting user:",t),null):e},ar=e=>!!e&&null!==e.email_confirmed_at,or=async()=>{const{error:e}=await nr.auth.signOut();if(e)throw console.error("Error signing out:",e),e},ir=async e=>{const{error:t}=await nr.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(t)throw t},lr=async e=>{const{error:t}=await nr.auth.updateUser({password:e});if(t)throw t}},829:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(736));t.default=class{constructor(e,t){let{headers:r={},schema:n,fetch:s}=t;this.url=e,this.headers=new Headers(r),this.schema=n,this.fetch=s}select(e){let{head:t=!1,count:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t?"HEAD":"GET";let a=!1;const o=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer","count=".concat(r)),new s.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e){let{count:t,defaultToNull:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;if(t&&this.headers.append("Prefer","count=".concat(t)),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e){let{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:a=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var o;if(this.headers.append("Prefer","resolution=".concat(r?"ignore":"merge","-duplicates")),void 0!==t&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer","count=".concat(n)),a||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}update(e){let{count:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;return t&&this.headers.append("Prefer","count=".concat(t)),new s.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete(){let{count:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return e&&this.headers.append("Prefer","count=".concat(e)),new s.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}}},877:(e,t,r)=>{r.d(t,{A:()=>c,assetsService:()=>l});var n=r(722);const s=async e=>{var t,r;const n=await o.get("/assets/".concat(e,"/download"),{responseType:"blob"}),s=(null===(t=n.headers)||void 0===t?void 0:t["content-type"])||"application/octet-stream",a=i(null===(r=n.headers)||void 0===r?void 0:r["content-disposition"])||"download";return{blob:new Blob([n.data],{type:s}),contentType:s,filename:a}},a=(()=>{if("undefined"!==typeof window){const e=window.location.host,t=window.location.protocol;if(e.includes("ondigitalocean.app"))return"".concat(t,"//").concat(e,"/api/company-docs-enhanced");if({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL){const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL.replace(/\/$/,"");return"".concat(e,"/company-docs-enhanced")}return"http://localhost:5000/api/company-docs-enhanced"}return{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL?"".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL.replace(/\/$/,""),"/company-docs-enhanced"):"http://localhost:5000/api/company-docs-enhanced"})(),o=n.A.create({baseURL:a});o.interceptors.request.use(e=>{const t="undefined"!==typeof sessionStorage&&(sessionStorage.getItem("authToken")||sessionStorage.getItem("token"))||"undefined"!==typeof localStorage&&(localStorage.getItem("authToken")||localStorage.getItem("token"));return t&&(e.headers.Authorization="Bearer ".concat(t)),e});const i=e=>{try{if(!e||"string"!==typeof e)return null;const t=e.match(/filename\*=UTF-8''([^;]+)/i);if(t&&t[1])return decodeURIComponent(t[1]);const r=e.match(/filename\s*=\s*"?([^";]+)"?/i);if(r&&r[1])return r[1]}catch(Pr){}return null},l={list:async function(){var e;let{parentId:t=null,search:r="",page:n=1,limit:s=50,sortBy:a,sortOrder:i,type:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const c={parentId:null===t?"null":t,page:n,limit:s};r&&(c.search=r),a&&(c.sortBy=a),i&&(c.sortOrder=i),l&&(c.type=l);return null===(e=(await o.get("/assets",{params:c})).data)||void 0===e?void 0:e.data},listFolders:async function(){let{parentId:e=null,sortBy:t="title",sortOrder:r="asc",limit:n=1e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=await l.list({parentId:e,type:"FOLDER",sortBy:t,sortOrder:r,limit:n});return(null===s||void 0===s?void 0:s.assets)||[]},get:async e=>{var t,r;return null===(t=(await o.get("/assets/".concat(e))).data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.asset},getViewUrl:async e=>{var t;return null===(t=(await o.get("/assets/".concat(e,"/view-url"))).data)||void 0===t?void 0:t.data},createFolder:async e=>{let{name:t,parentId:r=null,description:n="",metadata:s=null}=e;try{var a,i,l;console.log("Creating folder with payload:",{name:t,parentId:r,description:n,metadata:s});const e="OFFICE_DOCUMENTS",c={name:t,title:t,folderName:t,description:n||"",parentId:r&&"null"!==r&&"undefined"!==r?r:null,section:e,isPublic:!1,accessLevel:"private",type:"FOLDER",tags:[],isActive:!0,version:1,metadata:s};console.log("Using section:",e),console.log("Sending payload to /folders:",c);const d=await o.post("/folders",c);return console.log("Folder created successfully:",d.data),(null===(a=d.data)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.folder)||(null===(l=d.data)||void 0===l?void 0:l.data)||d.data}catch(f){var c,d,u,h,m,p,g;console.error("Error in createFolder:",{message:f.message,response:null===(c=f.response)||void 0===c?void 0:c.data,status:null===(d=f.response)||void 0===d?void 0:d.status,config:{url:null===(u=f.config)||void 0===u?void 0:u.url,method:null===(h=f.config)||void 0===h?void 0:h.method,data:null===(m=f.config)||void 0===m?void 0:m.data}});const e=(null===(p=f.response)||void 0===p||null===(g=p.data)||void 0===g?void 0:g.message)||"Failed to create folder",t=new Error(e);throw t.response=f.response,t}},updateAsset:async(e,t)=>{var r,n;return null===(r=(await o.patch("/assets/".concat(e),t)).data)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.asset},bulkOperation:async e=>{var t;let{operation:r,assetIds:n,data:s={}}=e;return null===(t=(await o.post("/bulk-operation",{operation:r,assetIds:n,data:s})).data)||void 0===t?void 0:t.data},uploadFiles:async function(){let{files:e,parentId:t=null,description:r="",tags:n=[],metadata:s={},onUploadProgress:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=new FormData;for(const o of e)i.append("files",o);null!==t&&i.append("parentId",t),r&&i.append("description",r),null!==n&&void 0!==n&&n.length&&i.append("tags",JSON.stringify(n)),s&&Object.keys(s).length>0&&i.append("metadata",JSON.stringify(s));const l={headers:{"Content-Type":"multipart/form-data"}};"function"===typeof a&&(l.onUploadProgress=a);try{const e=await o.post("/assets/upload",i,l);if(console.log("Upload response:",e),e.data&&e.data.success)return e.data.data;var c;throw new Error((null===(c=e.data)||void 0===c?void 0:c.message)||"Upload failed")}catch(d){throw console.error("Upload error in assetsService:",d),d}},downloadUrl:e=>"".concat(a,"/assets/").concat(e,"/download"),downloadBlob:s,openInNewTab:async e=>{const t=(()=>{try{return window.open("about:blank","_blank")}catch(Pr){return null}})();try{const{blob:r}=await s(e),n=URL.createObjectURL(r);t?t.location.href=n:window.location.href=n,setTimeout(()=>URL.revokeObjectURL(n),6e4)}catch(r){try{t&&!t.closed&&t.close()}catch(Pr){}throw r}},saveToDisk:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"download";const{blob:r,filename:n}=await s(e),a=URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=n||t,document.body.appendChild(o),o.click(),o.remove(),setTimeout(()=>URL.revokeObjectURL(a),6e4)}},c=l},950:(e,t,r)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(730)},980:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const s=n(r(210));t.PostgrestClient=s.default;const a=n(r(829));t.PostgrestQueryBuilder=a.default;const o=n(r(736));t.PostgrestFilterBuilder=o.default;const i=n(r(374));t.PostgrestTransformBuilder=i.default;const l=n(r(286));t.PostgrestBuilder=l.default;const c=n(r(611));t.PostgrestError=c.default,t.default={PostgrestClient:s.default,PostgrestQueryBuilder:a.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:l.default,PostgrestError:c.default}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(n,s){if(1&s&&(n=this(n)),8&s)return n;if("object"===typeof n&&n){if(4&s&&n.__esModule)return n;if(16&s&&"function"===typeof n.then)return n}var a=Object.create(null);r.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var i=2&s&&n;("object"==typeof i||"function"==typeof i)&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach(e=>o[e]=()=>n[e]);return o.default=()=>n,r.d(a,o),a}})(),r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,n)=>(r.f[n](e,t),t),[])),r.u=e=>"static/js/"+e+".d446f02c.chunk.js",r.miniCssF=e=>{},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(It){if("object"===typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="react-dashboard:";r.l=(n,s,a,o)=>{if(e[n])e[n].push(s);else{var i,l;if(void 0!==a)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+a){i=u;break}}i||(l=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.setAttribute("data-webpack",t+a),i.src=n),e[n]=[s];var h=(t,r)=>{i.onerror=i.onload=null,clearTimeout(m);var s=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),s&&s.forEach(e=>e(r)),t)return t(r)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),l&&document.head.appendChild(i)}}})(),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/",(()=>{var e={792:0};r.f.j=(t,n)=>{var s=r.o(e,t)?e[t]:void 0;if(0!==s)if(s)n.push(s[2]);else{var a=new Promise((r,n)=>s=e[t]=[r,n]);n.push(s[2]=a);var o=r.p+r.u(t),i=new Error;r.l(o,n=>{if(r.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var a=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",i.name="ChunkLoadError",i.type=a,i.request=o,s[1](i)}},"chunk-"+t,t)}};var t=(t,n)=>{var s,a,o=n[0],i=n[1],l=n[2],c=0;if(o.some(t=>0!==e[t])){for(s in i)r.o(i,s)&&(r.m[s]=i[s]);if(l)l(r)}for(t&&t(n);c<o.length;c++)a=o[c],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0},n=self.webpackChunkreact_dashboard=self.webpackChunkreact_dashboard||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n={};r.r(n),r.d(n,{Decoder:()=>ni,Encoder:()=>ti,PacketType:()=>ei,protocol:()=>Zo});var s={};r.r(s),r.d(s,{FILE:()=>bm,HTML:()=>Nm,TEXT:()=>jm,URL:()=>wm});var a,o=r(43),i=r.t(o,2),l=r(391),c=r(950),d=r.t(c,2);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(a||(a={}));const h="popstate";function m(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function p(e,t){return{usr:e.state,key:e.key,idx:t}}function g(e,t,r,n){return void 0===r&&(r=null),u({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?x(t):t,{state:r,key:t&&t.key||n||Math.random().toString(36).substr(2,8)})}function f(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&"?"!==r&&(t+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function x(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function v(e,t,r,n){void 0===n&&(n={});let{window:s=document.defaultView,v5Compat:o=!1}=n,i=s.history,l=a.Pop,c=null,d=x();function x(){return(i.state||{idx:null}).idx}function v(){l=a.Pop;let e=x(),t=null==e?null:e-d;d=e,c&&c({action:l,location:b.location,delta:t})}function y(e){let t="null"!==s.location.origin?s.location.origin:s.location.href,r="string"===typeof e?e:f(e);return r=r.replace(/ $/,"%20"),m(t,"No window.location.(origin|href) available to create URL for href: "+r),new URL(r,t)}null==d&&(d=0,i.replaceState(u({},i.state,{idx:d}),""));let b={get action(){return l},get location(){return e(s,i)},listen(e){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(h,v),c=e,()=>{s.removeEventListener(h,v),c=null}},createHref:e=>t(s,e),createURL:y,encodeLocation(e){let t=y(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l=a.Push;let n=g(b.location,e,t);r&&r(n,e),d=x()+1;let u=p(n,d),h=b.createHref(n);try{i.pushState(u,"",h)}catch(m){if(m instanceof DOMException&&"DataCloneError"===m.name)throw m;s.location.assign(h)}o&&c&&c({action:l,location:b.location,delta:1})},replace:function(e,t){l=a.Replace;let n=g(b.location,e,t);r&&r(n,e),d=x();let s=p(n,d),u=b.createHref(n);i.replaceState(s,"",u),o&&c&&c({action:l,location:b.location,delta:0})},go:e=>i.go(e)};return b}var y;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(y||(y={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function b(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&"/"!==n?null:e.slice(r)||"/"}function w(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+r+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function j(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function N(e,t){let r=j(e);return t?r.map((e,t)=>t===r.length-1?e.pathname:e.pathnameBase):r.map(e=>e.pathnameBase)}function S(e,t,r,n){let s;void 0===n&&(n=!1),"string"===typeof e?s=x(e):(s=u({},e),m(!s.pathname||!s.pathname.includes("?"),w("?","pathname","search",s)),m(!s.pathname||!s.pathname.includes("#"),w("#","pathname","hash",s)),m(!s.search||!s.search.includes("#"),w("#","search","hash",s)));let a,o=""===e||""===s.pathname,i=o?"/":s.pathname;if(null==i)a=r;else{let e=t.length-1;if(!n&&i.startsWith("..")){let t=i.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}a=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:r,search:n="",hash:s=""}="string"===typeof e?x(e):e,a=r?r.startsWith("/")?r:function(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)}),r.length>1?r.join("/"):"/"}(r,t):t;return{pathname:a,search:A(n),hash:C(s)}}(s,a),c=i&&"/"!==i&&i.endsWith("/"),d=(o||"."===i)&&r.endsWith("/");return l.pathname.endsWith("/")||!c&&!d||(l.pathname+="/"),l}const k=e=>e.join("/").replace(/\/\/+/g,"/"),A=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",C=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;const E=["post","put","patch","delete"],P=(new Set(E),["get",...E]);new Set(P),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},I.apply(this,arguments)}const T=o.createContext(null);const D=o.createContext(null);const M=o.createContext(null);const _=o.createContext({outlet:null,matches:[],isDataRoute:!1});function O(){return null!=o.useContext(M)}function L(){return O()||m(!1),o.useContext(M).location}function R(e){o.useContext(D).static||o.useLayoutEffect(e)}function F(){let{isDataRoute:e}=o.useContext(_);return e?function(){let{router:e}=W(U.UseNavigateStable),t=z(B.UseNavigateStable),r=o.useRef(!1);R(()=>{r.current=!0});let n=o.useCallback(function(n,s){void 0===s&&(s={}),r.current&&("number"===typeof n?e.navigate(n):e.navigate(n,I({fromRouteId:t},s)))},[e,t]);return n}():function(){O()||m(!1);let e=o.useContext(T),{basename:t,future:r,navigator:n}=o.useContext(D),{matches:s}=o.useContext(_),{pathname:a}=L(),i=JSON.stringify(N(s,r.v7_relativeSplatPath)),l=o.useRef(!1);return R(()=>{l.current=!0}),o.useCallback(function(r,s){if(void 0===s&&(s={}),!l.current)return;if("number"===typeof r)return void n.go(r);let o=S(r,JSON.parse(i),a,"path"===s.relative);null==e&&"/"!==t&&(o.pathname="/"===o.pathname?t:k([t,o.pathname])),(s.replace?n.replace:n.push)(o,s.state,s)},[t,n,i,a,e])}()}o.Component;var U=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(U||{}),B=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(B||{});function W(e){let t=o.useContext(T);return t||m(!1),t}function z(e){let t=function(){let e=o.useContext(_);return e||m(!1),e}(),r=t.matches[t.matches.length-1];return r.route.id||m(!1),r.route.id}function V(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}i.startTransition;function H(e){let{basename:t="/",children:r=null,location:n,navigationType:s=a.Pop,navigator:i,static:l=!1,future:c}=e;O()&&m(!1);let d=t.replace(/^\/*/,"/"),u=o.useMemo(()=>({basename:d,navigator:i,static:l,future:I({v7_relativeSplatPath:!1},c)}),[d,c,i,l]);"string"===typeof n&&(n=x(n));let{pathname:h="/",search:p="",hash:g="",state:f=null,key:v="default"}=n,y=o.useMemo(()=>{let e=b(h,d);return null==e?null:{location:{pathname:e,search:p,hash:g,state:f,key:v},navigationType:s}},[d,h,p,g,f,v,s]);return null==y?null:o.createElement(D.Provider,{value:u},o.createElement(M.Provider,{children:r,value:y}))}new Promise(()=>{});o.Component;new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(It){}new Map;const q=i.startTransition;d.flushSync,i.useId;function K(e){let{basename:t,children:r,future:n,window:s}=e,a=o.useRef();var i;null==a.current&&(a.current=(void 0===(i={window:s,v5Compat:!0})&&(i={}),v(function(e,t){let{pathname:r,search:n,hash:s}=e.location;return g("",{pathname:r,search:n,hash:s},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:f(t)},null,i)));let l=a.current,[c,d]=o.useState({action:l.action,location:l.location}),{v7_startTransition:u}=n||{},h=o.useCallback(e=>{u&&q?q(()=>d(e)):d(e)},[d,u]);return o.useLayoutEffect(()=>l.listen(h),[l,h]),o.useEffect(()=>V(n),[n]),o.createElement(H,{basename:t,children:r,location:c.location,navigationType:c.action,navigator:l,future:n})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var G,J;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(G||(G={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(J||(J={}));var Y=r(51);function Q(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function X(e,t,r){Q(e,t),t.set(e,r)}function $(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}function Z(e,t){return e.get($(e,t))}function ee(e,t,r){return e.set($(e,t),r),r}var te="undefined"===typeof window||"Deno"in globalThis;function re(){}function ne(e){return"number"===typeof e&&e>=0&&e!==1/0}function se(e,t){return Math.max(e+(t||0)-Date.now(),0)}function ae(e,t){return"function"===typeof e?e(t):e}function oe(e,t){return"function"===typeof e?e(t):e}function ie(e,t){const{type:r="all",exact:n,fetchStatus:s,predicate:a,queryKey:o,stale:i}=e;if(o)if(n){if(t.queryHash!==ce(o,t.options))return!1}else if(!ue(t.queryKey,o))return!1;if("all"!==r){const e=t.isActive();if("active"===r&&!e)return!1;if("inactive"===r&&e)return!1}return("boolean"!==typeof i||t.isStale()===i)&&((!s||s===t.state.fetchStatus)&&!(a&&!a(t)))}function le(e,t){const{exact:r,status:n,predicate:s,mutationKey:a}=e;if(a){if(!t.options.mutationKey)return!1;if(r){if(de(t.options.mutationKey)!==de(a))return!1}else if(!ue(t.options.mutationKey,a))return!1}return(!n||t.state.status===n)&&!(s&&!s(t))}function ce(e,t){return((null===t||void 0===t?void 0:t.queryKeyHashFn)||de)(e)}function de(e){return JSON.stringify(e,(e,t)=>ge(t)?Object.keys(t).sort().reduce((e,r)=>(e[r]=t[r],e),{}):t)}function ue(e,t){return e===t||typeof e===typeof t&&(!(!e||!t||"object"!==typeof e||"object"!==typeof t)&&Object.keys(t).every(r=>ue(e[r],t[r])))}function he(e,t){if(e===t)return e;const r=pe(e)&&pe(t);if(r||ge(e)&&ge(t)){const n=r?e:Object.keys(e),s=n.length,a=r?t:Object.keys(t),o=a.length,i=r?[]:{},l=new Set(n);let c=0;for(let d=0;d<o;d++){const n=r?d:a[d];(!r&&l.has(n)||r)&&void 0===e[n]&&void 0===t[n]?(i[n]=void 0,c++):(i[n]=he(e[n],t[n]),i[n]===e[n]&&void 0!==e[n]&&c++)}return s===o&&c===s?e:i}return t}function me(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function pe(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function ge(e){if(!fe(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!!fe(r)&&(!!r.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function fe(e){return"[object Object]"===Object.prototype.toString.call(e)}function xe(e,t,r){return"function"===typeof r.structuralSharing?r.structuralSharing(e,t):!1!==r.structuralSharing?he(e,t):t}function ve(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=[...e,t];return r&&n.length>r?n.slice(1):n}function ye(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var be=Symbol();function we(e,t){return!e.queryFn&&null!==t&&void 0!==t&&t.initialPromise?()=>t.initialPromise:e.queryFn&&e.queryFn!==be?e.queryFn:()=>Promise.reject(new Error("Missing queryFn: '".concat(e.queryHash,"'")))}function je(e,t){return"function"===typeof e?e(...t):!!e}function Ne(e,t){Q(e,t),t.add(e)}var Se=e=>setTimeout(e,0);var ke,Ae,Ce,Ee,Pe,Ie,Te=function(){let e=[],t=0,r=e=>{e()},n=e=>{e()},s=Se;const a=n=>{t?e.push(n):s(()=>{r(n)})};return{batch:a=>{let o;t++;try{o=a()}finally{t--,t||(()=>{const t=e;e=[],t.length&&s(()=>{n(()=>{t.forEach(e=>{r(e)})})})})()}return o},batchCalls:e=>function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];a(()=>{e(...r)})},schedule:a,setNotifyFunction:e=>{r=e},setBatchNotifyFunction:e=>{n=e},setScheduler:e=>{s=e}}}(),De=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Me=new(ke=new WeakMap,Ae=new WeakMap,Ce=new WeakMap,class extends De{constructor(){super(),X(this,ke,void 0),X(this,Ae,void 0),X(this,Ce,void 0),ee(Ce,this,e=>{if(!te&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){Z(Ae,this)||this.setEventListener(Z(Ce,this))}onUnsubscribe(){var e;this.hasListeners()||(null===(e=Z(Ae,this))||void 0===e||e.call(this),ee(Ae,this,void 0))}setEventListener(e){var t;ee(Ce,this,e),null===(t=Z(Ae,this))||void 0===t||t.call(this),ee(Ae,this,e(e=>{"boolean"===typeof e?this.setFocused(e):this.onFocus()}))}setFocused(e){Z(ke,this)!==e&&(ee(ke,this,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return"boolean"===typeof Z(ke,this)?Z(ke,this):"hidden"!==(null===(e=globalThis.document)||void 0===e?void 0:e.visibilityState)}}),_e=new(Ee=new WeakMap,Pe=new WeakMap,Ie=new WeakMap,class extends De{constructor(){super(),X(this,Ee,!0),X(this,Pe,void 0),X(this,Ie,void 0),ee(Ie,this,e=>{if(!te&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){Z(Pe,this)||this.setEventListener(Z(Ie,this))}onUnsubscribe(){var e;this.hasListeners()||(null===(e=Z(Pe,this))||void 0===e||e.call(this),ee(Pe,this,void 0))}setEventListener(e){var t;ee(Ie,this,e),null===(t=Z(Pe,this))||void 0===t||t.call(this),ee(Pe,this,e(this.setOnline.bind(this)))}setOnline(e){Z(Ee,this)!==e&&(ee(Ee,this,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return Z(Ee,this)}});function Oe(){let e,t;const r=new Promise((r,n)=>{e=r,t=n});function n(e){Object.assign(r,e),delete r.resolve,delete r.reject}return r.status="pending",r.catch(()=>{}),r.resolve=t=>{n({status:"fulfilled",value:t}),e(t)},r.reject=e=>{n({status:"rejected",reason:e}),t(e)},r}function Le(e){return Math.min(1e3*2**e,3e4)}function Re(e){return"online"!==(null!==e&&void 0!==e?e:"online")||_e.isOnline()}var Fe,Ue=class extends Error{constructor(e){super("CancelledError"),this.revert=null===e||void 0===e?void 0:e.revert,this.silent=null===e||void 0===e?void 0:e.silent}};function Be(e){return e instanceof Ue}function We(e){let t,r=!1,n=0,s=!1;const a=Oe(),o=()=>Me.isFocused()&&("always"===e.networkMode||_e.isOnline())&&e.canRun(),i=()=>Re(e.networkMode)&&e.canRun(),l=r=>{var n,o;s||(s=!0,null===(n=e.onSuccess)||void 0===n||n.call(e,r),null===(o=t)||void 0===o||o(),a.resolve(r))},c=r=>{var n,o;s||(s=!0,null===(n=e.onError)||void 0===n||n.call(e,r),null===(o=t)||void 0===o||o(),a.reject(r))},d=()=>new Promise(r=>{var n;t=e=>{(s||o())&&r(e)},null===(n=e.onPause)||void 0===n||n.call(e)}).then(()=>{var r;(t=void 0,s)||(null===(r=e.onContinue)||void 0===r||r.call(e))}),u=()=>{if(s)return;let t;const a=0===n?e.initialPromise:void 0;try{t=null!==a&&void 0!==a?a:e.fn()}catch(i){t=Promise.reject(i)}Promise.resolve(t).then(l).catch(t=>{var a,i,l;if(s)return;const h=null!==(a=e.retry)&&void 0!==a?a:te?0:3,m=null!==(i=e.retryDelay)&&void 0!==i?i:Le,p="function"===typeof m?m(n,t):m,g=!0===h||"number"===typeof h&&n<h||"function"===typeof h&&h(n,t);var f;!r&&g?(n++,null===(l=e.onFail)||void 0===l||l.call(e,n,t),(f=p,new Promise(e=>{setTimeout(e,f)})).then(()=>o()?void 0:d()).then(()=>{r?c(t):u()})):c(t)})};return{promise:a,cancel:t=>{var r;s||(c(new Ue(t)),null===(r=e.abort)||void 0===r||r.call(e))},continue:()=>{var e;return null===(e=t)||void 0===e||e(),a},cancelRetry:()=>{r=!0},continueRetry:()=>{r=!1},canStart:i,start:()=>(i()?u():d().then(u),a)}}var ze,Ve,He,qe,Ke,Ge,Je,Ye,Qe,Xe=(Fe=new WeakMap,class{constructor(){X(this,Fe,void 0)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ne(this.gcTime)&&ee(Fe,this,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,null!==e&&void 0!==e?e:te?1/0:3e5)}clearGcTimeout(){Z(Fe,this)&&(clearTimeout(Z(Fe,this)),ee(Fe,this,void 0))}}),$e=(ze=new WeakMap,Ve=new WeakMap,He=new WeakMap,qe=new WeakMap,Ke=new WeakMap,Ge=new WeakMap,Je=new WeakMap,Ye=new WeakSet,class extends Xe{constructor(e){var t;super(),Ne(this,Ye),X(this,ze,void 0),X(this,Ve,void 0),X(this,He,void 0),X(this,qe,void 0),X(this,Ke,void 0),X(this,Ge,void 0),X(this,Je,void 0),ee(Je,this,!1),ee(Ge,this,e.defaultOptions),this.setOptions(e.options),this.observers=[],ee(qe,this,e.client),ee(He,this,Z(qe,this).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,ee(ze,this,function(e){const t="function"===typeof e.initialData?e.initialData():e.initialData,r=void 0!==t,n=r?"function"===typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?null!==n&&void 0!==n?n:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}(this.options)),this.state=null!==(t=e.state)&&void 0!==t?t:Z(ze,this),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return null===(e=Z(Ke,this))||void 0===e?void 0:e.promise}setOptions(e){this.options=(0,Y.A)((0,Y.A)({},Z(Ge,this)),e),this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||Z(He,this).remove(this)}setData(e,t){const r=xe(this.state.data,e,this.options);return $(Ye,this,Ze).call(this,{data:r,type:"success",dataUpdatedAt:null===t||void 0===t?void 0:t.updatedAt,manual:null===t||void 0===t?void 0:t.manual}),r}setState(e,t){$(Ye,this,Ze).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var t,r;const n=null===(t=Z(Ke,this))||void 0===t?void 0:t.promise;return null===(r=Z(Ke,this))||void 0===r||r.cancel(e),n?n.then(re).catch(re):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Z(ze,this))}isActive(){return this.observers.some(e=>!1!==oe(e.options.enabled,this))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===be||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===ae(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!se(this.state.dataUpdatedAt,e))}onFocus(){var e;const t=this.observers.find(e=>e.shouldFetchOnWindowFocus());null===t||void 0===t||t.refetch({cancelRefetch:!1}),null===(e=Z(Ke,this))||void 0===e||e.continue()}onOnline(){var e;const t=this.observers.find(e=>e.shouldFetchOnReconnect());null===t||void 0===t||t.refetch({cancelRefetch:!1}),null===(e=Z(Ke,this))||void 0===e||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),Z(He,this).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(Z(Ke,this)&&(Z(Je,this)?Z(Ke,this).cancel({revert:!0}):Z(Ke,this).cancelRetry()),this.scheduleGc()),Z(He,this).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||$(Ye,this,Ze).call(this,{type:"invalidate"})}fetch(e,t){var r,n;if("idle"!==this.state.fetchStatus)if(void 0!==this.state.data&&null!==t&&void 0!==t&&t.cancelRefetch)this.cancel({silent:!0});else if(Z(Ke,this))return Z(Ke,this).continueRetry(),Z(Ke,this).promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const s=new AbortController,a=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(ee(Je,this,!0),s.signal)})},o=()=>{const e=we(this.options,t),r=(()=>{const e={client:Z(qe,this),queryKey:this.queryKey,meta:this.meta};return a(e),e})();return ee(Je,this,!1),this.options.persister?this.options.persister(e,r,this):e(r)},i=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:Z(qe,this),state:this.state,fetchFn:o};return a(e),e})();var l;(null===(r=this.options.behavior)||void 0===r||r.onFetch(i,this),ee(Ve,this,this.state),"idle"===this.state.fetchStatus||this.state.fetchMeta!==(null===(n=i.fetchOptions)||void 0===n?void 0:n.meta))&&$(Ye,this,Ze).call(this,{type:"fetch",meta:null===(l=i.fetchOptions)||void 0===l?void 0:l.meta});const c=e=>{var t,r,n,s;(Be(e)&&e.silent||$(Ye,this,Ze).call(this,{type:"error",error:e}),Be(e))||(null===(t=(r=Z(He,this).config).onError)||void 0===t||t.call(r,e,this),null===(n=(s=Z(He,this).config).onSettled)||void 0===n||n.call(s,this.state.data,e,this));this.scheduleGc()};return ee(Ke,this,We({initialPromise:null===t||void 0===t?void 0:t.initialPromise,fn:i.fetchFn,abort:s.abort.bind(s),onSuccess:e=>{var t,r,n,s;if(void 0!==e){try{this.setData(e)}catch(a){return void c(a)}null===(t=(r=Z(He,this).config).onSuccess)||void 0===t||t.call(r,e,this),null===(n=(s=Z(He,this).config).onSettled)||void 0===n||n.call(s,e,this.state.error,this),this.scheduleGc()}else c(new Error("".concat(this.queryHash," data is undefined")))},onError:c,onFail:(e,t)=>{$(Ye,this,Ze).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{$(Ye,this,Ze).call(this,{type:"pause"})},onContinue:()=>{$(Ye,this,Ze).call(this,{type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0})),Z(Ke,this).start()}});function Ze(e){this.state=(t=>{var r,n;switch(e.type){case"failed":return(0,Y.A)((0,Y.A)({},t),{},{fetchFailureCount:e.failureCount,fetchFailureReason:e.error});case"pause":return(0,Y.A)((0,Y.A)({},t),{},{fetchStatus:"paused"});case"continue":return(0,Y.A)((0,Y.A)({},t),{},{fetchStatus:"fetching"});case"fetch":return(0,Y.A)((0,Y.A)((0,Y.A)({},t),et(t.data,this.options)),{},{fetchMeta:null!==(r=e.meta)&&void 0!==r?r:null});case"success":return ee(Ve,this,void 0),(0,Y.A)((0,Y.A)({},t),{},{data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:null!==(n=e.dataUpdatedAt)&&void 0!==n?n:Date.now(),error:null,isInvalidated:!1,status:"success"},!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null});case"error":const s=e.error;return Be(s)&&s.revert&&Z(Ve,this)?(0,Y.A)((0,Y.A)({},Z(Ve,this)),{},{fetchStatus:"idle"}):(0,Y.A)((0,Y.A)({},t),{},{error:s,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"});case"invalidate":return(0,Y.A)((0,Y.A)({},t),{},{isInvalidated:!0});case"setState":return(0,Y.A)((0,Y.A)({},t),e.state)}})(this.state),Te.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),Z(He,this).notify({query:this,type:"updated",action:e})})}function et(e,t){return(0,Y.A)({fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Re(t.networkMode)?"fetching":"paused"},void 0===e&&{error:null,status:"pending"})}var tt,rt,nt,st,at,ot,it,lt=(Qe=new WeakMap,class extends De{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),X(this,Qe,void 0),this.config=e,ee(Qe,this,new Map)}build(e,t,r){var n;const s=t.queryKey,a=null!==(n=t.queryHash)&&void 0!==n?n:ce(s,t);let o=this.get(a);return o||(o=new $e({client:e,queryKey:s,queryHash:a,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(s)}),this.add(o)),o}add(e){Z(Qe,this).has(e.queryHash)||(Z(Qe,this).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=Z(Qe,this).get(e.queryHash);t&&(e.destroy(),t===e&&Z(Qe,this).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Te.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return Z(Qe,this).get(e)}getAll(){return[...Z(Qe,this).values()]}find(e){const t=(0,Y.A)({exact:!0},e);return this.getAll().find(e=>ie(t,e))}findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>ie(e,t)):t}notify(e){Te.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Te.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Te.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}}),ct=(tt=new WeakMap,rt=new WeakMap,nt=new WeakMap,st=new WeakSet,class extends Xe{constructor(e){super(),Ne(this,st),X(this,tt,void 0),X(this,rt,void 0),X(this,nt,void 0),this.mutationId=e.mutationId,ee(rt,this,e.mutationCache),ee(tt,this,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){Z(tt,this).includes(e)||(Z(tt,this).push(e),this.clearGcTimeout(),Z(rt,this).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){ee(tt,this,Z(tt,this).filter(t=>t!==e)),this.scheduleGc(),Z(rt,this).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){Z(tt,this).length||("pending"===this.state.status?this.scheduleGc():Z(rt,this).remove(this))}continue(){var e,t;return null!==(e=null===(t=Z(nt,this))||void 0===t?void 0:t.continue())&&void 0!==e?e:this.execute(this.state.variables)}async execute(e){var t;const r=()=>{$(st,this,dt).call(this,{type:"continue"})};ee(nt,this,We({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{$(st,this,dt).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{$(st,this,dt).call(this,{type:"pause"})},onContinue:r,retry:null!==(t=this.options.retry)&&void 0!==t?t:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Z(rt,this).canRun(this)}));const n="pending"===this.state.status,s=!Z(nt,this).canStart();try{var a,o,i,l,c,d,u,h;if(n)r();else{var m,p,g,f;$(st,this,dt).call(this,{type:"pending",variables:e,isPaused:s}),await(null===(m=(p=Z(rt,this).config).onMutate)||void 0===m?void 0:m.call(p,e,this));const t=await(null===(g=(f=this.options).onMutate)||void 0===g?void 0:g.call(f,e));t!==this.state.context&&$(st,this,dt).call(this,{type:"pending",context:t,variables:e,isPaused:s})}const t=await Z(nt,this).start();return await(null===(a=(o=Z(rt,this).config).onSuccess)||void 0===a?void 0:a.call(o,t,e,this.state.context,this)),await(null===(i=(l=this.options).onSuccess)||void 0===i?void 0:i.call(l,t,e,this.state.context)),await(null===(c=(d=Z(rt,this).config).onSettled)||void 0===c?void 0:c.call(d,t,null,this.state.variables,this.state.context,this)),await(null===(u=(h=this.options).onSettled)||void 0===u?void 0:u.call(h,t,null,e,this.state.context)),$(st,this,dt).call(this,{type:"success",data:t}),t}catch(k){try{var x,v,y,b,w,j,N,S;throw await(null===(x=(v=Z(rt,this).config).onError)||void 0===x?void 0:x.call(v,k,e,this.state.context,this)),await(null===(y=(b=this.options).onError)||void 0===y?void 0:y.call(b,k,e,this.state.context)),await(null===(w=(j=Z(rt,this).config).onSettled)||void 0===w?void 0:w.call(j,void 0,k,this.state.variables,this.state.context,this)),await(null===(N=(S=this.options).onSettled)||void 0===N?void 0:N.call(S,void 0,k,e,this.state.context)),k}finally{$(st,this,dt).call(this,{type:"error",error:k})}}finally{Z(rt,this).runNext(this)}}});function dt(e){this.state=(t=>{switch(e.type){case"failed":return(0,Y.A)((0,Y.A)({},t),{},{failureCount:e.failureCount,failureReason:e.error});case"pause":return(0,Y.A)((0,Y.A)({},t),{},{isPaused:!0});case"continue":return(0,Y.A)((0,Y.A)({},t),{},{isPaused:!1});case"pending":return(0,Y.A)((0,Y.A)({},t),{},{context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()});case"success":return(0,Y.A)((0,Y.A)({},t),{},{data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1});case"error":return(0,Y.A)((0,Y.A)({},t),{},{data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"})}})(this.state),Te.batch(()=>{Z(tt,this).forEach(t=>{t.onMutationUpdate(e)}),Z(rt,this).notify({mutation:this,type:"updated",action:e})})}var ut,ht,mt,pt,gt,ft,xt,vt,yt=(at=new WeakMap,ot=new WeakMap,it=new WeakMap,class extends De{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),X(this,at,void 0),X(this,ot,void 0),X(this,it,void 0),this.config=e,ee(at,this,new Set),ee(ot,this,new Map),ee(it,this,0)}build(e,t,r){var n;const s=new ct({mutationCache:this,mutationId:ee(it,this,(n=Z(it,this),++n)),options:e.defaultMutationOptions(t),state:r});return this.add(s),s}add(e){Z(at,this).add(e);const t=bt(e);if("string"===typeof t){const r=Z(ot,this).get(t);r?r.push(e):Z(ot,this).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(Z(at,this).delete(e)){const t=bt(e);if("string"===typeof t){const r=Z(ot,this).get(t);if(r)if(r.length>1){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}else r[0]===e&&Z(ot,this).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=bt(e);if("string"===typeof t){const r=Z(ot,this).get(t),n=null===r||void 0===r?void 0:r.find(e=>"pending"===e.state.status);return!n||n===e}return!0}runNext(e){const t=bt(e);if("string"===typeof t){var r,n;const s=null===(r=Z(ot,this).get(t))||void 0===r?void 0:r.find(t=>t!==e&&t.state.isPaused);return null!==(n=null===s||void 0===s?void 0:s.continue())&&void 0!==n?n:Promise.resolve()}return Promise.resolve()}clear(){Te.batch(()=>{Z(at,this).forEach(e=>{this.notify({type:"removed",mutation:e})}),Z(at,this).clear(),Z(ot,this).clear()})}getAll(){return Array.from(Z(at,this))}find(e){const t=(0,Y.A)({exact:!0},e);return this.getAll().find(e=>le(t,e))}findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getAll().filter(t=>le(e,t))}notify(e){Te.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return Te.batch(()=>Promise.all(e.map(e=>e.continue().catch(re))))}});function bt(e){var t;return null===(t=e.options.scope)||void 0===t?void 0:t.id}function wt(e){return{onFetch:(t,r)=>{var n,s,a;const o=t.options,i=null===(n=t.fetchOptions)||void 0===n||null===(n=n.meta)||void 0===n||null===(n=n.fetchMore)||void 0===n?void 0:n.direction,l=(null===(s=t.state.data)||void 0===s?void 0:s.pages)||[],c=(null===(a=t.state.data)||void 0===a?void 0:a.pageParams)||[];let d={pages:[],pageParams:[]},u=0;const h=async()=>{let r=!1;const n=we(t.options,t.fetchOptions),s=async(e,s,a)=>{if(r)return Promise.reject();if(null==s&&e.pages.length)return Promise.resolve(e);const o=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:s,direction:a?"backward":"forward",meta:t.options.meta};var n;return n=e,Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(t.signal.aborted?r=!0:t.signal.addEventListener("abort",()=>{r=!0}),t.signal)}),e})(),i=await n(o),{maxPages:l}=t.options,c=a?ye:ve;return{pages:c(e.pages,i,l),pageParams:c(e.pageParams,s,l)}};if(i&&l.length){const e="backward"===i,t={pages:l,pageParams:c},r=(e?Nt:jt)(o,t);d=await s(t,r,e)}else{const t=null!==e&&void 0!==e?e:l.length;do{var a;const e=0===u?null!==(a=c[0])&&void 0!==a?a:o.initialPageParam:jt(o,d);if(u>0&&null==e)break;d=await s(d,e),u++}while(u<t)}return d};t.options.persister?t.fetchFn=()=>{var e,n;return null===(e=(n=t.options).persister)||void 0===e?void 0:e.call(n,h,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=h}}}function jt(e,t){let{pages:r,pageParams:n}=t;const s=r.length-1;return r.length>0?e.getNextPageParam(r[s],r,n[s],n):void 0}function Nt(e,t){var r;let{pages:n,pageParams:s}=t;return n.length>0?null===(r=e.getPreviousPageParam)||void 0===r?void 0:r.call(e,n[0],n,s[0],s):void 0}var St=(ut=new WeakMap,ht=new WeakMap,mt=new WeakMap,pt=new WeakMap,gt=new WeakMap,ft=new WeakMap,xt=new WeakMap,vt=new WeakMap,class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};X(this,ut,void 0),X(this,ht,void 0),X(this,mt,void 0),X(this,pt,void 0),X(this,gt,void 0),X(this,ft,void 0),X(this,xt,void 0),X(this,vt,void 0),ee(ut,this,e.queryCache||new lt),ee(ht,this,e.mutationCache||new yt),ee(mt,this,e.defaultOptions||{}),ee(pt,this,new Map),ee(gt,this,new Map),ee(ft,this,0)}mount(){var e;ee(ft,this,(e=Z(ft,this),e++,e)),1===Z(ft,this)&&(ee(xt,this,Me.subscribe(async e=>{e&&(await this.resumePausedMutations(),Z(ut,this).onFocus())})),ee(vt,this,_e.subscribe(async e=>{e&&(await this.resumePausedMutations(),Z(ut,this).onOnline())})))}unmount(){var e,t,r;ee(ft,this,(e=Z(ft,this),e--,e)),0===Z(ft,this)&&(null===(t=Z(xt,this))||void 0===t||t.call(this),ee(xt,this,void 0),null===(r=Z(vt,this))||void 0===r||r.call(this),ee(vt,this,void 0))}isFetching(e){return Z(ut,this).findAll((0,Y.A)((0,Y.A)({},e),{},{fetchStatus:"fetching"})).length}isMutating(e){return Z(ht,this).findAll((0,Y.A)((0,Y.A)({},e),{},{status:"pending"})).length}getQueryData(e){var t;const r=this.defaultQueryOptions({queryKey:e});return null===(t=Z(ut,this).get(r.queryHash))||void 0===t?void 0:t.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=Z(ut,this).build(this,t),n=r.state.data;return void 0===n?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(ae(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return Z(ut,this).findAll(e).map(e=>{let{queryKey:t,state:r}=e;return[t,r.data]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),s=Z(ut,this).get(n.queryHash),a=function(e,t){return"function"===typeof e?e(t):e}(t,null===s||void 0===s?void 0:s.state.data);if(void 0!==a)return Z(ut,this).build(this,n).setData(a,(0,Y.A)((0,Y.A)({},r),{},{manual:!0}))}setQueriesData(e,t,r){return Te.batch(()=>Z(ut,this).findAll(e).map(e=>{let{queryKey:n}=e;return[n,this.setQueryData(n,t,r)]}))}getQueryState(e){var t;const r=this.defaultQueryOptions({queryKey:e});return null===(t=Z(ut,this).get(r.queryHash))||void 0===t?void 0:t.state}removeQueries(e){const t=Z(ut,this);Te.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const r=Z(ut,this);return Te.batch(()=>(r.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries((0,Y.A)({type:"active"},e),t)))}cancelQueries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=(0,Y.A)({revert:!0},t),n=Te.batch(()=>Z(ut,this).findAll(e).map(e=>e.cancel(r)));return Promise.all(n).then(re).catch(re)}invalidateQueries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Te.batch(()=>{var r,n;return Z(ut,this).findAll(e).forEach(e=>{e.invalidate()}),"none"===(null===e||void 0===e?void 0:e.refetchType)?Promise.resolve():this.refetchQueries((0,Y.A)((0,Y.A)({},e),{},{type:null!==(r=null!==(n=null===e||void 0===e?void 0:e.refetchType)&&void 0!==n?n:null===e||void 0===e?void 0:e.type)&&void 0!==r?r:"active"}),t)})}refetchQueries(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=(0,Y.A)((0,Y.A)({},r),{},{cancelRefetch:null===(t=r.cancelRefetch)||void 0===t||t}),s=Te.batch(()=>Z(ut,this).findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,n);return n.throwOnError||(t=t.catch(re)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(s).then(re)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const r=Z(ut,this).build(this,t);return r.isStaleByTime(ae(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(re).catch(re)}fetchInfiniteQuery(e){return e.behavior=wt(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(re).catch(re)}ensureInfiniteQueryData(e){return e.behavior=wt(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return _e.isOnline()?Z(ht,this).resumePausedMutations():Promise.resolve()}getQueryCache(){return Z(ut,this)}getMutationCache(){return Z(ht,this)}getDefaultOptions(){return Z(mt,this)}setDefaultOptions(e){ee(mt,this,e)}setQueryDefaults(e,t){Z(pt,this).set(de(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Z(pt,this).values()],r={};return t.forEach(t=>{ue(e,t.queryKey)&&Object.assign(r,t.defaultOptions)}),r}setMutationDefaults(e,t){Z(gt,this).set(de(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Z(gt,this).values()],r={};return t.forEach(t=>{ue(e,t.mutationKey)&&Object.assign(r,t.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t=(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},Z(mt,this).queries),this.getQueryDefaults(e.queryKey)),e),{},{_defaulted:!0});return t.queryHash||(t.queryHash=ce(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===be&&(t.enabled=!1),t}defaultMutationOptions(e){return null!==e&&void 0!==e&&e._defaulted?e:(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},Z(mt,this).mutations),(null===e||void 0===e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey)),e),{},{_defaulted:!0})}clear(){Z(ut,this).clear(),Z(ht,this).clear()}}),kt=r(579),At=o.createContext(void 0),Ct=e=>{const t=o.useContext(At);if(e)return e;if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Et=e=>{let{client:t,children:r}=e;return o.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),(0,kt.jsx)(At.Provider,{value:t,children:r})};function Pt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}let It={data:""},Tt=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||It,Dt=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Mt=/\/\*[^]*?\*\/|  +/g,_t=/\n+/g,Ot=(e,t)=>{let r="",n="",s="";for(let a in e){let o=e[a];"@"==a[0]?"i"==a[1]?r=a+" "+o+";":n+="f"==a[1]?Ot(o,a):a+"{"+Ot(o,"k"==a[1]?"":t)+"}":"object"==typeof o?n+=Ot(o,t?t.replace(/([^,])+/g,e=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):a):null!=o&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=Ot.p?Ot.p(a,o):a+":"+o+";")}return r+(t&&s?t+"{"+s+"}":s)+n},Lt={},Rt=e=>{if("object"==typeof e){let t="";for(let r in e)t+=r+Rt(e[r]);return t}return e},Ft=(e,t,r,n,s)=>{let a=Rt(e),o=Lt[a]||(Lt[a]=(e=>{let t=0,r=11;for(;t<e.length;)r=101*r+e.charCodeAt(t++)>>>0;return"go"+r})(a));if(!Lt[o]){let t=a!==e?e:(e=>{let t,r,n=[{}];for(;t=Dt.exec(e.replace(Mt,""));)t[4]?n.shift():t[3]?(r=t[3].replace(_t," ").trim(),n.unshift(n[0][r]=n[0][r]||{})):n[0][t[1]]=t[2].replace(_t," ").trim();return n[0]})(e);Lt[o]=Ot(s?{["@keyframes "+o]:t}:t,r?"":"."+o)}let i=r&&Lt.g?Lt.g:null;return r&&(Lt.g=Lt[o]),((e,t,r,n)=>{n?t.data=t.data.replace(n,e):-1===t.data.indexOf(e)&&(t.data=r?e+t.data:t.data+e)})(Lt[o],t,n,i),o};function Ut(e){let t=this||{},r=e.call?e(t.p):e;return Ft(r.unshift?r.raw?((e,t,r)=>e.reduce((e,n,s)=>{let a=t[s];if(a&&a.call){let e=a(r),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;a=t?"."+t:e&&"object"==typeof e?e.props?"":Ot(e,""):!1===e?"":e}return e+n+(null==a?"":a)},""))(r,[].slice.call(arguments,1),t.p):r.reduce((e,r)=>Object.assign(e,r&&r.call?r(t.p):r),{}):r,Tt(t.target),t.g,t.o,t.k)}Ut.bind({g:1});let Bt,Wt,zt,Vt=Ut.bind({k:1});function Ht(e,t){let r=this||{};return function(){let n=arguments;function s(a,o){let i=Object.assign({},a),l=i.className||s.className;r.p=Object.assign({theme:Wt&&Wt()},i),r.o=/ *go\d+/.test(l),i.className=Ut.apply(r,n)+(l?" "+l:""),t&&(i.ref=o);let c=e;return e[0]&&(c=i.as||e,delete i.as),zt&&c[0]&&zt(i),Bt(c,i)}return t?t(s):s}}var qt,Kt,Gt,Jt,Yt,Qt,Xt,$t,Zt,er,tr,rr,nr,sr,ar,or,ir=(e,t)=>(e=>"function"==typeof e)(e)?e(t):e,lr=(()=>{let e=0;return()=>(++e).toString()})(),cr=(()=>{let e;return()=>{if(void 0===e&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),dr=(e,t)=>{switch(t.type){case 0:return(0,Y.A)((0,Y.A)({},e),{},{toasts:[t.toast,...e.toasts].slice(0,20)});case 1:return(0,Y.A)((0,Y.A)({},e),{},{toasts:e.toasts.map(e=>e.id===t.toast.id?(0,Y.A)((0,Y.A)({},e),t.toast):e)});case 2:let{toast:r}=t;return dr(e,{type:e.toasts.find(e=>e.id===r.id)?1:0,toast:r});case 3:let{toastId:n}=t;return(0,Y.A)((0,Y.A)({},e),{},{toasts:e.toasts.map(e=>e.id===n||void 0===n?(0,Y.A)((0,Y.A)({},e),{},{dismissed:!0,visible:!1}):e)});case 4:return void 0===t.toastId?(0,Y.A)((0,Y.A)({},e),{},{toasts:[]}):(0,Y.A)((0,Y.A)({},e),{},{toasts:e.toasts.filter(e=>e.id!==t.toastId)});case 5:return(0,Y.A)((0,Y.A)({},e),{},{pausedAt:t.time});case 6:let s=t.time-(e.pausedAt||0);return(0,Y.A)((0,Y.A)({},e),{},{pausedAt:void 0,toasts:e.toasts.map(e=>(0,Y.A)((0,Y.A)({},e),{},{pauseDuration:e.pauseDuration+s}))})}},ur=[],hr={toasts:[],pausedAt:void 0},mr=e=>{hr=dr(hr,e),ur.forEach(e=>{e(hr)})},pr={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},gr=e=>(t,r)=>{let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",r=arguments.length>2?arguments[2]:void 0;return(0,Y.A)((0,Y.A)({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0},r),{},{id:(null==r?void 0:r.id)||lr()})}(t,e,r);return mr({type:2,toast:n}),n.id},fr=(e,t)=>gr("blank")(e,t);fr.error=gr("error"),fr.success=gr("success"),fr.loading=gr("loading"),fr.custom=gr("custom"),fr.dismiss=e=>{mr({type:3,toastId:e})},fr.remove=e=>mr({type:4,toastId:e}),fr.promise=(e,t,r)=>{let n=fr.loading(t.loading,(0,Y.A)((0,Y.A)({},r),null==r?void 0:r.loading));return"function"==typeof e&&(e=e()),e.then(e=>{let s=t.success?ir(t.success,e):void 0;return s?fr.success(s,(0,Y.A)((0,Y.A)({id:n},r),null==r?void 0:r.success)):fr.dismiss(n),e}).catch(e=>{let s=t.error?ir(t.error,e):void 0;s?fr.error(s,(0,Y.A)((0,Y.A)({id:n},r),null==r?void 0:r.error)):fr.dismiss(n)}),e};var xr=(e,t)=>{mr({type:1,toast:{id:e,height:t}})},vr=()=>{mr({type:5,time:Date.now()})},yr=new Map,br=e=>{let{toasts:t,pausedAt:r}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,o.useState)(hr),n=(0,o.useRef)(hr);(0,o.useEffect)(()=>(n.current!==hr&&r(hr),ur.push(r),()=>{let e=ur.indexOf(r);e>-1&&ur.splice(e,1)}),[]);let s=t.toasts.map(t=>{var r,n,s;return(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},e),e[t.type]),t),{},{removeDelay:t.removeDelay||(null==(r=e[t.type])?void 0:r.removeDelay)||(null==e?void 0:e.removeDelay),duration:t.duration||(null==(n=e[t.type])?void 0:n.duration)||(null==e?void 0:e.duration)||pr[t.type],style:(0,Y.A)((0,Y.A)((0,Y.A)({},e.style),null==(s=e[t.type])?void 0:s.style),t.style)})});return(0,Y.A)((0,Y.A)({},t),{},{toasts:s})}(e);(0,o.useEffect)(()=>{if(r)return;let e=Date.now(),n=t.map(t=>{if(t.duration===1/0)return;let r=(t.duration||0)+t.pauseDuration-(e-t.createdAt);if(!(r<0))return setTimeout(()=>fr.dismiss(t.id),r);t.visible&&fr.dismiss(t.id)});return()=>{n.forEach(e=>e&&clearTimeout(e))}},[t,r]);let n=(0,o.useCallback)(()=>{r&&mr({type:6,time:Date.now()})},[r]),s=(0,o.useCallback)((e,r)=>{let{reverseOrder:n=!1,gutter:s=8,defaultPosition:a}=r||{},o=t.filter(t=>(t.position||a)===(e.position||a)&&t.height),i=o.findIndex(t=>t.id===e.id),l=o.filter((e,t)=>t<i&&e.visible).length;return o.filter(e=>e.visible).slice(...n?[l+1]:[0,l]).reduce((e,t)=>e+(t.height||0)+s,0)},[t]);return(0,o.useEffect)(()=>{t.forEach(e=>{if(e.dismissed)!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(yr.has(e))return;let r=setTimeout(()=>{yr.delete(e),mr({type:4,toastId:e})},t);yr.set(e,r)}(e.id,e.removeDelay);else{let t=yr.get(e.id);t&&(clearTimeout(t),yr.delete(e.id))}})},[t]),{toasts:t,handlers:{updateHeight:xr,startPause:vr,endPause:n,calculateOffset:s}}},wr=Vt(qt||(qt=Pt(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]))),jr=Vt(Kt||(Kt=Pt(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),Nr=Vt(Gt||(Gt=Pt(["\nfrom {\n  transform: scale(0) rotate(90deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n\topacity: 1;\n}"]))),Sr=Ht("div")(Jt||(Jt=Pt(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"])),e=>e.primary||"#ff4b4b",wr,jr,e=>e.secondary||"#fff",Nr),kr=Vt(Yt||(Yt=Pt(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),Ar=Ht("div")(Qt||(Qt=Pt(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"])),e=>e.secondary||"#e0e0e0",e=>e.primary||"#616161",kr),Cr=Vt(Xt||(Xt=Pt(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n\topacity: 1;\n}"]))),Er=Vt($t||($t=Pt(["\n0% {\n\theight: 0;\n\twidth: 0;\n\topacity: 0;\n}\n40% {\n  height: 0;\n\twidth: 6px;\n\topacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]))),Pr=Ht("div")(Zt||(Zt=Pt(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"])),e=>e.primary||"#61d345",Cr,Er,e=>e.secondary||"#fff"),Ir=Ht("div")(er||(er=Pt(["\n  position: absolute;\n"]))),Tr=Ht("div")(tr||(tr=Pt(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]))),Dr=Vt(rr||(rr=Pt(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),Mr=Ht("div")(nr||(nr=Pt(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"])),Dr),_r=e=>{let{toast:t}=e,{icon:r,type:n,iconTheme:s}=t;return void 0!==r?"string"==typeof r?o.createElement(Mr,null,r):r:"blank"===n?null:o.createElement(Tr,null,o.createElement(Ar,(0,Y.A)({},s)),"loading"!==n&&o.createElement(Ir,null,"error"===n?o.createElement(Sr,(0,Y.A)({},s)):o.createElement(Pr,(0,Y.A)({},s))))},Or=e=>"\n0% {transform: translate3d(0,".concat(-200*e,"%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n"),Lr=e=>"\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,".concat(-150*e,"%,-1px) scale(.6); opacity:0;}\n"),Rr=Ht("div")(sr||(sr=Pt(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]))),Fr=Ht("div")(ar||(ar=Pt(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"]))),Ur=o.memo(e=>{let{toast:t,position:r,style:n,children:s}=e,a=t.height?((e,t)=>{let r=e.includes("top")?1:-1,[n,s]=cr()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[Or(r),Lr(r)];return{animation:t?"".concat(Vt(n)," 0.35s cubic-bezier(.21,1.02,.73,1) forwards"):"".concat(Vt(s)," 0.4s forwards cubic-bezier(.06,.71,.55,1)")}})(t.position||r||"top-center",t.visible):{opacity:0},i=o.createElement(_r,{toast:t}),l=o.createElement(Fr,(0,Y.A)({},t.ariaProps),ir(t.message,t));return o.createElement(Rr,{className:t.className,style:(0,Y.A)((0,Y.A)((0,Y.A)({},a),n),t.style)},"function"==typeof s?s({icon:i,message:l}):o.createElement(o.Fragment,null,i,l))});!function(e,t,r,n){Ot.p=t,Bt=e,Wt=r,zt=n}(o.createElement);var Br=e=>{let{id:t,className:r,style:n,onHeightUpdate:s,children:a}=e,i=o.useCallback(e=>{if(e){let r=()=>{let r=e.getBoundingClientRect().height;s(t,r)};r(),new MutationObserver(r).observe(e,{subtree:!0,childList:!0,characterData:!0})}},[t,s]);return o.createElement("div",{ref:i,className:r,style:n},a)},Wr=Ut(or||(or=Pt(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"]))),zr=e=>{let{reverseOrder:t,position:r="top-center",toastOptions:n,gutter:s,children:a,containerStyle:i,containerClassName:l}=e,{toasts:c,handlers:d}=br(n);return o.createElement("div",{id:"_rht_toaster",style:(0,Y.A)({position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none"},i),className:l,onMouseEnter:d.startPause,onMouseLeave:d.endPause},c.map(e=>{let n=e.position||r,i=((e,t)=>{let r=e.includes("top"),n=r?{top:0}:{bottom:0},s=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return(0,Y.A)((0,Y.A)({left:0,right:0,display:"flex",position:"absolute",transition:cr()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:"translateY(".concat(t*(r?1:-1),"px)")},n),s)})(n,d.calculateOffset(e,{reverseOrder:t,gutter:s,defaultPosition:r}));return o.createElement(Br,{id:e.id,key:e.id,onHeightUpdate:d.updateHeight,className:e.visible?Wr:"",style:i},"custom"===e.type?ir(e.message,e):a?a(e):o.createElement(Ur,{toast:e,position:n}))}))},Vr=fr;const Hr=e=>{var t,r;return e?e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):null!==(t=e.user_metadata)&&void 0!==t&&t.first_name&&null!==(r=e.user_metadata)&&void 0!==r&&r.last_name?"".concat(e.user_metadata.first_name," ").concat(e.user_metadata.last_name):e.name?e.name:e.email?e.email:"Unknown User":"Unknown User"},qr=e=>{if(!e)return"U";const t=(e=>{var t;return e?e.firstName?e.firstName:null!==(t=e.user_metadata)&&void 0!==t&&t.first_name?e.user_metadata.first_name:e.name?e.name.split(" ")[0]:e.email?e.email.split("@")[0]:"Unknown":"Unknown"})(e),r=(e=>{var t;if(!e)return"User";if(e.lastName)return e.lastName;if(null!==(t=e.user_metadata)&&void 0!==t&&t.last_name)return e.user_metadata.last_name;if(e.name){const t=e.name.split(" ");return t.length>1?t.slice(1).join(" "):""}return"User"})(e);return t&&r?"".concat(t.charAt(0)).concat(r.charAt(0)).toUpperCase():t?t.charAt(0).toUpperCase():e.email?e.email.charAt(0).toUpperCase():"U"},Kr=()=>(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"})]}),Gr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),Jr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),Yr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),Qr=()=>(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Xr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),$r=e=>{let{className:t="w-6 h-6"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},Zr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),en=e=>{let{className:t="h-5 w-5 text-purple-500"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})},tn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})},rn=e=>{let{className:t="w-6 h-6"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})},nn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),sn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193l-3.722.267c-.34.024-.65.18-.882.477a1.125 1.125 0 01-1.587 0c-.232-.297-.542-.453-.882-.477l-3.722-.267A2.25 2.25 0 015.25 15v-4.286c0-.97.616-1.813 1.5-2.097m1.625 3.511l.228.228c.327.327.754.529 1.208.529h.286c.454 0 .881-.202 1.208-.529l.228-.228m1.375 2.134l.228-.228c.327-.327.754-.529 1.208-.529h.286c.454 0 .881.202 1.208-.529l.228-.228m-6.25-2.134l.228.228c.327.327.754.529 1.208.529h.286c.454 0 .881-.202 1.208-.529l.228-.228m-6.25-2.134l.228.228c.327.327.754.529 1.208.529h.286c.454 0 .881-.202 1.208-.529l.228-.228M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),an=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 019 9v.375M10.125 2.25c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9.003M18.002 12a6.002 6.002 0 11-12 0 6.002 6.002 0 0112 0zm-8.25 1.5l2.25-2.25 4.5 4.5"})}),on=e=>{let{className:t="w-6 h-6"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},ln=e=>{let{className:t="w-6 h-6"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"})})},cn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),dn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})}),un=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})}),hn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})}),mn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 15.75l7.5-7.5 7.5 7.5"})})},pn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})})},gn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})},fn=e=>{let{className:t="w-4 h-4"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})},xn=e=>{let{className:t="w-4 h-4"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12"})})},vn=e=>{let{className:t="w-4 h-4"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z"})})},yn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})},bn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"})})},wn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"})})},jn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25s-7.5-4.108-7.5-11.25a7.5 7.5 0 1115 0z"})]})};var Nn=r(759);function Sn(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var kn=r(526);const An="SET_ITEMS",Cn="TOGGLE_EXPANDED",En="TOGGLE_COMPLETED",Pn="ADD_COMMENT",In="UPDATE_COMMENT_TEXT",Tn="SET_SHOW_COMMENT_INPUT",Dn="SET_COMMENT_INPUTS",Mn="REMOVE_ITEM",_n={items:[],expandedItems:new Set,completedItems:new Set,comments:{},newCommentText:{},showCommentInput:{},commentInputs:{}};function On(e,t){switch(t.type){case An:{const r=Array.isArray(t.payload)?t.payload:[],n=Array.isArray(e.items)?e.items:[];if(n.length===r.length){let t=!0;for(let e=0;e<n.length;e++){const s=n[e],a=r[e];if((null===s||void 0===s?void 0:s.id)!==(null===a||void 0===a?void 0:a.id)||(null===s||void 0===s?void 0:s.timestamp)!==(null===a||void 0===a?void 0:a.timestamp)){t=!1;break}}if(t)return e}return(0,Y.A)((0,Y.A)({},e),{},{items:r})}case Cn:const r=new Set(e.expandedItems);return r.has(t.payload)?r.delete(t.payload):r.add(t.payload),(0,Y.A)((0,Y.A)({},e),{},{expandedItems:r});case En:const n=new Set(e.completedItems);return n.has(t.payload)?n.delete(t.payload):n.add(t.payload),(0,Y.A)((0,Y.A)({},e),{},{completedItems:n});case Pn:const{itemId:s,comment:a}=t.payload;return(0,Y.A)((0,Y.A)({},e),{},{comments:(0,Y.A)((0,Y.A)({},e.comments),{},{[s]:[...e.comments[s]||[],a]}),newCommentText:(0,Y.A)((0,Y.A)({},e.newCommentText),{},{[s]:""}),commentInputs:(0,Y.A)((0,Y.A)({},e.commentInputs),{},{[s]:""})});case In:return(0,Y.A)((0,Y.A)({},e),{},{newCommentText:(0,Y.A)((0,Y.A)({},e.newCommentText),{},{[t.payload.itemId]:t.payload.text})});case Tn:return(0,Y.A)((0,Y.A)({},e),{},{showCommentInput:(0,Y.A)((0,Y.A)({},e.showCommentInput),{},{[t.payload.itemId]:t.payload.show})});case Dn:return(0,Y.A)((0,Y.A)({},e),{},{commentInputs:(0,Y.A)((0,Y.A)({},e.commentInputs),{},{[t.payload.itemId]:t.payload.text})});case Mn:{const r=t.payload,n=(e.items||[]).filter(e=>e.id!==r),s=new Set(e.expandedItems);s.delete(r);const a=new Set(e.completedItems);a.delete(r);const o=e.comments,{[r]:i}=o,l=Sn(o,[r].map(kn.A)),c=e.commentInputs,{[r]:d}=c,u=Sn(c,[r].map(kn.A)),h=e.showCommentInput,{[r]:m}=h,p=Sn(h,[r].map(kn.A)),g=e.newCommentText,{[r]:f}=g,x=Sn(g,[r].map(kn.A));return(0,Y.A)((0,Y.A)({},e),{},{items:n,expandedItems:s,completedItems:a,comments:l,commentInputs:u,showCommentInput:p,newCommentText:x})}default:return e}}const Ln=(0,o.createContext)();function Rn(e){let{children:t}=e;const[r,n]=(0,o.useReducer)(On,_n),s=(0,o.useMemo)(()=>({setItems:e=>n({type:An,payload:e}),toggleExpanded:e=>n({type:Cn,payload:e}),toggleCompleted:e=>n({type:En,payload:e}),addComment:(e,t)=>n({type:Pn,payload:{itemId:e,comment:t}}),updateCommentText:(e,t)=>n({type:In,payload:{itemId:e,text:t}}),setShowCommentInput:(e,t)=>n({type:Tn,payload:{itemId:e,show:t}}),setCommentInputs:(e,t)=>n({type:Dn,payload:{itemId:e,text:t}}),removeItem:e=>n({type:Mn,payload:e})}),[n]);return(0,kt.jsx)(Ln.Provider,{value:{state:r,actions:s},children:t})}function Fn(){const e=(0,o.useContext)(Ln);if(!e)throw new Error("useActivity must be used within an ActivityProvider");return e}const Un={LEAD:{name:"Lead",weight:10},PROSPECT:{name:"Prospect",weight:15},APPROVED:{name:"Approved",weight:15},EXECUTION:{name:"Execution",weight:40},SECOND_SUPPLEMENT:{name:"2nd Supplement",weight:10},COMPLETION:{name:"Completion",weight:10}};const Bn=class{static calculateProjectProgress(e){if(!e)return this.getDefaultProgressData();const t=e.currentWorkflowItem;if(!t)return this.getDefaultProgressData();const r=Number(t.totalLineItems)||this.estimateTotalLineItems(),n=Array.isArray(t.completedItems)?t.completedItems.length:0,s=r>0?Math.round(n/r*100):0;if(t.isComplete)return{overall:100,phaseBreakdown:this.getCompletedPhaseBreakdown(),currentPhase:"COMPLETION",currentPhaseDisplay:"Completion",currentSection:null,currentLineItem:null,totalPhases:Object.keys(Un).length,completedPhases:Object.keys(Un).length,hasPhaseOverride:!1,completedLineItems:n,totalLineItems:r};const a=t.phase||"LEAD",o=Object.keys(Un),i=o.indexOf(a);return{overall:s,phaseBreakdown:{},currentPhase:a,currentPhaseDisplay:t.phaseDisplay||this.formatPhase(a),currentSection:t.section,currentLineItem:t.lineItem,totalPhases:o.length,completedPhases:Math.max(0,i),hasPhaseOverride:!1,completedLineItems:n,totalLineItems:r,skippedItemsCount:0}}static calculateProgressWithSkippedItems(e,t,r,n,s,a){const o=Object.keys(Un),i=o.indexOf(t);let l=[...e],c=0;if(a&&i>0){for(let e=0;e<i;e++){const t=o[e],r=a[t];if(r&&r.sections){const e=Object.values(r.sections);for(let r=0;r<e.length;r++){const n=e[r];if(n.lineItems){const e=Object.values(n.lineItems);for(let r=0;r<e.length;r++){const s=e[r];l.some(e=>e.lineItemId===s.id||e.id===s.id)||(l.push({id:s.id,lineItemId:s.id,phaseId:t,sectionId:n.id,name:s.name,isSkipped:!0,completedAt:(new Date).toISOString()}),c++)}}}}}if(r&&a[t]){const e=a[t],s=Object.values(e.sections||{}),o=s.findIndex(e=>e.name===r||e.id===r);if(o>0)for(let r=0;r<o;r++){const e=s[r];if(e.lineItems){const r=Object.values(e.lineItems);for(let n=0;n<r.length;n++){const s=r[n];l.some(e=>e.lineItemId===s.id||e.id===s.id)||(l.push({id:s.id,lineItemId:s.id,phaseId:t,sectionId:e.id,name:s.name,isSkipped:!0,completedAt:(new Date).toISOString()}),c++)}}}if(n&&o>=0){const e=s[o];if(e&&e.lineItems){const r=Object.values(e.lineItems),s=r.findIndex(e=>e.name===n||e.id===n);if(s>0)for(let n=0;n<s;n++){const s=r[n];l.some(e=>e.lineItemId===s.id||e.id===s.id)||(l.push({id:s.id,lineItemId:s.id,phaseId:t,sectionId:e.id,name:s.name,isSkipped:!0,completedAt:(new Date).toISOString()}),c++)}}}}}return{overallProgress:s>0?Math.round(l.length/s*100):0,adjustedCompletedItems:l,totalLineItems:s,skippedItemsCount:c}}static estimateTotalLineItems(){return 25}static calculatePhaseBreakdownFromLineItems(e,t,r,n){const s={},a=Object.keys(Un),o={},i={};if(e.forEach(e=>{e.phaseId&&(o[e.phaseId]=(o[e.phaseId]||0)+1)}),n)a.forEach(e=>{let t=0;const r=n[e];r&&r.sections&&Object.values(r.sections).forEach(e=>{e.lineItems&&(t+=Object.keys(e.lineItems).length)}),i[e]=t});else{const e=Math.ceil(this.estimateTotalLineItems()/a.length);a.forEach(t=>{i[t]=e})}return a.forEach((e,t)=>{const n=o[e]||0,a=i[e]||1;let l=0;t<r?l=100:t===r&&(l=Math.min(Math.round(n/a*100),100)),s[e]={name:Un[e].name,progress:l,weight:Un[e].weight,isCompleted:100===l,isCurrent:t===r,isPending:t>r,completedItems:n,totalItems:a}}),s}static calculatePhaseBreakdown(e,t){const r={};return Object.keys(Un).forEach((e,n)=>{let s=0;n<t?s=100:n===t&&(s=50),r[e]={name:Un[e].name,progress:s,weight:Un[e].weight,isCompleted:100===s,isCurrent:n===t,isPending:n>t}}),r}static getCompletedPhaseBreakdown(){const e={};return Object.keys(Un).forEach(t=>{e[t]={name:Un[t].name,progress:100,weight:Un[t].weight,isCompleted:!0,isCurrent:!1,isPending:!1}}),e}static getDefaultProgressData(){return{overall:0,phaseBreakdown:{},currentPhase:"LEAD",currentPhaseDisplay:"Lead",currentSection:"Not Started",currentLineItem:"No active task",totalPhases:Object.keys(Un).length,completedPhases:0,hasPhaseOverride:!1}}static formatPhase(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase().replace("_"," "):"Lead"}static getPhaseColor(e){return{LEAD:"#EAB308",PROSPECT:"#F97316",APPROVED:"#10B981",EXECUTION:"#D946EF",SECOND_SUPPLEMENT:"#8B5CF6",COMPLETION:"#0EA5E9"}[this.normalizePhase(e)]||"#EAB308"}static getPhaseInitials(e){return{LEAD:"L",PROSPECT:"P",APPROVED:"A",EXECUTION:"E",SECOND_SUPPLEMENT:"S",COMPLETION:"C"}[this.normalizePhase(e)]||"L"}static getContrastTextColor(e){const t=e.replace("#","").toUpperCase();return"EAB308"===t||"F97316"===t?"#111827":"white"}static getPhaseButtonProps(e){const t=this.normalizePhase(e),r=this.getPhaseName(t),n=this.getPhaseColor(t),s=this.getPhaseInitials(t);let a=this.getContrastTextColor(n);const o=(()=>{switch(t){case"LEAD":case"APPROVED":default:return"text-black";case"PROSPECT":case"EXECUTION":case"SECOND_SUPPLEMENT":case"COMPLETION":return"text-white"}})();return{initials:s,bgColor:{"#EAB308":"bg-yellow-500","#F97316":"bg-orange-600","#10B981":"bg-emerald-500","#D946EF":"bg-fuchsia-500","#8B5CF6":"bg-violet-500","#0EA5E9":"bg-sky-500"}[n]||"bg-yellow-500",textColor:o,fullName:r,hexColor:n,phase:t,contrastTextColor:a}}static getNextPhase(e){const t=Object.keys(Un),r=t.indexOf(e);return r>=0&&r<t.length-1?t[r+1]:null}static isInFinalPhase(e){const t=Object.keys(Un);return e===t[t.length-1]}static getWorkflowStatus(e){if(!e||!e.currentWorkflowItem)return{status:"Not Started",phase:"LEAD",progress:0,isComplete:!1};const t=e.currentWorkflowItem;if(t.isComplete)return{status:"Complete",phase:"COMPLETION",progress:100,isComplete:!0};const r=this.calculateProjectProgress(e);return{status:"In Progress",phase:t.phase||"LEAD",progress:r.overall,isComplete:!1,currentSection:t.section,currentTask:t.lineItem}}static getAllPhases(){return Object.keys(Un).map(e=>({id:e,key:e,name:Un[e].name,weight:Un[e].weight,color:this.getPhaseColor(e),initial:this.getPhaseInitials(e)}))}static getProjectPhase(e){return e?e.currentWorkflowItem&&e.currentWorkflowItem.phase?e.currentWorkflowItem.phase:e.phase?e.phase:"LEAD":"LEAD"}static getPhaseName(e){var t;if(!e)return"Lead";const r=this.normalizePhase(e);return(null===(t=Un[r])||void 0===t?void 0:t.name)||this.formatPhase(e)}static normalizePhase(e){if(!e)return"LEAD";return{LEAD:"LEAD",PROSPECT:"PROSPECT",APPROVED:"APPROVED",EXECUTION:"EXECUTION",EXECUTE:"EXECUTION",SECOND_SUPPLEMENT:"SECOND_SUPPLEMENT","2ND_SUPPLEMENT":"SECOND_SUPPLEMENT",SUPPLEMENT:"SECOND_SUPPLEMENT",COMPLETION:"COMPLETION",COMPLETE:"COMPLETION"}[e.toUpperCase().replace(/\s*PHASE$/i,"").replace("PHASE-","").replace("PHASE","").replace(/-INSURANCE-1ST SUPPLEMENT/i,"").replace("2ND SUPPLEMENT","SECOND_SUPPLEMENT").replace("2ND SUPP","SECOND_SUPPLEMENT").replace("EXECUTE","EXECUTION").trim()]||"LEAD"}static notifyPhaseChange(e,t,r){t!==r&&(console.log("\ud83d\udd04 Phase change for project ".concat(e.projectNumber,": ").concat(t," \u2192 ").concat(r)),"undefined"!==typeof window&&window.dispatchEvent(new CustomEvent("workflowPhaseChange",{detail:{project:e,oldPhase:t,newPhase:r}})))}static calculateTradeBreakdown(e,t,r,n){if(!e)return[];if(e.workflowTrackers&&e.workflowTrackers.length>0)return this.calculateRealMultipleWorkflowBreakdown(e.workflowTrackers);if(e.currentWorkflowItem){const n=r>0?Math.round(t.length/r*100):0;return[{name:e.projectType||e.type||"Roofing",laborProgress:n,materialsDelivered:this.estimateMaterialsDelivered(e,n),completedItems:t.length,totalItems:r,isMainTrade:!0}]}const s=this.getProjectTypes(e);if(1===s.length){const n=r>0?Math.round(t.length/r*100):0;return[{name:s[0],laborProgress:n,materialsDelivered:this.estimateMaterialsDelivered(e,n),completedItems:t.length,totalItems:r,isMainTrade:!0}]}return this.calculateMultipleTradeBreakdown(s,t,r,n,e)}static calculateRealMultipleWorkflowBreakdown(e){const t=[];return e.forEach((e,r)=>{const n=this.getWorkflowTypeDisplayName(e.workflowType),s=e.completedItems||[],a=e.totalLineItems||this.estimateTotalLineItems(),o=a>0?Math.round(s.length/a*100):0;t.push({name:e.tradeName||n,laborProgress:o,materialsDelivered:this.estimateMaterialsDelivered({workflowType:e.workflowType},o),completedItems:s.length,totalItems:a,isMainTrade:e.isMainWorkflow||0===r,workflowType:e.workflowType,trackerId:e.id})}),t}static getWorkflowTypeDisplayName(e){return{ROOFING:"Roofing",GUTTERS:"Gutters",INTERIOR_PAINT:"Interior Paint",KITCHEN_REMODEL:"Kitchen Remodel",BATHROOM_RENOVATION:"Bathroom Renovation",SIDING:"Siding",WINDOWS:"Windows",GENERAL:"General"}[e]||e}static getProjectTypes(e){const t=[];return e.projectType?t.push(e.projectType):e.type&&t.push(e.type),e.trades&&Array.isArray(e.trades)&&e.trades.forEach(e=>{e.name&&!t.includes(e.name)&&t.push(e.name)}),0===t.length&&t.push("General"),t}static calculateMultipleTradeBreakdown(e,t,r,n,s){const a=[],o=Math.ceil(r/e.length);e.forEach((e,n)=>{const i=n*o,l=Math.min((n+1)*o,r)-i;let c=0;if(t&&t.length>0){const e=l/r;c=Math.round(t.length*e),c=Math.min(c,l)}const d=l>0?Math.round(c/l*100):0;a.push({name:e,laborProgress:d,materialsDelivered:this.estimateMaterialsDelivered(s,d),completedItems:c,totalItems:l,isMainTrade:0===n})});const i=a.reduce((e,t)=>e+t.completedItems,0),l=t?t.length:0;if(i!==l&&a.length>0){const e=l-i;a[0].completedItems=Math.max(0,a[0].completedItems+e),a[0].laborProgress=a[0].totalItems>0?Math.round(a[0].completedItems/a[0].totalItems*100):0}return a}static estimateMaterialsDelivered(e,t){return e.materialsDeliveryStart||void 0!==e.materialsDelivered?e.materialsDelivered||Boolean(e.materialsDeliveryStart):t>=20}static calculateProgress(e){return console.warn("WorkflowProgressService.calculateProgress is deprecated. Use calculateProjectProgress instead."),this.calculateProjectProgress(e)}};var Wn,zn,Vn,Hn,qn,Kn,Gn,Jn,Yn,Qn,Xn,$n,Zn,es,ts,rs,ns=(Wn=new WeakMap,zn=new WeakMap,Vn=new WeakMap,Hn=new WeakMap,qn=new WeakMap,Kn=new WeakMap,Gn=new WeakMap,Jn=new WeakMap,Yn=new WeakMap,Qn=new WeakMap,Xn=new WeakMap,$n=new WeakMap,Zn=new WeakMap,es=new WeakMap,ts=new WeakMap,rs=new WeakSet,class extends De{constructor(e,t){super(),Ne(this,rs),X(this,Wn,void 0),X(this,zn,void 0),X(this,Vn,void 0),X(this,Hn,void 0),X(this,qn,void 0),X(this,Kn,void 0),X(this,Gn,void 0),X(this,Jn,void 0),X(this,Yn,void 0),X(this,Qn,void 0),X(this,Xn,void 0),X(this,$n,void 0),X(this,Zn,void 0),X(this,es,void 0),X(this,ts,new Set),this.options=t,ee(Wn,this,e),ee(Jn,this,null),ee(Gn,this,Oe()),this.options.experimental_prefetchInRender||Z(Gn,this).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(Z(zn,this).addObserver(this),ms(Z(zn,this),this.options)?$(rs,this,ss).call(this):this.updateResult(),$(rs,this,ls).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ps(Z(zn,this),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ps(Z(zn,this),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,$(rs,this,cs).call(this),$(rs,this,ds).call(this),Z(zn,this).removeObserver(this)}setOptions(e){const t=this.options,r=Z(zn,this);if(this.options=Z(Wn,this).defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!==typeof this.options.enabled&&"function"!==typeof this.options.enabled&&"boolean"!==typeof oe(this.options.enabled,Z(zn,this)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");$(rs,this,us).call(this),Z(zn,this).setOptions(this.options),t._defaulted&&!me(this.options,t)&&Z(Wn,this).getQueryCache().notify({type:"observerOptionsUpdated",query:Z(zn,this),observer:this});const n=this.hasListeners();n&&gs(Z(zn,this),r,this.options,t)&&$(rs,this,ss).call(this),this.updateResult(),!n||Z(zn,this)===r&&oe(this.options.enabled,Z(zn,this))===oe(t.enabled,Z(zn,this))&&ae(this.options.staleTime,Z(zn,this))===ae(t.staleTime,Z(zn,this))||$(rs,this,as).call(this);const s=$(rs,this,os).call(this);!n||Z(zn,this)===r&&oe(this.options.enabled,Z(zn,this))===oe(t.enabled,Z(zn,this))&&s===Z(es,this)||$(rs,this,is).call(this,s)}getOptimisticResult(e){const t=Z(Wn,this).getQueryCache().build(Z(Wn,this),e),r=this.createResult(t,e);return function(e,t){if(!me(e.getCurrentResult(),t))return!0;return!1}(this,r)&&(ee(Hn,this,r),ee(Kn,this,this.options),ee(qn,this,Z(zn,this).state)),r}getCurrentResult(){return Z(Hn,this)}trackResult(e,t){return new Proxy(e,{get:(e,r)=>(this.trackProp(r),null===t||void 0===t||t(r),Reflect.get(e,r))})}trackProp(e){Z(ts,this).add(e)}getCurrentQuery(){return Z(zn,this)}refetch(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(e),e));return this.fetch((0,Y.A)({},t))}fetchOptimistic(e){const t=Z(Wn,this).defaultQueryOptions(e),r=Z(Wn,this).getQueryCache().build(Z(Wn,this),t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){var t;return $(rs,this,ss).call(this,(0,Y.A)((0,Y.A)({},e),{},{cancelRefetch:null===(t=e.cancelRefetch)||void 0===t||t})).then(()=>(this.updateResult(),Z(Hn,this)))}createResult(e,t){const r=Z(zn,this),n=this.options,s=Z(Hn,this),a=Z(qn,this),o=Z(Kn,this),i=e!==r?e.state:Z(Vn,this),{state:l}=e;let c,d=(0,Y.A)({},l),u=!1;if(t._optimisticResults){const s=this.hasListeners(),a=!s&&ms(e,t),o=s&&gs(e,r,t,n);(a||o)&&(d=(0,Y.A)((0,Y.A)({},d),et(l.data,e.options))),"isRestoring"===t._optimisticResults&&(d.fetchStatus="idle")}let{error:h,errorUpdatedAt:m,status:p}=d;c=d.data;let g=!1;if(void 0!==t.placeholderData&&void 0===c&&"pending"===p){let e;var f;if(null!==s&&void 0!==s&&s.isPlaceholderData&&t.placeholderData===(null===o||void 0===o?void 0:o.placeholderData))e=s.data,g=!0;else e="function"===typeof t.placeholderData?t.placeholderData(null===(f=Z(Xn,this))||void 0===f?void 0:f.state.data,Z(Xn,this)):t.placeholderData;void 0!==e&&(p="success",c=xe(null===s||void 0===s?void 0:s.data,e,t),u=!0)}if(t.select&&void 0!==c&&!g)if(s&&c===(null===a||void 0===a?void 0:a.data)&&t.select===Z(Yn,this))c=Z(Qn,this);else try{ee(Yn,this,t.select),c=t.select(c),c=xe(null===s||void 0===s?void 0:s.data,c,t),ee(Qn,this,c),ee(Jn,this,null)}catch(N){ee(Jn,this,N)}Z(Jn,this)&&(h=Z(Jn,this),c=Z(Qn,this),m=Date.now(),p="error");const x="fetching"===d.fetchStatus,v="pending"===p,y="error"===p,b=v&&x,w=void 0!==c,j={status:p,fetchStatus:d.fetchStatus,isPending:v,isSuccess:"success"===p,isError:y,isInitialLoading:b,isLoading:b,data:c,dataUpdatedAt:d.dataUpdatedAt,error:h,errorUpdatedAt:m,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>i.dataUpdateCount||d.errorUpdateCount>i.errorUpdateCount,isFetching:x,isRefetching:x&&!v,isLoadingError:y&&!w,isPaused:"paused"===d.fetchStatus,isPlaceholderData:u,isRefetchError:y&&w,isStale:fs(e,t),refetch:this.refetch,promise:Z(Gn,this),isEnabled:!1!==oe(t.enabled,e)};if(this.options.experimental_prefetchInRender){const t=e=>{"error"===j.status?e.reject(j.error):void 0!==j.data&&e.resolve(j.data)},n=()=>{const e=ee(Gn,this,j.promise=Oe());t(e)},s=Z(Gn,this);switch(s.status){case"pending":e.queryHash===r.queryHash&&t(s);break;case"fulfilled":"error"!==j.status&&j.data===s.value||n();break;case"rejected":"error"===j.status&&j.error===s.reason||n()}}return j}updateResult(){const e=Z(Hn,this),t=this.createResult(Z(zn,this),this.options);if(ee(qn,this,Z(zn,this).state),ee(Kn,this,this.options),void 0!==Z(qn,this).data&&ee(Xn,this,Z(zn,this)),me(t,e))return;ee(Hn,this,t);$(rs,this,hs).call(this,{listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,r="function"===typeof t?t():t;if("all"===r||!r&&!Z(ts,this).size)return!0;const n=new Set(null!==r&&void 0!==r?r:Z(ts,this));return this.options.throwOnError&&n.add("error"),Object.keys(Z(Hn,this)).some(t=>{const r=t;return Z(Hn,this)[r]!==e[r]&&n.has(r)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&$(rs,this,ls).call(this)}});function ss(e){$(rs,this,us).call(this);let t=Z(zn,this).fetch(this.options,e);return null!==e&&void 0!==e&&e.throwOnError||(t=t.catch(re)),t}function as(){$(rs,this,cs).call(this);const e=ae(this.options.staleTime,Z(zn,this));if(te||Z(Hn,this).isStale||!ne(e))return;const t=se(Z(Hn,this).dataUpdatedAt,e);ee($n,this,setTimeout(()=>{Z(Hn,this).isStale||this.updateResult()},t+1))}function os(){var e;return null!==(e="function"===typeof this.options.refetchInterval?this.options.refetchInterval(Z(zn,this)):this.options.refetchInterval)&&void 0!==e&&e}function is(e){$(rs,this,ds).call(this),ee(es,this,e),!te&&!1!==oe(this.options.enabled,Z(zn,this))&&ne(Z(es,this))&&0!==Z(es,this)&&ee(Zn,this,setInterval(()=>{(this.options.refetchIntervalInBackground||Me.isFocused())&&$(rs,this,ss).call(this)},Z(es,this)))}function ls(){$(rs,this,as).call(this),$(rs,this,is).call(this,$(rs,this,os).call(this))}function cs(){Z($n,this)&&(clearTimeout(Z($n,this)),ee($n,this,void 0))}function ds(){Z(Zn,this)&&(clearInterval(Z(Zn,this)),ee(Zn,this,void 0))}function us(){const e=Z(Wn,this).getQueryCache().build(Z(Wn,this),this.options);if(e===Z(zn,this))return;const t=Z(zn,this);ee(zn,this,e),ee(Vn,this,e.state),this.hasListeners()&&(null===t||void 0===t||t.removeObserver(this),e.addObserver(this))}function hs(e){Te.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(Z(Hn,this))}),Z(Wn,this).getQueryCache().notify({query:Z(zn,this),type:"observerResultsUpdated"})})}function ms(e,t){return function(e,t){return!1!==oe(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||void 0!==e.state.data&&ps(e,t,t.refetchOnMount)}function ps(e,t,r){if(!1!==oe(t.enabled,e)&&"static"!==ae(t.staleTime,e)){const n="function"===typeof r?r(e):r;return"always"===n||!1!==n&&fs(e,t)}return!1}function gs(e,t,r,n){return(e!==t||!1===oe(n.enabled,e))&&(!r.suspense||"error"!==e.state.status)&&fs(e,r)}function fs(e,t){return!1!==oe(t.enabled,e)&&e.isStaleByTime(ae(t.staleTime,e))}function xs(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var vs,ys,bs,ws,js,Ns=o.createContext(xs()),Ss=o.createContext(!1),ks=(Ss.Provider,(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()}));function As(e,t,r){var n,s,a,i;const l=o.useContext(Ss),c=o.useContext(Ns),d=Ct(r),u=d.defaultQueryOptions(e);null===(n=d.getDefaultOptions().queries)||void 0===n||null===(s=n._experimental_beforeQuery)||void 0===s||s.call(n,u),u._optimisticResults=l?"isRestoring":"optimistic",(e=>{if(e.suspense){const t=e=>"static"===e?e:Math.max(null!==e&&void 0!==e?e:1e3,1e3),r=e.staleTime;e.staleTime="function"===typeof r?function(){return t(r(...arguments))}:t(r),"number"===typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,1e3))}})(u),((e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))})(u,c),(e=>{o.useEffect(()=>{e.clearReset()},[e])})(c);const h=!d.getQueryCache().get(u.queryHash),[m]=o.useState(()=>new t(d,u)),p=m.getOptimisticResult(u),g=!l&&!1!==e.subscribed;if(o.useSyncExternalStore(o.useCallback(e=>{const t=g?m.subscribe(Te.batchCalls(e)):re;return m.updateResult(),t},[m,g]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),o.useEffect(()=>{m.setOptions(u)},[u,m]),((e,t)=>(null===e||void 0===e?void 0:e.suspense)&&t.isPending)(u,p))throw ks(u,m,c);if((e=>{let{result:t,errorResetBoundary:r,throwOnError:n,query:s,suspense:a}=e;return t.isError&&!r.isReset()&&!t.isFetching&&s&&(a&&void 0===t.data||je(n,[t.error,s]))})({result:p,errorResetBoundary:c,throwOnError:u.throwOnError,query:d.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw p.error;if(null===(a=d.getDefaultOptions().queries)||void 0===a||null===(i=a._experimental_afterQuery)||void 0===i||i.call(a,u,p),u.experimental_prefetchInRender&&!te&&((e,t)=>e.isLoading&&e.isFetching&&!t)(p,l)){var f;const e=h?ks(u,m,c):null===(f=d.getQueryCache().get(u.queryHash))||void 0===f?void 0:f.promise;null===e||void 0===e||e.catch(re).finally(()=>{m.updateResult()})}return u.notifyOnChangeProps?p:m.trackResult(p)}function Cs(e,t){return As(e,ns,t)}var Es=(vs=new WeakMap,ys=new WeakMap,bs=new WeakMap,ws=new WeakMap,js=new WeakSet,class extends De{constructor(e,t){super(),Ne(this,js),X(this,vs,void 0),X(this,ys,void 0),X(this,bs,void 0),X(this,ws,void 0),ee(vs,this,e),this.setOptions(t),this.bindMethods(),$(js,this,Ps).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var t;const r=this.options;this.options=Z(vs,this).defaultMutationOptions(e),me(this.options,r)||Z(vs,this).getMutationCache().notify({type:"observerOptionsUpdated",mutation:Z(bs,this),observer:this}),null!==r&&void 0!==r&&r.mutationKey&&this.options.mutationKey&&de(r.mutationKey)!==de(this.options.mutationKey)?this.reset():"pending"===(null===(t=Z(bs,this))||void 0===t?void 0:t.state.status)&&Z(bs,this).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(null===(e=Z(bs,this))||void 0===e||e.removeObserver(this))}onMutationUpdate(e){$(js,this,Ps).call(this),$(js,this,Is).call(this,e)}getCurrentResult(){return Z(ys,this)}reset(){var e;null===(e=Z(bs,this))||void 0===e||e.removeObserver(this),ee(bs,this,void 0),$(js,this,Ps).call(this),$(js,this,Is).call(this)}mutate(e,t){var r;return ee(ws,this,t),null===(r=Z(bs,this))||void 0===r||r.removeObserver(this),ee(bs,this,Z(vs,this).getMutationCache().build(Z(vs,this),this.options)),Z(bs,this).addObserver(this),Z(bs,this).execute(e)}});function Ps(){var e,t;const r=null!==(e=null===(t=Z(bs,this))||void 0===t?void 0:t.state)&&void 0!==e?e:{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0};ee(ys,this,(0,Y.A)((0,Y.A)({},r),{},{isPending:"pending"===r.status,isSuccess:"success"===r.status,isError:"error"===r.status,isIdle:"idle"===r.status,mutate:this.mutate,reset:this.reset}))}function Is(e){Te.batch(()=>{if(Z(ws,this)&&this.hasListeners()){const c=Z(ys,this).variables,d=Z(ys,this).context;var t,r,n,s;if("success"===(null===e||void 0===e?void 0:e.type))null===(t=(r=Z(ws,this)).onSuccess)||void 0===t||t.call(r,e.data,c,d),null===(n=(s=Z(ws,this)).onSettled)||void 0===n||n.call(s,e.data,null,c,d);else if("error"===(null===e||void 0===e?void 0:e.type)){var a,o,i,l;null===(a=(o=Z(ws,this)).onError)||void 0===a||a.call(o,e.error,c,d),null===(i=(l=Z(ws,this)).onSettled)||void 0===i||i.call(l,void 0,e.error,c,d)}}this.listeners.forEach(e=>{e(Z(ys,this))})})}function Ts(e,t){const r=Ct(t),[n]=o.useState(()=>new Es(r,e));o.useEffect(()=>{n.setOptions(e)},[n,e]);const s=o.useSyncExternalStore(o.useCallback(e=>n.subscribe(Te.batchCalls(e)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),a=o.useCallback((e,t)=>{n.mutate(e,t).catch(re)},[n]);if(s.error&&je(n.options.throwOnError,[s.error]))throw s.error;return(0,Y.A)((0,Y.A)({},s),{},{mutate:a,mutateAsync:s.mutate})}var Ds=r(505);const Ms=e=>{var t,r,n,s,a,i,l,c,d,u,h,m,p,g,f,x,v,y,b,w;let{activity:j,onProjectSelect:N,projects:S,colorMode:k,onQuickReply:A,isExpanded:C,onToggleExpansion:E,useRealData:P=!1,sourceSection:I="Project Messages",onDelete:T=null,isDeleting:D=!1}=e;const[M,_]=(0,o.useState)(!1),O=void 0!==C?C:M,[L,R]=(0,o.useState)(!1),[F,U]=(0,o.useState)(""),B=(0,o.useRef)(null),W=null===S||void 0===S?void 0:S.find(e=>e&&e.id===j.projectId),{data:z,isLoading:V,error:H}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{page:r=1,limit:n=20,includeReplies:s=!0,messageType:a,author:o,search:i}=t;return Cs({queryKey:["projectMessages",e,{page:r,limit:n,includeReplies:s,messageType:a,author:o,search:i}],queryFn:async()=>{const t=new URLSearchParams({page:r.toString(),limit:n.toString(),includeReplies:s.toString()});return a&&t.append("messageType",a),o&&t.append("author",o),i&&t.append("search",i),(await Ds.default.get("/project-messages/".concat(e,"?").concat(t))).data},enabled:!!e,staleTime:3e4,refetchOnWindowFocus:!1})}(j.projectId,{limit:10,includeReplies:!0}),q=(()=>{const e=Ct();return Ts({mutationFn:async e=>{let{projectId:t,content:r,subject:n,priority:s="MEDIUM",parentMessageId:a}=e;return(await Ds.default.post("/project-messages/".concat(t),{content:r,subject:n,priority:s,parentMessageId:a})).data},onSuccess:(t,r)=>{e.invalidateQueries(["projectMessages",r.projectId]),e.invalidateQueries(["activities"])}})})(),K=((()=>{const e=Ct();Ts({mutationFn:async e=>(await Ds.default.patch("/project-messages/".concat(e,"/read"))).data,onSuccess:()=>{e.invalidateQueries(["projectMessages"])}})})(),e=>{const t=new Date(e);return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})+", "+t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),G=(0,o.useMemo)(()=>{var e;if(P&&(null===z||void 0===z||null===(e=z.data)||void 0===e?void 0:e.length)>0){const e=z.data.flatMap(e=>{var t;return[{id:e.id,user:e.author?"".concat(e.author.firstName," ").concat(e.author.lastName):e.authorName||"Unknown User",comment:e.content,timestamp:e.createdAt,recipients:e.recipients||[]},...(null===(t=e.replies)||void 0===t?void 0:t.map(e=>({id:e.id,user:e.author?"".concat(e.author.firstName," ").concat(e.author.lastName):e.authorName||"Unknown User",comment:e.content,timestamp:e.createdAt,recipients:e.recipients||[]})))||[]]});return e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))}return(()=>{const e=["Sarah Owner","Mike Rodriguez","Jennifer Williams","David Chen"],t=["Project is progressing well. Materials arrived on schedule.","Customer has approved the color selection.","Inspection completed successfully. Moving to next phase.","Weather delays expected for tomorrow. Adjusting timeline.","Quality check passed. Ready for final review.","Customer meeting scheduled for Friday at 2 PM.","All permits have been approved and filed.","Updated project timeline shared with team."],r=[],n=Math.floor(5*Math.random())+2;for(let s=0;s<n;s++){const n=e[Math.floor(Math.random()*e.length)],a=t[Math.floor(Math.random()*t.length)],o=Math.floor(7*Math.random()),i=Math.floor(24*Math.random()),l=new Date(Date.now()-24*o*60*60*1e3-60*i*60*1e3);r.push({id:"msg_".concat(s),user:n,comment:a,timestamp:l.toISOString()})}return r.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))})()},[j.id,P,z]),J=G[0],Y=(null===W||void 0===W?void 0:W.projectNumber)||j.projectNumber||"12345",Q=(null===W||void 0===W||null===(t=W.customer)||void 0===t?void 0:t.primaryName)||(null===W||void 0===W||null===(r=W.client)||void 0===r?void 0:r.name)||(null===W||void 0===W?void 0:W.clientName)||(null===W||void 0===W?void 0:W.projectName)||j.projectName||"Primary Customer",X=j.subject||"Project Update";console.log("ProjectMessagesCard Debug:",{projectId:j.projectId,project:W,activity:j,projectNumber:Y,primaryCustomer:Q,subject:X});const $=async e=>{if(e.preventDefault(),F.trim())try{P&&j.projectId?await q.mutateAsync({projectId:j.projectId,content:F.trim(),subject:"Re: ".concat(X),priority:"MEDIUM"}):A&&A({projectId:j.projectId,projectNumber:Y,primaryCustomer:Q,subject:X,message:F.trim(),replyToActivity:j}),U(""),R(!1)}catch(t){console.error("Failed to send quick reply:",t)}},Z=()=>{U(""),R(!1)},ee=Bn.getProjectPhase(W,j),[te,re]=(0,o.useState)(!1),ne=(0,o.useRef)(null),se=(0,o.useRef)(null);return(0,o.useEffect)(()=>{const e=e=>{te&&se.current&&!se.current.contains(e.target)&&ne.current&&!ne.current.contains(e.target)&&re(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[te]),(0,kt.jsxs)("div",{className:"".concat(k?"bg-[#1e293b] hover:bg-[#232b4d] border-gray-600":"bg-white hover:bg-gray-50 border-gray-200"," rounded-[12px] shadow-sm border transition-all duration-200 hover:shadow-md cursor-pointer"),onClick:e=>{console.log("\ud83d\uddb1\ufe0f Container clicked, target:",e.target),console.log("\ud83d\uddb1\ufe0f Is button?",e.target.closest('button[type="button"]')),console.log("\ud83d\uddb1\ufe0f Is SVG?",e.target.closest("svg")),console.log("\ud83d\uddb1\ufe0f Is delete action?",e.target.closest('[data-action="delete"]')),console.log("\ud83d\uddb1\ufe0f Is reply action?",e.target.closest('[data-action="reply"]')),e.target.closest('button[type="button"]')||e.target.closest("svg")||e.target.closest('[data-action="delete"]')||e.target.closest('[data-action="reply"]')?console.log("\ud83d\uddb1\ufe0f Clicked on action button, not expanding"):(console.log("\ud83d\uddb1\ufe0f Expanding message"),E?E(j.id):_(!M))},children:[(0,kt.jsxs)("div",{className:"flex items-start gap-1.5 p-1.5",children:[(()=>{const e=(e=>{try{return Bn.getPhaseButtonProps(e||"LEAD")}catch(t){return console.warn("Phase data unavailable for phase:",e,t),{initials:"N",bgColor:"bg-gray-400",textColor:"text-white"}}})(ee);return(0,kt.jsx)("div",{className:"w-5 h-5 ".concat(e.bgColor," ").concat(e.textColor," rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start"),children:e.initials||"N"})})(),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"flex items-center overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-center min-w-0 flex-1",children:[(0,kt.jsx)("button",{className:"text-[9px] font-bold transition-colors hover:underline flex-shrink-0 ".concat(k?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),style:{width:"46px"},onClick:e=>{e.stopPropagation(),console.log("Project Number Clicked:",{project:W,activity:j,projectNumber:Y});let t=W;!t&&S&&j.projectId&&(t=S.find(e=>e.id===j.projectId||e.id===parseInt(j.projectId))),t||(t={id:j.projectId,projectNumber:Y,projectName:Q,customer:{primaryName:Q}}),N?(console.log("Navigating to project:",t),N(t,"Project Profile",null,I)):console.error("onProjectSelect is not available")},children:Y}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsx)("button",{ref:ne,className:"text-[9px] font-semibold transition-colors hover:underline truncate ".concat(k?"text-gray-300 hover:text-gray-200":"text-gray-700 hover:text-gray-800"),style:{maxWidth:"80px"},onClick:e=>{e.stopPropagation(),re(!te)},children:Q}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),re(!te)},className:"transform transition-transform duration-200 ".concat(te?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,kt.jsx)("div",{style:{position:"absolute",left:"140px",width:"200px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap ".concat(k?"text-gray-400":"text-gray-600"),style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1"},children:["Subject: ",X]})})]})}),(0,kt.jsx)("div",{className:"flex items-baseline gap-0 mt-0 overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-baseline gap-0",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",style:{width:"100px",marginLeft:"9px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap ".concat(k?"text-gray-400":"text-gray-600"),children:["From: ",J.user]})}),(0,kt.jsx)("div",{style:{position:"absolute",left:"141px",width:"200px"},children:(0,kt.jsx)("span",{className:"text-[9px] font-medium whitespace-nowrap ".concat(k?"text-gray-400":"text-gray-600"),style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1"},children:(()=>{const e=(null===J||void 0===J?void 0:J.recipients)||[];if(0===e.length)return"To: Team";if(1===e.length){const t=e[0],r=t.user?"".concat(t.user.firstName," ").concat(t.user.lastName).trim():"Team Member";return"To: ".concat(r)}if(2===e.length){const t=e.map(e=>e.user?"".concat(e.user.firstName," ").concat(e.user.lastName).trim():"Team Member");return"To: ".concat(t.join(", "))}{const t=e[0].user?"".concat(e[0].user.firstName," ").concat(e[0].user.lastName).trim():"Team Member";return"To: ".concat(t," +").concat(e.length-1," others")}})()})})]})})]}),(0,kt.jsxs)("div",{className:"flex flex-col justify-between items-end",style:{width:"80px",minHeight:"32px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"8px"},children:[j.hasTask&&(0,kt.jsx)("span",{className:"text-[8px] font-bold text-red-500",children:"Task"}),(0,kt.jsx)("div",{style:{width:"36px"}}),(0,kt.jsx)("div",{className:"w-1.5 h-1.5 rounded-full ".concat(k?"bg-blue-400":"bg-blue-500")}),(0,kt.jsx)("span",{className:"text-[9px] font-medium ".concat(k?"text-gray-400":"text-gray-600"),children:G.length})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"8px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",onClick:e=>e.stopPropagation(),children:[console.log("\ud83d\udd0d Checking delete button render:",{onDelete:typeof T,onDeleteFunction:T}),"function"===typeof T&&(0,kt.jsx)("button",{type:"button","data-action":"delete",style:{zIndex:10,position:"relative"},onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("\ud83d\uddd1\ufe0f Delete button clicked for message:",j.id),console.log("\ud83d\uddd1\ufe0f onDelete function:",typeof T,T),console.log("\ud83d\uddd1\ufe0f isDeleting:",D),D||"function"!==typeof T?console.log("\ud83d\uddd1\ufe0f Not calling onDelete - isDeleting:",D,"onDelete type:",typeof T):(console.log("\ud83d\uddd1\ufe0f Calling onDelete function"),T())},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onMouseUp:e=>{e.preventDefault(),e.stopPropagation()},disabled:D,className:"p-2 rounded transition-colors flex-shrink-0 border ".concat(D?"text-gray-400 cursor-not-allowed border-gray-300":k?"text-gray-400 hover:text-red-400 hover:bg-red-900/20 border-gray-600 hover:border-red-400":"text-gray-400 hover:text-red-600 hover:bg-red-50 border-gray-300 hover:border-red-400"),title:"Delete message",children:D?(0,kt.jsxs)("svg",{className:"w-2.5 h-2.5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8",strokeWidth:"4",strokeLinecap:"round"})]}):(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2h-4a2 2 0 00-2 2m6 0H9"})})}),(0,kt.jsx)("button",{type:"button","data-action":"reply",onClick:e=>{e.stopPropagation(),!O&&E&&E(),R(!L),L||setTimeout(()=>{B.current&&B.current.focus()},100)},className:"p-1 rounded transition-colors ".concat(L?k?"bg-[var(--color-primary-blueprint-blue)] text-white":"bg-blue-500 text-white":k?"bg-gray-700 text-gray-300 hover:bg-[var(--color-primary-blueprint-blue)] hover:text-white":"bg-gray-100 text-gray-600 hover:bg-blue-500 hover:text-white"),title:"Quick Reply",children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})})]}),(0,kt.jsx)("span",{className:"text-[8px] whitespace-nowrap ".concat("text-gray-500"),children:K(J.timestamp)})]})]})]}),te&&(0,kt.jsx)("div",{className:"relative",children:(0,kt.jsxs)("div",{ref:se,className:"absolute top-full left-0 z-50 mt-1 w-80 rounded-lg shadow-lg border backdrop-blur-sm ".concat(k?"bg-slate-800/95 border-slate-600/50 shadow-black/20":"bg-white/95 border-gray-200/50 shadow-gray-900/10"),style:{animation:"fadeIn 0.15s ease-out"},children:[(0,kt.jsx)("div",{className:"px-4 py-3 border-b ".concat(k?"border-slate-600/50":"border-gray-200/50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold ".concat(k?"text-white":"text-gray-900"),children:"Customer Information"}),(0,kt.jsx)("button",{onClick:()=>re(!1),className:"p-1 rounded-full transition-colors ".concat(k?"hover:bg-slate-700 text-slate-400 hover:text-slate-200":"hover:bg-gray-100 text-gray-400 hover:text-gray-600"),children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,kt.jsxs)("div",{className:"p-4 space-y-4",children:[(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide ".concat(k?"text-slate-300":"text-gray-600"),children:"Primary Contact"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(k?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(k?"text-white":"text-gray-900"," truncate"),children:(null===W||void 0===W||null===(n=W.customer)||void 0===n?void 0:n.primaryName)||(null===W||void 0===W||null===(s=W.client)||void 0===s?void 0:s.name)||(null===W||void 0===W?void 0:W.clientName)||Q})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(k?"bg-green-500/20 text-green-400":"bg-green-100 text-green-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("a",{href:"tel:".concat(((null===W||void 0===W||null===(a=W.customer)||void 0===a?void 0:a.primaryPhone)||(null===W||void 0===W||null===(i=W.client)||void 0===i?void 0:i.phone)||(null===W||void 0===W?void 0:W.clientPhone)||"(555) 123-4567").replace(/[^\d+]/g,"")),className:"text-sm hover:underline transition-colors ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:(null===W||void 0===W||null===(l=W.customer)||void 0===l?void 0:l.primaryPhone)||(null===W||void 0===W||null===(c=W.client)||void 0===c?void 0:c.phone)||(null===W||void 0===W?void 0:W.clientPhone)||"(555) 123-4567"})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(k?"bg-purple-500/20 text-purple-400":"bg-purple-100 text-purple-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("a",{href:"mailto:".concat((null===W||void 0===W||null===(d=W.customer)||void 0===d?void 0:d.primaryEmail)||(null===W||void 0===W||null===(u=W.client)||void 0===u?void 0:u.email)||(null===W||void 0===W?void 0:W.clientEmail)||"customer@email.com"),className:"text-sm hover:underline transition-colors truncate ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:(null===W||void 0===W||null===(h=W.customer)||void 0===h?void 0:h.primaryEmail)||(null===W||void 0===W||null===(m=W.client)||void 0===m?void 0:m.email)||(null===W||void 0===W?void 0:W.clientEmail)||"customer@email.com"})})]})]})]}),((null===W||void 0===W||null===(p=W.customer)||void 0===p?void 0:p.secondaryName)||(null===W||void 0===W||null===(g=W.customer)||void 0===g?void 0:g.secondaryPhone)||(null===W||void 0===W||null===(f=W.customer)||void 0===f?void 0:f.secondaryEmail))&&(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide ".concat(k?"text-slate-300":"text-gray-600"),children:"Secondary Contact"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(null===W||void 0===W||null===(x=W.customer)||void 0===x?void 0:x.secondaryName)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(k?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(k?"text-white":"text-gray-900"," truncate"),children:W.customer.secondaryName})})]}),(null===W||void 0===W||null===(v=W.customer)||void 0===v?void 0:v.secondaryPhone)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(k?"bg-green-500/20 text-green-400":"bg-green-100 text-green-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("a",{href:"tel:".concat(W.customer.secondaryPhone.replace(/[^\d+]/g,"")),className:"text-sm hover:underline transition-colors ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:W.customer.secondaryPhone})})]}),(null===W||void 0===W||null===(y=W.customer)||void 0===y?void 0:y.secondaryEmail)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(k?"bg-purple-500/20 text-purple-400":"bg-purple-100 text-purple-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("a",{href:"mailto:".concat(W.customer.secondaryEmail),className:"text-sm hover:underline transition-colors truncate ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:W.customer.secondaryEmail})})]})]})]}),((null===W||void 0===W?void 0:W.address)||(null===W||void 0===W||null===(b=W.customer)||void 0===b?void 0:b.address)||(null===W||void 0===W||null===(w=W.client)||void 0===w?void 0:w.address))&&(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide ".concat(k?"text-slate-300":"text-gray-600"),children:"Project Address"}),(0,kt.jsxs)("div",{className:"flex items-start gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full mt-0.5 ".concat(k?"bg-orange-500/20 text-orange-400":"bg-orange-100 text-orange-600"),children:(0,kt.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("div",{className:"text-sm leading-relaxed ".concat(k?"text-slate-300":"text-gray-700"),children:((e,t)=>{const r=(null===W||void 0===W?void 0:W.address)||(null===W||void 0===W||null===(e=W.customer)||void 0===e?void 0:e.address)||(null===W||void 0===W||null===(t=W.client)||void 0===t?void 0:t.address)||"Address not available",n=r.split(",");var s;return n.length>=2?(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium",children:null===(s=n[0])||void 0===s?void 0:s.trim()}),(0,kt.jsx)("div",{className:"text-xs opacity-75",children:n.slice(1).join(",").trim()})]}):r})()})})]})]})]})]})}),L&&(0,kt.jsx)("div",{className:"px-4 py-3 border-t ".concat(k?"bg-[#1e293b] border-gray-600":"bg-blue-50 border-blue-200"),children:(0,kt.jsxs)("form",{onSubmit:$,className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),(0,kt.jsxs)("span",{className:"text-sm font-semibold ".concat(k?"text-white":"text-gray-800"),children:["Quick Reply to ",Q]})]}),(0,kt.jsx)("button",{type:"button",onClick:Z,className:"p-1 rounded-full hover:bg-gray-200 ".concat(k?"hover:bg-gray-700 text-gray-400":"text-gray-500"),children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"text-xs p-2 rounded ".concat(k?"bg-[#232b4d] text-gray-300":"bg-white text-gray-600"),children:[(0,kt.jsx)("span",{className:"font-medium",children:"Project:"})," ",Y," | ",(0,kt.jsx)("span",{className:"font-medium",children:"Subject:"})," ",X]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("textarea",{ref:B,value:F,onChange:e=>U(e.target.value),placeholder:"Type your quick reply...",className:"flex-1 p-2 border rounded-lg text-sm resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(k?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500"),rows:"2",onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&$(e)}}),(0,kt.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,kt.jsx)("button",{type:"submit",disabled:!F.trim(),className:"px-3 py-1 rounded-lg text-sm font-medium transition-colors ".concat(F.trim()?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Send"}),(0,kt.jsx)("button",{type:"button",onClick:Z,className:"px-3 py-1 rounded-lg text-sm font-medium transition-colors ".concat(k?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Cancel"})]})]}),(0,kt.jsx)("div",{className:"text-xs ".concat(k?"text-gray-400":"text-gray-500"),children:"\xf0\u0178\u2019\xa1 Tip: Press Ctrl+Enter (Cmd+Enter on Mac) to send quickly"})]})}),O&&(0,kt.jsx)("div",{className:"px-3 py-3 border-t ".concat(k?"bg-[#1e293b] border-gray-600":"bg-white border-gray-200"),style:k?{}:{backgroundColor:"white"},children:(0,kt.jsx)("div",{className:"space-y-3",children:(0,kt.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-3 ".concat(k?"scrollbar-dark":"scrollbar-light"),children:G.map((e,t)=>(0,kt.jsxs)("div",{className:"".concat(k?"bg-[#374151]":"bg-white"," rounded-lg border ").concat(k?"border-gray-600":"border-gray-200"," p-3 shadow-sm"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white font-bold text-xs shadow-sm ".concat("You"===e.user?"bg-gradient-to-br from-green-500 to-green-600":"bg-gradient-to-br from-blue-500 to-blue-600"),children:e.user.split(" ").map(e=>e[0]).join("").substring(0,2)}),(0,kt.jsx)("span",{className:"text-sm font-semibold ".concat(k?"text-gray-200":"text-gray-800"),children:e.user})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-xs ".concat(k?"text-gray-400":"text-gray-500"),children:K(e.timestamp)}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),!O&&E&&E(),R(!0),U("@".concat(e.user,": ")),setTimeout(()=>{B.current&&B.current.focus()},100)},className:"p-1.5 rounded-full transition-colors ".concat(k?"bg-gray-700 text-gray-300 hover:bg-[var(--color-primary-blueprint-blue)] hover:text-white":"bg-gray-100 text-gray-600 hover:bg-blue-500 hover:text-white"),title:"Reply to ".concat(e.user),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})})]})]}),(0,kt.jsx)("div",{className:"text-sm leading-relaxed ".concat(k?"text-gray-100":"text-gray-800"),children:e.comment})]},e.id))})})})]})};var _s=r(877);const Os=["title","titleId"];function Ls(e,t){let{title:r,titleId:n}=e,s=Sn(e,Os);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const Rs=o.forwardRef(Ls),Fs=e=>{let{value:t,onChange:r,placeholder:n="Type your comment here...",availableUsers:s=[],className:a="",rows:i=2,onKeyPress:l=null}=e;const[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)({top:0,left:0}),[g,f]=(0,o.useState)(0),x=(0,o.useRef)(null),v=(0,o.useRef)(null),y=s.filter(e=>{var t,r,n;return(null===(t=e.firstName)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||(null===(r=e.lastName)||void 0===r?void 0:r.toLowerCase().includes(u.toLowerCase()))||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(u.toLowerCase()))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(u.toLowerCase())}),b=e=>{const n=x.current;if(!n)return;const s=n.selectionStart,a=t.substring(0,s),o=t.substring(s),i=a.lastIndexOf("@"),l=a.substring(0,i),c="@".concat(e.firstName," ").concat(e.lastName);r({target:{value:l+c+o}});const u=l.length+c.length;setTimeout(()=>{n.setSelectionRange(u,u),n.focus()},0),d(!1)};return(0,o.useEffect)(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&x.current&&!x.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,o.useEffect)(()=>{if(v.current&&c){const e=v.current.children[g];e&&e.scrollIntoView({block:"nearest"})}},[g,c]),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("textarea",{ref:x,value:t,onChange:e=>{const t=e.target.value;r(e);const n=e.target.selectionStart,s=t.substring(0,n),a=s.match(/@(\w*)$/);if(a){const e=a[1];h(e),d(!0),f(0);const t=x.current;if(t){t.getBoundingClientRect();const e=window.getComputedStyle(t),r=parseInt(e.lineHeight)||20,n=s.split("\n").length;p({top:n*r+25,left:0})}}else d(!1)},onKeyDown:e=>{c?"ArrowDown"===e.key?(e.preventDefault(),f(e=>e<y.length-1?e+1:0)):"ArrowUp"===e.key?(e.preventDefault(),f(e=>e>0?e-1:y.length-1)):"Enter"===e.key?(e.preventDefault(),y[g]&&b(y[g])):"Escape"===e.key&&d(!1):l&&l(e)},placeholder:n,className:"w-full px-2 py-1 text-[10px] border border-gray-200 rounded resize-none focus:outline-none focus:border-blue-400 ".concat(a),rows:i}),c&&y.length>0&&(0,kt.jsx)("div",{ref:v,className:"absolute z-50 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto",style:{top:"".concat(m.top,"px"),left:"".concat(m.left,"px"),minWidth:"200px"},children:y.map((e,t)=>(0,kt.jsxs)("div",{onClick:()=>b(e),className:"flex items-center gap-2 px-3 py-2 cursor-pointer hover:bg-gray-50 ".concat(t===g?"bg-blue-50 border-l-2 border-blue-500":""),children:[(0,kt.jsx)("div",{className:"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center",children:(0,kt.jsx)(Rs,{className:"w-4 h-4 text-gray-500"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"text-sm font-medium text-gray-900 truncate",children:[e.firstName," ",e.lastName]}),e.email&&(0,kt.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.email})]})]},e.id))}),c&&0===y.length&&u&&(0,kt.jsx)("div",{className:"absolute z-50 bg-white border border-gray-200 rounded-lg shadow-lg p-3",style:{top:"".concat(m.top,"px"),left:"".concat(m.left,"px"),minWidth:"200px"},children:(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:"No users found"})})]})},Us=e=>{var t,r,n;let{item:s,projects:a,colorMode:o,onProjectSelect:i,availableUsers:l=[],currentUser:c=null,onDelete:d=null,isDeleting:u=!1}=e;const{state:h,actions:m}=Fn();console.log("TaskItem Debug:",{id:s.id,assignedTo:s.assignedTo,recipient:s.recipient,author:s.author,attendees:s.attendees,assignedToAll:s.assignedToAll,assigneeId:s.assigneeId});const p=h.completedItems.has(s.id),g=h.expandedItems.has(s.id),f=null===a||void 0===a?void 0:a.find(e=>e&&e.id===s.projectId),x=(null===f||void 0===f?void 0:f.projectNumber)||s.projectNumber||"12345",v=(null===f||void 0===f||null===(t=f.customer)||void 0===t?void 0:t.primaryName)||(null===f||void 0===f||null===(r=f.client)||void 0===r?void 0:r.name)||(null===f||void 0===f?void 0:f.clientName)||(null===f||void 0===f?void 0:f.projectName)||s.projectName||"Primary Customer",y=s.subject||"Task",b=()=>{m.toggleExpanded(s.id)},w=()=>{const e=h.commentInputs[s.id];if(null!==e&&void 0!==e&&e.trim()){const t={id:Date.now(),text:e.trim(),user:Hr(c),timestamp:(new Date).toISOString()};m.addComment(s.id,t),m.setShowCommentInput(s.id,!1)}};return(0,kt.jsxs)("div",{className:"bg-white hover:bg-gray-50 border-gray-200 rounded-[12px] shadow-sm border transition-all duration-200 hover:shadow-md cursor-pointer ".concat(p?"opacity-75":""),children:[(0,kt.jsxs)("div",{className:"flex items-start gap-1.5 p-1",onClick:b,children:[(()=>{if(s.projectId&&f){const e=Bn.getProjectPhase(f),t=Bn.getPhaseInitials(e),r=Bn.getPhaseColor(e);return(0,kt.jsx)("div",{className:"w-5 h-5 text-white rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start",style:{backgroundColor:r},children:t})}return(0,kt.jsx)("div",{className:"w-5 h-5 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start",children:"T"})})(),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"flex items-baseline overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-center min-w-0 flex-1",children:[s.projectId&&f?(0,kt.jsx)("button",{className:"text-[9px] font-bold transition-colors hover:underline flex-shrink-0 text-blue-600 hover:text-blue-800",style:{width:"46px",marginLeft:"0px"},onClick:e=>{e.stopPropagation(),i&&i(f,"Project Profile",null,"Messages, Tasks, & Reminders")},children:x}):(0,kt.jsx)("span",{className:"text-[9px] font-bold text-gray-600",style:{width:"46px",marginLeft:"7px"},children:"General"}),s.projectId&&f&&(0,kt.jsx)("div",{className:"flex items-center gap-1",children:(0,kt.jsx)("span",{className:"text-[9px] font-semibold transition-colors truncate text-gray-700 hover:text-gray-800",style:{maxWidth:"80px"},children:v})}),(0,kt.jsx)("div",{style:{position:"absolute",left:"141px",width:"160px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium text-gray-600 truncate",style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:["Subject: ",y]})})]})}),(0,kt.jsx)("div",{className:"flex items-baseline gap-0 -mt-0.5 overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-baseline gap-0",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",style:{width:"100px",marginLeft:"8px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap text-gray-600",children:["From: ",s.author]})}),(0,kt.jsx)("div",{style:{position:"absolute",left:"141px",width:"160px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium text-gray-600 truncate",style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:["To: ",s.assignedTo&&s.assignedTo.trim()?s.assignedTo:s.recipient&&s.recipient.trim()?s.recipient:s.author&&s.author.trim()?s.author:"Unassigned"]})})]})})]}),(0,kt.jsxs)("div",{className:"flex flex-col justify-between items-end",style:{width:"80px",minHeight:"32px",marginRight:"15px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"5px"},children:[(0,kt.jsx)("span",{className:"text-[8px] font-bold text-orange-500",children:"Task"}),(0,kt.jsx)("input",{type:"checkbox",checked:p,onChange:async e=>{e.stopPropagation(),m.toggleCompleted(s.id);try{const e=String(s.id||"").replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");await Ds.calendarService.delete(e),console.log("\u2705 Task ".concat(e," completed and removed")),m.removeItem(s.id)}catch(t){console.error("Failed to update task status:",t),m.toggleCompleted(s.id)}},onClick:e=>e.stopPropagation(),className:"w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-1 flex-shrink-0"}),"function"===typeof d&&(0,kt.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),u||d()},disabled:u,className:"p-1 rounded transition-colors flex-shrink-0 ".concat(u?"text-gray-400 cursor-not-allowed":"text-gray-400 hover:text-red-600 hover:bg-red-50"),title:"Delete task",children:u?(0,kt.jsxs)("svg",{className:"w-2.5 h-2.5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8",strokeWidth:"4",strokeLinecap:"round"})]}):(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2h-4a2 2 0 00-2 2m6 0H9"})})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"1px"},children:[(0,kt.jsx)("span",{className:"text-[8px] whitespace-nowrap text-gray-500",children:new Date(s.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric"})+", "+new Date(s.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),(0,kt.jsx)("button",{onClick:b,className:"p-1 rounded transition-colors transform duration-200 hover:bg-gray-100 ".concat(g?"rotate-180":""," text-gray-600"),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),g&&(0,kt.jsx)("div",{className:"px-3 py-3 border-t bg-gray-50 border-gray-200",children:(0,kt.jsxs)("div",{className:"space-y-3",children:[s.content&&(0,kt.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed bg-white p-3 rounded-lg border border-gray-200 shadow-sm",children:s.content}),(0,kt.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold text-gray-700",children:"Comments"}),(0,kt.jsx)("button",{onClick:()=>{m.setShowCommentInput(s.id,!h.showCommentInput[s.id])},className:"text-[9px] text-blue-600 hover:text-blue-700 font-medium",children:h.showCommentInput[s.id]?"Cancel":"Add Comment"})]}),h.comments[s.id]&&h.comments[s.id].length>0&&(0,kt.jsx)("div",{className:"space-y-2 mb-2 max-h-48 overflow-y-auto",children:h.comments[s.id].map(e=>(0,kt.jsx)("div",{className:"bg-gray-50 p-2 rounded border border-gray-100",children:(0,kt.jsxs)("div",{className:"flex items-start justify-between",children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("p",{className:"text-[10px] font-semibold text-gray-700",children:["Comment by: ",e.user]}),(0,kt.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.text})]}),(0,kt.jsx)("span",{className:"text-[9px] text-gray-400 ml-2",children:new Date(e.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]})},e.id))}),h.showCommentInput[s.id]&&(0,kt.jsxs)("div",{className:"mt-2 border-t border-gray-200 pt-2",children:[(0,kt.jsx)(Fs,{value:h.commentInputs[s.id]||"",onChange:e=>{m.setCommentInputs(s.id,e.target.value)},placeholder:"Type your comment here... Use @ to mention users",availableUsers:l,className:"w-full",rows:2,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())}}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1 mt-1",children:[(0,kt.jsx)("button",{onClick:()=>{m.setShowCommentInput(s.id,!1),m.setCommentInputs(s.id,"")},className:"px-2 py-1 text-[9px] text-gray-600 hover:text-gray-700 font-medium",children:"Cancel"}),(0,kt.jsx)("button",{onClick:w,disabled:!(null!==(n=h.commentInputs[s.id])&&void 0!==n&&n.trim()),className:"px-2 py-1 text-[9px] bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:"Post Comment"})]})]})]}),(0,kt.jsx)("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-200",children:s.projectId&&f&&(0,kt.jsxs)("button",{onClick:()=>{i&&i(f,"Project Profile",null,"Activity Feed")},className:"px-3 py-1.5 text-xs font-medium text-blue-600 border border-blue-600 rounded hover:bg-blue-50 transition-colors flex items-center gap-1",children:[(0,kt.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View Project"]})})]})})]})},Bs=e=>{var t,r,n;let{item:s,projects:a,colorMode:o,onProjectSelect:i,availableUsers:l=[],currentUser:c=null,onDelete:d=null,isDeleting:u=!1}=e;const{state:h,actions:m}=Fn(),p=h.completedItems.has(s.id),g=h.expandedItems.has(s.id),f=null===a||void 0===a?void 0:a.find(e=>e&&e.id===s.projectId),x=(null===f||void 0===f?void 0:f.projectNumber)||s.projectNumber||"12345",v=(null===f||void 0===f||null===(t=f.customer)||void 0===t?void 0:t.primaryName)||(null===f||void 0===f||null===(r=f.client)||void 0===r?void 0:r.name)||(null===f||void 0===f?void 0:f.clientName)||(null===f||void 0===f?void 0:f.projectName)||s.projectName||"Primary Customer",y=s.subject||s.title||"Reminder",b=l.find(e=>String(e.id)===String(s.authorId))||{firstName:"System",lastName:"Admin"},w=Array.isArray(s.recipients)?s.recipients.map(e=>"all"===e?{firstName:"All",lastName:"Users",isAll:!0}:l.find(t=>String(t.id)===String(e))).filter(Boolean):[],j=()=>{m.toggleExpanded(s.id)};return(0,kt.jsxs)("div",{className:"bg-white hover:bg-gray-50 border-gray-200 rounded-[12px] shadow-sm border transition-all duration-200 hover:shadow-md cursor-pointer",children:[(0,kt.jsxs)("div",{className:"flex items-start gap-1.5 p-1",onClick:j,children:[(()=>{if(s.projectId&&f){const e=Bn.getProjectPhase(f),t=Bn.getPhaseInitials(e),r=Bn.getPhaseColor(e);return(0,kt.jsx)("div",{className:"w-5 h-5 text-white rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start",style:{backgroundColor:r},children:t})}return(0,kt.jsx)("div",{className:"w-5 h-5 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start",children:"R"})})(),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"flex items-baseline overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-center min-w-0 flex-1",children:[s.projectId&&f?(0,kt.jsx)("button",{className:"text-[9px] font-bold text-blue-600 hover:text-blue-700 hover:underline flex-shrink-0",style:{width:"46px",marginLeft:"2px"},onClick:e=>{e.stopPropagation(),i&&i(f,"Project Profile",null,"Messages, Tasks, & Reminders")},children:x?"#".concat(String(x).padStart(5,"0")):"#00000"}):(0,kt.jsx)("span",{className:"text-[9px] font-bold text-gray-600",style:{width:"46px",marginLeft:"10px"},children:"General"}),(0,kt.jsxs)("div",{className:"flex items-center min-w-0 mx-1.5",children:[s.projectId&&f&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{className:"text-[9px] font-bold text-gray-700 truncate flex-shrink-0",style:{maxWidth:"120px"},children:v}),(0,kt.jsx)("span",{className:"mx-1.5 text-[9px] text-gray-400 flex-shrink-0",children:"|"})]}),(0,kt.jsx)("div",{style:{position:"absolute",left:"140px",width:"160px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium text-gray-600 truncate",style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:["Subject: ",y]})})]})]})}),(0,kt.jsx)("div",{className:"flex items-baseline gap-0 -mt-0.5 overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-baseline gap-0",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",style:{width:"100px",marginLeft:"11px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap text-gray-600",children:["From: ",b.firstName," ",b.lastName]})}),(0,kt.jsx)("div",{style:{position:"absolute",left:"141px",width:"200px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap text-gray-600",style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1"},children:["To: ",w.length>0?w[0].isAll?"All Users":"".concat(w[0].firstName," ").concat(w[0].lastName):"No recipients",w.length>1&&!w[0].isAll&&(0,kt.jsxs)("span",{className:"text-[7px] bg-orange-100 text-orange-700 px-1 py-0.5 rounded-full font-medium ml-1",children:["+",w.length-1]})]})})]})})]}),(0,kt.jsxs)("div",{className:"flex flex-col justify-between items-end",style:{width:"80px",minHeight:"32px",marginRight:"20px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"1px"},children:[(0,kt.jsx)("span",{className:"text-[8px] font-bold text-gray-900",children:"Reminder"}),(0,kt.jsx)("input",{type:"checkbox",checked:p,onChange:async e=>{e.stopPropagation(),m.toggleCompleted(s.id);try{let e=String(s.id||"");for(console.log("\ud83d\udd0d Original reminder ID:",e);/^(task_|cal_|activity_|reminder_|msg_)/.test(e);)e=e.replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");console.log("\ud83d\udd0d Extracted real ID:",e),s.alertId?(await Ds.workflowAlertsService.completeStep(s.alertId,s.projectId,s.lineItemId||"",""),console.log("\u2705 Reminder alert ".concat(s.alertId," marked as completed"))):(await Ds.calendarService.delete(e),console.log("\u2705 Reminder ".concat(e," completed and removed")),m.removeItem(s.id))}catch(t){console.error("Failed to update reminder status:",t),m.toggleCompleted(s.id)}},onClick:e=>e.stopPropagation(),className:"w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-1 flex-shrink-0"}),"function"===typeof d&&(0,kt.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),u||d()},disabled:u,className:"p-1 rounded transition-colors flex-shrink-0 ".concat(u?"text-gray-400 cursor-not-allowed":"text-gray-400 hover:text-red-600 hover:bg-red-50"),title:"Delete reminder",children:u?(0,kt.jsxs)("svg",{className:"w-2.5 h-2.5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8",strokeWidth:"4",strokeLinecap:"round"})]}):(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2h-4a2 2 0 00-2 2m6 0H9"})})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"2px"},children:[(0,kt.jsx)("span",{className:"text-[8px] whitespace-nowrap text-gray-500",children:new Date(s.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric"})+", "+new Date(s.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),(0,kt.jsx)("button",{onClick:j,className:"p-1 rounded transition-colors transform duration-200 hover:bg-gray-100 ".concat(g?"rotate-180":""," text-gray-600"),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),g&&(0,kt.jsxs)("div",{className:"px-3 pb-3 pt-1 border-t border-gray-100",children:[s.content&&(0,kt.jsx)("div",{className:"mb-3",children:(0,kt.jsx)("p",{className:"text-xs text-gray-700 leading-relaxed whitespace-pre-wrap",children:s.content})}),(0,kt.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("h4",{className:"text-[10px] font-semibold text-gray-700",children:"Comments"}),(0,kt.jsx)("button",{onClick:()=>{m.setShowCommentInput(s.id,!h.showCommentInput[s.id])},className:"text-[9px] text-blue-600 hover:text-blue-700 font-medium",children:h.showCommentInput[s.id]?"Cancel":"Add Comment"})]}),h.comments[s.id]&&h.comments[s.id].length>0&&(0,kt.jsx)("div",{className:"space-y-2 mb-2 max-h-32 overflow-y-auto",children:h.comments[s.id].map((e,t)=>(0,kt.jsxs)("div",{className:"bg-gray-50 rounded p-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,kt.jsxs)("span",{className:"text-[9px] font-semibold text-gray-700",children:["Comment by: ",e.userName||"Unknown User"]}),(0,kt.jsxs)("span",{className:"text-[8px] text-gray-500",children:["\u2022 ",new Date(e.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]})]}),(0,kt.jsx)("p",{className:"text-[10px] text-gray-600",children:e.content})]},t))}),h.showCommentInput[s.id]&&(0,kt.jsxs)("div",{className:"mt-2",children:[(0,kt.jsx)(Fs,{value:h.commentInputs[s.id]||"",onChange:e=>{m.setCommentInputs(s.id,e.target.value)},placeholder:"Type your comment here... Use @ to mention users",availableUsers:l,className:"w-full",rows:2}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1 mt-1",children:[(0,kt.jsx)("button",{onClick:()=>{m.setShowCommentInput(s.id,!1),m.setCommentInputs(s.id,"")},className:"px-2 py-1 text-[9px] text-gray-600 hover:text-gray-700 font-medium",children:"Cancel"}),(0,kt.jsx)("button",{onClick:()=>{const e=h.commentInputs[s.id];if(null!==e&&void 0!==e&&e.trim()){const t={id:Date.now(),content:e.trim(),userName:Hr(c),createdAt:(new Date).toISOString()};m.addComment(s.id,t)}},disabled:!(null!==(n=h.commentInputs[s.id])&&void 0!==n&&n.trim()),className:"px-2 py-1 text-[9px] bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:"Post Comment"})]})]})]}),i&&s.projectId&&f&&(0,kt.jsx)("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100",children:(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),i&&i(f,"Project Profile",null,"Messages, Tasks, & Reminders")},className:"text-[8px] font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 px-2 py-1 rounded transition-colors",children:"View Project"})})]})]})},Ws=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},zs=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var Vs={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Hs=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],qs=(0,o.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:i="",children:l,iconNode:c}=e,d=Sn(e,Hs);return(0,o.createElement)("svg",(0,Y.A)((0,Y.A)((0,Y.A)({ref:t},Vs),{},{width:n,height:n,stroke:r,strokeWidth:a?24*Number(s)/Number(n):s,className:zs("lucide",i)},!l&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"}),d),[...c.map(e=>{let[t,r]=e;return(0,o.createElement)(t,r)}),...Array.isArray(l)?l:[l]])}),Ks=["className"],Gs=(e,t)=>{const r=(0,o.forwardRef)((r,n)=>{let{className:s}=r,a=Sn(r,Ks);return(0,o.createElement)(qs,(0,Y.A)({ref:n,iconNode:t,className:zs("lucide-".concat((i=Ws(e),i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),s)},a));var i});return r.displayName=Ws(e),r},Js=Gs("bug",[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]]),Ys=Gs("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Qs=Gs("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),Xs=Gs("thumbs-up",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),$s=Gs("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Zs=Gs("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),ea=Gs("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),ta=e=>{var t,r;let{item:n,projects:s=[],colorMode:a=!1,onProjectSelect:i,availableUsers:l=[],currentUser:c,onDelete:d,isDeleting:u=!1}=e;const[h,m]=(0,o.useState)([]),[p,g]=(0,o.useState)(""),[f,x]=(0,o.useState)(!1),[v,y]=(0,o.useState)(!1),[b,w]=(0,o.useState)(!1);(0,o.useEffect)(()=>{v&&0===h.length&&j()},[v]);const j=async()=>{w(!0);try{const e=await Ds.feedbackService.getComments(n.id);m(Array.isArray(e.data)?e.data:[])}catch(e){console.error("Failed to load replies:",e),fr.error("Failed to load replies")}finally{w(!1)}},N=e=>"BUG"===e?"text-red-600 bg-red-100":"text-[#EF946C] bg-[#FDF2E9]",S=s.find(e=>e.id===n.projectId),k=l.find(e=>e.id===n.authorId)||{firstName:"Anonymous",lastName:""};return(0,kt.jsxs)("div",{className:"p-4 ".concat(a?"bg-slate-800":"bg-white"),children:[(0,kt.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,kt.jsx)("div",{className:"p-2 rounded-lg ".concat(N(n.type)),children:(e=>{switch(e){case"BUG":return(0,kt.jsx)(Js,{className:"h-4 w-4"});case"FEATURE":case"IDEA":return(0,kt.jsx)(Ys,{className:"h-4 w-4"});default:return(0,kt.jsx)(Qs,{className:"h-4 w-4"})}})(n.type)}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("h4",{className:"font-semibold ".concat(a?"text-white":"text-gray-900"),children:n.title}),(0,kt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(N(n.type)),children:n.type}),(0,kt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(e){case"LOW":return"text-green-600 bg-green-100";case"MEDIUM":return"text-yellow-600 bg-yellow-100";case"HIGH":return"text-orange-600 bg-orange-100";case"CRITICAL":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}})(n.severity)),children:n.severity})]}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,kt.jsxs)("span",{className:"text-sm ".concat(a?"text-gray-400":"text-gray-500"),children:["by ",k.firstName," ",k.lastName]}),(0,kt.jsx)("span",{className:"text-sm ".concat(a?"text-gray-400":"text-gray-500"),children:(e=>{try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Just now"}})(n.timestamp)})]})]})]}),(0,kt.jsx)("div",{className:"flex items-center space-x-2",children:(0,kt.jsx)("button",{onClick:()=>null===d||void 0===d?void 0:d(n),disabled:u,className:"p-1 rounded text-xs transition-colors ".concat(a?"text-gray-400 hover:text-red-400 hover:bg-slate-700":"text-gray-500 hover:text-red-500 hover:bg-gray-100"),title:"Delete feedback",children:u?"...":"\xd7"})})]}),(0,kt.jsx)("div",{className:"mb-3 ".concat(a?"text-gray-300":"text-gray-700"),children:(0,kt.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:n.content||n.description})}),(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-4",children:[S&&(0,kt.jsxs)("button",{onClick:()=>null===i||void 0===i?void 0:i(S),className:"text-xs font-medium transition-colors ".concat("text-[#EF946C] hover:text-[#E67E22]"),children:["#",S.projectNumber," - ",(null===(t=S.customer)||void 0===t?void 0:t.name)||S.clientName||S.name]}),(0,kt.jsxs)("div",{className:"flex items-center space-x-3 text-xs text-gray-500",children:[(0,kt.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,kt.jsx)(Xs,{className:"h-3 w-3"}),(0,kt.jsx)("span",{children:n.voteCount||0})]}),(0,kt.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,kt.jsx)(Qs,{className:"h-3 w-3"}),(0,kt.jsx)("span",{children:n.commentCount||0})]})]})]}),(0,kt.jsx)("div",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("RESOLVED"===n.status?"text-green-600 bg-green-100":"IN_PROGRESS"===n.status?"text-blue-600 bg-blue-100":"text-gray-600 bg-gray-100"),children:n.status||"OPEN"})]}),(0,kt.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,kt.jsxs)("button",{onClick:()=>y(!v),className:"flex items-center gap-2 text-sm font-medium transition-colors ".concat("text-[#EF946C] hover:text-[#E67E22]"),children:[(0,kt.jsx)(Qs,{className:"h-4 w-4"}),(0,kt.jsxs)("span",{children:[v?"Hide":"Show"," Replies (",n.commentCount||0,")"]}),v?(0,kt.jsx)($s,{className:"h-4 w-4"}):(0,kt.jsx)(Zs,{className:"h-4 w-4"})]}),v&&(0,kt.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,kt.jsx)("div",{className:"p-4 rounded-lg border ".concat(a?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(a?"bg-slate-600 text-white":"bg-gray-200 text-gray-700"),children:(null===c||void 0===c||null===(r=c.firstName)||void 0===r?void 0:r.charAt(0))||"U"}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("textarea",{value:p,onChange:e=>g(e.target.value),placeholder:"Add a reply...",rows:3,className:"w-full px-3 py-2 rounded-lg border ".concat(a?"bg-slate-600 border-slate-500 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-[#EF946C] focus:border-transparent")}),(0,kt.jsx)("div",{className:"flex justify-end mt-2",children:(0,kt.jsxs)("button",{onClick:async()=>{if(p.trim()){x(!0);try{const e=(await Ds.feedbackService.addComment(n.id,{body:p,isDeveloper:"DEVELOPER"===(null===c||void 0===c?void 0:c.role)||"ADMIN"===(null===c||void 0===c?void 0:c.role),parentId:null})).data;m(t=>[e,...t]),g(""),fr.success("Reply posted successfully!")}catch(e){console.error("Failed to submit reply:",e),fr.error("Failed to post reply. Please try again.")}finally{x(!1)}}},disabled:!p.trim()||f,className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors ".concat(!p.trim()||f?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#EF946C] text-white hover:bg-[#E67E22]"),children:[(0,kt.jsx)(ea,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:f?"Posting...":"Post Reply"})]})})]})]})}),b?(0,kt.jsx)("div",{className:"text-center py-4",children:(0,kt.jsx)("div",{className:"text-sm ".concat(a?"text-gray-400":"text-gray-500"),children:"Loading replies..."})}):(0,kt.jsxs)("div",{className:"space-y-3",children:[h.map(e=>{var t,r,n;return(0,kt.jsx)("div",{className:"p-3 rounded-lg border ".concat(e.isPinned?"border-yellow-300 bg-yellow-50":a?"bg-slate-700 border-slate-600":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,kt.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium ".concat(e.isDeveloper?"bg-blue-500 text-white":a?"bg-slate-600 text-white":"bg-gray-200 text-gray-700"),children:(null===(t=e.author)||void 0===t||null===(r=t.name)||void 0===r?void 0:r.charAt(0))||"U"}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,kt.jsx)("span",{className:"text-sm font-medium ".concat(a?"text-white":"text-gray-900"),children:(null===(n=e.author)||void 0===n?void 0:n.name)||"Anonymous"}),e.isDeveloper&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Developer"}),(0,kt.jsx)("span",{className:"text-xs ".concat(a?"text-gray-400":"text-gray-500"),children:new Date(e.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,kt.jsx)("div",{className:"text-sm whitespace-pre-wrap ".concat(a?"text-gray-300":"text-gray-700"),children:e.body})]})]})},e.id)}),0===h.length&&(0,kt.jsx)("div",{className:"text-center py-4 text-sm ".concat(a?"text-gray-400":"text-gray-500"),children:"No replies yet. Be the first to reply!"})]})]})]})]})},ra=e=>{let{document:t,isOpen:r,onClose:n}=e;const[s,a]=(0,o.useState)(!0),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)(null);(0,o.useEffect)(()=>(r&&t&&m(),()=>{c&&c.startsWith("blob:")&&URL.revokeObjectURL(c)}),[r,t]);const m=async()=>{a(!0),l(null);try{var e;console.log("\ud83d\udcc4 Loading document:",t);const n=null===(e=(t.fileName||t.title||t.name||"").split(".").pop())||void 0===e?void 0:e.toLowerCase();let s="unknown";if(["pdf"].includes(n)?s="pdf":["jpg","jpeg","png","gif","webp","svg"].includes(n)?s="image":["doc","docx"].includes(n)?s="word":["xls","xlsx"].includes(n)?s="excel":["txt","md"].includes(n)&&(s="text"),h(s),t.url)return console.log("\u2705 Using direct URL:",t.url),d(t.url),void a(!1);if(t.assetId||t.id){const e=t.assetId||t.id;try{const t=await _s.assetsService.getViewUrl(e);if(console.log("\u2705 Got presigned view URL:",t),null!==t&&void 0!==t&&t.url)return console.log("\u2705 Using presigned URL:",t.url),d(t.url),void a(!1);throw new Error("No presigned URL returned")}catch(r){throw console.error("Failed to get presigned URL:",r),new Error("Could not load document from server")}}throw new Error("Document has no URL or asset ID")}catch(r){console.error("Error loading document:",r),l(r.message||"Failed to load document"),a(!1)}};return r?(0,kt.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-75 backdrop-blur-sm",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,kt.jsxs)("div",{className:"relative w-11/12 h-5/6 max-w-6xl bg-white rounded-lg shadow-2xl overflow-hidden",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-lg font-semibold",children:(null===t||void 0===t?void 0:t.title)||(null===t||void 0===t?void 0:t.fileName)||(null===t||void 0===t?void 0:t.name)||"Document Viewer"}),(null===t||void 0===t?void 0:t.fileSize)&&(0,kt.jsxs)("p",{className:"text-xs text-blue-100",children:[(t.fileSize/1024).toFixed(2)," KB"]})]})]}),(0,kt.jsx)("button",{onClick:n,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",children:(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"h-[calc(100%-4rem)] overflow-auto bg-gray-50",children:[s&&(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mb-4"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Loading document..."})]}),i&&(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,kt.jsx)("div",{className:"w-20 h-20 mb-4 bg-red-100 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Failed to Load Document"}),(0,kt.jsx)("p",{className:"text-gray-600 mb-4",children:i}),(0,kt.jsx)("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Close"})]}),!s&&!i&&c&&(0,kt.jsxs)(kt.Fragment,{children:["pdf"===u&&(0,kt.jsxs)("div",{className:"w-full h-full relative",children:[(0,kt.jsx)("embed",{src:c,type:"application/pdf",className:"w-full h-full"}),(0,kt.jsx)("div",{className:"absolute bottom-4 right-4",children:(0,kt.jsxs)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 shadow-lg",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Open in New Tab"]})})]}),"image"===u&&(0,kt.jsx)("div",{className:"flex items-center justify-center h-full p-8",children:(0,kt.jsx)("img",{src:c,alt:(null===t||void 0===t?void 0:t.title)||"Document",className:"max-w-full max-h-full object-contain"})}),"text"===u&&(0,kt.jsx)("div",{className:"p-8 h-full overflow-auto",children:(0,kt.jsx)("pre",{className:"whitespace-pre-wrap font-mono text-sm text-gray-800 bg-white p-4 rounded",children:"Loading text content..."})}),["word","excel","unknown"].includes(u)&&(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[(0,kt.jsx)("div",{className:"w-20 h-20 mb-4 bg-blue-100 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:(null===t||void 0===t?void 0:t.title)||(null===t||void 0===t?void 0:t.fileName)||"Document"}),(0,kt.jsx)("p",{className:"text-gray-600 mb-6 text-center max-w-md",children:"This file type cannot be previewed in the browser. Click the button below to download it."}),(0,kt.jsxs)("a",{href:c,download:(null===t||void 0===t?void 0:t.fileName)||(null===t||void 0===t?void 0:t.title)||"document",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download File"]})]})]})]})]})}):null},na=e=>{let{activityFeedItems:t,projects:r,colorMode:n,activityProjectFilter:s,activityTypeFilter:a,setActivityProjectFilter:i,setActivityTypeFilter:l,handleProjectSelectWithScroll:c,availableUsers:d=[],currentUser:u=null}=e;const{state:h,actions:m}=Fn(),[p,g]=(0,o.useState)(!0),[f,x]=(0,o.useState)(null),[v,y]=(0,o.useState)(!1),[b,w]=(0,o.useState)(new Set),j=(0,o.useMemo)(()=>{if(!Array.isArray(t)||0===t.length)return"len:0";try{return"len:"+t.length+"|"+t.map(e=>"".concat(e.id,":").concat(e.timestamp||"")).join("|")}catch(e){return"len:"+t.length}},[t]),N=(0,o.useRef)(null);(0,o.useEffect)(()=>{j!==N.current&&(m.setItems(Array.isArray(t)?t:[]),N.current=j)},[j,t,m]);const S=(0,o.useRef)(null);S.current||(S.current=new Set),(0,o.useEffect)(()=>{const e=h.items||[];e.length>0&&e.forEach(e=>{S.current.has(e.id)||h.expandedItems.has(e.id)||(m.toggleExpanded(e.id),S.current.add(e.id))})},[h.items,h.expandedItems,m]);const k=async e=>{if(null===e||void 0===e||!e.id)return;const t="message"===e.type?"message":"task"===e.type?"task":"reminder"===e.type?"reminder":"item";if(window.confirm("Delete this ".concat(t,"? This action cannot be undone."))){w(t=>{const r=new Set(t);return r.add(e.id),r});try{let r=String(e.id||"");if(r=r.replace(/^(task_|cal_|activity_|reminder_|msg_)/,""),console.log("\ud83d\uddd1\ufe0f Delete attempt:",{originalId:e.id,realId:r,type:e.type}),"message"===e.type)await Ds.projectMessagesService.delete(r);else if("task"===e.type)await Ds.tasksService.delete(r);else{if("reminder"!==e.type)throw new Error("Unsupported activity type: ".concat(e.type));await Ds.calendarService.delete(r)}m.removeItem(e.id),Vr.success("".concat(t.charAt(0).toUpperCase()+t.slice(1)," deleted."))}catch(s){var r,n;console.error("Failed to delete activity item:",s);const e=(null===s||void 0===s||null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||(null===s||void 0===s?void 0:s.message)||"Failed to delete item.";Vr.error(e)}finally{w(t=>{const r=new Set(t);return r.delete(e.id),r})}}};return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"w-full flex flex-col","data-section":"activity-feed",children:(0,kt.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-soft rounded-2xl p-6 relative overflow-visible flex-1 min-h-[800px]",children:[(0,kt.jsx)("div",{className:"mb-3",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-1",children:"Activity Feed"}),(0,kt.jsxs)("div",{className:"text-xs text-gray-500",children:[t.length," items total"]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{new Set((h.items||[]).map(e=>e.id)).forEach(e=>{h.expandedItems.has(e)||m.toggleExpanded(e)})},className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat((()=>{const e=(h.items||[]).length;return h.expandedItems.size===e&&e>0?"bg-brand-500 text-white border-brand-500 shadow-brand-glow":"bg-white/80 text-brand-600 border-gray-200 hover:bg-white hover:border-brand-300 hover:shadow-soft"})()),title:"Expand all activity details",disabled:(()=>{const e=(h.items||[]).length;return 0===e||h.expandedItems.size===e})(),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),(0,kt.jsx)("button",{onClick:()=>{new Set((h.items||[]).map(e=>e.id)).forEach(e=>{h.expandedItems.has(e)&&m.toggleExpanded(e)})},className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat(0===h.expandedItems.size?"bg-orange-500 text-white border-orange-500 shadow-accent-glow":"bg-white/80 text-orange-600 border-gray-200 hover:bg-white hover:border-orange-300 hover:shadow-soft"),title:"Collapse all activity details",disabled:0===h.expandedItems.size,children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})]})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,kt.jsxs)("select",{value:s,onChange:e=>i(e.target.value),className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white/80 text-gray-700 hover:border-gray-300 hover:bg-white transition-all duration-300 min-w-[120px]",children:[(0,kt.jsx)("option",{value:"",children:"All Projects"}),(r||[]).map(e=>{var t;return(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.name]},e.id)})]}),(0,kt.jsxs)("select",{value:a||"",onChange:e=>l(e.target.value),className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white/80 text-gray-700 hover:border-gray-300 hover:bg-white transition-all duration-300 min-w-[100px]",children:[(0,kt.jsx)("option",{value:"",children:"All Types"}),(0,kt.jsx)("option",{value:"message",children:"Messages"}),(0,kt.jsx)("option",{value:"task",children:"Tasks"}),(0,kt.jsx)("option",{value:"reminder",children:"Reminders"}),(0,kt.jsx)("option",{value:"feedback",children:"Feedback"})]})]}),p&&(0,kt.jsx)("div",{className:"space-y-3 flex-1 overflow-y-auto custom-scrollbar",children:(()=>{const e=(h.items||[]).filter(e=>{const t=!s||String(e.projectId)===String(s),r=!a||e.type===a;return t&&r}).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));return 0===e.length?(0,kt.jsx)("div",{className:"text-gray-400 text-center py-8 text-sm",children:"No activity yet."}):e.map(e=>{const t=(e=>{switch(e){case"message":return{stripe:"bg-blue-500",container:"bg-blue-100 border-blue-200"};case"task":return{stripe:"bg-emerald-500",container:"bg-emerald-100 border-emerald-200"};case"reminder":return{stripe:"bg-orange-500",container:"bg-orange-100 border-orange-200"};case"feedback":return{stripe:"bg-[#EF946C]",container:"bg-[#FDF2E9] border-[#EF946C]/30"};default:return{stripe:"bg-gray-300",container:"bg-gray-50/40 border-gray-100"}}})(e.type),s=b.has(e.id);var a;return"message"===e.type?(0,kt.jsxs)("div",{className:"relative rounded-xl border ".concat(t.container," overflow-hidden shadow-md"),children:[(0,kt.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(t.stripe)}),(0,kt.jsx)(Ms,{activity:e,onProjectSelect:c,projects:r||[],colorMode:n,useRealData:!0,onQuickReply:()=>{},isExpanded:h.expandedItems.has(e.id)||0===h.expandedItems.size&&(h.items||[]).length>0,onToggleExpansion:()=>m.toggleExpanded(e.id),sourceSection:"Activity Feed",onDelete:()=>k(e),isDeleting:s}),Array.isArray(null===e||void 0===e||null===(a=e.metadata)||void 0===a?void 0:a.attachments)&&e.metadata.attachments.length>0&&(0,kt.jsx)("div",{className:"px-3 pb-3",children:(0,kt.jsx)("div",{className:"flex flex-col gap-1.5",children:e.metadata.attachments.map((e,t)=>{const r=e.title||e.fileName||e.originalName||"Attachment",n=(e.extension||e.fileType||r.split(".").pop()||"").toString();return(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-3 border border-gray-200 rounded-lg bg-white px-3 py-2 text-xs shadow-sm hover:shadow transition-shadow",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,kt.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-md bg-gray-100 text-gray-600 border border-gray-200",children:(0,kt.jsx)("span",{className:"text-[10px] font-semibold uppercase",children:n?n.slice(0,4):"DOC"})}),(0,kt.jsxs)("div",{className:"min-w-0",children:[(0,kt.jsx)("div",{className:"font-medium text-gray-800 truncate",title:r,children:r}),e.description&&(0,kt.jsx)("div",{className:"text-[10px] text-gray-500 truncate",title:e.description,children:e.description})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[e.fileSize&&(0,kt.jsx)("span",{className:"text-[10px] text-gray-400",children:e.fileSize}),(0,kt.jsxs)("button",{type:"button",onClick:t=>{t.stopPropagation(),x(e),y(!0)},className:"inline-flex items-center gap-1 rounded border border-gray-300 px-2 py-1 text-[10px] font-medium text-gray-600 hover:bg-gray-100",children:[(0,kt.jsxs)("svg",{className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})]})]},t)})})})]},e.id):"task"===e.type?(0,kt.jsxs)("div",{className:"relative rounded-xl border ".concat(t.container," overflow-hidden shadow-md"),children:[(0,kt.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(t.stripe)}),(0,kt.jsx)(Us,{item:e,projects:r||[],colorMode:n,onProjectSelect:c,availableUsers:d,currentUser:u,onDelete:()=>k(e),isDeleting:s})]},e.id):"reminder"===e.type?(0,kt.jsxs)("div",{className:"relative rounded-xl border ".concat(t.container," overflow-hidden shadow-md"),children:[(0,kt.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(t.stripe)}),(0,kt.jsx)(Bs,{item:e,projects:r||[],colorMode:n,onProjectSelect:c,availableUsers:d,currentUser:u,onDelete:()=>k(e),isDeleting:s})]},e.id):"feedback"===e.type?(0,kt.jsxs)("div",{className:"relative rounded-xl border ".concat(t.container," overflow-hidden shadow-md"),children:[(0,kt.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(t.stripe)}),(0,kt.jsx)(ta,{item:e,projects:r||[],colorMode:n,onProjectSelect:c,availableUsers:d,currentUser:u,onDelete:()=>k(e),isDeleting:s})]},e.id):null})})()})]})}),(0,kt.jsx)(ra,{document:f,isOpen:v,onClose:()=>{y(!1),x(null)}})]})},sa=e=>{let{activeCommTab:t,activityFeedItems:r,projects:n,colorMode:s,expandedMessages:a,messagesProjectFilter:i,messagesUserFilter:l,handleToggleMessage:c,handleProjectSelectWithScroll:d,handleQuickReply:u}=e;const{actions:h}=Fn(),[m,p]=(0,o.useState)(new Set);if("messages"!==t)return null;return(0,kt.jsx)(kt.Fragment,{children:(()=>{const e=r.filter(e=>"message"===e.type).filter(e=>!i||String(e.projectId)===String(i)).filter(e=>{if(!l)return!0;const t=String(l),r=Array.isArray(e.recipients)&&(e.recipients.includes("all")||e.recipients.some(e=>String(e)===t)),n=e.authorId&&String(e.authorId)===t;return r||n});return 0===e.length?(0,kt.jsxs)("div",{className:"text-gray-400 text-center py-8 text-sm",children:[(0,kt.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,kt.jsx)("p",{className:"font-medium",children:"No messages found"}),(0,kt.jsx)("p",{className:"text-xs mt-1",children:"Messages you send or receive will appear here"})]}):e.map(e=>(0,kt.jsx)(Ms,{activity:(0,Y.A)((0,Y.A)({},e),{},{id:e.id,projectId:e.projectId,projectName:e.projectName,subject:e.subject,description:e.description||e.content,user:e.user,timestamp:e.timestamp,type:e.type,priority:e.priority,recipients:e.recipients}),onProjectSelect:d,projects:n,colorMode:s,useRealData:!0,onQuickReply:u,isExpanded:a.has(e.id),onToggleExpansion:c,sourceSection:"Messages, Tasks, & Reminders",onDelete:()=>(async e=>{if(null===e||void 0===e||!e.id)return;if(window.confirm("Delete this message? This action cannot be undone.")){p(t=>{const r=new Set(t);return r.add(e.id),r});try{const t=String(e.id||"").replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");await Ds.projectMessagesService.delete(t),h.removeItem(e.id),Vr.success("Message deleted successfully.")}catch(n){var t,r;console.error("Failed to delete message:",n);const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||(null===n||void 0===n?void 0:n.message)||"Failed to delete message.";Vr.error(e)}finally{p(t=>{const r=new Set(t);return r.delete(e.id),r})}}})(e),isDeleting:m.has(e.id)},e.id))})()})},aa=e=>{let{activeCommTab:t,activityFeedItems:r,projects:n,colorMode:s,tasksProjectFilter:a,tasksUserFilter:i,showCompletedTasks:l,setShowCompletedTasks:c,handleProjectSelectWithScroll:d,availableUsers:u=[],currentUser:h=null}=e;const{state:m,actions:p}=Fn(),[g,f]=(0,o.useState)(new Set);if("tasks"!==t)return null;return(0,kt.jsx)(kt.Fragment,{children:(()=>{const e=m.items.filter(e=>"task"===e.type).filter(e=>!a||String(e.projectId)===String(a)).filter(e=>{if(!i)return!0;const t=String(i),r=Array.isArray(e.attendees)&&e.attendees.some(e=>String(e)===t),n=e.authorId&&String(e.authorId)===t;return r||n}),t=e.filter(e=>{const t=m.completedItems.has(e.id);return l?t:!t}),r=e.filter(e=>m.completedItems.has(e.id)).length,o=e.length-r;return(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3 text-xs text-gray-600",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsxs)("span",{children:[o," active"]}),(0,kt.jsxs)("span",{children:[r," completed"]})]}),(0,kt.jsx)("button",{onClick:()=>c(!l),className:"text-blue-600 hover:text-blue-700 font-medium",children:l?"\u2190 Show Active Tasks":"Show Completed Tasks \u2192"})]}),0===t.length?(0,kt.jsxs)("div",{className:"text-center py-16",children:[(0,kt.jsx)("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-10 h-10 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:l?"No completed tasks":"No active tasks"}),(0,kt.jsx)("p",{className:"text-gray-500",children:l?"Completed tasks will appear here":"Tasks assigned to you will appear here"})]}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,kt.jsx)(Us,{item:e,projects:n||[],colorMode:s,onProjectSelect:d,availableUsers:u,currentUser:h,onDelete:()=>(async e=>{if(null===e||void 0===e||!e.id)return;if(window.confirm("Delete this task? This action cannot be undone.")){f(t=>{const r=new Set(t);return r.add(e.id),r});try{const t=String(e.id||"").replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");await Ds.tasksService.delete(t),p.removeItem(e.id),Vr.success("Task deleted successfully.")}catch(n){var t,r;console.error("Failed to delete task:",n);const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||(null===n||void 0===n?void 0:n.message)||"Failed to delete task.";Vr.error(e)}finally{f(t=>{const r=new Set(t);return r.delete(e.id),r})}}})(e),isDeleting:g.has(e.id)},e.id))})})]})})()})},oa=e=>{let{activeCommTab:t,activityFeedItems:r,projects:n,colorMode:s,remindersProjectFilter:a,remindersUserFilter:i,availableUsers:l,handleProjectSelectWithScroll:c,currentUser:d=null}=e;const{state:u,actions:h}=Fn(),[m,p]=(0,o.useState)(new Set);if("reminders"!==t)return null;return(0,kt.jsx)(kt.Fragment,{children:(()=>{const e=u.items.filter(e=>"reminder"===e.type).filter(e=>!a||String(e.projectId)===String(a)).filter(e=>{if(!i)return!0;const t=String(i),r=Array.isArray(e.recipients)&&(e.recipients.includes("all")||e.recipients.some(e=>String(e)===t)),n=e.authorId&&String(e.authorId)===t;return r||n}).filter(e=>!u.completedItems.has(e.id));return 0===e.length?(0,kt.jsxs)("div",{className:"text-center py-16",children:[(0,kt.jsx)("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-amber-100 to-amber-200 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-10 h-10 text-amber-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No reminders found"}),(0,kt.jsx)("p",{className:"text-gray-500",children:"Reminders you create or receive will appear here"})]}):(0,kt.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,kt.jsx)(Bs,{item:e,projects:n||[],colorMode:s,onProjectSelect:c,availableUsers:l,currentUser:d,onDelete:()=>(async e=>{if(null===e||void 0===e||!e.id)return;if(window.confirm("Delete this reminder? This action cannot be undone.")){p(t=>{const r=new Set(t);return r.add(e.id),r});try{const t=String(e.id||"").replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");await Ds.calendarService.delete(t),h.removeItem(e.id),Vr.success("Reminder deleted successfully.")}catch(n){var t,r;console.error("Failed to delete reminder:",n);const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||(null===n||void 0===n?void 0:n.message)||"Failed to delete reminder.";Vr.error(e)}finally{p(t=>{const r=new Set(t);return r.delete(e.id),r})}}})(e),isDeleting:m.has(e.id)},e.id))})})()})},ia=e=>{if(!e)return"N/A";const t={ROOF_REPLACEMENT:"Roof Replacement",KITCHEN_REMODEL:"Kitchen Remodel",BATHROOM_RENOVATION:"Bathroom Renovation",SIDING_INSTALLATION:"Siding Installation",WINDOW_REPLACEMENT:"Window Replacement",FLOORING:"Flooring",PAINTING:"Painting",ELECTRICAL_WORK:"Electrical Work",PLUMBING:"Plumbing",HVAC:"HVAC",DECK_CONSTRUCTION:"Deck Construction",LANDSCAPING:"Landscaping",OTHER:"Other",ROOFING:"Roofing",GUTTERS:"Gutters",INTERIOR_PAINT:"Interior Paint"};if(t[e])return t[e];const r=String(e).toLowerCase().replace(/_/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase());return r},la=e=>e?"bg-gray-50 text-gray-700 border-gray-300 shadow-sm":"bg-gray-50 text-gray-600 border-gray-200",ca=e=>e?"bg-gray-700/50 text-gray-200 border-gray-600 shadow-sm":"bg-gray-700 text-gray-300 border-gray-600",da=e=>{var t,r;let{projects:n=[],colorMode:s=!1,onProjectSelect:a,workflowAlerts:i=[],alertsLoading:l=!1,availableUsers:c=[],currentUser:d=null,handleProjectSelectWithScroll:u}=e;Array.isArray(i)&&i.length;const[h,m]=(0,o.useState)(new Set),[p,g]=(0,o.useState)(new Set),[f,x]=(0,o.useState)(new Set),[v,y]=(0,o.useState)("all"),[b,w]=(0,o.useState)("all"),[j,N]=(0,o.useState)({}),[S,k]=(0,o.useState)({}),[A,C]=(0,o.useState)(!1),[E,P]=(0,o.useState)(null),[I,T]=(0,o.useState)(""),[D,M]=(0,o.useState)(!1),[_,O]=(0,o.useState)({itemName:"",responsibleRole:"OFFICE",description:"",estimatedMinutes:30,alertDays:1,addToAllWorkflows:!1}),[L,R]=(0,o.useState)(null),[F,U]=(0,o.useState)(!1),B=(0,o.useRef)({}),W=(0,o.useRef)({}),z=e=>({PM:"PM",FIELD:"FIELD",OFFICE:"OFFICE",ADMIN:"ADMIN"}[e]||"OFFICE"),V=()=>(()=>{let e=[...i&&i.length>0?i:[]];return"all"!==v&&(e=e.filter(e=>{var t;if("general"===v)return!e.projectId&&!e.project;const r=(null===(t=e.project)||void 0===t?void 0:t._id)||e.projectId;return r===v||r===parseInt(v)})),"all"!==b&&(e=e.filter(e=>{var t,r;const n=(null===(t=e.metadata)||void 0===t?void 0:t.responsibleRole)||(null===(r=e.actionData)||void 0===r?void 0:r.responsibleRole)||"OFFICE";return z(String(n))===b})),e})();return(0,kt.jsxs)("div",{className:"w-full","data-section":"project-workflow-tasks",children:[(0,kt.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-soft rounded-2xl p-6 relative overflow-visible",children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-1",children:"Project Workflow Line Items"}),h.size>0&&(0,kt.jsxs)("p",{className:"text-sm text-gray-600 font-medium",children:[h.size," of ",V().length," alert",1!==V().length?"s":""," expanded"]})]})}),(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-3 mt-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Filter by:"}),(0,kt.jsxs)("select",{value:v,onChange:e=>y(e.target.value),className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white/80 text-gray-700 hover:border-gray-300 hover:bg-white transition-all duration-300 min-w-[120px]",children:[(0,kt.jsx)("option",{value:"all",children:"All Projects"}),(0,kt.jsx)("option",{value:"general",children:"General"}),(n||[]).map(e=>{var t;return(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.name]},e.id)})]}),(0,kt.jsxs)("select",{value:b,onChange:e=>w(e.target.value),className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white/80 text-gray-700 hover:border-gray-300 hover:bg-white transition-all duration-300 min-w-[100px]",children:[(0,kt.jsx)("option",{value:"all",children:"All Roles"}),(0,kt.jsx)("option",{value:"PM",children:"Project Manager"}),(0,kt.jsx)("option",{value:"FIELD",children:"Field Director"}),(0,kt.jsx)("option",{value:"OFFICE",children:"Office Staff"}),(0,kt.jsx)("option",{value:"ADMIN",children:"Administration"})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{console.log("\ud83d\udd04 Force refreshing alerts...")},className:"px-2 py-1 text-xs font-medium bg-blue-500 text-white rounded-md hover:bg-[var(--color-primary-blueprint-blue)] transition-colors",title:"Refresh alerts",children:"\ud83d\udd04"}),(0,kt.jsx)("button",{onClick:()=>{const e=new Set(V().map(e=>e._id||e.id));m(e)},className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat(h.size===V().length&&V().length>0?"bg-brand-500 text-white border-brand-500 shadow-brand-glow":"bg-white/80 text-brand-600 border-gray-200 hover:bg-white hover:border-brand-300 hover:shadow-soft"),title:"Expand all alert details",disabled:0===V().length||h.size===V().length,children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),(0,kt.jsx)("button",{onClick:()=>{m(new Set)},className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat(0===h.size||0===V().length?"bg-orange-500 text-white border-orange-500 shadow-accent-glow":"bg-white/80 text-orange-600 border-gray-200 hover:bg-white hover:border-orange-300 hover:shadow-soft"),title:"Collapse all alert details",disabled:0===V().length||0===h.size,children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})]})]}),(0,kt.jsx)("div",{className:"border-t mb-3 mt-0 ".concat(s?"border-gray-600":"border-gray-200")}),(0,kt.jsxs)("div",{className:"space-y-2 mt-3 max-h-[480px] overflow-y-auto pr-1 custom-scrollbar",children:[0===V().length&&(0,kt.jsx)("div",{className:"text-gray-400 text-center py-3 text-sm",children:l?"Loading alerts...":"No alerts found."}),V().length>0&&V().map(e=>{var t,r,o,i,l,c,v,y;const b=e._id||e.id,w=e.actionData||e.metadata||{},A=w.phase||"UNKNOWN",E=w.priority||"medium",I=w.projectId,T=null===n||void 0===n?void 0:n.find(e=>String(e.id)===String(I)||String(e._id)===String(I)),D=(w.stepName||e.title,h.has(b)),M=w.section||w.sectionName||"Unknown Section",_=(e=>{if(!e)return"Unknown Line Item";const t=[e.lineItem,e.stepName,e.stepLabel,e.title,e.message,e.name],r=e.actionData||e.metadata||{},n=[r.stepName,r.lineItemName,r.lineItem,r.currentLineItemName,r.stepLabel,r.lineItemLabel,r.name,r.label,r.title,r.cleanTaskName],s=e.metadata||{},a=[...t,...n,...[s.lineItem,s.cleanTaskName,s.stepName,s.lineItemName,s.name,s.label]];for(const o of a)if(null!==o&&void 0!==o)if("object"!==typeof o){if("string"===typeof o&&o.trim())return o.trim();if("number"===typeof o)return String(o)}else{if(o.name)return String(o.name);if(o.label)return String(o.label)}return e.stepId?String(e.stepId):e.lineItemId?String(e.lineItemId):"(unknown line item)"})(e),O=w.stepId||w.lineItemId||e.stepId||e.lineItemId||"alert-".concat(b);try{_&&"(unknown line item)"!==_||!window||!window.console||console.debug("\u26a0\ufe0f Workflow Alert missing lineItemName, actionData:",w,"alert:",e)}catch(Pr){}(e=>{var t;const r=e.responsibleRole||(null===(t=e.metadata)||void 0===t?void 0:t.responsibleRole)||"OFFICE";z(String(r))})(e);const L=e.projectType||(null===(t=e.relatedProject)||void 0===t?void 0:t.projectType)||w.projectType||(null===T||void 0===T?void 0:T.projectType),R=e=>Bn.getPhaseButtonProps(e||"LEAD");return(0,kt.jsxs)("div",{className:"".concat(s?"bg-[#1e293b] hover:bg-[#232b4d]":"bg-white hover:bg-[#F8F9FA]"," rounded-[12px] shadow-sm border transition-all duration-200 cursor-pointer"),children:[(0,kt.jsx)("div",{className:"flex flex-col gap-0 px-1.5 py-1 hover:bg-opacity-80 transition-colors cursor-pointer",onClick:()=>(e=>{const t=new Set(h);t.has(e)?t.delete(e):t.add(e),m(t)})(b),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,kt.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,kt.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center ".concat(R(A).textColor," font-bold text-[9px] shadow-sm"),style:{backgroundColor:"PROSPECT"===A?"#F97316":R(A).hexColor},children:R(A).initials}),"high"===E&&(0,kt.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-red-500 rounded-full border border-white shadow-sm"})]}),(0,kt.jsxs)("div",{className:"flex items-center text-[9px] flex-1",children:[(0,kt.jsx)("button",{className:"font-bold flex-shrink-0 hover:underline ".concat(s?"text-blue-300 hover:text-blue-200":"text-blue-700 hover:text-blue-900"),style:{width:"50px",textAlign:"left"},onClick:e=>{if(e.stopPropagation(),T&&a){const e=(0,Y.A)((0,Y.A)({},T),{},{scrollToProjectId:String(T.id),navigationSource:"Project Workflow Line Items",returnToSection:"project-workflow-tasks"});console.log("\ud83c\udfaf PROJECT NUMBER CLICK: Navigating from Project Workflow Line Items to Profile"),u(e,"Profile",null,"Project Workflow Line Items")}},title:"Go to project #".concat((null===T||void 0===T?void 0:T.projectNumber)||w.projectNumber||"N/A"),children:(null===T||void 0===T?void 0:T.projectNumber)||w.projectNumber||"12345"}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0 relative",style:{width:"100px",marginLeft:"0px"},children:[(0,kt.jsx)("button",{ref:e=>B.current[b]=e,className:"text-[9px] font-semibold cursor-pointer hover:underline ".concat(s?"text-gray-300 hover:text-gray-200":"text-gray-700 hover:text-gray-800"),title:(null===T||void 0===T||null===(r=T.customer)||void 0===r?void 0:r.name)||(null===T||void 0===T?void 0:T.clientName)||w.projectName||"Primary Customer",onClick:e=>{e.stopPropagation();const t=new Set(p);t.has(b)?t.delete(b):t.add(b),g(t)},children:(null===T||void 0===T||null===(o=T.customer)||void 0===o?void 0:o.name)||(null===T||void 0===T?void 0:T.clientName)||(null===T||void 0===T?void 0:T.name)||"Customer"}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation();const t=new Set(p);t.has(b)?t.delete(b):t.add(b),g(t)},className:"transform transition-transform duration-200 ".concat(p.has(b)?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),p.has(b)&&((null===T||void 0===T?void 0:T.customer)||(null===T||void 0===T?void 0:T.client))&&(0,kt.jsx)("div",{className:"absolute left-0 top-full mt-1 z-50 bg-white border border-gray-300 rounded-lg shadow-xl p-2.5 min-w-[180px] text-[10px] space-y-1",children:(()=>{const e=(null===T||void 0===T?void 0:T.customer)||(null===T||void 0===T?void 0:T.client);return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900 border-b border-gray-200 pb-1 mb-1",children:e.primaryName||e.name||(null===T||void 0===T?void 0:T.clientName)||"Customer"}),e.primaryPhone&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udcde"}),(0,kt.jsx)("span",{className:"text-gray-700",children:e.primaryPhone})]}),e.primaryEmail&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udce7"}),(0,kt.jsx)("span",{className:"text-gray-700 break-all",children:e.primaryEmail})]}),e.primaryAddress&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udccd"}),(0,kt.jsx)("span",{className:"text-gray-700",children:e.primaryAddress})]}),!e.primaryPhone&&!e.primaryEmail&&!e.primaryAddress&&(0,kt.jsx)("div",{className:"text-gray-500 italic text-[9px]",children:"No contact details"})]})})()})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",style:{marginLeft:"8px"},children:[(0,kt.jsx)("span",{className:"font-medium ".concat(s?"text-gray-400":"text-gray-500"),children:"PM:"}),(0,kt.jsx)("button",{ref:e=>W.current[b]=e,className:"text-[8px] font-semibold cursor-pointer hover:underline truncate max-w-[60px] ".concat(s?"text-gray-300 hover:text-gray-200":"text-gray-700 hover:text-gray-800"),title:(null===T||void 0===T||null===(i=T.projectManager)||void 0===i?void 0:i.name)||(null===T||void 0===T||null===(l=T.projectManager)||void 0===l?void 0:l.firstName)+" "+(null===T||void 0===T||null===(c=T.projectManager)||void 0===c?void 0:c.lastName)||"Mike Field",onClick:e=>{e.stopPropagation();const t=new Set(f);t.has(b)?t.delete(b):t.add(b),x(t)},children:(null===T||void 0===T||null===(v=T.projectManager)||void 0===v?void 0:v.firstName)||(null===T||void 0===T||null===(y=T.projectManager)||void 0===y?void 0:y.name)||"Mike"}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation();const t=new Set(f);t.has(b)?t.delete(b):t.add(b),x(t)},className:"transform transition-transform duration-200 ".concat(f.has(b)?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[L&&(0,kt.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] font-medium border max-w-[140px] whitespace-nowrap truncate ".concat(s?ca(L):la(L)),title:"Project Type: ".concat(ia(L)),children:ia(L)}),(0,kt.jsx)("div",{className:"transform transition-transform duration-200 ".concat(D?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),(0,kt.jsxs)("div",{className:"flex items-center text-[9px]",style:{marginTop:"-2px",marginLeft:"32px"},children:[(0,kt.jsxs)("div",{className:"flex items-center",style:{width:"150px"},children:[(0,kt.jsx)("span",{className:"font-medium ".concat(s?"text-gray-400":"text-gray-500"),style:{marginLeft:"4px"},children:"Section:"}),(0,kt.jsx)("span",{className:"font-semibold truncate ".concat(s?"text-white":"text-gray-800"),style:{marginLeft:"4px"},children:M||"Unknown Section"})]}),(0,kt.jsxs)("div",{className:"flex items-center flex-shrink-0 ml-2",children:[(0,kt.jsx)("span",{className:"font-medium ".concat(s?"text-gray-400":"text-gray-500"),style:{marginLeft:"8px"},children:"Line Item:"}),(0,kt.jsx)("span",{className:"font-semibold cursor-pointer hover:underline max-w-[120px] truncate ".concat(s?"text-white hover:text-gray-200":"text-gray-800 hover:text-gray-900"),style:{marginLeft:"4px"},id:"lineitem-".concat(O),"data-lineitem-id":O,"data-alert-id":b,title:_||"Unknown Line Item",onClick:async t=>{if(t.stopPropagation(),T&&a){console.log("\ud83c\udfaf ALERTS CLICK: Starting alert line item navigation");try{const t=await Ds.default.get("/workflow-data/project-position/".concat(T.id));if(t.data){const r=t.data;if(r.success&&r.data){const t=r.data,n=async()=>{try{const e=await fetch("/api/workflow-data/full-structure",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(e.ok){const r=await e.json();if(r.success&&r.data){const e=r.data.find(e=>e.id===t.currentPhase);if(e){const r=e.items.find(e=>e.id===t.currentSection);if(r){const e=r.subtasks.findIndex(e=>"object"===typeof e?e.id===t.currentLineItem||e.label===t.currentLineItemName:e===t.currentLineItemName);return e>=0?e:0}}}}}catch(e){console.warn("Could not determine subtask index:",e)}return 0},s=await n(),a=w.stepId||w.lineItemId||"".concat(t.currentPhase,"-").concat(t.currentSection,"-").concat(s),o=w.sectionId||t.currentSection,i=(0,Y.A)((0,Y.A)({},T),{},{highlightStep:_,highlightLineItem:_,targetPhase:A,targetSection:M,targetLineItem:_,scrollToCurrentLineItem:!0,alertPhase:A,navigationTarget:{nonce:Date.now(),phase:A,section:M,lineItem:_,stepName:_,alertId:b,lineItemId:w.stepId||w.lineItemId||e.stepId,workflowId:w.workflowId||e.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(a),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:o,expandPhase:!0,expandSection:!0,autoOpen:!0}});i.navigationSource="Project Workflow Tasks",i.returnToSection="project-workflow-tasks",i.highlightTarget={lineItemId:a,sectionId:o,phaseId:t.currentPhase,autoOpen:!0,scrollAndHighlight:!0},u(i,"Project Workflow",null,"Project Workflow Line Items",a,o)}}}catch(r){console.error("\ud83c\udfaf ALERTS CLICK: Error getting project position:",r)}}},children:_})]})]}),D&&(0,kt.jsxs)("div",{className:"px-2 py-2 border-t ".concat(s?"bg-[#232b4d] border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{const t=e._id||e.id;k(e=>(0,Y.A)((0,Y.A)({},e),{},{["".concat(t,"-complete")]:!0}));try{var r,n,s;const a=(null===(r=e.relatedProject)||void 0===r?void 0:r._id)||e.projectId||(null===(n=e.project)||void 0===n?void 0:n._id),o=e.lineItemId||(null===(s=e.metadata)||void 0===s?void 0:s.lineItemId)||e.stepId||e.id,i=await Ds.default.post("/workflows/complete-item",{projectId:a,lineItemId:o,notes:"Completed via dashboard alert by ".concat((null===d||void 0===d?void 0:d.firstName)||"User"," ").concat((null===d||void 0===d?void 0:d.lastName)||""),alertId:t});i.status>=200&&i.status<300&&console.log("\u2705 Alert completed successfully")}catch(a){console.error("\u274c Failed to complete alert:",a)}finally{k(e=>(0,Y.A)((0,Y.A)({},e),{},{["".concat(t,"-complete")]:!1}))}})(e)},disabled:S["".concat(b,"-complete")],className:"flex-1 px-2 py-1 text-[9px] font-semibold rounded border transition-all duration-200 ".concat(S["".concat(b,"-complete")]?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 text-white border-green-500 hover:from-green-600 hover:to-green-700 hover:border-green-600 shadow-sm hover:shadow-md"),children:S["".concat(b,"-complete")]?(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-1 h-3 w-3 text-green-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Completing..."]}):(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Complete"]})}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{P(e),C(!0)})(e)},disabled:S["".concat(b,"-assign")],className:"flex-1 px-2 py-1 text-[9px] font-semibold rounded border transition-all duration-200 ".concat(S["".concat(b,"-assign")]?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-blue-600 text-white border-brand-500 hover:from-blue-600 hover:to-blue-700 hover:border-blue-600 shadow-sm hover:shadow-md"),children:(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Assign to User"]})})]}),(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("label",{className:"block text-[9px] font-medium mb-1 ".concat(s?"text-gray-300":"text-gray-700"),children:"Add Note:"}),(0,kt.jsx)("textarea",{placeholder:"Enter a note for this alert...",rows:2,value:j[b]||"",className:"w-full p-2 text-[9px] border rounded resize-none transition-colors ".concat(s?"bg-[#1e293b] border-gray-600 text-white placeholder-gray-400 focus:border-brand-500 focus:ring-1 focus:ring-blue-500":"bg-white border-gray-300 text-gray-800 placeholder-gray-500 focus:border-brand-500 focus:ring-1 focus:ring-blue-500"),onChange:e=>{N(t=>(0,Y.A)((0,Y.A)({},t),{},{[b]:e.target.value}))}})]})]})]},b)})]})]}),A&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,kt.jsxs)("div",{className:"bg-white rounded-[20px] p-6 w-96 max-w-md ".concat(s?"bg-[#1e293b] border border-[#3b82f6]/30":"bg-white"),children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold mb-4 ".concat(s?"text-white":"text-gray-800"),children:"Assign Alert"}),E&&(0,kt.jsxs)("div",{className:"mb-4 p-3 rounded border ".concat(s?"bg-[#232b4d] border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsxs)("p",{className:"text-sm font-medium ".concat(s?"text-gray-200":"text-gray-700"),children:["Alert: ",E.title||"Unknown Alert"]}),(0,kt.jsxs)("p",{className:"text-xs mt-1 ".concat(s?"text-gray-400":"text-gray-500"),children:["Project: ",(null===(t=E.metadata)||void 0===t?void 0:t.projectName)||(null===(r=E.relatedProject)||void 0===r?void 0:r.projectName)||"Unknown Project"]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Assign to User:"}),(0,kt.jsxs)("select",{value:I,onChange:e=>T(e.target.value),className:"w-full p-3 border rounded-lg text-sm transition-colors ".concat(s?"bg-[#1e293b] border-gray-600 text-white focus:border-brand-500 focus:ring-1 focus:ring-blue-500":"bg-white border-gray-300 text-gray-800 focus:border-brand-500 focus:ring-1 focus:ring-blue-500"),children:[(0,kt.jsx)("option",{value:"",children:"Select a user..."}),c.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName||""," ",e.lastName?"":"(".concat(e.email,")")]},e.id))]})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{C(!1),P(null),T("")},className:"px-4 py-2 rounded text-sm font-medium transition-colors ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{const e=E._id||E.id;k(t=>(0,Y.A)((0,Y.A)({},t),{},{["".concat(e,"-assign")]:!0}));try{(await Ds.default.patch("/alerts/".concat(e,"/assign"),{assignedTo:I})).data.success&&(console.log("\u2705 Alert assigned successfully"),C(!1),P(null),T(""))}catch(t){console.error("\u274c Failed to assign alert:",t)}finally{k(t=>(0,Y.A)((0,Y.A)({},t),{},{["".concat(e,"-assign")]:!1}))}},disabled:!I||S["".concat((null===E||void 0===E?void 0:E.id)||(null===E||void 0===E?void 0:E._id),"-assign")],className:"px-4 py-2 rounded text-sm font-medium transition-colors ".concat(I&&!S["".concat((null===E||void 0===E?void 0:E.id)||(null===E||void 0===E?void 0:E._id),"-assign")]?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-400 text-white cursor-not-allowed"),children:S["".concat((null===E||void 0===E?void 0:E.id)||(null===E||void 0===E?void 0:E._id),"-assign")]?(0,kt.jsxs)("span",{className:"flex items-center",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Assigning..."]}):"Assign"})]})]})})]})},ua=e=>{let{activeCommTab:t,setActiveCommTab:r,expandedMessages:n,activityFeedItems:s}=e;return(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-1",children:"Messages, Tasks, & Reminders"}),n.size>0&&(0,kt.jsxs)("p",{className:"text-sm text-gray-600 font-medium",children:[n.size," of ","messages"===t?s.filter(e=>"message"===e.type).length:"tasks"===t?s.filter(e=>"task"===e.type).length:"reminders"===t?s.filter(e=>"reminder"===e.type).length:0," ",t,(()=>{const e="messages"===t?s.filter(e=>"message"===e.type).length:"tasks"===t?s.filter(e=>"task"===e.type).length:s.filter(e=>"reminder"===e.type).length;return 1!==e?"s":""})()," expanded"]})]})}),(0,kt.jsx)("div",{className:"relative mt-4 mb-6",children:(0,kt.jsxs)("div",{className:"flex bg-gray-100 rounded-xl p-1 shadow-inner",children:[(0,kt.jsx)("button",{onClick:()=>r("messages"),className:"flex-1 px-4 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 ".concat("messages"===t?"bg-white text-blue-600 shadow-md transform scale-[1.02]":"text-gray-600 hover:text-gray-800 hover:bg-gray-50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Messages"]})}),(0,kt.jsx)("button",{onClick:()=>r("tasks"),className:"flex-1 px-4 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 ".concat("tasks"===t?"bg-white text-blue-600 shadow-md transform scale-[1.02]":"text-gray-600 hover:text-gray-800 hover:bg-gray-50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),"Tasks"]})}),(0,kt.jsx)("button",{onClick:()=>r("reminders"),className:"flex-1 px-4 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 ".concat("reminders"===t?"bg-white text-blue-600 shadow-md transform scale-[1.02]":"text-gray-600 hover:text-gray-800 hover:bg-gray-50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Reminders"]})})]})})]})},ha=e=>{let{activeCommTab:t,projects:r,availableUsers:n,messagesProjectFilter:s,messagesUserFilter:a,tasksProjectFilter:o,tasksUserFilter:i,remindersProjectFilter:l,remindersUserFilter:c,setMessagesProjectFilter:d,setMessagesUserFilter:u,setTasksProjectFilter:h,setTasksUserFilter:m,setRemindersProjectFilter:p,setRemindersUserFilter:g,activityFeedItems:f,expandedMessages:x,handleExpandAllMessages:v,handleCollapseAllMessages:y}=e;return(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-3 mt-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Filter by:"}),(0,kt.jsxs)("select",{value:"messages"===t?s||"":"tasks"===t?o||"":l||"",onChange:e=>{"messages"===t?d(e.target.value):"tasks"===t?h(e.target.value):p(e.target.value)},className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white text-gray-900 hover:border-gray-300 transition-all duration-300 min-w-[120px]",style:{color:"#111827"},children:[(0,kt.jsx)("option",{value:"",style:{color:"#111827",backgroundColor:"#ffffff"},children:"All Projects"}),(r||[]).map(e=>{var t;return(0,kt.jsxs)("option",{value:e.id,style:{color:"#111827",backgroundColor:"#ffffff"},children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.name]},e.id)})]}),(0,kt.jsxs)("select",{value:"messages"===t?a||"":"tasks"===t?i||"":c||"",onChange:e=>{"messages"===t?u(e.target.value):"tasks"===t?m(e.target.value):g(e.target.value)},className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white text-gray-900 hover:border-gray-300 transition-all duration-300 min-w-[100px]",style:{color:"#111827"},children:[(0,kt.jsx)("option",{value:"",style:{color:"#111827",backgroundColor:"#ffffff"},children:"All Users"}),n.map(e=>(0,kt.jsxs)("option",{value:e.id,style:{color:"#111827",backgroundColor:"#ffffff"},children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:v,className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat((()=>{const e="messages"===t?f.filter(e=>"message"===e.type).length:"tasks"===t?f.filter(e=>"task"===e.type).length:f.filter(e=>"reminder"===e.type).length;return x.size===e&&e>0?"bg-brand-500 text-white border-brand-500 shadow-brand-glow":"bg-white/80 text-brand-600 border-gray-200 hover:bg-white hover:border-brand-300 hover:shadow-soft"})()),title:"Expand all alert details",disabled:(()=>{const e="messages"===t?f.filter(e=>"message"===e.type).length:"tasks"===t?f.filter(e=>"task"===e.type).length:f.filter(e=>"reminder"===e.type).length;return 0===e||x.size===e})(),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),(0,kt.jsx)("button",{onClick:y,className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat((()=>{"messages"===t?f.filter(e=>"message"===e.type).length:"tasks"===t?f.filter(e=>"task"===e.type).length:f.filter(e=>"reminder"===e.type).length;const e="messages"===t?f.filter(e=>"message"===e.type&&x.has(e.id)).length:"tasks"===t?f.filter(e=>"task"===e.type&&x.has(e.id)).length:f.filter(e=>"reminder"===e.type&&x.has(e.id)).length;return 0===e?"bg-orange-500 text-white border-orange-500 shadow-accent-glow":"bg-white/80 text-orange-600 border-gray-200 hover:bg-white hover:border-orange-300 hover:shadow-soft"})()),title:"Collapse all alert details",disabled:(()=>{"messages"===t?f.filter(e=>"message"===e.type).length:"tasks"===t?f.filter(e=>"task"===e.type).length:f.filter(e=>"reminder"===e.type).length;const e="messages"===t?f.filter(e=>"message"===e.type&&x.has(e.id)).length:"tasks"===t?f.filter(e=>"task"===e.type&&x.has(e.id)).length:f.filter(e=>"reminder"===e.type&&x.has(e.id)).length;return 0===e})(),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})]})},ma=["Send inspection_report_v2.pdf to the homeowner with a quick status update.","Create a task for Sarah to order shingles for project 10023 by Friday and attach the takeoff.","Set a reminder for the install crew tomorrow at 8am to upload day-one photos.","Ask Bubbles to summarize punchlist_notes.pdf and share the highlights with the production manager."];function pa(e){let{visible:t,onClose:r=()=>{},colorMode:n=!1}=e;if((0,o.useEffect)(()=>{if(!t)return;const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[t]),!t)return null;const s=(0,kt.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{background:"rgba(2,6,23,0.58)",zIndex:2147483647},role:"dialog","aria-modal":"true",onClick:e=>{e.target===e.currentTarget&&r()},children:(0,kt.jsxs)("div",{className:"max-w-4xl w-[96%] max-h-[84vh] overflow-hidden rounded-2xl shadow-2xl relative ".concat(n?"bg-slate-900 text-slate-100":"bg-white text-gray-900"),style:{zIndex:2147483648},children:[(0,kt.jsx)("button",{onClick:r,"aria-label":"Close quick start",className:"absolute top-3 right-3 z-20 w-8 h-8 flex items-center justify-center rounded-lg transition-all ".concat(n?"bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-slate-200":"bg-gray-100 text-gray-500 hover:bg-gray-200 hover:text-gray-700"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,kt.jsxs)("div",{className:"flex flex-col gap-3 p-6 pt-12 md:pt-6 pr-3 md:pr-14 overflow-y-auto max-h-[calc(84vh-2rem)]",children:[(0,kt.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3",children:[(0,kt.jsxs)("div",{className:"max-w-2xl",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold",children:"Bubbles Assistant Playbook"}),(0,kt.jsx)("p",{className:"mt-1 text-sm leading-relaxed ".concat(n?"text-slate-300":"text-gray-600"),children:"Speak naturally. Give Bubbles the goal, who should get it, and which documents to attach. These quick plays keep projects moving without leaving your desk or jobsite."})]}),(0,kt.jsx)("a",{href:"/bubbles-quickstart.html",target:"_blank",rel:"noreferrer",className:"flex-shrink-0 px-3 py-1.5 rounded-lg text-sm font-medium border ".concat(n?"border-slate-600 text-slate-100 hover:bg-slate-800/60":"border-gray-300 text-gray-700 hover:bg-gray-100"," transition"),children:"Printable guide"})]}),(0,kt.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"rounded-2xl border ".concat(n?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-gray-50"," p-4 shadow-sm"),children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500",children:"Prompts that work"}),(0,kt.jsx)("ul",{className:"mt-2 space-y-1.5 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:ma.map((e,t)=>(0,kt.jsxs)("li",{className:"flex gap-2",children:[(0,kt.jsx)("span",{className:"flex-shrink-0 mt-[3px] w-4 h-4 rounded-full text-[10px] font-semibold flex items-center justify-center ".concat(n?"bg-slate-800 text-blue-300":"bg-blue-50 text-blue-600"),children:t+1}),(0,kt.jsx)("span",{className:"leading-snug",children:e})]},t))})]}),(0,kt.jsxs)("div",{className:"rounded-2xl border ".concat(n?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-white"," p-4 shadow-sm"),children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-emerald-500",children:"Attachments made easy"}),(0,kt.jsxs)("ul",{className:"mt-2 space-y-1.5 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:[(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Browse documents:"}),' Click the "Documents" button in the header to see all available documents from Documents & Resources.']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Quick insert:"})," Click any document name in the browser to automatically insert it into your message."]}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Exact names win:"}),' "Attach measurement_notes.pdf."']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Not sure?"}),' Use the document browser or ask "What documents are on project 10045?" then tell Bubbles which one to send.']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Bundle files:"}),' "Send the permit.pdf ',(0,kt.jsx)("em",{children:"and"}),' latest_photos.zip to accounting."']})]})]})]}),(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"rounded-2xl border ".concat(n?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-white"," p-4 shadow-sm"),children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-orange-500",children:"Voice: natural names first"}),(0,kt.jsxs)("div",{className:"mt-2 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:[(0,kt.jsxs)("p",{className:"leading-snug",children:[(0,kt.jsx)("strong",{children:"Speak it normally:"}),' "Attach the roofing doc forty-eight thirty-eight F F one PDF." Bubbles handles underscores and dashes automatically.']}),(0,kt.jsxs)("p",{className:"leading-snug mt-2",children:[(0,kt.jsx)("strong",{children:"Add detail if needed:"}),' Mention the project, uploader, or "the warranty PDF from today" so it matches the right file.']}),(0,kt.jsxs)("p",{className:"leading-snug mt-2",children:[(0,kt.jsx)("strong",{children:"Fallback:"}),' Only spell it out ("roofing underscore doc\u2026") if Bubbles asks for clarification.']})]})]}),(0,kt.jsxs)("div",{className:"rounded-2xl border ".concat(n?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-white"," p-4 shadow-sm"),children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-purple-500",children:"Reliable workflow"}),(0,kt.jsxs)("ul",{className:"mt-2 space-y-1.5 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:[(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"1. State the job:"}),' "Send a status update to Maria about today\'s roof progress."']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"2. Add project & people:"})," Include project number or names so Bubbles routes it correctly."]}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"3. Approve the recap:"}),' Bubbles repeats the plan. Say "Looks good" or make tweaks.']})]})]})]})]})]})]})});return(0,c.createPortal)(s,document.body)}const ga=new class{async completeLineItem(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{console.log("\ud83d\udcdd Completing line item ".concat(t," for project ").concat(e));const s=await Ds.default.post("/workflows/complete-item",{projectId:e,lineItemId:t,notes:r,alertId:n});return console.log("\u2705 Line item completed successfully"),s.data}catch(s){throw console.error("\u274c Error completing line item:",s),s}}async getCurrentPosition(e){try{return(await Ds.default.get("/workflows/position/".concat(e))).data}catch(t){throw console.error("\u274c Error getting current position:",t),t}}async getWorkflowStatus(e){try{return(await Ds.default.get("/workflows/status/".concat(e))).data}catch(t){throw console.error("\u274c Error getting workflow status:",t),t}}async getWorkflowData(e){try{return(await Ds.default.get("/workflows/data/".concat(e))).data}catch(t){throw console.error("\u274c Error getting workflow data:",t),t}}async updateStep(e,t,r){try{console.log('\ud83d\udd0d WORKFLOW SERVICE: updateStep called with stepId: "'.concat(t,'" (length: ').concat(null===t||void 0===t?void 0:t.length,"), completed: ").concat(r));const n="string"===typeof t&&t.length>20&&!t.includes("DB_");if(console.log("\ud83d\udd0d WORKFLOW SERVICE: isDbId detection: ".concat(n)),r&&n)return console.log("\u2705 WORKFLOW SERVICE: Calling completeLineItem for UUID stepId: ".concat(t)),await this.completeLineItem(e,t,"Completed via checkbox",null);return(await Ds.default.put("/workflows/project/".concat(e,"/workflow/").concat(encodeURIComponent(t)),{completed:r})).data}catch(n){throw console.error("\u274c Error updating step:",n),n}}async getWorkflow(e){try{return(await Ds.default.get("/workflows/project/".concat(e))).data}catch(t){throw console.error("\u274c Error getting workflow:",t),t}}subscribeToWorkflowUpdates(e,t){return window.socket?(window.socket.emit("join","project_".concat(e)),window.socket.on("workflow_updated",r=>{r.projectId===e&&(console.log("\ud83d\udce1 Received workflow update:",r),t(r))}),window.socket.on("alerts_refresh",()=>{console.log("\ud83d\udce8 Alerts refresh requested"),window.refreshAlerts&&window.refreshAlerts()}),()=>{window.socket.off("workflow_updated"),window.socket.off("alerts_refresh")}):()=>{}}},fa=ga,xa={projects:["projects"],project:e=>["projects",e],projectStats:["projects","stats"],tasks:["tasks"],task:e=>["tasks",e],tasksByProject:e=>["tasks","project",e],tasksByUser:e=>["tasks","user",e],customers:["customers"],customer:e=>["customers",e],activities:["activities"],recentActivities:e=>["activities","recent",e],activitiesByProject:e=>["activities","project",e],notifications:["notifications"],unreadNotificationsCount:["notifications","unread-count"],documents:["documents"],documentsByProject:e=>["documents","project",e],calendarEvents:["calendar","events"],workflowAlerts:["workflow-alerts"],workflowAlertsByUser:e=>["workflow-alerts","user",e],workflowAlertsByProject:e=>["workflow-alerts","project",e],workflowAlertsSummary:["workflow-alerts","summary"],workflow:e=>["workflow","project",e],projectMessages:(e,t)=>["project-messages",e,t],projectMessageThread:e=>["project-messages","thread",e],feedback:["feedback"],feedbackByType:e=>["feedback","type",e],feedbackByUser:e=>["feedback","user",e],search:function(e){return["search",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"general",e]},currentUser:["auth","current-user"],teamMembers:["users","team-members"],rolesUsers:["roles","users"]},va=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Cs({queryKey:[...xa.projects,e],queryFn:()=>Ds.projectsService.getAll(e),select:e=>{if(e&&e.success&&e.data)return{data:e.data,total:e.total,page:e.page,limit:e.limit,totalPages:e.totalPages};const t=(null===e||void 0===e?void 0:e.data)||e||[];return{data:Array.isArray(t)?t:[],total:Array.isArray(t)?t.length:0,page:1,limit:Array.isArray(t)?t.length:0,totalPages:1}},staleTime:0,retry:!1,refetchOnWindowFocus:!0})},ya=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Cs({queryKey:[...xa.workflowAlerts,e],queryFn:()=>Ds.workflowAlertsService.getAll(e),select:e=>(null===e||void 0===e?void 0:e.data)||e||[],staleTime:0,cacheTime:0,retry:!1,refetchOnWindowFocus:!0})},ba=e=>{let{colorMode:t,timing:r,onTimingChange:n,showFollowUp:s=!1,followUpTiming:a,onFollowUpTimingChange:i,label:l="Timing"}=e;const[c,d]=(0,o.useState)(!1),u=(e,t)=>{const s=(0,Y.A)((0,Y.A)({},r),{},{[e]:parseInt(t)||0});n(s)},h=(e,t)=>{const r=(0,Y.A)((0,Y.A)({},a),{},{[e]:parseInt(t)||0});i(r)},m=e=>{const t=[];return e.days>0&&t.push("".concat(e.days," day").concat(1!==e.days?"s":"")),e.hours>0&&t.push("".concat(e.hours," hour").concat(1!==e.hours?"s":"")),e.minutes>0&&t.push("".concat(e.minutes," minute").concat(1!==e.minutes?"s":"")),t.length>0?t.join(", "):"No timing set"};return(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"border rounded p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold ".concat(t?"text-white":"text-gray-800"),children:l}),(0,kt.jsx)("button",{type:"button",onClick:()=>d(!c),className:"text-xs px-2 py-1 rounded transition-colors ".concat(t?"text-blue-400 hover:bg-blue-900":"text-blue-600 hover:bg-blue-50"),children:c?"Hide Details":"Show Details"})]}),c?(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:r.days,onChange:e=>u("days",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:r.hours,onChange:e=>u("hours",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:r.minutes,onChange:e=>u("minutes",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]}):(0,kt.jsx)("div",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:m(r)})]}),s&&(0,kt.jsxs)("div",{className:"border rounded p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold ".concat(t?"text-white":"text-gray-800"),children:"Follow-up Timing (Optional)"}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",checked:a.enabled,onChange:e=>i((0,Y.A)((0,Y.A)({},a),{},{enabled:e.target.checked})),className:"mr-2"}),(0,kt.jsx)("span",{className:"text-xs ".concat(t?"text-gray-300":"text-gray-600"),children:"Override default follow-up timing"})]})]}),a.enabled&&(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:a.days,onChange:e=>h("days",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:a.hours,onChange:e=>h("hours",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:a.minutes,onChange:e=>h("minutes",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]}),a.enabled&&(0,kt.jsx)("div",{className:"mt-2",children:(0,kt.jsxs)("div",{className:"text-xs ".concat(t?"text-gray-300":"text-gray-600"),children:["Follow-up will be sent: ",m(a)," after creation"]})})]})]})},wa=e=>{let{activeCommTab:t,colorMode:n,showMessageDropdown:s,setShowMessageDropdown:a,projects:i,availableUsers:l,usersLoading:c=!1,subjects:d,currentUser:u,newMessageProject:h,setNewMessageProject:m,newMessageSubject:p,setNewMessageSubject:g,newMessageCustomSubject:f,setNewMessageCustomSubject:x,newMessageText:v,setNewMessageText:y,newMessageRecipients:b,setNewMessageRecipients:w,quickTaskSubject:j,setQuickTaskSubject:N,quickTaskDescription:S,setQuickTaskDescription:k,quickTaskDue:A,setQuickTaskDue:C,quickTaskAssignAll:E,setQuickTaskAssignAll:P,quickTaskAssigneeId:I,setQuickTaskAssigneeId:T,tasksProjectFilter:D,setTasksProjectFilter:M,reminderTitle:_,setReminderTitle:O,reminderDescription:L,setReminderDescription:R,reminderWhen:F,setReminderWhen:U,reminderAllUsers:B,setReminderAllUsers:W,reminderUserIds:z,setReminderUserIds:V,remindersProjectFilter:H,setRemindersProjectFilter:q,setMessagesData:K,setFeed:G,uiProjects:J,taskTiming:Y,setTaskTiming:Q,taskFollowUpTiming:X,setTaskFollowUpTiming:$,reminderTiming:Z,setReminderTiming:ee,reminderFollowUpTiming:te,setReminderFollowUpTiming:re}=e;const ne=Ct(),se=Array.isArray(l)?l:[],[ae,oe]=(0,o.useState)(!1),[ie,le]=(0,o.useState)(!1);return(0,kt.jsxs)("div",{className:"mb-3",children:[(0,kt.jsxs)("button",{onClick:()=>a(!s),className:"w-full px-2 py-1.5 text-xs font-medium border rounded-lg transition-all duration-300 flex items-center justify-between ".concat(s?"border-brand-400 bg-brand-50 text-brand-700 shadow-soft":"border-gray-200 bg-white/80 text-gray-700 hover:bg-white hover:border-brand-400 hover:text-brand-600"),children:[(0,kt.jsx)("span",{children:"messages"===t?"+ Add Message":"tasks"===t?"+ Add Task":"+ Add Reminder"}),(0,kt.jsx)("svg",{className:"w-3 h-3 transition-transform ".concat(s?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&"messages"===t&&(0,kt.jsx)("div",{className:"p-2 border-t ".concat(n?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=p;if(h&&t&&v.trim()&&b.length>0){var n,s;const e=i.find(e=>e.id===parseInt(h)),o=async()=>{try{let n=Array.isArray(b)?[...b]:[];if(n.includes("all"))try{const e=await Promise.resolve().then(r.bind(r,505)).then(e=>e.rolesService.getUsers());n=e&&e.success&&Array.isArray(e.data)?e.data.map(e=>String(e.id)):Array.isArray(se)&&se.length>0?se.map(e=>String(e.id)):[]}catch(e){n=Array.isArray(se)?se.map(e=>String(e.id)):[]}const s=await Ds.projectMessagesService.create(h,{content:v,subject:t,priority:"MEDIUM",recipients:n});s.success?(console.log("Message saved to database:",s.data),ne.invalidateQueries({queryKey:["project-messages"]})):console.error("Failed to save message to database:",s.message)}catch(n){console.error("Error saving message:",n)}};o();const l={id:"msg_".concat(Date.now()),projectId:parseInt(h),projectName:(null===e||void 0===e?void 0:e.projectName)||(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e||null===(n=e.customer)||void 0===n?void 0:n.primaryName)||(null===e||void 0===e||null===(s=e.client)||void 0===s?void 0:s.name)||(null===e||void 0===e?void 0:e.address)||"Unknown Project",projectNumber:(null===e||void 0===e?void 0:e.projectNumber)||Math.floor(9e4*Math.random())+1e4,subject:t,description:v,user:"You",timestamp:(new Date).toISOString(),type:"message",priority:"medium",recipients:b};K(e=>[l,...e]),G(e=>[l,...e]),a(!1),m(""),g(""),x(""),y(""),w([])}},className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Project ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{value:h,onChange:e=>m(e.target.value),required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Select Project"}),(i||[]).map(e=>{var t,r;return(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",e.projectName||e.name||(null===(t=e.customer)||void 0===t?void 0:t.primaryName)||(null===(r=e.client)||void 0===r?void 0:r.name)||e.address]},e.id)})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["To ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("div",{className:"flex justify-end -mt-3 mb-1",children:(0,kt.jsx)("button",{title:"Quick phrases",onClick:()=>oe(!0),className:"text-xs px-2 py-1 rounded bg-gray-100",children:"Quick Phrases"})}),h&&(()=>{const e=i.find(e=>e.id===parseInt(h)),t=(null===e||void 0===e?void 0:e.customer)||(null===e||void 0===e?void 0:e.client);return t?(0,kt.jsxs)("div",{className:"mb-2 relative",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsxs)("span",{className:"text-xs font-semibold ".concat(n?"text-gray-300":"text-gray-700"),children:["\ud83d\udccb ",t.primaryName||t.name||"Customer"]}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),le(!ie)},className:"transform transition-transform duration-200 ".concat(ie?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),ie&&(0,kt.jsxs)("div",{className:"absolute left-0 top-full mt-1 z-50 bg-white border border-gray-300 rounded-lg shadow-xl p-2.5 min-w-[180px] text-[10px] space-y-1",children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900 border-b border-gray-200 pb-1 mb-1",children:t.primaryName||t.name||"Customer"}),t.primaryPhone&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udcde"}),(0,kt.jsx)("span",{className:"text-gray-700",children:t.primaryPhone})]}),t.primaryEmail&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udce7"}),(0,kt.jsx)("span",{className:"text-gray-700 break-all",children:t.primaryEmail})]}),t.primaryAddress&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udccd"}),(0,kt.jsx)("span",{className:"text-gray-700",children:t.primaryAddress})]}),!t.primaryPhone&&!t.primaryEmail&&!t.primaryAddress&&(0,kt.jsx)("div",{className:"text-gray-500 italic text-[9px]",children:"No contact details"})]})]}):null})(),(0,kt.jsxs)("select",{value:Array.isArray(b)?b:[],onChange:e=>{const t=Array.from(e.target.selectedOptions,e=>e.value);w(t)},multiple:!0,required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),style:{minHeight:"40px"},children:[(0,kt.jsx)("option",{value:"all",style:{fontWeight:"bold"},children:"All Users"}),c?(0,kt.jsx)("option",{value:"",disabled:!0,children:"Loading users..."}):0===se.length?(0,kt.jsx)("option",{value:"",disabled:!0,children:"No users found"}):se.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName||""," ",e.lastName?"":"(".concat(e.email||"",")")]},e.id))]}),(0,kt.jsx)("p",{className:"text-[10px] mt-1 ".concat(n?"text-gray-400":"text-gray-500"),children:"Hold Ctrl/Cmd to select multiple recipients"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Subject ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"text",placeholder:"Enter subject line...",value:p,onChange:e=>g(e.target.value),required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Message ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("textarea",{value:v,onChange:e=>y(e.target.value),placeholder:"Enter your message here...",required:!0,rows:2,className:"w-full px-2 py-1 border rounded text-xs resize-none ".concat(n?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1.5 pt-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{a(!1),m(""),g(""),x(""),y(""),w([])},className:"px-3 py-1.5 text-xs font-medium rounded border transition-colors ".concat(n?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!h||!("CUSTOM_SUBJECT"===p?f:p)||!v.trim()||0===b.length,className:"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(h&&("CUSTOM_SUBJECT"===p?f:p)&&v.trim()&&b.length>0?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Send Message"})]})]})}),(0,kt.jsx)(pa,{visible:ae,onClose:()=>oe(!1),colorMode:n}),s&&"tasks"===t&&(0,kt.jsx)("div",{className:"p-2 border-t ".concat(n?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("form",{onSubmit:async e=>{var t;if(e.preventDefault(),!j.trim()||!A)return void Vr.error("Subject and due date are required");const r=(null===u||void 0===u||null===(t=u.user)||void 0===t?void 0:t.id)||(null===u||void 0===u?void 0:u.id);if(r)try{var n,s,a;const e=new Date(A),t=24*Y.days*60*60*1e3+60*Y.hours*60*1e3+60*Y.minutes*1e3,o=t>0?t:6e4,c=new Date(e.getTime()+o),d={title:j.trim(),description:S||"",startTime:A,endTime:c.toISOString().slice(0,16),eventType:"DEADLINE",organizerId:r,projectId:D||void 0,attendees:E?l.map(e=>({userId:e.id})):I?[{userId:I}]:[],timing:Y,followUpTiming:X.enabled?X:null};console.log("Creating task with payload:",d);const h=await Ds.calendarService.create(d),m=(null===h||void 0===h||null===(n=h.data)||void 0===n||null===(s=n.event)||void 0===s?void 0:s.id)||(null===h||void 0===h||null===(a=h.data)||void 0===a?void 0:a.id);ne.invalidateQueries({queryKey:xa.calendarEvents}),console.log("\ud83d\udd0d Task creation debug:",{quickTaskAssignAll:E,quickTaskAssigneeId:I,availableUsersCount:l.length});let p="Unassigned";if(E)p="All Users";else if(I&&I.trim()){console.log("\ud83d\udd0d Looking for user with ID:",I),console.log("\ud83d\udd0d Available users:",l.map(e=>({id:e.id,name:e.name||"".concat(e.firstName," ").concat(e.lastName)})));const e=l.find(e=>String(e.id)===String(I));console.log("\ud83d\udd0d Found user:",e),p=e?e.name&&e.name.trim()?e.name:e.firstName&&e.firstName.trim()&&e.lastName&&e.lastName.trim()?"".concat(e.firstName," ").concat(e.lastName):e.firstName&&e.firstName.trim()?e.firstName:e.email&&e.email.trim()?e.email:"Unassigned":"Unassigned"}console.log("\ud83d\udd0d Final assignedToDisplay:",p);const g=E?l.map(e=>e.id):I?[I]:[];G(e=>[{id:m||"cal_".concat(Date.now()),type:"task",authorId:r,author:null!==u&&void 0!==u&&u.user?"".concat(u.user.firstName," ").concat(u.user.lastName):u?"".concat(u.firstName," ").concat(u.lastName):"You",assignedTo:p,assigneeId:I||null,assignedToAll:E||!1,attendees:g,projectId:D||null,projectName:(i.find(e=>String(e.id)===String(D))||{}).projectName||null,subject:j.trim(),content:S||"",timestamp:A},...e]),Vr.success("Task created successfully"),N(""),k(""),C(""),P(!1),T(""),M("")}catch(o){console.error("Failed to create task:",o),Vr.error("Failed to create task")}else Vr.error("User not found. Please refresh and try again.")},className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Project"}),(0,kt.jsxs)("select",{value:D||"",onChange:e=>M(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"General (No Project)"}),(J||[]).map(e=>{var t;return(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.name]},e.id)})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Subject ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{value:j,onChange:e=>N(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),placeholder:"Task subject"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Task Due Date ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"datetime-local",value:A,onChange:e=>C(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Assign To"}),(0,kt.jsxs)("select",{value:I,onChange:e=>{T(e.target.value),P(!1)},className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Unassigned"}),c?(0,kt.jsx)("option",{value:"",disabled:!0,children:"Loading users..."}):0===se.length?(0,kt.jsx)("option",{value:"",disabled:!0,children:"No users found"}):se.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName||""," ",e.lastName?"":"(".concat(e.email||"",")")]},e.id))]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Description"}),(0,kt.jsx)("textarea",{value:S,onChange:e=>k(e.target.value),rows:2,className:"w-full px-2 py-1 border rounded text-xs resize-none ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]}),(0,kt.jsx)(ba,{colorMode:n,timing:Y,onTimingChange:Q,showFollowUp:!0,followUpTiming:X,onFollowUpTimingChange:$,label:"Start Task"}),(0,kt.jsx)("div",{className:"flex items-center",children:(0,kt.jsxs)("label",{className:"text-xs font-medium ".concat(n?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("input",{type:"checkbox",className:"mr-1",checked:E,onChange:e=>{P(e.target.checked),e.target.checked&&T("")}})," Send to all users"]})}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1.5 pt-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{a(!1),N(""),k(""),C(""),P(!1),T(""),M("")},className:"px-3 py-1.5 text-xs font-medium rounded border transition-colors ".concat(n?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!j.trim()||!A,className:"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(j.trim()&&A?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Create Task"})]})]})}),s&&"reminders"===t&&(0,kt.jsx)("div",{className:"p-2 border-t ".concat(n?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("form",{onSubmit:async e=>{var t;if(e.preventDefault(),!_.trim()||!F)return void Vr.error("Title and date/time are required");const r=(null===u||void 0===u||null===(t=u.user)||void 0===t?void 0:t.id)||(null===u||void 0===u?void 0:u.id);if(r)try{var n,s,a;const e=new Date(F),t=24*Z.days*60*60*1e3+60*Z.hours*60*1e3+60*Z.minutes*1e3,o=t>0?t:6e4,c=new Date(e.getTime()+o),d={title:_.trim(),description:L||"",startTime:F,endTime:c.toISOString().slice(0,16),eventType:"REMINDER",organizerId:r,projectId:H||void 0,attendees:B?l.map(e=>({userId:e.id})):z.length?z.map(e=>({userId:e})):[],timing:Z,followUpTiming:te.enabled?te:null};console.log("Creating reminder with payload:",d);const h=await Ds.calendarService.create(d),m=(null===h||void 0===h||null===(n=h.data)||void 0===n||null===(s=n.event)||void 0===s?void 0:s.id)||(null===h||void 0===h||null===(a=h.data)||void 0===a?void 0:a.id);ne.invalidateQueries({queryKey:xa.calendarEvents});const p=B?l.map(e=>e.id):z.length?z:[];G(e=>[{id:m||"cal_".concat(Date.now()),type:"reminder",authorId:r,author:null!==u&&void 0!==u&&u.user?"".concat(u.user.firstName," ").concat(u.user.lastName):u?"".concat(u.firstName," ").concat(u.lastName):"You",recipients:p,projectId:H||null,projectName:(i.find(e=>String(e.id)===String(H))||{}).projectName||null,subject:_.trim(),content:L||"",timestamp:F},...e]),Vr.success("Reminder created successfully"),O(""),R(""),U(""),W(!1),V([])}catch(o){console.error("Failed to create reminder:",o),Vr.error("Failed to create reminder")}else Vr.error("User not found. Please refresh and try again.")},className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Title ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{value:_,onChange:e=>O(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),placeholder:"Reminder title"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["When ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"datetime-local",value:F,onChange:e=>U(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Description"}),(0,kt.jsx)("textarea",{value:L,onChange:e=>R(e.target.value),rows:2,className:"w-full px-2 py-1 border rounded text-xs resize-none ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]}),(0,kt.jsx)(ba,{colorMode:n,timing:Z,onTimingChange:ee,showFollowUp:!0,followUpTiming:te,onFollowUpTimingChange:re,label:"Start Reminder"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Recipients"}),(0,kt.jsx)("select",{multiple:!0,value:z,onChange:e=>V(Array.from(e.target.selectedOptions,e=>e.value)),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"),style:{minHeight:"40px",color:n?"#ffffff":"#111827"},children:c?(0,kt.jsx)("option",{value:"",disabled:!0,style:{color:"#111827",backgroundColor:"#ffffff"},children:"Loading users..."}):0===se.length?(0,kt.jsx)("option",{value:"",disabled:!0,style:{color:"#111827",backgroundColor:"#ffffff"},children:"No users found"}):se.map(e=>(0,kt.jsxs)("option",{value:e.id,style:{color:"#111827",backgroundColor:"#ffffff"},children:[e.firstName," ",e.lastName||""," ",e.lastName?"":"(".concat(e.email||"",")")]},e.id))}),(0,kt.jsx)("p",{className:"text-[10px] mt-1 ".concat(n?"text-gray-400":"text-gray-500"),children:"Hold Ctrl/Cmd to select multiple recipients"})]}),(0,kt.jsx)("div",{className:"flex items-end",children:(0,kt.jsxs)("label",{className:"text-xs font-medium ".concat(n?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("input",{type:"checkbox",className:"mr-1",checked:B,onChange:e=>{W(e.target.checked),e.target.checked&&V([])}})," Send to all users"]})})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1.5 pt-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{a(!1),O(""),R(""),U(""),W(!1),V([])},className:"px-3 py-1.5 text-xs font-medium rounded border transition-colors ".concat(n?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!_.trim()||!F,className:"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(_.trim()&&F?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Create Reminder"})]})]})})]})},ja=e=>{let{open:t,onClose:r,project:n,colorMode:s,getProjectProgress:a,expandedTrades:i,toggleTrades:l,expandedAdditionalTrades:c,toggleAdditionalTrades:d}=e;const u=(0,o.useRef)(null),h=a(n);return(0,kt.jsxs)("div",{ref:u,className:"fixed z-50 top-0 right-0 h-full w-96 ".concat(s?"bg-slate-800 text-white":"bg-white text-gray-900"," shadow-2xl border-l ").concat(s?"border-slate-600":"border-gray-200"," transform transition-transform duration-300 ease-out"),style:{transform:t?"translateX(0)":"translateX(100%)"},"data-section":"project-progress-panel",children:[(0,kt.jsx)("div",{className:"px-6 py-4 border-b ".concat(s?"border-slate-600":"border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold",children:"Project Progress"}),(0,kt.jsxs)("p",{className:"text-sm ".concat(s?"text-gray-300":"text-gray-600"," mt-1"),children:[null===n||void 0===n?void 0:n.name," (",(0,kt.jsxs)("span",{className:"".concat(s?"text-blue-300":"text-blue-600"),children:["#",String((null===n||void 0===n?void 0:n.projectNumber)||"").padStart(5,"0")]}),")"]})]}),(0,kt.jsx)("button",{onClick:r,className:"p-2 rounded-lg hover:bg-opacity-10 transition-colors ".concat(s?"hover:bg-white/10":"hover:bg-gray-100"),"aria-label":"Close Progress Panel",children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,kt.jsxs)("div",{className:"p-6 space-y-6 overflow-y-auto h-full",children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Overall Progress"}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:"Complete project status"})]}),(0,kt.jsxs)("div",{className:"text-right",children:[(0,kt.jsxs)("span",{className:"text-2xl font-bold ".concat(100===h?"text-green-600":"text-blue-600"),children:[Math.round(h||0),"%"]}),(0,kt.jsx)("div",{className:"text-xs ".concat(100===h?"text-green-500":"text-blue-500"),children:100===h?"Complete":"In Progress"})]})]}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("div",{className:"w-full h-3 rounded-full overflow-hidden shadow-inner ".concat(s?"bg-slate-700":"bg-gray-200"),children:(0,kt.jsx)("div",{className:"h-full rounded-full transition-all duration-700 ease-out ".concat(100===h?"bg-gradient-to-r from-green-500 to-emerald-600":"bg-gradient-to-r from-blue-500 to-indigo-600"),style:{width:"".concat(Math.min(h||0,100),"%")},children:h>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})}),h>0&&(0,kt.jsx)("div",{className:"absolute top-1/2 transform -translate-y-1/2 w-3 h-3 rounded-full border-2 shadow-lg transition-all duration-700 ".concat(100===h?"bg-green-500 border-green-300":"bg-blue-500 border-blue-300"),style:{left:"calc(".concat(Math.min(h||0,100),"% - 6px)")}})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Phase Breakdown"}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:"Materials and labor progress"})]}),(0,kt.jsxs)("button",{onClick:()=>l(n.id),className:"flex items-center gap-1 text-xs font-medium hover:opacity-80 transition-opacity px-2 py-1 rounded ".concat(s?"text-gray-300 hover:bg-slate-700":"text-gray-600 hover:bg-gray-100"),children:[(0,kt.jsxs)("span",{children:[i.has(n.id)?"Hide":"Show"," Details"]}),(0,kt.jsx)("svg",{className:"w-3 h-3 transition-transform duration-200 ".concat(i.has(n.id)?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(0,kt.jsxs)("div",{className:"group",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:"Materials"})]}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:[a(n),"%"]})]}),(0,kt.jsx)("div",{className:"".concat(s?"bg-slate-700":"bg-gray-200"," w-full h-2 rounded-full overflow-hidden shadow-inner"),children:(0,kt.jsx)("div",{className:"h-full rounded-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all duration-500 ease-out",style:{width:"".concat(a(n),"%")},children:a(n)>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})})]}),(0,kt.jsxs)("div",{className:"group",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Labor"})]}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-orange-600 dark:text-orange-400",children:[a(n),"%"]})]}),(0,kt.jsx)("div",{className:"".concat(s?"bg-slate-700":"bg-gray-200"," w-full h-2 rounded-full overflow-hidden shadow-inner"),children:(0,kt.jsx)("div",{className:"h-full rounded-full bg-gradient-to-r from-orange-500 to-amber-500 transition-all duration-500 ease-out",style:{width:"".concat(a(n),"%")},children:a(n)>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})})]})]}),i.has(n.id)&&(0,kt.jsxs)("div",{className:"space-y-3 pt-2 border-t border-gray-200/50",children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,kt.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Trade Progress"}),(0,kt.jsxs)("button",{onClick:()=>d(n.id),className:"flex items-center gap-1 text-xs font-medium hover:opacity-80 transition-opacity ".concat(s?"text-gray-300":"text-gray-600"),children:[(0,kt.jsx)("span",{children:c.has(n.id)?"Less":"More"}),(0,kt.jsx)("svg",{className:"w-3 h-3 transition-transform ".concat(c.has(n.id)?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(0,kt.jsx)("div",{className:"space-y-2",children:[{name:"Roofing",progress:a(n)},{name:"Siding",progress:a(n)},...c.has(n.id)?[{name:"Windows",progress:a(n)},{name:"Gutters",progress:a(n)}]:[]].map(e=>(0,kt.jsxs)("div",{className:"group",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,kt.jsx)("span",{className:"text-xs font-medium group-hover:text-blue-500 transition-colors",children:e.name}),(0,kt.jsxs)("span",{className:"text-xs font-bold text-gray-600 dark:text-gray-300",children:[e.progress,"%"]})]}),(0,kt.jsx)("div",{className:"".concat(s?"bg-slate-600":"bg-gray-200"," w-full h-1.5 bg-gray-200 rounded-full overflow-hidden"),children:(0,kt.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-500 ".concat("Roofing"===e.name?"bg-purple-500":"Siding"===e.name?"bg-pink-500":"Windows"===e.name?"bg-yellow-500":"Gutters"===e.name?"bg-red-500":"bg-blue-500"),style:{width:"".concat(e.progress,"%")}})})]},e.name))})]})]})]})};class Na{static getProjectWorkflowState(e){if(!e)return this.getDefaultState();const t="".concat(e.id,"_").concat(e.updatedAt||Date.now());if(this.cache.has(t))return this.cache.get(t);const r=this.calculateWorkflowState(e);return this.cache.set(t,r),r}static calculateWorkflowState(e){const t=e.currentWorkflowItem;let r="LEAD",n="Lead";t?(r=t.phase||"LEAD",n=t.phaseDisplay||this.formatPhaseDisplay(r)):e.phase&&(r=this.normalizePhaseKey(e.phase),n=this.formatPhaseDisplay(r));const s=Bn.calculateProjectProgress(e),a=this.getCurrentSection(e),o=this.getCurrentLineItem(e),i=this.getPhaseConfig(r);return{projectId:e.id,currentPhase:r,currentPhaseDisplay:this.formatPhaseDisplay(r),currentSection:a,currentSectionDisplay:this.formatSectionDisplay(a),currentLineItem:o,currentLineItemDisplay:this.formatLineItemDisplay(o),overallProgress:s.overall||0,phaseProgress:s.phaseBreakdown||{},hasPhaseOverride:s.hasPhaseOverride||!1,skippedPhases:s.skippedPhases||[],nextSteps:[],phaseConfig:i,phaseColor:i.color,phaseInitial:i.initial,phaseName:i.name,workflow:e.workflow,lastUpdated:(new Date).toISOString(),cacheKey:"".concat(e.id,"_").concat(e.updatedAt||Date.now())}}static getCurrentSection(e){return e&&e.currentWorkflowItem&&e.currentWorkflowItem.section||null}static getCurrentLineItem(e){return e&&e.currentWorkflowItem?{id:e.currentWorkflowItem.lineItemId,name:e.currentWorkflowItem.lineItem,section:e.currentWorkflowItem.section,phase:e.currentWorkflowItem.phase}:null}static getPhaseConfig(e){const t=Bn.getPhaseColor(e);return{id:e,name:Bn.getPhaseName(e),color:t.hex,bgClass:t.bg,textClass:t.text,initial:this.getPhaseInitial(e)}}static normalizePhaseKey(e){if(!e)return"LEAD";return{LEAD:"LEAD",PROSPECT:"PROSPECT",APPROVED:"APPROVED",EXECUTION:"EXECUTION",EXECUTE:"EXECUTION",SECOND_SUPP:"SECOND_SUPP","2ND_SUPP":"SECOND_SUPP",SUPPLEMENT:"SECOND_SUPP",COMPLETION:"COMPLETION",COMPLETE:"COMPLETION"}[e.toUpperCase().replace(/\s*PHASE$/i,"").replace("PHASE-","").replace("PHASE","").replace(/-INSURANCE-1ST SUPPLEMENT/i,"").replace("2ND SUPPLEMENT","SECOND_SUPP").replace("2ND SUPP","SECOND_SUPP").replace("EXECUTE","EXECUTION").trim()]||"LEAD"}static getPhaseInitial(e){return{LEAD:"L",PROSPECT:"P",APPROVED:"A",EXECUTION:"E",SECOND_SUPP:"S","2ND_SUPP":"S",COMPLETION:"C"}[e]||"L"}static formatPhaseDisplay(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"Lead"}static formatSectionDisplay(e){return e?e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Not Started"}static formatLineItemDisplay(e){return e?e.name||e.stepName||"Unknown Task":"No active task"}static getDefaultState(){return{projectId:null,currentPhase:"LEAD",currentPhaseDisplay:"Lead",currentSection:null,currentSectionDisplay:"Not Started",currentLineItem:null,currentLineItemDisplay:"No active task",overallProgress:0,phaseProgress:{},nextSteps:[],phaseConfig:this.getPhaseConfig("LEAD"),phaseColor:"#94A3B8",phaseInitial:"L",phaseName:"Lead",workflow:null,lastUpdated:(new Date).toISOString(),cacheKey:"default"}}static updateWorkflowState(e,t){const r=[];for(const s of this.cache.keys())s.startsWith("".concat(e,"_"))&&r.push(s);r.forEach(e=>this.cache.delete(e));const n=this.getProjectWorkflowState(t);return this.notifyListeners(e,n),n}static addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}static notifyListeners(e,t){this.listeners.forEach(r=>{try{r(e,t)}catch(n){console.error("Error notifying workflow listener:",n)}})}static clearCache(){this.cache.clear()}}Na.cache=new Map,Na.listeners=new Set;const Sa=Na,ka=["title","titleId"];function Aa(e,t){let{title:r,titleId:n}=e,s=Sn(e,ka);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const Ca=o.forwardRef(Aa),Ea=["title","titleId"];function Pa(e,t){let{title:r,titleId:n}=e,s=Sn(e,Ea);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const Ia=o.forwardRef(Pa),Ta=e=>{let{projects:t=[],PROJECT_PHASES:r=[],colorMode:n=!1,onProjectSelect:s,selectedPhase:a,setSelectedPhase:i,sortConfig:l,handleProjectSort:c,projectsLoading:d=!1,projectsError:u=null,refetchProjects:h,expandedPhases:m=new Set,teamMembers:p=[]}=e;Array.isArray(p)&&p.reduce((e,t)=>{try{if(null==t)return e;const r=null!=t.id?String(t.id):null;r&&(e[r]=t),t.email&&(e[String(t.email).toLowerCase()]=t),t.username&&(e[String(t.username).toLowerCase()]=t)}catch(Pr){}return e},{});const[g,f]=(0,o.useState)(new Set),x=e=>Bn.getProjectPhase(e),v=e=>{var t;return(null===(t=Bn.calculateProjectProgress(e))||void 0===t?void 0:t.overall)||0},y=a?"all"===a?t:t.filter(e=>String(x(e)).toUpperCase()===String(a).toUpperCase()):[];return(0,kt.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-soft rounded-2xl p-4","data-section":"project-phases",children:[(0,kt.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,kt.jsx)("div",{children:(0,kt.jsx)("h2",{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-1",children:"Current Projects by Phase"})})}),(0,kt.jsx)("div",{className:"mb-3",children:(0,kt.jsxs)("div",{className:"w-full flex items-center gap-3",children:[(0,kt.jsxs)("button",{onClick:()=>i("all"===a?null:"all"),className:"h-12 px-4 text-sm font-semibold rounded-xl transition-all duration-300 border-2 flex items-center justify-center gap-2 hover:shadow-medium flex-shrink-0 ".concat("all"===a?"border-blue-600 bg-blue-50 shadow-medium text-blue-800":"border-gray-200 bg-white/80 text-gray-700 hover:bg-white hover:border-gray-300 hover:shadow-soft"),style:{minWidth:72},children:[(0,kt.jsx)("div",{className:"h-5 w-5 bg-blue-600 flex-shrink-0 shadow-sm flex items-center justify-center text-white text-sm font-bold transform rotate-45",children:(0,kt.jsx)("span",{className:"transform -rotate-45",children:Array.isArray(t)?t.length:0})}),(0,kt.jsx)("span",{className:"text-xs font-semibold",children:"All"})]}),(0,kt.jsx)("div",{className:"flex-1 grid grid-cols-6 gap-3",children:r.map(e=>{const r=Array.isArray(t)?t.filter(t=>String(x(t)).toUpperCase()===String(e.id).toUpperCase()).length:0;return(0,kt.jsxs)("button",{onClick:()=>i(a===e.id?null:e.id),className:"min-h-14 py-2 px-4 text-base font-semibold rounded-2xl transition-all duration-300 border-2 flex items-center justify-center gap-3 hover:shadow-medium ".concat(a===e.id?"border-blue-500 bg-blue-50 shadow-medium text-blue-900":"border-gray-200 bg-white/90 text-gray-800 hover:bg-white hover:border-gray-300 hover:shadow-soft"),children:[(0,kt.jsx)("div",{className:"h-8 w-8 flex-shrink-0 shadow-sm flex items-center justify-center text-sm font-bold transform rotate-45 ".concat((e=>{switch(e){case"LEAD":case"APPROVED":default:return"text-black";case"PROSPECT":case"EXECUTION":case"SECOND_SUPPLEMENT":case"COMPLETION":return"text-white"}})(e.id)),style:{backgroundColor:e.color},title:"".concat(e.name," projects"),children:(0,kt.jsx)("span",{className:"transform -rotate-45",children:r})}),(0,kt.jsx)("span",{className:"text-base font-semibold leading-tight text-center whitespace-normal break-words",children:e.name})]},e.id)})})]})}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"w-full text-sm min-w-full",children:[0===y.length?null:(0,kt.jsx)("thead",{children:(0,kt.jsxs)("tr",{className:"border-b ".concat(n?"border-gray-600":"border-gray-200"),children:[(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:"Phase"}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:(0,kt.jsxs)("button",{onClick:()=>c&&c("projectNumber"),className:"flex items-center gap-1 hover:underline ".concat(n?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800"),children:["Project #","projectNumber"===(null===l||void 0===l?void 0:l.key)&&(0,kt.jsx)("span",{className:"text-xs",children:"asc"===l.direction?"\u2191":"\u2193"})]})}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:(0,kt.jsxs)("button",{onClick:()=>c&&c("primaryContact"),className:"flex items-center gap-1 hover:underline ".concat(n?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800"),children:["Primary Contact","primaryContact"===(null===l||void 0===l?void 0:l.key)&&(0,kt.jsx)("span",{className:"text-xs",children:"asc"===l.direction?"\u2191":"\u2193"})]})}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:(0,kt.jsxs)("button",{onClick:()=>c&&c("projectType"),className:"flex items-center gap-1 hover:underline ".concat(n?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800"),children:["Project Type","projectType"===(null===l||void 0===l?void 0:l.key)&&(0,kt.jsx)("span",{className:"text-xs",children:"asc"===l.direction?"\u2191":"\u2193"})]})}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:(0,kt.jsxs)("button",{onClick:()=>c&&c("progress"),className:"flex items-center gap-1 hover:underline ".concat(n?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800"),children:["Progress","progress"===(null===l||void 0===l?void 0:l.key)&&(0,kt.jsx)("span",{className:"text-xs",children:"asc"===l.direction?"\u2191":"\u2193"})]})}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:"Messages"}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:"Workflow"})]})}),(0,kt.jsx)("tbody",{children:(()=>{if(d)return(0,kt.jsx)("tr",{children:(0,kt.jsx)("td",{colSpan:"7",className:"text-center py-8",children:(0,kt.jsx)("div",{className:"text-brand-600",children:"Loading projects..."})})});if(u&&(!t||0===t.length))return(0,kt.jsx)("tr",{children:(0,kt.jsxs)("td",{colSpan:"7",className:"text-center py-8",children:[(0,kt.jsxs)("div",{className:"text-red-600 mb-4",children:[(0,kt.jsx)("div",{className:"font-semibold",children:"Error loading projects:"}),(0,kt.jsx)("div",{className:"text-sm",children:String((null===u||void 0===u?void 0:u.message)||u||"Unknown error")}),(0,kt.jsx)("div",{className:"text-xs mt-2 text-gray-500",children:"This often happens after navigating back from Project Workflow. Try refreshing the data."})]}),(0,kt.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,kt.jsx)("button",{onClick:async()=>{try{await(null===h||void 0===h?void 0:h())}catch(Pr){}},className:"px-4 py-2 bg-brand-500 text-white rounded hover:bg-[var(--color-primary-blueprint-blue)] transition-colors",disabled:d,children:d?"Retrying...":"Retry"}),(0,kt.jsx)("button",{onClick:()=>{window.location.reload()},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Refresh Page"})]})]})});if(!t||0===t.length)return(0,kt.jsx)("tr",{children:(0,kt.jsx)("td",{colSpan:"7",className:"text-center py-8",children:(0,kt.jsx)("div",{className:"text-gray-600",children:"No projects found"})})});const e=(()=>{let e=y;if(null===l||void 0===l||!l.key)return e;const t="asc"===l.direction?1:-1;return[...e].sort((e,r)=>{var n,s,a,o;let i,c;switch(l.key){case"projectNumber":i=e.projectNumber||e.id,c=r.projectNumber||r.id;break;case"primaryContact":i=(null===(n=e.client)||void 0===n?void 0:n.name)||e.clientName||(null===(s=e.customer)||void 0===s?void 0:s.primaryName)||"",c=(null===(a=r.client)||void 0===a?void 0:a.name)||r.clientName||(null===(o=r.customer)||void 0===o?void 0:o.primaryName)||"";break;case"projectManager":i="object"===typeof e.projectManager&&null!==e.projectManager?e.projectManager.name||"".concat(e.projectManager.firstName||""," ").concat(e.projectManager.lastName||"").trim()||"":e.projectManager||"",c="object"===typeof r.projectManager&&null!==r.projectManager?r.projectManager.name||"".concat(r.projectManager.firstName||""," ").concat(r.projectManager.lastName||"").trim()||"":r.projectManager||"";break;case"projectType":i=e.projectType||"N/A",c=r.projectType||"N/A";break;case"phase":i=x(e)||"",c=x(r)||"";break;case"progress":i=v(e)||0,c=v(r)||0;break;default:i="",c=""}return"string"===typeof i&&(i=i.toLowerCase(),c=c.toLowerCase()),i<c?-1*t:i>c?1*t:0})})();if(!a)return null;if(0===y.length&&a&&!d){var i;const e="all"===a?"All Projects":(null===(i=r.find(e=>e.id===a))||void 0===i?void 0:i.name)||a;return(0,kt.jsx)("tr",{children:(0,kt.jsx)("td",{colSpan:"8",className:"text-center py-12",children:(0,kt.jsxs)("div",{className:"".concat(n?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)("div",{className:"text-4xl mb-3",children:"\ud83d\udccb"}),(0,kt.jsxs)("div",{className:"font-medium text-sm mb-1",children:["No projects in ",e]}),(0,kt.jsx)("div",{className:"text-xs",children:"Projects will appear here when they are in this phase"})]})})})}return e.map(e=>{var t,a,i,l,c,d;const u=x(e),h=r.find(e=>e.id===u)||r[0],p=(e.projectManager||e.pm||e.projectManagerId||e.projectManagerName||e.pmName,(null===(t=e.client)||void 0===t?void 0:t.name)||e.clientName||(null===(a=e.customer)||void 0===a?void 0:a.primaryName)||""),y=e.projectType||"N/A";return(0,kt.jsxs)(o.Fragment,{children:[(0,kt.jsxs)("tr",{"data-project-id":e.id,className:"border-b ".concat(n?"border-gray-600":"border-gray-200"," hover:bg-gray-50 transition-colors duration-300"),children:[(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",style:{backgroundColor:null===h||void 0===h?void 0:h.color,color:Bn.getContrastTextColor((null===h||void 0===h?void 0:h.color)||"#000")},title:"Phase: ".concat(null===h||void 0===h?void 0:h.name),children:null===h||void 0===h?void 0:h.initial})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("button",{onClick:()=>{const t=(0,Y.A)((0,Y.A)({},e),{},{dashboardState:{selectedPhase:null===h||void 0===h?void 0:h.id,expandedPhases:Array.from(m||[]),scrollToProject:e,projectSourceSection:"Project Phases"}});s&&s(t,"Profile",null,"Project Phases")},className:"text-sm font-bold hover:underline cursor-pointer transition-colors text-blue-600 hover:text-blue-800",children:String(e.projectNumber||e.id).padStart(5,"0")})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap max-w-32",children:e.customer||e.client?(0,kt.jsxs)("details",{className:"inline-block",children:[(0,kt.jsxs)("summary",{className:"cursor-pointer text-sm font-semibold text-gray-700 flex items-center gap-1 hover:text-gray-900",children:[(0,kt.jsx)("span",{className:"truncate",children:p}),(0,kt.jsx)("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),(0,kt.jsx)("div",{className:"mt-1 border rounded ".concat(n?"border-gray-600 bg-[#232b4d]":"border-gray-300 bg-white"," p-2 text-xs space-y-1 shadow-lg min-w-[200px]"),children:(()=>{const t=e.customer||e.client;return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"font-semibold border-b pb-1 mb-1 ".concat(n?"text-gray-200 border-gray-600":"text-gray-900 border-gray-200"),children:t.primaryName||t.name||p}),t.primaryPhone&&(0,kt.jsxs)("div",{className:n?"text-gray-300":"text-gray-700",children:[(0,kt.jsx)("strong",{children:"\ud83d\udcde Phone:"})," ",t.primaryPhone]}),t.primaryEmail&&(0,kt.jsxs)("div",{className:n?"text-gray-300":"text-gray-700",children:[(0,kt.jsx)("strong",{children:"\ud83d\udce7 Email:"})," ",t.primaryEmail]}),t.primaryAddress&&(0,kt.jsxs)("div",{className:n?"text-gray-300":"text-gray-700",children:[(0,kt.jsx)("strong",{children:"\ud83d\udccd Address:"})," ",t.primaryAddress]}),!t.primaryPhone&&!t.primaryEmail&&!t.primaryAddress&&(0,kt.jsx)("div",{className:"text-gray-500 italic",children:"No contact details available"})]})})()})]}):(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-700 truncate",children:p})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-md text-[10px] font-medium border ".concat(n?ca(y):la(y)),children:ia(y)})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2 min-w-[160px]",children:[(0,kt.jsx)("button",{onClick:()=>(e=>{const t=new Set(g);t.has(e)?t.delete(e):t.add(e),f(t)})(e.id),className:"p-1.5 hover:bg-blue-50 rounded-lg transition-all",title:"View phase breakdown",children:g.has(e.id)?(0,kt.jsx)(Ca,{className:"h-4 w-4 text-blue-600"}):(0,kt.jsx)(Ia,{className:"h-4 w-4 text-gray-500"})}),(0,kt.jsx)("div",{className:"flex-1",children:(0,kt.jsx)("div",{className:"flex items-center gap-2",children:(0,kt.jsxs)("div",{className:"flex-1 h-8 bg-gradient-to-r from-gray-100 to-gray-200 rounded-lg overflow-hidden relative border border-gray-300 shadow-sm",children:[(0,kt.jsx)("div",{className:"h-full transition-all duration-700 ease-out relative",style:{width:"".concat(v(e),"%"),background:"linear-gradient(90deg, \n                                      #3b82f6 0%, \n                                      #2563eb ".concat(Math.min(.5*v(e),50),"%, \n                                      #1d4ed8 100%)")},children:(0,kt.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/10 to-transparent"})}),(0,kt.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,kt.jsxs)("span",{className:"text-xs font-bold text-gray-800 drop-shadow-sm px-2",children:[v(e),"%"]})})]})})})]})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("button",{onClick:()=>{const t=(0,Y.A)((0,Y.A)({},e),{},{dashboardState:{selectedPhase:null===h||void 0===h?void 0:h.id,expandedPhases:Array.from(m||[]),scrollToProject:e,projectSourceSection:"Project Phases"}});s&&s(t,"Messages",null,"Project Phases")},className:"inline-flex items-center justify-center w-16 h-6 border border-brand-500 text-black rounded-md hover:bg-brand-50 transition-colors text-[10px] font-semibold",children:"Messages"})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("button",{onClick:async()=>{if(s)try{const t=await Ds.default.get("/workflow-data/project-position/".concat(e.id));if(t.data){const r=t.data;if(r.success&&r.data){const t=r.data,n=async()=>{try{const e=await fetch("/api/workflow-data/full-structure",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(e.ok){const r=await e.json();if(r.success&&r.data){const e=r.data.find(e=>e.id===t.currentPhase);if(e){const r=e.items.find(e=>e.id===t.currentSection);if(r){const e=r.subtasks.findIndex(e=>"object"===typeof e?e.id===t.currentLineItem||e.label===t.currentLineItemName:e===t.currentLineItemName);return e>=0?e:0}}}}}catch(Pr){}return 0},a=await n(),o=t.currentLineItem||"".concat(t.currentPhase,"-").concat(t.currentSection,"-").concat(a),i=t.currentSection,l=(0,Y.A)((0,Y.A)({},e),{},{dashboardState:{selectedPhase:null===h||void 0===h?void 0:h.id,expandedPhases:Array.from(m||[]),scrollToProject:e}});s(l,"Project Workflow",null,"Project Phases",o,i)}else s(e,"Project Workflow",null,"Project Phases")}else s(e,"Project Workflow",null,"Project Phases")}catch(Pr){s(e,"Project Workflow",null,"Project Phases")}},className:"inline-flex items-center justify-center w-16 h-6 border border-brand-500 text-black rounded-md hover:bg-brand-50 transition-colors text-[10px] font-semibold",children:"Workflow"})})]}),g.has(e.id)&&(0,kt.jsx)("tr",{className:"bg-blue-50/50",children:(0,kt.jsx)("td",{colSpan:"8",className:"py-4 px-6",children:(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),"Current Workflow Status"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[(0,kt.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Current Section"}),(0,kt.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:(null===(i=e.currentWorkflowItem)||void 0===i?void 0:i.section)||"Not Started"})]}),(0,kt.jsxs)("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[(0,kt.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Active Task"}),(0,kt.jsx)("div",{className:"text-sm font-semibold text-gray-900 truncate",children:(null===(l=e.currentWorkflowItem)||void 0===l?void 0:l.lineItem)||"No active task"})]}),(0,kt.jsxs)("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[(0,kt.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Completed Tasks"}),(0,kt.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:[(null===(c=e.currentWorkflowItem)||void 0===c||null===(d=c.completedItems)||void 0===d?void 0:d.length)||0," tasks"]})]})]})]}),e.additionalTrades&&e.additionalTrades.length>0&&(0,kt.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,kt.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-purple-600 rounded-full"}),"Additional Trades (",e.additionalTrades.length,")"]}),(0,kt.jsx)("div",{className:"grid grid-cols-2 gap-3",children:e.additionalTrades.map((e,t)=>{var r;return(0,kt.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg border border-gray-200",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:(0,kt.jsx)("span",{className:"text-xs font-bold text-purple-700",children:(null===(r=e.name)||void 0===r?void 0:r.charAt(0))||"?"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("p",{className:"text-xs font-semibold text-gray-900 truncate",children:e.name||"Unknown Trade"}),e.status&&(0,kt.jsx)("p",{className:"text-[10px] text-gray-500",children:e.status})]}),void 0!==e.progress&&(0,kt.jsx)("div",{className:"flex-shrink-0 w-12 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full bg-purple-600 transition-all",style:{width:"".concat(e.progress||0,"%")}})})]},t)})})]})]})})})]},e.id)})})()})]})})})]})},Da=[{id:1,projectName:"Johnson Residence Roof Replacement",projectNumber:"PRJ-001",startDate:"2025-09-15",endDate:"2025-10-30",status:"active",budget:12500,expenses:8750,responsibleTeam:"Team Alpha",priority:"High",clientName:"Robert Johnson",clientEmail:"robert.johnson@email.com",projectManager:"Sarah Owner",phase:"execution"},{id:2,projectName:"Smith Commercial Roof Repair",projectNumber:"PRJ-002",startDate:"2025-09-01",endDate:"2025-11-15",status:"active",budget:35e3,expenses:15200,responsibleTeam:"Team Beta",priority:"Medium",clientName:"Smith Corporation",clientEmail:"contact@smithcorp.com",projectManager:"Mike Foreman",phase:"prospect"},{id:3,projectName:"Williams Garage Roof Installation",projectNumber:"PRJ-003",startDate:"2025-08-20",endDate:"2025-09-25",status:"completed",budget:8500,expenses:7200,responsibleTeam:"Team Gamma",priority:"Low",clientName:"Jennifer Williams",clientEmail:"jenn.williams@email.com",projectManager:"Sarah Owner",phase:"completion"},{id:4,projectName:"Davis Apartment Complex Roofing",projectNumber:"PRJ-004",startDate:"2025-10-05",endDate:"2025-12-20",status:"planning",budget:45e3,expenses:0,responsibleTeam:"Team Delta",priority:"High",clientName:"Davis Properties LLC",clientEmail:"info@davisproperties.com",projectManager:"Tom Supervisor",phase:"lead"},{id:5,projectName:"Miller Office Building Roof Maintenance",projectNumber:"PRJ-005",startDate:"2025-09-10",endDate:"2025-10-10",status:"active",budget:18500,expenses:9800,responsibleTeam:"Team Epsilon",priority:"Medium",clientName:"Miller & Associates",clientEmail:"miller@business.com",projectManager:"Lisa Manager",phase:"approved"}],Ma=[{id:"message_1",projectId:1,projectName:"Johnson Residence Roof Replacement",type:"project_update",subject:"Material Delivery Update",description:"Shingles delivered and ready for installation tomorrow",user:"Mike Foreman",timestamp:"2025-09-24T10:30:00Z",priority:"medium"},{id:"message_2",projectId:2,projectName:"Smith Commercial Roof Repair",type:"customer_communication",subject:"Client Meeting Notes",description:"Discussed additional waterproofing requirements for the east wing",user:"Sarah Owner",timestamp:"2025-09-23T14:15:00Z",priority:"high"},{id:"message_3",projectId:1,projectName:"Johnson Residence Roof Replacement",type:"schedule_change",subject:"Schedule Adjustment",description:"Installation delayed by one day due to weather forecast",user:"Tom Supervisor",timestamp:"2025-09-23T09:45:00Z",priority:"medium"},{id:"message_4",projectId:3,projectName:"Williams Garage Roof Installation",type:"project_update",subject:"Project Completion",description:"Final inspection passed. Project officially completed",user:"Lisa Manager",timestamp:"2025-09-22T16:20:00Z",priority:"low"},{id:"message_5",projectId:4,projectName:"Davis Apartment Complex Roofing",type:"documentation",subject:"Permit Status",description:"Building permits approved and on file",user:"Robert Johnson",timestamp:"2025-09-22T11:30:00Z",priority:"high"},{id:"message_6",projectId:5,projectName:"Miller Office Building Roof Maintenance",type:"quality_check",subject:"Safety Inspection Results",description:"All safety protocols met. Work can proceed as scheduled",user:"Mike Foreman",timestamp:"2025-09-21T13:45:00Z",priority:"medium"},{id:"message_7",projectId:2,projectName:"Smith Commercial Roof Repair",type:"budget_discussion",subject:"Budget Approval",description:"Client approved additional materials budget",user:"Sarah Owner",timestamp:"2025-09-21T10:15:00Z",priority:"high"},{id:"message_8",projectId:1,projectName:"Johnson Residence Roof Replacement",type:"crew_assignment",subject:"Crew Schedule Update",description:"Added two additional roofers to the team for faster completion",user:"Tom Supervisor",timestamp:"2025-09-20T08:30:00Z",priority:"medium"},{id:"message_9",projectId:2,projectName:"Smith Commercial Roof Repair",type:"site_inspection",subject:"Site Inspection Scheduled",description:"City inspector scheduled for Friday 10:00 AM",user:"Mike Foreman",timestamp:"2025-09-20T15:00:00Z",priority:"medium"},{id:"message_10",projectId:4,projectName:"Davis Apartment Complex Roofing",type:"material_delivery",subject:"Materials Delayed",description:"Supplier reported a 24-hour delay due to logistics",user:"Lisa Manager",timestamp:"2025-09-19T09:20:00Z",priority:"high"}],_a=[{id:"task_1",projectId:1,projectName:"Johnson Residence Roof Replacement",title:"Order additional flashing materials",description:"Need to order extra flashing for the chimney installation",assignedTo:"Mike Foreman",dueDate:"2025-09-26",priority:"high",status:"pending"},{id:"task_2",projectId:2,projectName:"Smith Commercial Roof Repair",title:"Schedule client meeting",description:"Meet with client to discuss waterproofing options",assignedTo:"Sarah Owner",dueDate:"2025-09-28",priority:"medium",status:"in-progress"},{id:"task_3",projectId:1,projectName:"Johnson Residence Roof Replacement",title:"Complete roof deck inspection",description:"Inspect roof deck for any damage before shingle installation",assignedTo:"Tom Supervisor",dueDate:"2025-09-25",priority:"high",status:"pending"},{id:"task_4",projectId:4,projectName:"Davis Apartment Complex Roofing",title:"Submit building permits",description:"File all necessary permits with the city building department",assignedTo:"Lisa Manager",dueDate:"2025-09-30",priority:"medium",status:"pending"},{id:"task_5",projectId:5,projectName:"Miller Office Building Roof Maintenance",title:"Perform quarterly maintenance check",description:"Check all roof sections for wear and tear, document findings",assignedTo:"Mike Foreman",dueDate:"2025-10-05",priority:"low",status:"pending"},{id:"task_6",projectId:3,projectName:"Williams Garage Roof Installation",title:"Final documentation",description:"Complete all project documentation and file reports",assignedTo:"Sarah Owner",dueDate:"2025-09-27",priority:"medium",status:"completed"},{id:"task_7",projectId:2,projectName:"Smith Commercial Roof Repair",title:"Order premium waterproofing materials",description:"Purchase specified premium materials for east wing repair",assignedTo:"Tom Supervisor",dueDate:"2025-09-29",priority:"high",status:"in-progress"},{id:"task_8",projectId:5,projectName:"Miller Office Building Roof Maintenance",title:"Coordinate with facility manager",description:"Schedule access to roof areas with building facility manager",assignedTo:"Lisa Manager",dueDate:"2025-10-02",priority:"medium",status:"pending"},{id:"task_9",projectId:1,projectName:"Johnson Residence Roof Replacement",title:"Safety equipment check",description:"Verify all safety equipment is functional before work begins",assignedTo:"Mike Foreman",dueDate:"2025-09-24",priority:"high",status:"overdue"},{id:"task_10",projectId:4,projectName:"Davis Apartment Complex Roofing",title:"Review contract terms",description:"Ensure all contract terms are understood before signing",assignedTo:"Sarah Owner",dueDate:"2025-09-27",priority:"medium",status:"pending"}],Oa=[{id:"reminder_1",projectId:1,projectName:"Johnson Residence Roof Replacement",title:"Weekly Progress Meeting",description:"Team meeting to discuss progress and upcoming tasks",when:"2025-09-25T09:00:00Z",createdBy:"Sarah Owner",priority:"medium"},{id:"reminder_2",projectId:2,projectName:"Smith Commercial Roof Repair",title:"Client Follow-up Call",description:"Call client to confirm waterproofing material selection",when:"2025-09-26T14:00:00Z",createdBy:"Mike Foreman",priority:"high"},{id:"reminder_3",projectId:3,projectName:"Williams Garage Roof Installation",title:"Final Payment Due",description:"Send final invoice and collect payment from client",when:"2025-09-30T10:00:00Z",createdBy:"Tom Supervisor",priority:"medium"},{id:"reminder_4",projectId:4,projectName:"Davis Apartment Complex Roofing",title:"Permit Application Deadline",description:"Submit permit application before deadline to avoid delays",when:"2025-09-28T16:00:00Z",createdBy:"Lisa Manager",priority:"high"},{id:"reminder_5",projectId:5,projectName:"Miller Office Building Roof Maintenance",title:"Equipment Maintenance",description:"Schedule maintenance for roofing equipment and tools",when:"2025-10-01T08:00:00Z",createdBy:"Robert Johnson",priority:"low"},{id:"reminder_6",projectId:1,projectName:"Johnson Residence Roof Replacement",title:"Material Delivery Confirmation",description:"Confirm delivery of additional materials with supplier",when:"2025-09-27T11:00:00Z",createdBy:"Sarah Owner",priority:"medium"},{id:"reminder_7",projectId:2,projectName:"Smith Commercial Roof Repair",title:"Safety Inspection",description:"Conduct mandatory safety inspection of work site",when:"2025-09-29T07:30:00Z",createdBy:"Mike Foreman",priority:"high"},{id:"reminder_8",projectId:4,projectName:"Davis Apartment Complex Roofing",title:"Contract Review Meeting",description:"Review contract terms with legal team before signing",when:"2025-09-26T15:00:00Z",createdBy:"Tom Supervisor",priority:"medium"}],La=["className","width","height"],Ra=["className","width","height"],Fa=e=>{let{className:t="",width:r,height:n}=e,s=Sn(e,La);return(0,kt.jsx)("div",(0,Y.A)({className:"animate-pulse bg-gray-200 rounded ".concat(t),style:{width:r,height:n}},s))},Ua=e=>{let{className:t="",width:r,height:n}=e,s=Sn(e,Ra);return(0,kt.jsx)("div",(0,Y.A)({className:"animate-pulse bg-slate-700 rounded ".concat(t),style:{width:r,height:n}},s))},Ba=e=>{let{colorMode:t=!1}=e;const r=t?Ua:Fa;return(0,kt.jsxs)("div",{className:"".concat(t?"bg-slate-800 border-slate-600":"bg-white border-gray-200"," border rounded-lg shadow-sm p-4 space-y-4"),children:[(0,kt.jsx)("div",{className:"flex items-center justify-between",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)(r,{className:"w-6 h-6 rounded-full"}),(0,kt.jsx)(r,{className:"h-5 w-20"}),(0,kt.jsx)(r,{className:"h-4 w-16"}),(0,kt.jsx)(r,{className:"h-4 w-12"})]})}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)(r,{className:"h-4 w-32"}),(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)(r,{className:"h-3 w-24"}),(0,kt.jsx)(r,{className:"h-3 w-32"})]}),(0,kt.jsx)(r,{className:"h-3 w-48"})]}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)(r,{className:"h-3 w-16"}),(0,kt.jsx)(r,{className:"h-3 w-8"})]}),(0,kt.jsx)(r,{className:"h-3 w-full"})]}),(0,kt.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3].map(e=>(0,kt.jsxs)("div",{className:"p-2 rounded border ".concat(t?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)(r,{className:"h-3 w-16 mb-2"}),(0,kt.jsx)(r,{className:"h-2 w-20 mb-1"}),(0,kt.jsx)(r,{className:"h-2 w-24"})]},e))}),(0,kt.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,5,6].map(e=>(0,kt.jsx)(r,{className:"h-12 w-full"},e))})]})},Wa=e=>{let{message:t="Something went wrong",onRetry:r,colorMode:n=!1}=e;return(0,kt.jsxs)("div",{className:"".concat(n?"bg-slate-800 border-slate-600":"bg-white border-gray-200"," border rounded-lg p-8 text-center"),children:[(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsx)("svg",{className:"w-12 h-12 text-red-400 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(n?"text-white":"text-gray-900"," mb-2"),children:"Oops! Something went wrong"}),(0,kt.jsx)("p",{className:"".concat(n?"text-gray-300":"text-gray-600"," mb-4"),children:t}),r&&(0,kt.jsx)("button",{onClick:r,className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]})},za=Object.create(null);za.open="0",za.close="1",za.ping="2",za.pong="3",za.message="4",za.upgrade="5",za.noop="6";const Va=Object.create(null);Object.keys(za).forEach(e=>{Va[za[e]]=e});const Ha={type:"error",data:"parser error"},qa="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Ka="function"===typeof ArrayBuffer,Ga=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Ja=(e,t,r)=>{let{type:n,data:s}=e;return qa&&s instanceof Blob?t?r(s):Ya(s,r):Ka&&(s instanceof ArrayBuffer||Ga(s))?t?r(s):Ya(new Blob([s]),r):r(za[n]+(s||""))},Ya=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function Qa(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Xa;const $a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Za="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let IS=0;IS<64;IS++)Za[$a.charCodeAt(IS)]=IS;const eo="function"===typeof ArrayBuffer,to=(e,t)=>{if("string"!==typeof e)return{type:"message",data:no(e,t)};const r=e.charAt(0);if("b"===r)return{type:"message",data:ro(e.substring(1),t)};return Va[r]?e.length>1?{type:Va[r],data:e.substring(1)}:{type:Va[r]}:Ha},ro=(e,t)=>{if(eo){const r=(e=>{let t,r,n,s,a,o=.75*e.length,i=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const c=new ArrayBuffer(o),d=new Uint8Array(c);for(t=0;t<i;t+=4)r=Za[e.charCodeAt(t)],n=Za[e.charCodeAt(t+1)],s=Za[e.charCodeAt(t+2)],a=Za[e.charCodeAt(t+3)],d[l++]=r<<2|n>>4,d[l++]=(15&n)<<4|s>>2,d[l++]=(3&s)<<6|63&a;return c})(e);return no(r,t)}return{base64:!0,data:e}},no=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,so=String.fromCharCode(30);function ao(){return new TransformStream({transform(e,t){!function(e,t){qa&&e.data instanceof Blob?e.data.arrayBuffer().then(Qa).then(t):Ka&&(e.data instanceof ArrayBuffer||Ga(e.data))?t(Qa(e.data)):Ja(e,!1,e=>{Xa||(Xa=new TextEncoder),t(Xa.encode(e))})}(e,r=>{const n=r.length;let s;if(n<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,n);else if(n<65536){s=new Uint8Array(3);const e=new DataView(s.buffer);e.setUint8(0,126),e.setUint16(1,n)}else{s=new Uint8Array(9);const e=new DataView(s.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(n))}e.data&&"string"!==typeof e.data&&(s[0]|=128),t.enqueue(s),t.enqueue(r)})}})}let oo;function io(e){return e.reduce((e,t)=>e+t.length,0)}function lo(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let n=0;for(let s=0;s<t;s++)r[s]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function co(e){if(e)return function(e){for(var t in co.prototype)e[t]=co.prototype[t];return e}(e)}co.prototype.on=co.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},co.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},co.prototype.off=co.prototype.removeListener=co.prototype.removeAllListeners=co.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<n.length;s++)if((r=n[s])===t||r.fn===t){n.splice(s,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},co.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var s=(r=r.slice(0)).length;n<s;++n)r[n].apply(this,t)}return this},co.prototype.emitReserved=co.prototype.emit,co.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},co.prototype.hasListeners=function(e){return!!this.listeners(e).length};const uo="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),ho="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function mo(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}const po=ho.setTimeout,go=ho.clearTimeout;function fo(e,t){t.useNativeTimers?(e.setTimeoutFn=po.bind(ho),e.clearTimeoutFn=go.bind(ho)):(e.setTimeoutFn=ho.setTimeout.bind(ho),e.clearTimeoutFn=ho.clearTimeout.bind(ho))}function xo(e){return"string"===typeof e?function(e){let t=0,r=0;for(let n=0,s=e.length;n<s;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(e):Math.ceil(1.33*(e.byteLength||e.size))}function vo(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class yo extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class bo extends co{constructor(e){super(),this.writable=!1,fo(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new yo(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=to(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}class wo extends bo{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(so),n=[];for(let s=0;s<r.length;s++){const e=to(r[s],t);if(n.push(e),"error"===e.type)break}return n})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let s=0;e.forEach((e,a)=>{Ja(e,!1,e=>{n[a]=e,++s===r&&t(n.join(so))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=vo()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let jo=!1;try{jo="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(ES){}const No=jo;function So(){}class ko extends wo{constructor(e){if(super(e),"undefined"!==typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class Ao extends co{constructor(e,t,r){super(),this.createRequest=e,fo(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=void 0!==r.data?r.data:null,this._create()}_create(){var e;const t=mo(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(It){}if("POST"===this._method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(It){}try{r.setRequestHeader("Accept","*/*")}catch(It){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var e;3===r.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(r.getResponseHeader("set-cookie"))),4===r.readyState&&(200===r.status||1223===r.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"===typeof r.status?r.status:0)},0))},r.send(this._data)}catch(It){return void this.setTimeoutFn(()=>{this._onError(It)},0)}"undefined"!==typeof document&&(this._index=Ao.requestsCount++,Ao.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if("undefined"!==typeof this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=So,e)try{this._xhr.abort()}catch(It){}"undefined"!==typeof document&&delete Ao.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(Ao.requestsCount=0,Ao.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",Co);else if("function"===typeof addEventListener){addEventListener("onpagehide"in ho?"pagehide":"unload",Co,!1)}function Co(){for(let e in Ao.requests)Ao.requests.hasOwnProperty(e)&&Ao.requests[e].abort()}const Eo=function(){const e=Po({xdomain:!1});return e&&null!==e.responseType}();function Po(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||No))return new XMLHttpRequest}catch(It){}if(!t)try{return new(ho[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(It){}}const Io="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class To extends bo{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=Io?{}:mo(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(ES){return this.emitReserved("error",ES)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;Ja(r,this.supportsBinary,e=>{try{this.doWrite(r,e)}catch(It){}n&&uo(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){"undefined"!==typeof this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=vo()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Do=ho.WebSocket||ho.MozWebSocket;const Mo={websocket:class extends To{createSocket(e,t,r){return Io?new Do(e,t,r):t?new Do(e,t):new Do(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends bo{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(ES){return this.emitReserved("error",ES)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){oo||(oo=new TextDecoder);const r=[];let n=0,s=-1,a=!1;return new TransformStream({transform(o,i){for(r.push(o);;){if(0===n){if(io(r)<1)break;const e=lo(r,1);a=128===(128&e[0]),s=127&e[0],n=s<126?3:126===s?1:2}else if(1===n){if(io(r)<2)break;const e=lo(r,2);s=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(io(r)<8)break;const e=lo(r,8),t=new DataView(e.buffer,e.byteOffset,e.length),a=t.getUint32(0);if(a>Math.pow(2,21)-1){i.enqueue(Ha);break}s=a*Math.pow(2,32)+t.getUint32(4),n=3}else{if(io(r)<s)break;const e=lo(r,s);i.enqueue(to(a?e:oo.decode(e),t)),n=0}if(0===s||s>e){i.enqueue(Ha);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),n=ao();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const s=()=>{r.read().then(e=>{let{done:t,value:r}=e;t||(this.onPacket(r),s())}).catch(e=>{})};s();const a={type:"open"};this.query.sid&&(a.data='{"sid":"'.concat(this.query.sid,'"}')),this._writer.write(a).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;this._writer.write(r).then(()=>{n&&uo(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends ko{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Eo&&!t}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd},this.opts),new Ao(Po,this.uri(),e)}}},_o=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Oo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Lo(e){if(e.length>8e3)throw"URI too long";const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let s=_o.exec(e||""),a={},o=14;for(;o--;)a[Oo[o]]=s[o]||"";return-1!=r&&-1!=n&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,a.path),a.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(r[t]=n)}),r}(0,a.query),a}const Ro="function"===typeof addEventListener&&"function"===typeof removeEventListener,Fo=[];Ro&&addEventListener("offline",()=>{Fo.forEach(e=>e())},!1);class Uo extends co{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"===typeof e&&(t=e,e=null),e){const r=Lo(e);t.hostname=r.host,t.secure="https"===r.protocol||"wss"===r.protocol,t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=Lo(t.host).host);fo(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let n=0,s=r.length;n<s;n++){let e=r[n].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),Ro&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Fo.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&Uo.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",Uo.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=xo(r)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,uo(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,n){if("function"===typeof t&&(n=t,t=void 0),"function"===typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(Uo.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Ro&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=Fo.indexOf(this._offlineEventListener);-1!==e&&Fo.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Uo.protocol=4;class Bo extends Uo{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;Uo.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Uo.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{r||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function s(){r||(r=!0,c(),t.close(),t=null)}const a=e=>{const r=new Error("probe error: "+e);r.transport=t.name,s(),this.emitReserved("upgradeError",r)};function o(){a("transport closed")}function i(){a("socket closed")}function l(e){t&&e.name!==t.name&&s()}const c=()=>{t.removeListener("open",n),t.removeListener("error",a),t.removeListener("close",o),this.off("close",i),this.off("upgrading",l)};t.once("open",n),t.once("error",a),t.once("close",o),this.once("close",i),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}class Wo extends Bo{constructor(e){const t="object"===typeof e?e:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(!t.transports||t.transports&&"string"===typeof t.transports[0])&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(e=>Mo[e]).filter(e=>!!e)),super(e,t)}}const zo="function"===typeof ArrayBuffer,Vo=Object.prototype.toString,Ho="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Vo.call(Blob),qo="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Vo.call(File);function Ko(e){return zo&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||Ho&&e instanceof Blob||qo&&e instanceof File}function Go(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(Go(e[t]))return!0;return!1}if(Ko(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return Go(e.toJSON(),!0);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&Go(e[r]))return!0;return!1}function Jo(e){const t=[],r=e.data,n=e;return n.data=Yo(r,t),n.attachments=t.length,{packet:n,buffers:t}}function Yo(e,t){if(!e)return e;if(Ko(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=Yo(e[n],t);return r}if("object"===typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=Yo(e[n],t));return r}return e}function Qo(e,t){return e.data=Xo(e.data,t),delete e.attachments,e}function Xo(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=Xo(e[r],t);else if("object"===typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=Xo(e[r],t));return e}const $o=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Zo=5;var ei;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(ei||(ei={}));class ti{constructor(e){this.replacer=e}encode(e){return e.type!==ei.EVENT&&e.type!==ei.ACK||!Go(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===ei.EVENT?ei.BINARY_EVENT:ei.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==ei.BINARY_EVENT&&e.type!==ei.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Jo(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}function ri(e){return"[object Object]"===Object.prototype.toString.call(e)}class ni extends co{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===ei.BINARY_EVENT;r||t.type===ei.BINARY_ACK?(t.type=r?ei.EVENT:ei.ACK,this.reconstructor=new si(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Ko(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===ei[r.type])throw new Error("unknown packet type "+r.type);if(r.type===ei.BINARY_EVENT||r.type===ei.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const s=e.substring(n,t);if(s!=Number(s)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!ni.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(It){return!1}}static isPayloadValid(e,t){switch(e){case ei.CONNECT:return ri(t);case ei.DISCONNECT:return void 0===t;case ei.CONNECT_ERROR:return"string"===typeof t||ri(t);case ei.EVENT:case ei.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===$o.indexOf(t[0]));case ei.ACK:case ei.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class si{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Qo(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ai(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const oi=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ii extends co{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ai(e,"open",this.onopen.bind(this)),ai(e,"packet",this.onpacket.bind(this)),ai(e,"error",this.onerror.bind(this)),ai(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){var t,r,n;if(oi.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];if(a.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const i={type:ei.EVENT,data:a,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"===typeof a[a.length-1]){const e=this.ids++,t=a.pop();this._registerAckCallback(e,t),i.id=e}const l=null===(r=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===r?void 0:r.writable,c=this.connected&&!(null===(n=this.io.engine)||void 0===n?void 0:n._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,t){var r,n=this;const s=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===s)return void(this.acks[e]=t);const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},s),o=function(){n.io.clearTimeoutFn(a);for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];t.apply(n,r)};o.withError=!0,this.acks[e]=o}emitWithAck(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return new Promise((t,n)=>{const s=(e,r)=>e?n(e):t(r);s.withError=!0,r.push(s),this.emit(e,...r)})}_addToQueue(e){var t=this;let r;"function"===typeof e[e.length-1]&&(r=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(function(e){if(n!==t._queue[0])return;if(null!==e)n.tryCount>t._opts.retries&&(t._queue.shift(),r&&r(e));else if(t._queue.shift(),r){for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];r(null,...a)}return n.pending=!1,t._drainQueue()}),this._queue.push(n),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ei.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ei.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ei.EVENT:case ei.BINARY_EVENT:this.onevent(e);break;case ei.ACK:case ei.BINARY_ACK:this.onack(e);break;case ei.DISCONNECT:this.ondisconnect();break;case ei.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(){if(!r){r=!0;for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];t.packet({type:ei.ACK,id:e,data:s})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ei.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function li(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}li.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},li.prototype.reset=function(){this.attempts=0},li.prototype.setMin=function(e){this.ms=e},li.prototype.setMax=function(e){this.max=e},li.prototype.setJitter=function(e){this.jitter=e};class ci extends co{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"===typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,fo(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new li({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||n;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Wo(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=ai(t,"open",function(){r.onopen(),e&&e()}),s=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},a=ai(t,"error",s);if(!1!==this._timeout){const e=this._timeout,r=this.setTimeoutFn(()=>{n(),s(new Error("timeout")),t.close()},e);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}return this.subs.push(n),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ai(e,"ping",this.onping.bind(this)),ai(e,"data",this.ondata.bind(this)),ai(e,"error",this.onerror.bind(this)),ai(e,"close",this.onclose.bind(this)),ai(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(It){this.onclose("parse error",It)}}ondecoded(e){uo(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new ii(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t){if(this.nsps[r].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),null===(r=this.engine)||void 0===r||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const di={};function ui(e,t){"object"===typeof e&&(t=e,e=void 0);const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=e;r=r||"undefined"!==typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof r?r.protocol+"//"+e:"https://"+e),n=Lo(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+t,n.href=n.protocol+"://"+s+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=r.source,s=r.id,a=r.path,o=di[s]&&a in di[s].nsps;let i;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?i=new ci(n,t):(di[s]||(di[s]=new ci(n,t)),i=di[s]),r.query&&!t.query&&(t.query=r.queryKey),i.socket(r.path,t)}Object.assign(ui,{Manager:ci,Socket:ii,io:ui,connect:ui});const hi=new class{constructor(){this.socket=null,this.isConnected=!1,this.eventHandlers=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.serverUrl="undefined"!==typeof window&&window.location&&"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname?"".concat(window.location.protocol,"//").concat(window.location.host):{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_SOCKET_URL||"http://localhost:5000"}connect(){this.socket&&this.disconnect();let e=localStorage.getItem("authToken")||localStorage.getItem("token");return e||(e="demo-david-chen-token-"+Date.now(),localStorage.setItem("authToken",e),localStorage.setItem("token",e)),this.socket=ui(this.serverUrl,{auth:{token:e},transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4}),this.setupEventHandlers(),this.setupReconnectionHandlers(),this}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1)}setupEventHandlers(){this.socket.on("connect",()=>{console.log("\ud83d\udd0c Connected to Kenstruction server"),this.isConnected=!0,this.reconnectAttempts=0,this.emit("connected")}),this.socket.on("disconnect",e=>{console.log("\ud83d\udd0c Disconnected from server:",e),this.isConnected=!1,this.emit("disconnected",e)}),this.socket.on("error",e=>{console.error("\u274c Socket error:",e),this.emit("error",e)}),this.socket.on("newMessage",e=>this.emit("message",e)),this.socket.on("newNotification",e=>this.emit("notification",e)),this.socket.on("projectUpdated",e=>this.emit("projectUpdate",e)),this.socket.on("progressUpdated",e=>this.emit("progressUpdate",e)),this.socket.on("statusUpdated",e=>this.emit("statusUpdate",e)),this.socket.on("taskUpdated",e=>this.emit("taskUpdate",e)),this.socket.on("documentUpdated",e=>this.emit("documentUpdate",e)),this.socket.on("newActivity",e=>this.emit("activity",e)),this.socket.on("userStatusChanged",e=>this.emit("userStatus",e)),this.socket.on("userTyping",e=>this.emit("typing",e)),this.socket.on("userJoinedProject",e=>this.emit("userJoined",e)),this.socket.on("userLeftProject",e=>this.emit("userLeft",e)),this.socket.on("workflow_updated",e=>{console.log("\ud83d\udd04 Workflow updated:",e),this.emit("workflowUpdate",e),this.emit("alertsChanged",{projectId:e.projectId,type:"workflow"})}),this.socket.on("alerts_refresh",e=>{console.log("\ud83d\udd04 Alerts refresh requested:",e),this.emit("alertsChanged",e)}),this.socket.on("new_alert",e=>{console.log("\ud83d\udea8 New alert received:",e),this.emit("newAlert",e),"undefined"!==typeof window&&"Notification"in window&&"granted"===Notification.permission&&new Notification(e.title||"New Alert",{body:e.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:"alert-".concat(e.id),requireInteraction:"HIGH"===e.priority})}),this.socket.on("alert_completed",e=>{console.log("\u2705 Alert completed:",e),this.emit("alertCompleted",e),this.emit("alertsChanged",{type:"completion"})})}setupReconnectionHandlers(){let e=1e3,t=null;this.socket.on("reconnect",t=>{console.log("\ud83d\udd04 Reconnected after ".concat(t," attempts")),e=1e3,this.emit("reconnected",t),this.rejoinRooms()}),this.socket.on("reconnect_attempt",e=>{console.log("\ud83d\udd04 Reconnection attempt ".concat(e)),this.reconnectAttempts=e,this.emit("reconnectAttempt",e)}),this.socket.on("reconnect_failed",()=>{console.error("\u274c Failed to reconnect to server"),this.emit("reconnectFailed"),this.reconnectAttempts<this.maxReconnectAttempts&&(t=setTimeout(()=>{console.log("\ud83d\udd04 Manual reconnection attempt after ".concat(e,"ms")),this.socket.connect(),e=Math.min(2*e,3e4)},e))}),this.socket.on("disconnect",r=>{console.log("\ud83d\udd0c Disconnected:",r),this.isConnected=!1,"io server disconnect"===r?(console.log("\ud83d\udd04 Server initiated disconnect, reconnecting..."),this.socket.connect()):"transport close"!==r&&"transport error"!==r||!t&&this.reconnectAttempts<this.maxReconnectAttempts&&(t=setTimeout(()=>{console.log("\ud83d\udd04 Reconnecting after network issue (backoff: ".concat(e,"ms)")),this.socket.connect(),e=Math.min(2*e,3e4),t=null},e))})}rejoinRooms(){this.currentProjectId&&(this.joinProject(this.currentProjectId),console.log("\ud83d\udc65 Rejoined project ".concat(this.currentProjectId))),this.currentConversationId&&(this.joinConversation(this.currentConversationId),console.log("\ud83d\udcac Rejoined conversation ".concat(this.currentConversationId)))}joinProject(e){this.isConnected?(this.currentProjectId=e,this.socket.emit("join_project",e),console.log("\ud83d\udc65 Joined project ".concat(e))):console.warn("\u26a0\ufe0f Not connected to server")}leaveProject(e){this.isConnected?(this.currentProjectId===e&&(this.currentProjectId=null),this.socket.emit("leave_project",e),console.log("\ud83d\udc4b Left project ".concat(e))):console.warn("\u26a0\ufe0f Not connected to server")}joinConversation(e){this.isConnected?(this.currentConversationId=e,this.socket.emit("join_conversation",e),console.log("\ud83d\udcac Joined conversation ".concat(e))):console.warn("\u26a0\ufe0f Not connected to server")}leaveConversation(e){this.isConnected?(this.currentConversationId===e&&(this.currentConversationId=null),this.socket.emit("leave_conversation",e),console.log("\ud83d\udcac Left conversation ".concat(e))):console.warn("\u26a0\ufe0f Not connected to server")}sendMessage(e){return this.isConnected?new Promise((t,r)=>{this.socket.emit("sendMessage",e),this.socket.once("messageSent",e=>{e.success?t(e):r(new Error("Failed to send message"))}),setTimeout(()=>{r(new Error("Message send timeout"))},5e3)}):(console.warn("\u26a0\ufe0f Not connected to server"),Promise.reject(new Error("Not connected to server")))}sendNotification(e){return this.isConnected?new Promise((t,r)=>{this.socket.emit("notification",e),this.socket.once("notificationSent",e=>{e.success?t(e):r(new Error("Failed to send notification"))}),setTimeout(()=>{r(new Error("Notification send timeout"))},5e3)}):(console.warn("\u26a0\ufe0f Not connected to server"),Promise.reject(new Error("Not connected to server")))}sendProjectUpdate(e){return this.isConnected?new Promise((t,r)=>{this.socket.emit("projectUpdate",e),this.socket.once("projectUpdateSent",e=>{e.success?t(e):r(new Error("Failed to send project update"))}),setTimeout(()=>{r(new Error("Project update send timeout"))},5e3)}):(console.warn("\u26a0\ufe0f Not connected to server"),Promise.reject(new Error("Not connected to server")))}sendTaskUpdate(e){this.isConnected?this.socket.emit("task_update",e):console.warn("\u26a0\ufe0f Not connected to server")}sendActivityUpdate(e){this.isConnected?this.socket.emit("activity_update",e):console.warn("\u26a0\ufe0f Not connected to server")}sendDocumentUpdate(e){this.isConnected?this.socket.emit("document_update",e):console.warn("\u26a0\ufe0f Not connected to server")}updateUserStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isConnected?this.socket.emit("user_status_update",{status:e,projectId:t}):console.warn("\u26a0\ufe0f Not connected to server")}startTyping(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isConnected?this.socket.emit("typing_start",{conversationId:e,projectId:t}):console.warn("\u26a0\ufe0f Not connected to server")}stopTyping(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isConnected?this.socket.emit("typing_stop",{conversationId:e,projectId:t}):console.warn("\u26a0\ufe0f Not connected to server")}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}off(e,t){if(this.eventHandlers.has(e)){const r=this.eventHandlers.get(e),n=r.indexOf(t);n>-1&&r.splice(n,1)}}emit(e,t){this.eventHandlers.has(e)&&this.eventHandlers.get(e).forEach(r=>{try{r(t)}catch(n){console.error("Error in event handler for ".concat(e,":"),n)}})}getConnectionStatus(){return{isConnected:this.isConnected,reconnectAttempts:this.reconnectAttempts,maxReconnectAttempts:this.maxReconnectAttempts}}},mi=hi,pi=["Input Customer Information","Complete Questions to Ask Checklist","Input Lead Property Information","Assign A Project Manager","Schedule Initial Inspection","Site Inspection","Write Estimate","Insurance Process","Agreement Preparation","Agreement Signing","Administrative Setup","Pre-Job Actions","Prepare for Production","Installation","Quality Check","Multiple Trades","Subcontractor Work","Update Customer","Create Supp in Xactimate","Follow-Up Calls","Review Approved Supp","Customer Update","Financial Processing","Project Closeout"],gi=[...pi,"General Update","Project Status","Material Delivery","Safety Meeting","Quality Inspection","Client Communication","Permit Update","Weather Alert","Equipment Issue","Crew Assignment","Budget Update","Schedule Change","Inspection Report","Documentation","Emergency Alert","Training Update","Maintenance Required","Vendor Communication","Insurance Update","Warranty Information"],fi=(0,o.createContext)(),xi=()=>{const e=(0,o.useContext)(fi);if(!e)throw new Error("useSubjects must be used within a SubjectsProvider");return e},vi=e=>{let{children:t}=e;const[r,n]=(0,o.useState)([]);(0,o.useEffect)(()=>{const e=localStorage.getItem("customSubjects");if(e)try{n(JSON.parse(e))}catch(t){n([...gi])}else n([...gi])},[]);const s=e=>{n(e),localStorage.setItem("customSubjects",JSON.stringify(e))},a={subjects:r,addSubject:e=>{if(e.trim()&&!r.includes(e.trim())){const t=[...r,e.trim()];return s(t),!0}return!1},editSubject:(e,t)=>{if(t.trim()&&!r.includes(t.trim())){const n=[...r];return n[e]=t.trim(),s(n),!0}return!1},deleteSubject:e=>{const t=r.filter((t,r)=>r!==e);s(t)},resetToDefaults:()=>{s([...gi])},updateSubjects:s};return(0,kt.jsx)(fi.Provider,{value:a,children:t})},yi=e=>{if(!e||0===e.length)return[];const t=[],r=new Date,n=[{type:"project_update",subject:"Project Status Update",templates:["Project status updated","Progress milestone reached","Phase transition completed"]},{type:"material_delivery",subject:"Material Delivery",templates:["Materials delivered on site","Delivery scheduled","Materials inspection completed"]},{type:"site_inspection",subject:"Site Inspection",templates:["Site inspection completed","Inspection scheduled","Quality check performed"]},{type:"customer_communication",subject:"Customer Communication",templates:["Customer meeting held","Client approval received","Follow-up call completed"]},{type:"documentation",subject:"Project Documentation",templates:["Documents updated","Photos uploaded","Report generated"]},{type:"crew_assignment",subject:"Team Assignment",templates:["Crew assigned","Team schedule updated","Labor coordination completed"]},{type:"quality_check",subject:"Quality Review",templates:["Quality inspection passed","Work standards verified","Final review completed"]},{type:"permit_update",subject:"Permit Status",templates:["Permits approved","Regulatory compliance verified","License requirements met"]},{type:"schedule_change",subject:"Schedule Update",templates:["Timeline adjusted","Meeting rescheduled","Milestone date changed"]},{type:"budget_discussion",subject:"Budget Review",templates:["Budget approved","Cost estimate updated","Payment processed"]}];return e.forEach((e,s)=>{const a=Math.floor(3*Math.random())+2;for(let o=0;o<a;o++){const s=n[Math.floor(Math.random()*n.length)],a=s.templates[Math.floor(Math.random()*s.templates.length)],i=Math.floor(7*Math.random()),l=Math.floor(24*Math.random()),c=new Date(r.getTime()-24*i*60*60*1e3-60*l*60*1e3);t.push({id:"message_".concat(e.id,"_").concat(o),projectId:e.id,projectName:e.name,projectNumber:e.projectNumber,type:s.type,subject:s.subject,description:a,user:"Unknown User",timestamp:c.toISOString(),priority:["low","medium","high"][Math.floor(3*Math.random())],metadata:{projectPhase:Bn.getProjectPhase(e)||"LEAD",projectValue:e.budget||e.estimateValue,assignedTo:e.assignedTo||"Sarah Owner"}})}}),t},bi=Bn.getAllPhases(),wi=e=>Bn.calculateProjectProgress(e).overall||0,ji=e=>{let{tasks:t,activities:r,onProjectSelect:n,onAddActivity:s,colorMode:a,dashboardState:i}=e;console.log("\ud83d\udd0d DASHBOARD: Component rendering...");const l=Ct(),{data:c,isLoading:d,error:u,refetch:h}=va({limit:100}),m=Array.isArray(c)?c:(null===c||void 0===c?void 0:c.data)||[],p=m&&m.length>0?m:Da;console.log("\ud83d\udd0d DASHBOARD DEBUG: projectsData:",c),console.log("\ud83d\udd0d DASHBOARD DEBUG: projectsData.data:",null===c||void 0===c?void 0:c.data),console.log("\ud83d\udd0d DASHBOARD DEBUG: projectsData.success:",null===c||void 0===c?void 0:c.success),console.log("\ud83d\udd0d DASHBOARD DEBUG: projects array:",m),console.log("\ud83d\udd0d DASHBOARD DEBUG: projects length:",null===m||void 0===m?void 0:m.length);const[g,f]=(0,o.useState)(null),x=g||m;(0,o.useEffect)(()=>{let e=!1;return(async()=>{if(Array.isArray(m)&&0!==m.length)try{const t={Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},r=await Promise.all(m.map(async e=>{const r=Bn.getProjectPhase(e);if(r&&"LEAD"!==r)return e;try{const r=await fetch("/api/workflow-data/project-position/".concat(e.id),{headers:t});if(!r.ok)return e;const u=await r.json();if(null!==u&&void 0!==u&&u.success&&u.data){var n,s,a,o,i,l,c,d;const t=u.data;return(0,Y.A)((0,Y.A)({},e),{},{currentWorkflowItem:(0,Y.A)((0,Y.A)({},e.currentWorkflowItem||{}),{},{phase:t.phaseType||(null===(n=e.currentWorkflowItem)||void 0===n?void 0:n.phase)||e.phase||"LEAD",phaseDisplay:t.phaseName||(null===(s=e.currentWorkflowItem)||void 0===s?void 0:s.phaseDisplay)||null,section:t.sectionDisplayName||(null===(a=e.currentWorkflowItem)||void 0===a?void 0:a.section)||null,lineItem:t.currentLineItemName||(null===(o=e.currentWorkflowItem)||void 0===o?void 0:o.lineItem)||null,lineItemId:t.currentLineItem||(null===(i=e.currentWorkflowItem)||void 0===i?void 0:i.lineItemId)||null,sectionId:t.currentSectionId||(null===(l=e.currentWorkflowItem)||void 0===l?void 0:l.sectionId)||null,phaseId:t.currentPhase||(null===(c=e.currentWorkflowItem)||void 0===c?void 0:c.phaseId)||null,isComplete:!1,totalLineItems:(null===(d=e.currentWorkflowItem)||void 0===d?void 0:d.totalLineItems)||Bn.estimateTotalLineItems()})})}}catch(Pr){}return e}));e||f(r)}catch(Pr){e||f(null)}else e||f(null)})(),()=>{e=!0}},[m]);const{subjects:v}=xi(),{data:y,isLoading:b}=Cs({queryKey:xa.currentUser,queryFn:()=>Ds.authService.getCurrentUser(),select:e=>(null===e||void 0===e?void 0:e.data)||e,staleTime:6e5,retry:!1,initialData:()=>{try{const e=localStorage.getItem("user")||localStorage.getItem("currentUser");if(e)return{data:JSON.parse(e)}}catch(e){console.error("Error parsing stored user:",e)}}}),[w,j]=(0,o.useState)([]),[N,S]=(0,o.useState)(!1),[k,A]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=!1;return(async()=>{S(!0),A(null);try{const t=localStorage.getItem("authToken")||localStorage.getItem("token")||sessionStorage.getItem("authToken")||sessionStorage.getItem("token"),r={"Content-Type":"application/json"};t&&(r.Authorization="Bearer ".concat(t));const n=await fetch("".concat(Ds.API_BASE_URL,"/roles/users"),{method:"GET",headers:r});if(!n.ok)throw new Error("Failed to load users: ".concat(n.status));const s=await n.json(),a=(Array.isArray(null===s||void 0===s?void 0:s.data)?s.data:[]).map(e=>{var t,r,n,s,a,o,i,l;return{id:e.id||e.userId||e._id||e.uuid||null,firstName:e.firstName||(null===(t=e.name)||void 0===t?void 0:t.first)||(null===(r=e.fullName)||void 0===r||null===(n=r.split)||void 0===n||null===(s=n.call(r," "))||void 0===s?void 0:s[0])||"",lastName:e.lastName||(null===(a=e.name)||void 0===a?void 0:a.last)||(null===(o=e.fullName)||void 0===o||null===(i=o.split)||void 0===i||null===(l=i.call(o," "))||void 0===l?void 0:l.slice(1).join(" "))||"",email:e.email||e.primaryEmail||"",phone:e.phone||e.primaryPhone||"",role:e.role||e.userRole||e.assignedRole||"",avatarUrl:e.avatarUrl||e.avatar||e.photoUrl||"",raw:e}}).filter(e=>e.id);e||j(a)}catch(t){e||(console.error("Failed to fetch assignable users from roles endpoint:",t),A(t),j([]))}finally{e||S(!1)}})(),()=>{e=!0}},[]);const C=(0,o.useMemo)(()=>Array.isArray(w)?w:[],[w]),[E,P]=(0,o.useState)([]),[I,T]=(0,o.useState)(!0);console.log("\ud83d\udd0d DASHBOARD: Projects loading state:",d),console.log("\ud83d\udd0d DASHBOARD: Projects error:",u),console.log("\ud83d\udd0d DASHBOARD: Projects data:",c),console.log("\ud83d\udd0d DASHBOARD: Projects array length:",m.length),u&&console.error("\ud83d\udea8 PROJECTS ERROR DETAILS:",{error:u,projectsData:c,loading:d});const D=(0,o.useRef)(null);(0,o.useEffect)(()=>{i&&i!==D.current&&(console.log("\ud83d\udd0d DASHBOARD: Dashboard state received, triggering data refresh if needed"),D.current=i,u&&"function"===typeof h&&(console.log("\ud83d\udd04 DASHBOARD: Attempting to refetch projects due to navigation state restoration"),setTimeout(()=>{h()},500)))},[i,u]),(0,o.useEffect)(()=>{try{const e=null===i||void 0===i?void 0:i.workflowRestore;if(!e)return;const{targetLineItemId:t,targetSectionId:r,project:n}=e||{};if(!t||!n)return;setTimeout(()=>{const e=document.querySelector('[data-section="project-workflow-tasks"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"});const r=document.getElementById("lineitem-".concat(t))||document.querySelector('[data-lineitem-id="'.concat(t,'"]'));if(r){r.scrollIntoView({behavior:"smooth",block:"center"});const e=r.style.boxShadow;r.style.boxShadow="0 0 10px rgba(59,130,246,0.6)",setTimeout(()=>{r.style.boxShadow=e||""},2500)}},120)}catch(ES){console.warn("Workflow restore failed:",ES)}},[i]),(0,o.useEffect)(()=>{try{const e=null===i||void 0===i?void 0:i.workflowRestore;if(!e)return;const{targetLineItemId:t}=e||{};if(!t)return;const r=setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("dashboard:clearWorkflowRestore"))}catch(It){}},800);return()=>clearTimeout(r)}catch(Pr){}},[i]);const[M,_]=(0,o.useState)(""),[O,L]=(0,o.useState)(""),[R,F]=(0,o.useState)(""),[U,B]=(0,o.useState)(!1),[W,z]=(0,o.useState)([]),[V,H]=(0,o.useState)("low"),[q,K]=(0,o.useState)("messages"),[G,J]=(0,o.useState)(!1),[Q,X]=(0,o.useState)(""),[$,Z]=(0,o.useState)(""),[ee,te]=(0,o.useState)(""),[re,ne]=(0,o.useState)(""),[se,ae]=(0,o.useState)(""),[oe,ie]=(0,o.useState)(""),[le,ce]=(0,o.useState)(!0),[de,ue]=(0,o.useState)(!0),[he,me]=(0,o.useState)(!0),[pe,ge]=(0,o.useState)(!0),[fe,xe]=(0,o.useState)(!0),[ve,ye]=(0,o.useState)(!0),[be,we]=(0,o.useState)(""),[je,Ne]=(0,o.useState)(""),[Se,ke]=(0,o.useState)(""),[Ae,Ce]=(0,o.useState)(!1),[Ee,Pe]=(0,o.useState)(""),[Ie,Te]=(0,o.useState)({days:0,hours:0,minutes:0}),[De,Me]=(0,o.useState)({enabled:!1,days:0,hours:0,minutes:0}),[_e,Oe]=(0,o.useState)({days:0,hours:0,minutes:0}),[Le,Re]=(0,o.useState)({enabled:!1,days:0,hours:0,minutes:0}),[Fe,Ue]=(0,o.useState)(new Set),[Be,We]=(0,o.useState)(()=>{const e=localStorage.getItem("taskComments");return e?JSON.parse(e):{}}),[ze,Ve]=(0,o.useState)({}),[He,qe]=(0,o.useState)({}),[Ke,Ge]=(0,o.useState)({}),[Je,Ye]=(0,o.useState)({}),[Qe,Xe]=(0,o.useState)({}),$e=e=>{Ue(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},Ze=async e=>{const t=ze[e];if(null===t||void 0===t||!t.trim())return;const r={id:"comment_".concat(Date.now()),text:t.trim(),user:y?"".concat(y.firstName," ").concat(y.lastName):"Unknown User",userId:null===y||void 0===y?void 0:y.id,timestamp:(new Date).toISOString()};try{(await fetch("/api/tasks/comments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({taskId:e,comment:t.trim(),userId:null===y||void 0===y?void 0:y.id})})).ok?(We(t=>{const n=(0,Y.A)((0,Y.A)({},t),{},{[e]:[...t[e]||[],r]});return localStorage.setItem("taskComments",JSON.stringify(n)),n}),Vr.success("Comment added")):Vr.error("Failed to save comment")}catch(n){console.error("Error saving comment:",n),Vr.error("Failed to save comment"),We(t=>{const n=(0,Y.A)((0,Y.A)({},t),{},{[e]:[...t[e]||[],r]});return localStorage.setItem("taskComments",JSON.stringify(n)),n})}Ve(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:""}))},[et,tt]=(0,o.useState)(""),[rt,nt]=(0,o.useState)(""),[st,at]=(0,o.useState)(""),[ot,it]=(0,o.useState)(!1),[lt,ct]=(0,o.useState)([]),[dt,ut]=(0,o.useState)(!1),[ht,mt]=(0,o.useState)(""),[pt,gt]=(0,o.useState)(""),[ft,xt]=(0,o.useState)(""),[vt,yt]=(0,o.useState)(""),[bt,wt]=(0,o.useState)([]),[jt,Nt]=(0,o.useState)(""),[St,At]=(0,o.useState)(""),[Et,Pt]=(0,o.useState)(""),[Tt,Dt]=(0,o.useState)([]),{data:Mt,isLoading:_t}=ya({limit:200}),Ot=Array.isArray(Mt)?Mt:(null===Mt||void 0===Mt?void 0:Mt.data)||[],{data:Lt=[],isLoading:Rt}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return Cs({queryKey:xa.recentActivities(e),queryFn:()=>Ds.activitiesService.getRecent(e),select:e=>(null===e||void 0===e?void 0:e.data)||e||[],staleTime:3e4})}(50),{data:Ft=[],isLoading:Ut}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Cs({queryKey:[...xa.tasks,e],queryFn:()=>Ds.tasksService.getAll(e),select:e=>(null===e||void 0===e?void 0:e.data)||e||[]})}({page:1,limit:20}),{data:Bt=[],isLoading:Wt}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Cs({queryKey:[...xa.calendarEvents,e],queryFn:()=>Ds.calendarService.getAll(e),select:e=>{var t,r,n;const s=e=>Array.isArray(e)?e:null;return s(null===e||void 0===e?void 0:e.data)||s(null===e||void 0===e?void 0:e.items)||s(null===e||void 0===e?void 0:e.results)||s(null===e||void 0===e?void 0:e.events)||s(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.items)||s(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.results)||s(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.events)||s(e)||[]}})}({limit:20});console.log("\ud83d\udd0d DASHBOARD: About to call useFeedback hook");const{data:zt=[],isLoading:Vt,error:Ht}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Cs({queryKey:[...xa.feedback,e],queryFn:()=>Ds.feedbackService.getFeedback(e),select:e=>{var t,r;console.log("\ud83d\udd0d FEEDBACK HOOK: Raw data:",e),console.log("\ud83d\udd0d FEEDBACK HOOK: Raw data.data:",null===e||void 0===e?void 0:e.data),console.log("\ud83d\udd0d FEEDBACK HOOK: Raw data.data.data:",null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data);const n=Array.isArray(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.data)?e.data.data:Array.isArray(null===e||void 0===e?void 0:e.data)?e.data:Array.isArray(e)?e:[];return console.log("\ud83d\udd0d FEEDBACK HOOK: Selected data:",n),console.log("\ud83d\udd0d FEEDBACK HOOK: Selected data type:",typeof n),console.log("\ud83d\udd0d FEEDBACK HOOK: Selected data length:",Array.isArray(n)?n.length:"not array"),n},staleTime:0,retry:!1,refetchOnWindowFocus:!0})}({limit:20});console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: realFeedback:",zt),console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: feedbackLoading:",Vt),console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: feedbackError:",Ht),console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: realFeedback type:",typeof zt),console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: realFeedback length:",Array.isArray(zt)?zt.length:"not array");const[qt,Kt]=(0,o.useState)(!1);(0,o.useEffect)(()=>{Ut||Wt||!y||(async()=>{if(qt)return;if((!Ft||0===Ft.length)&&_a.length>0||(!Bt||0===Bt.length)&&Oa.length>0)try{if(!Ft||0===Ft.length){console.log("\ud83d\udcdd Converting mock tasks to real database entries...");for(const n of _a.slice(0,5))try{var e,t,r;await Ds.tasksService.create({title:n.title,description:n.description,projectId:(null===(e=p[0])||void 0===e?void 0:e.id)||null,assignedTo:(null===y||void 0===y?void 0:y.id)||null,dueDate:n.dueDate,priority:(null===(t=n.priority)||void 0===t?void 0:t.toUpperCase())||"MEDIUM",status:(null===(r=n.status)||void 0===r?void 0:r.toUpperCase())||"TODO"})}catch(ES){console.warn("Failed to create task:",ES)}}if(!Bt||0===Bt.length){console.log("\ud83d\udcc5 Converting mock reminders to real calendar events...");for(const e of Oa.slice(0,5))try{var n;const t=new Date(e.date||e.when||new Date),r=new Date(t.getTime()+36e5);await Ds.calendarService.create({title:e.title,description:e.description,projectId:(null===(n=p[0])||void 0===n?void 0:n.id)||null,startTime:t.toISOString(),endTime:r.toISOString(),eventType:"REMINDER",organizerId:(null===y||void 0===y?void 0:y.id)||null})}catch(ES){console.warn("Failed to create reminder:",ES)}}Kt(!0),l.invalidateQueries([xa.TASKS]),l.invalidateQueries([xa.CALENDAR_EVENTS])}catch(s){console.error("Error converting mock data:",s)}else Kt(!0)})()},[Ft,Bt,Ut,Wt,qt,y,p,l]);const Gt=Lt||[],Jt=Ft||[],Yt=Bt||[],Qt=(0,o.useMemo)(()=>{try{const e=Array.isArray(Tt)?[...Tt]:[],t=new Set,r=(e,r)=>{const n=String(r||"").replace(/^(activity_|task_|reminder_)/,"");t.add("".concat(e,":").concat(n))};if(e.forEach(e=>r(e.type||"message",e.id)),(Array.isArray(Gt)?Gt:[]).forEach(n=>{const s=["message","task","reminder"].includes(n.type)?n.type:"message",a="".concat(s,":").concat(n.id);t.has(a)||(e.push({id:"activity_".concat(n.id),type:s||"message",subject:n.subject||n.title||"Activity Update",description:n.description||n.content,user:n.user||n.userName||"Unknown User",timestamp:n.createdAt||n.timestamp,projectId:n.projectId,projectName:n.projectName,priority:n.priority||"medium",metadata:n.metadata||null}),r(s,n.id))}),(Array.isArray(Jt)?Jt:[]).forEach(n=>{const s="task:".concat(n.id);var a;t.has(s)||(e.push({id:"task_".concat(n.id),type:"task",subject:n.title||n.subject||"Task",description:n.description||n.content,user:n.assignedToUser?"".concat(n.assignedToUser.firstName," ").concat(n.assignedToUser.lastName):n.assignedTo||"Unassigned",timestamp:n.createdAt||n.timestamp||n.dueDate||(new Date).toISOString(),projectId:n.projectId,projectName:(null===(a=n.project)||void 0===a?void 0:a.name)||n.projectName,priority:n.priority||"medium",status:n.status,dueDate:n.dueDate,author:n.author||"System",assignedTo:n.assignedTo||(n.assignedToUser?"".concat(n.assignedToUser.firstName," ").concat(n.assignedToUser.lastName):void 0)}),r("task",n.id))}),(Array.isArray(Yt)?Yt:[]).forEach(n=>{const s="reminder:".concat(n.id);var a;t.has(s)||(e.push({id:"reminder_".concat(n.id),type:"reminder",subject:n.title||n.subject||"Reminder",description:n.description||n.content,user:n.createdByUser?"".concat(n.createdByUser.firstName," ").concat(n.createdByUser.lastName):"Unknown User",timestamp:n.createdAt||n.timestamp||n.when||n.startDate||(new Date).toISOString(),projectId:n.projectId,projectName:(null===(a=n.project)||void 0===a?void 0:a.name)||n.projectName,priority:n.priority||"medium",when:n.startDate||n.when,authorId:n.createdBy||n.organizerId||n.authorId||(null===y||void 0===y?void 0:y.id)||null,recipients:Array.isArray(n.userIds)?n.userIds:["all"]}),r("reminder",n.id))}),console.log("\ud83d\udd0d FEEDBACK DEBUG: realFeedback:",zt),Array.isArray(zt)&&zt.length>0?(console.log("\ud83d\udd0d FEEDBACK DEBUG: Adding",zt.length,"feedback items to activity feed"),zt.forEach(n=>{const s="feedback:".concat(n.id);var a;t.has(s)||(console.log("\ud83d\udd0d FEEDBACK DEBUG: Adding feedback item:",n.title),e.push({id:"feedback_".concat(n.id),type:"feedback",title:n.title,subject:n.title,content:n.description,description:n.description,user:n.author?"".concat(n.author.firstName," ").concat(n.author.lastName):"Anonymous",timestamp:n.createdAt||n.timestamp||(new Date).toISOString(),projectId:n.projectId,projectName:n.projectName,priority:n.severity||"medium",feedbackType:n.type,severity:n.severity,status:n.status,voteCount:n.voteCount||0,commentCount:n.commentCount||0,authorId:n.authorId||(null===(a=n.author)||void 0===a?void 0:a.id),tags:n.tags||[]}),r("feedback",n.id))})):console.log("\ud83d\udd0d FEEDBACK DEBUG: No feedback data available"),0===e.length){const e=yi(x||[]);return Array.isArray(e)?e:[]}const n=e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));return console.log("\ud83d\udd0d ACTIVITY FEED DEBUG: Final items count:",n.length),console.log("\ud83d\udd0d ACTIVITY FEED DEBUG: Items by type:",n.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{})),n}catch(e){console.error("Error building activity feed:",e);const t=yi(x||[]);return Array.isArray(t)?t:[]}},[Tt,Lt,Ft,Bt,x,y]),Xt=Qt&&Qt.length>0?Qt:Ma,$t=(0,o.useMemo)(()=>{let e=Qt;return Et&&(e=e.filter(e=>e.type===Et)),jt&&(e=e.filter(e=>String(e.projectId)===String(jt))),e},[Qt,Et,jt]),Zt=function(e){n&&n(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Profile",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Dashboard",arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)},[er,tr]=(0,o.useState)(""),[rr,nr]=((0,o.useMemo)(()=>{const e={};return(bi||[]).forEach(t=>{e[t.id]=[]}),(x||[]).forEach(t=>{const r=Bn.getProjectPhase(t)||"LEAD";e[r]||(e[r]=[]),e[r].push(t)}),e},[x]),(0,o.useState)(1)),[sr,ar]=(0,o.useState)({key:null,direction:"asc"}),[or,ir]=(0,o.useState)({key:"timestamp",direction:"desc"}),[lr,cr]=(0,o.useState)(new Set),[dr,ur]=(0,o.useState)(null),[hr,mr]=(0,o.useState)(new Set),[pr,gr]=(0,o.useState)(!1),[fr,xr]=(0,o.useState)(new Set),[vr,yr]=(0,o.useState)(new Set),[br,wr]=(0,o.useState)(new Set);console.log("\ud83d\udd0d DASHBOARD: currentUser from hook:",y),console.log("\ud83d\udd0d DASHBOARD: assignableUsers length:",null===w||void 0===w?void 0:w.length),console.log("\ud83d\udd0d DASHBOARD: usersForUi length:",null===C||void 0===C?void 0:C.length),console.log("\ud83d\udd0d DASHBOARD: subjects from context:",v);const jr=e=>{const t=new Set(hr);if(t.has(e))t.delete(e);else{t.add(e);const r=Qt.find(t=>t.id===e);r&&"reminder"===r.type?He[e]&&0!==He[e].length||(async e=>{if(!Qe["reminder_".concat(e)]){Xe(t=>(0,Y.A)((0,Y.A)({},t),{},{["reminder_".concat(e)]:!0}));try{const t=await Ds.default.get("/calendar-events/".concat(e,"/comments"));t.data.success&&t.data.data&&qe(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t.data.data.map(e=>({id:e.id,content:e.content,userName:e.user?"".concat(e.user.firstName," ").concat(e.user.lastName):"Unknown User",userId:e.userId,createdAt:e.createdAt}))}))}catch(t){console.error("Error fetching reminder comments:",t)}finally{Xe(t=>(0,Y.A)((0,Y.A)({},t),{},{["reminder_".concat(e)]:!1}))}}})(e):Be[e]&&0!==Be[e].length||(async e=>{if(!Qe[e]){Xe(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!0}));try{const t=await fetch("/api/tasks/".concat(e,"/comments"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(t.ok){const r=await t.json();r.success&&r.data&&We(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:r.data.map(e=>({id:e.id,text:e.content||e.text,user:e.user?"".concat(e.user.firstName," ").concat(e.user.lastName):"Unknown User",userId:e.userId,timestamp:e.createdAt||e.timestamp}))}))}else 404===t.status&&console.log("Task ".concat(e," not found, skipping comment fetch"))}catch(t){console.error("Error fetching comments:",t)}finally{Xe(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!1}))}}})(e)}mr(t);const r=$t.length,n=t.size;gr(n===r)},Nr=e=>{const t=new Set(fr);if(t.has(e)){t.delete(e);const r=new Set(vr);r.delete(e),yr(r);const n=new Set(br);n.delete(e),wr(n)}else t.add(e);xr(t)},Sr=e=>{const t=new Set(vr);if(t.has(e)){t.delete(e);const r=new Set(br);r.delete(e),wr(r)}else t.add(e);yr(t)},kr=e=>{const t=new Set(br);t.has(e)?t.delete(e):t.add(e),wr(t)};(0,o.useEffect)(()=>{nr(1)},[O]),(0,o.useEffect)(()=>{const e=e=>{"Escape"===e.key&&fr.size>0&&xr(new Set)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[fr.size]);return(0,kt.jsx)(Rn,{children:(0,kt.jsxs)("div",{className:"min-h-screen bg-gray-100 text-gray-900",children:[(0,kt.jsx)(Ta,{projects:x||p,PROJECT_PHASES:bi,colorMode:a,onProjectSelect:Zt,selectedPhase:dr,setSelectedPhase:ur,sortConfig:sr,handleProjectSort:e=>{ar({key:e,direction:sr.key===e&&"asc"===sr.direction?"desc":"asc"})},projectsLoading:d,projectsError:u,refetchProjects:h,expandedPhases:lr,teamMembers:C}),(0,kt.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-start overflow-visible",children:[(0,kt.jsxs)("div",{className:"w-full lg:flex-1 flex flex-col gap-6","data-section":"project-messages",children:[(0,kt.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-soft rounded-2xl p-6 relative overflow-visible",children:[(0,kt.jsx)(ua,{activeCommTab:q,setActiveCommTab:K,expandedMessages:hr,activityFeedItems:Qt}),(0,kt.jsx)(ha,{activeCommTab:q,projects:p,availableUsers:C,messagesProjectFilter:$,messagesUserFilter:Q,tasksProjectFilter:re,tasksUserFilter:ee,remindersProjectFilter:oe,remindersUserFilter:se,setMessagesProjectFilter:Z,setMessagesUserFilter:X,setTasksProjectFilter:ne,setTasksUserFilter:te,setRemindersProjectFilter:ie,setRemindersUserFilter:ae,activityFeedItems:Qt,expandedMessages:hr,handleExpandAllMessages:()=>{let e=[];"messages"===q?e=Qt.filter(e=>"message"===e.type):"tasks"===q?e=Qt.filter(e=>"task"===e.type):"reminders"===q&&(e=Qt.filter(e=>"reminder"===e.type));const t=new Set(e.map(e=>e.id));mr(t),gr(!0)},handleCollapseAllMessages:()=>{mr(new Set),gr(!1)}}),(0,kt.jsx)(wa,{activeCommTab:q,colorMode:a,showMessageDropdown:dt,setShowMessageDropdown:ut,projects:p,availableUsers:C,usersLoading:N,subjects:v,currentUser:y,newMessageProject:ht,setNewMessageProject:mt,newMessageSubject:pt,setNewMessageSubject:gt,newMessageCustomSubject:ft,setNewMessageCustomSubject:xt,newMessageText:vt,setNewMessageText:yt,newMessageRecipients:bt,setNewMessageRecipients:wt,quickTaskSubject:be,setQuickTaskSubject:we,quickTaskDescription:je,setQuickTaskDescription:Ne,quickTaskDue:Se,setQuickTaskDue:ke,quickTaskAssignAll:Ae,setQuickTaskAssignAll:Ce,quickTaskAssigneeId:Ee,setQuickTaskAssigneeId:Pe,tasksProjectFilter:re,setTasksProjectFilter:ne,reminderTitle:et,setReminderTitle:tt,reminderDescription:rt,setReminderDescription:nt,reminderWhen:st,setReminderWhen:at,reminderAllUsers:ot,setReminderAllUsers:it,reminderUserIds:lt,setReminderUserIds:ct,remindersProjectFilter:oe,setRemindersProjectFilter:ie,setMessagesData:P,setFeed:Dt,uiProjects:x,taskTiming:Ie,setTaskTiming:Te,taskFollowUpTiming:De,setTaskFollowUpTiming:Me,reminderTiming:_e,setReminderTiming:Oe,reminderFollowUpTiming:Le,setReminderFollowUpTiming:Re}),(0,kt.jsxs)("div",{className:"space-y-2 mt-3 max-h-[480px] overflow-y-auto pr-1 custom-scrollbar",children:[(0,kt.jsx)(sa,{activeCommTab:q,activityFeedItems:Xt,projects:p,colorMode:a,expandedMessages:hr,messagesProjectFilter:$,messagesUserFilter:Q,handleToggleMessage:jr,handleProjectSelectWithScroll:Zt,handleQuickReply:async(e,t)=>{try{null!==Ds.projectMessagesService&&void 0!==Ds.projectMessagesService&&Ds.projectMessagesService.sendQuickReply?(await Ds.projectMessagesService.sendQuickReply(e,t),Vr.success("Reply sent")):(console.log("Quick reply:",{messageId:e,text:t}),Vr.success("Reply posted"))}catch(ES){console.error("Failed to send quick reply:",ES),Vr.error("Failed to send reply")}}}),(0,kt.jsx)(aa,{activeCommTab:q,activityFeedItems:Jt,projects:p,colorMode:a,expandedMessages:hr,completedTasks:Fe,tasksProjectFilter:re,tasksUserFilter:ee,showCompletedTasks:G,setShowCompletedTasks:J,handleToggleMessage:jr,handleTaskToggle:$e,handleProjectSelectWithScroll:Zt,availableUsers:C,currentUser:y,taskComments:Be,newCommentText:ze,setNewCommentText:Ve,handleAddComment:Ze}),(0,kt.jsx)(oa,{activeCommTab:q,activityFeedItems:Yt,projects:p,colorMode:a,expandedMessages:hr,completedTasks:Fe,remindersProjectFilter:oe,remindersUserFilter:se,availableUsers:C,currentUser:y,handleToggleMessage:jr,handleTaskToggle:$e,handleProjectSelectWithScroll:Zt,reminderComments:He,showCommentInput:Ke,setShowCommentInput:Ge,commentInputs:Je,setCommentInputs:Ye,handleAddReminderComment:async e=>{var t;const r=null===(t=Je[e])||void 0===t?void 0:t.trim();if(!r)return;const n={content:r,userName:y.firstName?"".concat(y.firstName," ").concat(y.lastName):"You",userId:y.id,createdAt:(new Date).toISOString()};try{(await Ds.default.post("/calendar-events/".concat(e,"/comments"),{content:r})).data.success?(qe(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:[...t[e]||[],n]})),Ye(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:""})),Ge(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!1})),Vr.success("Comment added to reminder")):Vr.error("Failed to add comment")}catch(s){console.error("Error adding reminder comment:",s),Vr.error("Failed to add comment")}}})]})]}),(0,kt.jsx)("div",{className:"w-full lg:flex-1",children:(0,kt.jsx)(da,{projects:p,colorMode:a,onProjectSelect:n,workflowAlerts:Ot,alertsLoading:_t,availableUsers:C,currentUser:y,handleProjectSelectWithScroll:Zt})})]}),(0,kt.jsx)("div",{className:"w-full",children:(0,kt.jsx)(na,{activityFeedItems:Qt,projects:p,colorMode:a,expandedMessages:hr,completedTasks:Fe,activityProjectFilter:jt,activityTypeFilter:Et,setActivityProjectFilter:Nt,setActivityTypeFilter:Pt,handleToggleMessage:jr,handleTaskToggle:$e,handleProjectSelectWithScroll:Zt,availableUsers:C,currentUser:y,taskComments:Be,newCommentText:ze,setNewCommentText:Ve,handleAddComment:Ze})})]}),Array.from(fr).map(e=>{const t=null===m||void 0===m?void 0:m.find(t=>t.id===e);if(!t)return null;wi(t);return(0,kt.jsxs)(kt.Fragment,{children:[fr.has(e)&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>Nr(e)}),(0,kt.jsx)(ja,{open:fr.has(e),onClose:()=>Nr(e),project:t,colorMode:a,getProjectProgress:wi,expandedTrades:vr,toggleTrades:Sr,expandedAdditionalTrades:br,toggleAdditionalTrades:kr})]})})]})})},Ni=e=>{let{isOpen:t,onClose:r,title:n,children:s,colorMode:a}=e;return t?(0,kt.jsx)("div",{className:"fixed inset-0 bg-blue-900/30 backdrop-blur-sm z-[99999] flex justify-center items-center p-4 overflow-y-auto",children:(0,kt.jsxs)("div",{className:"".concat(a?"bg-slate-800":"bg-white"," rounded-lg shadow-xl w-full max-w-lg max-h-full overflow-hidden my-4"),children:[(0,kt.jsxs)("div",{className:"p-2 lg:p-3 border-b flex justify-between items-center sticky top-0 ".concat(a?"bg-slate-800 border-slate-600":"bg-white border-gray-200"," z-10"),children:[(0,kt.jsx)("h3",{className:"text-sm lg:text-base font-bold truncate flex-1 mr-2 ".concat(a?"text-white":"text-gray-900"),children:n}),(0,kt.jsx)("button",{onClick:r,className:"".concat(a?"text-gray-400 hover:text-gray-200":"text-gray-400 hover:text-gray-600"," flex-shrink-0"),children:(0,kt.jsx)($r,{className:"w-4 h-4 lg:w-5 lg:h-5"})})]}),(0,kt.jsx)("div",{className:"p-2 lg:p-3 overflow-y-auto max-h-[calc(100vh-150px)]",children:s})]})}):null},Si=e=>{let{value:t,onChange:r,onPlaceSelect:n,placeholder:s="Enter address",className:a="",disabled:i=!1,required:l=!1,name:c="address",id:d=null}=e;const u=(0,o.useRef)(null),[h,m]=(0,o.useState)(!1),[p,g]=(0,o.useState)(null),[f,x]=(0,o.useState)([]),[v,y]=(0,o.useState)(!1),[b,w]=(0,o.useState)(-1);(0,o.useEffect)(()=>{j()},[]);const j=()=>{const e="AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM";console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Starting Google Maps API load"),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: API Key exists:",!0),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: API Key value:",e?"".concat(e.substring(0,10),"..."):"undefined"),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: All env vars:",Object.keys({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}).filter(e=>e.includes("GOOGLE"))),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Using Places API (New) REST endpoints"),m(!0),N()},N=()=>{if(console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Initializing Places API (New) REST endpoints"),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: inputRef.current exists:",!!u.current),u.current)try{console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Places API (New) REST endpoints ready")}catch(ES){console.error("Error initializing Places API (New):",ES),g("Failed to initialize address autocomplete")}else console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Input ref not available")},S=async e=>{try{console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Fetching suggestions from Places API (New)");const t=await fetch("https://places.googleapis.com/v1/places:autocomplete",{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM","X-Goog-FieldMask":"places.displayName,places.formattedAddress,places.id"},body:JSON.stringify({input:e,includedRegionCodes:["US"],languageCode:"en",regionCode:"US"})});if(t.ok){const e=await t.json();if(console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Places API (New) response:",e),e.suggestions&&e.suggestions.length>0){const t=e.suggestions.map(e=>{var t,r,n,s,a,o,i,l,c,d,u,h;return{place_id:(null===(t=e.placePrediction)||void 0===t?void 0:t.placeId)||(null===(r=e.placePrediction)||void 0===r?void 0:r.id),description:(null===(n=e.placePrediction)||void 0===n||null===(s=n.text)||void 0===s?void 0:s.text)||(null===(a=e.placePrediction)||void 0===a||null===(o=a.displayName)||void 0===o?void 0:o.text),structured_formatting:{main_text:(null===(i=e.placePrediction)||void 0===i||null===(l=i.text)||void 0===l?void 0:l.text)||(null===(c=e.placePrediction)||void 0===c||null===(d=c.displayName)||void 0===d?void 0:d.text),secondary_text:(null===(u=e.placePrediction)||void 0===u||null===(h=u.structuredFormat)||void 0===h?void 0:h.secondaryText)||""}}});x(t),y(!0),w(-1)}else x([]),y(!1)}else console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Places API (New) error:",t.status,t.statusText),x([]),y(!1)}catch(p){console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Places API (New) fetch error:",p),x([]),y(!1)}},k=e=>{const t=e.description;r({target:{name:c,value:t}}),y(!1),x([]),e.place_id&&A(e.place_id)},A=async e=>{try{console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Fetching place details from Places API (New)");const r=await fetch("https://places.googleapis.com/v1/places/".concat(e),{method:"GET",headers:{"X-Goog-Api-Key":"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM","X-Goog-FieldMask":"displayName,formattedAddress,location,addressComponents,id,types"}});if(r.ok){const e=await r.json();var t;if(console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Place details response:",e),n)n({formattedAddress:e.formattedAddress,geometry:{location:e.location},addressComponents:e.addressComponents,placeId:e.id,name:null===(t=e.displayName)||void 0===t?void 0:t.text,types:e.types})}else console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Place details error:",r.status,r.statusText)}catch(p){console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Place details fetch error:",p)}};return(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("input",{ref:u,type:"text",name:c,id:d||c,value:t,onChange:e=>{const t=e.target.value;r(e),g(null),t.length>2?S(t):(x([]),y(!1))},onKeyDown:e=>{if(v&&0!==f.length)switch(e.key){case"ArrowDown":e.preventDefault(),w(e=>e<f.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),w(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),b>=0&&b<f.length&&k(f[b]);break;case"Escape":y(!1),w(-1)}},onBlur:()=>{setTimeout(()=>{y(!1),w(-1)},200)},placeholder:s,disabled:i,required:l,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ".concat(p?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"," ").concat(a),autoComplete:"off"}),v&&f.length>0&&(0,kt.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:f.map((e,t)=>{var r,n;return(0,kt.jsx)("div",{className:"px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ".concat(t===b?"bg-blue-50 text-blue-700":"hover:bg-gray-50"),onClick:()=>k(e),children:(0,kt.jsxs)("div",{className:"flex items-start gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4 mt-0.5 text-gray-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:(null===(r=e.structured_formatting)||void 0===r?void 0:r.main_text)||e.description}),(null===(n=e.structured_formatting)||void 0===n?void 0:n.secondary_text)&&(0,kt.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.structured_formatting.secondary_text})]})]})},e.place_id)})}),!h&&!p&&(0,kt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,kt.jsx)("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),p&&(0,kt.jsxs)("div",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),p]}),h&&(0,kt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]})},ki=["title","titleId"];function Ai(e,t){let{title:r,titleId:n}=e,s=Sn(e,ki);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const Ci=o.forwardRef(Ai),Ei=()=>{const[e,t]=(0,o.useState)([]),r=(0,o.useRef)(null),n="nav_history";(0,o.useEffect)(()=>{try{const e=sessionStorage.getItem(n);if(e){const r=JSON.parse(e);Array.isArray(r)&&t(r)}}catch(e){console.warn("Failed to load navigation history:",e),sessionStorage.removeItem(n)}},[]),(0,o.useEffect)(()=>{try{sessionStorage.setItem(n,JSON.stringify(e))}catch(t){console.warn("Failed to save navigation history:",t)}},[e]);const s=(0,o.useCallback)(()=>{const e={x:window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,y:window.scrollY||window.pageYOffset||document.documentElement.scrollTop},t={};document.querySelectorAll("input, select, textarea").forEach(e=>{if(e.name||e.id){const r=e.name||e.id;"checkbox"===e.type||"radio"===e.type?t[r]=e.checked:t[r]=e.value}});const r=[];return document.querySelectorAll('[data-selected="true"], .selected, .active').forEach(e=>{(e.dataset.projectId||e.dataset.itemId||e.id)&&r.push({selector:e.dataset.projectId?'[data-project-id="'.concat(e.dataset.projectId,'"]'):e.dataset.itemId?'[data-item-id="'.concat(e.dataset.itemId,'"]'):"#".concat(e.id),type:"active"})}),{scrollPosition:e,formData:t,activeElements:r,timestamp:Date.now()}},[]),a=(0,o.useCallback)(e=>{e&&(e.scrollPosition&&(setTimeout(()=>{window.scrollTo({left:e.scrollPosition.x,top:e.scrollPosition.y,behavior:"auto"})},50),setTimeout(()=>{window.scrollTo({left:e.scrollPosition.x,top:e.scrollPosition.y,behavior:"smooth"})},200)),e.formData&&Object.entries(e.formData).forEach(e=>{let[t,r]=e;const n=document.querySelector('[name="'.concat(t,'"], #').concat(t));n&&("checkbox"===n.type||"radio"===n.type?n.checked=r:n.value=r,n.dispatchEvent(new Event("change",{bubbles:!0})))}),e.activeElements&&setTimeout(()=>{e.activeElements.forEach(e=>{let{selector:t,type:r}=e;const n=document.querySelector(t);n&&"active"===r&&(n.classList.add("selected","active"),n.dataset.selected="true")})},100))},[]),i=(0,o.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=s(),i={id:Date.now().toString(),pageName:e,pageData:n,pageState:(0,Y.A)((0,Y.A)({},o),a),timestamp:Date.now(),url:window.location.href,pathname:window.location.pathname,search:window.location.search};t(e=>[...e,i].slice(-50)),r.current=i},[s]),l=(0,o.useCallback)(()=>{if(0===e.length)return window.history.back(),null;t(e=>e.slice(0,-1));const n=e[e.length-2]||e[e.length-1];return n?(r.current=n,setTimeout(()=>{a(n.pageState)},100),{pageName:n.pageName,pageData:n.pageData,pageState:n.pageState}):null},[e,a]),c=(0,o.useCallback)(()=>{if(e.length<2)return null;const t=e[e.length-2];return{pageName:t.pageName,pageData:t.pageData,pageState:t.pageState}},[e]),d=(0,o.useCallback)(()=>e.length>1,[e]),u=(0,o.useCallback)(()=>{t([]),r.current=null;try{sessionStorage.removeItem(n)}catch(e){console.warn("Failed to clear navigation history:",e)}},[]),h=(0,o.useCallback)(e=>{if(r.current){const n=(0,Y.A)((0,Y.A)((0,Y.A)({},r.current.pageState),e),{},{timestamp:Date.now()});r.current.pageState=n,t(e=>{const t=[...e];return t.length>0&&(t[t.length-1].pageState=n),t})}},[]),m=(0,o.useCallback)(()=>r.current,[]),p=(0,o.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=s(),i={id:Date.now().toString(),pageName:e,pageData:n,pageState:(0,Y.A)((0,Y.A)({},o),a),timestamp:Date.now(),url:window.location.href,pathname:window.location.pathname,search:window.location.search};t(e=>{const t=[...e];return t.length>0?t[t.length-1]=i:t.push(i),t}),r.current=i},[s]),g=(0,o.useCallback)(()=>e.map(e=>({id:e.id,pageName:e.pageName,timestamp:e.timestamp,url:e.url})),[e]);return{pushNavigation:i,goBack:l,getPrevious:c,canGoBack:d,clearHistory:u,updateCurrentPageState:h,getCurrentPage:m,replaceNavigation:p,capturePageState:s,restorePageState:a,getBreadcrumbs:g,history:e,historyLength:e.length}},Pi=(0,o.createContext)(),Ii="SET_CONTEXT",Ti="CLEAR_CONTEXT",Di="UPDATE_SCROLL_POSITION",Mi="SET_FILTERS",_i="SET_EXPANDED_STATE",Oi="PUSH_NAVIGATION",Li="POP_NAVIGATION",Ri={navigationStack:[],currentContext:null,scrollPositions:{},expandedStates:{},filters:{}};function Fi(e,t){switch(t.type){case Oi:return(0,Y.A)((0,Y.A)({},e),{},{navigationStack:[...e.navigationStack,t.payload],currentContext:t.payload});case Li:const r=[...e.navigationStack];return r.pop(),(0,Y.A)((0,Y.A)({},e),{},{navigationStack:r,currentContext:r[r.length-1]||null});case Ii:return(0,Y.A)((0,Y.A)({},e),{},{currentContext:(0,Y.A)((0,Y.A)({},e.currentContext),t.payload)});case Ti:return(0,Y.A)((0,Y.A)({},e),{},{navigationStack:[],currentContext:null});case Di:return(0,Y.A)((0,Y.A)({},e),{},{scrollPositions:(0,Y.A)((0,Y.A)({},e.scrollPositions),{},{[t.payload.contextId]:t.payload.position})});case Mi:return(0,Y.A)((0,Y.A)({},e),{},{filters:(0,Y.A)((0,Y.A)({},e.filters),{},{[t.payload.contextId]:t.payload.filters})});case _i:return(0,Y.A)((0,Y.A)({},e),{},{expandedStates:(0,Y.A)((0,Y.A)({},e.expandedStates),{},{[t.payload.contextId]:t.payload.state})});default:return e}}function Ui(e){let{children:t}=e;const[r,n]=(0,o.useReducer)(Fi,Ri),s=F(),a=Ei(),i=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=Date.now(),n=JSON.stringify(t);return"".concat(e,"_").concat(r,"_").concat(btoa(n).slice(0,10))},[]),l=(0,o.useCallback)(e=>{const t=i(e.section,e),r=(0,Y.A)((0,Y.A)({},e),{},{contextId:t,timestamp:Date.now()});return n({type:Oi,payload:r}),t},[i]),c=(0,o.useCallback)((e,t)=>{if(r.currentContext){const e=window.scrollY;n({type:Di,payload:{contextId:r.currentContext.contextId,position:e}})}const o=l(t);return a.pushNavigation(t.section||"Unknown Page",{contextId:o,contextData:t,path:e},{contextNavigation:!0,originalContextId:o}),s(e),o},[r.currentContext,l,s,a]),d=(0,o.useCallback)(()=>{if(a.canGoBack()){var e;const t=a.goBack();if(null!==t&&void 0!==t&&null!==(e=t.pageData)&&void 0!==e&&e.contextNavigation){const e=t.pageData.contextData;if(null!==e&&void 0!==e&&e.returnPath)return void s(e.returnPath)}return}if(0===r.navigationStack.length)return void s(-1);n({type:Li});const t=r.navigationStack[r.navigationStack.length-2];t?(s(t.returnPath),setTimeout(()=>{const e=r.scrollPositions[t.contextId];void 0!==e&&window.scrollTo(0,e)},100)):s("/dashboard")},[r.navigationStack,r.scrollPositions,s,a]),u=(0,o.useCallback)(e=>{r.currentContext&&n({type:Di,payload:{contextId:r.currentContext.contextId,position:e||window.scrollY}})},[r.currentContext]),h=(0,o.useCallback)(e=>{r.currentContext&&n({type:Mi,payload:{contextId:r.currentContext.contextId,filters:e}})},[r.currentContext]),m=(0,o.useCallback)(e=>r.filters[e]||{},[r.filters]),p=(0,o.useCallback)(e=>{r.currentContext&&n({type:_i,payload:{contextId:r.currentContext.contextId,state:e}})},[r.currentContext]),g=(0,o.useCallback)(e=>r.expandedStates[e]||{},[r.expandedStates]),f=(0,o.useCallback)(()=>{n({type:Ti})},[]),x=(0,o.useCallback)(()=>r.navigationStack.length<2?null:r.navigationStack[r.navigationStack.length-2],[r.navigationStack]),v=(0,o.useCallback)(()=>r.navigationStack.length>0||a.canGoBack(),[r.navigationStack,a]),y={currentContext:r.currentContext,navigationStack:r.navigationStack,scrollPositions:r.scrollPositions,expandedStates:r.expandedStates,filters:r.filters,navigateWithContext:c,navigateBack:d,pushNavigationContext:l,clearNavigationContext:f,updateScrollPosition:u,saveFilters:h,getSavedFilters:m,saveExpandedState:p,getSavedExpandedState:g,getPreviousContext:x,canNavigateBack:v,createContextId:i,historyManager:a,navigationHistory:a.history,canGoBackInHistory:a.canGoBack,clearNavigationHistory:a.clearHistory,getBreadcrumbs:a.getBreadcrumbs};return(0,kt.jsx)(Pi.Provider,{value:y,children:t})}function Bi(){const e=(0,o.useContext)(Pi);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}const Wi=["className","colorMode","showNavigationInfo","navigationContext"],zi=["className","colorMode"],Vi=["className","colorMode"],Hi=["className","showLabel","colorMode"],qi=["position","colorMode"],Ki=["colorMode"],Gi=["showBreadcrumbs","colorMode"],Ji=(0,o.memo)(e=>{let{className:t="",variant:r="default",showLabel:n=!0,customLabel:s=null,onClick:a=null,disabled:o=!1,colorMode:i=!1,size:l="medium",preservePosition:c=!0}=e;const{navigateBack:d,canNavigateBack:u,currentContext:h,getPreviousContext:m}=Bi(),{goBack:p,getPrevious:g,canGoBack:f,restorePageState:x,capturePageState:v}=Ei(),y=o||!a&&!u()&&!f(),b=(()=>{if(s)return s;if(!n)return null;const e=g();if(null!==e&&void 0!==e&&e.pageName&&c)return"Back to ".concat(e.pageName);const t=m();if(!t)return"Back to Dashboard";switch(t.section){case"Current Projects by Phase":return t.selectedPhase?"Back to ".concat(t.selectedPhase," Projects"):"Back to Projects by Phase";case"My Project Messages":return"message"===t.type&&t.selectedData?"Back to Messages":"Back to Project Messages";case"Current Alerts":return"alert"===t.type&&t.selectedData?"Back to Alerts":"Back to Current Alerts";case"Current Project Access":return"project-cube"===t.type&&t.selectedData,"Back to Project Access";default:return"Back"}})();return(0,kt.jsxs)("button",{type:"button",onClick:()=>{if(a)return c&&v(),void a();if(c&&f()){if(p())return}u()?d():window.history.back()},disabled:y,className:"".concat((()=>{const e="inline-flex items-center transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 ".concat((()=>{switch(l){case"small":return"px-2 py-1 text-xs";case"large":return"px-5 py-3 text-base";default:return"px-3 py-2 text-sm"}})());switch(r){case"primary":return"".concat(e," ").concat(i?"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white focus:ring-blue-500 disabled:bg-slate-600":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white focus:ring-blue-500 disabled:bg-gray-300"," rounded-lg disabled:cursor-not-allowed");case"secondary":return"".concat(e," ").concat(i?"bg-slate-600 hover:bg-slate-700 text-white focus:ring-slate-500 disabled:bg-slate-800 disabled:text-slate-500":"bg-gray-200 hover:bg-gray-300 text-gray-700 focus:ring-gray-500 disabled:bg-gray-100 disabled:text-gray-400"," rounded-lg disabled:cursor-not-allowed");case"ghost":return"".concat(e," ").concat(i?"text-slate-300 hover:text-white hover:bg-slate-700 focus:ring-slate-500 disabled:text-slate-600":"text-gray-600 hover:text-gray-800 hover:bg-gray-100 focus:ring-gray-500 disabled:text-gray-400"," rounded disabled:cursor-not-allowed");case"minimal":return"".concat(e," ").concat(i?"text-blue-400 hover:text-blue-300 focus:ring-blue-500 disabled:text-slate-600":"text-blue-600 hover:text-blue-800 focus:ring-blue-500 disabled:text-gray-400"," disabled:cursor-not-allowed");default:return"".concat(e," ").concat(i?"bg-slate-700 border border-slate-600 text-slate-200 hover:bg-slate-600 hover:border-slate-500 focus:ring-blue-500 disabled:bg-slate-800 disabled:border-slate-700 disabled:text-slate-500":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400 focus:ring-blue-500 disabled:bg-gray-50 disabled:border-gray-200 disabled:text-gray-400"," rounded-md disabled:cursor-not-allowed")}})()," ").concat(t),title:b||"Go back","aria-label":b||"Go back",children:[(0,kt.jsx)(Ci,{className:"".concat((()=>{switch(l){case"small":return"h-3 w-3";case"large":return"h-6 w-6";default:return"h-4 w-4"}})()," ").concat(b?"mr-2":""),"aria-hidden":"true"}),b&&(0,kt.jsx)("span",{className:"font-medium",children:b})]})}),Yi=(0,o.memo)(e=>{let{className:t="",colorMode:r=!1,showNavigationInfo:n=!1,navigationContext:s=null}=e,a=Sn(e,Wi);return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"block sm:hidden",children:(0,kt.jsx)(Ji,(0,Y.A)((0,Y.A)({},a),{},{size:"small",showLabel:!1,colorMode:r,className:"".concat(t||"")}))}),(0,kt.jsx)("div",{className:"hidden sm:block lg:hidden",children:(0,kt.jsx)(Ji,(0,Y.A)((0,Y.A)({},a),{},{size:"medium",showLabel:!0,customLabel:"Back",colorMode:r,className:"".concat(t||"")}))}),(0,kt.jsx)("div",{className:"hidden lg:block",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(Ji,(0,Y.A)((0,Y.A)({},a),{},{size:"medium",showLabel:!0,colorMode:r,className:"".concat(t||"")})),n&&s&&(0,kt.jsx)("div",{className:"text-xs ".concat(r?"text-slate-400":"text-gray-500"),children:s.canGoBack?(0,kt.jsxs)("span",{children:["\u2190 Back to ",s.previousPage]}):(0,kt.jsx)("span",{children:"\u2190 Back to Dashboard"})})]})})]})}),Qi=(0,o.memo)(e=>{let{className:t="",colorMode:r=!1}=e,n=Sn(e,zi);return(0,kt.jsx)(Ji,(0,Y.A)({variant:"ghost",size:"medium",colorMode:r,className:"mr-4 ".concat(t)},n))}),Xi=(0,o.memo)(e=>{let{className:t="",colorMode:r=!1}=e,n=Sn(e,Vi);return(0,kt.jsx)(Ji,(0,Y.A)({variant:"secondary",size:"medium",colorMode:r,className:"mb-4 ".concat(t)},n))}),$i=(0,o.memo)(e=>{let{className:t="",showLabel:r=!1,colorMode:n=!1}=e,s=Sn(e,Hi);return(0,kt.jsx)(Ji,(0,Y.A)({variant:"minimal",size:"small",showLabel:r,colorMode:n,className:t},s))}),Zi=(0,o.memo)(e=>{let{position:t="top-left",colorMode:r=!1}=e,n=Sn(e,qi);return(0,kt.jsx)("div",{className:"fixed ".concat({"top-left":"top-4 left-4","top-right":"top-4 right-4","bottom-left":"bottom-4 left-4","bottom-right":"bottom-4 right-4"}[t]," z-50"),children:(0,kt.jsx)(Ji,(0,Y.A)((0,Y.A)({},n),{},{variant:"primary",size:"medium",colorMode:r,className:"shadow-lg ".concat(n.className||"")}))})}),el=(0,o.memo)(e=>{let{colorMode:t=!1}=e,r=Sn(e,Ki);return(0,kt.jsx)(Ji,(0,Y.A)((0,Y.A)({},r),{},{size:"small",showLabel:!1,variant:"ghost",colorMode:t,className:"rounded-full ".concat(r.className||"")}))}),tl=(0,o.memo)(e=>{let{className:t="",colorMode:r=!1}=e;const{currentContext:n}=Bi();if(!n)return null;return(0,kt.jsx)(Ji,{variant:(()=>{switch(n.type){case"project":return"primary";case"message":return"secondary";case"alert":return"ghost";default:return"default"}})(),colorMode:r,className:t})}),rl=(0,o.memo)(e=>{let{showBreadcrumbs:t=!1,colorMode:r=!1}=e,n=Sn(e,Gi);const{getBreadcrumbs:s}=Ei(),a=s();return(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(Ji,(0,Y.A)({colorMode:r},n)),t&&a.length>1&&(0,kt.jsx)("div",{className:"hidden md:flex items-center gap-1 text-sm ".concat(r?"text-slate-400":"text-gray-500"),children:a.slice(-3).map((e,t,n)=>(0,kt.jsxs)(o.Fragment,{children:[t>0&&(0,kt.jsx)("span",{children:"/"}),(0,kt.jsx)("span",{className:t===n.length-1?r?"font-medium text-slate-300":"font-medium text-gray-700":"",children:e.pageName})]},e.id))})]})});Ji.displayName="BackButton",Yi.displayName="ResponsiveBackButton",Qi.displayName="HeaderBackButton",Xi.displayName="CardBackButton",$i.displayName="MinimalBackButton",Zi.displayName="FloatingBackButton",el.displayName="CompactBackButton",tl.displayName="ContextAwareBackButton",rl.displayName="BreadcrumbBackButton";const nl={projectNumber:"",projectName:"",customerName:"",jobType:"",tradeTypes:[],projectManager:"",fieldDirector:"",salesRep:"",qualityInspector:"",adminAssistant:"",status:"Pending",budget:"",startDate:"",endDate:"",customer:"",address:"",priority:"Low",description:"",contacts:[{name:"",phone:"",email:"",isPrimary:!1},{name:"",phone:"",email:"",isPrimary:!1},{name:"",phone:"",email:"",isPrimary:!1}]},sl=e=>{var t,r,n,s;let{project:a,isSelected:o,onSelect:i,onProjectSelect:l,getPhaseForProject:c,getPhaseColorForProject:d,getProjectProgress:u,colorMode:h,isExpanded:m,onToggleExpansion:p,isPast:g=!1}=e;const f=c(null===a||void 0===a?void 0:a.id),x=Bn.getPhaseName(f),v=Bn.getPhaseColor(f);return(0,kt.jsxs)("div",{className:"border rounded-xl transition-all duration-300 hover:shadow-lg cursor-pointer ".concat(o?"border-blue-500 shadow-blue-100 bg-blue-50/50":"border-gray-200 hover:border-gray-300 bg-white"," ").concat(g?"opacity-75":""),children:[(0,kt.jsxs)("div",{className:"p-4",onClick:i,children:[(0,kt.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("h3",{className:"font-semibold text-gray-900 truncate",children:["#",a.projectNumber||"N/A"," - ",a.name||a.projectName||"Untitled Project"]}),(0,kt.jsx)("p",{className:"text-sm text-gray-600 truncate",children:(null===(t=a.customer)||void 0===t?void 0:t.primaryName)||"Unknown Customer"}),(null===(r=a.customer)||void 0===r?void 0:r.address)&&(0,kt.jsx)("p",{className:"text-xs text-gray-500 truncate mt-1",children:a.customer.address})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(v.bg," ").concat(v.text),children:x}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),p()},className:"p-1 hover:bg-gray-100 rounded",children:m?(0,kt.jsx)(mn,{className:"w-4 h-4"}):(0,kt.jsx)(tn,{className:"w-4 h-4"})})]})]}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Progress:"}),(0,kt.jsxs)("span",{className:"font-medium",children:[u(a),"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full bg-gradient-to-r from-brand-500 to-red-500 rounded-full transition-all duration-300",style:{width:"".concat(u(a),"%")}})})]})]}),m&&(0,kt.jsxs)("div",{className:"px-4 pb-4 border-t border-gray-100 pt-3",children:[(0,kt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Project Manager:"}),(0,kt.jsx)("span",{className:"ml-2 text-gray-900",children:a.projectManager?"".concat(a.projectManager.firstName," ").concat(a.projectManager.lastName):"Not Assigned"})]}),(null===(n=a.customer)||void 0===n?void 0:n.primaryPhone)&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Phone:"}),(0,kt.jsx)("a",{href:"tel:".concat(a.customer.primaryPhone.replace(/[^\d+]/g,"")),className:"ml-2 text-blue-600 hover:underline",children:a.customer.primaryPhone})]}),(null===(s=a.customer)||void 0===s?void 0:s.primaryEmail)&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Email:"}),(0,kt.jsx)("a",{href:"mailto:".concat(a.customer.primaryEmail),className:"ml-2 text-blue-600 hover:underline",children:a.customer.primaryEmail})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[(0,kt.jsxs)("button",{onClick:async()=>{try{const e=null===a||void 0===a?void 0:a.currentWorkflowItem,t=Sa.getCurrentLineItem(a),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||Sa.getCurrentSection(a),n=c(a.id),s=await fetch("/api/workflow-data/project-position/".concat(a.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});let o=(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0"),i="string"===typeof r?r.toLowerCase().replace(/\s+/g,"-"):r||"",d=null;if(s.ok){const e=await s.json();if(e.success&&e.data){const r=e.data;o=(null===t||void 0===t?void 0:t.id)||r.currentLineItemId||o,i=r.currentSectionId||i,d=r.workflowId||null}}const u=(0,Y.A)((0,Y.A)({},a),{},{navigationSource:a.navigationSource||"Project Profile",returnToSection:a.returnToSection||"project-profile",highlightStep:(null===t||void 0===t?void 0:t.name)||"Line Item",highlightLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",targetPhase:n,targetSection:r,targetLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",stepName:(null===t||void 0===t?void 0:t.name)||"Line Item",lineItemId:o,workflowId:d,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(o),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:i,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});l(u,"Project Workflow",null,"Project Profile",o,i)}catch(It){l(a,"Project Workflow",null,"Project Profile")}},className:"flex flex-col items-center gap-1 p-2 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all duration-200 text-xs",children:[(0,kt.jsx)("span",{children:"\ud83d\uddc2\ufe0f"}),"Workflow"]}),(0,kt.jsxs)("button",{onClick:()=>l(a,"Messages",null,"Project Profile"),className:"flex flex-col items-center gap-1 p-2 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all duration-200 text-xs",children:[(0,kt.jsx)("span",{children:"\ud83d\udcac"}),"Messages"]})]})]})]})},al=e=>{var t,r,n,s,a,i,l,c,d,u,h,m,p,g,f,x,v,y,b;let{onProjectSelect:w,onProjectActionSelect:j,onCreateProject:N,projects:S,colorMode:k,projectSourceSection:A,onNavigateBack:C,scrollToProject:E}=e;const{pushNavigation:P}=Ei(),[I,T]=(0,o.useState)(null),[D,M]=(0,o.useState)(!1),[_,O]=(0,o.useState)(nl),[L,R]=(0,o.useState)(""),[F,U]=(0,o.useState)({}),[B,W]=(0,o.useState)(0),[z,V]=(0,o.useState)(0),[H,q]=(0,o.useState)(""),[K,G]=(0,o.useState)("projectNumber"),[J,Q]=(0,o.useState)("desc"),X=(()=>{const e=Ct();return Ts({mutationFn:e=>Ds.projectsService.create(e),onSuccess:t=>{e.invalidateQueries({queryKey:xa.projects}),e.invalidateQueries({queryKey:xa.projectStats}),e.invalidateQueries({queryKey:xa.workflowAlerts}),null!==t&&void 0!==t&&t.data&&e.setQueryData(xa.project(t.data.id),t)},onError:e=>{console.error("Failed to create project:",e)}})})(),{data:$,isLoading:Z,error:ee}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Cs({queryKey:[...xa.customers,e],queryFn:()=>Ds.customersService.getAll(e),select:e=>(null===e||void 0===e?void 0:e.data)||e||[]})}({limit:100}),{data:te,isLoading:re,error:ne,refetch:se}=va({limit:100,retry:3,retryDelay:1e3,refetchOnWindowFocus:!0}),[ae,oe]=(0,o.useState)([]),[ie,le]=(0,o.useState)({}),[ce,de]=(0,o.useState)(!0),[ue,he]=(0,o.useState)({}),[me,pe]=(0,o.useState)(!0),[ge,fe]=(0,o.useState)(!1),[xe,ve]=(0,o.useState)(null),[ye,be]=(0,o.useState)(!1),{workflowStates:we,getWorkflowState:je,getPhaseForProject:Ne,getPhaseColorForProject:Se,getPhaseInitialForProject:ke,getProgressForProject:Ae}=(e=>{const[t,r]=(0,o.useState)(()=>{if(!e||!Array.isArray(e))return{};const t={};return e.forEach(e=>{e&&e.id&&(t[e.id]=Sa.getProjectWorkflowState(e))}),t});return(0,o.useEffect)(()=>{if(!e||!Array.isArray(e))return;const t={};e.forEach(e=>{e&&e.id&&(t[e.id]=Sa.getProjectWorkflowState(e))}),r(t)},[e]),(0,o.useEffect)(()=>Sa.addListener((e,t)=>{r(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))}),[]),{workflowStates:t,getWorkflowState:e=>t[e],getPhaseForProject:e=>{var r;return(null===(r=t[e])||void 0===r?void 0:r.currentPhase)||"LEAD"},getPhaseColorForProject:e=>{var r;return(null===(r=t[e])||void 0===r?void 0:r.phaseColor)||"#94A3B8"},getPhaseInitialForProject:e=>{var r;return(null===(r=t[e])||void 0===r?void 0:r.phaseInitial)||"L"},getProgressForProject:e=>{var r;return(null===(r=t[e])||void 0===r?void 0:r.overallProgress)||0}}})(te),Ce=Array.isArray(null===te||void 0===te?void 0:te.data)?te.data:Array.isArray(te)?te:[],Ee=Array.isArray($)?$:[];(0,o.useEffect)(()=>{P("Project Profile",{projectSourceSection:A,scrollToProject:E})},[P,A]),(0,o.useEffect)(()=>{!I&&Ce.length>0&&T(Ce[0])},[Ce,I]),(0,o.useEffect)(()=>{(async()=>{try{var e;const t=await Ds.usersService.getTeamMembers(),r=Array.isArray(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.teamMembers)?t.data.teamMembers:Array.isArray(null===t||void 0===t?void 0:t.data)?t.data:Array.isArray(t)?t:[];oe(r);const n={};r.forEach(e=>{e.role&&e.role.permissions&&e.role.permissions.includes("project_manager")&&(n.projectManager||(n.projectManager=e.id)),e.role&&"Field Director"===e.role.name&&!n.fieldDirector&&(n.fieldDirector=e.id),e.role&&"Sales Rep"===e.role.name&&!n.salesRep&&(n.salesRep=e.id)}),le(n)}catch(L){console.error("Error fetching users:",L),oe([])}finally{de(!1)}})()},[]),(0,o.useEffect)(()=>{let e=!0;return(async()=>{try{pe(!0);const t=await fetch("/api/lead-sources");if(!t.ok)throw new Error("Failed to load lead sources");const r=await t.json(),n=Array.isArray(null===r||void 0===r?void 0:r.data)?r.data:Array.isArray(r)?r:[],s={};n.forEach(e=>{e&&e.id&&(s[e.id]=e)}),e&&he(s)}catch(It){console.error("Error loading lead sources:",It),e&&he({})}finally{e&&pe(!1)}})(),()=>{e=!1}},[]);const{currentProjects:Pe,pastProjects:Ie}=(()=>{const e=(()=>{let e=[...Ce];if(H.trim()){const t=H.toLowerCase();e=e.filter(e=>{var r,n;return(e.projectName||e.name||"").toLowerCase().includes(t)||(e.projectNumber||"").toString().toLowerCase().includes(t)||((null===(r=e.customer)||void 0===r?void 0:r.primaryName)||"").toLowerCase().includes(t)||((null===(n=e.customer)||void 0===n?void 0:n.address)||"").toLowerCase().includes(t)})}return e.sort((e,t)=>{var r,n;let s,a;switch(K){case"projectNumber":s=Number(e.projectNumber||0),a=Number(t.projectNumber||0);break;case"startDate":s=new Date(e.startDate||0),a=new Date(t.startDate||0);break;case"customer":s=((null===(r=e.customer)||void 0===r?void 0:r.primaryName)||"").toLowerCase(),a=((null===(n=t.customer)||void 0===n?void 0:n.primaryName)||"").toLowerCase();break;default:s=(e.projectName||e.name||"").toLowerCase(),a=(t.projectName||t.name||"").toLowerCase()}if("string"===typeof s){const e=s.localeCompare(a);return"asc"===J?e:-e}if(s instanceof Date){const e=s-a;return"asc"===J?e:-e}{const e=(s||0)-(a||0);return"asc"===J?e:-e}}),e})();return{currentProjects:e.filter(e=>{const t=Ne(e.id);return"completion"!==t&&"archived"!==t}),pastProjects:e.filter(e=>{const t=Ne(e.id);return"completion"===t||"archived"===t})}})(),Te=(e,t)=>{const r=6*t,n=r+6;return e.slice(r,n)},De=e=>Math.ceil(e.length/6),Me=e=>{const t=Bn.calculateProjectProgress(e).overall||0;return Math.min(100,Math.max(0,Math.round(t)))},_e=e=>{const{name:t,value:r}=e.target;O(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:r}))},Oe=(e,t,r)=>{const n=[..._.contacts];n[e]=(0,Y.A)((0,Y.A)({},n[e]),{},{[t]:r}),"isPrimary"===t&&r&&n.forEach((t,r)=>{r!==e&&(t.isPrimary=!1)}),O(e=>(0,Y.A)((0,Y.A)({},e),{},{contacts:n}))},Le=(0,o.useRef)(null),[Re,Fe]=(0,o.useState)({entries:[]}),Ue=e=>{const t=Array.from(e||[]).map(e=>({file:e,name:e.name,size:e.size,progress:0,status:"pending",error:null,description:"",tagsString:""}));Fe({entries:t})},Be=(e,t)=>{Fe(r=>{const n=Array.isArray(r.entries)?[...r.entries]:[];return n[e]?(n[e]=(0,Y.A)((0,Y.A)({},n[e]),t),{entries:n}):r})},We=async e=>{try{var t,r,n,s,a,o,i,l,c,d;const y=await(async()=>{let e=(await _s.assetsService.listFolders({parentId:null,sortBy:"title",sortOrder:"asc",limit:1e3})).find(e=>"Projects"===(e.folderName||e.title));var t;return e||(e=await _s.assetsService.createFolder({name:"Projects",parentId:null}),"function"===typeof(null===(t=window)||void 0===t?void 0:t.dispatchEvent)&&window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:null}}))),e})();if(console.log("Projects root:",y),console.log("Root folder details:",{id:null===y||void 0===y?void 0:y.id,name:(null===y||void 0===y?void 0:y.title)||(null===y||void 0===y?void 0:y.folderName),type:null===y||void 0===y?void 0:y.type}),!y||!y.id)throw new Error("Failed to get or create Projects root folder");const b=await _s.assetsService.listFolders({parentId:y.id,sortBy:"title",sortOrder:"asc",limit:1e3});console.log("Children folders:",b);const w=(null===(t=e.customer)||void 0===t?void 0:t.primaryName)||(null===(r=e.customer)||void 0===r?void 0:r.firstName)+" "+(null===(n=e.customer)||void 0===n?void 0:n.lastName)||e.customerName||"Unknown",j="".concat(e.projectNumber," - ").concat(w);let N=b.find(e=>(e.folderName||e.title)===j);var u,h;if(!N&&e.projectNumber)console.log("\ud83d\udd0d Searching for existing project folder by project number:",e.projectNumber),N=b.find(t=>{var r;return(null===(r=t.metadata)||void 0===r?void 0:r.projectNumber)===e.projectNumber}),console.log("\ud83d\udd0d Found existing project folder by number:",!!N,(null===(u=N)||void 0===u?void 0:u.title)||(null===(h=N)||void 0===h?void 0:h.folderName));if(!N){var m,p,g,f,x,v;console.log("Creating project folder:",j);const t={projectId:e.id,projectNumber:e.projectNumber,customerName:w,address:e.projectName||e.name||"",isProjectFolder:!0};N=await _s.assetsService.createFolder({name:j,parentId:y.id,metadata:t}),console.log("\u2705 Created project folder:",N),console.log("\ud83d\udcc1 Project folder details:",{id:null===(m=N)||void 0===m?void 0:m.id,name:(null===(p=N)||void 0===p?void 0:p.title)||(null===(g=N)||void 0===g?void 0:g.folderName),parentId:null===(f=N)||void 0===f?void 0:f.parentId,metadata:null===(x=N)||void 0===x?void 0:x.metadata}),"function"===typeof(null===(v=window)||void 0===v?void 0:v.dispatchEvent)&&window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:y.id}}))}return console.log("\ud83d\udcc1 Using project folder:",{id:null===(s=N)||void 0===s?void 0:s.id,name:(null===(a=N)||void 0===a?void 0:a.title)||(null===(o=N)||void 0===o?void 0:o.folderName),projectNumber:null===(i=N)||void 0===i||null===(l=i.metadata)||void 0===l?void 0:l.projectNumber,projectId:null===(c=N)||void 0===c||null===(d=c.metadata)||void 0===d?void 0:d.projectId}),N}catch(L){throw console.error("Error in ensureProjectFolder:",L),L}},ze=e=>{U(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!t[e]}))};return re?(0,kt.jsx)("div",{className:"p-6",children:(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[...Array(6)].map((e,t)=>(0,kt.jsx)(Ba,{},t))})}):ne?(0,kt.jsx)(Wa,{message:"Failed to load projects",onRetry:se}):(0,kt.jsxs)("div",{className:"min-h-screen ".concat(k?"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900":"bg-gradient-to-br from-gray-50 via-white to-gray-100"),children:[(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[C&&(0,kt.jsx)(Yi,{onClick:C,colorMode:k,className:"mr-2"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-2",children:"Project Profile"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Comprehensive project management and customer information"})]})]}),(0,kt.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(k?"text-white":"text-gray-900"," mb-3"),children:"Documents"}),(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(k?"bg-slate-700/50":"bg-gray-50"," border ").concat(k?"border-slate-600":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("p",{className:"text-sm ".concat(k?"text-gray-300":"text-gray-700"),children:"Upload files to this project's Documents folder. Files will be saved under the Projects root so they appear in Documents & Resources."}),(0,kt.jsx)("div",{className:"mt-3",children:(0,kt.jsxs)("div",{onDrop:e=>(e=>{var t;e.preventDefault();const r=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;r&&r.length&&Ue(r)})(e),onDragOver:e=>e.preventDefault(),className:"w-full p-4 border-2 border-dashed rounded-lg text-center cursor-pointer ".concat(k?"border-slate-600 bg-slate-800/40":"border-gray-200 bg-white"),children:[(0,kt.jsx)("input",{ref:Le,type:"file",multiple:!0,className:"hidden",onChange:e=>Ue(e.target.files)}),(0,kt.jsxs)("div",{className:"text-sm text-gray-500",children:["Drag & drop files here, or ",(0,kt.jsx)("button",{onClick:()=>{var e;return null===(e=Le.current)||void 0===e?void 0:e.click()},className:"text-blue-600 underline",children:"browse"})]})]})})]}),(0,kt.jsx)("div",{className:"w-full md:w-auto flex flex-col gap-2",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>(async()=>{try{var e;if(!I||!I.id)return void Vr.error("No project selected");const t=Re.entries||[];if(0===t.length)return void Vr("No files selected");Fe(e=>({entries:e.entries.map(e=>(0,Y.A)((0,Y.A)({},e),{},{status:"uploading",progress:0,error:null}))})),Vr.loading("Uploading files..."),console.log("Ensuring project folder for project:",I),console.log("Project details:",{id:I.id,projectNumber:I.projectNumber,name:I.projectName||I.name});const r=await We(I);if(console.log("Project folder result:",r),console.log("Project folder ID for upload:",null===r||void 0===r?void 0:r.id),!r||!r.id)throw new Error("Failed to create or access project folder");for(let e=0;e<t.length;e++){const n=t[e];if("success"!==n.status){Be(e,{status:"uploading",progress:0,error:null});try{const t=(n.tagsString||"").split(",").map(e=>e.trim()).filter(Boolean),s=t=>{if(!t||!t.lengthComputable)return;const r=Math.round(t.loaded/t.total*100);Be(e,{progress:r})};console.log("\ud83d\udce4 Uploading file to project folder:",{fileName:n.name,projectFolderId:null===r||void 0===r?void 0:r.id,projectFolderName:(null===r||void 0===r?void 0:r.title)||(null===r||void 0===r?void 0:r.folderName),parentId:(null===r||void 0===r?void 0:r.id)||null});const a={files:[n.file],parentId:(null===r||void 0===r?void 0:r.id)||null,description:n.description||"",tags:t,onUploadProgress:s};console.log("\ud83d\udce4 Upload parameters:",a),await _s.assetsService.uploadFiles(a),console.log("\u2705 File uploaded successfully to project folder"),Be(e,{progress:100,status:"success"})}catch(ES){console.error("Upload failed for file",n.name,ES),Be(e,{status:"error",error:(null===ES||void 0===ES?void 0:ES.message)||"Upload failed"})}}}console.log("\ud83d\udd04 Dispatching fm:refresh event for project folder:",null===r||void 0===r?void 0:r.id),"function"===typeof(null===(e=window)||void 0===e?void 0:e.dispatchEvent)&&(window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:(null===r||void 0===r?void 0:r.id)||null}})),window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:null}}))),Vr.dismiss();const n=(Re.entries||[]).some(e=>"error"===e.status);n?Vr.error("Some files failed to upload"):Vr.success("Files uploaded and organized in project folder")}catch(ES){console.error("Upload flow failed",ES),Vr.dismiss(),Vr.error("Upload failed: ".concat((null===ES||void 0===ES?void 0:ES.message)||"Unknown error occurred")),Fe(e=>({entries:e.entries.map(e=>(0,Y.A)((0,Y.A)({},e),{},{status:"pending",progress:0,error:null}))}))}})(),className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg",children:"Upload Selected"}),(0,kt.jsx)("button",{onClick:()=>{if(I)try{const e={projectId:I.id,project:I};window.dispatchEvent(new CustomEvent("app:openProjectDocuments",{detail:e}))}catch(It){console.error("Failed to open project documents",It)}},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg",children:"Open project documents"})]})})]}),Re.entries&&Re.entries.length>0&&(0,kt.jsxs)("div",{className:"mt-3 text-sm text-gray-600",children:[(0,kt.jsx)("div",{className:"font-medium",children:"Selected files:"}),(0,kt.jsx)("ul",{className:"mt-2 space-y-2",children:Re.entries.map((e,t)=>(0,kt.jsxs)("li",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("div",{className:"truncate font-medium",children:e.name}),(0,kt.jsxs)("div",{className:"text-xs text-gray-500",children:[Math.round((e.size||0)/1024)," KB"]})]}),(0,kt.jsx)("div",{className:"w-full bg-gray-200 h-2 rounded mt-2 overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full ".concat("error"===e.status?"bg-red-500":"success"===e.status?"bg-green-500":"bg-blue-500"),style:{width:"".concat(e.progress||0,"%")}})}),(0,kt.jsxs)("div",{className:"mt-1 text-xs",children:["pending"===e.status&&(0,kt.jsx)("span",{className:"text-gray-500",children:"Pending"}),"uploading"===e.status&&(0,kt.jsxs)("span",{className:"text-blue-600",children:["Uploading \u2014 ",e.progress,"%"]}),"success"===e.status&&(0,kt.jsx)("span",{className:"text-green-600",children:"Uploaded"}),"error"===e.status&&(0,kt.jsxs)("span",{className:"text-red-600",children:["Error: ",e.error]})]}),(0,kt.jsxs)("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[(0,kt.jsx)("input",{type:"text",placeholder:"Description (optional)",value:e.description||"",onChange:e=>Be(t,{description:e.target.value}),className:"px-2 py-1 border rounded text-sm w-full",disabled:"uploading"===e.status}),(0,kt.jsx)("input",{type:"text",placeholder:"Tags (comma separated)",value:e.tagsString||"",onChange:e=>Be(t,{tagsString:e.target.value}),className:"px-2 py-1 border rounded text-sm w-full",disabled:"uploading"===e.status})]})]}),(0,kt.jsx)("div",{children:"uploading"!==e.status&&(0,kt.jsx)("button",{onClick:()=>Fe(e=>({entries:e.entries.filter((e,r)=>r!==t)})),className:"text-xs text-red-600 hover:underline",children:"Remove"})})]},t))})]})]})]}),(0,kt.jsxs)("button",{onClick:()=>{O((0,Y.A)((0,Y.A)({},nl),ie)),M(!0)},className:"flex items-center gap-3 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300 bg-gradient-to-r from-brand-500 to-red-500 text-white shadow-soft hover:shadow-medium hover:-translate-y-0.5",children:[(0,kt.jsx)("span",{className:"text-lg",children:"+"}),(0,kt.jsx)("span",{children:"Add New Project"})]})]}),I&&(0,kt.jsxs)("div",{className:"".concat(k?"bg-slate-800/90":"bg-white/90"," backdrop-blur-sm border ").concat(k?"border-slate-600/50":"border-gray-200/50"," shadow-soft rounded-2xl p-6 mb-6"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-2xl font-bold ".concat(k?"text-white":"text-gray-900"," mb-2"),children:I.projectName||I.name||"Project Details"}),(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ".concat(k?ca(I.projectType):la(I.projectType)),children:ia(I.projectType)}),(0,kt.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(Se?"".concat(null===(t=Se(I.id))||void 0===t?void 0:t.bg," ").concat(null===(r=Se(I.id))||void 0===r?void 0:r.text):"bg-gray-100 text-gray-800"),children:Bn.getPhaseName(Ne(I.id))||"Lead"})]})]}),(0,kt.jsxs)("div",{className:"text-right",children:[(0,kt.jsxs)("div",{className:"text-3xl font-bold ".concat(k?"text-white":"text-gray-900"),children:[Me(I),"%"]}),(0,kt.jsx)("div",{className:"text-sm ".concat(k?"text-gray-300":"text-gray-600"),children:"Complete"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(k?"text-white":"text-gray-900"," border-b ").concat(k?"border-slate-600":"border-gray-200"," pb-2"),children:"Customer Contact Info"}),(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(k?"bg-slate-700/50":"bg-gray-50"),children:[(0,kt.jsx)("h4",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"," mb-3"),children:"Primary Customer"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("div",{className:"font-semibold ".concat(k?"text-white":"text-gray-900"),children:(null===(n=I.customer)||void 0===n?void 0:n.primaryName)||"Not Set"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udcde"}),(0,kt.jsx)("a",{href:"tel:".concat(((null===(s=I.customer)||void 0===s?void 0:s.primaryPhone)||"").replace(/[^\d+]/g,"")),className:"text-sm ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:(null===(a=I.customer)||void 0===a?void 0:a.primaryPhone)||"Not Set"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\u2709\ufe0f"}),(0,kt.jsx)("a",{href:"mailto:".concat((null===(i=I.customer)||void 0===i?void 0:i.primaryEmail)||""),className:"text-sm ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:(null===(l=I.customer)||void 0===l?void 0:l.primaryEmail)||"Not Set"})]})]})]}),((null===(c=I.customer)||void 0===c?void 0:c.secondaryName)||(null===(d=I.customer)||void 0===d?void 0:d.secondaryPhone)||(null===(u=I.customer)||void 0===u?void 0:u.secondaryEmail))&&(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(k?"bg-slate-700/50":"bg-gray-50"),children:[(0,kt.jsx)("h4",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"," mb-3"),children:"Secondary Customer"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(null===(h=I.customer)||void 0===h?void 0:h.secondaryName)&&(0,kt.jsx)("div",{className:"font-semibold ".concat(k?"text-white":"text-gray-900"),children:I.customer.secondaryName}),(null===(m=I.customer)||void 0===m?void 0:m.secondaryPhone)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udcde"}),(0,kt.jsx)("a",{href:"tel:".concat(I.customer.secondaryPhone.replace(/[^\d+]/g,"")),className:"text-sm ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:I.customer.secondaryPhone})]}),(null===(p=I.customer)||void 0===p?void 0:p.secondaryEmail)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\u2709\ufe0f"}),(0,kt.jsx)("a",{href:"mailto:".concat(I.customer.secondaryEmail),className:"text-sm ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:I.customer.secondaryEmail})]})]})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(k?"text-white":"text-gray-900"," border-b ").concat(k?"border-slate-600":"border-gray-200"," pb-2"),children:"Project Info"}),(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(k?"bg-slate-700/50":"bg-gray-50"," space-y-3"),children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"," mb-1"),children:"Project Number"}),(0,kt.jsxs)("button",{onClick:()=>w(I,"Project Profile",null,"Project Profile"),className:"text-lg font-bold ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:["#",I.projectNumber||"Not Set"]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"," mb-1"),children:"Project Address"}),(0,kt.jsx)("div",{className:"".concat(k?"text-white":"text-gray-900"),children:((e,t)=>{const r=(null===(e=I.customer)||void 0===e?void 0:e.address)||(null===(t=I.client)||void 0===t?void 0:t.address)||I.location||I.address;if(!r||r===I.projectName)return"Address not available";const n=r.split(",");var s;return n.length>=2?(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{children:null===(s=n[0])||void 0===s?void 0:s.trim()}),(0,kt.jsx)("div",{children:n.slice(1).join(",").trim()})]}):r})()})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"," mb-1"),children:"Lead Source"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-md ".concat(k?"bg-slate-700/40":"bg-white"," border ").concat(k?"border-slate-600":"border-gray-100"),children:[(0,kt.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-md bg-gradient-to-br from-blue-50 to-blue-100 text-blue-700 font-semibold",children:"\ud83d\udd0e"}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("div",{className:"".concat(k?"text-white font-semibold":"text-gray-900 font-semibold"),children:(()=>{const e=I.leadSourceId||I.leadSource||I.lead_source;if(ge)return"";const t=e?ue[e]:null;return t?t.name||t.label||t.title:me?"Loading\u2026":"Not Set"})()}),(0,kt.jsx)("div",{className:"text-xs ".concat(k?"text-gray-300":"text-gray-500"),children:(()=>{const e=I.leadSourceId||I.leadSource||I.lead_source,t=e?ue[e]:null;return t&&t.description?t.description:""})()})]})]}),(0,kt.jsx)("div",{className:"mt-2 flex items-center gap-2",children:ge?(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("select",{value:xe||"",onChange:e=>ve(e.target.value||null),className:"px-3 py-1 text-sm rounded-md border",children:[(0,kt.jsx)("option",{value:"",children:"-- Select Lead Source --"}),Object.values(ue).map(e=>(0,kt.jsx)("option",{value:e.id,children:e.name||e.label||e.title},e.id))]}),(0,kt.jsx)("button",{onClick:async()=>{if(I&&I.id){be(!0);try{const e={leadSourceId:xe||null},t=await Ds.projectsService.update(I.id,e),r=(null===t||void 0===t?void 0:t.data)||t;T(r?e=>(0,Y.A)((0,Y.A)({},e),r):e=>(0,Y.A)((0,Y.A)({},e),{},{leadSourceId:xe})),Vr.success("Lead Source updated"),fe(!1)}catch(ES){console.error("Error updating lead source:",ES),Vr.error("Failed to update Lead Source")}finally{be(!1)}}},disabled:ye,className:"px-3 py-1 text-xs rounded-md bg-brand-500 text-white hover:bg-brand-600 disabled:opacity-60",children:ye?"Saving\u2026":"Save"}),(0,kt.jsx)("button",{onClick:()=>fe(!1),className:"px-3 py-1 text-xs rounded-md border border-gray-200 hover:bg-gray-50",children:"Cancel"})]}):(0,kt.jsx)("button",{onClick:()=>{const e=I.leadSourceId||I.leadSource||I.lead_source||null;ve(e),fe(!0)},className:"px-3 py-1 text-xs rounded-md border border-gray-200 hover:bg-gray-50",children:"Edit"})})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"," mb-1"),children:"Customer Address"}),(0,kt.jsx)("div",{className:"".concat(k?"text-white":"text-gray-900"),children:((e,t)=>{const r=(null===(e=I.customer)||void 0===e?void 0:e.address)||(null===(t=I.client)||void 0===t?void 0:t.address)||I.clientAddress;if(!r||r===I.projectName)return"Address not available";const n=r.split(",");var s;return n.length>=2?(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{children:null===(s=n[0])||void 0===s?void 0:s.trim()}),(0,kt.jsx)("div",{children:n.slice(1).join(",").trim()})]}):r})()})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"," mb-1"),children:"Project Manager"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsx)("div",{className:"font-semibold ".concat(k?"text-white":"text-gray-900"),children:null!==(g=I.projectManager)&&void 0!==g&&g.firstName&&null!==(f=I.projectManager)&&void 0!==f&&f.lastName?"".concat(I.projectManager.firstName," ").concat(I.projectManager.lastName):(null===(x=I.projectManager)||void 0===x?void 0:x.name)||"Not Assigned"}),(null===(v=I.projectManager)||void 0===v?void 0:v.phone)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udcde"}),(0,kt.jsx)("a",{href:"tel:".concat(I.projectManager.phone.replace(/[^\d+]/g,"")),className:"text-sm ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:I.projectManager.phone})]}),(null===(y=I.projectManager)||void 0===y?void 0:y.email)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\u2709\ufe0f"}),(0,kt.jsx)("a",{href:"mailto:".concat(I.projectManager.email),className:"text-sm ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:I.projectManager.email})]})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"," mb-1"),children:"Project Type"}),(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ".concat(k?ca(I.projectType):la(I.projectType)),children:ia(I.projectType)})]}),(0,kt.jsxs)("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-2 text-sm",children:[(0,kt.jsx)("span",{className:"".concat(k?"text-gray-300":"text-gray-600"," font-medium"),children:"Phase:"}),(0,kt.jsx)("span",{className:"".concat(k?"text-white":"text-gray-900"),children:Bn.getPhaseName(Ne(I.id))||"Lead"}),(0,kt.jsx)("span",{className:"".concat(k?"text-gray-500":"text-gray-300"),children:"|"}),(0,kt.jsx)("span",{className:"".concat(k?"text-gray-300":"text-gray-600"," font-medium"),children:"Section:"}),(0,kt.jsx)("span",{className:"".concat(k?"text-white":"text-gray-900"),children:(()=>{const e=null===I||void 0===I?void 0:I.currentWorkflowItem;return null!==e&&void 0!==e&&e.sectionDisplayName?e.sectionDisplayName:null!==e&&void 0!==e&&e.sectionName?e.sectionName:null!==e&&void 0!==e&&e.section?e.section:"Not Available"})()}),(0,kt.jsx)("span",{className:"".concat(k?"text-gray-500":"text-gray-300"),children:"|"}),(0,kt.jsx)("span",{className:"".concat(k?"text-gray-300":"text-gray-600"," font-medium"),children:"Line Item:"}),(0,kt.jsx)("button",{onClick:async()=>{const e=null===I||void 0===I?void 0:I.currentWorkflowItem,t=Sa.getCurrentLineItem(I),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||Sa.getCurrentSection(I),n=Ne(I.id);if(t&&I){console.log("\ud83c\udfaf PROJECT PROFILE: Navigating to line item:",t.name),console.log("\ud83c\udfaf PROJECT PROFILE: Section:",r),console.log("\ud83c\udfaf PROJECT PROFILE: Phase:",n);try{const s=await fetch("/api/workflow-data/project-position/".concat(I.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(s.ok){const a=await s.json();if(a.success&&a.data){const s=a.data,o=t.id||s.currentLineItemId||"".concat(n,"-").concat(r,"-0"),i=s.currentSectionId||(null===e||void 0===e?void 0:e.sectionId)||("string"===typeof r?r.toLowerCase().replace(/\s+/g,"-"):r)||"";console.log("\ud83c\udfaf PROJECT PROFILE: Target IDs:",{targetLineItemId:o,targetSectionId:i});const l=(0,Y.A)((0,Y.A)({},I),{},{navigationSource:I.navigationSource||"Project Profile",returnToSection:I.returnToSection||"project-profile",highlightStep:t.name,highlightLineItem:t.name,targetPhase:n,targetSection:r,targetLineItem:t.name,scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:t.name,stepName:t.name,lineItemId:o,workflowId:s.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(o),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:i,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});w(l,"Project Workflow",null,"Project Profile",o,i)}}else{const e=t.id||"".concat(n,"-").concat(r,"-0"),s="string"===typeof r?r:r||"",a=(0,Y.A)((0,Y.A)({},I),{},{navigationSource:I.navigationSource||"Project Profile",returnToSection:I.returnToSection||"project-profile",highlightStep:t.name,highlightLineItem:t.name,targetPhase:n,targetSection:r,targetLineItem:t.name,scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:t.name,stepName:t.name,lineItemId:e,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(e),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:s,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});w(a,"Project Workflow",null,"Project Profile",e,s)}}catch(L){console.error("\ud83c\udfaf PROJECT PROFILE: Error navigating to workflow step:",L);const s=(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0"),a="string"===typeof r?r:r||"",o=(0,Y.A)((0,Y.A)({},I),{},{navigationSource:I.navigationSource||"Project Profile",returnToSection:I.returnToSection||"project-profile",highlightStep:(null===t||void 0===t?void 0:t.name)||"Line Item",highlightLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",targetPhase:n,targetSection:r,targetLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",stepName:(null===t||void 0===t?void 0:t.name)||"Line Item",lineItemId:s,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(s),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:a,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});w(o,"Project Workflow",null,"Project Profile",s,a)}}else w(I,"Project Workflow",null,"Project Profile")},className:"text-sm ".concat(k?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:(null===(b=Sa.getCurrentLineItem(I))||void 0===b?void 0:b.name)||"View Workflow"}),(0,kt.jsx)("span",{className:"".concat(k?"text-gray-500":"text-gray-300"),children:"\u2022"}),(0,kt.jsx)("span",{className:"font-mono cursor-pointer hover:underline ".concat(k?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),title:"Line Item ID: ".concat((()=>{const e=null===I||void 0===I?void 0:I.currentWorkflowItem,t=Sa.getCurrentLineItem(I),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||Sa.getCurrentSection(I),n=Ne(I.id);return(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0")})()),onClick:async()=>{const e=null===I||void 0===I?void 0:I.currentWorkflowItem,t=Sa.getCurrentLineItem(I),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||Sa.getCurrentSection(I),n=Ne(I.id);try{const e=await fetch("/api/workflow-data/project-position/".concat(I.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});let s=(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0"),a="string"===typeof r?r.toLowerCase().replace(/\s+/g,"-"):r||"",o=null;if(e.ok){const r=await e.json();if(r.success&&r.data){const e=r.data;s=(null===t||void 0===t?void 0:t.id)||e.currentLineItemId||s,a=e.currentSectionId||a,o=e.workflowId||null}}const i=(0,Y.A)((0,Y.A)({},I),{},{navigationSource:I.navigationSource||"Project Profile",returnToSection:I.returnToSection||"project-profile",highlightStep:(null===t||void 0===t?void 0:t.name)||"Line Item",highlightLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",targetPhase:n,targetSection:r,targetLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",stepName:(null===t||void 0===t?void 0:t.name)||"Line Item",lineItemId:s,workflowId:o,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(s),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:a,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});w(i,"Project Workflow",null,"Project Profile",s,a)}catch(L){console.error("\ud83c\udfaf PROJECT PROFILE: Error navigating via Line Item ID:",L);const s=(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0"),a="string"===typeof r?r:r||"",o=(0,Y.A)((0,Y.A)({},I),{},{navigationSource:I.navigationSource||"Project Profile",returnToSection:I.returnToSection||"project-profile",highlightStep:(null===t||void 0===t?void 0:t.name)||"Line Item",highlightLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",targetPhase:n,targetSection:r,targetLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",stepName:(null===t||void 0===t?void 0:t.name)||"Line Item",lineItemId:s,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(s),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:a,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});w(o,"Project Workflow",null,"Project Profile",s,a)}},children:(()=>{const e=null===I||void 0===I?void 0:I.currentWorkflowItem,t=Sa.getCurrentLineItem(I),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||Sa.getCurrentSection(I),n=Ne(I.id);return(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0")})()})]})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(k?"text-white":"text-gray-900"," border-b ").concat(k?"border-slate-600":"border-gray-200"," pb-2"),children:"Progress & Management"}),(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(k?"bg-slate-700/50":"bg-gray-50"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsx)("span",{className:"text-sm font-medium ".concat(k?"text-gray-300":"text-gray-600"),children:"Progress"}),(0,kt.jsxs)("span",{className:"text-lg font-bold ".concat(k?"text-white":"text-gray-900"),children:[Me(I),"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-3 rounded-full overflow-hidden shadow-inner ".concat(k?"bg-slate-600":"bg-gray-200"),children:(0,kt.jsx)("div",{className:"h-full rounded-full transition-all duration-500 ease-out ".concat(100===Me(I)?"bg-gradient-to-r from-green-500 to-emerald-600":"bg-gradient-to-r from-blue-500 to-indigo-600"),style:{width:"".concat(Me(I),"%")},children:Me(I)>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})})]})]})]})]})]}),(0,kt.jsxs)("div",{className:"px-6 pb-6",children:[(0,kt.jsx)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-soft rounded-2xl p-4 mb-6",children:(0,kt.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[(0,kt.jsx)("input",{type:"text",placeholder:"Search projects...",value:H,onChange:e=>q(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsxs)("select",{value:K,onChange:e=>G(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"projectNumber",children:"Project Number"}),(0,kt.jsx)("option",{value:"name",children:"Project Name"}),(0,kt.jsx)("option",{value:"customer",children:"Customer"}),(0,kt.jsx)("option",{value:"phase",children:"Phase"}),(0,kt.jsx)("option",{value:"progress",children:"Progress"}),(0,kt.jsx)("option",{value:"startDate",children:"Start Date"})]}),(0,kt.jsxs)("button",{onClick:()=>Q("asc"===J?"desc":"asc"),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-transparent flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm",children:"asc"===J?"\u2191":"\u2193"}),(0,kt.jsx)("span",{className:"text-sm",children:"asc"===J?"A-Z":"Z-A"})]})]}),(0,kt.jsxs)("div",{className:"text-sm text-gray-600",children:[Pe.length," current, ",Ie.length," past projects"]})]})}),(0,kt.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-soft rounded-2xl p-6 mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Current Projects"}),De(Pe)>1&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>W(e=>Math.max(0,e-1)),disabled:0===B,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,kt.jsx)(nn,{className:"w-4 h-4"})}),(0,kt.jsxs)("span",{className:"text-sm text-gray-600",children:[B+1," of ",De(Pe)]}),(0,kt.jsx)("button",{onClick:()=>W(e=>Math.min(De(Pe)-1,e+1)),disabled:B>=De(Pe)-1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,kt.jsx)(gn,{className:"w-4 h-4"})})]})]}),0===Te(Pe,B).length?(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"text-gray-400 text-5xl mb-4",children:"\ud83d\udccb"}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Current Projects"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Start by creating your first project."})]}):(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:Te(Pe,B).map(e=>(0,kt.jsx)(sl,{project:e,isSelected:(null===I||void 0===I?void 0:I.id)===e.id,onSelect:()=>T(e),onProjectSelect:w,getPhaseForProject:Ne,getPhaseColorForProject:Se,getProjectProgress:Me,colorMode:k,isExpanded:F[e.id],onToggleExpansion:()=>ze(e.id)},e.id))})]}),(0,kt.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-soft rounded-2xl p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Past Projects"}),De(Ie)>1&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>V(e=>Math.max(0,e-1)),disabled:0===z,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,kt.jsx)(nn,{className:"w-4 h-4"})}),(0,kt.jsxs)("span",{className:"text-sm text-gray-600",children:[z+1," of ",De(Ie)]}),(0,kt.jsx)("button",{onClick:()=>V(e=>Math.min(De(Ie)-1,e+1)),disabled:z>=De(Ie)-1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,kt.jsx)(gn,{className:"w-4 h-4"})})]})]}),0===Te(Ie,z).length?(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"text-gray-400 text-5xl mb-4",children:"\u2705"}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Past Projects"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Completed projects will appear here."})]}):(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:Te(Ie,z).map(e=>(0,kt.jsx)(sl,{project:e,isSelected:(null===I||void 0===I?void 0:I.id)===e.id,onSelect:()=>T(e),onProjectSelect:w,getPhaseForProject:Ne,getPhaseColorForProject:Se,getProjectProgress:Me,colorMode:k,isExpanded:F[e.id],onToggleExpansion:()=>ze(e.id),isPast:!0},e.id))})]})]}),(0,kt.jsx)(Ni,{isOpen:D,onClose:()=>{M(!1),O(nl),R("")},children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(k?"text-white":"text-gray-800"," mb-4"),children:"Add New Project"}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),R(""),_.projectNumber&&_.projectName&&_.customerName)try{const e=e=>{if(!e)return null;const t=e.replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):11===t.length&&"1"===t[0]?"+1 (".concat(t.slice(1,4),") ").concat(t.slice(4,7),"-").concat(t.slice(7)):e},r=_.contacts.find(e=>e.isPrimary)||_.contacts[0]||{},n=_.contacts.find(e=>!e.isPrimary&&e.name)||{},s={primaryName:_.customerName,primaryEmail:(null===r||void 0===r?void 0:r.email)||null,primaryPhone:e(null===r||void 0===r?void 0:r.phone)||null,secondaryName:(null===n||void 0===n?void 0:n.name)||null,secondaryEmail:(null===n||void 0===n?void 0:n.email)||null,secondaryPhone:e(null===n||void 0===n?void 0:n.phone)||null,primaryContact:"PRIMARY",address:"".concat(_.customerName," Project"),notes:"Project created from Add Project form",contacts:_.contacts.filter(e=>e.name&&e.name.trim()).map(t=>({name:t.name.trim(),phone:e(t.phone)||null,email:t.email||null,isPrimary:t.isPrimary||!1}))};let a=null;const o=Ee.find(e=>e.primaryName===_.customerName||e.name===_.customerName);if(o)a=o.id;else{var t;const e=await Ds.customersService.create(s);if(a=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.id)||(null===e||void 0===e?void 0:e.id),!a)throw new Error("Customer ID not received from server")}const i=e=>({"Residential Roofing":"ROOF_REPLACEMENT","Commercial Roofing":"ROOF_REPLACEMENT","Repair & Maintenance":"OTHER","New Construction":"OTHER","Emergency Repair":"OTHER",Inspection:"OTHER","Gutter Installation":"SIDING_INSTALLATION",Siding:"SIDING_INSTALLATION",Windows:"WINDOW_REPLACEMENT",General:"OTHER"}[e]||"OTHER"),l={projectName:_.projectName,projectType:i(_.jobType),customerId:a,status:"PENDING",budget:_.budget?parseFloat(_.budget):1e3,startDate:_.startDate?new Date(_.startDate).toISOString():(new Date).toISOString(),endDate:_.endDate?new Date(_.endDate).toISOString():new Date(Date.now()+7776e6).toISOString(),priority:(_.priority||"Medium").toUpperCase(),description:_.description||"Project #".concat(_.projectNumber),projectManagerId:_.projectManager||null,additionalTrades:(_.tradeTypes||[]).filter(e=>e!==i(_.jobType)),tradeTypes:_.tradeTypes||[]},c=await X.mutateAsync(l);M(!1),O(nl),N&&N(c.data||c),se(),console.log("Project created successfully:",c.data||c)}catch(ES){console.error("Error creating project:",ES),R(ES.message||"Failed to create project")}else R("Project Number, Project Name, and Customer Name are required")},className:"space-y-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Project Number *"}),(0,kt.jsx)("input",{type:"text",name:"projectNumber",value:_.projectNumber,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-2"),children:"Trade Types (Select multiple)"}),(0,kt.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{value:"ROOFING",label:"Roofing"},{value:"GUTTERS",label:"Gutters"},{value:"INTERIOR_PAINT",label:"Interior Paint"}].map(e=>(0,kt.jsxs)("label",{className:"flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all ".concat((_.tradeTypes||[]).includes(e.value)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[(0,kt.jsx)("input",{type:"checkbox",checked:(_.tradeTypes||[]).includes(e.value),onChange:()=>{return t=e.value,void O(e=>(0,Y.A)((0,Y.A)({},e),{},{tradeTypes:(e.tradeTypes||[]).includes(t)?(e.tradeTypes||[]).filter(e=>e!==t):[...e.tradeTypes||[],t]}));var t},className:"mr-3 h-4 w-4 text-blue-600"}),(0,kt.jsx)("span",{className:"font-medium",children:e.label})]},e.value))}),(_.tradeTypes||[]).length>0&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-blue-600",children:["Selected: ",(_.tradeTypes||[]).join(", ")]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Project Name *"}),(0,kt.jsx)("input",{type:"text",name:"projectName",value:_.projectName,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Customer Name *"}),(0,kt.jsx)("input",{type:"text",name:"customerName",value:_.customerName,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Job Type"}),(0,kt.jsxs)("select",{name:"jobType",value:_.jobType,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Job Type"}),(0,kt.jsx)("option",{value:"Residential Roofing",children:"Residential Roofing"}),(0,kt.jsx)("option",{value:"Commercial Roofing",children:"Commercial Roofing"}),(0,kt.jsx)("option",{value:"Repair & Maintenance",children:"Repair & Maintenance"}),(0,kt.jsx)("option",{value:"New Construction",children:"New Construction"}),(0,kt.jsx)("option",{value:"Emergency Repair",children:"Emergency Repair"}),(0,kt.jsx)("option",{value:"Inspection",children:"Inspection"}),(0,kt.jsx)("option",{value:"Gutter Installation",children:"Gutter Installation"}),(0,kt.jsx)("option",{value:"Siding",children:"Siding"}),(0,kt.jsx)("option",{value:"Windows",children:"Windows"}),(0,kt.jsx)("option",{value:"General",children:"General"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Project Address"}),(0,kt.jsx)(Si,{name:"address",value:_.address,onChange:_e,placeholder:"Project address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Budget"}),(0,kt.jsx)("input",{type:"number",name:"budget",value:_.budget,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",min:"0",step:"0.01"})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Start Date"}),(0,kt.jsx)("input",{type:"date",name:"startDate",value:_.startDate,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"End Date"}),(0,kt.jsx)("input",{type:"date",name:"endDate",value:_.endDate,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Priority"}),(0,kt.jsxs)("select",{name:"priority",value:_.priority,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"Low",children:"Low"}),(0,kt.jsx)("option",{value:"Medium",children:"Medium"}),(0,kt.jsx)("option",{value:"High",children:"High"}),(0,kt.jsx)("option",{value:"Critical",children:"Critical"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Description"}),(0,kt.jsx)("textarea",{name:"description",value:_.description,onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",placeholder:"Project description..."})]}),!ce&&(0,kt.jsxs)("div",{className:"border-t pt-6 ".concat(k?"border-slate-600":"border-gray-200"),children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold mb-4 ".concat(k?"text-white":"text-gray-800"),children:"Project Roles"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Project Manager"}),(0,kt.jsxs)("select",{name:"projectManager",value:_.projectManager||"",onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Project Manager"}),ae.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Field Director"}),(0,kt.jsxs)("select",{name:"fieldDirector",value:_.fieldDirector||"",onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Field Director"}),ae.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Sales Representative"}),(0,kt.jsxs)("select",{name:"salesRep",value:_.salesRep||"",onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Sales Rep"}),ae.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Quality Inspector"}),(0,kt.jsxs)("select",{name:"qualityInspector",value:_.qualityInspector||"",onChange:_e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Quality Inspector"}),ae.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]})]})]}),(0,kt.jsxs)("div",{className:"border-t pt-6 ".concat(k?"border-slate-600":"border-gray-200"),children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold mb-4 ".concat(k?"text-white":"text-gray-800"),children:"Customer Contacts"}),_.contacts.map((e,t)=>(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 border border-gray-200 rounded-lg",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Contact Name"}),(0,kt.jsx)("input",{type:"text",value:e.name,onChange:e=>Oe(t,"name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Contact name"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Phone"}),(0,kt.jsx)("input",{type:"tel",value:e.phone,onChange:e=>Oe(t,"phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"(555) 123-4567"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(k?"text-gray-300":"text-gray-700"," mb-1"),children:"Email"}),(0,kt.jsx)("input",{type:"email",value:e.email,onChange:e=>Oe(t,"email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@email.com"})]}),(0,kt.jsx)("div",{className:"flex items-end",children:(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",checked:e.isPrimary,onChange:e=>Oe(t,"isPrimary",e.target.checked),className:"mr-2"}),(0,kt.jsx)("span",{className:"text-sm ".concat(k?"text-gray-300":"text-gray-700"),children:"Primary Contact"})]})})]},t))]}),L&&(0,kt.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,kt.jsx)("p",{className:"text-sm text-red-600",children:L})}),(0,kt.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{M(!1),O(nl),R("")},className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-200",children:"Cancel"}),(0,kt.jsxs)("button",{type:"submit",disabled:X.isLoading,className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-all duration-200 flex items-center gap-2",children:[X.isLoading&&(0,kt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),X.isLoading?"Creating...":"Create Project"]})]})]})]})})]})},ol="WORKFLOW_CHECKBOX_",il="BACKUP_CHECKBOX_",ll="EMERGENCY_CHECKBOX_",cl=(e,t)=>{const r=Array.from(t),n=Date.now(),s=JSON.stringify({items:r,timestamp:n,version:"v3"});try{return localStorage.setItem("".concat(ol).concat(e),s),localStorage.setItem("".concat(ol).concat(e,"_v2"),JSON.stringify(r)),sessionStorage.setItem("".concat(ol).concat(e),s),sessionStorage.setItem("".concat(il).concat(e),JSON.stringify(r)),localStorage.setItem("".concat(ll).concat(e,"_").concat(n),s),window.caches&&setTimeout(()=>{try{window.caches.open("workflow-cache").then(t=>{const r=new Blob([s],{type:"application/json"});URL.createObjectURL(r);t.put("/workflow/".concat(e),new Response(r))})}catch(It){}},0),console.log("Checkbox state saved: ".concat(r.length," items across multiple layers")),!0}catch(a){return console.error("Checkbox state save failed:",a),!1}},dl=e=>{try{const t=localStorage.getItem("".concat(ol).concat(e));if(t){const e=JSON.parse(t);if(e.items&&Array.isArray(e.items))return console.log("Loaded from primary storage: ".concat(e.items.length," items")),new Set(e.items)}const r=localStorage.getItem("".concat(ol).concat(e,"_v2"));if(r){const e=JSON.parse(r);if(Array.isArray(e))return console.log("Loaded from primary V2: ".concat(e.length," items")),new Set(e)}const n=sessionStorage.getItem("".concat(ol).concat(e));if(n){const e=JSON.parse(n);if(e.items&&Array.isArray(e.items))return console.log("Loaded from session storage: ".concat(e.items.length," items")),new Set(e.items)}const s=sessionStorage.getItem("".concat(il).concat(e));if(s){const e=JSON.parse(s);if(Array.isArray(e))return console.log("Loaded from backup: ".concat(e.length," items")),new Set(e)}const a=Object.keys(localStorage).filter(t=>t.startsWith("".concat(ll).concat(e,"_"))).sort().reverse();if(a.length>0){const e=localStorage.getItem(a[0]),t=JSON.parse(e);if(t.items&&Array.isArray(t.items))return console.log("Loaded from emergency backup: ".concat(t.items.length," items")),new Set(t.items)}}catch(t){console.error("Checkbox state load failed:",t)}return console.log("No checkbox data found, returning empty set"),new Set},ul=e=>{var t,r,n,s;let{project:a,onUpdate:i,onPhaseCompletionChange:l,targetLineItemId:c,targetSectionId:d,selectionNonce:u}=e;const h=(null===a||void 0===a?void 0:a._id)||(null===a||void 0===a?void 0:a.id);console.log("\ud83d\udccd PROJECT CHECKLIST PAGE - Navigation params received:"),console.log("   targetLineItemId:",c),console.log("   targetSectionId:",d),console.log("   projectId:",h),console.log("   project.navigationSource:",null===a||void 0===a?void 0:a.navigationSource),console.log("   project.highlightTarget:",null===a||void 0===a?void 0:a.highlightTarget),console.log("   project.navigationTarget:",null===a||void 0===a?void 0:a.navigationTarget),console.log("   project.returnToSection:",null===a||void 0===a?void 0:a.returnToSection),o.useEffect(()=>{const e=document.createElement("style");return e.textContent="\n      @keyframes pulse {\n        0%, 100% { transform: scale(1); opacity: 1; }\n        50% { transform: scale(1.02); opacity: 0.9; }\n      }\n      .workflow-line-item { transition: all 0.3s ease; }\n    ",document.head.appendChild(e),()=>document.head.removeChild(e)},[]);const[m,p]=(0,o.useState)(()=>dl(h)),[g,f]=(0,o.useState)(()=>dl(h)),[x,v]=(0,o.useState)(()=>dl(h)),[y,b]=(0,o.useState)(0),[w,j]=(0,o.useState)(null),[N,S]=(0,o.useState)({}),[k,A]=(0,o.useState)({}),[C,E]=(0,o.useState)({}),[P,I]=(0,o.useState)(null),[T,D]=(0,o.useState)(null),[M,_]=(0,o.useState)(!0),[O,L]=(0,o.useState)(null),[R,F]=(0,o.useState)(null),[U,B]=(0,o.useState)(0),[W,z]=(0,o.useState)([]),V=new URLSearchParams("undefined"!==typeof window?window.location.search:"").get("highlight_item"),[H,q]=(0,o.useState)(c||V),[K,G]=(0,o.useState)(d),[J,Q]=(0,o.useState)((null===a||void 0===a||null===(t=a.navigationTarget)||void 0===t?void 0:t.nonce)||null);(0,o.useEffect)(()=>{(c||d)&&(q(c||H),G(d||K),Q(Date.now()))},[c,d]);const[X,$]=(0,o.useState)(!1),[Z,ee]=(0,o.useState)({sectionName:"",displayName:"",description:""}),[te,re]=(0,o.useState)(null),[ne,se]=(0,o.useState)(!1),[ae,oe]=(0,o.useState)(!1),[ie,le]=(0,o.useState)({itemName:"",responsibleRole:"OFFICE",description:"",estimatedMinutes:30,alertDays:1,addToAllWorkflows:!1}),[ce,de]=(0,o.useState)(null),[ue,he]=(0,o.useState)(!1),me=e=>{const t=m.has(e),r=g.has(e),n=x.has(e),s=t||r||n;return"LEAD-input-customer-info-0"===e&&console.log("\ud83d\udd0d CHECKING ".concat(e,": immediate=").concat(t,", persistent=").concat(r,", backup=").concat(n,", result=").concat(s)),s};(0,o.useEffect)(()=>{(async()=>{if(h){console.log("Loading workflow data for project: ".concat(h)),_(!0),L(null);try{const e=(await Ds.default.get("/workflow-data/project-workflows/".concat(h))).data;if(!e.success)throw new Error("Failed to load workflow structure");{I(e.data);const t=e.data.map((e,t)=>({id:e.workflowType,name:e.tradeName,isMainWorkflow:e.isMainWorkflow,completedCount:e.completedCount,totalCount:e.totalCount,progress:e.totalCount>0?Math.round(e.completedCount/e.totalCount*100):0}));z(t),console.log("Loaded ".concat(e.data.length," workflows from database")),e.data.forEach(e=>{console.log("  - ".concat(e.workflowType,": ").concat(e.completedCount,"/").concat(e.totalCount," completed"))}),console.log("Full workflow data:",e.data)}const t=e.data.find(e=>e.isMainWorkflow);if(t){const r={projectId:h,currentPhase:t.currentPhase,currentSection:t.currentSection,currentLineItem:t.currentLineItem,trackerId:t.trackerId};D(r),console.log("Loaded main workflow position:",r);let n=!1;if(c||d||V||(null===a||void 0===a?void 0:a.highlightTarget)||(null===a||void 0===a?void 0:a.navigationTarget)){if(console.log("\ud83c\udfaf ENHANCED NAVIGATION: Processing navigation target from",(null===a||void 0===a?void 0:a.navigationSource)||"unknown"),null!==a&&void 0!==a&&a.highlightTarget){const e=a.highlightTarget;console.log("\ud83c\udfaf ENHANCED NAVIGATION: Using highlightTarget:",e),e.phaseId&&e.sectionId&&(j(e.phaseId),S(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.sectionId]:!0})),n=!0)}else if(null!==a&&void 0!==a&&a.navigationTarget){const e=a.navigationTarget;if(console.log("\ud83c\udfaf ENHANCED NAVIGATION: Using navigationTarget:",e),e.phase&&e.section){const r=((null===t||void 0===t?void 0:t.phases)||[]).find(t=>t.id===e.phase||t.label===e.phase||t.name===e.phase);if(r){const t=(r.items||[]).find(t=>t.id===e.section||t.displayName===e.section||t.label===e.section);t&&(console.log("\ud83c\udfaf ENHANCED NAVIGATION: Expanding phase/section from navigationTarget"),j(r.id),S(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:!0})),n=!0)}}}if(!n){const r=c||V;if(r&&t){const e=t.phases||[],s=new Set(e.map(e=>e.id)),a=r.split("-");if(a.length>=3&&s.has(a[0])){const e=a[0],t=a.slice(1,-1).join("-");console.log("\ud83c\udfaf NAVIGATION: Expanding by composite id: phase=".concat(e,", section=").concat(t)),j(e),S(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:!0})),n=!0}else e:for(const t of e)for(const e of t.items||[]){if((e.subtasks||[]).some(e=>"object"===typeof e&&e.id===r)){console.log("\ud83c\udfaf NAVIGATION: Expanding by DB id: phase=".concat(t.id,", section=").concat(e.id)),j(t.id),S(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:!0})),n=!0;break e}}}if(!n&&d){const t=(e.data||[]).find(e=>e.items.some(e=>e.id===d));t&&(console.log("\ud83c\udfaf NAVIGATION: Expanding by targetSectionId: phase=".concat(t.id,", section=").concat(d)),j(t.id),S(e=>(0,Y.A)((0,Y.A)({},e),{},{[d]:!0})),n=!0)}}if(!n&&null!==t&&void 0!==t&&t.currentPhase&&null!==t&&void 0!==t&&t.currentSection&&(console.log("\ud83c\udfaf NAVIGATION: Default expand to current position: phase=".concat(t.currentPhase,", section=").concat(t.currentSection)),j(t.currentPhase),S(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.currentSection]:!0})),n=!0),!n&&Array.isArray(e.data)&&e.data.length>0){const t=e.data[0],r=t.items&&t.items.length>0?t.items[0]:null;t&&r&&(console.log("\ud83c\udfaf NAVIGATION: Fallback expand to first phase/section: phase=".concat(t.id,", section=").concat(r.id)),j(t.id),S(e=>(0,Y.A)((0,Y.A)({},e),{},{[r.id]:!0})))}setTimeout(()=>{let e=null,r="";if(null!==a&&void 0!==a&&a.highlightTarget&&a.highlightTarget.scrollAndHighlight){const t=a.highlightTarget;console.log("\ud83c\udfaf ENHANCED SCROLL: Attempting to scroll to highlightTarget:",t.lineItemId),e=document.getElementById("lineitem-".concat(t.lineItemId)),e||(e=document.getElementById("lineitem-checkbox-".concat(t.lineItemId)),e&&(e=e.closest(".workflow-line-item"))),e&&(r="Enhanced navigation from ".concat(a.navigationSource,": ").concat(t.lineItemId))}else if(null!==a&&void 0!==a&&a.navigationTarget&&a.navigationTarget.autoOpen){const t=a.navigationTarget,n=t.targetElementId||"lineitem-".concat(t.lineItemId);console.log("\ud83c\udfaf ENHANCED SCROLL: Attempting to scroll to navigationTarget:",n),e=document.getElementById(n),!e&&t.lineItemId&&(e=document.getElementById("lineitem-".concat(t.lineItemId))),!e&&t.lineItemId&&(e=document.getElementById("lineitem-checkbox-".concat(t.lineItemId)),e&&(e=e.closest(".workflow-line-item"))),e&&(r="Enhanced navigation from ".concat(a.navigationSource,": ").concat(t.lineItemId||n))}else{const t=c||V;t&&(e=document.getElementById("lineitem-".concat(t)),r="target line item: ".concat(t),e||(e=document.getElementById("lineitem-checkbox-".concat(t)),e&&(e=e.closest(".workflow-line-item"),r="target line item (via checkbox): ".concat(t))))}if(!e&&d&&(e=document.getElementById("item-".concat(d)),r="target section: ".concat(d)),!e&&null!==t&&void 0!==t&&t.currentSection&&(e=document.getElementById("item-".concat(t.currentSection)),r="current section: ".concat(t.currentSection)),e){var n,s,o,i;console.log("\ud83c\udfaf HIGHLIGHTING:",r),e.scrollIntoView({behavior:"smooth",block:"center"});const t=(null===a||void 0===a?void 0:a.highlightTarget)||(null===a||void 0===a?void 0:a.navigationTarget),l=t?(null===(n=a.highlightTarget)||void 0===n?void 0:n.highlightColor)||(null===(s=a.navigationTarget)||void 0===s?void 0:s.highlightColor)||"#0066CC":"#F59E0B",d=t?(null===(o=a.highlightTarget)||void 0===o?void 0:o.highlightDuration)||(null===(i=a.navigationTarget)||void 0===i?void 0:i.highlightDuration)||5e3:8e3;if(c||t)console.log("\ud83c\udfaf ENHANCED HIGHLIGHTING: Applying enhanced highlight from",null===a||void 0===a?void 0:a.navigationSource),"#0066CC"===l?(e.style.backgroundColor="#EFF6FF",e.style.border="3px solid #0066CC",e.style.boxShadow="0 0 20px rgba(0, 102, 204, 0.5)"):(e.style.backgroundColor="#FEF3C7",e.style.border="3px solid #F59E0B",e.style.boxShadow="0 0 20px rgba(245, 158, 11, 0.5)"),e.style.transition="all 0.3s ease",e.style.animation="pulse 1.5s ease-in-out 3",setTimeout(()=>{e.style.backgroundColor="",e.style.border="",e.style.boxShadow="",e.style.animation=""},d);else{const t=["ring-4","ring-blue-500","ring-opacity-75"];e.classList.add(...t),setTimeout(()=>{e.classList.remove(...t)},5e3)}console.log("\u2705 Auto-navigated and highlighted: ".concat(r))}else console.log("\u26a0\ufe0f Could not find element to highlight:",r)},1e3)}}else console.log("\u26a0\ufe0f No project position found for: ".concat(h))}catch(e){console.error("\u274c Error loading workflow data:",e),L(e.message)}finally{_(!1)}}})()},[h]),(0,o.useEffect)(()=>{if(!h)return;console.log("Initializing workflow for project: ".concat(h)),console.log("Initial states:",{immediate:m.size,persistent:g.size,backup:x.size});const e=dl(h);p(e),f(e),v(e),b(1)},[h]),(0,o.useEffect)(()=>{const e=e=>{const{projectId:t,lineItemId:r,stepName:n,source:s}=e.detail;if(t===h&&(console.log("\ud83d\udd14 ProjectChecklistPage: Received workflowStepCompleted event for project ".concat(t),{lineItemId:r,stepName:n,source:s}),r)){const e=[r,"DB_".concat(r),"".concat(r,"-0"),"DB_".concat(r,"-0")];let t=null;for(const n of e)if(n.includes("DB_")||n===r){t=n;break}if(t){console.log("\ud83d\udd04 ProjectChecklistPage: Marking line item ".concat(t," as checked from ").concat(s));const e=new Set(m),r=new Set(g),n=new Set(x);e.add(t),r.add(t),n.add(t),p(e),f(r),v(n),cl(h,r),b(e=>e+1),console.log("\u2705 ProjectChecklistPage: Successfully marked ".concat(t," as completed"))}else console.warn("\u26a0\ufe0f ProjectChecklistPage: Could not determine step ID format for line item ".concat(r))}};return window.addEventListener("workflowStepCompleted",e),()=>{window.removeEventListener("workflowStepCompleted",e)}},[h,m,g,x]);const pe=null===P||void 0===P?void 0:P[U],ge=(null===pe||void 0===pe?void 0:pe.phases)||[];return(0,o.useEffect)(()=>{if(!pe||!c&&!d&&(null===a||void 0===a||!a.navigationTarget))return;(async()=>{try{var e,t,r;let n=!1;const s=ge||[];if(c)e:for(const e of s)for(const t of e.items||[]){if((t.subtasks||[]).some(e=>"object"===typeof e&&(e.id===c||e.id===String(c)))){j(e.id),S(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:!0})),n=!0;break e}}if(!n&&d){const e=s.find(e=>(e.items||[]).some(e=>e.id===d));e&&(j(e.id),S(e=>(0,Y.A)((0,Y.A)({},e),{},{[d]:!0})),n=!0)}if(!n&&null!==a&&void 0!==a&&null!==(e=a.navigationTarget)&&void 0!==e&&e.phase&&null!==a&&void 0!==a&&null!==(t=a.navigationTarget)&&void 0!==t&&t.section){const e=s.find(e=>e.id===a.navigationTarget.phase||e.label===a.navigationTarget.phase||e.name===a.navigationTarget.phase);if(e){const t=(e.items||[]).find(e=>e.id===a.navigationTarget.section||e.displayName===a.navigationTarget.section||e.label===a.navigationTarget.section);t&&(j(e.id),S(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:!0})),n=!0)}}setTimeout(()=>{var e,t,r;let n=null;const s=c||(null===a||void 0===a||null===(e=a.navigationTarget)||void 0===e?void 0:e.lineItemId)||(null===a||void 0===a||null===(t=a.highlightTarget)||void 0===t?void 0:t.lineItemId);var o;s&&(n=document.getElementById("lineitem-".concat(s))||(null===(o=document.getElementById("lineitem-checkbox-".concat(s)))||void 0===o?void 0:o.closest(".workflow-line-item"))||null);if(!n&&(d||null!==a&&void 0!==a&&null!==(r=a.navigationTarget)&&void 0!==r&&r.targetSectionId)){const e=d||a.navigationTarget.targetSectionId;n=document.getElementById("item-".concat(e))}if(n){var i,l,u,h;n.scrollIntoView({behavior:"smooth",block:"center"});"#0066CC"===((null===a||void 0===a?void 0:a.highlightTarget)||(null===a||void 0===a?void 0:a.navigationTarget)?(null===(i=a.highlightTarget)||void 0===i?void 0:i.highlightColor)||(null===(l=a.navigationTarget)||void 0===l?void 0:l.highlightColor)||"#0066CC":"#F59E0B")?(n.style.backgroundColor="#EFF6FF",n.style.border="3px solid #0066CC",n.style.boxShadow="0 0 20px rgba(0, 102, 204, 0.5)"):(n.style.backgroundColor="#FEF3C7",n.style.border="3px solid #F59E0B",n.style.boxShadow="0 0 20px rgba(245, 158, 11, 0.5)"),n.style.transition="all 0.3s ease",n.style.animation="pulse 1.5s ease-in-out 3",setTimeout(()=>{n.style.backgroundColor="",n.style.border="",n.style.boxShadow="",n.style.animation=""},(null===(u=a.highlightTarget)||void 0===u?void 0:u.highlightDuration)||(null===(h=a.navigationTarget)||void 0===h?void 0:h.highlightDuration)||5e3)}},500),null!==a&&void 0!==a&&null!==(r=a.navigationTarget)&&void 0!==r&&r.nonce&&Q(a.navigationTarget.nonce)}catch(It){console.error("Navigation re-run failed",It)}})()},[c,d,null===a||void 0===a||null===(r=a.navigationTarget)||void 0===r?void 0:r.phase,null===a||void 0===a||null===(n=a.navigationTarget)||void 0===n?void 0:n.section,null===a||void 0===a||null===(s=a.navigationTarget)||void 0===s?void 0:s.lineItemId,J,u,ge]),a?M?(0,kt.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,kt.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,kt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,kt.jsx)("div",{className:"text-gray-600",children:"Loading workflow from database..."})]})})})}):O?(0,kt.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,kt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,kt.jsx)("div",{className:"text-red-600 font-semibold mb-2",children:"Failed to Load Workflow"}),(0,kt.jsx)("div",{className:"text-red-500 text-sm",children:O})]})}):P&&0!==P.length?(0,kt.jsxs)("div",{className:"max-w-4xl mx-auto p-0 space-y-0",children:[W.length>1&&(0,kt.jsx)("div",{className:"bg-white border-b border-gray-200 mb-6",children:(0,kt.jsx)("div",{className:"flex space-x-1 overflow-x-auto",children:W.map((e,t)=>(0,kt.jsx)("button",{onClick:()=>B(t),className:"flex-shrink-0 px-4 py-3 text-sm font-medium border-b-2 transition-colors duration-200 ".concat(t===U?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("span",{children:e.name}),e.isMainWorkflow&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Main"}),(0,kt.jsxs)("span",{className:"text-xs text-gray-400",children:[e.completedCount,"/",e.totalCount]}),(0,kt.jsx)("div",{className:"w-12 bg-gray-200 rounded-full h-1.5",children:(0,kt.jsx)("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300",style:{width:"".concat(e.progress,"%")}})})]})},e.id))})}),(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsx)("div",{className:"flex items-center justify-between",children:(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:[(null===pe||void 0===pe?void 0:pe.tradeName)||"Workflow"," Checklist",(null===pe||void 0===pe?void 0:pe.isMainWorkflow)&&(0,kt.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Main Workflow"})]}),(0,kt.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[(null===pe||void 0===pe?void 0:pe.completedCount)||0," of ",(null===pe||void 0===pe?void 0:pe.totalCount)||0," items completed (",(null===pe||void 0===pe?void 0:pe.totalCount)>0?Math.round(pe.completedCount/pe.totalCount*100):0,"%)"]})]})})}),(0,kt.jsx)("div",{className:"space-y-4",children:ge.map(e=>{var t,r,n,s;return console.log("Rendering phase: ".concat(e.id," with ").concat(e.items.length," items")),(0,kt.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,kt.jsx)("button",{onClick:()=>{return t=e.id,j("ALL"===w?t:w===t?null:t),void S({});var t},className:"w-full px-6 py-4 text-left font-semibold bg-white hover:bg-gray-50 transition-colors duration-200 border-b border-gray-100 ".concat(e.items.length>0&&e.items.every(t=>t.subtasks.every((r,n)=>{const s="DB_".concat(e.id,"-").concat(t.id,"-").concat(n);return me(s)}))?"line-through decoration-2":""),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-4 h-4 rounded-full ".concat((s=e.id,Bn.getPhaseButtonProps(s).bgColor||"bg-gray-500")," flex-shrink-0")}),(0,kt.jsx)("span",{className:"text-gray-900",children:e.label})]}),(0,kt.jsx)(tn,{className:"w-5 h-5 transform transition-transform duration-200 text-gray-600 ".concat(w===e.id||"ALL"===w?"rotate-180":"")})]})}),w===e.id&&(0,kt.jsxs)("div",{className:"p-6 space-y-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:t[e.id]?void 0:{name:"",saving:!1}})),className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-md text-white bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700",children:"+ Add Section"}),k[e.id]&&(0,kt.jsxs)("form",{onSubmit:async t=>{var r;t.preventDefault();const n=null===(r=k[e.id].name)||void 0===r?void 0:r.trim();if(n){A(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:(0,Y.A)((0,Y.A)({},t[e.id]),{},{saving:!0})}));try{var s;const t={phaseId:e.id,sectionName:n,displayName:n};if(null!==(s=(await Ds.default.post("/workflows/sections",t)).data)&&void 0!==s&&s.success){const t=await Ds.default.get("/workflow-data/project-workflows/".concat(h));t.data.success&&I(t.data.data),A(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:void 0}))}}catch(ES){var a,o;alert((null===ES||void 0===ES||null===(a=ES.response)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.message)||"Failed to add section"),A(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:(0,Y.A)((0,Y.A)({},t[e.id]),{},{saving:!1})}))}}},className:"flex items-center gap-2",children:[(0,kt.jsx)("input",{autoFocus:!0,type:"text",value:(null===(t=k[e.id])||void 0===t?void 0:t.name)||"",onChange:t=>A(r=>(0,Y.A)((0,Y.A)({},r),{},{[e.id]:(0,Y.A)((0,Y.A)({},r[e.id]),{},{name:t.target.value})})),className:"px-2 py-1 border border-gray-300 rounded-md text-sm",placeholder:"Section name"}),(0,kt.jsx)("button",{type:"submit",disabled:null===(r=k[e.id])||void 0===r?void 0:r.saving,className:"px-2 py-1 text-xs text-white bg-[var(--color-success-green)] rounded-md disabled:opacity-50",children:null!==(n=k[e.id])&&void 0!==n&&n.saving?"Saving...":"Save"})]})]}),0===e.items.length?(0,kt.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,kt.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udccb"}),(0,kt.jsx)("div",{className:"text-lg font-medium",children:"No items in this phase yet"}),(0,kt.jsx)("div",{className:"text-sm",children:"This phase will be populated with workflow items as needed."})]}):e.items.map(t=>{var r,n,s,a,o;const l=T&&T.currentSection===t.id;return(0,kt.jsxs)("div",{id:"item-".concat(t.id),className:"border rounded-lg overflow-hidden ".concat(l?"border-blue-500 bg-blue-50/50":""),children:[(0,kt.jsx)("button",{onClick:()=>{return e=t.id,void S(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!t[e]}));var e},className:"w-full px-4 py-3 text-left font-medium transition-colors duration-200 ".concat(l?"bg-blue-100 hover:bg-blue-150 text-blue-900":"bg-gray-50 hover:bg-gray-100 text-gray-800"," ").concat(t.subtasks.every((r,n)=>{const s="DB_".concat(e.id,"-").concat(t.id,"-").concat(n);return me(s)})?"line-through decoration-2":""),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between group",children:[(0,kt.jsxs)("span",{className:"flex items-center gap-2",children:[l&&(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udc48"}),t.label]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:async e=>{if(e.stopPropagation(),window.confirm("Delete this section?"))try{var r;let n;try{n=await Ds.default.delete("/workflows/sections/".concat(t.id))}catch(e){n=await Ds.default.post("/workflows/sections/".concat(t.id,"/delete"))}if(null!==(r=n.data)&&void 0!==r&&r.success){const e=await Ds.default.get("/workflow-data/project-workflows/".concat(h));e.data.success&&I(e.data.data)}}catch(ES){var n,s;alert((null===ES||void 0===ES||null===(n=ES.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.message)||"Failed to delete section")}},className:"p-1 rounded text-gray-400 hover:text-red-600 hover:bg-red-50 opacity-0 group-hover:opacity-100 transition",title:"Delete section","aria-label":"Delete section",children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"w-4 h-4",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-7 4v6m4-6v6M7 7l1 13a2 2 0 002 2h4a2 2 0 002-2l1-13"})})}),(0,kt.jsx)(tn,{className:"w-4 h-4 transform transition-transform duration-200 ".concat(N[t.id]?"rotate-180":"")})]})]})}),N[t.id]&&(0,kt.jsxs)("div",{className:"p-4 ".concat(l?"bg-blue-50/30":"bg-white"),children:[(0,kt.jsx)("div",{className:"space-y-3",children:t.subtasks.map((r,n)=>{const s="object"===typeof r?r.id:null,a="object"===typeof r?r.label:r,o=s||"DB_".concat(e.id,"-").concat(t.id,"-").concat(n),l=me(o),c=T&&T.currentSection===t.id&&(T.currentLineItem===s||T.currentLineItemName===a),d=s||"".concat(e.id,"-").concat(t.id,"-").concat(n),u=H&&H===d;return(0,kt.jsxs)("div",{id:"lineitem-".concat(d),className:"workflow-line-item group flex items-start space-x-3 ".concat(c?"p-2 bg-blue-100 border border-blue-300 rounded-lg ring-2 ring-blue-400 ring-opacity-50":u?"p-2 bg-yellow-100 border border-yellow-300 rounded-lg ring-2 ring-yellow-400 ring-opacity-75":""),children:[(0,kt.jsxs)("div",{className:"relative flex-shrink-0 mt-1",children:[(0,kt.jsx)("input",{type:"checkbox",id:"lineitem-checkbox-".concat(o),checked:l,onChange:()=>{console.log("Checkbox onChange: ".concat(o,", Database ID: ").concat(s)),(e=>{console.log("Checkbox clicked: ".concat(e));const t=m.has(e)||g.has(e),r=!t;console.log("Toggle: ".concat(e," from ").concat(t," to ").concat(r)),(t=>{const r=new Set(m),n=new Set(g),s=new Set(x);t?(r.add(e),n.add(e),s.add(e)):(r.delete(e),n.delete(e),s.delete(e)),p(r),f(n),v(s),b(e=>e+1),cl(h,n),console.log("All states updated: ".concat(t?"CHECKED":"UNCHECKED"," - ").concat(Array.from(n).length," items"))})(r),setTimeout(()=>{try{fa.updateStep(h,e,r).then(()=>{console.log("Server sync success: ".concat(e)),i&&"function"===typeof i&&(console.log("\ud83d\udd04 Triggering project data refresh after workflow completion"),i())}).catch(t=>{console.error("Server sync failed: ".concat(e),t)})}catch(t){console.error("Server call failed: ".concat(e),t)}},10)})(s||o,e.id,t.id)},onClick:e=>{console.log("Checkbox onClick: ".concat(o)),e.stopPropagation()},className:"h-4 w-4 rounded border-2 text-blue-600 focus:ring-2 focus:ring-blue-500 transition-all duration-200 checked:bg-[var(--color-primary-blueprint-blue)] checked:border-blue-600 ".concat(c?"border-blue-500":"border-gray-300")}),l&&(0,kt.jsx)("svg",{className:"absolute inset-0 w-4 h-4 text-white pointer-events-none",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),(0,kt.jsxs)("label",{htmlFor:"lineitem-checkbox-".concat(o),className:"flex-1 text-sm cursor-pointer select-none transition-all duration-200 ".concat(c?"font-semibold text-blue-800":u?"font-semibold text-yellow-800":l?"text-gray-500 line-through decoration-2":"text-gray-800 hover:text-blue-600"),children:[c&&(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udc48 "}),u&&(0,kt.jsx)("span",{className:"text-yellow-500",children:"\u2b50 "}),a]}),s&&(0,kt.jsx)("button",{onClick:async e=>{if(e.stopPropagation(),window.confirm("Delete this line item?"))try{var t;let r;try{r=await Ds.default.delete("/workflows/line-items/".concat(s))}catch(e){r=await Ds.default.post("/workflows/line-items/".concat(s,"/delete"))}if(null!==(t=r.data)&&void 0!==t&&t.success){const e=await Ds.default.get("/workflow-data/project-workflows/".concat(h));e.data.success&&I(e.data.data)}}catch(ES){var r,n;alert((null===ES||void 0===ES||null===(r=ES.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||"Failed to delete line item")}},className:"p-1 rounded text-gray-400 hover:text-red-600 hover:bg-red-50 opacity-0 group-hover:opacity-100 transition ml-2",title:"Delete line item","aria-label":"Delete line item",children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"w-4 h-4",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-7 4v6m4-6v6M7 7l1 13a2 2 0 002 2h4a2 2 0 002-2l1-13"})})})]},n)})}),(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("button",{onClick:()=>E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:e[t.id]?void 0:{name:"",role:"OFFICE",saving:!1}})),className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-md text-white bg-[var(--color-success-green)] hover:bg-green-700",children:"+ Add Line Item"}),C[t.id]&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("form",{onSubmit:async e=>{var r;e.preventDefault();const n=null===(r=C[t.id].name)||void 0===r?void 0:r.trim();if(n){E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:(0,Y.A)((0,Y.A)({},e[t.id]),{},{saving:!0})}));try{var s,a;const e={sectionId:t.id,itemName:n,responsibleRole:(C[t.id].role,"PROJECT_MANAGER"),addToAllWorkflows:(null===(s=C[t.id])||void 0===s?void 0:s.addToAllWorkflows)||!1};if(null!==(a=(await Ds.default.post("/workflows/line-items",e)).data)&&void 0!==a&&a.success){const e=await Ds.default.get("/workflow-data/project-workflows/".concat(h));e.data.success&&I(e.data.data),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:void 0}))}}catch(ES){var o,i;alert((null===ES||void 0===ES||null===(o=ES.response)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.message)||"Failed to add line item"),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:(0,Y.A)((0,Y.A)({},e[t.id]),{},{saving:!1})}))}}},className:"flex items-center gap-2 mt-2",children:[(0,kt.jsx)("input",{autoFocus:!0,type:"text",value:(null===(r=C[t.id])||void 0===r?void 0:r.name)||"",onChange:e=>E(r=>(0,Y.A)((0,Y.A)({},r),{},{[t.id]:(0,Y.A)((0,Y.A)({},r[t.id]),{},{name:e.target.value})})),className:"px-2 py-1 border border-gray-300 rounded-md text-sm",placeholder:"Line item name"}),(0,kt.jsxs)("select",{value:(null===(n=C[t.id])||void 0===n?void 0:n.role)||"OFFICE",onChange:e=>E(r=>(0,Y.A)((0,Y.A)({},r),{},{[t.id]:(0,Y.A)((0,Y.A)({},r[t.id]),{},{role:e.target.value})})),className:"px-2 py-1 border border-gray-300 rounded-md text-sm",children:[(0,kt.jsx)("option",{value:"OFFICE",children:"Office"}),(0,kt.jsx)("option",{value:"ADMINISTRATION",children:"Administration"}),(0,kt.jsx)("option",{value:"PROJECT_MANAGER",children:"Project Manager"}),(0,kt.jsx)("option",{value:"FIELD_DIRECTOR",children:"Field Director"}),(0,kt.jsx)("option",{value:"ROOF_SUPERVISOR",children:"Roof Supervisor"}),(0,kt.jsx)("option",{value:"OFFICE_STAFF",children:"Office Staff"})]}),(0,kt.jsx)("button",{type:"submit",disabled:null===(s=C[t.id])||void 0===s?void 0:s.saving,className:"px-2 py-1 text-xs text-white bg-[var(--color-success-green)] rounded-md disabled:opacity-50",children:null!==(a=C[t.id])&&void 0!==a&&a.saving?"Saving...":"Save"})]}),(0,kt.jsx)("div",{className:"mt-2",children:(0,kt.jsxs)("label",{className:"flex items-center text-xs",children:[(0,kt.jsx)("input",{type:"checkbox",checked:(null===(o=C[t.id])||void 0===o?void 0:o.addToAllWorkflows)||!1,onChange:e=>E(r=>(0,Y.A)((0,Y.A)({},r),{},{[t.id]:(0,Y.A)((0,Y.A)({},r[t.id]),{},{addToAllWorkflows:e.target.checked})})),className:"mr-1 h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,kt.jsx)("span",{className:"text-xs text-gray-600",children:"Add to all workflows permanently"})]})})]})]})]})]},t.id)})]})]},e.id)})}),!1,X&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,kt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Section"}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),te)if(Z.sectionName.trim()){se(!0);try{const e={phaseId:te.id,sectionName:Z.sectionName.trim(),displayName:Z.displayName.trim()||Z.sectionName.trim(),description:Z.description.trim()?Z.description.trim():void 0};console.log("\ud83d\udd0d CREATE SECTION: Sending request data:",e);const t=await Ds.default.post("/workflows/sections",e);if(t.data.success){const e=await Ds.default.get("/workflow-data/project-workflows/".concat(h));e.data.success&&I(e.data.data),ee({sectionName:"",displayName:"",description:""}),re(null),$(!1),console.log("\u2705 Section created successfully:",t.data.data)}}catch(t){console.error("\u274c Error creating section:",t),alert("Failed to create section. Please try again.")}finally{se(!1)}}else alert("Please enter a section name.");else alert("Please select a phase for the section.")},children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phase"}),(0,kt.jsxs)("select",{value:(null===te||void 0===te?void 0:te.id)||"",onChange:e=>{const t=ge.find(t=>t.id===e.target.value);re(t)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,kt.jsx)("option",{value:"",children:"Select a phase"}),ge.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.label},e.id))]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section Name *"}),(0,kt.jsx)("input",{type:"text",value:Z.sectionName,onChange:e=>ee((0,Y.A)((0,Y.A)({},Z),{},{sectionName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter section name",required:!0})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name"}),(0,kt.jsx)("input",{type:"text",value:Z.displayName,onChange:e=>ee((0,Y.A)((0,Y.A)({},Z),{},{displayName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter display name (optional)"})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,kt.jsx)("textarea",{value:Z.description,onChange:e=>ee((0,Y.A)((0,Y.A)({},Z),{},{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter description (optional)",rows:"3"})]}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{$(!1),ee({sectionName:"",displayName:"",description:""}),re(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:ne||!te||!Z.sectionName.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-[var(--color-primary-blueprint-blue)] rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:ne?"Creating...":"Create Section"})]})]})]})})}),ae&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,kt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Line Item"}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),ce)if(ie.itemName.trim()){he(!0);try{const e={sectionId:ce.id,itemName:ie.itemName.trim(),responsibleRole:(ie.responsibleRole,"PROJECT_MANAGER"),description:ie.description.trim()?ie.description.trim():void 0,estimatedMinutes:parseInt(ie.estimatedMinutes)||30,alertDays:parseInt(ie.alertDays)||1,addToAllWorkflows:ie.addToAllWorkflows};console.log("\ud83d\udd0d CREATE LINE ITEM: Sending request data:",e);const t=await Ds.default.post("/workflows/line-items",e);if(t.data.success){const e=await Ds.default.get("/workflow-data/project-workflows/".concat(h));e.data.success&&I(e.data.data),le({itemName:"",responsibleRole:"WORKER",description:"",estimatedMinutes:30,alertDays:1,addToAllWorkflows:!1}),de(null),oe(!1),console.log("\u2705 Line item created successfully:",t.data.data)}}catch(a){var t,r,n,s;console.error("\u274c Error creating line item:",a);const e=null===a||void 0===a||null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message,o=null===a||void 0===a||null===(n=a.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.errors;if(o&&Array.isArray(o)){const t=o[0];alert((null===t||void 0===t?void 0:t.msg)||(null===t||void 0===t?void 0:t.message)||e||"Failed to create line item.")}else alert(e||"Failed to create line item. Please try again.")}finally{he(!1)}}else alert("Please enter an item name.");else alert("Please select a section for the line item.")},children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section"}),(0,kt.jsxs)("select",{value:(null===ce||void 0===ce?void 0:ce.id)||"",onChange:e=>{let t=null;for(const r of ge){const n=r.items.find(t=>t.id===e.target.value);if(n){t=n;break}}de(t)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,kt.jsx)("option",{value:"",children:"Select a section"}),ge.map(e=>(0,kt.jsx)("optgroup",{label:e.label,children:e.items.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.label},e.id))},e.id))]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Name *"}),(0,kt.jsx)("input",{type:"text",value:ie.itemName,onChange:e=>le((0,Y.A)((0,Y.A)({},ie),{},{itemName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter item name",required:!0})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Responsible Role *"}),(0,kt.jsxs)("select",{value:ie.responsibleRole,onChange:e=>le((0,Y.A)((0,Y.A)({},ie),{},{responsibleRole:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,kt.jsx)("option",{value:"OFFICE",children:"Office"}),(0,kt.jsx)("option",{value:"ADMINISTRATION",children:"Administration"}),(0,kt.jsx)("option",{value:"PROJECT_MANAGER",children:"Project Manager"}),(0,kt.jsx)("option",{value:"FIELD_DIRECTOR",children:"Field Director"}),(0,kt.jsx)("option",{value:"ROOF_SUPERVISOR",children:"Roof Supervisor"}),(0,kt.jsx)("option",{value:"OFFICE_STAFF",children:"Office Staff"})]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,kt.jsx)("textarea",{value:ie.description,onChange:e=>le((0,Y.A)((0,Y.A)({},ie),{},{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter description (optional)",rows:"3"})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Minutes"}),(0,kt.jsx)("input",{type:"number",value:ie.estimatedMinutes,onChange:e=>le((0,Y.A)((0,Y.A)({},ie),{},{estimatedMinutes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"30",min:"1"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alert Days"}),(0,kt.jsx)("input",{type:"number",value:ie.alertDays,onChange:e=>le((0,Y.A)((0,Y.A)({},ie),{},{alertDays:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1",min:"1"})]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",checked:ie.addToAllWorkflows,onChange:e=>le(t=>(0,Y.A)((0,Y.A)({},t),{},{addToAllWorkflows:e.target.checked})),className:"mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Add this line item to every workflow permanently"})]}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"When checked, this line item will be added to all existing and future workflows of the same type"})]}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{oe(!1),le({itemName:"",responsibleRole:"WORKER",description:"",estimatedMinutes:30,alertDays:1,addToAllWorkflows:!1}),de(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:ue||!ce||!ie.itemName.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-[var(--color-success-green)] rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:ue?"Creating...":"Create Line Item"})]})]})]})})})]}):(0,kt.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,kt.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,kt.jsx)("div",{className:"text-yellow-600 font-semibold",children:"No Workflow Data Found"}),(0,kt.jsx)("div",{className:"text-yellow-500 text-sm mt-1",children:"Unable to load workflow structure from database."})]})}):(0,kt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,kt.jsx)("div",{className:"text-gray-500",children:"No project selected"})})},hl=((new Date).toLocaleString(),(new Date).toLocaleString(),(new Date).toLocaleString(),(new Date).toLocaleString(),(new Date).toLocaleString(),(new Date).toLocaleString(),(new Date).toLocaleString(),(new Date).toLocaleString(),(new Date).toLocaleString(),(new Date).toLocaleString(),["title","titleId"]);function ml(e,t){let{title:r,titleId:n}=e,s=Sn(e,hl);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"}))}const pl=o.forwardRef(ml),gl=["title","titleId"];function fl(e,t){let{title:r,titleId:n}=e,s=Sn(e,gl);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"}))}const xl=o.forwardRef(fl),vl=["title","titleId"];function yl(e,t){let{title:r,titleId:n}=e,s=Sn(e,vl);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}const bl=o.forwardRef(yl),wl=["title","titleId"];function jl(e,t){let{title:r,titleId:n}=e,s=Sn(e,wl);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const Nl=o.forwardRef(jl),Sl=["title","titleId"];function kl(e,t){let{title:r,titleId:n}=e,s=Sn(e,Sl);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const Al=o.forwardRef(kl),Cl=["title","titleId"];function El(e,t){let{title:r,titleId:n}=e,s=Sn(e,Cl);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"}))}const Pl=o.forwardRef(El),Il=["title","titleId"];function Tl(e,t){let{title:r,titleId:n}=e,s=Sn(e,Il);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const Dl=o.forwardRef(Tl),Ml=["title","titleId"];function _l(e,t){let{title:r,titleId:n}=e,s=Sn(e,Ml);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))}const Ol=o.forwardRef(_l),Ll=["title","titleId"];function Rl(e,t){let{title:r,titleId:n}=e,s=Sn(e,Ll);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const Fl=o.forwardRef(Rl),Ul=["title","titleId"];function Bl(e,t){let{title:r,titleId:n}=e,s=Sn(e,Ul);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const Wl=o.forwardRef(Bl),zl=["title","titleId"];function Vl(e,t){let{title:r,titleId:n}=e,s=Sn(e,zl);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const Hl=o.forwardRef(Vl),ql=["title","titleId"];function Kl(e,t){let{title:r,titleId:n}=e,s=Sn(e,ql);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"}))}const Gl=o.forwardRef(Kl),Jl=e=>{let{x:t,y:r,items:n,onClose:s}=e;const a=(0,o.useRef)(null);return(0,o.useEffect)(()=>{const e=e=>{a.current&&!a.current.contains(e.target)&&s()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[s]),(0,kt.jsx)("div",{ref:a,className:"fixed z-50 bg-white rounded-lg shadow-xl border border-gray-200 py-1 min-w-[180px]",style:{left:t,top:r},children:n.map((e,t)=>(0,kt.jsxs)("button",{onClick:()=>{e.onClick(),s()},disabled:e.disabled,className:"w-full px-4 py-2 text-left text-sm flex items-center gap-3 transition ".concat(e.danger?"text-red-600 hover:bg-red-50":"text-gray-700 hover:bg-gray-50"," ").concat(e.disabled?"opacity-50 cursor-not-allowed":""),children:[e.icon&&(0,kt.jsx)(e.icon,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:e.label})]},t))})},Yl=e=>{let{folder:t,level:r=0,isActive:n,onSelect:s,onContextMenu:a,draggingId:i}=e;const[l,c]=(0,o.useState)(0===r),d=t.children&&t.children.length>0;return(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition group ".concat(n?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),style:{paddingLeft:"".concat(8+16*r,"px"),opacity:i===t.id?.5:1},onClick:()=>s(t),onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),a(e,t)},draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/folder-id",t.id),e.stopPropagation()},children:[d?(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),c(!l)},className:"flex-shrink-0 hover:bg-gray-200 rounded p-0.5",children:l?(0,kt.jsx)(Ca,{className:"h-3.5 w-3.5"}):(0,kt.jsx)(Ia,{className:"h-3.5 w-3.5"})}):(0,kt.jsx)("div",{className:"w-4"}),l||n?(0,kt.jsx)(pl,{className:"h-4 w-4 flex-shrink-0 text-blue-600"}):(0,kt.jsx)(xl,{className:"h-4 w-4 flex-shrink-0 text-gray-400"}),(0,kt.jsx)("span",{className:"text-sm truncate flex-1",children:t.name}),d&&(0,kt.jsx)("span",{className:"text-xs text-gray-400",children:t.children.length})]}),l&&d&&(0,kt.jsx)("div",{children:t.children.map(e=>(0,kt.jsx)(Yl,{folder:e,level:r+1,isActive:!1,onSelect:s,onContextMenu:a,draggingId:i},e.id))})]})},Ql=e=>{var t;let{project:r,onBack:n,colorMode:s}=e;const a=Ct(),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)([]),[g,f]=(0,o.useState)("Technical"),[x,v]=(0,o.useState)(""),[y,b]=(0,o.useState)("grid"),[w,j]=(0,o.useState)(null),[N,S]=(0,o.useState)(new Set),[k,A]=(0,o.useState)(null),[C,E]=(0,o.useState)(!1),P=(0,o.useRef)(null),[I,T]=(0,o.useState)([{id:"legal",name:"Legal Documents",parentId:null,children:[]},{id:"technical",name:"Technical Specs",parentId:null,children:[]},{id:"photos",name:"Photos & Videos",parentId:null,children:[]}]),{data:D,isLoading:M,error:_}=Cs({queryKey:["projectDocuments",null===r||void 0===r?void 0:r.id,i],queryFn:async()=>{if(null===r||void 0===r||!r.id)return[];try{var e,t;const s=await Ds.default.get("/documents/project/".concat(r.id)),a=Array.isArray(null===(e=s.data)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.documents)?s.data.data.documents:[];let o=[];try{const e=await _s.assetsService.list({limit:1e3});o=(Array.isArray(null===e||void 0===e?void 0:e.assets)?e.assets:[]).filter(e=>{var t;return"FILE"===e.type&&(null===(t=e.metadata)||void 0===t?void 0:t.projectId)===r.id}).map(e=>(0,Y.A)((0,Y.A)({},e),{},{name:e.title,fileName:e.title,fileUrl:e.fileUrl,size:e.fileSize,createdAt:e.createdAt,_source:"companyAsset"}))}catch(n){console.warn("Failed to fetch company assets:",n)}return[...a,...o]}catch(ES){throw console.error("Error fetching project documents:",ES),ES}},enabled:!(null===r||void 0===r||!r.id)}),O=Array.isArray(D)?D:Array.isArray(null===D||void 0===D?void 0:D.data)?D.data:Array.isArray(null===D||void 0===D?void 0:D.documents)?D.documents:[],L=(0,o.useMemo)(()=>O.filter(e=>{const t=!i||e.folderId===i,r=!c||((null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.fileName)||"").toLowerCase().includes(c.toLowerCase());return t&&r}),[O,i,c]),R=Ts({mutationFn:async e=>{const t=e.getAll("files");if(!t||0===t.length)throw new Error("No files selected");const n=[];for(const i of t){const e=new FormData;e.append("file",i),e.append("projectId",r.id),e.append("fileName",i.name),e.append("description",x||"No description provided"),e.append("fileType",g||"OTHER"),e.append("tags",JSON.stringify([])),e.append("isPublic","false");const t=await Ds.default.post("/documents",e,{headers:{"Content-Type":"multipart/form-data"}});try{var s,a;await _s.assetsService.uploadFiles({files:[i],metadata:{projectId:null===r||void 0===r?void 0:r.id,projectNumber:null===r||void 0===r?void 0:r.projectNumber,category:g,source:"projectDocuments",documentId:null===(s=t.data)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.id},description:x||"Project ".concat(null===r||void 0===r?void 0:r.projectNumber," documents")})}catch(o){console.warn("Failed to sync to CompanyAssets:",o)}n.push(t.data)}return{success:!0,data:n}},onSuccess:()=>{a.invalidateQueries(["projectDocuments",null===r||void 0===r?void 0:r.id]),Vr.success("Documents uploaded successfully!"),h(!1),p([]),f("Technical"),v("")},onError:e=>{var t,r;Vr.error("Upload failed: ".concat((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}}),F=Ts({mutationFn:async e=>(await Ds.default.delete("/documents/".concat(e))).data,onSuccess:()=>{a.invalidateQueries(["projectDocuments",null===r||void 0===r?void 0:r.id]),Vr.success("Document deleted successfully!")},onError:e=>{var t,r;Vr.error("Delete failed: ".concat((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}}),U=e=>{e&&F.mutate(e)},B=e=>{const t=Number(e);if(!Number.isFinite(t)||t<=0)return"\u2014";if(t<1024)return"".concat(t," B");const r=["KB","MB","GB","TB"];let n=t/1024,s=0;for(;n>=1024&&s<r.length-1;)n/=1024,s+=1;return"".concat(n.toFixed(n>=100?0:n>=10?1:2)," ").concat(r[s])},W=async e=>{const t=(e=>null!==e&&void 0!==e&&e.fileUrl?/^https?:/i.test(e.fileUrl)?e.fileUrl:"".concat(Ds.API_ORIGIN).concat(e.fileUrl.startsWith("/")?"":"/").concat(e.fileUrl):null)(e);try{if(t)return void window.open(t,"_blank","noopener");if(null===e||void 0===e||!e.id)return void Vr.error("Document id missing.");const r=await Ds.documentsService.download(e.id),n=window.URL.createObjectURL(r.data);(e=>{const t=window.open("","_blank","noopener");t?t.location.href=e:Vr.error("Unable to open new tab. Please allow pop-ups.")})(n),setTimeout(()=>window.URL.revokeObjectURL(n),6e4)}catch(r){console.error("Document view failed:",r),Vr.error("Unable to open document preview.")}},z=(e,t)=>{e.preventDefault(),j({x:e.clientX,y:e.clientY,items:[{label:"Rename",icon:bl,onClick:()=>(e=>{const t=prompt("Enter new folder name:",e.name);t&&t!==e.name&&(T(I.map(r=>r.id===e.id?(0,Y.A)((0,Y.A)({},r),{},{name:t}):r)),Vr.success("Folder renamed!"))})(t)},{label:"Delete",icon:Nl,onClick:()=>(e=>{window.confirm('Delete folder "'.concat(e.name,'"?'))&&(T(I.filter(t=>t.id!==e.id)),i===e.id&&l(null),Vr.success("Folder deleted!"))})(t),danger:!0}]})},V=(e,t)=>{e.preventDefault(),j({x:e.clientX,y:e.clientY,items:[{label:"View",onClick:()=>W(t)},{label:"Download",onClick:()=>(async e=>{if(null!==e&&void 0!==e&&e.id)try{const t=(await Ds.documentsService.download(e.id)).data,r=window.URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=(e=>(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.fileName)||(null===e||void 0===e?void 0:e.originalName)||"Untitled Document")(e),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)}catch(t){console.error("Document download failed:",t),Vr.error("Unable to download document.")}else Vr.error("Document id missing.")})(t)},{label:"Delete",icon:Nl,onClick:()=>U(t.id),danger:!0}]})};return(0,o.useEffect)(()=>{const e=e=>{"Escape"===e.key&&(j(null),S(new Set)),("Delete"===e.key||"Backspace"===e.key)&&N.size>0&&(e.preventDefault(),window.confirm("Delete ".concat(N.size," item(s)?"))&&(N.forEach(e=>{const t=L.find(t=>t.id===e);t&&U(e)}),S(new Set)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[N,L]),(0,kt.jsxs)("div",{className:"h-screen flex bg-gray-100",children:[!C&&(0,kt.jsxs)("div",{className:"w-64 bg-white border-r border-gray-200 flex flex-col",children:[(0,kt.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,kt.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Folders"})}),(0,kt.jsxs)("div",{className:"flex-1 overflow-y-auto p-2",children:[(0,kt.jsxs)("button",{onClick:()=>l(null),className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg mb-2 ".concat(i?"text-gray-700 hover:bg-gray-50":"bg-blue-50 text-blue-700"),children:[(0,kt.jsx)(xl,{className:"h-4 w-4"}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:"All Documents"})]}),I.map(e=>(0,kt.jsx)(Yl,{folder:e,isActive:i===e.id,onSelect:e=>l(e.id),onContextMenu:z,draggingId:k},e.id))]}),(0,kt.jsx)("div",{className:"p-2 border-t border-gray-200",children:(0,kt.jsxs)("button",{onClick:()=>{const e=prompt("Enter folder name:");if(!e)return;const t={id:"folder-".concat(Date.now()),name:e,parentId:i,children:[]};T([...I,t]),Vr.success("Folder created!")},className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[(0,kt.jsx)(Al,{className:"h-4 w-4"}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:"New Folder"})]})})]}),(0,kt.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,kt.jsx)("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:(0,kt.jsxs)("div",{className:"px-6 py-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("button",{onClick:()=>E(!C),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:(0,kt.jsx)(Pl,{className:"h-5 w-5 text-gray-600"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:i?null===(t=I.find(e=>e.id===i))||void 0===t?void 0:t.name:"All Documents"}),(0,kt.jsx)("p",{className:"text-sm text-gray-600",children:(null===r||void 0===r?void 0:r.name)||"Project Name"})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>b("grid"===y?"list":"grid"),className:"p-2 hover:bg-gray-100 rounded-lg transition",title:"grid"===y?"List view":"Grid view",children:"grid"===y?(0,kt.jsx)(Pl,{className:"h-5 w-5 text-gray-600"}):(0,kt.jsx)(Dl,{className:"h-5 w-5 text-gray-600"})}),(0,kt.jsxs)("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-sm",children:[(0,kt.jsx)(Ol,{className:"h-4 w-4"}),(0,kt.jsx)("span",{className:"font-medium",children:"Upload"})]})]})]}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)(Fl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,kt.jsx)("input",{type:"text",placeholder:"Search documents...",value:c,onChange:e=>d(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),c&&(0,kt.jsx)("button",{onClick:()=>d(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,kt.jsx)(Wl,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]}),N.size>0&&(0,kt.jsxs)("div",{className:"mt-3 flex items-center gap-3 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,kt.jsxs)("span",{className:"text-sm font-medium text-blue-700",children:[N.size," selected"]}),(0,kt.jsx)("button",{onClick:()=>S(new Set),className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear"})]})]})}),(0,kt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[M&&(0,kt.jsxs)("div",{className:"flex justify-center items-center py-12",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,kt.jsx)("span",{className:"ml-4 text-lg text-gray-700",children:"Loading..."})]}),_&&(0,kt.jsxs)("div",{className:"text-center py-12 text-red-600",children:[(0,kt.jsx)("div",{className:"text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,kt.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Documents"}),(0,kt.jsx)("p",{className:"mb-4",children:_.message})]}),!M&&!_&&(0,kt.jsx)(kt.Fragment,{children:0===L.length?(0,kt.jsxs)("div",{className:"text-center py-16",children:[(0,kt.jsx)(Hl,{className:"h-24 w-24 text-gray-300 mx-auto mb-4"}),(0,kt.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No documents yet"}),(0,kt.jsx)("p",{className:"text-gray-500 mb-6",children:"Upload your first document to get started"}),(0,kt.jsxs)("button",{onClick:()=>h(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md",children:[(0,kt.jsx)(Ol,{className:"h-5 w-5"}),"Upload Documents"]})]}):(0,kt.jsx)("div",{className:"grid"===y?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4":"space-y-2",children:L.map(e=>{const t=N.has(e.id),r=k===e.id,n=(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.fileName)||(null===e||void 0===e?void 0:e.originalName)||"Untitled";return(0,kt.jsx)("div",{draggable:!0,onDragStart:t=>{t.dataTransfer.setData("text/doc-id",e.id),A(e.id)},onDragEnd:()=>A(null),onClick:t=>((e,t)=>{if(t.ctrlKey||t.metaKey){const t=new Set(N);t.has(e.id)?t.delete(e.id):t.add(e.id),S(t)}else S(new Set([e.id]))})(e,t),onContextMenu:t=>V(t,e),className:"group relative p-4 rounded-xl border-2 transition cursor-pointer ".concat(t?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300 hover:shadow-md"," ").concat(r?"opacity-50":""),children:"grid"===y?(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)(Hl,{className:"h-12 w-12 mx-auto mb-3 ".concat(t?"text-blue-600":"text-gray-400")}),(0,kt.jsx)("h4",{className:"text-sm font-semibold text-gray-900 truncate mb-1",title:n,children:n}),(0,kt.jsx)("p",{className:"text-xs text-gray-500",children:B(e.size||e.fileSize)}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),V(t,e)},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1.5 bg-white hover:bg-gray-100 rounded-lg shadow-sm transition",children:(0,kt.jsx)(Gl,{className:"h-4 w-4 text-gray-600"})})]}):(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)(Hl,{className:"h-6 w-6 flex-shrink-0 ".concat(t?"text-blue-600":"text-gray-400")}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:n}),(0,kt.jsx)("p",{className:"text-xs text-gray-500",children:B(e.size||e.fileSize)})]}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),V(t,e)},className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-100 rounded transition",children:(0,kt.jsx)(Gl,{className:"h-4 w-4 text-gray-600"})})]})},e.id)})})})]})]}),w&&(0,kt.jsx)(Jl,{x:w.x,y:w.y,items:w.items,onClose:()=>j(null)}),u&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"w-full max-w-md rounded-xl shadow-xl ".concat(s?"bg-gray-800":"bg-white"," p-6"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(s?"text-white":"text-gray-900"),children:"Upload Documents"}),(0,kt.jsx)("button",{onClick:()=>h(!1),className:"p-1 rounded-lg transition-colors duration-200 ".concat(s?"text-gray-400 hover:text-white hover:bg-gray-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:"\u2715"})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Select Files"}),(0,kt.jsxs)("div",{onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors duration-200 ".concat(s?"border-gray-600 hover:border-gray-500 text-gray-400 hover:text-gray-300":"border-gray-300 hover:border-gray-400 text-gray-600 hover:text-gray-700"),children:[(0,kt.jsx)("div",{className:"text-3xl mb-2",children:"\ud83d\udce4"}),(0,kt.jsx)("p",{className:"text-sm",children:"Click to select files or drag and drop"}),(0,kt.jsx)("p",{className:"text-xs mt-1",children:"Supports PDF, DOC, XLS, images, and more"})]}),(0,kt.jsx)("input",{ref:P,type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);p(t)},className:"hidden"}),m.length>0&&(0,kt.jsx)("div",{className:"mt-2 space-y-1",children:m.map((e,t)=>(0,kt.jsxs)("div",{className:"text-xs ".concat(s?"text-gray-400":"text-gray-600"),children:[e.name," (",(e.size/1048576).toFixed(1)," MB)"]},t))})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Category"}),(0,kt.jsxs)("select",{value:g,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border rounded-lg transition-colors duration-200 ".concat(s?"bg-gray-700 border-gray-600 text-white focus:border-blue-500 focus:ring-blue-500":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-blue-500"),children:[(0,kt.jsx)("option",{value:"Technical",children:"Technical Specs"}),(0,kt.jsx)("option",{value:"Legal",children:"Legal Documents"}),(0,kt.jsx)("option",{value:"Safety",children:"Safety & Compliance"}),(0,kt.jsx)("option",{value:"Visual",children:"Photos & Videos"}),(0,kt.jsx)("option",{value:"Financial",children:"Financial Records"}),(0,kt.jsx)("option",{value:"Communication",children:"Communication"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Description (Optional)"}),(0,kt.jsx)("textarea",{value:x,onChange:e=>v(e.target.value),placeholder:"Brief description of the documents...",rows:3,className:"w-full px-3 py-2 border rounded-lg transition-colors duration-200 resize-none ".concat(s?"bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-blue-500 focus:ring-blue-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500")})]}),(0,kt.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,kt.jsx)("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-2 border rounded-lg text-sm font-medium transition-colors duration-200 ".concat(s?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:()=>{if(0===m.length||null===r||void 0===r||!r.id)return;const e=new FormData;m.forEach(t=>{e.append("files",t)}),e.append("projectId",r.id),e.append("category",g),e.append("description",x||"No description provided"),R.mutate(e)},disabled:0===m.length||R.isPending,className:"flex-1 px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm transition-colors duration-200 ".concat(0===m.length||R.isPending?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white"),children:R.isPending?(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Uploading..."]}):"Upload ".concat(m.length>0?"(".concat(m.length,")"):"")})]})]})]})})]})},Xl=e=>{if(!e)return"(555) 555-5555";const t=e.replace(/\D/g,"");return e.match(/^\(\d{3}\) \d{3}-\d{4}$/)?e:10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):11===t.length&&t.startsWith("1")?"(".concat(t.slice(1,4),") ").concat(t.slice(4,7),"-").concat(t.slice(7)):"(555) 555-5555"};var $l=r(722);const Zl=(()=>{if("undefined"!==typeof window){const e=window.location.host;if(console.log("\ud83d\udd0d DOCUMENT SERVICE API CONFIG: Current host:",e),e.includes("ondigitalocean.app")){const t="".concat(window.location.protocol,"//").concat(e,"/api");return console.log("\ud83d\udd0d DOCUMENT SERVICE API CONFIG: Using production API:",t),t}}return{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL?(console.log("\ud83d\udd0d DOCUMENT SERVICE API CONFIG: Using env var API:",{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL),{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL):(console.log("\ud83d\udd0d DOCUMENT SERVICE API CONFIG: Using localhost fallback"),"http://localhost:5000/api")})(),ec=$l.A.create({baseURL:Zl,headers:{"Content-Type":"application/json"}});ec.interceptors.request.use(e=>{const t=localStorage.getItem("authToken")||localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),ec.interceptors.response.use(e=>e,e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)});const tc={getDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await ec.get("/documents-enhanced",{params:e})).data},getDocument:async e=>(await ec.get("/documents-enhanced/".concat(e))).data,uploadDocument:async e=>(await ec.post("/documents-enhanced",e,{headers:{"Content-Type":"multipart/form-data"}})).data,updateDocument:async(e,t)=>(await ec.put("/documents-enhanced/".concat(e),t)).data,deleteDocument:async e=>(await ec.delete("/documents-enhanced/".concat(e))).data,downloadDocument:async e=>(await ec.post("/documents-enhanced/".concat(e,"/download"))).data,download:async e=>await ec.get("/documents-enhanced/".concat(e,"/download"),{responseType:"blob"}),toggleFavorite:async e=>(await ec.post("/documents-enhanced/".concat(e,"/favorite"))).data,getCategories:async()=>(await ec.get("/documents-enhanced/categories")).data,getDocumentVersions:async e=>(await ec.get("/documents-enhanced/".concat(e,"/versions"))).data,addComment:async(e,t)=>(await ec.post("/documents-enhanced/".concat(e,"/comments"),t)).data,getComments:async e=>(await ec.get("/documents-enhanced/".concat(e,"/comments"))).data,updateComment:async(e,t,r)=>(await ec.put("/documents-enhanced/".concat(e,"/comments/").concat(t),r)).data,deleteComment:async(e,t)=>(await ec.delete("/documents-enhanced/".concat(e,"/comments/").concat(t))).data,getDocumentAccess:async e=>(await ec.get("/documents-enhanced/".concat(e,"/access"))).data,updateDocumentAccess:async(e,t)=>(await ec.put("/documents-enhanced/".concat(e,"/access"),t)).data,searchDocuments:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await ec.get("/documents-enhanced/search",{params:(0,Y.A)({q:e},t)})).data},getFavoriteDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await ec.get("/documents-enhanced/favorites",{params:e})).data},getRecentDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return(await ec.get("/documents-enhanced/recent",{params:{limit:e}})).data},getDocumentStats:async()=>(await ec.get("/documents-enhanced/stats")).data,bulkDownload:async e=>(await ec.post("/documents-enhanced/bulk-download",{documentIds:e})).data,bulkDelete:async e=>(await ec.post("/documents-enhanced/bulk-delete",{documentIds:e})).data,bulkUpdate:async(e,t)=>(await ec.post("/documents-enhanced/bulk-update",{documentIds:e,updateData:t})).data,getTemplates:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(await ec.get("/documents-enhanced/templates",{params:e?{category:e}:{}})).data},createFromTemplate:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await ec.post("/documents-enhanced/templates/".concat(e,"/create"),t)).data},shareDocument:async(e,t)=>(await ec.post("/documents-enhanced/".concat(e,"/share"),t)).data,getSharedDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await ec.get("/documents-enhanced/shared",{params:e})).data},revokeShare:async(e,t)=>(await ec.delete("/documents-enhanced/".concat(e,"/share/").concat(t))).data,getDocumentAnalytics:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"30d";return(await ec.get("/documents-enhanced/".concat(e,"/analytics"),{params:{period:t}})).data},getPopularDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await ec.get("/documents-enhanced/popular",{params:e})).data},createNewVersion:async(e,t)=>(await ec.post("/documents-enhanced/".concat(e,"/versions"),t,{headers:{"Content-Type":"multipart/form-data"}})).data,restoreVersion:async(e,t)=>(await ec.post("/documents-enhanced/".concat(e,"/versions/").concat(t,"/restore"))).data,archiveDocument:async e=>(await ec.post("/documents-enhanced/".concat(e,"/archive"))).data,restoreDocument:async e=>(await ec.post("/documents-enhanced/".concat(e,"/restore"))).data,getArchivedDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await ec.get("/documents-enhanced/archived",{params:e})).data}},rc=["title","titleId"];function nc(e,t){let{title:r,titleId:n}=e,s=Sn(e,rc);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const sc=o.forwardRef(nc),ac=e=>{let{project:t,colorMode:n,onProjectSelect:s}=e;const[a]=(0,o.useState)("overview"),[i,l]=((0,o.useRef)({}),(0,o.useState)({})),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!1),[g,f]=(0,o.useState)({address:"",customerName:"",customerPhone:"",customerEmail:"",secondaryName:"",secondaryPhone:"",secondaryEmail:"",pmName:"",pmPhone:"",pmEmail:"",pmId:""}),[x,v]=(0,o.useState)(!1),[y,b]=(0,o.useState)([]),[w,j]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{j(!0);try{var e;const{usersService:t}=await Promise.resolve().then(r.bind(r,505)),n=await t.getTeamMembers(),s=Array.isArray(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.teamMembers)?n.data.teamMembers:[];s.length>0?b(s):b([{id:1,firstName:"Mike",lastName:"Field",role:"Project Manager",email:"mike.field@company.com"},{id:2,firstName:"Sarah",lastName:"Johnson",role:"Office Manager",email:"sarah.johnson@company.com"},{id:3,firstName:"John",lastName:"Smith",role:"Field Director",email:"john.smith@company.com"},{id:4,firstName:"Emily",lastName:"Davis",role:"Administration",email:"emily.davis@company.com"},{id:5,firstName:"Robert",lastName:"Wilson",role:"Roof Supervisor",email:"robert.wilson@company.com"},{id:6,firstName:"Lisa",lastName:"Anderson",role:"Customer Service",email:"lisa.anderson@company.com"},{id:7,firstName:"David",lastName:"Martinez",role:"Estimator",email:"david.martinez@company.com"},{id:8,firstName:"Jennifer",lastName:"Brown",role:"Accounting",email:"jennifer.brown@company.com"}])}catch(t){console.error("Error loading users:",t),b([{id:1,firstName:"Mike",lastName:"Field",role:"Project Manager",email:"mike.field@company.com"},{id:2,firstName:"Sarah",lastName:"Johnson",role:"Office Manager",email:"sarah.johnson@company.com"},{id:3,firstName:"John",lastName:"Smith",role:"Field Director",email:"john.smith@company.com"},{id:4,firstName:"Emily",lastName:"Davis",role:"Administration",email:"emily.davis@company.com"},{id:5,firstName:"Robert",lastName:"Wilson",role:"Roof Supervisor",email:"robert.wilson@company.com"},{id:6,firstName:"Lisa",lastName:"Anderson",role:"Customer Service",email:"lisa.anderson@company.com"},{id:7,firstName:"David",lastName:"Martinez",role:"Estimator",email:"david.martinez@company.com"},{id:8,firstName:"Jennifer",lastName:"Brown",role:"Accounting",email:"jennifer.brown@company.com"}])}finally{j(!1)}})()},[]),(0,o.useEffect)(()=>{var e,r,n,s,a,o,i,l,c,d,u,h,m,p;t&&f({address:(null===(e=t.customer)||void 0===e?void 0:e.address)||"",customerName:(null===(r=t.customer)||void 0===r?void 0:r.primaryName)||(null===(n=t.customer)||void 0===n?void 0:n.name)||"",customerPhone:(null===(s=t.customer)||void 0===s?void 0:s.primaryPhone)||"",customerEmail:(null===(a=t.customer)||void 0===a?void 0:a.primaryEmail)||"",secondaryName:(null===(o=t.customer)||void 0===o?void 0:o.secondaryName)||"",secondaryPhone:(null===(i=t.customer)||void 0===i?void 0:i.secondaryPhone)||"",secondaryEmail:(null===(l=t.customer)||void 0===l?void 0:l.secondaryEmail)||"",pmName:null!==(c=t.projectManager)&&void 0!==c&&c.firstName&&null!==(d=t.projectManager)&&void 0!==d&&d.lastName?"".concat(t.projectManager.firstName," ").concat(t.projectManager.lastName).trim():(null===(u=t.projectManager)||void 0===u?void 0:u.name)||"",pmPhone:(null===(h=t.projectManager)||void 0===h?void 0:h.phone)||t.pmPhone||"",pmEmail:(null===(m=t.projectManager)||void 0===m?void 0:m.email)||t.pmEmail||"",pmId:(null===(p=t.projectManager)||void 0===p?void 0:p.id)||t.projectManagerId||""})},[t]);const N=()=>{h(!0)},S=()=>{p(!0)},k=()=>{var e,r,n,s,a,o,i,l,c,d,u,m,g,x;(h(!1),p(!1),t)&&f({address:(null===(e=t.customer)||void 0===e?void 0:e.address)||"",customerName:(null===(r=t.customer)||void 0===r?void 0:r.primaryName)||(null===(n=t.customer)||void 0===n?void 0:n.name)||"",customerPhone:(null===(s=t.customer)||void 0===s?void 0:s.primaryPhone)||"",customerEmail:(null===(a=t.customer)||void 0===a?void 0:a.primaryEmail)||"",secondaryName:(null===(o=t.customer)||void 0===o?void 0:o.secondaryName)||"",secondaryPhone:(null===(i=t.customer)||void 0===i?void 0:i.secondaryPhone)||"",secondaryEmail:(null===(l=t.customer)||void 0===l?void 0:l.secondaryEmail)||"",pmName:null!==(c=t.projectManager)&&void 0!==c&&c.firstName&&null!==(d=t.projectManager)&&void 0!==d&&d.lastName?"".concat(t.projectManager.firstName," ").concat(t.projectManager.lastName).trim():(null===(u=t.projectManager)||void 0===u?void 0:u.name)||"",pmPhone:(null===(m=t.projectManager)||void 0===m?void 0:m.phone)||t.pmPhone||"",pmEmail:(null===(g=t.projectManager)||void 0===g?void 0:g.email)||t.pmEmail||"",pmId:(null===(x=t.projectManager)||void 0===x?void 0:x.id)||t.projectManagerId||""})},A=async()=>{v(!0);try{var e;if(null!==(e=t.customer)&&void 0!==e&&e.id){const e={primaryName:g.customerName,primaryPhone:g.customerPhone,primaryEmail:g.customerEmail,secondaryName:g.secondaryName,secondaryPhone:g.secondaryPhone,secondaryEmail:g.secondaryEmail,address:g.address};Object.keys(e).forEach(t=>{""!==e[t]&&null!==e[t]||delete e[t]});const r=await Ds.customersService.update(t.customer.id,e);if(null===r||void 0===r||!r.success)throw new Error((null===r||void 0===r?void 0:r.message)||"Customer update failed")}const r={projectManagerId:g.pmId||null,pmPhone:g.pmPhone||null,pmEmail:g.pmEmail||null};Object.keys(r).forEach(e=>{""!==r[e]&&null!==r[e]||delete r[e]});const n=await Ds.projectsService.update(t.id,r);if(null===n||void 0===n||!n.success)throw new Error((null===n||void 0===n?void 0:n.message)||"Project update failed");h(!1),p(!1),Vr.success("Project information updated successfully!"),t.onUpdate&&t.onUpdate()}catch(s){var r,n;console.error("Error updating project:",s);const e=(null===s||void 0===s||null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||(null===s||void 0===s?void 0:s.message)||"Failed to update project information. Please try again.";Vr.error(e)}finally{v(!1)}};if(!t)return(0,kt.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"text-6xl mb-4",children:"\xf0\u0178\u201c\u2039"}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Project Selected"}),(0,kt.jsx)("p",{className:"text-gray-500",children:"Please select a project to view its profile information."})]})});const C=()=>{var e;return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-3 mb-4",children:[(0,kt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,kt.jsx)("span",{className:"text-sm font-bold text-blue-700",children:String(t.projectNumber||t.id||"")}),(0,kt.jsx)("h1",{className:"text-base font-semibold text-gray-900 truncate",children:t.projectName||t.name||"Project Profile"})]}),t.projectType&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold border ".concat(la(t.projectType)),children:ia(t.projectType)})]}),(0,kt.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-xs text-gray-700 truncate",children:[(0,kt.jsx)(jn,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),u?(0,kt.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,kt.jsx)(Si,{name:"address",value:g.address,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{address:e.target.value})),className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Project address",autoFocus:!0}),(0,kt.jsx)("button",{onClick:async()=>{try{var e;null!==(e=t.customer)&&void 0!==e&&e.id?await Ds.customersService.update(t.customer.id,{address:g.address}):await Ds.projectsService.update(t.id,{address:g.address}),h(!1),Vr.success("Address updated successfully!")}catch(r){console.error("Error updating address:",r),Vr.error("Failed to update address")}},className:"px-2 py-1 text-[11px] bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700",children:"Save"}),(0,kt.jsx)("button",{onClick:()=>{h(!1),f(e=>{var r;return(0,Y.A)((0,Y.A)({},e),{},{address:(null===(r=t.customer)||void 0===r?void 0:r.address)||t.address||""})})},className:"px-2 py-1 text-[11px] bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancel"})]}):(0,kt.jsxs)("div",{className:"flex items-center gap-2 min-w-0 w-full",children:[(0,kt.jsx)("span",{className:"truncate",children:(t.address||(null===(e=t.customer)||void 0===e?void 0:e.address)||"Address not provided").trim()}),(0,kt.jsx)("button",{onClick:N,className:"px-2 py-0.5 text-[11px] font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded",children:"Edit"})]})]})]})},E=()=>{var e;return(0,kt.jsx)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 mb-6 shadow-soft",children:(0,kt.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Phase"}),(0,kt.jsxs)("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded-lg text-sm font-semibold text-blue-800",children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full bg-[var(--color-primary-blueprint-blue)]"}),Bn.getPhaseName((null===(e=t.currentWorkflowItem)||void 0===e?void 0:e.phase)||Bn.getProjectPhase(t))]})]}),(0,kt.jsx)("div",{className:"hidden sm:block w-px h-6 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Section"}),(0,kt.jsxs)("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-sm font-semibold text-gray-800",children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-600"}),(()=>{const e=t.currentWorkflowItem;return null!==e&&void 0!==e&&e.sectionDisplayName?e.sectionDisplayName:null!==e&&void 0!==e&&e.sectionName?e.sectionName:null!==e&&void 0!==e&&e.section?e.section:"Not Available"})()]})]}),(0,kt.jsx)("div",{className:"hidden sm:block w-px h-6 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Line Item"}),(0,kt.jsxs)("button",{onClick:async()=>{if(!s)return console.error("\xf0\u0178\u017d\xaf LINE ITEM CLICKED! onProjectSelect is not available"),void Vr.error("Navigation failed: onProjectSelect not available");try{console.log("\xf0\u0178\u017d\xaf PROJECT PROFILE TAB: Line item clicked for project:",t.id);const r=null===t||void 0===t?void 0:t.currentWorkflowItem,n=Sa.getCurrentLineItem(t),a=(null===r||void 0===r?void 0:r.sectionId)||(null===r||void 0===r?void 0:r.section)||Sa.getCurrentSection(t),o=(null===r||void 0===r?void 0:r.phase)||Bn.getProjectPhase(t)||"LEAD";let i=(null===n||void 0===n?void 0:n.id)||"".concat(o,"-").concat(a,"-0"),l="string"===typeof a?a.toLowerCase().replace(/\s+/g,"-"):a||"";try{const e=await fetch("/api/workflow-data/project-position/".concat(t.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(e.ok){const t=await e.json();if(t.success&&t.data){const e=t.data;e.currentLineItemId&&(i=e.currentLineItemId),e.currentSectionId&&(l=e.currentSectionId)}}}catch(e){console.warn("\xf0\u0178\u017d\xaf PROJECT PROFILE TAB: Could not fetch position data, using fallback:",e)}const c=(0,Y.A)((0,Y.A)({},t),{},{navigationSource:"Project Profile Tab",returnToSection:"project-profile",highlightStep:(null===n||void 0===n?void 0:n.name)||"Line Item",highlightLineItem:(null===n||void 0===n?void 0:n.name)||"Line Item",targetPhase:o,targetSection:a,targetLineItem:(null===n||void 0===n?void 0:n.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:o,section:a,lineItem:(null===n||void 0===n?void 0:n.name)||"Line Item",stepName:(null===n||void 0===n?void 0:n.name)||"Line Item",lineItemId:i,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(i),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:l,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});s(c,"Project Workflow",null,"Project Profile",i,l)}catch(r){console.error("\xf0\u0178\u017d\xaf PROJECT PROFILE TAB: Error navigating to workflow:",r);const e=(0,Y.A)((0,Y.A)({},t),{},{navigationSource:"Project Profile Tab (Fallback)",returnToSection:"project-profile"});s(e,"Project Workflow",null,"Project Profile")}},className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm",children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"}),(()=>{const e=t.currentWorkflowItem;return null!==e&&void 0!==e&&e.lineItemDisplayName?e.lineItemDisplayName:null!==e&&void 0!==e&&e.lineItemName?e.lineItemName:null!==e&&void 0!==e&&e.lineItem?e.lineItem:"View Workflow"})()]})]})]})})},P=()=>{var e,r,n,s,a,o,i,l,c;return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-soft",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(dn,{className:"w-4 h-4 text-blue-600"}),(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Customer Information"})]}),!m&&(0,kt.jsx)("button",{onClick:S,className:"px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded",children:"Edit"})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs",children:[(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900",children:"Primary"}),(0,kt.jsx)("div",{className:"text-gray-800",children:(null===(e=t.customer)||void 0===e?void 0:e.primaryName)||(null===(r=t.customer)||void 0===r?void 0:r.name)||"Not Available"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(bn,{className:"w-3 h-3 text-green-600"}),(0,kt.jsx)("a",{href:"tel:".concat(((null===(n=t.customer)||void 0===n?void 0:n.primaryPhone)||"").replace(/[^\d+]/g,"")),className:"text-gray-700 hover:text-blue-600",children:null!==(s=t.customer)&&void 0!==s&&s.primaryPhone?Xl(t.customer.primaryPhone):"Not Available"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(wn,{className:"w-3 h-3 text-blue-600"}),(0,kt.jsx)("a",{href:"mailto:".concat((null===(a=t.customer)||void 0===a?void 0:a.primaryEmail)||""),className:"text-gray-700 hover:text-blue-600",children:(null===(o=t.customer)||void 0===o?void 0:o.primaryEmail)||"Not Available"})]})]}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900",children:"Secondary"}),(0,kt.jsx)("div",{className:"text-gray-800",children:(null===(i=t.customer)||void 0===i?void 0:i.secondaryName)||"Not Provided"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(bn,{className:"w-3 h-3 text-green-600"}),null!==(l=t.customer)&&void 0!==l&&l.secondaryPhone?(0,kt.jsx)("a",{href:"tel:".concat(t.customer.secondaryPhone.replace(/[^\d+]/g,"")),className:"text-gray-700 hover:text-blue-600",children:Xl(t.customer.secondaryPhone)}):(0,kt.jsx)("span",{className:"text-gray-500",children:"Not Provided"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(wn,{className:"w-3 h-3 text-blue-600"}),null!==(c=t.customer)&&void 0!==c&&c.secondaryEmail?(0,kt.jsx)("a",{href:"mailto:".concat(t.customer.secondaryEmail),className:"text-gray-700 hover:text-blue-600",children:t.customer.secondaryEmail}):(0,kt.jsx)("span",{className:"text-gray-500",children:"Not Provided"})]})]})]}),(0,kt.jsx)(D,{})]})},I=()=>{var e,r,n,s,a,o,i,l;const u=null!==(h=t)&&void 0!==h&&h.trades&&h.trades.length>0?h.trades:[{name:(null===h||void 0===h?void 0:h.projectType)||(null===h||void 0===h?void 0:h.type)||"General",laborProgress:(null===h||void 0===h?void 0:h.progress)||0,materialsDelivered:(null===h||void 0===h?void 0:h.materialsDelivered)||!1}];var h;const m=Math.round(u.reduce((e,t)=>e+(t.laborProgress||0),0)/(u.length||1)),p=Math.round(u.filter(e=>e.materialsDelivered).length/u.length*100);return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-soft",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center",children:(0,kt.jsx)(en,{className:"w-5 h-5 text-white"})}),(0,kt.jsx)("div",{children:(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-900 leading-5",children:"Project Progress"})})]}),(0,kt.jsxs)("div",{className:"text-right text-xs text-gray-700 w-56 overflow-hidden",children:[(0,kt.jsx)("div",{className:"font-semibold truncate",title:null!==(e=t.projectManager)&&void 0!==e&&e.firstName&&null!==(r=t.projectManager)&&void 0!==r&&r.lastName?"".concat(t.projectManager.firstName," ").concat(t.projectManager.lastName):(null===(n=t.projectManager)||void 0===n?void 0:n.name)||"PM: Not Assigned",children:null!==(s=t.projectManager)&&void 0!==s&&s.firstName&&null!==(a=t.projectManager)&&void 0!==a&&a.lastName?"".concat(t.projectManager.firstName," ").concat(t.projectManager.lastName):(null===(o=t.projectManager)||void 0===o?void 0:o.name)||"PM: Not Assigned"}),(null===(i=t.projectManager)||void 0===i?void 0:i.email)&&(0,kt.jsx)("div",{className:"truncate",title:t.projectManager.email,children:t.projectManager.email}),(null===(l=t.projectManager)||void 0===l?void 0:l.phone)&&(0,kt.jsx)("div",{className:"truncate",title:t.projectManager.phone,children:Xl(t.projectManager.phone)})]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Overall Progress"}),(0,kt.jsxs)("span",{className:"text-xs font-bold text-gray-900",children:[m,"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-2.5 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full rounded-full transition-all duration-500 ease-out ".concat(100===m?"bg-gradient-to-r from-green-500 to-emerald-600":"bg-gradient-to-r from-blue-500 to-indigo-600"),style:{width:"".concat(m,"%")},children:m>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Materials Delivered"}),(0,kt.jsxs)("span",{className:"text-xs font-bold text-gray-900",children:[p,"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-600 rounded-full transition-all duration-500",style:{width:"".concat(p,"%")}})})]}),(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Trade Breakdown"}),(0,kt.jsx)("button",{onClick:()=>d(!c),className:"inline-flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:c?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"Hide Details"}),(0,kt.jsx)(mn,{className:"w-4 h-4"})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"Show Details"}),(0,kt.jsx)(tn,{className:"w-4 h-4"})]})})]}),c&&(0,kt.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pt-3 border-t border-gray-200",children:u.map((e,t)=>{const r=["from-purple-500 to-purple-600","from-pink-500 to-pink-600","from-yellow-500 to-yellow-600","from-teal-500 to-teal-600","from-red-500 to-red-600","from-indigo-500 to-indigo-600","from-cyan-500 to-cyan-600","from-amber-500 to-amber-600","from-lime-500 to-lime-600","from-fuchsia-500 to-fuchsia-600"],n=r[t%r.length];return(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-800 truncate",children:e.name}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[e.laborProgress,"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full bg-gradient-to-r ".concat(n," rounded-full transition-all duration-500"),style:{width:"".concat(e.laborProgress,"%")}})})]},t)})})]})]})},T=()=>{const[e,n]=(0,o.useState)([]),[s,a]=(0,o.useState)(!1),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)([]),[m,p]=(0,o.useState)(!1),g=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=!1;return(async()=>{if(null!==t&&void 0!==t&&t.id)try{var r;a(!0),l("");const s=await Ds.documentsService.getByProject(t.id);if(e)return;n(Array.isArray(null===s||void 0===s||null===(r=s.data)||void 0===r?void 0:r.documents)?s.data.documents:[])}catch(It){e||l(It.message||"Failed to load documents")}finally{e||a(!1)}})(),()=>{e=!0}},[null===t||void 0===t?void 0:t.id]);const f=e=>{const t=parseInt(e,10)||0;if(t<1024)return"".concat(t," B");const r=t/1024;if(r<1024)return"".concat(Math.round(r)," KB");return"".concat((r/1024).toFixed(1)," MB")},x="minmax(240px,1fr) 140px 90px 120px 160px";return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-soft mt-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Documents"}),(0,kt.jsxs)("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-lg hover:bg-blue-700 transition shadow-sm",children:[(0,kt.jsx)(sc,{className:"w-4 h-4"}),"Upload"]})]}),i&&(0,kt.jsx)("div",{className:"text-xs text-red-600 mb-2",children:i}),s?(0,kt.jsx)("div",{className:"text-xs text-gray-600",children:"Loading\xe2\u20ac\xa6"}):0===e.length?(0,kt.jsx)("div",{className:"text-xs text-gray-500",children:"No documents yet"}):(0,kt.jsxs)("div",{className:"overflow-x-auto",children:[(0,kt.jsxs)("div",{className:"min-w-[780px] grid gap-2 items-center px-2 py-1 border-b text-[11px] text-gray-500",style:{gridTemplateColumns:x},children:[(0,kt.jsx)("div",{children:"Name"}),(0,kt.jsx)("div",{children:"Type"}),(0,kt.jsx)("div",{children:"Size"}),(0,kt.jsx)("div",{children:"Uploaded"}),(0,kt.jsx)("div",{className:"text-right pr-1",children:"Actions"})]}),e.map(e=>(0,kt.jsxs)("div",{className:"min-w-[780px] grid gap-2 items-center px-2 py-2 border-b text-xs",style:{gridTemplateColumns:x},children:[(0,kt.jsx)("div",{className:"font-medium text-blue-700 whitespace-nowrap overflow-hidden text-ellipsis",title:e.originalName||e.fileName,children:e.originalName||e.fileName}),(0,kt.jsx)("div",{className:"text-gray-700 truncate",title:e.mimeType||e.fileType,children:e.mimeType||e.fileType}),(0,kt.jsx)("div",{className:"text-gray-700",children:f(e.fileSize)}),(0,kt.jsx)("div",{className:"text-gray-700",children:new Date(e.createdAt||e.updatedAt||Date.now()).toLocaleDateString()}),(0,kt.jsxs)("div",{className:"text-right space-x-3",children:[(0,kt.jsx)("button",{onClick:async t=>{t.preventDefault();try{const t=(await Ds.documentsService.download(e.id)).data,r=window.URL.createObjectURL(t);window.open(r,"_blank","noopener"),setTimeout(()=>window.URL.revokeObjectURL(r),6e4)}catch(r){console.error("Preview failed:",r),Vr.error("Failed to preview document")}},className:"text-blue-600 hover:underline cursor-pointer",children:"Preview"}),(0,kt.jsx)("button",{onClick:async t=>{t.preventDefault();try{const t=(await Ds.documentsService.download(e.id)).data,r=window.URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=e.originalName||e.fileName||"document",document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)}catch(r){console.error("Download failed:",r),Vr.error("Failed to download document")}},className:"text-blue-600 hover:underline cursor-pointer",children:"Download"})]})]},e.id))]}),c&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 max-w-md w-full",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Upload Documents"}),(0,kt.jsx)("button",{onClick:()=>{d(!1),h([])},className:"text-gray-400 hover:text-gray-600",children:(0,kt.jsx)($r,{className:"w-5 h-5"})})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-700",children:"Select Files"}),(0,kt.jsxs)("div",{onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-gray-400 transition",children:[(0,kt.jsx)(sc,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),(0,kt.jsx)("p",{className:"text-sm text-gray-600",children:"Click to select files"}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PDF, DOC, XLS, images, and more"})]}),(0,kt.jsx)("input",{ref:g,type:"file",multiple:!0,onChange:e=>h(Array.from(e.target.files||[])),className:"hidden"}),u.length>0&&(0,kt.jsx)("div",{className:"mt-2 space-y-1",children:u.map((e,t)=>(0,kt.jsxs)("div",{className:"text-xs text-gray-600",children:[e.name," (",(e.size/1048576).toFixed(1)," MB)"]},t))})]}),(0,kt.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,kt.jsx)("button",{onClick:()=>{d(!1),h([])},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(0!==u.length&&null!==t&&void 0!==t&&t.id){p(!0);try{var e,s,a,o,i,l,c;const{assetsService:p}=await Promise.resolve().then(r.bind(r,877));let x=(await p.listFolders({parentId:null,sortBy:"title",sortOrder:"asc",limit:1e3})).find(e=>"Projects"===(e.folderName||e.title));var m;if(!x)x=await p.createFolder({name:"Projects",parentId:null}),"function"===typeof(null===(m=window)||void 0===m?void 0:m.dispatchEvent)&&window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:null}}));if(!x||!x.id)throw new Error("Failed to get or create Projects root folder");const v=await p.listFolders({parentId:x.id,sortBy:"title",sortOrder:"asc",limit:1e3}),y=(null===(e=t.customer)||void 0===e?void 0:e.primaryName)||(null===(s=t.customer)||void 0===s?void 0:s.firstName)+" "+(null===(a=t.customer)||void 0===a?void 0:a.lastName)||t.customerName||"Unknown",b="".concat(t.projectNumber," - ").concat(y);let w=null;if(t.projectNumber&&(w=v.find(e=>{var r;return(null===(r=e.metadata)||void 0===r?void 0:r.projectNumber)===t.projectNumber}),console.log("\ud83d\udd0d Searching for project folder by project number:",t.projectNumber,"Found:",!!w),w&&console.log("\ud83d\udcc1 Found project folder by number:",w.title||w.folderName)),w||(w=v.find(e=>(e.folderName||e.title)===b),console.log("\ud83d\udd0d Searching for project folder by name:",b,"Found:",!!w)),!w){const e={projectId:t.id,projectNumber:t.projectNumber,customerName:y,address:t.projectName||t.name||"",isProjectFolder:!0};w=await p.createFolder({name:b,parentId:x.id,metadata:e})}console.log("\ud83d\udcc1 Using project folder for assets:",null===(o=w)||void 0===o?void 0:o.id,null===(i=w)||void 0===i?void 0:i.title);for(const e of u){var g;const r=new FormData;r.append("file",e),r.append("projectId",t.id),r.append("description","Uploaded from Project Profile"),r.append("fileType","OTHER"),r.append("isPublic","false"),await tc.uploadDocument(r),await p.uploadFiles({files:[e],parentId:(null===(g=w)||void 0===g?void 0:g.id)||null,description:"Uploaded from Project Profile",tags:[]})}var f;if("function"===typeof(null===(l=window)||void 0===l?void 0:l.dispatchEvent))window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:(null===(f=w)||void 0===f?void 0:f.id)||null}})),window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:null}}));Vr.success("Documents uploaded and organized in project folder!"),d(!1),h([]);const j=await Ds.documentsService.getByProject(t.id);n(Array.isArray(null===j||void 0===j||null===(c=j.data)||void 0===c?void 0:c.documents)?j.data.documents:[])}catch(x){console.error("Upload failed:",x),Vr.error("Upload failed: ".concat(x.message))}finally{p(!1)}}},disabled:0===u.length||m,className:"flex-1 px-4 py-2 rounded-lg font-medium transition ".concat(0===u.length||m?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:m?"Uploading...":"Upload ".concat(u.length>0?"(".concat(u.length,")"):"")})]})]})]})})]})},D=()=>m?(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Edit Contact Information"}),(0,kt.jsx)("button",{onClick:k,className:"text-gray-400 hover:text-gray-600",children:(0,kt.jsx)($r,{className:"w-6 h-6"})})]}),(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold text-blue-700 border-b border-blue-200 pb-2",children:"Primary Customer"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsx)("input",{type:"text",value:g.customerName,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{customerName:e.target.value})),placeholder:"Customer Name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"tel",value:g.customerPhone,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{customerPhone:e.target.value})),placeholder:"Phone Number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"email",value:g.customerEmail,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{customerEmail:e.target.value})),placeholder:"Email Address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold text-purple-700 border-b border-purple-200 pb-2",children:"Project Manager"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsxs)("select",{value:g.pmId,onChange:e=>{const t=y.find(t=>t.id.toString()===e.target.value);f(r=>(0,Y.A)((0,Y.A)({},r),{},{pmId:e.target.value,pmName:t?"".concat(t.firstName," ").concat(t.lastName):"",pmEmail:(null===t||void 0===t?void 0:t.email)||"",pmPhone:(null===t||void 0===t?void 0:t.phone)||""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:w,children:[(0,kt.jsx)("option",{value:"",children:w?"\xe2\x8f\xb3 Loading users...":"\xf0\u0178\u2018\xa4 Select Project Manager"}),y.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),(0,kt.jsx)("input",{type:"tel",value:g.pmPhone,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{pmPhone:e.target.value})),placeholder:"Phone Number (Optional)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"email",value:g.pmEmail,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{pmEmail:e.target.value})),placeholder:"Email Address (Optional)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold text-gray-600 border-b border-gray-200 pb-2",children:"Secondary Contact (Optional)"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsx)("input",{type:"text",value:g.secondaryName,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{secondaryName:e.target.value})),placeholder:"Secondary Contact Name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"tel",value:g.secondaryPhone,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{secondaryPhone:e.target.value})),placeholder:"Phone Number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"email",value:g.secondaryEmail,onChange:e=>f(t=>(0,Y.A)((0,Y.A)({},t),{},{secondaryEmail:e.target.value})),placeholder:"Email Address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 mt-8 pt-6 border-t border-gray-200",children:[(0,kt.jsx)("button",{onClick:A,disabled:x,className:"flex-1 px-4 py-3 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 font-medium transition-colors",children:x?"Saving...":"Save Changes"}),(0,kt.jsx)("button",{onClick:k,disabled:x,className:"flex-1 px-4 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 disabled:opacity-50 font-medium transition-colors",children:"Cancel"})]})]})}):null,M=()=>{var e;const r=(null===(e=t.teamMembers)||void 0===e?void 0:e.filter(e=>"SUBCONTRACTOR"===e.role))||[];return 0===r.length?null:(0,kt.jsxs)("div",{className:"rounded-lg shadow-sm border p-4 ".concat(n?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,kt.jsx)("span",{className:"text-lg",children:"\ud83d\udd28"}),(0,kt.jsxs)("h3",{className:"text-sm font-semibold ".concat(n?"text-orange-300":"text-orange-700"),children:["Subcontractors (",r.length,")"]})]}),(0,kt.jsx)("div",{className:"space-y-2",children:r.map((e,t)=>{var r,s,a,o,i,l,c;return(0,kt.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded ".concat(n?"bg-orange-900/20":"bg-orange-50"),children:[(0,kt.jsxs)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold ".concat(n?"bg-orange-700 text-orange-100":"bg-orange-200 text-orange-800"),children:[null===(r=e.user)||void 0===r||null===(s=r.firstName)||void 0===s?void 0:s[0],null===(a=e.user)||void 0===a||null===(o=a.lastName)||void 0===o?void 0:o[0]]}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"text-sm font-medium truncate ".concat(n?"text-gray-200":"text-gray-900"),children:[null===(i=e.user)||void 0===i?void 0:i.firstName," ",null===(l=e.user)||void 0===l?void 0:l.lastName]}),(null===(c=e.user)||void 0===c?void 0:c.email)&&(0,kt.jsx)("div",{className:"text-xs truncate ".concat(n?"text-gray-400":"text-gray-600"),children:e.user.email})]})]},e.id||t)})})]})};return(0,kt.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,kt.jsx)(C,{}),(0,kt.jsx)(E,{}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,kt.jsx)(P,{}),(0,kt.jsx)(T,{})]}),(0,kt.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,kt.jsx)(I,{}),(0,kt.jsx)(M,{})]})]})]})};function oc(e){let{timeline:t=[],currentStep:r=0}=e;const[n,s]=(0,o.useState)(new Set),a=t.length,i=Math.min(Math.max(r,0),a),l=a>0&&r<a?Math.min(Math.max(r,0),a-1):-1,c=l>=0?t[l]:null,d=a>0?i/a*100:0;return(0,kt.jsxs)("div",{className:"card-surface backdrop-blur-sm rounded-xl shadow-soft border border-gray-200/50 p-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(26, 90, 153, 0.95), rgba(26, 90, 153, 0.7))",color:"var(--color-surface-white)"},children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,kt.jsx)("div",{children:(0,kt.jsx)("h3",{className:"text-base font-bold text-gray-800",children:"Project Timeline"})})]}),(0,kt.jsxs)("div",{className:"mb-5",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between text-xs font-semibold text-gray-600 mb-2",children:[(0,kt.jsx)("span",{children:"Overall Progress"}),(0,kt.jsxs)("span",{className:"text-gray-800",children:[Math.round(d),"%"]})]}),(0,kt.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,kt.jsx)("div",{className:"h-2 rounded-full transition-all duration-500 ease-out",style:{background:"linear-gradient(90deg, var(--color-primary-blueprint-blue), var(--color-success-green))",width:"".concat(d,"%")}})})]}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsxs)("div",{className:"flex items-center mb-3",children:[(0,kt.jsx)("div",{className:"w-20 text-xs font-medium text-gray-600",children:"Phases"}),(0,kt.jsx)("div",{className:"flex-1 flex items-center justify-between text-xs text-gray-500",children:t.map((e,t)=>(0,kt.jsx)("span",{className:"text-center",children:t+1},t))})]}),(0,kt.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>{const r=n.has(e.phase),a=t<i,o=t===l;return(0,kt.jsxs)("div",{className:"group",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-20 flex-shrink-0",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-3 h-3 rounded-full border-2 transition-all duration-200",style:{backgroundColor:a?"var(--color-success-green)":o?"var(--color-primary-blueprint-blue)":"var(--color-background-gray)",borderColor:a?"var(--color-success-green)":o?"var(--color-primary-blueprint-blue)":"var(--color-border-gray)",boxShadow:o?"0 0 0 4px rgba(26, 90, 153, 0.15)":"none"}}),(0,kt.jsx)("span",{className:"text-xs font-semibold text-gray-800 truncate",children:e.phase})]})}),(0,kt.jsx)("div",{className:"flex-1 relative",children:(0,kt.jsxs)("div",{className:"relative h-8 rounded-lg overflow-hidden",style:{backgroundColor:"var(--color-background-gray)"},children:[(0,kt.jsx)("div",{className:"h-full transition-all duration-500 ease-out rounded-lg",style:{background:a?"linear-gradient(90deg, var(--color-success-green), rgba(16, 185, 129, 0.8))":o?"linear-gradient(90deg, var(--color-primary-blueprint-blue), rgba(26, 90, 153, 0.75))":"var(--color-border-gray)",width:a?"100%":o?"50%":"0%"}}),(0,kt.jsxs)("div",{className:"absolute inset-0 flex items-center justify-between px-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-white drop-shadow-sm",children:e.phase}),o&&(0,kt.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"})]}),(0,kt.jsxs)("div",{className:"text-right",children:[(0,kt.jsx)("div",{className:"text-xs font-medium text-white drop-shadow-sm",children:e.date}),(0,kt.jsx)("div",{className:"text-xs text-white/80 drop-shadow-sm",children:e.responsible})]})]})]})}),(0,kt.jsx)("button",{onClick:()=>{return t=e.phase,void s(e=>{const r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r});var t},className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 transition-colors",children:r?(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 15l7-7 7 7"})}):(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),r&&(0,kt.jsxs)("div",{className:"ml-20 mt-2 bg-gray-50/80 rounded-lg p-3 border border-gray-100",children:[(0,kt.jsxs)("div",{className:"mb-2",children:[(0,kt.jsx)("h5",{className:"text-xs font-semibold text-gray-700 mb-1",children:e.label}),(0,kt.jsx)("p",{className:"text-xs text-gray-600 leading-relaxed",children:e.detail})]}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsx)("h6",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Key Tasks:"}),(0,kt.jsx)("div",{className:"space-y-0.5",children:(e.tasks||[]).map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center gap-1.5 text-xs",children:[(0,kt.jsx)("div",{className:"w-1 h-1 rounded-full",style:{backgroundColor:a?"var(--color-success-green)":o?"var(--color-primary-blueprint-blue)":"var(--color-border-gray)"}}),(0,kt.jsx)("span",{className:"text-gray-700",children:e})]},t))})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-gray-100",children:[(0,kt.jsx)("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:a?"var(--color-success-green)":o?"var(--color-primary-blueprint-blue)":"var(--color-border-gray)",animation:o?"pulse 2s infinite":"none"}}),(0,kt.jsx)("span",{className:"text-xs font-medium",style:{color:a?"var(--color-success-green)":o?"var(--color-primary-blueprint-blue)":"var(--color-text-slate-gray)"},children:a?"Completed":o?"In Progress":"Pending"})]})]})]},e.phase)})}),(0,kt.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{className:"rounded-lg p-2 border",style:{backgroundColor:"var(--color-primary-light-tint)",borderColor:"color-mix(in srgb, var(--color-primary-blueprint-blue) 35%, var(--color-surface-white) 65%)"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--color-primary-blueprint-blue)"}}),(0,kt.jsx)("span",{className:"text-xs font-semibold",style:{color:"var(--color-primary-blueprint-blue)"},children:"Current Phase"})]}),(0,kt.jsx)("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-blueprint-blue)"},children:(null===c||void 0===c?void 0:c.phase)||"Project Complete"}),(0,kt.jsx)("p",{className:"text-xs",style:{color:"var(--color-primary-blueprint-blue)"},children:(null===c||void 0===c?void 0:c.responsible)||"All phases complete"})]}),(0,kt.jsxs)("div",{className:"rounded-lg p-2 border",style:{backgroundColor:"rgba(16, 185, 129, 0.08)",borderColor:"rgba(16, 185, 129, 0.25)"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--color-success-green)"}}),(0,kt.jsx)("span",{className:"text-xs font-semibold",style:{color:"var(--color-success-green)"},children:"Completed"})]}),(0,kt.jsxs)("p",{className:"text-xs font-medium",style:{color:"var(--color-success-green)"},children:[i," of ",a," phases"]}),(0,kt.jsxs)("p",{className:"text-xs",style:{color:"var(--color-success-green)"},children:[Math.round(d),"% complete"]})]})]})]})]})}var ic={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},lc=o.createContext&&o.createContext(ic),cc=["attr","size","title"];function dc(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}function uc(){return uc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uc.apply(this,arguments)}function hc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function mc(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hc(Object(r),!0).forEach(function(t){pc(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hc(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function pc(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gc(e){return e&&e.map((e,t)=>o.createElement(e.tag,mc({key:t},e.attr),gc(e.child)))}function fc(e){return t=>o.createElement(xc,uc({attr:mc({},e.attr)},t),gc(e.child))}function xc(e){var t=t=>{var r,{attr:n,size:s,title:a}=e,i=dc(e,cc),l=s||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),o.createElement("svg",uc({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,i,{className:r,style:mc(mc({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),a&&o.createElement("title",null,a),e.children)};return void 0!==lc?o.createElement(lc.Consumer,null,e=>t(e)):t(ic)}function vc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"12"},child:[]},{tag:"line",attr:{x1:"12",y1:"16",x2:"12.01",y2:"16"},child:[]}]})(e)}function yc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"},child:[]}]})(e)}function bc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"polyline",attr:{points:"12 6 12 12 16 14"},child:[]}]})(e)}function wc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"7 10 12 15 17 10"},child:[]},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"},child:[]}]})(e)}function jc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"},child:[]},{tag:"polyline",attr:{points:"15 3 21 3 21 9"},child:[]},{tag:"line",attr:{x1:"10",y1:"14",x2:"21",y2:"3"},child:[]}]})(e)}function Nc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"},child:[]}]})(e)}function Sc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"},child:[]},{tag:"polyline",attr:{points:"22,6 12,13 2,6"},child:[]}]})(e)}function kc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"},child:[]}]})(e)}function Ac(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 4 23 10 17 10"},child:[]},{tag:"polyline",attr:{points:"1 20 1 14 7 14"},child:[]},{tag:"path",attr:{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"},child:[]}]})(e)}function Cc(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"},child:[]}]})(e)}function Ec(e){return fc({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"},child:[]},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"},child:[]}]})(e)}function Pc(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Ic(e){return Pc(e,Date.now())}function Tc(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"===typeof e&&"[object Date]"===t?new e.constructor(+e):"number"===typeof e||"[object Number]"===t||"string"===typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function Dc(e,t){const r=Tc(e),n=Tc(t),s=r.getTime()-n.getTime();return s<0?-1:s>0?1:s}Math.pow(10,8);const Mc=6048e5,_c=43200;function Oc(e,t){const r=Tc(e),n=Tc(t);return 12*(r.getFullYear()-n.getFullYear())+(r.getMonth()-n.getMonth())}function Lc(e){const t=Tc(e);return t.setHours(23,59,59,999),t}function Rc(e){const t=Tc(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function Fc(e){const t=Tc(e);return+Lc(t)===+Rc(t)}function Uc(e,t){const r=Tc(e),n=Tc(t),s=Dc(r,n),a=Math.abs(Oc(r,n));let o;if(a<1)o=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*a);let t=Dc(r,n)===-s;Fc(Tc(e))&&1===a&&1===Dc(e,n)&&(t=!1),o=s*(a-Number(t))}return 0===o?0:o}function Bc(e,t){return+Tc(e)-+Tc(t)}function Wc(e,t,r){const n=Bc(e,t)/1e3;return(s=null===r||void 0===r?void 0:r.roundingMethod,e=>{const t=(s?Math[s]:Math.trunc)(e);return 0===t?0:t})(n);var s}const zc={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Vc(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const Hc={date:Vc({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Vc({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Vc({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},qc={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Kc(e){return(t,r)=>{let n;if("formatting"===(null!==r&&void 0!==r&&r.context?String(r.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,s=null!==r&&void 0!==r&&r.width?String(r.width):t;n=e.formattingValues[s]||e.formattingValues[t]}else{const t=e.defaultWidth,s=null!==r&&void 0!==r&&r.width?String(r.width):e.defaultWidth;n=e.values[s]||e.values[t]}return n[e.argumentCallback?e.argumentCallback(t):t]}}const Gc={ordinalNumber:(e,t)=>{const r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:Kc({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Kc({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:Kc({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Kc({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Kc({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function Jc(e){return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=r.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],a=t.match(s);if(!a)return null;const o=a[0],i=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(i)?function(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r;return}(i,e=>e.test(o)):function(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r;return}(i,e=>e.test(o));let c;c=e.valueCallback?e.valueCallback(l):l,c=r.valueCallback?r.valueCallback(c):c;return{value:c,rest:t.slice(o.length)}}}const Yc={ordinalNumber:(Qc={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.match(Qc.matchPattern);if(!r)return null;const n=r[0],s=e.match(Qc.parsePattern);if(!s)return null;let a=Qc.valueCallback?Qc.valueCallback(s[0]):s[0];return a=t.valueCallback?t.valueCallback(a):a,{value:a,rest:e.slice(n.length)}}),era:Jc({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Jc({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:Jc({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Jc({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Jc({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})};var Qc;const Xc={code:"en-US",formatDistance:(e,t,r)=>{let n;const s=zc[e];return n="string"===typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),null!==r&&void 0!==r&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n},formatLong:Hc,formatRelative:(e,t,r,n)=>qc[e],localize:Gc,match:Yc,options:{weekStartsOn:0,firstWeekContainsDate:1}};let $c={};function Zc(){return $c}function ed(e){const t=Tc(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function td(e,t,r){var n,s;const a=Zc(),o=null!==(n=null!==(s=null===r||void 0===r?void 0:r.locale)&&void 0!==s?s:a.locale)&&void 0!==n?n:Xc,i=Dc(e,t);if(isNaN(i))throw new RangeError("Invalid time value");const l=Object.assign({},r,{addSuffix:null===r||void 0===r?void 0:r.addSuffix,comparison:i});let c,d;i>0?(c=Tc(t),d=Tc(e)):(c=Tc(e),d=Tc(t));const u=Wc(d,c),h=(ed(d)-ed(c))/1e3,m=Math.round((u-h)/60);let p;if(m<2)return null!==r&&void 0!==r&&r.includeSeconds?u<5?o.formatDistance("lessThanXSeconds",5,l):u<10?o.formatDistance("lessThanXSeconds",10,l):u<20?o.formatDistance("lessThanXSeconds",20,l):u<40?o.formatDistance("halfAMinute",0,l):u<60?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",1,l):0===m?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",m,l);if(m<45)return o.formatDistance("xMinutes",m,l);if(m<90)return o.formatDistance("aboutXHours",1,l);if(m<1440){const e=Math.round(m/60);return o.formatDistance("aboutXHours",e,l)}if(m<2520)return o.formatDistance("xDays",1,l);if(m<_c){const e=Math.round(m/1440);return o.formatDistance("xDays",e,l)}if(m<86400)return p=Math.round(m/_c),o.formatDistance("aboutXMonths",p,l);if(p=Uc(d,c),p<12){const e=Math.round(m/_c);return o.formatDistance("xMonths",e,l)}{const e=p%12,t=Math.trunc(p/12);return e<3?o.formatDistance("aboutXYears",t,l):e<9?o.formatDistance("overXYears",t,l):o.formatDistance("almostXYears",t+1,l)}}function rd(e,t){return td(e,Ic(e),t)}const nd=e=>{let{emails:t,onEmailClick:r,loading:n,emptyMessage:s}=e;if(n)return(0,kt.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-aqua-blue"})});if(!t||0===t.length)return(0,kt.jsxs)("div",{className:"text-center py-12",children:[(0,kt.jsx)(Sc,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,kt.jsx)("p",{className:"text-gray-500",children:s||"No emails found"})]});const a=e=>{switch(e){case"delivered":case"opened":return(0,kt.jsx)(yc,{className:"text-semantic-success"});case"failed":case"bounced":return(0,kt.jsx)(vc,{className:"text-semantic-danger"});default:return(0,kt.jsx)(bc,{className:"text-brand-aqua-blue"})}},o=e=>{switch(e){case"delivered":return"bg-green-100 text-green-800";case"opened":return"bg-blue-100 text-blue-800";case"failed":case"bounced":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,kt.jsx)("div",{className:"space-y-3",children:t.map(e=>{var t,n,s,i,l;return(0,kt.jsx)("div",{onClick:()=>r&&r(e),className:"bg-white rounded-lg border border-border-silver p-4 hover:border-brand-aqua-blue hover:shadow-soft transition-all cursor-pointer",children:(0,kt.jsx)("div",{className:"flex items-start justify-between",children:(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:null!==(t=e.sender)&&void 0!==t&&t.avatar?(0,kt.jsx)("img",{src:e.sender.avatar,alt:e.senderName,className:"w-10 h-10 rounded-full"}):(0,kt.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-brand-aqua-blue to-accent-vibrant-green flex items-center justify-center text-white font-semibold",children:(null===(n=e.senderName)||void 0===n?void 0:n.charAt(0))||(null===(s=e.senderEmail)||void 0===s?void 0:s.charAt(0))||"U"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"font-semibold text-text-charcoal",children:e.senderName||e.senderEmail}),(0,kt.jsx)("span",{className:"text-xs text-text-light-gray",children:rd(new Date(e.createdAt),{addSuffix:!0})})]}),(0,kt.jsxs)("div",{className:"text-sm text-text-light-gray",children:["to ",(null===(i=e.toEmails)||void 0===i?void 0:i.join(", "))||"recipients"]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[a(e.status),(0,kt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(o(e.status)),children:e.status})]})]}),(0,kt.jsx)("h4",{className:"font-semibold text-text-charcoal mb-1 truncate",children:e.subject}),e.bodyText&&(0,kt.jsxs)("p",{className:"text-sm text-text-light-gray line-clamp-2 mb-2",children:[e.bodyText.substring(0,150),"..."]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 text-xs text-text-light-gray",children:[(0,kt.jsx)("span",{className:"px-2 py-1 bg-brand-aqua-blue-light-tint text-brand-aqua-blue rounded-full",children:(l=e.emailType,{project_update:"Project Update",customer_communication:"Customer",team_communication:"Team",bubbles_ai:"AI Assistant",general:"General",notification:"Notification",system:"System"}[l]||l)}),e.project&&(0,kt.jsxs)("span",{className:"flex items-center gap-1",children:[(0,kt.jsx)("span",{className:"font-medium",children:"Project:"}),e.project.projectName]}),e.customer&&(0,kt.jsxs)("span",{className:"flex items-center gap-1",children:[(0,kt.jsx)("span",{className:"font-medium",children:"Customer:"}),e.customer.primaryName]}),e.attachments&&e.attachments.length>0&&(0,kt.jsxs)("span",{className:"flex items-center gap-1",children:[(0,kt.jsx)(kc,{className:"w-3 h-3"}),e.attachments.length," attachment",1!==e.attachments.length?"s":""]})]})]})})},e.id)})})};function sd(e){const t=Tc(e);return t.setHours(0,0,0,0),t}function ad(e,t){const r=sd(e),n=sd(t),s=+r-ed(r),a=+n-ed(n);return Math.round((s-a)/864e5)}function od(e){const t=Tc(e),r=Pc(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function id(e){const t=Tc(e);return ad(t,od(t))+1}function ld(e,t){var r,n,s,a,o,i;const l=Zc(),c=null!==(r=null!==(n=null!==(s=null!==(a=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==s?s:l.weekStartsOn)&&void 0!==n?n:null===(i=l.locale)||void 0===i||null===(i=i.options)||void 0===i?void 0:i.weekStartsOn)&&void 0!==r?r:0,d=Tc(e),u=d.getDay(),h=(u<c?7:0)+u-c;return d.setDate(d.getDate()-h),d.setHours(0,0,0,0),d}function cd(e){return ld(e,{weekStartsOn:1})}function dd(e){const t=Tc(e),r=t.getFullYear(),n=Pc(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const s=cd(n),a=Pc(e,0);a.setFullYear(r,0,4),a.setHours(0,0,0,0);const o=cd(a);return t.getTime()>=s.getTime()?r+1:t.getTime()>=o.getTime()?r:r-1}function ud(e){const t=dd(e),r=Pc(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),cd(r)}function hd(e){const t=Tc(e),r=+cd(t)-+ud(t);return Math.round(r/Mc)+1}function md(e,t){var r,n,s,a,o,i;const l=Tc(e),c=l.getFullYear(),d=Zc(),u=null!==(r=null!==(n=null!==(s=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==s?s:d.firstWeekContainsDate)&&void 0!==n?n:null===(i=d.locale)||void 0===i||null===(i=i.options)||void 0===i?void 0:i.firstWeekContainsDate)&&void 0!==r?r:1,h=Pc(e,0);h.setFullYear(c+1,0,u),h.setHours(0,0,0,0);const m=ld(h,t),p=Pc(e,0);p.setFullYear(c,0,u),p.setHours(0,0,0,0);const g=ld(p,t);return l.getTime()>=m.getTime()?c+1:l.getTime()>=g.getTime()?c:c-1}function pd(e,t){var r,n,s,a,o,i;const l=Zc(),c=null!==(r=null!==(n=null!==(s=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==s?s:l.firstWeekContainsDate)&&void 0!==n?n:null===(i=l.locale)||void 0===i||null===(i=i.options)||void 0===i?void 0:i.firstWeekContainsDate)&&void 0!==r?r:1,d=md(e,t),u=Pc(e,0);u.setFullYear(d,0,c),u.setHours(0,0,0,0);return ld(u,t)}function gd(e,t){const r=Tc(e),n=+ld(r,t)-+pd(r,t);return Math.round(n/Mc)+1}function fd(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const xd={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return fd("yy"===t?n%100:n,t.length)},M(e,t){const r=e.getMonth();return"M"===t?String(r+1):fd(r+1,2)},d:(e,t)=>fd(e.getDate(),t.length),a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];default:return"am"===r?"a.m.":"p.m."}},h:(e,t)=>fd(e.getHours()%12||12,t.length),H:(e,t)=>fd(e.getHours(),t.length),m:(e,t)=>fd(e.getMinutes(),t.length),s:(e,t)=>fd(e.getSeconds(),t.length),S(e,t){const r=t.length,n=e.getMilliseconds();return fd(Math.trunc(n*Math.pow(10,r-3)),t.length)}},vd="midnight",yd="noon",bd="morning",wd="afternoon",jd="evening",Nd="night",Sd={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if("yo"===t){const t=e.getFullYear(),n=t>0?t:1-t;return r.ordinalNumber(n,{unit:"year"})}return xd.y(e,t)},Y:function(e,t,r,n){const s=md(e,n),a=s>0?s:1-s;if("YY"===t){return fd(a%100,2)}return"Yo"===t?r.ordinalNumber(a,{unit:"year"}):fd(a,t.length)},R:function(e,t){return fd(dd(e),t.length)},u:function(e,t){return fd(e.getFullYear(),t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return fd(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return fd(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return xd.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return fd(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const s=gd(e,n);return"wo"===t?r.ordinalNumber(s,{unit:"week"}):fd(s,t.length)},I:function(e,t,r){const n=hd(e);return"Io"===t?r.ordinalNumber(n,{unit:"week"}):fd(n,t.length)},d:function(e,t,r){return"do"===t?r.ordinalNumber(e.getDate(),{unit:"date"}):xd.d(e,t)},D:function(e,t,r){const n=id(e);return"Do"===t?r.ordinalNumber(n,{unit:"dayOfYear"}):fd(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const s=e.getDay(),a=(s-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return fd(a,2);case"eo":return r.ordinalNumber(a,{unit:"day"});case"eee":return r.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(s,{width:"short",context:"formatting"});default:return r.day(s,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const s=e.getDay(),a=(s-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return fd(a,t.length);case"co":return r.ordinalNumber(a,{unit:"day"});case"ccc":return r.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(s,{width:"narrow",context:"standalone"});case"cccccc":return r.day(s,{width:"short",context:"standalone"});default:return r.day(s,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),s=0===n?7:n;switch(t){case"i":return String(s);case"ii":return fd(s,t.length);case"io":return r.ordinalNumber(s,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let s;switch(s=12===n?yd:0===n?vd:n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(s,{width:"narrow",context:"formatting"});default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let s;switch(s=n>=17?jd:n>=12?wd:n>=4?bd:Nd,t){case"B":case"BB":case"BBB":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(s,{width:"narrow",context:"formatting"});default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(e,t,r){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),r.ordinalNumber(t,{unit:"hour"})}return xd.h(e,t)},H:function(e,t,r){return"Ho"===t?r.ordinalNumber(e.getHours(),{unit:"hour"}):xd.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return"Ko"===t?r.ordinalNumber(n,{unit:"hour"}):fd(n,t.length)},k:function(e,t,r){let n=e.getHours();return 0===n&&(n=24),"ko"===t?r.ordinalNumber(n,{unit:"hour"}):fd(n,t.length)},m:function(e,t,r){return"mo"===t?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):xd.m(e,t)},s:function(e,t,r){return"so"===t?r.ordinalNumber(e.getSeconds(),{unit:"second"}):xd.s(e,t)},S:function(e,t){return xd.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(0===n)return"Z";switch(t){case"X":return Ad(n);case"XXXX":case"XX":return Cd(n);default:return Cd(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return Ad(n);case"xxxx":case"xx":return Cd(n);default:return Cd(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+kd(n,":");default:return"GMT"+Cd(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+kd(n,":");default:return"GMT"+Cd(n,":")}},t:function(e,t,r){return fd(Math.trunc(e.getTime()/1e3),t.length)},T:function(e,t,r){return fd(e.getTime(),t.length)}};function kd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=e>0?"-":"+",n=Math.abs(e),s=Math.trunc(n/60),a=n%60;return 0===a?r+String(s):r+String(s)+t+fd(a,2)}function Ad(e,t){if(e%60===0){return(e>0?"-":"+")+fd(Math.abs(e)/60,2)}return Cd(e,t)}function Cd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=e>0?"-":"+",n=Math.abs(e);return r+fd(Math.trunc(n/60),2)+t+fd(n%60,2)}const Ed=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Pd=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Id={p:Pd,P:(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],s=r[2];if(!s)return Ed(e,t);let a;switch(n){case"P":a=t.dateTime({width:"short"});break;case"PP":a=t.dateTime({width:"medium"});break;case"PPP":a=t.dateTime({width:"long"});break;default:a=t.dateTime({width:"full"})}return a.replace("{{date}}",Ed(n,t)).replace("{{time}}",Pd(s,t))}},Td=/^D+$/,Dd=/^Y+$/,Md=["D","DD","YY","YYYY"];function _d(e){return e instanceof Date||"object"===typeof e&&"[object Date]"===Object.prototype.toString.call(e)}function Od(e){if(!_d(e)&&"number"!==typeof e)return!1;const t=Tc(e);return!isNaN(Number(t))}const Ld=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Rd=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Fd=/^'([^]*?)'?$/,Ud=/''/g,Bd=/[a-zA-Z]/;function Wd(e,t,r){var n,s,a,o,i,l,c,d,u,h,m,p,g,f;const x=Zc(),v=null!==(n=null!==(s=null===r||void 0===r?void 0:r.locale)&&void 0!==s?s:x.locale)&&void 0!==n?n:Xc,y=null!==(a=null!==(o=null!==(i=null!==(l=null===r||void 0===r?void 0:r.firstWeekContainsDate)&&void 0!==l?l:null===r||void 0===r||null===(c=r.locale)||void 0===c||null===(c=c.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==i?i:x.firstWeekContainsDate)&&void 0!==o?o:null===(d=x.locale)||void 0===d||null===(d=d.options)||void 0===d?void 0:d.firstWeekContainsDate)&&void 0!==a?a:1,b=null!==(u=null!==(h=null!==(m=null!==(p=null===r||void 0===r?void 0:r.weekStartsOn)&&void 0!==p?p:null===r||void 0===r||null===(g=r.locale)||void 0===g||null===(g=g.options)||void 0===g?void 0:g.weekStartsOn)&&void 0!==m?m:x.weekStartsOn)&&void 0!==h?h:null===(f=x.locale)||void 0===f||null===(f=f.options)||void 0===f?void 0:f.weekStartsOn)&&void 0!==u?u:0,w=Tc(e);if(!Od(w))throw new RangeError("Invalid time value");let j=t.match(Rd).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,Id[t])(e,v.formatLong)}return e}).join("").match(Ld).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:zd(e)};if(Sd[t])return{isToken:!0,value:e};if(t.match(Bd))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});v.localize.preprocessor&&(j=v.localize.preprocessor(w,j));const N={firstWeekContainsDate:y,weekStartsOn:b,locale:v};return j.map(n=>{if(!n.isToken)return n.value;const s=n.value;(null!==r&&void 0!==r&&r.useAdditionalWeekYearTokens||!function(e){return Dd.test(e)}(s))&&(null!==r&&void 0!==r&&r.useAdditionalDayOfYearTokens||!function(e){return Td.test(e)}(s))||function(e,t,r){const n=function(e,t,r){const n="Y"===e[0]?"years":"days of the month";return"Use `".concat(e.toLowerCase(),"` instead of `").concat(e,"` (in `").concat(t,"`) for formatting ").concat(n," to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md")}(e,t,r);if(console.warn(n),Md.includes(e))throw new RangeError(n)}(s,t,String(e));return(0,Sd[s[0]])(w,s,v.localize,N)}).join("")}function zd(e){const t=e.match(Fd);return t?t[1].replace(Ud,"'"):e}const Vd=e=>{var t,r,n;let{emailId:s,email:a,onClose:i}=e;const[l,c]=(0,o.useState)(a),[d,u]=(0,o.useState)(!a),[h,m]=(0,o.useState)(null);(0,o.useEffect)(()=>{!a&&s&&p()},[s,a]);const p=async()=>{try{u(!0);const e=localStorage.getItem("token"),t=await fetch("/api/email/".concat(s),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw new Error("Failed to fetch email details");const r=await t.json();c(r.data)}catch(ES){m(ES.message)}finally{u(!1)}};return l||d?(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-silver bg-gradient-to-r from-brand-aqua-blue to-accent-vibrant-green",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 text-white",children:[(0,kt.jsx)(Sc,{className:"w-6 h-6"}),(0,kt.jsx)("h2",{className:"text-xl font-bold",children:"Email Details"})]}),(0,kt.jsx)("button",{onClick:i,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors",children:(0,kt.jsx)(Ec,{className:"w-6 h-6"})})]}),(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:d?(0,kt.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-aqua-blue"})}):h?(0,kt.jsxs)("div",{className:"text-center py-12",children:[(0,kt.jsx)(vc,{className:"mx-auto h-12 w-12 text-semantic-danger mb-4"}),(0,kt.jsx)("p",{className:"text-semantic-danger",children:h})]}):l?(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"bg-background-ash rounded-lg p-4 space-y-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"text-sm font-semibold text-text-light-gray block mb-1",children:"Subject"}),(0,kt.jsx)("h3",{className:"text-xl font-bold text-text-charcoal",children:l.subject})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold text-text-light-gray w-20",children:"From:"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[null!==(t=l.sender)&&void 0!==t&&t.avatar?(0,kt.jsx)("img",{src:l.sender.avatar,alt:l.senderName,className:"w-8 h-8 rounded-full"}):(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-brand-aqua-blue to-accent-vibrant-green flex items-center justify-center text-white text-sm font-semibold",children:(null===(r=l.senderName)||void 0===r?void 0:r.charAt(0))||"U"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-text-charcoal",children:l.senderName}),(0,kt.jsx)("div",{className:"text-sm text-text-light-gray",children:l.senderEmail})]})]})]}),(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold text-text-light-gray w-20 pt-1",children:"To:"}),(0,kt.jsx)("div",{className:"flex-1",children:null===(n=l.toEmails)||void 0===n?void 0:n.map((e,t)=>{var r;return(0,kt.jsxs)("div",{className:"text-text-charcoal",children:[(null===(r=l.toNames)||void 0===r?void 0:r[t])&&(0,kt.jsxs)("span",{className:"font-medium",children:[l.toNames[t]," "]}),(0,kt.jsxs)("span",{className:"text-text-light-gray",children:["<",e,">"]})]},t)})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-6 pt-2 border-t border-border-silver",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold text-text-light-gray",children:"Sent:"}),(0,kt.jsx)("span",{className:"text-text-charcoal",children:Wd(new Date(l.sentAt||l.createdAt),"PPpp")})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"delivered":case"opened":return(0,kt.jsx)(yc,{className:"text-semantic-success"});case"failed":case"bounced":return(0,kt.jsx)(vc,{className:"text-semantic-danger"});default:return(0,kt.jsx)(bc,{className:"text-brand-aqua-blue"})}})(l.status),(0,kt.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat((e=>{switch(e){case"delivered":return"bg-green-100 text-green-800";case"opened":return"bg-blue-100 text-blue-800";case"failed":case"bounced":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(l.status)),children:l.status})]})]}),(l.project||l.customer||l.task)&&(0,kt.jsxs)("div",{className:"flex items-center gap-4 pt-2 border-t border-border-silver",children:[l.project&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-text-light-gray",children:"Project:"}),(0,kt.jsxs)("span",{className:"text-brand-aqua-blue font-medium",children:[l.project.projectName," (#",l.project.projectNumber,")"]})]}),l.customer&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-text-light-gray",children:"Customer:"}),(0,kt.jsx)("span",{className:"text-text-charcoal font-medium",children:l.customer.primaryName})]}),l.task&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-text-light-gray",children:"Task:"}),(0,kt.jsx)("span",{className:"text-text-charcoal font-medium",children:l.task.title})]})]})]}),l.attachments&&l.attachments.length>0&&(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h4",{className:"text-sm font-semibold text-text-charcoal mb-3 flex items-center gap-2",children:[(0,kt.jsx)(kc,{className:"w-4 h-4"}),"Attachments (",l.attachments.length,")"]}),(0,kt.jsx)("div",{className:"space-y-2",children:l.attachments.map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center justify-between p-3 bg-background-ash rounded-lg border border-border-silver hover:border-brand-aqua-blue transition-colors",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)(kc,{className:"w-5 h-5 text-brand-aqua-blue"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-text-charcoal",children:e.filename}),e.size&&(0,kt.jsxs)("div",{className:"text-sm text-text-light-gray",children:[(e.size/1024).toFixed(2)," KB"]})]})]}),(0,kt.jsx)("button",{className:"text-brand-aqua-blue hover:text-brand-deep-teal p-2 rounded-lg hover:bg-brand-aqua-blue-light-tint transition-colors",children:(0,kt.jsx)(wc,{className:"w-5 h-5"})})]},t))})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold text-text-charcoal mb-3",children:"Message"}),l.bodyHtml?(0,kt.jsx)("div",{className:"prose max-w-none bg-white border border-border-silver rounded-lg p-6",dangerouslySetInnerHTML:{__html:l.bodyHtml}}):(0,kt.jsx)("div",{className:"bg-white border border-border-silver rounded-lg p-6 whitespace-pre-wrap",children:l.bodyText})]}),(l.deliveredAt||l.openedAt||l.clickedAt)&&(0,kt.jsxs)("div",{className:"bg-background-ash rounded-lg p-4",children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold text-text-charcoal mb-3",children:"Tracking"}),(0,kt.jsxs)("div",{className:"space-y-2 text-sm",children:[l.deliveredAt&&(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-semantic-success",children:[(0,kt.jsx)(yc,{className:"w-4 h-4"}),(0,kt.jsxs)("span",{children:["Delivered: ",Wd(new Date(l.deliveredAt),"PPpp")]})]}),l.openedAt&&(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-brand-aqua-blue",children:[(0,kt.jsx)(jc,{className:"w-4 h-4"}),(0,kt.jsxs)("span",{children:["Opened: ",Wd(new Date(l.openedAt),"PPpp")]})]}),l.clickedAt&&(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-accent-vibrant-green",children:[(0,kt.jsx)(jc,{className:"w-4 h-4"}),(0,kt.jsxs)("span",{children:["Link clicked: ",Wd(new Date(l.clickedAt),"PPpp")]})]})]})]})]}):null}),(0,kt.jsx)("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-border-silver bg-background-ash",children:(0,kt.jsx)("button",{onClick:i,className:"px-6 py-2 bg-white border border-border-silver text-text-charcoal rounded-lg hover:bg-background-ash transition-colors font-medium",children:"Close"})})]})}):null},Hd=e=>{let{projectId:t}=e;const[r,n]=(0,o.useState)([]),[s,a]=(0,o.useState)(!0),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)("all");(0,o.useEffect)(()=>{t&&m()},[t]);const m=async()=>{try{a(!0),l(null);const e=localStorage.getItem("token"),r=await fetch("/api/email/history/project/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});if(!r.ok)throw new Error("Failed to fetch project emails");const s=await r.json();n(s.data||[])}catch(ES){l(ES.message)}finally{a(!1)}},p=r.filter(e=>"all"===u||e.status===u),g={total:r.length,sent:r.filter(e=>"sent"===e.status).length,delivered:r.filter(e=>"delivered"===e.status).length,opened:r.filter(e=>"opened"===e.status).length,failed:r.filter(e=>"failed"===e.status||"bounced"===e.status).length};return(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"bg-gradient-to-r from-brand-aqua-blue to-accent-vibrant-green rounded-lg p-6 text-white",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)(Sc,{className:"w-8 h-8"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-2xl font-bold",children:"Email History"}),(0,kt.jsx)("p",{className:"text-white text-opacity-90",children:"All emails sent for this project"})]})]}),(0,kt.jsxs)("button",{onClick:m,disabled:s,className:"flex items-center gap-2 px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition-colors disabled:opacity-50",children:[(0,kt.jsx)(Ac,{className:"w-4 h-4 ".concat(s?"animate-spin":"")}),"Refresh"]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,kt.jsxs)("div",{className:"bg-white bg-opacity-10 rounded-lg p-3",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold",children:g.total}),(0,kt.jsx)("div",{className:"text-sm text-white text-opacity-80",children:"Total Emails"})]}),(0,kt.jsxs)("div",{className:"bg-white bg-opacity-10 rounded-lg p-3",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold",children:g.sent}),(0,kt.jsx)("div",{className:"text-sm text-white text-opacity-80",children:"Sent"})]}),(0,kt.jsxs)("div",{className:"bg-white bg-opacity-10 rounded-lg p-3",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold",children:g.delivered}),(0,kt.jsx)("div",{className:"text-sm text-white text-opacity-80",children:"Delivered"})]}),(0,kt.jsxs)("div",{className:"bg-white bg-opacity-10 rounded-lg p-3",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold",children:g.opened}),(0,kt.jsx)("div",{className:"text-sm text-white text-opacity-80",children:"Opened"})]}),(0,kt.jsxs)("div",{className:"bg-white bg-opacity-10 rounded-lg p-3",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold",children:g.failed}),(0,kt.jsx)("div",{className:"text-sm text-white text-opacity-80",children:"Failed"})]})]})]}),(0,kt.jsx)("div",{className:"bg-white rounded-lg border border-border-silver p-4",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)(Nc,{className:"w-5 h-5 text-text-light-gray"}),(0,kt.jsx)("span",{className:"text-sm font-semibold text-text-charcoal",children:"Filter by status:"}),(0,kt.jsx)("div",{className:"flex gap-2",children:[{value:"all",label:"All"},{value:"sent",label:"Sent"},{value:"delivered",label:"Delivered"},{value:"opened",label:"Opened"}].map(e=>(0,kt.jsx)("button",{onClick:()=>h(e.value),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(u===e.value?"bg-brand-aqua-blue text-white":"bg-background-ash text-text-charcoal hover:bg-brand-aqua-blue-light-tint"),children:e.label},e.value))})]})}),i?(0,kt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-800",children:[(0,kt.jsx)("p",{className:"font-semibold",children:"Error loading emails"}),(0,kt.jsx)("p",{className:"text-sm",children:i})]}):(0,kt.jsx)(nd,{emails:p,onEmailClick:d,loading:s,emptyMessage:"No emails have been sent for this project yet"}),c&&(0,kt.jsx)(Vd,{email:c,onClose:()=>d(null)})]})},qd=()=>((0,o.useEffect)(()=>{window.scrollTo(0,0),document.body.scrollTop=0,document.documentElement.scrollTop=0},[]),null),Kd=e=>{var t,r,n,s,a,i,l,c,d,u,h,m,p,g;let{project:f,onBack:x,initialView:v="Project Workflow",onSendMessage:y,tasks:b,projects:w,onUpdate:j,activities:N,onAddActivity:S,colorMode:k,previousPage:A,projectSourceSection:C,onProjectSelect:E,targetLineItemId:P,targetSectionId:I,selectionNonce:T}=e;const D=(()=>{const e=Ct();return Ts({mutationFn:e=>Ds.projectsService.delete(e),onSuccess:(t,r)=>{e.removeQueries({queryKey:xa.project(r)}),e.invalidateQueries({queryKey:xa.projects}),e.invalidateQueries({queryKey:xa.projectStats})}})})(),{pushNavigation:M}=Ei(),{subjects:_}=xi();(0,o.useEffect)(()=>{f&&M("Project: ".concat(f.projectName||f.name||"Project Detail"),{project:f,initialView:v,previousPage:A,projectSourceSection:C})},[M,null===f||void 0===f?void 0:f.id,v]);const O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Project Profile",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;console.log("\ud83d\udd0d PROJECT_DETAIL: handleProjectSelectWithScroll called with:"),console.log("\ud83d\udd0d PROJECT_DETAIL: project:",null===e||void 0===e?void 0:e.name),console.log("\ud83d\udd0d PROJECT_DETAIL: view:",t),console.log("\ud83d\udd0d PROJECT_DETAIL: phase:",r),console.log("\ud83d\udd0d PROJECT_DETAIL: sourceSection:",n),console.log("\ud83d\udd0d PROJECT_DETAIL: targetLineItemId:",s),console.log("\ud83d\udd0d PROJECT_DETAIL: targetSectionId:",a),window.scrollTo({top:0,behavior:"smooth"}),E&&(console.log("\ud83d\udd0d PROJECT_DETAIL: Calling onProjectSelect with all parameters"),E(e,t,r,n,s,a))},L=e=>{console.log("Project detail quick reply data:",e);const t=null===w||void 0===w?void 0:w.find(t=>t.id===e.projectId);t&&S&&S(t,e.message,e.subject)},R=()=>{let e=[...ot&&ot.length>0?ot:[]];return e=e.filter(e=>{var t,r,n,s;const a=(null===(t=e.actionData)||void 0===t?void 0:t.projectId)||(null===(r=e.metadata)||void 0===r?void 0:r.projectId)||e.projectId||(null===(n=e.relatedProject)||void 0===n?void 0:n._id)||(null===(s=e.relatedProject)||void 0===s?void 0:s.id);return a===f.id||String(a)===String(f.id)||a===f._id||String(a)===String(f._id)}),"all"!==rt&&(e=e.filter(e=>{var t,r,n,s,a;const o=(null===(t=e.metadata)||void 0===t?void 0:t.responsibleRole)||(null===(r=e.actionData)||void 0===r?void 0:r.responsibleRole)||(null===(n=e.metadata)||void 0===n?void 0:n.defaultResponsible)||(null===(s=e.actionData)||void 0===s?void 0:s.defaultResponsible)||(null===(a=e.user)||void 0===a?void 0:a.role)||"OFFICE";return F(String(o))===rt})),e.sort((e,t)=>{var r,n;const s=e.priority||(null===(r=e.metadata)||void 0===r?void 0:r.priority)||"medium",a=t.priority||(null===(n=t.metadata)||void 0===n?void 0:n.priority)||"medium",o={high:0,medium:1,low:2},i=o[s]-o[a];if(0!==i)return i;const l=new Date(e.createdAt||e.timestamp||0);return new Date(t.createdAt||t.timestamp||0)-l}),e},F=e=>{if(!e)return"OFFICE";switch(e.toUpperCase()){case"PROJECT_MANAGER":return"PM";case"FIELD_DIRECTOR":return"FIELD";case"ADMINISTRATION":return"ADMIN";case"OFFICE":return"OFFICE";default:return e.toUpperCase()}},U=async()=>{if(!re||!se)return;const e=re._id||re.id;at(t=>(0,Y.A)((0,Y.A)({},t),{},{["".concat(e,"-assign")]:!0}));try{console.log("\ud83d\udd04 Assigning alert to user:",se);const t=$e.find(e=>e.id===parseInt(se));console.log("\ud83d\udc64 Selected user:",t);const r=await fetch("/api/alerts/".concat(e,"/assign"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({assignedTo:se})});if(r.ok){const e=await r.json();console.log("\u2705 Alert assigned successfully:",e),Vr.success((0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,kt.jsxs)("span",{children:["Assigned to ",null===t||void 0===t?void 0:t.name]})]}),{duration:3e3,style:{background:"#3B82F6",color:"#ffffff",fontWeight:"600"}}),te(!1),ne(null),ae("")}else{const e=await r.json();console.error("\u274c Failed to assign alert:",e),Vr.error("Failed to assign alert. Please try again.",{duration:4e3,style:{background:"#EF4444",color:"#ffffff",fontWeight:"600"}})}}catch(t){console.error("\u274c Failed to assign alert:",t),Vr.error("Network error. Please check your connection and try again.",{duration:4e3,style:{background:"#EF4444",color:"#ffffff",fontWeight:"600"}})}finally{at(t=>(0,Y.A)((0,Y.A)({},t),{},{["".concat(e,"-assign")]:!1}))}};console.log("\ud83d\udd0d project:",null===f||void 0===f?void 0:f.name),console.log("\ud83d\udd0d previousPage:",A),console.log("\ud83d\udd0d projectSourceSection:",C),console.log("\ud83d\udd0d projectSourceSection type:",typeof C),console.log("\ud83c\udfd7\ufe0f PROJECT DETAIL: Received props:"),console.log("\ud83c\udfd7\ufe0f PROJECT DETAIL: previousPage:",A),console.log("\ud83c\udfd7\ufe0f PROJECT DETAIL: projectSourceSection:",C);const[B,W]=(0,o.useState)(v),[z,V]=(0,o.useState)({lineItemId:P,sectionId:I});console.log("\ud83d\udd0d PROJECT_DETAIL: activeView state:",B),console.log("\ud83d\udd0d PROJECT_DETAIL: initialView prop:",v);const[H,q]=(0,o.useState)(f),[K,G]=(0,o.useState)({completedPhases:{},progress:(null===f||void 0===f?void 0:f.progress)||0}),J=(0,o.useRef)(null),[Q,X]=(0,o.useState)({}),[$,Z]=(0,o.useState)("all"),[ee,te]=(0,o.useState)(!1),[re,ne]=(0,o.useState)(null),[se,ae]=(0,o.useState)(""),[oe,ie]=(0,o.useState)(new Set),[le,ce]=(0,o.useState)(new Set),[de,ue]=(0,o.useState)(new Set),[he,me]=(0,o.useState)(""),[pe,ge]=(0,o.useState)(""),[fe,xe]=(0,o.useState)(""),[ve,ye]=(0,o.useState)(""),[be,we]=(0,o.useState)("timestamp"),[je,Ne]=(0,o.useState)("desc"),[Se,ke]=(0,o.useState)(!1),[Ae,Ce]=(0,o.useState)(""),[Ee,Pe]=(0,o.useState)(""),[Ie,Te]=(0,o.useState)(""),[De,Me]=(0,o.useState)([]),[_e,Oe]=(0,o.useState)(!1),[Le,Re]=(0,o.useState)(""),[Fe,Ue]=(0,o.useState)([]),[Be,We]=(0,o.useState)(!0),[ze,Ve]=(0,o.useState)([]),[He,qe]=(0,o.useState)([]),[Ke,Ge]=(0,o.useState)(!1),[Je,Ye]=(0,o.useState)([]),[Qe,Xe]=(0,o.useState)(1),[$e,Ze]=(0,o.useState)([]),[et,tt]=(0,o.useState)("all"),[rt,nt]=(0,o.useState)("all"),[st,at]=(0,o.useState)({}),{workflowAlerts:ot,isLoading:it,error:lt}=ya({status:"active"}),{data:ct=[]}=(dt=null===f||void 0===f?void 0:f.id,Cs({queryKey:xa.workflowAlertsByProject(dt),queryFn:()=>Ds.workflowAlertsService.getByProject(dt),select:e=>(null===e||void 0===e?void 0:e.data)||e||[],enabled:!!dt}));var dt;(0,o.useEffect)(()=>{(async()=>{try{const t=await Ds.usersService.getTeamMembers();if(t.success){var e;const r=Array.isArray(t.data)?t.data:(null===(e=t.data)||void 0===e?void 0:e.users)||[];Ze(r)}else Ze([{id:1,name:"Mike Field",role:"Project Manager",email:"mike.field@company.com"},{id:2,name:"Sarah Johnson",role:"Office Manager",email:"sarah.johnson@company.com"},{id:3,name:"John Smith",role:"Field Director",email:"john.smith@company.com"},{id:4,name:"Emily Davis",role:"Administration",email:"emily.davis@company.com"},{id:5,name:"Robert Wilson",role:"Roof Supervisor",email:"robert.wilson@company.com"},{id:6,name:"Lisa Anderson",role:"Customer Service",email:"lisa.anderson@company.com"},{id:7,name:"David Martinez",role:"Estimator",email:"david.martinez@company.com"},{id:8,name:"Jennifer Brown",role:"Accounting",email:"jennifer.brown@company.com"}])}catch(t){console.error("Error loading users:",t),Ze([{id:1,name:"Mike Field",role:"Project Manager",email:"mike.field@company.com"},{id:2,name:"Sarah Johnson",role:"Office Manager",email:"sarah.johnson@company.com"},{id:3,name:"John Smith",role:"Field Director",email:"john.smith@company.com"},{id:4,name:"Emily Davis",role:"Administration",email:"emily.davis@company.com"},{id:5,name:"Robert Wilson",role:"Roof Supervisor",email:"robert.wilson@company.com"},{id:6,name:"Lisa Anderson",role:"Customer Service",email:"lisa.anderson@company.com"},{id:7,name:"David Martinez",role:"Estimator",email:"david.martinez@company.com"},{id:8,name:"Jennifer Brown",role:"Accounting",email:"jennifer.brown@company.com"}])}})()},[]),(0,o.useEffect)(()=>{(async()=>{We(!0);try{var e;const t=await Ds.usersService.getTeamMembers();if(console.log("\ud83d\udd0d API Response for users:",t),null!==t&&void 0!==t&&t.success&&null!==(e=t.data)&&void 0!==e&&e.teamMembers){const e=t.data.teamMembers;Ue(Array.isArray(e)?e:[]),console.log("\u2705 Loaded users for assignment:",e.length)}else console.log("\u26a0\ufe0f API returned no team members"),Ue([])}catch(t){console.error("\u274c Failed to fetch users:",t),Ue([])}finally{We(!1)}})()},[]);const ut=(()=>{const e=localStorage.getItem("currentUser");if(e)try{return JSON.parse(e)}catch(It){return{id:2,name:"Sarah Johnson",role:"Office Manager",email:"sarah.johnson@company.com"}}return{id:2,name:"Sarah Johnson",role:"Office Manager",email:"sarah.johnson@company.com"}})();(()=>{const e=("Messages"===B?He:N||ze||[]).filter(e=>{if("Messages"===B)return!0;return String(e.projectId)===String(f.id||f._id)&&((!e.targetedTo||e.targetedTo===ut.id||e.userId===ut.id)&&(!pe||e.subject===pe))}).sort((e,t)=>{const r=new Date(e.timestamp||e.createdAt||0);return new Date(t.timestamp||t.createdAt||0)-r}),t=10*(Qe-1),r=t+10;e.slice(t,r)})();(0,o.useEffect)(()=>{const e=()=>{window.scrollTo({top:0,behavior:"auto"}),document.body.scrollTop=0,document.documentElement.scrollTop=0,J.current&&(J.current.scrollTop=0);document.querySelectorAll('.overflow-y-auto, .flex-1, [class*="overflow"]').forEach(e=>{e&&e!==J.current&&(e.scrollTop=0)})};e(),setTimeout(e,1),setTimeout(e,10),setTimeout(e,50),setTimeout(e,100)},[null===f||void 0===f?void 0:f.id,B]),(0,o.useEffect)(()=>{const e=()=>{J.current&&(J.current.scrollTop=0),window.scrollTo({top:0,behavior:"auto"})};e(),setTimeout(e,10)},[B]),(0,o.useEffect)(()=>{q(f),W(v)},[f,v]),(0,o.useEffect)(()=>{console.log("\ud83d\udd0d PROJECT_DETAIL: activeView changed to:",B)},[B]),(0,o.useEffect)(()=>{(async()=>{if("Messages"===B&&null!==f&&void 0!==f&&f.id){Ge(!0);try{var e;console.log("\ud83d\udd0d MESSAGES: Fetching project messages for project ".concat(f.id));const t=await Ds.projectMessagesService.getByProject(f.id,{page:1,limit:50,includeReplies:!0}),r=Array.isArray(null===t||void 0===t?void 0:t.data)?t.data:Array.isArray(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data)?t.data.data:Array.isArray(t)?t:[];console.log("\u2705 MESSAGES: Fetched ".concat(r.length," messages for project")),qe(r)}catch(t){console.error("\u274c MESSAGES: Error fetching project messages:",t),qe([])}finally{Ge(!1)}}})()},[B,null===f||void 0===f?void 0:f.id]),(0,o.useLayoutEffect)(()=>{J.current&&(J.current.scrollTop=0),window.scrollTo(0,0)},[f,v,B]);const ht=e=>{const t=(0,Y.A)((0,Y.A)({},H),{},{checklist:e});q(t),j(t)},mt=e=>{let{completedPhases:t,progress:r}=e;G({completedPhases:t,progress:r}),q(e=>(0,Y.A)((0,Y.A)({},e),{},{progress:r}))},pt=(()=>{let e=[...He||[]];if(pe&&(e=e.filter(e=>e.subject===pe)),ve&&(e=e.filter(e=>e.priority===ve)),fe.trim()){const t=fe.toLowerCase();e=e.filter(e=>(e.subject||"").toLowerCase().includes(t)||(e.content||"").toLowerCase().includes(t)||(e.user||"").toLowerCase().includes(t)||(e.targetedToName||"").toLowerCase().includes(t))}return e.sort((e,t)=>{let r,n;switch(be){case"subject":r=e.subject||"",n=t.subject||"";break;case"priority":const s={high:3,medium:2,low:1};r=s[e.priority]||0,n=s[t.priority]||0;break;case"user":r=e.user||"",n=t.user||"";break;default:r=new Date(e.createdAt||e.timestamp),n=new Date(t.createdAt||t.timestamp)}if("string"===typeof r){const e=r.localeCompare(n);return"asc"===je?e:-e}{const e=r-n;return"asc"===je?e:-e}}),e})(),gt=()=>{var e,t;if(console.log("\ud83d\udd0d PROJECT_DETAIL: renderProjectView called with activeView:",B),!f||!f.client&&!f.customer)return(0,kt.jsx)("div",{className:"text-red-600 font-bold",children:"Project data is missing or incomplete."});switch(B){case"Project Workflow":return console.log("\ud83c\udfd7\ufe0f DETAIL: Rendering Project Workflow with project:",H),console.log("\ud83c\udfd7\ufe0f DETAIL: Project has highlightStep:",!(null===H||void 0===H||!H.highlightStep)),console.log("\ud83c\udfd7\ufe0f DETAIL: highlightStep value:",null===H||void 0===H?void 0:H.highlightStep),(0,kt.jsx)(ul,{project:H,onUpdate:ht,onPhaseCompletionChange:mt,targetLineItemId:(null===z||void 0===z?void 0:z.lineItemId)||P,targetSectionId:(null===z||void 0===z?void 0:z.sectionId)||I,selectionNonce:T});case"Project Profile":default:return(0,kt.jsx)(ac,{project:H,colorMode:k,onProjectSelect:E});case"Project Schedule":return(0,kt.jsx)("div",{className:"space-y-6",children:(0,kt.jsxs)("div",{className:"bg-gradient-to-br from-blue-100/40 to-blue-200/10 p-3 rounded-xl border border-blue-100/40",children:[(0,kt.jsx)("h4",{className:"font-semibold text-gray-700 mb-3 text-xs",children:"Schedule"}),(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between rounded-lg shadow-sm bg-gradient-to-r from-green-100 to-green-50 border border-green-200 px-4 py-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[(0,kt.jsx)("rect",{x:"3",y:"7",width:"18",height:"13",rx:"2",stroke:"currentColor",strokeWidth:"2",fill:"none"}),(0,kt.jsx)("path",{d:"M16 3v4M8 3v4M3 11h18",stroke:"currentColor",strokeWidth:"2"})]}),(0,kt.jsx)("span",{className:"text-green-800 font-medium text-sm",children:"Materials Delivery"})]}),(0,kt.jsx)("span",{className:"text-green-700 font-extrabold text-base",children:f.materialsDeliveryStart&&f.materialsDeliveryEnd?"".concat(f.materialsDeliveryStart," - ").concat(f.materialsDeliveryEnd):f.materialsDeliveryStart?f.materialsDeliveryStart:"TBD"})]}),(0,kt.jsxs)("div",{className:"flex items-center justify-between rounded-lg shadow-sm bg-gradient-to-r from-yellow-100 to-yellow-50 border border-yellow-200 px-4 py-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{d:"M2 17v-1a10 10 0 0120 0v1",stroke:"currentColor",strokeWidth:"2",fill:"none"}),(0,kt.jsx)("path",{d:"M12 7v4",stroke:"currentColor",strokeWidth:"2"}),(0,kt.jsx)("path",{d:"M4 17v1a2 2 0 002 2h12a2 2 0 002-2v-1",stroke:"currentColor",strokeWidth:"2"})]}),(0,kt.jsx)("span",{className:"text-yellow-800 font-medium text-sm",children:"Labor"})]}),(0,kt.jsx)("span",{className:"text-yellow-700 font-extrabold text-base",children:f.laborStart&&f.laborEnd?"".concat(f.laborStart," - ").concat(f.laborEnd):f.laborStart?f.laborStart:"TBD"})]})]})]})});case"Messages":return(0,kt.jsx)("div",{className:"w-full","data-section":"project-messages",children:(0,kt.jsxs)("div",{className:"mb-6 bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-soft rounded-2xl p-6 ".concat(k?"bg-[#232b4d]/90 backdrop-blur-sm border-[#3b82f6]/40":""),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-1 ".concat(k?"from-white to-gray-300":""),children:"Project Messages"}),(0,kt.jsxs)("p",{className:"text-sm text-gray-600 font-medium ".concat(k?"text-gray-400":""),children:["Showing messages for: #",String(f.projectNumber||f.id).padStart(5,"0")," - ",f.name||f.projectName]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("input",{type:"text",placeholder:"Search messages...",value:fe||"",onChange:e=>xe(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm w-64 ".concat(k?"bg-[#1e293b] border-gray-600 text-white placeholder-gray-400":"")}),(0,kt.jsx)("svg",{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),(0,kt.jsxs)("select",{value:pe||"",onChange:e=>ge(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm max-w-[200px] ".concat(k?"bg-[#1e293b] border-gray-600 text-white":""),children:[(0,kt.jsx)("option",{value:"",children:"All Subjects"}),gi.map(e=>(0,kt.jsx)("option",{value:e,children:e},e))]}),(0,kt.jsxs)("select",{value:ve||"",onChange:e=>ye(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm max-w-[150px] ".concat(k?"bg-[#1e293b] border-gray-600 text-white":""),children:[(0,kt.jsx)("option",{value:"",children:"All Priorities"}),(0,kt.jsx)("option",{value:"high",children:"High Priority"}),(0,kt.jsx)("option",{value:"medium",children:"Medium Priority"}),(0,kt.jsx)("option",{value:"low",children:"Low Priority"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("select",{value:be||"timestamp",onChange:e=>we(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm max-w-[120px] ".concat(k?"bg-[#1e293b] border-gray-600 text-white":""),children:[(0,kt.jsx)("option",{value:"timestamp",children:"Date"}),(0,kt.jsx)("option",{value:"subject",children:"Subject"}),(0,kt.jsx)("option",{value:"priority",children:"Priority"}),(0,kt.jsx)("option",{value:"user",children:"User"})]}),(0,kt.jsx)("button",{onClick:()=>Ne("asc"===je?"desc":"asc"),className:"px-2 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(k?"bg-[#1e293b] border-gray-600 text-white hover:bg-[#374151]":""),title:"Sort ".concat("asc"===je?"descending":"ascending"),children:(0,kt.jsx)("svg",{className:"w-4 h-4 transform ".concat("asc"===je?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),(pe||ve||fe)&&(0,kt.jsx)("button",{onClick:()=>{ge(""),ye(""),xe("")},className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors ".concat(k?"text-gray-400 hover:text-gray-200 hover:bg-gray-700":""),children:"Clear Filters"})]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("div",{className:"mb-3",children:(0,kt.jsxs)("button",{onClick:()=>ke(!Se),className:"w-full px-4 py-3 text-sm font-medium border-2 border-dashed transition-all duration-300 flex items-center justify-between rounded-lg ".concat(Se?k?"border-blue-400 bg-blue-900/20 text-blue-300":"border-blue-400 bg-blue-50 text-blue-700":k?"border-gray-600 text-gray-300 hover:border-blue-400 hover:text-blue-300 hover:bg-gray-700/50":"border-gray-300 text-gray-600 hover:border-blue-400 hover:text-blue-700 hover:bg-gray-50"),children:[(0,kt.jsxs)("span",{className:"flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Message"]}),(0,kt.jsx)("svg",{className:"w-5 h-5 transition-transform ".concat(Se?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]})}),Se&&(0,kt.jsx)("div",{className:"p-6 border-2 border-dashed rounded-lg ".concat(k?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),Ee&&Ie.trim()&&De.length>0)try{console.log("\ud83d\udd0d MESSAGES: Creating new message for project ".concat(f.id));const e=await Ds.projectMessagesService.create(f.id,{subject:Ee,content:Ie,priority:_e?"HIGH":"MEDIUM",targetedTo:De,isTask:!!_e,taskAssignee:_e?Le:null});console.log("\u2705 MESSAGES: Created new message:",e);const t=await Ds.projectMessagesService.getByProject(f.id,{page:1,limit:50,includeReplies:!0});qe(t.data||[]),ke(!1),Pe(""),Te(""),Me([]),Oe(!1),Re(""),Vr.success("Message created successfully")}catch(t){console.error("\u274c MESSAGES: Error creating message:",t),Vr.error("Failed to create message")}},className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"p-3 rounded-lg text-sm ".concat(k?"bg-blue-900/20 text-blue-300 border border-blue-700/30":"bg-blue-50 text-blue-700 border border-blue-200"),children:[(0,kt.jsx)("span",{className:"font-medium",children:"Creating message for: "}),"#",String(f.projectNumber||f.id).padStart(5,"0")," - ",f.name||f.projectName]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium mb-2 ".concat(k?"text-gray-300":"text-gray-700"),children:["Subject ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{value:Ee,onChange:e=>Pe(e.target.value),required:!0,className:"w-full p-3 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(k?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Select Subject"}),gi.map(e=>(0,kt.jsx)("option",{value:e,children:e},e))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium mb-2 ".concat(k?"text-gray-300":"text-gray-700"),children:["To ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{value:De||"",onChange:e=>{const t=Array.from(e.target.selectedOptions,e=>e.value);Me(t)},multiple:!0,required:!0,className:"w-full p-3 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(k?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),style:{minHeight:"40px"},children:[(0,kt.jsx)("option",{value:"all",style:{fontWeight:"bold"},children:"All Users"}),Fe.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),(0,kt.jsx)("p",{className:"text-xs mt-1 ".concat(k?"text-gray-400":"text-gray-500"),children:"Hold Ctrl/Cmd to select multiple recipients"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"flex items-center text-sm font-medium mb-2 ".concat(k?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("input",{type:"checkbox",checked:_e||!1,onChange:e=>Oe(e.target.checked),className:"mr-2"}),"Send as a Task"]}),_e&&(0,kt.jsxs)("select",{value:Le||"",onChange:e=>Re(e.target.value),disabled:Be,className:"w-full p-3 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(k?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"," ").concat(Be?"opacity-50 cursor-not-allowed":""),children:[(0,kt.jsx)("option",{value:"",children:Be?"Loading users...":"Assign Task To..."}),!Be&&Fe.length>0?Fe.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)):Be?null:(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("option",{value:"sarah-owner",children:"Sarah Owner - Owner"}),(0,kt.jsx)("option",{value:"mike-rodriguez",children:"Mike Rodriguez - Project Manager"}),(0,kt.jsx)("option",{value:"john-smith",children:"John Smith - Field Director"}),(0,kt.jsx)("option",{value:"jane-doe",children:"Jane Doe - Administration"}),(0,kt.jsx)("option",{value:"bob-wilson",children:"Bob Wilson - Roof Supervisor"}),(0,kt.jsx)("option",{value:"alice-johnson",children:"Alice Johnson - Customer Service"})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium mb-2 ".concat(k?"text-gray-300":"text-gray-700"),children:["Message ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("textarea",{value:Ie,onChange:e=>Te(e.target.value),placeholder:"Enter your message here...",required:!0,rows:4,className:"w-full p-3 border rounded-lg text-sm resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(k?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{ke(!1),Pe(""),Te(""),Me([]),Oe(!1),Re("")},className:"px-4 py-2 text-sm font-medium rounded-lg border transition-colors ".concat(k?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!Ee||!Ie.trim()||0===De.length,className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors ".concat(Ee&&Ie.trim()&&De.length>0?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Send Message"})]})]})})]}),(0,kt.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:Ke?(0,kt.jsxs)("div",{className:"text-center py-12",children:[(0,kt.jsx)("div",{className:"text-gray-400 text-5xl mb-4",children:"\ud83d\udcec"}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading project messages..."})]}):0===pt.length?(0,kt.jsxs)("div",{className:"text-center py-12",children:[(0,kt.jsx)("div",{className:"text-gray-400 text-5xl mb-4",children:"\ud83d\udcec"}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:fe||pe||ve?"No messages match your filters":"No messages found for this project"}),(0,kt.jsx)("p",{className:"text-gray-600 mb-4",children:fe||pe||ve?"Try adjusting your filter settings.":"Project messages will appear here when available."}),(fe||pe||ve)&&(0,kt.jsx)("button",{onClick:()=>{ge(""),ye(""),xe("")},className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Clear Filters"})]}):pt.map(e=>{const t=(0,Y.A)((0,Y.A)({},e),{},{displayTo:e.targetedToName||"All Users",displayTask:e.isTask?"Task assigned to: ".concat(e.taskAssigneeName||"Unassigned"):null});return(0,kt.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden transition-all duration-200 hover:border-gray-300 ".concat(k?"border-gray-600 hover:border-gray-500":""),children:(0,kt.jsx)(Ms,{activity:t,onProjectSelect:O,projects:w,colorMode:k,onQuickReply:L,isExpanded:!1,onToggleExpansion:()=>{}})},e.id)})}),pt.length>0&&(0,kt.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,kt.jsxs)("span",{children:["Showing ",pt.length," of ",(null===He||void 0===He?void 0:He.length)||0," messages"]}),(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsxs)("span",{children:[pt.filter(e=>"high"===e.priority).length," High Priority"]}),(0,kt.jsxs)("span",{children:[pt.filter(e=>"medium"===e.priority).length," Medium Priority"]}),(0,kt.jsxs)("span",{children:[pt.filter(e=>"low"===e.priority).length," Low Priority"]})]})]})})]})});case"Alerts":return(0,kt.jsxs)("div",{className:"w-full","data-section":"current-alerts",children:[(0,kt.jsxs)("div",{className:"border-t-4 border-blue-400 shadow-[0_2px_8px_rgba(0,0,0,0.1)] rounded-[8px] px-4 py-3 pb-6 ".concat(k?"bg-[#232b4d]/80":"bg-white"," relative overflow-visible"),children:[(0,kt.jsxs)("div",{className:"mb-3",children:[(0,kt.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-sm font-semibold ".concat(k?"text-white":"text-gray-800"),children:"Current Alerts"}),(0,kt.jsxs)("p",{className:"text-[9px] mt-1 ".concat(k?"text-gray-400":"text-gray-500"),children:["Showing alerts for project: #",String(f.projectNumber||f.id).padStart(5,"0")," - ",f.name||f.projectName]}),(0,kt.jsxs)("p",{className:"text-[9px] mt-1 ".concat(k?"text-gray-400":"text-gray-500"),children:["User: ",ut.name]}),oe.size>0&&(0,kt.jsxs)("p",{className:"text-[9px] mt-1 ".concat(k?"text-gray-400":"text-gray-500"),children:[oe.size," of ",R().length," alert",1!==R().length?"s":""," expanded"]})]})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2 mt-3",children:[(0,kt.jsx)("span",{className:"text-[9px] font-medium ".concat(k?"text-gray-400":"text-gray-500"),children:"Filter by user group:"}),(0,kt.jsxs)("select",{value:rt,onChange:e=>nt(e.target.value),className:"text-[9px] font-medium px-2 py-1 rounded border transition-colors min-w-[120px] ".concat(k?"bg-[#1e293b] border-[#3b82f6]/30 text-gray-300 hover:border-[#3b82f6]/50":"bg-white border-gray-300 text-gray-700 hover:border-gray-400"),children:[(0,kt.jsx)("option",{value:"all",children:"All User Groups"}),(0,kt.jsx)("option",{value:"PM",children:"Project Manager"}),(0,kt.jsx)("option",{value:"FIELD",children:"Field Director"}),(0,kt.jsx)("option",{value:"OFFICE",children:"Office Staff"}),(0,kt.jsx)("option",{value:"ADMIN",children:"Administration"})]})]}),(0,kt.jsx)("div",{className:"mb-3",children:(0,kt.jsxs)("div",{className:"w-full px-3 py-2 text-sm font-medium border-b-2 transition-colors flex items-center justify-between ".concat(k?"border-gray-600 text-gray-300":"border-gray-300 text-gray-600"),children:[(0,kt.jsx)("span",{}),(0,kt.jsx)("div",{className:"w-4 h-4"})]})})]}),(0,kt.jsx)("div",{className:"space-y-2 max-h-[480px] overflow-y-auto pr-1 custom-scrollbar",children:0===R().length?(0,kt.jsx)("div",{className:"text-gray-400 text-center py-3 text-sm",children:it?"Loading alerts...":"No alerts found for ".concat(ut.name,".")}):R().map(e=>{var t,r,n,s,a,o,i,l,c,d,u,h,m,p,g,x,v,y,b,j,N,S;const A=e._id||e.id,C=e.actionData||e.metadata||{},T=C.phase||"UNKNOWN",D=C.priority||"medium",M=C.projectId||e.projectId||(null===(t=e.relatedProject)||void 0===t?void 0:t.id),_=(null===w||void 0===w?void 0:w.find(e=>e.id===M||e._id===M))||f,L=C.stepName||e.title||"Unknown Alert",R=oe.has(A),U=e.assignedTo===ut.id||e.assignedToId===ut.id||e.targetedTo===ut.id,B=((e,t)=>({section:"LEAD"===t?"Initial Contact":"PROSPECT"===t?"Preliminary Assessment":"APPROVED"===t?"Contract & Permitting":"EXECUTION"===t?"Installation & Progress":"COMPLETION"===t?"Final Documentation":"Unknown Section",lineItem:e||"Unknown Line Item"}))(L,T),W=B.section,z=B.lineItem;return(0,kt.jsxs)("div",{className:"".concat(k?"bg-[#1e293b] hover:bg-[#232b4d]":"bg-white hover:bg-[#F8F9FA]"," rounded-[20px] shadow-sm border transition-all duration-200 cursor-pointer ").concat(U?"ring-2 ring-blue-400 ring-opacity-50":""),children:[(0,kt.jsx)("div",{className:"flex flex-col gap-0 px-2 py-0.5 hover:bg-opacity-80 transition-colors cursor-pointer",onClick:()=>(e=>{const t=new Set(oe);t.has(e)?t.delete(e):t.add(e),ie(t)})(A),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-6",children:[(0,kt.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,kt.jsx)("div",{className:"w-5 h-5 ".concat((e=>{const t=(e||"LEAD").toUpperCase().replace("SUPPLEMENT","SECOND_SUPP").replace("2ND SUPP","SECOND_SUPP").replace("EXECUTE","EXECUTION");return Bn.getPhaseColor(t)})(T).bg," rounded-full flex items-center justify-center text-white font-bold text-[9px] shadow-sm"),children:T.charAt(0).toUpperCase()}),"high"===D&&(0,kt.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-red-500 rounded-full border border-white shadow-sm"})]}),(0,kt.jsxs)("div",{className:"flex items-center text-[9px] flex-1",children:[(0,kt.jsx)("span",{className:"font-bold cursor-pointer hover:underline flex-shrink-0 ".concat(k?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),style:{width:"50px"},onClick:e=>{if(e.stopPropagation(),_&&E){const e=(0,Y.A)((0,Y.A)({},_),{},{scrollToProjectId:String(_.id)});O(e,"Projects",null,"Current Alerts")}},children:(null===_||void 0===_?void 0:_.projectNumber)||C.projectNumber||"12345"}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",style:{width:"140px",marginLeft:"9px"},children:[(0,kt.jsx)("button",{className:"text-[9px] font-semibold cursor-pointer hover:underline ".concat(k?"text-gray-300 hover:text-gray-200":"text-gray-700 hover:text-gray-800"),title:(null===_||void 0===_||null===(r=_.customer)||void 0===r?void 0:r.name)||(null===_||void 0===_?void 0:_.clientName)||C.projectName||"Primary Customer",onClick:e=>{e.stopPropagation();const t=new Set(le);t.has(A)?t.delete(A):t.add(A),ce(t)},children:(null===_||void 0===_||null===(n=_.customer)||void 0===n?void 0:n.name)||(null===_||void 0===_?void 0:_.clientName)||C.projectName||"Customer"}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation();const t=new Set(le);t.has(A)?t.delete(A):t.add(A),ce(t)},className:"transform transition-transform duration-200 ".concat(le.has(A)?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",style:{marginLeft:"37px"},children:[(0,kt.jsx)("span",{className:"text-[9px] font-medium ".concat(k?"text-gray-400":"text-gray-500"),children:"PM:"}),(0,kt.jsx)("button",{className:"text-[9px] font-semibold cursor-pointer hover:underline truncate max-w-[80px] ".concat(k?"text-gray-300 hover:text-gray-200":"text-gray-700 hover:text-gray-800"),title:(null===_||void 0===_||null===(s=_.projectManager)||void 0===s?void 0:s.name)||(null===_||void 0===_||null===(a=_.projectManager)||void 0===a?void 0:a.firstName)+" "+(null===_||void 0===_||null===(o=_.projectManager)||void 0===o?void 0:o.lastName)||"Mike Field",onClick:e=>{e.stopPropagation();const t=new Set(de);t.has(A)?t.delete(A):t.add(A),ue(t)},children:(null===_||void 0===_||null===(i=_.projectManager)||void 0===i?void 0:i.firstName)||(null===_||void 0===_||null===(l=_.projectManager)||void 0===l?void 0:l.name)||"Mike"}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation();const t=new Set(de);t.has(A)?t.delete(A):t.add(A),ue(t)},className:"transform transition-transform duration-200 ".concat(de.has(A)?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[U&&(0,kt.jsx)("span",{className:"text-[8px] font-semibold text-blue-500",children:"Assigned to you"}),(0,kt.jsx)("div",{className:"w-8 h-3 px-0.5 py-0 border border-gray-300 rounded-full flex items-center justify-center text-black font-medium text-[7px] bg-white",children:F((null===(c=e.user)||void 0===c?void 0:c.role)||C.defaultResponsible||"OFFICE")}),(0,kt.jsx)("div",{className:"transform transition-transform duration-200 ".concat(R?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),(0,kt.jsxs)("div",{className:"flex items-center text-[9px]",style:{marginTop:"-2px",marginLeft:"-5px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{width:"210px"},children:[(0,kt.jsx)("span",{className:"font-medium ".concat(k?"text-gray-400":"text-gray-500"),style:{width:"50px"},children:"Section:"}),(0,kt.jsx)("span",{className:"font-semibold truncate ".concat(k?"text-gray-200":"text-gray-700"),children:W||"Unknown Section"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-1",children:[(0,kt.jsx)("span",{className:"font-medium ".concat(k?"text-gray-400":"text-gray-500"),children:"Line Item:"}),(0,kt.jsx)("span",{className:"font-semibold cursor-pointer hover:underline max-w-[120px] truncate ".concat(k?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),title:z||"Unknown Line Item",onClick:async t=>{if(t.stopPropagation(),_&&E){console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Starting alert line item navigation"),console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Project:",_.name),console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Phase:",T),console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Section:",W),console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Line Item:",z);try{const t=await fetch("/api/workflow-data/project-position/".concat(_.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(t.ok){const r=await t.json();if(console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Position data:",r),r.success&&r.data){const t=r.data,n=async()=>{try{const e=await fetch("/api/workflow-data/full-structure",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(e.ok){const r=await e.json();if(r.success&&r.data){const e=r.data.find(e=>e.id===t.currentPhase);if(e){const r=e.items.find(e=>e.id===t.currentSection);if(r){const e=r.subtasks.findIndex(e=>"object"===typeof e?e.id===t.currentLineItem||e.label===t.currentLineItemName:e===t.currentLineItemName);return console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Found subtask index:",e,"for line item:",z),e>=0?e:0}}}}}catch(e){console.warn("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Could not determine subtask index:",e)}return 0},s=await n(),a=C.stepId||C.lineItemId||"".concat(t.currentPhase,"-").concat(t.currentSection,"-").concat(s),o=C.sectionId||t.currentSection||null;console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Generated targetLineItemId:",a),console.log("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Generated targetSectionId:",o);const i=(0,Y.A)((0,Y.A)({},_),{},{highlightStep:z,highlightLineItem:z,targetPhase:T,targetSection:W,targetLineItem:z,scrollToCurrentLineItem:!0,alertPhase:T,navigationTarget:{phase:T,section:W,lineItem:z,stepName:z,alertId:A,lineItemId:C.stepId||C.lineItemId||e.stepId,workflowId:C.workflowId||e.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(C.stepId||C.lineItemId||z.replace(/\s+/g,"-").toLowerCase()),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:o,expandPhase:!0,expandSection:!0,autoOpen:!0}});O(i,"Project Workflow",null,"Current Alerts",a,o)}else{console.warn("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: No position data found, using fallback navigation");const e=(0,Y.A)((0,Y.A)({},_),{},{highlightStep:z,highlightLineItem:z,targetPhase:T,targetSection:W,targetLineItem:z,scrollToCurrentLineItem:!0,alertPhase:T,navigationTarget:{phase:T,section:W,lineItem:z,stepName:z,alertId:A,lineItemId:C.stepId||C.lineItemId,workflowId:C.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"line-item-".concat(z.replace(/\s+/g,"-").toLowerCase()),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:I,expandPhase:!0,expandSection:!0,autoOpen:!0}});O(e,"Project Workflow",null,"Current Alerts",P,I)}}else{console.error("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Failed to get project position, using fallback navigation");const e=(0,Y.A)((0,Y.A)({},_),{},{highlightStep:z,highlightLineItem:z,targetPhase:T,targetSection:W,targetLineItem:z,scrollToCurrentLineItem:!0,alertPhase:T,navigationTarget:{phase:T,section:W,lineItem:z,stepName:z,alertId:A,lineItemId:C.stepId||C.lineItemId,workflowId:C.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"line-item-".concat(z.replace(/\s+/g,"-").toLowerCase()),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:I,expandPhase:!0,expandSection:!0,autoOpen:!0}});O(e,"Project Workflow",null,"Current Alerts",P,I)}}catch(r){console.error("\ud83c\udfaf PROJECT_DETAIL ALERTS CLICK: Error getting project position:",r);const e=(0,Y.A)((0,Y.A)({},_),{},{highlightStep:z,highlightLineItem:z,targetPhase:T,targetSection:W,targetLineItem:z,scrollToCurrentLineItem:!0,alertPhase:T,navigationTarget:{phase:T,section:W,lineItem:z,stepName:z,alertId:A,lineItemId:C.stepId||C.lineItemId,workflowId:C.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"line-item-".concat(z.replace(/\s+/g,"-").toLowerCase()),highlightColor:"#0066CC",highlightDuration:3e3}});O(e,"Project Workflow",null,"Current Alerts",P,I)}}},children:z})]})]}),le.has(A)&&(0,kt.jsxs)("div",{className:"flex items-start gap-2",children:[(0,kt.jsx)("div",{className:"w-8 flex-shrink-0"}),(0,kt.jsxs)("div",{className:"flex-1 p-2 rounded border text-[9px] ".concat(k?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("div",{className:"font-semibold mb-1 ".concat(k?"text-white":"text-gray-800"),children:(null===_||void 0===_||null===(d=_.customer)||void 0===d?void 0:d.name)||(null===_||void 0===_?void 0:_.clientName)||C.projectName||"Primary Customer"}),(0,kt.jsxs)("div",{className:"space-y-0.5",children:[(0,kt.jsxs)("div",{className:"".concat(k?"text-gray-300":"text-gray-600"),children:["\ud83d\udccd ",(null===_||void 0===_||null===(u=_.customer)||void 0===u?void 0:u.address)||(null===_||void 0===_?void 0:_.clientAddress)||"123 Main Street, City, State 12345"]}),(0,kt.jsxs)("a",{href:"tel:".concat(((null===_||void 0===_||null===(h=_.customer)||void 0===h?void 0:h.phone)||(null===_||void 0===_?void 0:_.clientPhone)||"(555) 123-4567").replace(/[^\d+]/g,"")),className:"block font-medium transition-colors ".concat(k?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),children:["\ud83d\udcde ",(null===_||void 0===_||null===(m=_.customer)||void 0===m?void 0:m.phone)||(null===_||void 0===_?void 0:_.clientPhone)||"(555) 123-4567"]}),(0,kt.jsxs)("a",{href:"mailto:".concat((null===_||void 0===_||null===(p=_.customer)||void 0===p?void 0:p.email)||(null===_||void 0===_?void 0:_.clientEmail)||"customer@email.com"),className:"block font-medium transition-colors ".concat(k?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),children:["\u2709\ufe0f ",(null===_||void 0===_||null===(g=_.customer)||void 0===g?void 0:g.email)||(null===_||void 0===_?void 0:_.clientEmail)||"customer@email.com"]})]})]})]}),de.has(A)&&(0,kt.jsxs)("div",{className:"flex items-start gap-2",children:[(0,kt.jsx)("div",{className:"w-8 flex-shrink-0"}),(0,kt.jsxs)("div",{className:"flex-1 p-2 rounded border text-[9px] ".concat(k?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("div",{className:"font-semibold mb-1 ".concat(k?"text-white":"text-gray-800"),children:(null===_||void 0===_||null===(x=_.projectManager)||void 0===x?void 0:x.name)||(null===_||void 0===_||null===(v=_.projectManager)||void 0===v?void 0:v.firstName)+" "+(null===_||void 0===_||null===(y=_.projectManager)||void 0===y?void 0:y.lastName)||"Mike Field"}),(0,kt.jsxs)("div",{className:"space-y-0.5",children:[(0,kt.jsxs)("a",{href:"tel:".concat(((null===_||void 0===_||null===(b=_.projectManager)||void 0===b?void 0:b.phone)||"(555) 234-5678").replace(/[^\d+]/g,"")),className:"block font-medium transition-colors ".concat(k?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),children:["\ud83d\udcde ",(null===_||void 0===_||null===(j=_.projectManager)||void 0===j?void 0:j.phone)||"(555) 234-5678"]}),(0,kt.jsxs)("a",{href:"mailto:".concat((null===_||void 0===_||null===(N=_.projectManager)||void 0===N?void 0:N.email)||"mike.field@company.com"),className:"block font-medium transition-colors ".concat(k?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),children:["\u2709\ufe0f ",(null===_||void 0===_||null===(S=_.projectManager)||void 0===S?void 0:S.email)||"mike.field@company.com"]})]})]})]}),R&&(0,kt.jsx)("div",{className:"px-2 py-2 border-t ".concat(k?"bg-[#232b4d] border-gray-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{const t=e._id||e.id;at(e=>(0,Y.A)((0,Y.A)({},e),{},{["".concat(t,"-complete")]:!0}));try{var r,n,s,a,o,i,l;console.log("\ud83d\udd04 Completing alert:",e),console.log("\ud83d\udd0d Alert metadata:",e.metadata);const c=(null===(r=e.relatedProject)||void 0===r?void 0:r._id)||e.projectId||(null===(n=e.project)||void 0===n?void 0:n._id),d=(null===(s=e.metadata)||void 0===s?void 0:s.stepName)||(null===(a=e.metadata)||void 0===a?void 0:a.cleanTaskName)||e.stepName||e.title,u=(null===(o=e.metadata)||void 0===o?void 0:o.projectName)||(null===(i=e.relatedProject)||void 0===i?void 0:i.projectName);console.log("\ud83c\udfaf COMPLETION: Target info:",{projectId:c,stepName:d,projectName:u});let h=null;if(null!==(l=e.metadata)&&void 0!==l&&l.lineItemId)h=e.metadata.lineItemId,console.log("\u2705 Found lineItemId in metadata");else if(e.stepId)h=e.stepId,console.log("\u2705 Using stepId as lineItemId");else{if(!e.id)return console.error("\u274c Could not find line item information in alert:",{hasMetadata:!!e.metadata,metadataKeys:e.metadata?Object.keys(e.metadata):[],hasStepId:!!e.stepId,alertKeys:Object.keys(e)}),console.log("\ud83d\udd04 Marking alert as read since line item info is missing"),void at(e=>(0,Y.A)((0,Y.A)({},e),{},{["".concat(t,"-complete")]:!1}));h=e.id,console.log("\u26a0\ufe0f Using alert ID as lineItemId (fallback)")}console.log("\ud83d\ude80 Attempting to complete workflow item using NEW DATABASE SYSTEM: lineItemId=".concat(h));const m=await fa.completeLineItem(c,h,"Completed via project detail alerts by user",t);console.log("\u2705 NEW SYSTEM: Line item completed successfully:",m),console.log("\u2705 SUCCESS: Line item '".concat(d,"' has been completed for project ").concat(u)),Vr.success((0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,kt.jsx)("span",{children:"Task marked as completed and saved successfully"})]}),{duration:3e3,style:{background:"#10B981",color:"#ffffff",fontWeight:"600"}});const p=new CustomEvent("workflowStepCompleted",{detail:{projectId:c,lineItemId:h,stepName:d,projectName:u,source:"Project Detail Alerts Tab",timestamp:(new Date).toISOString()}});window.dispatchEvent(p),console.log("\ud83d\udce1 GLOBAL EVENT: Dispatched workflowStepCompleted event from Project Detail Alerts")}catch(c){console.error("\u274c Failed to complete alert:",c),Vr.error("Failed to complete workflow step: ".concat(c.message),{duration:4e3,style:{background:"#EF4444",color:"#ffffff",fontWeight:"600"}})}finally{at(e=>(0,Y.A)((0,Y.A)({},e),{},{["".concat(t,"-complete")]:!1}))}})(e)},disabled:st["".concat(A,"-complete")],className:"flex-1 px-2 py-1 text-[9px] font-semibold rounded border transition-all duration-200 ".concat(st["".concat(A,"-complete")]?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 text-white border-green-500 hover:from-green-600 hover:to-green-700 hover:border-green-600 shadow-sm hover:shadow-md"),children:st["".concat(A,"-complete")]?(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-1 h-3 w-3 text-green-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Completing..."]}):(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Complete"]})}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{ne(e),te(!0)})(e)},disabled:st["".concat(A,"-assign")],className:"flex-1 px-2 py-1 text-[9px] font-semibold rounded border transition-all duration-200 ".concat(st["".concat(A,"-assign")]?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-blue-600 text-white border-blue-500 hover:from-blue-600 hover:to-blue-700 hover:border-blue-600 shadow-sm hover:shadow-md"),children:(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Assign to User"]})})]})})]},A)})})]}),ee&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,kt.jsxs)("div",{className:"".concat(k?"bg-[#1e293b]":"bg-white"," rounded-lg p-6 max-w-md w-full mx-4"),children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold mb-4 ".concat(k?"text-white":"text-gray-800"),children:"Assign Alert to User"}),re&&(0,kt.jsxs)("div",{className:"mb-4 p-3 rounded border ".concat(k?"bg-[#232b4d] border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsxs)("p",{className:"text-sm font-medium ".concat(k?"text-gray-200":"text-gray-700"),children:["Alert: ",(null===(e=re.metadata)||void 0===e?void 0:e.stepName)||re.title||"Unknown Alert"]}),(0,kt.jsxs)("p",{className:"text-xs mt-1 ".concat(k?"text-gray-400":"text-gray-500"),children:["Project: ",(null===(t=re.metadata)||void 0===t?void 0:t.projectName)||"Unknown Project"]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium mb-2 ".concat(k?"text-gray-300":"text-gray-700"),children:["Select User ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{value:se,onChange:e=>ae(e.target.value),className:"w-full p-2 border rounded text-sm ".concat(k?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),required:!0,children:[(0,kt.jsx)("option",{value:"",children:"Select a user..."}),Array.isArray($e)&&$e.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,kt.jsx)("button",{onClick:()=>{te(!1),ne(null),ae("")},className:"px-4 py-2 text-sm font-medium rounded border transition-colors ".concat(k?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:U,disabled:!se||st["".concat((null===re||void 0===re?void 0:re._id)||(null===re||void 0===re?void 0:re.id),"-assign")],className:"px-4 py-2 text-sm font-medium rounded transition-colors ".concat(se&&!st["".concat((null===re||void 0===re?void 0:re._id)||(null===re||void 0===re?void 0:re.id),"-assign")]?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:st["".concat((null===re||void 0===re?void 0:re._id)||(null===re||void 0===re?void 0:re.id),"-assign")]?(0,kt.jsxs)("span",{className:"flex items-center",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Assigning..."]}):"Assign Alert"})]})]})})]});case"Project Timeline":const r=(e,t,r,n)=>{if(!e||!t)return"TBD";const s=new Date(e),a=(new Date(t)-s)/n,o=new Date(s.getTime()+r*a),i=new Date(s.getTime()+(r+1)*a);return"".concat(o.toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ").concat(i.toLocaleDateString("en-US",{month:"short",day:"numeric"}))},n=(e,t)=>{if(!e)return"TBD";if(!t)return e;const r=new Date(e),n=new Date(t);return"".concat(r.toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ").concat(n.toLocaleDateString("en-US",{month:"short",day:"numeric"}))},s=[{phase:"Materials Delivery",date:n(H.materialsDeliveryStart,H.materialsDeliveryEnd),label:"Materials Delivery",detail:"Delivery and inspection of all project materials",tasks:["Schedule Delivery","Receive Materials","Inspect Materials","Store Materials Securely","Verify All Items Received"],responsible:"\ud83d\ude9a Delivery + \ud83d\udc77\u200d\u2642\ufe0f PM"},{phase:"Labor Phase",date:n(H.laborStart,H.laborEnd),label:"Installation & Labor",detail:"Field installation, progress monitoring, quality assurance",tasks:["Installation Process (Field Crew)","Daily Progress Documentation","Quality Check (Field + Admin)","Customer Updates","Subcontractor Coordination"],responsible:"\ud83d\udee0\ufe0f Field Crew + \ud83d\udcdd Admin"},{phase:"Lead Phase",date:r(H.startDate,H.endDate,0,6),label:"Lead Processing",detail:"Customer information input, property evaluation, PM assignment",tasks:["Input Customer Information","Complete Questions Checklist","Input Lead Property Information","Assign Project Manager","Schedule Initial Inspection"],responsible:"\ud83c\udfe2 Office"},{phase:"Prospect Phase",date:r(H.startDate,H.endDate,1,6),label:"Site Inspection & Estimation",detail:"Site inspection, estimate preparation, insurance processing",tasks:["Site Inspection (PM)","Write Estimate (PM)","Insurance Process (Admin)","Agreement Preparation (Admin)","Agreement Signing (Admin)"],responsible:"\ud83d\udc77\u200d\u2642\ufe0f PM + \ud83d\udcdd Admin"},{phase:"Approved Phase",date:r(H.startDate,H.endDate,2,6),label:"Project Setup",detail:"Material ordering, permit processing, production preparation",tasks:["Administrative Setup","Pre-Job Actions (Permits)","Prepare for Production","Verify Labor Orders","Verify Material Orders"],responsible:"\ud83d\udcdd Admin + \ud83c\udfe2 Office"},{phase:"Execution Phase",date:r(H.startDate,H.endDate,3,6),label:"Installation & Quality Check",detail:"Field installation, progress monitoring, quality assurance",tasks:["Installation Process (Field Crew)","Daily Progress Documentation","Quality Check (Field + Admin)","Customer Updates","Subcontractor Coordination"],responsible:"\ud83d\udee0\ufe0f Field Crew + \ud83d\udcdd Admin"},{phase:"2nd Supplement Phase",date:r(H.startDate,H.endDate,4,6),label:"Supplement Processing",detail:"Insurance supplement creation, follow-up, customer updates",tasks:["Create Supplement in Xactimate","Insurance Follow-up","Review Approved Items","Customer Updates","Final Supplement Processing"],responsible:"\ud83d\udcdd Administration"},{phase:"Completion Phase",date:r(H.startDate,H.endDate,5,6),label:"Project Closeout",detail:"Final inspection, financial processing, warranty registration",tasks:["Final Inspection","Financial Processing","AR Follow-Up","Project Closeout","Warranty Registration"],responsible:"\ud83c\udfe2 Office + \ud83d\udcdd Admin"}],a=(e,t,r)=>{new Date;return t&&new Date(t),e<15?0:e<30?1:e<45?2:e<60?3:e<75?4:e<85?5:e<95?6:7},o=a(H.progress||0,H.materialsDeliveryStart,H.laborStart);return(0,kt.jsx)("div",{className:"space-y-6",children:(0,kt.jsx)(oc,{timeline:s,currentStep:o})});case"Project Documents":return(0,kt.jsx)(Ql,{project:H,onBack:x,colorMode:k});case"Email History":return(0,kt.jsx)(Hd,{projectId:H.id});case"Work Order":return(0,kt.jsx)("div",{className:"p-8 text-center text-gray-400 text-sm",children:"(Blank for now)"})}};return f?(0,kt.jsxs)("div",{className:"h-full flex flex-col bg-white",children:[(0,kt.jsx)(qd,{}),(0,kt.jsxs)("div",{className:"bg-white border-b border-gray-200 shadow-sm",children:[(0,kt.jsx)("div",{className:"px-6 py-4 border-b border-gray-100 bg-white",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,kt.jsx)(Qi,{onClick:x||(()=>{var e;console.log("\ud83d\udd0d BACK BUTTON: handleBackButton called"),console.log("\ud83d\udd0d BACK BUTTON: projectSourceSection:",C);const t=null===f||void 0===f||null===(e=f.dashboardState)||void 0===e?void 0:e.returnTo;if(console.log("\ud83d\udd0d BACK BUTTON: returnTo URL:",t),t)return console.log("\ud83d\udd0d BACK BUTTON: Using returnTo URL navigation"),void window.location.assign(t);if("Project Messages"===C||"My Project Messages"===C)return E&&E(null,"Overview"),void setTimeout(()=>{const e=document.querySelector('[data-section="project-messages"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},150);if("Current Alerts"!==C){if("Project Phases"===C)return E&&E(null,"Overview"),void setTimeout(()=>{const e=document.querySelector('[data-section="project-phases"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},150);console.log("\ud83d\udd0d BACK BUTTON: Using default onBack behavior"),x()}else x?x():(E&&E(null,"Overview"),setTimeout(()=>{const e=document.querySelector('[data-section="current-alerts"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},150))}),colorMode:k,variant:"primary",size:"small",preservePosition:!0,customLabel:(()=>{if(C)switch(C){case"Current Alerts":return"Back to Current Alerts";case"Project Messages":return"Back to Project Messages";case"Project Cubes":return"Back to Project Access";case"Project Phases":return"Back to Projects by Phase";case"Project Workflow Alerts":return"Back to Alerts"}switch(A){case"Overview":return"Back to Dashboard";case"Projects":return"Back to My Projects";case"Project Messages":return"Back to Messages";case"Company Calendar":return"Back to Calendar";case"AI Assistant":return"Back to AI Assistant";default:return"Back"}})()}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-xs min-w-0",children:[(0,kt.jsx)("span",{className:"font-bold text-sm",children:String(f.projectNumber||"").padStart(5,"0")}),(0,kt.jsx)("span",{className:"text-gray-400",children:"\u2022"}),(0,kt.jsx)("span",{className:"font-semibold truncate max-w-[28ch] ".concat("text-gray-800"),children:(f.address||(null===(t=f.customer)||void 0===t?void 0:t.address)||(null===(r=f.client)||void 0===r?void 0:r.address)||"").trim()||"Address not provided"}),(0,kt.jsx)("span",{className:"text-gray-400",children:"\u2022"}),(0,kt.jsx)("span",{className:"font-semibold truncate max-w-[20ch] ".concat("text-gray-800"),children:(null===(n=f.customer)||void 0===n?void 0:n.name)||(null===(s=f.client)||void 0===s?void 0:s.name)||"Client Name"}),(0,kt.jsx)("span",{className:"text-gray-400",children:"\u2022"}),(0,kt.jsx)("a",{href:"tel:".concat(((null===(a=f.customer)||void 0===a?void 0:a.phone)||(null===(i=f.client)||void 0===i?void 0:i.phone)||"").replace(/[^\d+]/g,"")||""),className:"hover:underline ".concat(k?"text-blue-600 hover:text-blue-500":"text-blue-600 hover:text-blue-700"),children:Xl((null===(l=f.customer)||void 0===l?void 0:l.phone)||(null===(c=f.client)||void 0===c?void 0:c.phone))}),(0,kt.jsx)("span",{className:"text-gray-400",children:"\u2022"}),(0,kt.jsx)("a",{href:"mailto:".concat((null===(d=f.customer)||void 0===d?void 0:d.email)||(null===(u=f.client)||void 0===u?void 0:u.email)||""),className:"hover:underline ".concat(k?"text-blue-600 hover:text-blue-500":"text-blue-600 hover:text-blue-700"),children:(null===(h=f.customer)||void 0===h?void 0:h.email)||(null===(m=f.client)||void 0===m?void 0:m.email)||"\u2014"})]})]}),(0,kt.jsx)("div",{className:"flex items-center gap-2",children:(0,kt.jsxs)("button",{onClick:async()=>{if(null===f||void 0===f||!f.id)return;if(window.confirm("Delete this project? This action cannot be undone."))try{await D.mutateAsync(f.id),Vr.success("Project deleted"),"function"===typeof x&&x()}catch(It){Vr.error((null===It||void 0===It?void 0:It.message)||"Failed to delete project")}},disabled:D.isPending,className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded border transition-colors ".concat(D.isPending?"opacity-60 cursor-not-allowed":k?"border-red-400 text-red-300 hover:bg-red-900/20":"border-red-500 text-red-600 hover:bg-red-50"),title:"Delete project",children:[(0,kt.jsx)(yn,{className:"w-4 h-4"}),(0,kt.jsx)("span",{children:"Delete"})]})})]})}),(0,kt.jsx)("div",{className:"px-4 py-1.5 bg-gray-50 border-t border-gray-100",children:(0,kt.jsx)("nav",{className:"flex space-x-6","aria-label":"Tabs",children:["Project Profile","Project Workflow","Alerts","Messages","Project Schedule","Project Documents","Email History","Work Order"].map(e=>{const t=["Project Schedule","Work Order"].includes(e);return(0,kt.jsx)("button",{disabled:t,onClick:async()=>{if(!t){if(console.log("\ud83d\udd0d PROJECT_DETAIL: Tab clicked:",e),console.log("\ud83d\udd0d PROJECT_DETAIL: Current activeView:",B),"Project Workflow"===e)try{var r,n;const e=(null===f||void 0===f?void 0:f.navigationTarget)||(null===f||void 0===f?void 0:f.highlightTarget)||{};let t=e.lineItemId||z.lineItemId||P||null,a=e.targetSectionId||e.sectionId||z.sectionId||I||null;if(!t&&null!==f&&void 0!==f&&null!==(r=f.dashboardState)&&void 0!==r&&null!==(n=r.currentAlertsState)&&void 0!==n&&n.scrollToAlert){const e=f.dashboardState.currentAlertsState.scrollToAlert;try{const r=("undefined"!==typeof ot&&Array.isArray(ot)?ot:[]).find(t=>(t._id||t.id)===e),n=(null===r||void 0===r?void 0:r.actionData)||(null===r||void 0===r?void 0:r.metadata)||{};r&&(t=n.stepId||n.lineItemId||r.stepId||null,a=n.sectionId||r.sectionId||null)}catch(Pr){}}if(!t){const e=await fetch("/api/workflow-data/project-position/".concat(f.id));if(e.ok){const r=await e.json();if(r.success&&r.data){const e=r.data;let n=0;try{const t=await fetch("/api/workflow-data/full-structure",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(t.ok){const r=await t.json();if(r.success&&r.data){var s;const t=r.data.find(t=>t.id===e.currentPhase),a=null===t||void 0===t||null===(s=t.items)||void 0===s?void 0:s.find(t=>t.id===e.currentSection);if(a){const t=a.subtasks.findIndex(t=>"object"===typeof t?t.id===e.currentLineItem||t.label===e.currentLineItemName:t===e.currentLineItemName);n=t>=0?t:0}}}}catch(Pr){}t=e.currentLineItem||"".concat(e.currentPhase,"-").concat(e.currentSection,"-").concat(n),a=e.currentSection}}}V({lineItemId:t||null,sectionId:a||null})}catch(It){}W(e),console.log("\ud83d\udd0d PROJECT_DETAIL: Setting activeView to:",e);const t=new URL(window.location.href);t.searchParams.set("tab",e.toLowerCase().replace(/\s+/g,"-")),window.history.replaceState(window.history.state,"",t.toString()),setTimeout(()=>{J.current&&(J.current.scrollTop=0),window.scrollTo({top:0,behavior:"auto"})},1)}},className:"whitespace-nowrap py-2 px-3 border-b-2 font-medium text-sm transition-colors duration-200 rounded-t-lg ".concat(t?"border-transparent text-gray-400 opacity-70 cursor-not-allowed":B===e?"border-blue-500 text-blue-600 bg-white shadow-sm":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-100"),children:"Project Workflow"===e&&K.completedPhases&&7===Object.values(K.completedPhases).length&&Object.values(K.completedPhases).every(Boolean)?(0,kt.jsx)("span",{className:"line-through",children:e}):e},e)})})})]}),(0,kt.jsx)("div",{ref:J,className:"flex-1 overflow-y-auto bg-white",children:(0,kt.jsx)("div",{className:"p-3 bg-white",children:(0,kt.jsxs)("div",{className:"min-h-[calc(100vh-200px)] bg-white",children:["Project Profile"===B&&(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("span",{className:"text-[12px] font-semibold text-gray-800",children:String(f.projectNumber||f.id||"").padStart(5,"0")}),(0,kt.jsx)("h1",{className:"text-[14px] font-bold text-gray-900 truncate",children:(f.address||(null===(p=f.customer)||void 0===p?void 0:p.address)||"").trim()||"Address not provided"}),f.projectType&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-md text-[10px] font-medium border ".concat(k?ca(f.projectType):la(f.projectType)),children:ia(f.projectType)})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("label",{className:"text-[11px] text-gray-600",children:"Address:"}),(0,kt.jsx)("input",{type:"text",defaultValue:(f.address||(null===(g=f.customer)||void 0===g?void 0:g.address)||"").trim(),onBlur:async e=>{const t=e.target.value;try{await Ds.projectsService.update(f.id,{address:t})}catch(Pr){}},className:"min-w-[260px] max-w-[520px] flex-1 px-2 py-1 border rounded-md text-[11px] bg-white border-gray-300 text-gray-800 placeholder-gray-400",placeholder:"Project address",title:"Click to edit project address"})]})]}),("Project Workflow"===B&&console.log("\ud83d\udd0d PROJECT_DETAIL: Passing workflow target to checklist:",z),gt())]})})})]}):(0,kt.jsx)("div",{className:"text-red-600 font-bold p-8",children:"No project selected or project data is missing."})},Gd=e=>{let{colorMode:t,onProjectSelect:r,navigate:n}=e;const[s,a]=(0,o.useState)({key:"archivedAt",direction:"desc"}),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)("all"),[u,h]=(0,o.useState)("all"),[m]=(0,o.useState)(!0),[p,g]=(0,o.useState)([]),[f,x]=(0,o.useState)(!1),[v,y]=(0,o.useState)("");(0,o.useEffect)(()=>{b()},[]);const b=async()=>{try{x(!0),y("");const e=await Ds.projectsService.getArchived({limit:100});g(e.data||[])}catch(ES){var e,t;y((null===(e=ES.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to load archived projects")}finally{x(!1)}},w=(0,o.useMemo)(()=>{let e=p;return i&&(e=e.filter(e=>{var t,r,n,s;return(null===(t=e.projectName)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null===(r=e.customer)||void 0===r||null===(n=r.name)||void 0===n?void 0:n.toLowerCase().includes(i.toLowerCase()))||(null===(s=e.address)||void 0===s?void 0:s.toLowerCase().includes(i.toLowerCase()))})),"all"!==c&&(e=e.filter(e=>new Date(e.archivedAt||e.endDate).getFullYear().toString()===c)),"all"!==u&&(e=e.filter(e=>e.projectType===u)),e.sort((e,t)=>{var r,n,a,o;let i,l;switch(s.key){case"projectName":i=(e.projectName||"").toLowerCase(),l=(t.projectName||"").toLowerCase();break;case"customer":i=((null===(r=e.customer)||void 0===r?void 0:r.name)||"").toLowerCase(),l=((null===(n=t.customer)||void 0===n?void 0:n.name)||"").toLowerCase();break;case"projectType":i=(e.projectType||"").toLowerCase(),l=(t.projectType||"").toLowerCase();break;case"budget":i=e.budget||0,l=t.budget||0;break;case"endDate":i=new Date(e.endDate),l=new Date(t.endDate);break;case"archivedAt":i=new Date(e.archivedAt||e.endDate),l=new Date(t.archivedAt||t.endDate);break;case"projectManager":i=((null===(a=e.projectManager)||void 0===a?void 0:a.firstName)||"").toLowerCase(),l=((null===(o=t.projectManager)||void 0===o?void 0:o.firstName)||"").toLowerCase();break;default:return 0}return i<l?"asc"===s.direction?-1:1:i>l?"asc"===s.direction?1:-1:0}),e},[p,i,c,u,s]),j=(0,o.useMemo)(()=>[...new Set((p||[]).map(e=>new Date(e.archivedAt||e.endDate).getFullYear().toString()))].sort((e,t)=>t-e),[p]),N=(0,o.useMemo)(()=>[...new Set((p||[]).map(e=>e.projectType))].filter(Boolean),[p]),S=e=>{let{children:t,sortKey:r,className:n=""}=e;return(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ".concat(n),onClick:()=>{return e=r,void a(t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"}));var e},children:(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[t,s.key===r&&(0,kt.jsx)("span",{className:"text-blue-600",children:"asc"===s.direction?"\u2191":"\u2193"})]})})};return f?(0,kt.jsx)("div",{className:"animate-fade-in w-full max-w-full",children:(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:"Loading archived projects..."})]})}):(0,kt.jsxs)("div",{className:"animate-fade-in w-full max-w-full",children:[(0,kt.jsxs)("div",{className:"mb-6 flex items-start justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h1",{className:"text-lg font-bold ".concat(t?"text-white":"text-gray-800"),children:["Archived Projects (",p.length,")"]}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:"Projects that have been archived and moved out of active management"})]}),(0,kt.jsxs)("button",{onClick:()=>n&&n("Email History"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border transition-all duration-200 ".concat(t?"bg-[#1e293b] border-[#3b82f6]/30 text-white hover:bg-[#232b4d] hover:border-[#3b82f6]/50":"bg-white border-gray-300 text-gray-800 hover:bg-gray-50 hover:border-blue-500"),children:[(0,kt.jsx)(wn,{className:"w-5 h-5"}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:"Email History"})]})]}),v&&(0,kt.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:v}),(0,kt.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat(t?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Search Projects"}),(0,kt.jsx)("input",{type:"text",value:i,onChange:e=>l(e.target.value),placeholder:"Search by name, client, or address...",className:"w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(t?"bg-[#232b4d] border-[#3b82f6]/30 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Archive Year"}),(0,kt.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(t?"bg-[#232b4d] border-[#3b82f6]/30 text-white":"bg-white border-gray-300 text-gray-900"),children:[(0,kt.jsx)("option",{value:"all",children:"All Years"}),j.map(e=>(0,kt.jsx)("option",{value:e,children:e},e))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Project Type"}),(0,kt.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(t?"bg-[#232b4d] border-[#3b82f6]/30 text-white":"bg-white border-gray-300 text-gray-900"),children:[(0,kt.jsx)("option",{value:"all",children:"All Types"}),N.map(e=>(0,kt.jsx)("option",{value:e,children:e},e))]})]}),(0,kt.jsx)("div",{className:"flex items-end",children:(0,kt.jsxs)("div",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:[w.length," of ",p.length," projects"]})})]})}),(0,kt.jsx)("div",{className:"shadow-[0_2px_8px_rgba(0,0,0,0.1)] rounded-[8px] overflow-hidden ".concat(t?"bg-[#232b4d]/80":"bg-white"),children:m&&(0,kt.jsx)("div",{className:"overflow-x-auto",children:w.length>0?(0,kt.jsxs)("table",{className:"w-full divide-y divide-gray-200 dark:divide-gray-700",role:"table",children:[(0,kt.jsx)("thead",{className:"".concat(t?"bg-[#1e293b]":"bg-gray-50"),children:(0,kt.jsxs)("tr",{role:"row",children:[(0,kt.jsx)(S,{sortKey:"projectName",className:t?"text-gray-200":"text-gray-700",children:"Project Name"}),(0,kt.jsx)(S,{sortKey:"customer",className:t?"text-gray-200":"text-gray-700",children:"Customer"}),(0,kt.jsx)(S,{sortKey:"projectType",className:t?"text-gray-200":"text-gray-700",children:"Type"}),(0,kt.jsx)(S,{sortKey:"budget",className:t?"text-gray-200":"text-gray-700",children:"Budget"}),(0,kt.jsx)(S,{sortKey:"archivedAt",className:t?"text-gray-200":"text-gray-700",children:"Archived Date"}),(0,kt.jsx)(S,{sortKey:"projectManager",className:t?"text-gray-200":"text-gray-700",children:"Project Manager"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase tracking-wider ".concat(t?"text-gray-200":"text-gray-700"),children:"Actions"})]})}),(0,kt.jsx)("tbody",{className:"divide-y ".concat(t?"bg-[#1e293b] divide-[#3b82f6]/40":"bg-white divide-gray-200"),children:w.map((e,n)=>{var s,a,o,i,l,c;const d=(e=>{const t=new Date(e.archivedAt),r=new Date;return Math.floor((r-t)/864e5)<=30?{text:"Recently Archived",color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"}:{text:"Archived",color:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}})(e);return(0,kt.jsxs)("tr",{className:"\n                                                    ".concat(n%2===0?t?"bg-[#1e293b]":"bg-white":t?"bg-[#232b4d]":"bg-gray-50","\n                                                    hover:bg-blue-50 dark:hover:bg-gray-700 hover:shadow-sm transition-all duration-200 cursor-pointer\n                                                "),role:"row",onClick:()=>r&&r(e,"Project Workflow",null,"Archived Projects"),children:[(0,kt.jsx)("td",{className:"px-3 py-3 text-sm font-semibold ".concat(t?"text-white":"text-gray-900"),role:"cell",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r ".concat((e.projectType,"bg-gradient-to-r from-gray-500 to-gray-600")," rounded-lg flex items-center justify-center text-white font-bold text-xs"),children:(null===(s=e.projectType)||void 0===s||null===(a=s.charAt(0))||void 0===a?void 0:a.toUpperCase())||"P"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"truncate max-w-48",title:e.projectName,children:e.projectName}),(0,kt.jsx)("div",{className:"text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:e.address})]})]})}),(0,kt.jsxs)("td",{className:"px-3 py-3 text-sm ".concat(t?"text-white":"text-gray-900"),role:"cell",children:[(0,kt.jsx)("div",{className:"font-medium",children:(null===(o=e.customer)||void 0===o?void 0:o.name)||"Unknown"}),(0,kt.jsx)("div",{className:"text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:(null===(i=e.customer)||void 0===i?void 0:i.email)||"No email"})]}),(0,kt.jsx)("td",{className:"px-3 py-3",role:"cell",children:(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-50 text-gray-700 border border-gray-300 shadow-sm",children:e.projectType||"Unknown"})}),(0,kt.jsx)("td",{className:"px-3 py-3 text-sm font-semibold ".concat(t?"text-white":"text-gray-900"),role:"cell",children:(h=e.budget||0,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(h))}),(0,kt.jsx)("td",{className:"px-3 py-3",role:"cell",children:(0,kt.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,kt.jsx)("div",{className:"text-sm ".concat(t?"text-white":"text-gray-900"),children:(u=e.archivedAt,new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))}),(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ".concat(d.color),children:d.text})]})}),(0,kt.jsx)("td",{className:"px-3 py-3 text-sm ".concat(t?"text-white":"text-gray-900"),role:"cell",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-xs",children:(null===(l=e.projectManager)||void 0===l||null===(c=l.firstName)||void 0===c?void 0:c.charAt(0))||"P"}),(0,kt.jsx)("span",{className:"font-medium",children:e.projectManager?"".concat(e.projectManager.firstName," ").concat(e.projectManager.lastName):"Unknown"})]})}),(0,kt.jsx)("td",{className:"px-3 py-3",role:"cell",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),r&&r(e,"Project Workflow",null,"Archived Projects")},className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded transition-all duration-200 ".concat(t?"text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 border border-blue-400/30 hover:border-blue-400/50":"text-blue-600 hover:text-blue-700 hover:bg-blue-50 border border-blue-200 hover:border-blue-300"),children:"View"}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{try{await Ds.projectsService.archive(e._id||e.id),console.log("\u2705 Project unarchived successfully"),b()}catch(ES){var t,r;console.error("\u274c Error unarchiving project:",ES),y((null===(t=ES.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"Failed to unarchive project")}})(e)},className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded transition-all duration-200 ".concat(t?"text-green-400 hover:text-green-300 hover:bg-green-900/20 border border-green-400/30 hover:border-green-400/50":"text-green-600 hover:text-green-700 hover:bg-green-50 border border-green-200 hover:border-green-300"),children:"Unarchive"})]})})]},e._id||e.id);var u,h})})]}):(0,kt.jsxs)("div",{className:"p-8 text-center",children:[(0,kt.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udce6"}),(0,kt.jsx)("h3",{className:"text-lg font-semibold mb-2 ".concat(t?"text-white":"text-gray-900"),children:"No Archived Projects Found"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:i||"all"!==c||"all"!==u?"Try adjusting your search criteria or filters.":"No projects have been archived yet. Archive projects from the main projects page to see them here."})]})})})]})},Jd=e=>{var t,r,n,s,a,i,l,d,u,h,m,p;let{projects:g=[],selectedProject:f,onProjectSelect:x,onProjectNavigate:v,colorMode:y=!1,placeholder:b="Select Project"}=e;const[w,j]=(0,o.useState)(!1),[N,S]=(0,o.useState)(null),[k,A]=(0,o.useState)(""),C=(0,o.useRef)(null),[E,P]=(0,o.useState)(null),[I,T]=(0,o.useState)(null),D=e=>{console.log("\ud83d\udd0d EnhancedProjectDropdown: handleProjectSelect called with:",e),console.log("\ud83d\udd0d EnhancedProjectDropdown: Current selectedProject:",f),console.log("\ud83d\udd0d EnhancedProjectDropdown: About to call onProjectSelect"),x(e),console.log("\ud83d\udd0d EnhancedProjectDropdown: onProjectSelect called, closing dropdown"),j(!1),A("")},M=(e,t)=>{v&&v(e,t)};(0,o.useEffect)(()=>{const e=()=>{if(!C.current)return;const e=C.current.getBoundingClientRect(),t={position:"fixed",top:e.bottom+8,left:e.left,width:e.width,zIndex:3e4};P(t),T((0,Y.A)({},t))};if(w||f&&N===f.id)return e(),window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e,!0)}},[w,N,f]);const _={LEAD:{name:"Lead",color:"#EAB308",initial:"L"},PROSPECT:{name:"Prospect",color:"#F97316",initial:"P"},APPROVED:{name:"Approved",color:"#10B981",initial:"A"},EXECUTION:{name:"Execution",color:"#D946EF",initial:"E"},SECOND_SUPPLEMENT:{name:"2nd Supplement",color:"#8B5CF6",initial:"S"},COMPLETION:{name:"Completion",color:"#0EA5E9",initial:"C"}},O=e=>{const t=(e=>e?e.currentWorkflowItem&&e.currentWorkflowItem.phase?e.currentWorkflowItem.phase:e.phase?e.phase:"LEAD":"LEAD")(e);return _[t]||_.LEAD},L=e=>"F59E0B"===e.replace("#","").toUpperCase()?"#111827":"white",R=e=>{const t="w-4 h-4 cursor-pointer hover:scale-110 transition-transform duration-200";switch(e){case"workflow":return(0,kt.jsx)("svg",{className:"".concat(t," text-blue-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})});case"alerts":return(0,kt.jsx)("svg",{className:"".concat(t," text-red-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"messages":return(0,kt.jsx)("svg",{className:"".concat(t," text-green-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})});default:return null}},F=g.filter(e=>"archived"!==e.status).filter(e=>{var t;const r=(k||"").toLowerCase().trim();if(!r)return!0;const n=String(e.projectNumber||e.id||"").padStart(5,"0").toLowerCase(),s=(e.customerName||(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.projectName||e.name||"").toLowerCase();return n.includes(r.replace("#",""))||s.includes(r)}).slice(0,50);return(0,kt.jsxs)("div",{className:"relative w-full",style:{zIndex:200,position:"sticky",top:0},children:[(0,kt.jsxs)("button",{onClick:()=>j(!w),className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:border-blue-500 transition-colors relative z-30 w-full",ref:C,children:[(0,kt.jsx)("span",{className:"text-sm font-medium",children:f?(0,kt.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",style:{backgroundColor:O(f).color,color:L(O(f).color)},title:"Phase: ".concat(O(f).name),children:O(f).initial}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:["#",String(f.projectNumber||f.id).padStart(5,"0")]}),(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-900 truncate flex-1",children:f.projectName||f.name}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),M(f,"Project Workflow")},title:"Go to Project Workflow",className:"p-1 hover:bg-blue-100 rounded",children:R("workflow")}),(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),M(f,"Alerts")},title:"Go to Project Alerts",className:"p-1 hover:bg-red-100 rounded",children:R("alerts")}),(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),M(f,"Messages")},title:"Go to Project Profile",className:"p-1 hover:bg-green-100 rounded",children:R("messages")})]}),(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),D(null)},title:"Clear project selection",className:"p-1 rounded hover:bg-red-100 cursor-pointer text-red-600",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,kt.jsxs)("div",{onClick:e=>{var t;e.stopPropagation(),t=f.id,S(N===t?null:t)},title:N===f.id?"Hide project details (Address, Contact, PM)":"Show project details (Address, Contact, PM)",className:"p-1 rounded hover:bg-gray-100 flex items-center gap-1 cursor-pointer",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 transition-transform",style:{transform:N===f.id?"rotate(180deg)":"rotate(0deg)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:"Details"})]})]}):(0,kt.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm bg-gray-400 text-white",title:"General Chat - No Project Context",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,kt.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"No Project Selected"}),(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:"Chat about general topics"})]})]})}),(0,kt.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform",style:{transform:w?"rotate(180deg)":"rotate(0deg)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",title:w?"Close project list":"Open project list to search and select",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),f&&N===f.id&&I&&c.createPortal((0,kt.jsxs)("div",{style:I,className:"px-4 py-3 bg-gradient-to-r from-gray-50 to-blue-50 border border-gray-200 rounded-lg shadow-lg",children:[(0,kt.jsxs)("div",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Project Information"]}),(0,kt.jsx)("div",{className:"mb-2",children:(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsxs)("svg",{className:"w-3 h-3 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,kt.jsx)("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide w-16",children:"Address:"}),(0,kt.jsx)("span",{className:"text-sm text-gray-800 ml-2",children:f.address||(null===(t=f.customer)||void 0===t?void 0:t.address)||"No address available"})]})}),(0,kt.jsx)("div",{className:"mb-2",children:(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,kt.jsx)("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide w-16",children:"Contact:"}),(0,kt.jsxs)("span",{className:"text-sm text-gray-800 ml-2",children:[(null===(r=f.customer)||void 0===r?void 0:r.primaryName)||(null===(n=f.client)||void 0===n?void 0:n.name)||"No name"," |",(null===(s=f.customer)||void 0===s?void 0:s.primaryPhone)||(null===(a=f.client)||void 0===a?void 0:a.phone)||" No phone"," |",(null===(i=f.customer)||void 0===i?void 0:i.primaryEmail)||(null===(l=f.client)||void 0===l?void 0:l.email)||" No email"]})]})}),(0,kt.jsx)("div",{children:(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,kt.jsx)("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide w-16",children:"PM:"}),(0,kt.jsxs)("span",{className:"text-sm text-gray-800 ml-2",children:[(null===(d=f.projectManager)||void 0===d?void 0:d.name)||(null!==(u=f.projectManager)&&void 0!==u&&u.firstName&&null!==(h=f.projectManager)&&void 0!==h&&h.lastName?"".concat(f.projectManager.firstName," ").concat(f.projectManager.lastName):"No PM assigned")," |",(null===(m=f.projectManager)||void 0===m?void 0:m.phone)||" No phone"," |",(null===(p=f.projectManager)||void 0===p?void 0:p.email)||" No email"]})]})})]}),document.body),w&&E&&c.createPortal((0,kt.jsxs)("div",{style:E,className:"bg-white border border-gray-300 rounded-lg shadow-lg max-h-[60vh] overflow-y-auto",children:[(0,kt.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,kt.jsx)("input",{type:"text",placeholder:"Search by project number (#12345) or customer name...",value:k,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})}),(0,kt.jsxs)("div",{className:"py-1",children:[(0,kt.jsxs)("div",{onClick:()=>D(null),className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-200 bg-gray-50",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm bg-blue-500 text-white",title:"General Chat - No Project Context",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,kt.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"No Project Selected"}),(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:"Chat about general topics, company info, or workflows"})]})]}),0===F.length?(0,kt.jsx)("div",{className:"px-4 py-2 text-gray-500 text-sm",children:"No projects found"}):F.map(e=>{var t;return(0,kt.jsxs)("div",{onClick:()=>D(e),className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",style:{backgroundColor:O(e).color,color:L(O(e).color)},title:"Phase: ".concat(O(e).name),children:O(e).initial}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:["#",String(e.projectNumber||e.id).padStart(5,"0")]}),(0,kt.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-900 truncate",children:e.projectName||e.name}),(0,kt.jsx)("span",{className:"text-xs text-gray-500 truncate",children:e.customerName||(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,kt.jsx)("div",{onClick:t=>{t.stopPropagation(),M(e,"Project Workflow")},title:"Go to Project Workflow",className:"p-1 hover:bg-blue-100 rounded",children:R("workflow")}),(0,kt.jsx)("div",{onClick:t=>{t.stopPropagation(),M(e,"Alerts")},title:"Go to Project Alerts",className:"p-1 hover:bg-red-100 rounded",children:R("alerts")}),(0,kt.jsx)("div",{onClick:t=>{t.stopPropagation(),M(e,"Messages")},title:"Go to Project Profile",className:"p-1 hover:bg-green-100 rounded",children:R("messages")})]})]},e.id)})]})]}),document.body)]})};function Yd(e){let{projectId:t=null,onTranscriptSelect:r,onClose:n}=e;const[s,a]=(0,o.useState)(!1),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)([]),[u,h]=(0,o.useState)(0),[m,p]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=!1;return async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a(!0),l("");try{var s,o;const a=new URLSearchParams;t&&a.set("projectId",t),a.set("limit","25"),a.set("offset",String(r));const i="".concat(Ds.API_BASE_URL,"/voice-transcripts").concat(a.toString()?"?".concat(a.toString()):""),l=sessionStorage.getItem("authToken")||localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345",u=await fetch(i,{headers:(0,Y.A)({Accept:"application/json"},l?{Authorization:"Bearer ".concat(l)}:{})});if(!u.ok){const e=401===u.status?"Login required to view transcripts.":"Failed to load transcript history";throw new Error(e)}const m=await u.json(),g=(null===m||void 0===m||null===(s=m.data)||void 0===s?void 0:s.transcripts)||[],f=(null===m||void 0===m||null===(o=m.data)||void 0===o?void 0:o.pagination)||{hasMore:!1},x=g.map(e=>{var t,r,n;const s=e.callDate?new Date(e.callDate):e.createdAt?new Date(e.createdAt):new Date,a=(null===(t=e.project)||void 0===t?void 0:t.projectName)||(null===(r=e.project)||void 0===r?void 0:r.name)||"",o=a?"".concat(a," \u2014 ").concat(s.toLocaleString()):"Call \u2014 ".concat(s.toLocaleString());return{id:e.id,title:o,date:s.toISOString(),preview:e.executiveSummary||Array.isArray(e.fullTranscript)&&(null===(n=e.fullTranscript[0])||void 0===n?void 0:n.message)||"",raw:e}});let v=n?[...c,...x]:x;if(0===v.length)try{const e=localStorage.getItem("voiceTranscripts");if(e){const t=JSON.parse(e);Array.isArray(t)&&t.length>0&&(v=t.map(e=>({id:e.id||e.sessionId||"local_".concat(e.date||Date.now()),title:e.title||"Call \u2014 ".concat(new Date(e.date||Date.now()).toLocaleString()),date:e.date||(new Date).toISOString(),preview:e.preview||"",raw:e.raw||e})))}}catch(Pr){}v.sort((e,t)=>new Date(t.date)-new Date(e.date)),e||(d(v),h(r+x.length),p(Boolean(f.hasMore)))}catch(It){try{let r=[];const n=localStorage.getItem("voiceTranscripts");if(n){const e=JSON.parse(n);Array.isArray(e)&&e.length>0&&(r=e.map(e=>({id:e.id||e.sessionId||"local_".concat(e.date||Date.now()),title:e.title||"Call \u2014 ".concat(new Date(e.date||Date.now()).toLocaleString()),date:e.date||(new Date).toISOString(),preview:e.preview||"",raw:e.raw||e})))}e||(r.length>0?(d(r),l(""),p(!1)):l((null===It||void 0===It?void 0:It.message)||"Failed to load transcript history"))}catch(Pr){e||l((null===It||void 0===It?void 0:It.message)||"Failed to load transcript history")}}finally{e||a(!1)}}(0,!1),()=>{e=!0}},[t]);const x=c.reduce((e,t)=>{const r=(e=>{const t=new Date,r=new Date(e),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s=new Date(n);s.setDate(n.getDate()-1);const a=new Date(n);return a.setDate(n.getDate()-6),r>=n?"Today":r>=s&&r<n?"Yesterday":r>=a?"Last 7 Days":r.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})})(t.date);return e[r]||(e[r]=[]),e[r].push(t),e},{}),v=Object.entries(x).map(e=>{let[t,r]=e;return{label:t,arr:r.sort((e,t)=>new Date(t.date)-new Date(e.date)),newest:Math.max(...r.map(e=>new Date(e.date).getTime()))}}).sort((e,t)=>t.newest-e.newest);return(0,kt.jsxs)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center px-4",children:[(0,kt.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:n}),(0,kt.jsxs)("div",{className:"relative z-[61] w-full max-w-lg rounded-xl shadow-2xl border bg-white",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold",children:"Transcript History"}),(0,kt.jsx)("div",{className:"text-xs text-gray-500",children:t?"Project: ".concat(t):"All Projects"})]}),(0,kt.jsx)("button",{onClick:n,className:"p-2 rounded hover:bg-gray-100",title:"Close",children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:[s&&(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:"Loading\u2026"}),i&&(0,kt.jsx)("div",{className:"text-sm text-red-600",children:i}),!s&&!i&&0===c.length&&(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:"No transcripts found."}),!s&&!i&&c.length>0&&(0,kt.jsx)("div",{className:"space-y-4",children:v.map(e=>(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-[11px] font-semibold text-gray-500 uppercase tracking-wider mb-2",children:e.label}),(0,kt.jsx)("div",{className:"space-y-2",children:e.arr.map(e=>(0,kt.jsxs)("button",{onClick:()=>r&&r(e.raw||e),className:"w-full text-left p-3 rounded-lg border hover:bg-gray-50",children:[(0,kt.jsx)("div",{className:"text-sm font-medium",children:e.title}),(0,kt.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleString()}),e.preview&&(0,kt.jsx)("div",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:e.preview})]},e.id))})]},e.label))})]}),(0,kt.jsxs)("div",{className:"px-4 py-3 border-t flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"text-xs text-gray-500",children:[c.length," loaded"]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[m&&(0,kt.jsx)("button",{onClick:async()=>{if(!g&&m){f(!0);try{const n=new URLSearchParams;t&&n.set("projectId",t),n.set("limit","25"),n.set("offset",String(u));const s="".concat(Ds.API_BASE_URL,"/voice-transcripts").concat(n.toString()?"?".concat(n.toString()):""),a=sessionStorage.getItem("authToken")||localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345",o=await fetch(s,{headers:(0,Y.A)({Accept:"application/json"},a?{Authorization:"Bearer ".concat(a)}:{})});if(o.ok){var e,r;const t=await o.json(),n=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.transcripts)||[],s=(null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r.pagination)||{hasMore:!1},a=n.map(e=>{var t,r,n;const s=e.callDate?new Date(e.callDate):e.createdAt?new Date(e.createdAt):new Date,a=(null===(t=e.project)||void 0===t?void 0:t.projectName)||(null===(r=e.project)||void 0===r?void 0:r.name)||"",o=a?"".concat(a," \u2014 ").concat(s.toLocaleString()):"Call \u2014 ".concat(s.toLocaleString());return{id:e.id,title:o,date:s.toISOString(),preview:e.executiveSummary||Array.isArray(e.fullTranscript)&&(null===(n=e.fullTranscript[0])||void 0===n?void 0:n.message)||"",raw:e}}),i=[...c,...a].sort((e,t)=>new Date(t.date)-new Date(e.date));d(i),h(u+a.length),p(Boolean(s.hasMore))}}catch(Pr){}finally{f(!1)}}},disabled:g,className:"px-3 py-1.5 rounded-md border text-sm ".concat(g?"opacity-60 cursor-not-allowed":"hover:bg-gray-50"),children:g?"Loading\u2026":"Load more"}),(0,kt.jsx)("button",{onClick:n,className:"px-3 py-1.5 rounded-md border text-sm hover:bg-gray-50",children:"Close"})]})]})]})]})}const Qd=(0,o.createContext)(),Xd=e=>{let{children:t}=e;const[r,n]=(0,o.useState)(null),[s,a]=(0,o.useState)(!1),[i,l]=(0,o.useState)(!0);(0,o.useEffect)(()=>{c()},[]);const c=async()=>{try{const e=localStorage.getItem("authToken")||localStorage.getItem("token");if(!e)return void l(!1);const t=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){const e=await t.json();n(e.user),a(!0)}else localStorage.removeItem("authToken"),localStorage.removeItem("token"),n(null),a(!1)}catch(e){console.error("Auth check failed:",e),n(null),a(!1)}finally{l(!1)}},d={user:r,isAuthenticated:s,isLoading:i,login:async e=>{try{const t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){const e=await t.json();return localStorage.setItem("authToken",e.token),n(e.user),a(!0),{success:!0}}return{success:!1,error:(await t.json()).message}}catch(t){return{success:!1,error:"Login failed"}}},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("token"),n(null),a(!1)},updateUser:e=>{n(t=>(0,Y.A)((0,Y.A)({},t),e))},checkAuthStatus:c};return(0,kt.jsx)(Qd.Provider,{value:d,children:t})},$d=()=>{const e=(0,o.useContext)(Qd);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e};var Zd=r(298);const eu=["permission","permissions","allPermissions","children","fallback","requireAuth","className"],tu=e=>{let{permission:t,permissions:r,allPermissions:n,children:s,fallback:a=null,requireAuth:o=!0,className:i=""}=e,l=Sn(e,eu);const{user:c,isAuthenticated:d}=$d();if(o&&!d)return a;if(null===c||void 0===c||!c.role)return a;let u=!1;return u=t?(0,Zd.hasPermission)(c.role,t):r&&Array.isArray(r)?(0,Zd.hasAnyPermission)(c.role,r):!n||!Array.isArray(n)||(0,Zd.hasAllPermissions)(c.role,n),u?(0,kt.jsx)("div",(0,Y.A)((0,Y.A)({className:i},l),{},{children:s})):a},ru=e=>{let{projects:t=[],colorMode:n=!1,onProjectSelect:s}=e;const a=Ct(),[i,l]=(0,o.useState)([]),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)([]),[g,f]=(0,o.useState)(!1),[x,v]=(0,o.useState)(null),[y,b]=(0,o.useState)(null),[w,j]=(0,o.useState)(!1),[N,S]=(0,o.useState)(0),[k,A]=(0,o.useState)(!1),[C,E]=(0,o.useState)(""),[P,I]=(0,o.useState)(null),T=(0,o.useRef)(null),D=(0,o.useRef)(null),M=(0,o.useRef)(null),_=(0,o.useRef)(null),O=(0,o.useRef)(null),L=(0,o.useRef)(null),R=(0,o.useRef)(null),F=(0,o.useRef)(null),U=(0,o.useRef)(!0),[B,W]=(0,o.useState)(!0),{subjects:z}=xi(),[V,H]=(0,o.useState)("Project Status Update"),[q,K]=(0,o.useState)([]),[G,J]=(0,o.useState)([]),[Q,X]=(0,o.useState)(!1),[$,Z]=(0,o.useState)([]),[ee,te]=(0,o.useState)(!1),[re,ne]=(0,o.useState)(""),[se,ae]=(0,o.useState)(!1),[oe,ie]=(0,o.useState)(null),[le,ce]=(0,o.useState)([]),[de,ue]=(0,o.useState)(""),[he,me]=(0,o.useState)([]),pe=(0,o.useRef)(null),[ge,fe]=(0,o.useState)(!1),[xe,ve]=(0,o.useState)(!1),[ye,be]=(0,o.useState)(!1),[we,je]=(0,o.useState)(0),Ne=e=>{if(null==e)return"";let t=String(e);return t=t.replace(/\xc3\u0192\xc6'\xc3\u201a\xc2\xa2|\xc3\xa2\xe2\u201a\xac\xc5\xa1\xc3\u201a\xc2\xac|\xc3\u201a\xc2\xa2/g,"\u2022"),t=t.replace(/\xc3\u0192\xc6'[^\s]*\|[^\s]*\|[^\s]*/g,""),t=t.replace(/\xc3\u0192\xe2\u20ac\u0161/g,""),t=t.replace(/\xc3\u0192\xc2\xb0/g,""),t=t.replace(/\xc3\u2026\xc2\xb8/g,""),t=t.replace(/\xc2\xa4/g,""),t=t.replace(/\xc5\xbd/g,""),t=t.replace(/\xc2\xa1/g,""),t=t.replace(/\xc3\u0192\xc2\xb0/g,""),t=t.replace(/\xc3\u2026\xc2\xb8/g,""),t=t.replace(/\xc3\u2026\xc2\xb8/g,""),t=t.replace(/[\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8\xc2\xa4\xc5\xbd\xc2\xa1]/g,""),t=t.replace(/[\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8\xc2\xa4\xc5\xbd\xc2\xa1]/g,""),t=t.replace(/[^\x20-\x7E\u00A0-\uFFFF]/g,""),t=t.replace(/\s{2,}/g," ").trim(),t},[Se,ke]=(0,o.useState)(""),[Ae,Ce]=(0,o.useState)(!1),[Ee,Pe]=(0,o.useState)([]),[Ie,Te]=(0,o.useState)(!1),[De,Me]=(0,o.useState)(""),[_e,Oe]=(0,o.useState)(!1),[Le,Re]=(0,o.useState)([]),[Fe,Ue]=(0,o.useState)(!1),[Be,We]=(0,o.useState)(""),[ze,Ve]=(0,o.useState)("");(0,o.useEffect)(()=>{try{const e=e=>e?e.firstName||e.lastName?[e.firstName,e.lastName].filter(Boolean).join(" ").trim():(e.name||e.fullName||e.email||"").trim():"";let t="";const r=localStorage.getItem("user")||localStorage.getItem("currentUser");if(r)try{t=e(JSON.parse(r))}catch(Pr){}if(!t){const r=sessionStorage.getItem("user")||sessionStorage.getItem("currentUser");if(r)try{t=e(JSON.parse(r))}catch(Pr){}}Ve(t)}catch(Pr){}},[]),(0,o.useEffect)(()=>{i.some(e=>e.requiresRecipientSelection)&&_e&&Oe(!1)},[i,_e]),(0,o.useEffect)(()=>{(async()=>{if(_e){Ue(!0);try{console.log("Fetching documents...");const e=[],t=[null],r=new Set;for(;t.length>0;){const n=t.shift(),s=n||"root";if(!r.has(s)){r.add(s);try{const r=await _s.A.list({parentId:n,limit:1e3});if(r&&r.assets&&Array.isArray(r.assets)){const n=r.assets.filter(e=>"FILE"===e.type);e.push(...n);r.assets.filter(e=>"FOLDER"===e.type).forEach(e=>t.push(e.id))}}catch(ES){console.error("Failed to fetch from folder ".concat(s,":"),ES)}}}console.log("Found documents:",e.length,e),Re(e)}catch(e){console.error("Failed to fetch documents:",e),Re([])}finally{Ue(!1)}}})()},[_e]);const[He,qe]=(0,o.useState)([]),[Ke,Ge]=(0,o.useState)([]),Je=(0,o.useRef)(null),Ye=(0,o.useRef)(null),Qe=(0,o.useRef)([]),Xe=(0,o.useRef)([]),[$e,Ze]=(0,o.useState)(!1),[et,tt]=(0,o.useState)(null),[rt,nt]=(0,o.useState)(["pdf","json"]),[st,at]=(0,o.useState)(!1),[ot,it]=(0,o.useState)(null),[lt,ct]=(0,o.useState)(!1),[dt,ut]=(0,o.useState)(null);(0,o.useEffect)(()=>{Qe.current=He},[He]),(0,o.useEffect)(()=>{Xe.current=Ee},[Ee]);const ht="bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4",mt="1ad2d156-7732-4f8b-97d3-41addce2d6a7",pt=e=>{if(!e)return"";const t=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=e=>e.replace(/\[(.*?)\]\((https?:\/\/[^)\s]+)\)/g,(e,r,n)=>'<a href="'.concat(t(n),'" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">').concat(t(r),"</a>")),n=String(e).replace(/\r\n?/g,"\n").split("\n"),s=[];let a=!1,o=!1,i=!1,l=!1;const c=()=>{a&&(s.push("</ul>"),a=!1),o&&(s.push("</ol>"),o=!1)};for(let p=0;p<n.length;p++){var d;let e=null!==(d=n[p])&&void 0!==d?d:"";const m=String(e).trim();if(/^```/.test(m)){i?(s.push("</code></pre>"),i=!1):(c(),i=!0,s.push('<pre class="bg-gray-50 border border-gray-200 rounded p-2 overflow-x-auto"><code>'));continue}if(i){s.push("".concat(t(e),"\n"));continue}if(""===m){c(),l=!1,s.push('<div class="h-2"></div>');continue}if(m.startsWith("#")){var u,h;c(),l=!1;const e=Math.min((null===(u=m.match(/^#+/))||void 0===u||null===(h=u[0])||void 0===h?void 0:h.length)||1,6),r=m.replace(/^#+\s*/,"");s.push("<h".concat(e,' class="font-semibold mb-2 mt-1">').concat(t(r),"</h").concat(e,">"));continue}if(/^.{1,120}:$/.test(m)){c(),l=!0;const e=m.slice(0,-1);s.push('<h3 class="font-semibold mb-1 mt-1">'.concat(t(e),"</h3>"));continue}if(/^([1-9]|[1-9][0-9])[\.)]\s+/.test(m)||/^([1-9]|[1-9][0-9])\s+-\s+/.test(m)){a&&(s.push("</ul>"),a=!1),o||(s.push('<ol class="list-decimal ml-5 mb-1 space-y-1">'),o=!0);const e=m.replace(/^([1-9]|[1-9][0-9])[\.)]\s+/,"").replace(/^([1-9]|[1-9][0-9])\s+-\s+/,"");s.push("<li>".concat(r(t(e)),"</li>")),l=!1;continue}if(/^[-*\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xc2\xa2\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xe2\u201a\xac\xc5\u201c\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xe2\u201a\xac\xc2\x9d]\s+/.test(m)){o&&(s.push("</ol>"),o=!1),a||(s.push('<ul class="list-disc ml-5 mb-1 space-y-1">'),a=!0);const e=m.replace(/^[-*\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xc2\xa2\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xe2\u201a\xac\xc5\u201c\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xe2\u201a\xac\xc2\x9d]\s+/,"");s.push("<li>".concat(r(t(e)),"</li>")),l=!1;continue}if(l){a||(s.push('<ul class="list-disc ml-5 mb-1 space-y-1">'),a=!0),s.push("<li>".concat(r(t(m)),"</li>"));continue}if(/^(Phase|Section|Line Item|Status|Progress|Customer|Project):/i.test(m)){c(),l=!1;const n=e.indexOf(":"),a=e.slice(0,n).trim(),o=e.slice(n+1).trim();s.push('<div class="mb-2 p-2 bg-gray-50 rounded border-l-4 border-blue-400"><strong class="text-blue-700">'.concat(t(a),':</strong> <span class="text-gray-800">').concat(r(t(o)),"</span></div>"));continue}let g=t(e).replace(/\*\*\*([^*]+)\*\*\*/g,"<em><strong>$1</strong></em>").replace(/___([^_]+)___/g,"<em><strong>$1</strong></em>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/__([^_]+)__/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/_([^_]+)_/g,"<em>$1</em>");g=r(g),c(),l=!1,s.push('<p class="mb-1 leading-relaxed">'.concat(g,"</p>"))}a&&s.push("</ul>"),o&&s.push("</ol>"),i&&s.push("</code></pre>");let m=s.join("");return m=m.replace(/\s?`{1,3}\s?/g," ").replace(/\s?\*{2,}\s?/g," ").replace(/\s?_{2,}\s?/g," ").replace(/\s?#{2,}\s?/g," ").replace(/\/{3,}/g," ").replace(/\]\s*\//g," ").replace(/(^|\s)[\[\]](?=\s|$)/g," ").replace(/\s{2,}/g," ").trim(),m},gt=e=>{try{const t=String(e||"").trim(),r=t.toLowerCase();return t?["assistant","ai","aiaassistant","bubbles","bubble"].includes(r)||r.includes("assistant")||r.includes("bubbles")?"Bubbles":["user","you","client","customer"].includes(r)?ze||"You":(t.indexOf(" ")>=0||/^[A-Z][a-z]+\s[A-Z]/.test(t),t):ze||"You"}catch(Pr){return ze||"You"}};(0,o.useEffect)(()=>{try{if(!y&&Array.isArray(t)&&t.length>0){const e=sessionStorage.getItem("aiAssistant.lastProjectId");if("null"===e)b(null);else if(e){const r=t.find(t=>String(t.id)===String(e));r&&b(r)}}}catch(Pr){}},[t]),(0,o.useEffect)(()=>{try{null!==y&&void 0!==y&&y.id?sessionStorage.setItem("aiAssistant.lastProjectId",String(y.id)):null===y&&sessionStorage.setItem("aiAssistant.lastProjectId","null")}catch(Pr){}},[y,N]),(0,o.useEffect)(()=>{if(1===t.length&&!y){try{if("null"===sessionStorage.getItem("aiAssistant.lastProjectId"))return}catch(Pr){}b(t[0])}},[t,y]),(0,o.useEffect)(()=>{try{window.scrollTo(0,0),D.current&&(D.current.scrollTop=0)}catch(Pr){}},[]),(0,o.useLayoutEffect)(()=>{try{window.scrollTo(0,0);const e=document.documentElement,t=document.body;e.classList.add("no-page-scroll"),t.classList.add("no-page-scroll");const r={html:{overflowY:e.style.overflowY,overflowX:e.style.overflowX,height:e.style.height},body:{position:t.style.position,top:t.style.top,right:t.style.right,bottom:t.style.bottom,left:t.style.left,width:t.style.width,height:t.style.height,overflowY:t.style.overflowY,overflowX:t.style.overflowX}};return e.style.overflowY="hidden",e.style.overflowX="hidden",e.style.height="100%",t.style.position="fixed",t.style.top="0",t.style.right="0",t.style.bottom="0",t.style.left="0",t.style.width="100%",t.style.height="100vh",t.style.overflowY="hidden",t.style.overflowX="hidden",()=>{try{e.classList.remove("no-page-scroll"),t.classList.remove("no-page-scroll"),e.style.overflowY=r.html.overflowY,e.style.overflowX=r.html.overflowX,e.style.height=r.html.height,t.style.position=r.body.position,t.style.top=r.body.top,t.style.right=r.body.right,t.style.bottom=r.body.bottom,t.style.left=r.body.left,t.style.width=r.body.width,t.style.height=r.body.height,t.style.overflowY=r.body.overflowY,t.style.overflowX=r.body.overflowX}catch(Pr){}}}catch(Pr){}},[]),(0,o.useEffect)(()=>{const e=_.current;if(!e)return;const t=()=>{try{je(e.offsetHeight||0)}catch(Pr){}};t();let r=null;if("undefined"!==typeof ResizeObserver){r=new ResizeObserver(()=>t());try{r.observe(e)}catch(Pr){}}else window.addEventListener("resize",t);return()=>{if(r)try{r.disconnect()}catch(Pr){}else window.removeEventListener("resize",t)}},[]),(0,o.useEffect)(()=>{try{if(!Ie||!xe&&!ge)return;const e=F.current;if(!e||!U.current)return;"function"===typeof e.scrollTo?e.scrollTo({top:e.scrollHeight,behavior:"auto"}):e.scrollTop=e.scrollHeight}catch(Pr){}},[Ee,De,Ie,xe,ge,B]),(0,o.useEffect)(()=>{const e=F.current;if(!e)return;const t=()=>{const t=Math.abs(e.scrollHeight-e.clientHeight-e.scrollTop)<=16;U.current=t,W(t)};return e.addEventListener("scroll",t,{passive:!0}),t(),()=>{try{e.removeEventListener("scroll",t)}catch(Pr){}}},[Ie]),(0,o.useEffect)(()=>{let e=!1;return(async()=>{try{if(e)return;if(pe.current)return void console.log("[Vapi] Already initialized");if(!ht||"your-vapi-public-key"===ht)throw new Error("VAPI_PUBLIC_KEY not configured");const t=await(async()=>{try{if(window.Vapi&&"function"===typeof window.Vapi)return console.log("[Vapi] SDK already loaded from window"),window.Vapi;try{console.log("[Vapi] Attempting to load from npm package...");const{default:e}=await r.e(841).then(r.t.bind(r,841,23));if(e&&"function"===typeof e)return console.log("[Vapi] SDK loaded from npm package"),e}catch(e){console.log("[Vapi] npm package not available, falling back to CDN:",e.message)}console.log("[Vapi] Loading SDK from CDN...");const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/@vapi-ai/web@latest/dist/index.js",t.async=!0;const n=new Promise((e,r)=>{const n=setTimeout(()=>{r(new Error("Vapi SDK loading timeout"))},1e4);t.onload=()=>{clearTimeout(n),window.Vapi&&"function"===typeof window.Vapi?(console.log("[Vapi] SDK loaded successfully from CDN"),e(window.Vapi)):r(new Error("Vapi SDK loaded but constructor not available"))},t.onerror=()=>{clearTimeout(n),r(new Error("Failed to load Vapi SDK from CDN"))}}),s=document.querySelector('script[src*="@vapi-ai/web"]');return s&&s.remove(),document.head.appendChild(t),await n}catch(t){throw console.error("[Vapi] SDK loading failed:",t),t}})();if(e)return;console.log("[Vapi] Initializing with key:",ht.substring(0,8)+"..."),pe.current=new t(ht),console.log("[Vapi] initialized in AIAssistantPage"),Ce(!0),ke(""),pe.current.on("call-start",()=>{console.log("[Vapi] call started"),fe(!1),ve(!0),ke(""),Te(!0),qe([]),Ge([]),Qe.current=[],Xe.current=[],Je.current=new Date,Ye.current=null}),pe.current.on("call-end",async()=>{Ye.current=new Date,console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] Event triggered - DEBUGGING TRANSCRIPT MODAL"),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] voiceConversation length:",He.length),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] voiceTranscript:",Ee),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] showTranscriptModal before:",$e);const e=Array.isArray(Xe.current)?Xe.current:[];let t=Array.isArray(Qe.current)?Qe.current:[];0===He.length&&e.length>0&&(console.log("[Vapi] Using voiceTranscript as fallback"),t=e.map((e,t)=>({speaker:ze||"You",message:e,timestamp:new Date,confidence:"high"})),qe(t));const r=wt();if(console.log("[Vapi] DEBUG: generated summary:",r),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] conversationToUse.length:",t.length),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] voiceTranscript.length:",e.length),t.length>0||e.length>0){console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] SHOULD show transcript modal - entering try block");try{const e=await Nt(r||{},t);console.log("[Vapi] DEBUG: enhanced summary:",e),tt(e);try{var n,s,a,o;const l=await fetch("/api/voice-transcripts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({sessionId:"voice_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),projectId:(null===y||void 0===y?void 0:y.id)||null,summary:e,fullTranscript:t,metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(n=Je.current)||void 0===n?void 0:n.toLocaleTimeString())||"Unknown"," - ").concat((null===(s=Ye.current)||void 0===s?void 0:s.toLocaleTimeString())||"Unknown"),duration:(null===r||void 0===r?void 0:r.duration)||"Unknown",participantCount:t.length>0?new Set(t.map(e=>e.speaker)).size:1,startTime:null===(a=Je.current)||void 0===a?void 0:a.toISOString(),endTime:null===(o=Ye.current)||void 0===o?void 0:o.toISOString()}})});if(l.ok){const e=await l.json();if(e.success){console.log("[Vapi] Transcript saved to database:",e.data.transcript.id),ut(e.data.transcript.id);try{var i,c;const t="voiceTranscripts",r=JSON.parse(localStorage.getItem(t)||"[]"),n=e.data.transcript.callDate||e.data.transcript.createdAt||(new Date).toISOString(),s=(null!==(i=e.data.transcript.project)&&void 0!==i&&i.projectName?"".concat(e.data.transcript.project.projectName," \xc3\xa2\xe2\u201a\xac\xe2\u20ac\x9d "):"Call \xc3\xa2\xe2\u201a\xac\xe2\u20ac\x9d ")+new Date(n).toLocaleString(),a=e.data.transcript.executiveSummary||Array.isArray(e.data.transcript.fullTranscript)&&(null===(c=e.data.transcript.fullTranscript[0])||void 0===c?void 0:c.message)||"",o={id:e.data.transcript.id,date:new Date(n).toISOString(),title:s,preview:a,raw:e.data.transcript},l=[...r.filter(e=>e.id!==o.id),o].slice(-50);localStorage.setItem(t,JSON.stringify(l))}catch(Pr){}}}}catch(f){console.error("[Vapi] Error saving transcript:",f);try{var d,u;const r="voiceTranscripts",n=JSON.parse(localStorage.getItem(r)||"[]"),s=(new Date).toISOString(),a=(null!==y&&void 0!==y&&y.projectName||null!==y&&void 0!==y&&y.name?"".concat(y.projectName||y.name," \xc3\xa2\xe2\u201a\xac\xe2\u20ac\x9d "):"Call \xc3\xa2\xe2\u201a\xac\xe2\u20ac\x9d ")+new Date(s).toLocaleString(),o=(null===e||void 0===e?void 0:e.executiveSummary)||Array.isArray(t)&&(null===(d=t[0])||void 0===d?void 0:d.message)||"",i={id:"local_".concat(Date.now()),date:s,title:a,preview:o,raw:{id:void 0,callDate:s,duration:(null===e||void 0===e||null===(u=e.metadata)||void 0===u?void 0:u.duration)||"Unknown",executiveSummary:(null===e||void 0===e?void 0:e.executiveSummary)||"",fullTranscript:t||[],project:y?{projectName:y.projectName||y.name}:null}},l=[...n,i].slice(-50);localStorage.setItem(r,JSON.stringify(l))}catch(Pr){}}console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] SUCCESS - About to setShowTranscriptModal(true)"),Ze(!0),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] SUCCESS - Called setShowTranscriptModal(true)")}catch(x){var h,m;console.error("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] ERROR generating enhanced summary:",x),tt({metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(h=Je.current)||void 0===h?void 0:h.toLocaleTimeString())||"Unknown"," - ").concat((null===(m=Ye.current)||void 0===m?void 0:m.toLocaleTimeString())||"Unknown"),duration:(null===r||void 0===r?void 0:r.duration)||"Unknown",participantCount:1},executiveSummary:e.join(" ")||"Voice call ended.",keyDecisions:[],actionItems:[],materialsList:[],risks:[],fullTranscript:t}),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] FALLBACK - About to setShowTranscriptModal(true)"),Ze(!0),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] FALLBACK - Called setShowTranscriptModal(true)")}}else{var p,g;console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] No conversation data to show - FORCING MODAL ANYWAY FOR TESTING"),tt({metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(p=Je.current)||void 0===p?void 0:p.toLocaleTimeString())||"Unknown"," - ").concat((null===(g=Ye.current)||void 0===g?void 0:g.toLocaleTimeString())||"Unknown"),duration:"Unknown",participantCount:1},executiveSummary:"Call ended with no conversation data captured.",keyDecisions:[],actionItems:[],materialsList:[],risks:[],fullTranscript:[]}),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] FORCE - About to setShowTranscriptModal(true)"),Ze(!0),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] FORCE - Called setShowTranscriptModal(true)")}if(e.length>0){const t=e.join(" "),r={id:"voice_".concat(Date.now()),type:"user",content:"\xc5\xbd\xc2\xa4Voice: ".concat(t),timestamp:new Date,isVoiceMessage:!0};l(e=>[r,...e])}fe(!1),ve(!1),ke(""),Te(!1),Pe([]),Xe.current=[],Me("")}),pe.current.on("speech-start",()=>{console.log("[Vapi] speech started (user speaking)")}),pe.current.on("speech-end",()=>{console.log("[Vapi] speech ended (user stopped speaking)")}),pe.current.on("message",e=>{if(console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8|\xc2\xa1 [MESSAGE] type:",e.type,"message:",e),"transcript"===e.type){console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8|\xc2\xa1 [MESSAGE] Processing transcript message");const t=String(e.transcript||e.text||"").trim();if(console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8|\xc2\xa1 [MESSAGE] Transcript text:",t),t){Me(e=>e?t.startsWith(e)?Ne(t):e.startsWith(t)?e:Ne(t):Ne(t)),Pe(e=>{const r=e[e.length-1]||"";let n=e;n=t.startsWith(r)?e.slice(0,-1).concat(t):r&&r.startsWith(t)?e:[...e,t];const s=n.slice(-50);return console.log("[Vapi] Updated transcript (deduped):",s),Xe.current=s,s});const r="assistant"===e.role?"Bubbles":ze||"You";qe(e=>{const n=[...e,{speaker:r,message:t,timestamp:new Date,confidence:"high"}];return console.log("[Vapi] Updated conversation:",n),Qe.current=n,n})}}if("user-message"===e.type&&e.message){const t=String(e.message).trim();t&&qe(e=>{const r=[...e,{speaker:ze||"You",message:t,timestamp:new Date,confidence:"high"}];return Qe.current=r,r})}if("assistant-message"===e.type&&e.message){const t=String(e.message).trim();t&&qe(e=>{const r=[...e,{speaker:"Bubbles",message:t,timestamp:new Date,confidence:"high"}];return Qe.current=r,r})}if("function-call"===e.type&&e.functionCall){const t="Called function: ".concat(e.functionCall.name);console.log("[Vapi] Function called:",t),Ge(e=>[...e,t])}if("speech"===e.type&&e.speech){const t=String(e.speech).trim();t&&qe(e=>{const r=[...e,{speaker:"Bubbles",message:t,timestamp:new Date,confidence:"high"}];return Qe.current=r,r})}}),pe.current.on("error",e=>{console.error("[Vapi] error event:",e);const t=String((null===e||void 0===e?void 0:e.message)||e||"Voice connection error");ke(t),fe(!1),ve(!1)}),pe.current.on("volume-level",e=>{})}catch(It){console.error("[Vapi] Init error:",It),ke("Voice initialization failed: ".concat(It.message)),Ce(!1)}})().catch(t=>{console.error("[Vapi] Async init failed:",t),e||ke("Voice initialization failed")}),()=>{e=!0;try{pe.current&&"function"===typeof pe.current.stop&&pe.current.stop()}catch(It){console.error("[Vapi] Cleanup error:",It)}}},[ht]);(0,o.useEffect)(()=>{(async()=>{if(null!==y&&void 0!==y&&y.id)try{var e,t,r;const n=await Ds.bubblesService.getCurrentStep(y.id);I((null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.current)||(null===n||void 0===n||null===(t=n.data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.current)||null)}catch(n){console.error("Failed to load current workflow step:",n),I(null)}else I(null)})()},[null===y||void 0===y?void 0:y.id]),(0,o.useEffect)(()=>{(async()=>{if(ye||Q)try{var e,t;te(!0);const r=await Ds.usersService.getTeamMembers(),n=Array.isArray(null===r||void 0===r?void 0:r.data)?r.data:(null===r||void 0===r||null===(e=r.data)||void 0===e?void 0:e.teamMembers)||(null===r||void 0===r||null===(t=r.data)||void 0===t?void 0:t.users)||[];Z(Array.isArray(n)?n:[])}catch(Pr){Z([])}finally{te(!1)}})()},[ye,Q]),(0,o.useEffect)(()=>{J([]),X(!1)},[null===y||void 0===y?void 0:y.id]);const ft=()=>{const e=de.trim();e&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&(me(t=>[...t,e]),ue(""))},xt=async()=>{if(oe&&(0!==le.length||0!==he.length)){h(!0);try{var e,t;await(async(e,t,n,s)=>{try{const{activitiesService:e}=await Promise.resolve().then(r.bind(r,505));JSON.parse(localStorage.getItem("user")||"{}"),s&&(console.log("\ud83d\udd04 Invalidating activities cache..."),s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["activities","recent",50]}),s.refetchQueries({queryKey:["activities","recent",50]}))}catch(a){throw console.error("Error creating system message:",a),a}})(0,0,0,a);const n=await Ds.bubblesService.completeAction(oe,le,he),s={id:Date.now(),type:"assistant",content:(null===(e=n.data)||void 0===e||null===(t=e.response)||void 0===t?void 0:t.content)||"Message sent successfully!",timestamp:new Date};l(e=>[s,...e]),ie(null),ce([]),me([]),ue(""),setTimeout(yt,0)}catch(n){const e={id:Date.now(),type:"assistant",content:"Failed to complete the action. Please try again.",timestamp:new Date,isError:!0};l(t=>[e,...t])}finally{h(!1)}}},vt=()=>{ie(null),ce([]),me([]),ue("");const e={id:Date.now(),type:"assistant",content:"Action cancelled. How else can I help you?",timestamp:new Date};l(t=>[e,...t])},yt=()=>{D.current&&(D.current.scrollTop=0)},bt=()=>"ai_assistant_chat_history_".concat((null===y||void 0===y?void 0:y.id)||"general");(0,o.useEffect)(()=>{(()=>{try{const e=localStorage.getItem(bt());if(e){const t=JSON.parse(e);p(t||[])}}catch(e){console.error("Failed to load chat history:",e),p([])}})()},[null===y||void 0===y?void 0:y.id]),(0,o.useEffect)(()=>{if(i.length>0&&!u){const e=setTimeout(()=>{(()=>{if(0!==i.length)try{var e;const t=i.filter(e=>"user"===e.type);if(0===t.length)return;const r=t[0],n=String(null!==(e=null===r||void 0===r?void 0:r.content)&&void 0!==e?e:""),s=n.slice(0,60)+(n.length>60?"...":""),a={id:x||"chat_".concat(Date.now()),messages:i.length>0?[...i]:[],title:s.length>0?s:"No title",timestamp:(new Date).toISOString(),projectId:(null===y||void 0===y?void 0:y.id)||null,projectName:(null===y||void 0===y?void 0:y.projectName)||(null===y||void 0===y?void 0:y.name)||null},o=localStorage.getItem(bt());let l=[];o&&(l=JSON.parse(o)),l=l.filter(e=>e.id!==a.id),l.unshift(a),l=l.slice(0,50),localStorage.setItem(bt(),JSON.stringify(l)),p(l),v(a.id)}catch(t){console.error("Failed to save chat:",t)}})()},1e3);return()=>clearTimeout(e)}},[i,u]);const wt=()=>{var e,t;if(0===He.length)return null;const r=Je.current&&Ye.current?Math.round((Ye.current-Je.current)/1e3):0;return{title:"Voice Conversation Summary",duration:"".concat(Math.floor(r/60),"m ").concat(r%60,"s"),startTime:(null===(e=Je.current)||void 0===e?void 0:e.toLocaleTimeString())||"Unknown",endTime:(null===(t=Ye.current)||void 0===t?void 0:t.toLocaleTimeString())||"Unknown",exchanges:He.map(e=>({speaker:e.speaker,message:e.message,timestamp:e.timestamp})),actions:Ke.length>0?Ke:["No specific actions were taken during this conversation"],keyPoints:jt(He),projectContext:y?{id:y.id,name:y.projectName||y.name}:null}},jt=e=>{const t=[],r=e.filter(e=>"user"===e.speaker&&e.message.includes("?")).map(e=>"Question: ".concat(e.message)),n=e.filter(e=>e.message.toLowerCase().includes("task")||e.message.toLowerCase().includes("issue")||e.message.toLowerCase().includes("problem")).map(e=>"".concat("user"===e.speaker?"User mentioned":"AI addressed",": ").concat(e.message.slice(0,100),"..."));return t.push(...r.slice(0,3)),t.push(...n.slice(0,2)),0===t.length&&t.push("General conversation about project status"),t},Nt=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var r,n,s;const c=y?{name:y.projectName||y.name,number:y.projectNumber,address:y.address||(null===(r=y.customer)||void 0===r?void 0:r.address)}:null,d=t||He;try{var a,o;const t=await fetch("/api/transcripts/enhance",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({fullTranscript:d.map(e=>({timestamp:e.timestamp||new Date,speaker:e.speaker||"User",message:e.message,confidence:e.confidence||"high"})),metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(a=Je.current)||void 0===a?void 0:a.toLocaleTimeString())||"Unknown"," - ").concat((null===(o=Ye.current)||void 0===o?void 0:o.toLocaleTimeString())||"Unknown"),duration:(null===e||void 0===e?void 0:e.duration)||"Unknown",participantCount:d.length>0?new Set(d.map(e=>e.speaker)).size:1},projectInfo:c})});if(t.ok){var i;const e=await t.json();if(e.success&&null!==(i=e.data)&&void 0!==i&&i.summary)return console.log("[Vapi] Successfully generated GPT-4o enhanced summary"),e.data.transcriptId&&ut(e.data.transcriptId),e.data.summary}}catch(l){console.error("[Vapi] Error getting AI-enhanced summary:",l)}console.log("[Vapi] Using fallback local extraction");const u={metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(n=Je.current)||void 0===n?void 0:n.toLocaleTimeString())||"Unknown"," - ").concat((null===(s=Ye.current)||void 0===s?void 0:s.toLocaleTimeString())||"Unknown"),duration:(null===e||void 0===e?void 0:e.duration)||"Unknown",project:c,participantCount:d.length>0?new Set(d.map(e=>e.speaker)).size:1},executiveSummary:await St(d),keyDecisions:At(d),actionItems:Et(d),materialsList:Pt(d),risks:Tt(d),fullTranscript:d.map(e=>({timestamp:e.timestamp||new Date,speaker:e.speaker||"User",message:e.message,confidence:e.confidence||"high"})),actions:Ke};return u}catch(c){return console.error("Error generating enhanced summary:",c),null}},St=async e=>{if(!e||0===e.length)return"No conversation recorded.";const t=e.map(e=>e.message).join(" ");return t.length>200?"Discussion covered project status, materials, and timeline. Key topics included: ".concat(t.substring(0,200),"..."):t},At=e=>{const t=[];return e.forEach(e=>{const r=e.message.toLowerCase();(r.includes("approved")||r.includes("decided")||r.includes("agreed"))&&t.push({decision:e.message,timestamp:e.timestamp||new Date,speaker:e.speaker})}),t},Et=e=>{const t=[];return e.forEach(e=>{const r=e.message.toLowerCase();(r.includes("need to")||r.includes("will")||r.includes("schedule")||r.includes("order"))&&t.push({action:e.message,assignee:"User"===e.speaker?"Customer":"Team",dueDate:null,priority:"medium"})}),t},Pt=e=>{const t=[];return e.forEach(e=>{const r=e.message.toLowerCase();["shingles","lumber","nails","tar","flashing","gutters","materials"].forEach(n=>{r.includes(n)&&t.push({material:n,mentioned:e.message,timestamp:e.timestamp||new Date})})}),t},Tt=e=>{const t=[];return e.forEach(e=>{const r=e.message.toLowerCase();(r.includes("problem")||r.includes("issue")||r.includes("concern")||r.includes("delay"))&&t.push({risk:e.message,severity:"medium",timestamp:e.timestamp||new Date,status:"open"})}),t},Dt=(e,t,r)=>{const n=new Blob([r],{type:t}),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)},Mt=()=>{const e=(new Date).toISOString().split("T")[0];if(rt.includes("json")&&Dt("transcript_"+e+".json","application/json",JSON.stringify(et,null,2)),rt.includes("txt")||rt.includes("pdf")||rt.includes("docx")){var t,r;const n=[];n.push("Voice Call Transcript & Summary"),n.push("Date: "+((null===et||void 0===et||null===(t=et.metadata)||void 0===t?void 0:t.callDate)||"")),n.push("Duration: "+((null===et||void 0===et||null===(r=et.metadata)||void 0===r?void 0:r.duration)||"")),n.push(""),n.push("Executive Summary:"),n.push(String((null===et||void 0===et?void 0:et.executiveSummary)||"")),n.push(""),n.push("Full Transcript:"),((null===et||void 0===et?void 0:et.fullTranscript)||[]).forEach(e=>{const t=new Date(e.timestamp).toLocaleTimeString(),r=gt(e.speaker);n.push("["+t+"] "+r+": "+e.message)}),Dt("transcript_"+e+".txt","text/plain",n.join("\n"))}},_t=()=>{Ze(!1),tt(null),it(null),nt(["pdf","json"])},Ot=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&e.preventDefault();const r=t||c;if(!r.trim())return;const n={id:Date.now(),type:"user",content:r,timestamp:new Date};l(e=>[n,...e]),setTimeout(yt,0),d(""),h(!0);try{var s,a;const e={};G.length>0&&(e.selectedRecipientIds=G);const t=await Ds.bubblesService.chat(r,null===y||void 0===y?void 0:y.id,e);if(null!==(s=t.data)&&void 0!==s&&null!==(a=s.response)&&void 0!==a&&a.requiresRecipientSelection){const e={id:Date.now()+1,type:"assistant",content:t.data.response.content,timestamp:new Date,requiresRecipientSelection:!0,availableRecipients:t.data.response.availableRecipients||[],pendingAction:t.data.response.pendingAction};ie(t.data.response.pendingAction),Z(t.data.response.availableRecipients||[]),ce([]),Oe(!1),l(t=>{const[r,...n]=t;return[r,e,...n]}),setTimeout(yt,0)}else{var o,i,u,m;const e={id:Date.now()+1,type:"assistant",content:(null===(o=t.data)||void 0===o||null===(i=o.response)||void 0===i?void 0:i.content)||"I processed your request.",timestamp:new Date,suggestedActions:(null===(u=t.data)||void 0===u||null===(m=u.response)||void 0===m?void 0:m.suggestedActions)||[]};l(t=>{const[r,...n]=t;return[r,e,...n]}),setTimeout(yt,0)}}catch(p){const e={id:Date.now()+1,type:"assistant",content:"I'm having trouble connecting to my systems right now. Please try again in a moment.",timestamp:new Date,isError:!0};l(t=>{const[r,...n]=t;return[r,e,...n]})}finally{h(!1)}},Lt=e=>{var t;let{message:r}=e;const n="assistant"===r.type,s=r.isError,a=(r.isContextMessage,r.isVoiceMessage);return(0,kt.jsx)("div",{className:"w-full",children:(0,kt.jsxs)("div",{className:"rounded-xl px-4 py-3 border ".concat(a?"bg-blue-50 border-blue-200 text-blue-900":n?s?"bg-red-50 border-red-200 text-red-800":"bg-[#f7f7f8] border-gray-200 text-gray-900":"bg-white border-gray-200 text-gray-900"),children:[(0,kt.jsx)("div",{className:"prose prose-sm max-w-none",style:{fontSize:"10px",lineHeight:"14px"},dangerouslySetInnerHTML:{__html:pt(n?r.content:String(null!==(t=r.content)&&void 0!==t?t:""))}}),r.requiresRecipientSelection&&r.availableRecipients&&(0,kt.jsxs)("div",{className:"mt-4 p-3 bg-white border border-blue-300 rounded-lg",children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Select Recipients:"}),(0,kt.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-1 mb-3",children:r.availableRecipients.map(e=>(0,kt.jsxs)("label",{className:"flex items-center gap-2 text-sm py-1 px-2 hover:bg-blue-50 rounded cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:le.includes(e.id),onChange:()=>{var t;(t=e.id)&&ce(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"rounded border-gray-300"}),(0,kt.jsx)("span",{className:"text-gray-800",children:e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.email||e.id}),e.role&&(0,kt.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.role,")"]})]},e.id))}),("send_document_email"===(null===oe||void 0===oe?void 0:oe.type)||"send_email"===(null===oe||void 0===oe?void 0:oe.type))&&(0,kt.jsxs)("div",{className:"mb-3 border-t pt-3",children:[(0,kt.jsx)("h5",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Or add custom email address:"}),(0,kt.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,kt.jsx)("input",{type:"email",value:de,onChange:e=>{e.stopPropagation(),ue(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),ft())},onFocus:e=>e.stopPropagation(),placeholder:"email@example.com",className:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),ft()},type:"button",className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"Add"})]}),he.length>0&&(0,kt.jsx)("div",{className:"flex flex-wrap gap-2",children:he.map((e,t)=>(0,kt.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-md",children:[e,(0,kt.jsx)("button",{onClick:()=>(e=>{me(t=>t.filter(t=>t!==e))})(e),className:"text-blue-600 hover:text-blue-800",children:"\xd7"})]},t))})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsxs)("button",{onClick:xt,disabled:0===le.length&&0===he.length,className:"px-4 py-2 text-sm rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:["Send to ",le.length+he.length," recipient",le.length+he.length!==1?"s":""]}),(0,kt.jsx)("button",{onClick:vt,className:"px-4 py-2 text-sm rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 transition-colors",children:"Cancel"})]})]}),r.suggestedActions&&r.suggestedActions.length>0&&(0,kt.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:r.suggestedActions.map((e,t)=>(0,kt.jsx)("button",{onClick:()=>Ot(null,e.label||e.action),className:"px-3 py-1 text-xs rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 transition-colors",children:e.label||e.action},t))}),(0,kt.jsx)("div",{className:"text-xs mt-2 text-gray-400",children:r.timestamp instanceof Date?r.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(r.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})};return(0,kt.jsxs)("div",{ref:R,className:"ai-assistant-container min-h-0 flex flex-col bg-white rounded-lg shadow-sm overflow-hidden relative",style:{height:"100vh"},children:[(0,kt.jsx)("style",{children:'\n                .ai-assistant-container {\n                    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";\n                }\n                .prose strong {\n                    font-weight: 600;\n                    color: #1f2937;\n                }\n                .prose li {\n                    margin-bottom: 0.25rem;\n                    padding-left: 0.5rem;\n                }\n                .prose p {\n                    margin-bottom: 0.5rem;\n                    line-height: 1.6;\n                }\n                .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {\n                    margin-top: 1rem;\n                    margin-bottom: 0.75rem;\n                    font-weight: 600;\n                    color: #1f2937;\n                }\n            '}),(0,kt.jsx)("div",{ref:M,className:"flex-shrink-0 p-3 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 relative",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,kt.jsx)("div",{className:"flex-1 max-w-2xl relative",children:(0,kt.jsx)(Jd,{projects:t,selectedProject:y,onProjectSelect:e=>{console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\x8d AIAssistantPage: onProjectSelect called with:",e),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\x8d AIAssistantPage: Current selectedProject before:",y),b(e),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\x8d AIAssistantPage: setSelectedProject called with:",e),S(e=>e+1),A(!1),E("")},onProjectNavigate:async(e,t)=>{try{if(!e||!s)return;if("Project Workflow"===t){try{console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Navigating to workflow for project:",e.projectName||e.name);const t=e.currentWorkflowItem||{},r=t.phase||"LEAD",n=t.section||"Unknown Section",a=t.lineItem||"Unknown Item";console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Current workflow state:",{phase:r,section:n,lineItem:a});const o=e.id||e._id,i=await fetch("/api/workflow-data/project-position/".concat(o),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(i.ok){const t=await i.json();if(t.success&&t.data){const o=t.data;console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Project position data:",o);const i=o.currentLineItemId||o.currentLineItem||"".concat(r,"-").concat(n,"-0"),l=o.currentSectionId||o.currentSection||n.toLowerCase().replace(/\s+/g,"-");console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Target IDs:",{targetLineItemId:i,targetSectionId:l});const c=(0,Y.A)((0,Y.A)({},e),{},{highlightStep:a,highlightLineItem:a,targetPhase:r,targetSection:n,targetLineItem:a,scrollToCurrentLineItem:!0,navigationTarget:{phase:r,section:n,lineItem:a,stepName:a,lineItemId:i,workflowId:o.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(i),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:l,expandPhase:!0,expandSection:!0}});return void s(c,"Project Workflow",null,"AI Assistant",i,l)}}console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Could not get position data, using fallback navigation")}catch(r){console.error("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Error enhancing workflow navigation:",r)}s(e,"Project Workflow",null,"AI Assistant")}else s(e,"Alerts"===t?"Alerts":"Messages"===t?"Project Messages":"Project Profile",null,"AI Assistant")}catch(r){console.error("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Error in project navigation:",r),s(e,t||"Project Profile",null,"AI Assistant")}},colorMode:n,placeholder:"Select Project"})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(tu,{permission:Zd.PERMISSIONS.DOCUMENTS_DOWNLOAD,children:(0,kt.jsxs)("button",{onClick:()=>Oe(!_e),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-md ".concat(_e?"bg-[#6BC22E] text-white hover:bg-[#5AB01D]":"bg-[#7ED242] text-white hover:bg-[#6BC22E]"),title:"Show available documents",children:[(0,kt.jsx)(hn,{className:"w-4 h-4"}),(0,kt.jsx)("span",{className:"hidden md:inline",children:"Documents"})]})}),(0,kt.jsx)(tu,{permission:Zd.PERMISSIONS.AI_BUBBLES,children:(0,kt.jsxs)("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-white transition-all shadow-md bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700",title:"Bubbles Assistant Playbook",children:[(0,kt.jsx)(Yr,{className:"w-4 h-4"}),(0,kt.jsx)("span",{className:"hidden md:inline",children:"Assistant Playbook"}),(0,kt.jsx)("span",{className:"md:hidden",children:"Playbook"})]})}),(0,kt.jsxs)("button",{onClick:()=>{l([]),v(null)},className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors",title:"Clear the current chat",children:[(0,kt.jsx)(yn,{className:"w-3.5 h-3.5"}),"Clear Chat"]})]})]})}),(0,kt.jsx)("div",{ref:_,className:"flex-shrink-0 p-1 px-3 md:px-4 border-b border-gray-200 bg-gray-50",children:(0,kt.jsxs)("form",{onSubmit:Ot,className:"w-full max-w-2xl flex items-center gap-1",children:[(0,kt.jsx)("input",{ref:O,type:"text",value:c,onChange:e=>d(e.target.value),placeholder:y?"Ask about ".concat(y.projectName||y.name,"..."):"Send a message...",className:"flex-1 px-3 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm"}),(0,kt.jsx)("button",{type:"submit",disabled:u||!c.trim(),className:"px-3 py-1 rounded-lg flex items-center justify-center gap-2 font-semibold transition-all shadow-sm ".concat(u||!c.trim()?"bg-gray-300 cursor-not-allowed text-gray-500":"bg-black hover:bg-gray-900 text-white"),children:u?(0,kt.jsx)("span",{className:"text-xs md:text-sm",children:"Processing..."}):(0,kt.jsx)("span",{className:"text-xs md:text-sm",children:"Send"})}),(0,kt.jsx)("button",{type:"button",onClick:async()=>{try{console.log("[Vapi] mic clicked")}catch(Pr){}ke("");const e=pe.current;if(e)if("function"===typeof e.start&&"function"===typeof e.stop)try{if(xe||ge)return console.log("[Vapi] Stopping call..."),void await e.stop();try{await navigator.mediaDevices.getUserMedia({audio:!0}),console.log("[Vapi] Microphone permission granted")}catch(t){return console.error("[Vapi] Microphone permission denied:",t),void ke("Microphone permission required for voice chat.")}fe(!0),ke("");const r={};null!==y&&void 0!==y&&y.id&&(r.variableValues={projectId:y.id,projectName:y.projectName||y.name||"Current Project"},console.log("[Vapi] Adding project context:",r)),console.log("[Vapi] Starting call with assistant ID:",mt),Object.keys(r).length>0?await e.start(mt,r):await e.start(mt)}catch(It){fe(!1),ve(!1);const t=String((null===It||void 0===It?void 0:It.message)||It||"Voice start failed");ke(t),console.error("[Vapi] start error:",It)}else ke("Voice SDK not properly loaded.");else ke("Voice not initialized. Please refresh the page.")},className:"ml-1 p-[6px] rounded-full border flex items-center justify-center transition ".concat(xe?"border-blue-600 bg-blue-50 shadow-glow":"border-gray-300 bg-white hover:bg-gray-100"),"aria-label":xe?"End voice with Bubbles":ge?"Connecting to Bubbles":"Speak to Bubbles",title:xe?"End voice":ge?"Connecting\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xc2\xa6":"Speak to Bubbles",children:ge?(0,kt.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"animate-spin","aria-hidden":"true",children:[(0,kt.jsx)("circle",{cx:"12",cy:"12",r:"9",stroke:"#93c5fd",strokeWidth:"3",opacity:"0.35"}),(0,kt.jsx)("path",{d:"M21 12a9 9 0 00-9-9",stroke:"#2563eb",strokeWidth:"3",strokeLinecap:"round"})]}):(0,kt.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",className:xe?"animate-pulse":"",children:[(0,kt.jsx)("path",{d:"M9 5a3 3 0 016 0v6a3 3 0 11-6 0V5z",fill:xe?"#2563eb":"#111827"}),(0,kt.jsx)("path",{d:"M5 12a7 7 0 0014 0M12 19v-3",stroke:xe?"#2563eb":"#111827",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,kt.jsx)("button",{type:"button",onClick:()=>ct(!0),className:"ml-1 p-[6px] rounded-full border border-gray-300 bg-white hover:bg-gray-100 flex items-center justify-center","aria-label":"View transcript history",title:"Transcript History",children:(0,kt.jsx)(Gr,{className:"w-[18px] h-[18px] text-gray-700"})}),(0,kt.jsx)("a",{href:"tel:+17243812859",className:"ml-1 p-[6px] rounded-full border border-gray-300 bg-white hover:bg-gray-100 flex items-center justify-center","aria-label":"Call +17243812859",title:"+17243812859",children:(0,kt.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,kt.jsx)("path",{d:"M2.5 6.75C2.5 5.78 3.28 5 4.25 5h2.2c.72 0 1.35.47 1.54 1.16l.8 2.82c.18.65-.07 1.35-.63 1.73l-1.24.85c1.14 2.1 2.95 3.92 5.05 5.05l.85-1.24c.38-.56 1.08-.81 1.73-.63l2.82.8c.69.2 1.16.82 1.16 1.54v2.2c0 .97-.78 1.75-1.75 1.75h-1.5C8.49 21.99 2 15.51 2 7.25v-1.5z",fill:"#111827"})})})]})}),g&&(0,kt.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-20 bg-white",children:(0,kt.jsxs)("div",{className:"flex flex-col h-full",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 p-4 border-b border-gray-200 bg-gray-50",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("button",{onClick:()=>f(!1),className:"p-2 rounded-lg hover:bg-gray-100 flex items-center gap-1",children:[(0,kt.jsx)(nn,{className:"w-4 h-4"}),(0,kt.jsx)("span",{children:"Back"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"font-bold text-lg",children:"Chat History"}),(0,kt.jsxs)("p",{className:"text-sm text-gray-600",children:[m.length," saved conversations"]})]})]}),(0,kt.jsx)("button",{onClick:()=>{l([]),v(null),f(!1)},className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-blue-500 hover:bg-[var(--color-primary-blueprint-blue)] text-white",children:"New Chat"})]})}),(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===m.length?(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[(0,kt.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,kt.jsx)(sn,{className:"w-8 h-8 text-gray-400"})}),(0,kt.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"No saved chats yet"}),(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Your conversations will appear here automatically"})]}):m.map(e=>{const t=x===e.id,r=new Date(e.timestamp),n=new Date,s=Math.floor((n-r)/864e5);let a;return a=0===s?"Today":1===s?"Yesterday":s<7?"".concat(s," days ago"):r.toLocaleDateString(),(0,kt.jsx)("div",{className:"group p-4 rounded-lg cursor-pointer transition-all border ".concat(t?"bg-blue-50 border-blue-200":"hover:bg-gray-50 border-gray-200"),onClick:()=>{l(e.messages),v(e.id),f(!1)},children:(0,kt.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("h4",{className:"font-medium text-sm truncate mb-1 text-gray-900",children:e.title}),(0,kt.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:a}),e.projectName&&(0,kt.jsxs)("p",{className:"text-xs text-gray-500 truncate inline-flex items-center gap-1",children:[(0,kt.jsx)(hn,{className:"w-4 h-4"})," ",e.projectName]})]}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),p(t=>t.filter(t=>t.id!==e.id)),x===e.id&&(l([]),v(null))},className:"p-1.5 rounded-md hover:bg-red-100 text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete chat",children:(0,kt.jsx)(yn,{className:"w-4 h-4"})})]})},e.id)})})]})}),Q&&(0,kt.jsxs)("div",{className:"w-full border-t border-b border-blue-200 bg-blue-50 px-4 py-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-blue-900",children:"Select recipients"}),(0,kt.jsx)("p",{className:"text-xs text-blue-700",children:"Chosen teammates will receive document shares initiated in this chat."})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>J([]),className:"text-xs px-2 py-1 rounded-md border border-blue-300 text-blue-700 hover:bg-blue-100",children:"Clear"}),(0,kt.jsx)("button",{onClick:()=>X(!1),className:"text-xs px-2 py-1 rounded-md border border-blue-300 text-blue-700 hover:bg-blue-100",children:"Close"})]})]}),(0,kt.jsx)("div",{className:"max-h-40 overflow-y-auto bg-white border border-blue-200 rounded-lg p-3 shadow-sm",children:ee?(0,kt.jsx)("div",{className:"text-sm text-blue-700",children:"Loading team members..."}):0===($||[]).length?(0,kt.jsx)("div",{className:"text-sm text-blue-700",children:"No team members available."}):$.map(e=>{const t=e.id||e.userId,r=e.firstName?"".concat(e.firstName," ").concat(e.lastName||"").trim():e.name||e.email||t;return(0,kt.jsxs)("label",{className:"flex items-center gap-2 text-sm py-1",children:[(0,kt.jsx)("input",{type:"checkbox",checked:G.includes(t),onChange:()=>{var e;(e=t)&&J(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])}}),(0,kt.jsx)("span",{children:r})]},t)})}),G.length>0&&(0,kt.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:G.map(e=>{const t=($||[]).find(t=>(t.id||t.userId)===e),r=t?t.firstName?"".concat(t.firstName," ").concat(t.lastName||"").trim():t.name||t.email||e:e;return(0,kt.jsx)("span",{className:"inline-flex items-center gap-1 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:r},e)})})]}),_e&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25 z-40",onClick:()=>Oe(!1)}),(0,kt.jsxs)("div",{className:"fixed top-4 right-4 w-80 max-h-[80vh] z-50 bg-white border border-gray-200 rounded-lg shadow-xl flex flex-col overflow-hidden",children:[(0,kt.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-white",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-800",children:"Available Documents"}),(0,kt.jsx)("button",{onClick:()=>Oe(!1),className:"p-1 hover:bg-gray-100 rounded",title:"Close",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsx)("input",{type:"text",placeholder:"Search documents...",value:Be,onChange:e=>We(e.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto p-3",children:Fe?(0,kt.jsx)("div",{className:"text-center py-8 text-gray-500 text-sm",children:(0,kt.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"}),"Loading documents..."]})}):0===Le.length?(0,kt.jsx)("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No documents found"}):(0,kt.jsx)("div",{className:"space-y-2",children:Le.filter(e=>{const t=e.filename||e.name||e.title||"";return!Be||t.toLowerCase().includes(Be.toLowerCase())}).map(e=>{const t=e.filename||e.name||e.title||"Untitled";return(0,kt.jsx)("div",{className:"p-3 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer group",onClick:()=>{const e=c+(c?" ":"")+'"'.concat(t,'"');d(e),setTimeout(()=>{if(O.current){O.current.focus();const t=e.length;O.current.setSelectionRange(t,t)}},0)},title:'Click to insert "'.concat(t,'" into message'),children:(0,kt.jsxs)("div",{className:"flex items-start gap-2",children:[(0,kt.jsx)(Gr,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate group-hover:text-blue-600",children:t}),e.fileSize&&(0,kt.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[(e.fileSize/1024).toFixed(0)," KB"]})]})]})},e.id)})})})]})]}),(0,kt.jsx)("div",{className:"messages-container flex-1 min-h-0 overflow-hidden",children:(0,kt.jsx)("div",{ref:D,className:"w-full h-full overflow-y-auto custom-scrollbar px-3 md:px-4 py-2",children:(0,kt.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(xe||ge)&&(0,kt.jsx)("div",{className:"flex items-center gap-2 text-sm text-blue-700 bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,kt.jsxs)("span",{className:"inline-flex items-center gap-2 font-medium",children:[(0,kt.jsx)("span",{className:"w-2 h-2 rounded-full bg-[var(--color-primary-blueprint-blue)] animate-pulse"}),ge?"Connecting to voice...":"Listening - speak now"]})}),Ie&&(De||Ee.length>0)&&(0,kt.jsx)("div",{className:"w-full",children:(0,kt.jsxs)("div",{className:"rounded-xl px-4 py-3 border bg-blue-50 border-blue-200 text-blue-800",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-[var(--color-primary-blueprint-blue)] rounded-full animate-pulse"}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:"Live Transcription"})]}),(0,kt.jsx)("div",{ref:F,className:"text-sm leading-relaxed bg-white/50 px-3 py-2 rounded font-sans overflow-y-auto overflow-x-hidden h-44 md:h-56",style:{wordBreak:"normal",overflowWrap:"break-word",whiteSpace:"normal",textAlign:"left",maxWidth:"100%",width:"100%"},role:"log","aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text",children:(()=>{const e=Array.isArray(Ee)?Ee:[],t=e=>Ne(String(e||"")).trim(),r=[];for(let l=0;l<e.length;l++){const n=t(e[l]);n&&(0!==r.length&&r[r.length-1]===n||r.push(n))}const n=r.slice(-200),s=t(De||""),a=n.length>0?n[n.length-1]:"",o=!!s&&s!==a,i=n.join(" ");return(0,kt.jsxs)("div",{className:"whitespace-pre-wrap break-words",children:[i,o&&(0,kt.jsxs)("span",{className:"opacity-80",children:[" ",s]})]})})()})]})}),i.filter(e=>!e.isContextMessage).map(e=>(0,kt.jsx)(Lt,{message:e},e.id)),u&&(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsx)("div",{className:"bg-[#f7f7f8] border border-gray-200 rounded-xl px-5 py-3",children:(0,kt.jsxs)("div",{className:"flex space-x-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,kt.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,kt.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),(0,kt.jsx)("div",{ref:T})]})})}),ye&&(0,kt.jsxs)("div",{ref:L,className:"p-4 border-t border-gray-200 bg-white",children:[(0,kt.jsxs)("div",{className:"mb-2 text-sm font-semibold flex items-center gap-2",children:[(0,kt.jsx)(sn,{className:"w-4 h-4"})," Send Project Message"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"text-xs block mb-1",children:"Subject"}),(0,kt.jsx)("select",{value:V,onChange:e=>H(e.target.value),className:"w-full text-sm rounded-md border px-2 py-2",children:(z||[]).map(e=>(0,kt.jsx)("option",{value:e,children:e},e))})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"text-xs block mb-1",children:"Recipients"}),(0,kt.jsxs)("div",{className:"max-h-24 overflow-auto rounded-md border p-2",children:[($||[]).map(e=>(0,kt.jsxs)("label",{className:"flex items-center gap-2 text-sm py-0.5",children:[(0,kt.jsx)("input",{type:"checkbox",checked:q.includes(e.id),onChange:()=>K(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])}),(0,kt.jsx)("span",{children:e.firstName?"".concat(e.firstName," ").concat(e.lastName||"").trim():e.name||e.email||e.id})]},e.id)),(!$||0===$.length)&&(0,kt.jsx)("div",{className:"text-xs opacity-70",children:"No team members listed."})]})]}),(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("label",{className:"text-xs block mb-1",children:"Message"}),(0,kt.jsx)("textarea",{value:re,onChange:e=>ne(e.target.value),rows:3,className:"w-full text-sm rounded-md border px-2 py-2 resize-none",placeholder:"Type your message..."})]}),(0,kt.jsxs)("div",{className:"md:col-span-2 flex items-center justify-end gap-2",children:[(0,kt.jsx)("button",{onClick:()=>be(!1),className:"text-xs px-3 py-2 rounded-md border",children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(null!==y&&void 0!==y&&y.id&&V&&re.trim()){ae(!0);try{await Ds.projectMessagesService.create(y.id,{content:re.trim(),subject:V,priority:"MEDIUM",recipients:q});try{Array.isArray(q)&&q.length>0&&await Promise.all(q.map(e=>mi.sendNotification({title:"New Project Message",message:V,type:"PROJECT_UPDATE",recipientId:e,actionData:{projectId:y.id}}).catch(()=>null)))}catch(Pr){}l(e=>[{id:"msg_".concat(Date.now()),type:"assistant",content:"Message sent in project: ".concat(V,"\n\n").concat(re.trim()),timestamp:new Date},...e]),ne(""),K([]),H((null===z||void 0===z?void 0:z[0])||"Project Status Update"),be(!1)}catch(It){l(e=>[{id:"msg_err_".concat(Date.now()),type:"error",content:"Failed to send message. Please try again.",timestamp:new Date},...e])}finally{ae(!1)}}},disabled:se||!re.trim(),className:"text-xs px-3 py-2 rounded-md text-white ".concat(se||!re.trim()?"bg-gray-400":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700"),children:(0,kt.jsx)("span",{className:"font-semibold text-sm md:text-base",children:se?"Sending...":"SEND"})})]})]})]}),console.log("[Transcript] render showTranscriptModal:",$e,"transcriptSummary:",!!et),$e&&et&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center pt-8",style:{zIndex:999999},children:(0,kt.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",style:{zIndex:999999},children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Voice Call Transcript & Summary"}),(0,kt.jsxs)("p",{className:"text-sm text-gray-600",children:[et.metadata.callDate," \xe2\u20ac\xa2 ",et.metadata.duration," \xe2\u20ac\xa2 ",et.metadata.participantCount," participant(s)"]})]})]}),(0,kt.jsx)("button",{onClick:_t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[et.metadata.project&&(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Project Information"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"font-medium",children:"Project:"})," ",et.metadata.project.name]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"font-medium",children:"Number:"})," #",et.metadata.project.number]}),et.metadata.project.address&&(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("span",{className:"font-medium",children:"Address:"})," ",et.metadata.project.address]})]})]}),(0,kt.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Executive Summary"}),(0,kt.jsx)("p",{className:"text-gray-800 leading-relaxed",children:et.executiveSummary})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[((null===et||void 0===et?void 0:et.keyDecisions)||[]).length>0&&(0,kt.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-green-900 mb-3",children:"Key Decisions & Approvals"}),(0,kt.jsx)("div",{className:"space-y-2",children:et.keyDecisions.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-green-200",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-800",children:e.decision}),(0,kt.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:[e.speaker," \xe2\u20ac\xa2 ",new Date(e.timestamp).toLocaleTimeString()]})]},t))})]}),((null===et||void 0===et?void 0:et.actionItems)||[]).length>0&&(0,kt.jsxs)("div",{className:"bg-orange-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-orange-900 mb-3",children:"Action Items"}),(0,kt.jsx)("div",{className:"space-y-2",children:et.actionItems.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-orange-200",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-800 font-medium",children:e.action}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-600",children:[(0,kt.jsxs)("span",{children:["Assignee: ",e.assignee]}),(0,kt.jsxs)("span",{className:"px-2 py-1 rounded ".concat("high"===e.priority?"bg-red-100 text-red-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[e.priority," priority"]})]})]},t))})]}),((null===et||void 0===et?void 0:et.materialsList)||[]).length>0&&(0,kt.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-purple-900 mb-3",children:"Materials Discussed"}),(0,kt.jsx)("div",{className:"space-y-2",children:et.materialsList.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-purple-200",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-800 font-medium",children:e.material}),(0,kt.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:['"',e.mentioned,'"']})]},t))})]}),((null===et||void 0===et?void 0:et.risks)||[]).length>0&&(0,kt.jsxs)("div",{className:"bg-red-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-red-900 mb-3",children:"Risks & Open Issues"}),(0,kt.jsx)("div",{className:"space-y-2",children:et.risks.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-red-200",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-800",children:e.risk}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,kt.jsxs)("span",{className:"px-2 py-1 rounded text-xs ".concat("high"===e.severity?"bg-red-100 text-red-800":"medium"===e.severity?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[e.severity," severity"]}),(0,kt.jsx)("span",{className:"text-xs text-gray-600",children:e.status})]})]},t))})]})]}),(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 relative",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Full Conversation Transcript"}),(0,kt.jsx)("button",{onClick:_t,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded hover:bg-gray-200",title:"Close transcript",children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:((null===et||void 0===et?void 0:et.fullTranscript)||[]).map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-gray-200",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:gt(e.speaker)}),(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleTimeString()}),"high"!==e.confidence&&(0,kt.jsxs)("span",{className:"text-xs px-2 py-1 bg-yellow-100 text-yellow-800 rounded",children:[e.confidence," confidence"]})]}),(0,kt.jsx)("p",{className:"text-sm text-gray-800",children:Ne(e.message)})]},t))})]})]}),(0,kt.jsx)("div",{className:"border-t border-gray-200 p-6",children:(0,kt.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Select file formats:"}),(0,kt.jsx)("div",{className:"flex flex-wrap gap-2",children:[{id:"pdf",label:"PDF (Branded)"},{id:"json",label:"JSON (Structured)"},{id:"docx",label:"Word Document"},{id:"txt",label:"Plain Text"}].map(e=>(0,kt.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:rt.includes(e.id),onChange:()=>(e=>{nt(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,kt.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.id))})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("button",{onClick:_t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Close"}),(0,kt.jsx)("button",{onClick:async()=>{if(et&&0!==rt.length){at(!0);try{const e=await fetch("/api/transcripts/generate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({summary:et,formats:rt,projectId:null===y||void 0===y?void 0:y.id,sessionId:"voice_".concat(Date.now()),useAI:!0})});if(e.ok){const t=await e.json();t.success&&t.data.downloadLinks?(it(t.data.downloadLinks),Object.entries(t.data.downloadLinks).forEach(e=>{let[t,r]=e;const n=document.createElement("a");n.href=r,n.download="transcript_".concat((new Date).toISOString().split("T")[0],".").concat(t),document.body.appendChild(n),n.click(),document.body.removeChild(n)})):Mt()}else Mt()}catch(e){console.error("Error generating transcript files:",e),Mt(),alert("Failed to generate transcript files. Please try again.")}finally{at(!1)}}},disabled:0===rt.length||st,className:"px-6 py-2 text-sm font-medium text-white rounded-lg transition-colors ".concat(0===rt.length||st?"bg-gray-400 cursor-not-allowed":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700"),children:st?(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):"Download Selected (".concat(rt.length,")")})]})]})})]})}),lt&&(0,kt.jsx)(Yd,{projectId:null===y||void 0===y?void 0:y.id,onTranscriptSelect:e=>{try{var t,r;const n=null!==e&&void 0!==e&&e.date?new Date(e.date):new Date,s={metadata:{callDate:n.toLocaleDateString(),callTime:n.toLocaleTimeString(),duration:(null===e||void 0===e?void 0:e.duration)||"Unknown",participantCount:(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.participantCount)||2,project:y?{name:y.projectName||y.name,number:y.projectNumber,address:y.address||(null===(r=y.customer)||void 0===r?void 0:r.address)}:null},executiveSummary:(null===e||void 0===e?void 0:e.preview)||(null===e||void 0===e?void 0:e.title)||"",keyDecisions:[],actionItems:[],materialsList:[],risks:[],fullTranscript:(null===e||void 0===e?void 0:e.fullTranscript)||[],actions:[]};tt(s)}catch(Pr){tt({metadata:{callDate:"",callTime:"",duration:"",participantCount:"",project:null},executiveSummary:(null===e||void 0===e?void 0:e.title)||"",keyDecisions:[],actionItems:[],materialsList:[],risks:[],fullTranscript:[],actions:[]})}Ze(!0),ct(!1)},onClose:()=>ct(!1)}),(0,kt.jsx)(pa,{visible:w,onClose:()=>j(!1),colorMode:n})]})},nu=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)(null),s=[{id:"safety-training",title:"Safety Training Simulator",description:"Interactive AI-powered safety training scenarios that adapt to user responses and provide personalized learning experiences.",icon:(0,kt.jsx)(dn,{className:"w-6 h-6 text-red-600"}),image:"/safety.jpg",category:"Safety",features:["Interactive Scenarios","Adaptive Learning","Risk Assessment","Certification Tracking"],color:"red"},{id:"equipment-training",title:"Equipment Operation Trainer",description:"Virtual reality and AI-driven training for heavy equipment operation, maintenance procedures, and safety protocols.",icon:(0,kt.jsx)(Qr,{className:"w-6 h-6 text-orange-600"}),image:"/equipment.jpg",category:"Equipment",features:["VR Simulations","Real-time Feedback","Skill Assessment","Maintenance Training"],color:"orange"},{id:"code-compliance",title:"Code Compliance Trainer",description:"AI-powered training system for building codes, regulations, and compliance requirements with interactive quizzes and scenarios.",icon:(0,kt.jsx)(an,{className:"w-6 h-6 text-purple-600"}),image:"/compliance.jpg",category:"Compliance",features:["Code Updates","Interactive Quizzes","Scenario Training","Certification Prep"],color:"purple"},{id:"project-management",title:"Project Management Academy",description:"Comprehensive AI-driven training for project managers covering scheduling, budgeting, team leadership, and risk management.",icon:(0,kt.jsx)(en,{className:"w-6 h-6 text-green-600"}),image:"/pm.jpg",category:"Management",features:["Leadership Skills","Budget Management","Team Dynamics","Risk Mitigation"],color:"green"},{id:"quality-standards",title:"Quality Standards Trainer",description:"AI-powered training for quality control procedures, inspection protocols, and maintaining construction standards.",icon:(0,kt.jsx)(Yr,{className:"w-6 h-6 text-teal-600"}),image:"/quality.jpg",category:"Quality",features:["Inspection Training","Standard Procedures","Quality Metrics","Defect Recognition"],color:"teal"},{id:"estimating-mastery",title:"Estimating Mastery Program",description:"Comprehensive AI-powered training for construction estimating, including Xactimate, cost analysis, and bid preparation.",icon:(0,kt.jsx)(Gr,{className:"w-6 h-6 text-blue-600"}),image:"/estimating.jpg",category:"Estimation",features:["Xactimate Training","Cost Analysis","Bid Preparation","Market Research"],color:"blue"}],a=()=>{n(null)};return r?(0,kt.jsxs)("div",{className:"w-full max-w-5xl mx-auto px-2 py-2 ".concat(t?"bg-[#0f172a] text-white":"bg-white text-gray-800"),children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("button",{onClick:a,className:"flex items-center gap-2 text-sm font-medium mb-3 px-3 py-2 rounded-lg transition-all duration-200 ".concat(t?"text-blue-400 hover:text-blue-300 hover:bg-blue-900/20":"text-blue-600 hover:text-blue-800 hover:bg-blue-50"),children:"\u2190 Back to AI Training Tools"}),(0,kt.jsx)("h1",{className:"text-lg font-bold mb-2 ".concat(t?"text-white":"text-gray-900"),children:r.title}),(0,kt.jsx)("p",{className:"text-sm leading-relaxed ".concat(t?"text-gray-300":"text-gray-600"),children:r.description})]}),(0,kt.jsxs)("div",{className:"rounded-lg shadow-lg p-6 text-center border ".concat(t?"bg-[#1e293b] border-[#3b82f6]/30 text-white":"bg-white border-gray-200 text-gray-800"),children:[(0,kt.jsx)("div",{className:"text-4xl mb-4",children:"\ud83c\udf93"}),(0,kt.jsx)("h2",{className:"text-lg font-bold mb-2 ".concat(t?"text-white":"text-gray-800"),children:"Training Module Coming Soon"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:"This AI training module is currently in development and will be available soon."})]})]}):(0,kt.jsxs)("div",{className:"w-full max-w-5xl mx-auto px-2 py-2 ".concat(t?"bg-[#0f172a] text-white":"bg-white text-gray-800"),children:[(0,kt.jsx)("div",{className:"mb-4"}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map(e=>(0,kt.jsxs)("div",{onClick:()=>(e=>{n(e)})(e),className:"rounded-lg shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer group overflow-hidden border ".concat(t?"bg-[#1e293b] border-[#3b82f6]/30 hover:bg-[#232b4d]":"bg-white border-gray-200 hover:bg-gray-50"),children:[(0,kt.jsxs)("div",{className:"h-32 relative overflow-hidden",children:[(0,kt.jsx)("img",{src:e.image,alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),(0,kt.jsx)("div",{className:"absolute top-2 right-2",children:(0,kt.jsx)("span",{className:"text-xs font-semibold px-2 py-1 rounded-full border backdrop-blur-sm ".concat(t?"bg-[#1e293b]/80 text-gray-300 border-[#3b82f6]/30":"bg-white/80 text-gray-700 border-gray-200"),children:e.category})})]}),(0,kt.jsxs)("div",{className:"p-3",children:[(0,kt.jsx)("h3",{className:"text-sm font-bold mb-2 transition-colors ".concat(t?"text-white group-hover:text-blue-400":"text-gray-900 group-hover:text-blue-600"),children:e.title}),(0,kt.jsx)("p",{className:"text-xs mb-3 leading-relaxed ".concat(t?"text-gray-300":"text-gray-600"),children:e.description}),(0,kt.jsx)("div",{className:"space-y-1 mb-3",children:e.features.slice(0,3).map((e,r)=>(0,kt.jsxs)("div",{className:"flex items-center gap-1 text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)("div",{className:"w-1 h-1 bg-blue-500 rounded-full"}),e]},r))}),(0,kt.jsx)("button",{className:"w-full font-semibold py-2 px-3 rounded-lg transition-all duration-200 text-xs ".concat("bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white"),children:"Get Information"})]})]},e.id))})]})},su=e=>{let{title:t,file:r,setFile:n,icon:s,color:a,required:o}=e;return(0,kt.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center transition-all duration-300 bg-white hover:bg-gray-50 hover:border-gray-400 hover:shadow-lg",children:r?(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("div",{className:"flex items-center justify-center",children:(0,kt.jsx)(on,{className:"w-12 h-12 text-green-600"})}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("p",{className:"font-semibold text-gray-900 text-lg",children:r.name}),(0,kt.jsxs)("p",{className:"text-sm text-gray-500",children:[(r.size/1024/1024).toFixed(2)," MB"]})]}),(0,kt.jsx)("button",{onClick:()=>{n(null)},className:"text-red-600 hover:text-red-800 text-sm font-medium px-4 py-2 rounded-lg hover:bg-red-50 transition-colors duration-200",children:"Remove"})]}):(0,kt.jsxs)("div",{className:"space-y-8",children:[(0,kt.jsx)("div",{className:"flex items-center justify-center",children:s}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("p",{className:"font-semibold text-gray-900 text-lg",children:[t," ",!o&&(0,kt.jsx)("span",{className:"text-xs text-gray-400 font-normal",children:"(Optional)"})]}),(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Upload PDF or DOCX file"})]}),(0,kt.jsxs)("label",{className:"cursor-pointer",children:[(0,kt.jsx)("input",{type:"file",accept:".pdf,.docx,.doc",onChange:e=>{const t=e.target.files[0];t&&n(t)},className:"hidden"}),(0,kt.jsx)("span",{className:"inline-flex items-center px-4 py-2 mt-6 border border-blue-400 text-sm font-medium rounded-lg text-blue-700 bg-white hover:bg-blue-50 hover:border-blue-500 transition-all duration-200",children:"Choose File"})]})]})})},au=e=>{let{reportText:t}=e;const[r,n]=(0,o.useState)("");return(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 relative",children:[(0,kt.jsx)("div",{className:"p-8 sm:p-12",children:(0,kt.jsx)("div",{className:"prose max-w-none prose-lg",children:(s=t,s.split("\n").map((e,t)=>e.startsWith("### ")?(0,kt.jsx)("h3",{className:"text-xl font-semibold text-blue-600 mt-6 mb-2",children:e.substring(4)},t):e.startsWith("## ")?(0,kt.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mt-8 mb-4 border-b border-gray-200 pb-2",children:e.substring(3)},t):e.startsWith("# ")?(0,kt.jsx)("h1",{className:"text-3xl font-bold text-gray-900 text-center mb-4",children:e.substring(2)},t):e.startsWith("* ")?(0,kt.jsx)("li",{className:"ml-6 list-disc list-outside text-gray-700",children:e.substring(2)},t):""===e.trim()?(0,kt.jsx)("br",{},t):(0,kt.jsx)("p",{className:"text-gray-700 mb-4 leading-relaxed",children:e},t)).reduce((e,t,r)=>("li"===t.type?e.length>0&&"ul"===e[e.length-1].type?e[e.length-1].props.children.push(t):e.push((0,kt.jsx)("ul",{className:"mb-4",children:[t]},"ul-".concat(r))):e.push(t),e),[]))})}),(0,kt.jsx)("div",{className:"absolute top-6 right-6",children:(0,kt.jsxs)("button",{onClick:()=>{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy"),n("Copied!"),setTimeout(()=>n(""),2e3)}catch(ES){n("Failed to copy")}document.body.removeChild(e)},className:"flex items-center gap-3 px-4 py-3 text-sm font-semibold bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg",children:[r?(0,kt.jsx)(on,{className:"w-5 h-5 text-green-600"}):(0,kt.jsx)(an,{className:"w-5 h-5"}),r||"Copy Report"]})})]});var s},ou=e=>{let{onBack:t}=e;const[r,n]=(0,o.useState)(null),[s,a]=(0,o.useState)(null),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(""),g=r&&s;return(0,kt.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-12 bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen",children:[(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-10 border border-gray-200 mb-10",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-10",children:[(0,kt.jsx)(su,{title:"Adjuster Estimate",file:r,setFile:n,icon:(0,kt.jsx)(Gr,{className:"w-10 h-10 text-blue-600"}),color:"blue",required:!0}),(0,kt.jsx)(su,{title:"Contractor Scope Sheet",file:s,setFile:a,icon:(0,kt.jsx)(Gr,{className:"w-10 h-10 text-green-600"}),color:"green",required:!0}),(0,kt.jsx)(su,{title:"Contractor Estimate",file:i,setFile:l,icon:(0,kt.jsx)(Gr,{className:"w-10 h-10 text-purple-600"}),color:"purple",required:!1})]}),(0,kt.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-6 pt-8 border-t border-gray-200",children:[(0,kt.jsx)("button",{onClick:async()=>{if(!g)return void p("Please upload at least the Adjuster Estimate and Contractor Scope Sheet.");p(""),h(!0),d("");const e=i?"\n      You are an expert insurance restoration estimator, specializing in analyzing and comparing Xactimate estimates and contractor scope sheets. Your tone should be professional, objective, and collaborative.\n\n      I have uploaded three documents for a water damage claim (Claim ID: HW-789-2025) for analysis. Please act as if you have read and understood them perfectly.\n\n      1.  **Adjuster's Xactimate Estimate (PDF):**\n          * **Assumed Content:** A preliminary estimate from the carrier including water extraction, 3 days of drying equipment, baseboard removal, and a 2-foot flood cut.\n          * **Key Omissions:** Missing content manipulation, attached garage scope, flooring replacement, containment, and uses basic paint specs.\n\n      2.  **Contractor's Scope Sheet (DOCX):**\n          * **Assumed Content:** A detailed on-site scope noting heavy content manipulation (piano, sectional), non-salvageable premium laminate flooring, water damage in the attached garage, the need for dust containment, and a premium two-coat paint system.\n\n      3.  **Contractor's Xactimate Estimate (PDF):**\n          * **Assumed Content:** This estimate includes everything from the adjuster's estimate PLUS line items for: R&R Premium Laminate Flooring, Heavy Content Manipulation, Containment Barrier, Seal & Paint Walls (two coats), and scope for the attached garage.\n\n      **YOUR TASK:**\n      Generate a professional report that the contractor can send to the insurance adjuster. The report must clearly and respectfully outline the discrepancies between the adjuster's and contractor's estimates, using the scope sheet as justification for the necessary additions.\n\n      **REPORT FORMAT:**\n      * Start with a title: \"Supplement Request & Justification Report\".\n      * Use Markdown for formatting.\n      * Create a \"Summary of Proposed Adjustments\" section.\n      * Create a \"Detailed Line Item Justification\" section. For each item, provide: **Item**, **Justification** (citing scope sheet findings), and **Recommendation**.\n      * End with a professional closing statement.\n    ":'\n      You are an expert insurance restoration estimator, tasked with helping a contractor build an accurate estimate. Your tone should be professional, objective, and advisory.\n\n      I have uploaded two documents for a water damage claim (Claim ID: HW-789-2025) for a preliminary analysis. Please act as if you have read and understood them perfectly.\n\n      1.  **Adjuster\'s Xactimate Estimate (PDF):**\n          * **Assumed Content:** A preliminary estimate from the carrier including water extraction, 3 days of drying equipment, baseboard removal, and a 2-foot flood cut.\n          * **Key Omissions:** Missing content manipulation, attached garage scope, flooring replacement, containment, and uses basic paint specs.\n\n      2.  **Contractor\'s Scope Sheet (DOCX):**\n          * **Assumed Content:** A detailed on-site scope noting heavy content manipulation (piano, sectional), non-salvageable premium laminate flooring, water damage in the attached garage, the need for dust containment, and a premium two-coat paint system.\n\n      **YOUR TASK:**\n      Generate a "Pre-Estimate Advisory Report". This report will serve as a guide for the contractor to build their own comprehensive Xactimate estimate by comparing the adjuster\'s initial findings with the more detailed on-site scope.\n\n      **REPORT FORMAT:**\n      * Start with a title: "Pre-Estimate Advisory Report".\n      * Use Markdown for formatting.\n      * Create a "Recommended Additions to Estimate" section.\n      * For each recommended addition, provide: **Item** (e.g., "Content Manipulation - Heavy"), **Justification** (citing scope sheet findings), and an **Estimating Note** (a tip for listing it in Xactimate).\n      * Add a "General Recommendations" section for other potential considerations (e.g., checking local codes, project monitoring).\n      * End with a professional closing statement.\n    ';try{const t={contents:[{role:"user",parts:[{text:e}]}]},r="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_GEMINI_API_KEY||""),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("API call failed with status: ".concat(n.status));const s=await n.json();if(!(s.candidates&&s.candidates.length>0&&s.candidates[0].content&&s.candidates[0].content.parts&&s.candidates[0].content.parts.length>0))throw console.error("Unexpected API response structure:",s),new Error("Failed to parse the analysis from the API response.");{const e=s.candidates[0].content.parts[0].text;d(e)}}catch(ES){console.error("Error during analysis:",ES),p("An error occurred during analysis. Please try again. Details: ".concat(ES.message))}finally{h(!1)}},disabled:!g||u,style:{background:"linear-gradient(90deg, #2563eb, #1d4ed8, #1e40af)",color:"white",padding:"16px 40px",borderRadius:"12px",fontSize:"18px",fontWeight:"600",border:"none",cursor:"pointer",transition:"all 0.3s ease",transform:"scale(1)",boxShadow:"0 10px 25px rgba(37, 99, 235, 0.3)"},onMouseEnter:e=>{e.target.style.background="linear-gradient(90deg, #1d4ed8, #1e40af, #1e3a8a)",e.target.style.transform="scale(1.05)"},onMouseLeave:e=>{e.target.style.background="linear-gradient(90deg, #2563eb, #1d4ed8, #1e40af)",e.target.style.transform="scale(1)"},className:"w-full sm:w-auto flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(Zr,{className:"w-6 h-6 animate-spin"}),"Analyzing..."]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(Yr,{className:"w-6 h-6"}),"Run Analysis"]})}),(0,kt.jsx)("button",{onClick:()=>{n(null),a(null),l(null),d(""),p(""),h(!1)},className:"w-full sm:w-auto flex items-center justify-center gap-3 px-10 py-4 text-lg font-semibold text-gray-700 bg-gray-100 rounded-xl shadow-lg hover:bg-gray-200 transition-all duration-300 transform hover:scale-105",children:"Reset"})]})]}),m&&(0,kt.jsxs)("div",{className:"mb-10 bg-red-50 border border-red-200 text-red-700 px-8 py-6 rounded-xl flex items-center gap-4 shadow-lg",children:[(0,kt.jsx)(un,{className:"w-6 h-6 text-red-500 flex-shrink-0"}),(0,kt.jsx)("span",{className:"font-medium text-lg",children:m})]}),c&&(0,kt.jsx)(au,{reportText:c})]})},iu=["title","titleId"];function lu(e,t){let{title:r,titleId:n}=e,s=Sn(e,iu);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const cu=o.forwardRef(lu),du=["title","titleId"];function uu(e,t){let{title:r,titleId:n}=e,s=Sn(e,du);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const hu=o.forwardRef(uu),mu=["title","titleId"];function pu(e,t){let{title:r,titleId:n}=e,s=Sn(e,mu);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const gu=o.forwardRef(pu),fu=["title","titleId"];function xu(e,t){let{title:r,titleId:n}=e,s=Sn(e,fu);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const vu=o.forwardRef(xu),yu=e=>{var t,n;let{colorMode:s}=e;const a=Ct(),[i,l]=(0,o.useState)("upload"),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)(null),[m,p]=(0,o.useState)(""),[g,f]=(0,o.useState)("LEAD"),[x,v]=(0,o.useState)(!1),[y,b]=(0,o.useState)(null),[w,j]=(0,o.useState)({phase:"phase",section:"section",lineItem:"line_item"}),[N,S]=(0,o.useState)([]),[k,A]=(0,o.useState)([]),[C,E]=(0,o.useState)(!1),[P,I]=(0,o.useState)("");(0,o.useEffect)(()=>{(async()=>{try{const e=await fetch("/api/projects",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(e.ok){const t=await e.json();t.success&&t.data&&S(t.data.projects||t.data)}}catch(P){console.error("Failed to fetch projects:",P)}})()},[]),(0,o.useEffect)(()=>{(async()=>{try{console.log("\ud83d\udd0d WORKFLOW IMPORT: Fetching workflow phases for dropdown...");const e=(await Promise.resolve().then(r.bind(r,505))).default,t=(await e.get("/workflow-data/phases")).data;if(null===t||void 0===t||!t.success||!t.data)throw new Error("Invalid response format");{const e=t.data.map(e=>({id:e.id,name:e.name,displayName:e.displayName||e.name}));A(e),e.length>0&&f(e[0].id),console.log("\u2705 WORKFLOW IMPORT: Loaded workflow phases from database:",e)}}catch(P){console.error("\u274c WORKFLOW IMPORT: Failed to fetch workflow phases:",P);A([{id:"LEAD",name:"LEAD",displayName:"Lead"},{id:"PROSPECT",name:"PROSPECT",displayName:"Prospect"},{id:"APPROVED",name:"APPROVED",displayName:"Approved"},{id:"EXECUTION",name:"EXECUTION",displayName:"Execution"},{id:"COMPLETION",name:"COMPLETION",displayName:"Completion"}]),f("LEAD"),console.log("\u26a0\ufe0f WORKFLOW IMPORT: Using fallback workflow phases due to API error")}})()},[]);const T=Ts({mutationFn:async e=>{const t=new FormData;return t.append("file",e),await Ds.workflowImportService.uploadFile(t)},onSuccess:e=>{h(e.data.importId),b(e.data),l("preview")},onError:e=>{var t,r;alert("Upload failed: ".concat((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}}),D=Ts({mutationFn:async e=>await Ds.workflowImportService.confirmImport(e.importId,{projectId:e.projectId,startingPhase:e.startingPhase,clearExisting:e.clearExisting}),onSuccess:e=>{alert("Workflow imported successfully!"),a.invalidateQueries(["projects"]),a.invalidateQueries(["workflows"]),l("upload"),d(null),h(null),b(null)},onError:e=>{var t,r;alert("Import failed: ".concat((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}}),M=e=>{Ds.workflowImportService.downloadTemplate(e)};return(0,kt.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,kt.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,kt.jsxs)("div",{className:"bg-white rounded-lg shadow-lg",children:[(0,kt.jsxs)("div",{className:"border-b px-6 py-4",children:[(0,kt.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Import Workflow Data"}),(0,kt.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Upload an Excel or CSV file with Phase, Section, and Line Item data"})]}),(0,kt.jsx)("div",{className:"px-6 py-4 border-b",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center",style:{color:"upload"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-400)"},children:[(0,kt.jsx)("span",{className:"flex items-center justify-center w-8 h-8 border-2 rounded-full",style:{borderColor:"upload"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-300)"},children:"1"}),(0,kt.jsx)("span",{className:"ml-2 font-medium",children:"Upload File"})]}),(0,kt.jsx)("div",{className:"flex-1 h-0.5 mx-4 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center",style:{color:"preview"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-400)"},children:[(0,kt.jsx)("span",{className:"flex items-center justify-center w-8 h-8 border-2 rounded-full",style:{borderColor:"preview"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-300)"},children:"2"}),(0,kt.jsx)("span",{className:"ml-2 font-medium",children:"Preview & Validate"})]}),(0,kt.jsx)("div",{className:"flex-1 h-0.5 mx-4 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center",style:{color:"mapping"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-400)"},children:[(0,kt.jsx)("span",{className:"flex items-center justify-center w-8 h-8 border-2 rounded-full",style:{borderColor:"mapping"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-300)"},children:"3"}),(0,kt.jsx)("span",{className:"ml-2 font-medium",children:"Configure Import"})]}),(0,kt.jsx)("div",{className:"flex-1 h-0.5 mx-4 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center",style:{color:"confirm"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-400)"},children:[(0,kt.jsx)("span",{className:"flex items-center justify-center w-8 h-8 border-2 rounded-full",style:{borderColor:"confirm"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-300)"},children:"4"}),(0,kt.jsx)("span",{className:"ml-2 font-medium",children:"Confirm"})]})]})}),(0,kt.jsxs)("div",{className:"p-6",children:["upload"===i&&(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"var(--color-primary-light-tint)"},children:[(0,kt.jsx)("h3",{className:"font-medium mb-2",style:{color:"var(--color-primary-blueprint-blue)"},children:"Download Template"}),(0,kt.jsx)("p",{className:"text-sm mb-3",style:{color:"var(--color-primary-blueprint-blue)"},children:"Use our template to ensure your data is formatted correctly"}),(0,kt.jsxs)("div",{className:"flex space-x-3",children:[(0,kt.jsxs)("button",{onClick:()=>M("xlsx"),className:"px-4 py-2 text-white rounded",style:{background:"var(--color-primary-blueprint-blue)"},children:[(0,kt.jsx)(cu,{className:"w-4 h-4 inline mr-2"}),"Excel Template"]}),(0,kt.jsxs)("button",{onClick:()=>M("csv"),className:"px-4 py-2 text-white rounded",style:{background:"var(--color-success-green)"},children:[(0,kt.jsx)(cu,{className:"w-4 h-4 inline mr-2"}),"CSV Template"]})]})]}),(0,kt.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[(0,kt.jsx)(Ol,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),(0,kt.jsxs)("label",{className:"cursor-pointer",children:[(0,kt.jsx)("span",{className:"px-4 py-2 text-white rounded",style:{background:"var(--color-primary-blueprint-blue)"},children:"Choose File"}),(0,kt.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{const t=e.target.files[0];if(t){const e=[".xlsx",".xls",".csv"],r=t.name.substring(t.name.lastIndexOf(".")).toLowerCase();if(!e.includes(r))return void alert("Invalid file format. Please upload an Excel (.xlsx, .xls) or CSV (.csv) file.");d(t),T.mutate(t)}},className:"hidden"})]}),(0,kt.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"or drag and drop your Excel/CSV file here"}),(0,kt.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Supported formats: .xlsx, .xls, .csv (max 10MB)"})]}),(0,kt.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,kt.jsxs)("h3",{className:"font-medium text-yellow-900 mb-2",children:[(0,kt.jsx)(hu,{className:"w-5 h-5 inline mr-2"}),"File Requirements"]}),(0,kt.jsxs)("ul",{className:"text-sm text-yellow-700 space-y-1 ml-7",children:[(0,kt.jsx)("li",{children:"\u2022 Must contain headers: Phase, Section, Line Item"}),(0,kt.jsx)("li",{children:"\u2022 Optional headers: Description, Responsible Role, Estimated Duration, Alert Priority"}),(0,kt.jsx)("li",{children:"\u2022 Phases must be: LEAD, PROSPECT, APPROVED, EXECUTION, SUPPLEMENT, or COMPLETION"}),(0,kt.jsx)("li",{children:"\u2022 No empty rows between data"})]})]})]}),"preview"===i&&y&&(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"File Summary"}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"File Name"}),(0,kt.jsx)("p",{className:"font-medium",children:y.fileName})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Total Rows"}),(0,kt.jsx)("p",{className:"font-medium",children:y.totalRows})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Valid Rows"}),(0,kt.jsx)("p",{className:"font-medium",style:{color:"var(--color-success-green)"},children:y.validRows})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Error Rows"}),(0,kt.jsx)("p",{className:"font-medium text-red-600",children:y.errorRows})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Data Preview (First 10 Rows)"}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,kt.jsx)("thead",{className:"bg-gray-50",children:(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Row"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Phase"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Section"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Line Item"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Role"})]})}),(0,kt.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.preview.map((e,t)=>(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.rowNumber}),(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.phase}),(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.section}),(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.lineItem}),(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.responsibleRole})]},t))})]})})]}),y.errors&&y.errors.length>0&&(0,kt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,kt.jsxs)("h3",{className:"font-medium text-red-900 mb-2",children:[(0,kt.jsx)(gu,{className:"w-5 h-5 inline mr-2"}),"Validation Errors"]}),(0,kt.jsx)("ul",{className:"text-sm text-red-700 space-y-1",children:y.errors.map((e,t)=>(0,kt.jsxs)("li",{children:["Row ",e.rowNumber,": ",e.error]},t))})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("button",{onClick:()=>l("upload"),className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Back"}),(0,kt.jsx)("button",{onClick:()=>l("mapping"),className:"px-4 py-2 text-white rounded",style:{background:"var(--color-primary-blueprint-blue)"},disabled:0===y.validRows,children:"Continue"})]})]}),"mapping"===i&&(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Target Project"}),(0,kt.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,kt.jsx)("option",{value:"",children:"-- Select a Project --"}),N.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.projectNumber," - ",e.projectName]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Phase"}),(0,kt.jsx)("select",{value:g,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:k.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.displayName},e.id))}),(0,kt.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Import will begin from this phase and include all subsequent phases"})]}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",id:"clearExisting",checked:x,onChange:e=>v(e.target.checked),className:"h-4 w-4 rounded",style:{accentColor:"var(--color-primary-blueprint-blue)"}}),(0,kt.jsx)("label",{htmlFor:"clearExisting",className:"ml-2 text-sm text-gray-700",children:"Clear existing workflow data before importing"})]}),x&&(0,kt.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,kt.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,kt.jsx)(hu,{className:"w-5 h-5 inline mr-2"}),"Warning: This will permanently delete all existing workflow data for this project"]})}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("button",{onClick:()=>l("preview"),className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Back"}),(0,kt.jsx)("button",{onClick:()=>l("confirm"),className:"px-4 py-2 text-white rounded",style:{background:"var(--color-primary-blueprint-blue)"},disabled:!m,children:"Review Import"})]})]}),"confirm"===i&&y&&(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,kt.jsxs)("h3",{className:"font-medium text-green-900 mb-3",children:[(0,kt.jsx)(vu,{className:"w-5 h-5 inline mr-2"}),"Ready to Import"]}),(0,kt.jsxs)("div",{className:"text-sm text-green-700 space-y-2",children:[(0,kt.jsxs)("p",{children:["\u2022 ",y.validRows," workflow items will be imported"]}),(0,kt.jsxs)("p",{children:["\u2022 Phases: ",y.summary.phases.join(", ")]}),(0,kt.jsxs)("p",{children:["\u2022 ",y.summary.sections," unique sections"]}),(0,kt.jsxs)("p",{children:["\u2022 Starting from: ",g," phase"]}),x&&(0,kt.jsx)("p",{className:"text-yellow-700",children:"\u2022 Existing workflow will be cleared"})]})]}),(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,kt.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Target Project"}),(0,kt.jsxs)("p",{className:"text-sm text-gray-700",children:[null===(t=N.find(e=>e.id===m))||void 0===t?void 0:t.projectNumber," -",null===(n=N.find(e=>e.id===m))||void 0===n?void 0:n.projectName]})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("button",{onClick:()=>l("mapping"),className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Back"}),(0,kt.jsx)("button",{onClick:()=>{m?D.mutate({importId:u,projectId:m,startingPhase:g,clearExisting:x}):alert("Please select a project to import the workflow into.")},className:"px-4 py-2 text-white rounded",style:{background:"var(--color-success-green)"},disabled:D.isLoading,children:D.isLoading?"Importing...":"Confirm Import"})]})]})]})]})})})};function bu(e){return fc({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(e)}function wu(e){return fc({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"},child:[]}]})(e)}function ju(e){return fc({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(e)}function Nu(e){return fc({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm60.1 106.5L224 336l60.1 93.5c5.1 8-.6 18.5-10.1 18.5h-34.9c-4.4 0-8.5-2.4-10.6-6.3C208.9 405.5 192 373 192 373c-6.4 14.8-10 20-36.6 68.8-2.1 3.9-6.1 6.3-10.5 6.3H110c-9.5 0-15.2-10.5-10.1-18.5l60.3-93.5-60.3-93.5c-5.2-8 .6-18.5 10.1-18.5h34.8c4.4 0 8.5 2.4 10.6 6.3 26.1 48.8 20 33.6 36.6 68.5 0 0 6.1-11.7 36.6-68.5 2.1-3.9 6.2-6.3 10.6-6.3H274c9.5-.1 15.2 10.4 10.1 18.4zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(e)}function Su(e){return fc({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(e)}function ku(e){return fc({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(e)}function Au(e){return fc({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64v-96h160v96zm0-160H64v-96h160v96zm224 160H288v-96h160v96zm0-160H288v-96h160v96z"},child:[]}]})(e)}function Cu(e){return fc({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(e)}function Eu(e){return fc({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(e)}const Pu=e=>{let{colorMode:t=!1}=e;const[r,n]=(0,o.useState)([]),[s,a]=(0,o.useState)(""),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(null),[m,p]=(0,o.useState)(""),[g,f]=(0,o.useState)(""),[x,v]=(0,o.useState)(!0),[y,b]=(0,o.useState)(!1),[w,j]=(0,o.useState)(null),[N,S]=(0,o.useState)({});(0,o.useEffect)(()=>{A()},[]);const k=()=>sessionStorage.getItem("authToken")||localStorage.getItem("authToken")||sessionStorage.getItem("token")||localStorage.getItem("token"),A=async()=>{try{d(!0);const e=await fetch("".concat(Ds.API_BASE_URL,"/complete-excel-data/tables"),{headers:{Authorization:"Bearer ".concat(k()),Accept:"application/json"}});if(!e.ok)throw new Error("Failed to fetch tables");if(!(e.headers.get("content-type")||"").includes("application/json")){await e.text();throw new Error("Server returned non-JSON response (likely a proxy or auth redirect).")}const t=await e.json();n(t.data.tables),console.log("\ud83d\udccb Loaded tables:",t.data.tables.length)}catch(ES){console.error("Error fetching tables:",ES),p("Failed to load database tables: "+ES.message)}finally{d(!1)}},C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=e?"".concat(Ds.API_BASE_URL,"/complete-excel-data/template/").concat(e):"".concat(Ds.API_BASE_URL,"/complete-excel-data/template/all"),r=await fetch(t,{headers:{Authorization:"Bearer ".concat(k())}});if(!r.ok)throw new Error("Failed to download template");const n=await r.blob(),s=window.URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=e?"".concat(e,"-template.xlsx"):"complete-database-template.xlsx",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),f("Template downloaded: ".concat(e||"Complete database"))}catch(ES){p("Failed to download template: "+ES.message)}},E=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{d(!0);const t=e?"".concat(Ds.API_BASE_URL,"/complete-excel-data/export/").concat(e):"".concat(Ds.API_BASE_URL,"/complete-excel-data/export/all"),r=await fetch(t,{headers:{Authorization:"Bearer ".concat(k())}});if(!r.ok)throw new Error("Failed to export data");const n=await r.blob(),s=window.URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=e?"".concat(e,"-export.xlsx"):"complete-database-export.xlsx",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),f("Data exported: ".concat(e||"Complete database"))}catch(ES){p("Failed to export data: "+ES.message)}finally{d(!1)}};return(0,kt.jsxs)("div",{className:"space-y-6 ".concat(t?"text-gray-100":"text-gray-800"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,kt.jsx)(wu,{className:"text-2xl text-blue-500"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-xl font-bold",children:"Complete Database Manager"}),(0,kt.jsxs)("p",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:["Upload, download, and manage data for all ",r.length," database tables"]})]})]}),(0,kt.jsx)("div",{className:"text-right",children:(0,kt.jsxs)("div",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:["Total Tables: ",r.length," | Total Fields: ",r.reduce((e,t)=>e+t.totalFields,0)]})})]}),m&&(0,kt.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded flex items-center",children:[(0,kt.jsx)(Cu,{className:"mr-2"}),m]}),g&&(0,kt.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded flex items-center",children:[(0,kt.jsx)(bu,{className:"mr-2"}),g]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-6 ".concat(t?"border-gray-600 bg-gray-800":"border-gray-300 bg-white"),children:[(0,kt.jsxs)("h4",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,kt.jsx)(Eu,{className:"mr-2 text-blue-500"}),"Upload Data"]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("div",{className:"flex items-center space-x-4",children:(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",checked:x,onChange:e=>v(e.target.checked),className:"mr-2"}),"Auto-detect table from file"]})}),!x&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(t?"text-gray-300":"text-gray-700"),children:"Target Table"}),(0,kt.jsxs)("select",{value:s,onChange:e=>a(e.target.value),className:"w-full p-2 border rounded-md ".concat(t?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300 text-gray-900"),children:[(0,kt.jsx)("option",{value:"",children:"Select a table..."}),r.map(e=>(0,kt.jsxs)("option",{value:e.name,children:[e.displayName," (",e.uploadableFields," uploadable fields)"]},e.name))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(t?"text-gray-300":"text-gray-700"),children:"Select File (.xlsx, .xls, .csv)"}),(0,kt.jsx)("input",{type:"file",id:"complete-excel-file-input",accept:".xlsx,.xls,.csv",onChange:e=>{const t=e.target.files[0];t&&(l(t),p(""),h(null),f(""))},className:"w-full p-2 border rounded-md ".concat(t?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300 text-gray-900")}),i&&(0,kt.jsxs)("div",{className:"mt-2 text-sm text-green-600 flex items-center",children:[(0,kt.jsx)(Nu,{className:"mr-1"}),i.name," (",(i.size/1024/1024).toFixed(2)," MB)"]})]}),(0,kt.jsx)("button",{onClick:async()=>{if(i){d(!0),p(""),f("");try{const e=new FormData;e.append("file",i),s&&!x&&e.append("tableName",s),e.append("autoDetect",x.toString());const t=await fetch("".concat(Ds.API_BASE_URL,"/complete-excel-data/upload"),{method:"POST",headers:{Authorization:"Bearer ".concat(k())},body:e});if(!(t.headers.get("content-type")||"").includes("application/json")){await t.text();throw new Error("Server returned non-JSON response for upload.")}const r=await t.json();if(!t.ok)throw new Error(r.message||"Upload failed");h(r.data),f("Upload completed: ".concat(r.data.overall.totalSuccessful,"/").concat(r.data.overall.totalRecords," records processed. Note: Existing records with duplicate unique fields (project numbers, emails) will be updated.")),l(null);const n=document.getElementById("complete-excel-file-input");n&&(n.value="")}catch(ES){console.error("Upload error:",ES),p(ES.message||"Upload failed")}finally{d(!1)}}else p("Please select a file first")},disabled:!i||c,className:"w-full py-2 px-4 rounded-md font-medium flex items-center justify-center ".concat(!i||c?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-[var(--color-primary-blueprint-blue)]"),children:c?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(ku,{className:"animate-spin mr-2"}),"Processing..."]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(Eu,{className:"mr-2"}),"Upload Data"]})})]})]}),u&&(0,kt.jsxs)("div",{className:"border rounded-lg p-6 ".concat(t?"border-gray-600 bg-gray-800":"border-gray-300 bg-white"),children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Upload Results"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,kt.jsxs)("div",{className:"p-3 rounded ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-blue-500",children:u.overall.totalSheets}),(0,kt.jsx)("div",{className:"text-sm",children:"Sheets Processed"})]}),(0,kt.jsxs)("div",{className:"p-3 rounded ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:u.overall.totalRecords}),(0,kt.jsx)("div",{className:"text-sm",children:"Total Records"})]}),(0,kt.jsxs)("div",{className:"p-3 rounded ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-green-500",children:u.overall.totalSuccessful}),(0,kt.jsx)("div",{className:"text-sm",children:"Successful"})]}),(0,kt.jsxs)("div",{className:"p-3 rounded ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-red-500",children:u.overall.totalFailed}),(0,kt.jsx)("div",{className:"text-sm",children:"Failed"})]})]}),Object.entries(u.sheetResults||{}).length>0&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h5",{className:"font-medium mb-2",children:"Sheet Details:"}),(0,kt.jsx)("div",{className:"space-y-2",children:Object.entries(u.sheetResults).map(e=>{let[r,n]=e;return(0,kt.jsxs)("div",{className:"p-3 border rounded ".concat(t?"border-gray-600":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("button",{onClick:()=>(e=>{S(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!t[e]}))})(r),className:"px-2 py-1 text-xs rounded ".concat(t?"bg-gray-700 text-gray-100":"bg-gray-100 text-gray-700"),children:N[r]?"Hide Details":"View Details"}),(0,kt.jsx)("span",{className:"font-medium",children:r})]}),(0,kt.jsxs)("span",{className:"text-sm",children:["\u2192 ",n.targetTable]})]}),(0,kt.jsxs)("div",{className:"text-sm flex justify-between",children:[(0,kt.jsxs)("span",{className:"text-green-600",children:["\u2713 ",n.successful," successful"]}),(0,kt.jsxs)("span",{className:"text-red-600",children:["\u2717 ",n.failed," failed"]})]}),N[r]&&(0,kt.jsxs)("div",{className:"mt-3 text-sm ".concat(t?"text-gray-200":"text-gray-800"),children:[Array.isArray(n.transformWarnings)&&n.transformWarnings.length>0&&(0,kt.jsxs)("div",{className:"mb-2",children:[(0,kt.jsx)("div",{className:"font-medium mb-1",children:"Transform warnings:"}),(0,kt.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:n.transformWarnings.map((e,r)=>(0,kt.jsx)("div",{className:"".concat(t?"bg-yellow-900 text-yellow-200":"bg-yellow-50 text-yellow-700"," p-2 rounded"),children:e},r))})]}),Array.isArray(n.errors)&&n.errors.length>0&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium mb-1 text-red-600",children:"Row errors:"}),(0,kt.jsx)("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:n.errors.map((e,r)=>(0,kt.jsxs)("div",{className:"".concat(t?"bg-red-900 text-red-200":"bg-red-50 text-red-700"," p-2 rounded"),children:[e.row?"Row ".concat(e.row,": "):"",e.error]},r))})]})]})]},r)})})]}),u.overall.errors&&u.overall.errors.length>0&&(0,kt.jsxs)("div",{className:"mt-4",children:[(0,kt.jsx)("h5",{className:"font-medium mb-2 text-red-600",children:"Errors:"}),(0,kt.jsx)("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:u.overall.errors.map((e,t)=>(0,kt.jsxs)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:[e.sheet,": ",e.error]},t))})]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-6 ".concat(t?"border-gray-600 bg-gray-800":"border-gray-300 bg-white"),children:[(0,kt.jsxs)("h4",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,kt.jsx)(ju,{className:"mr-2 text-green-500"}),"Download Templates & Export Data"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,kt.jsxs)("button",{onClick:()=>C(),className:"py-2 px-4 bg-green-500 text-white rounded-md hover:bg-[var(--color-success-green)] flex items-center justify-center",children:[(0,kt.jsx)(ju,{className:"mr-2"}),"Download All Templates"]}),(0,kt.jsxs)("button",{onClick:()=>E(),className:"py-2 px-4 bg-purple-500 text-white rounded-md hover:bg-purple-600 flex items-center justify-center",disabled:c,children:[c?(0,kt.jsx)(ku,{className:"animate-spin mr-2"}):(0,kt.jsx)(ju,{className:"mr-2"}),"Export All Data"]})]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-6 ".concat(t?"border-gray-600 bg-gray-800":"border-gray-300 bg-white"),children:[(0,kt.jsxs)("h4",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,kt.jsx)(Au,{className:"mr-2 text-indigo-500"}),"Database Tables (",r.length,")"]}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"border-gray-600 hover:border-gray-500":"border-gray-200 hover:border-gray-300"," hover:shadow-md transition-all cursor-pointer"),children:[(0,kt.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,kt.jsx)("h5",{className:"font-medium text-sm",children:e.displayName}),(0,kt.jsx)("button",{onClick:()=>(e=>{j(e),b(!0)})(e),className:"text-blue-500 hover:text-blue-600",children:(0,kt.jsx)(Su,{})})]}),(0,kt.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{children:"Total Fields:"}),(0,kt.jsx)("span",{className:"font-medium",children:e.totalFields})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{children:"Uploadable:"}),(0,kt.jsx)("span",{className:"font-medium text-green-600",children:e.uploadableFields})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{children:"Relations:"}),(0,kt.jsx)("span",{className:"font-medium text-blue-600",children:e.relationships})]})]}),(0,kt.jsxs)("div",{className:"flex space-x-2 mt-3",children:[(0,kt.jsx)("button",{onClick:()=>C(e.name),className:"flex-1 py-1 px-2 text-xs bg-green-500 text-white rounded hover:bg-[var(--color-success-green)]",children:"Template"}),(0,kt.jsx)("button",{onClick:()=>E(e.name),className:"flex-1 py-1 px-2 text-xs bg-purple-500 text-white rounded hover:bg-purple-600",disabled:c,children:"Export"})]})]},e.name))})]}),y&&w&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,kt.jsx)("div",{className:"max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto rounded-lg ".concat(t?"bg-gray-800":"bg-white"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,kt.jsxs)("h3",{className:"text-xl font-bold",children:[w.displayName," Fields"]}),(0,kt.jsx)("button",{onClick:()=>b(!1),className:"text-gray-500 hover:text-gray-700",children:(0,kt.jsx)(Cu,{})})]}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"w-full text-sm ".concat(t?"text-gray-100":"text-gray-800"),children:[(0,kt.jsx)("thead",{children:(0,kt.jsxs)("tr",{className:"border-b ".concat(t?"border-gray-600":"border-gray-200"),children:[(0,kt.jsx)("th",{className:"text-left p-2",children:"Field Name"}),(0,kt.jsx)("th",{className:"text-left p-2",children:"Type"}),(0,kt.jsx)("th",{className:"text-left p-2",children:"Required"}),(0,kt.jsx)("th",{className:"text-left p-2",children:"Enum Values"}),(0,kt.jsx)("th",{className:"text-left p-2",children:"Constraint"})]})}),(0,kt.jsx)("tbody",{children:w.fields.map((e,r)=>(0,kt.jsxs)("tr",{className:"border-b ".concat(t?"border-gray-700":"border-gray-100"),children:[(0,kt.jsx)("td",{className:"p-2 font-medium",children:e.name}),(0,kt.jsx)("td",{className:"p-2",children:e.type}),(0,kt.jsx)("td",{className:"p-2",children:e.required?(0,kt.jsx)("span",{className:"text-red-500",children:"\u2713"}):(0,kt.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,kt.jsx)("td",{className:"p-2",children:e.enumValues?(0,kt.jsx)("div",{className:"max-w-xs overflow-x-auto",children:(0,kt.jsx)("div",{className:"text-xs space-y-1",children:e.enumValues.map(e=>(0,kt.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 px-1 rounded mr-1",children:e},e))})}):(0,kt.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,kt.jsx)("td",{className:"p-2 text-xs max-w-xs truncate",title:e.constraint,children:e.constraint})]},r))})]})})]})})})]})};function Iu(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),s=2;s<r;s++)n[s-2]=arguments[s];if("undefined"!==typeof process&&void 0===t)throw new Error("invariant requires an error message argument");if(!e){let e;if(void 0===t)e=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let r=0;e=new Error(t.replace(/%s/g,function(){return n[r++]})),e.name="Invariant Violation"}throw e.framesToPop=1,e}}var Tu=r(122);const Du="undefined"!==typeof window?o.useLayoutEffect:o.useEffect;function Mu(e,t,r){const[n,s]=function(e,t,r){const[n,s]=(0,o.useState)(()=>t(e)),a=(0,o.useCallback)(()=>{const a=t(e);Tu(n,a)||(s(a),r&&r())},[n,e,r]);return Du(a),[n,a]}(e,t,r);return Du(function(){const t=e.getHandlerId();if(null!=t)return e.subscribeToStateChange(s,{handlerIds:[t]})},[e,s]),n}function _u(e,t,r){return Mu(t,e||(()=>({})),()=>r.reconnect())}function Ou(e,t){const r=[...t||[]];return null==t&&"function"!==typeof e&&r.push(e),(0,o.useMemo)(()=>"function"===typeof e?e():e,r)}function Lu(e){return(0,o.useMemo)(()=>e.hooks.dragSource(),[e])}function Ru(e){return(0,o.useMemo)(()=>e.hooks.dragPreview(),[e])}function Fu(e,t,r,n){let s=r?r.call(n,e,t):void 0;if(void 0!==s)return!!s;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;const a=Object.keys(e),o=Object.keys(t);if(a.length!==o.length)return!1;const i=Object.prototype.hasOwnProperty.bind(t);for(let l=0;l<a.length;l++){const o=a[l];if(!i(o))return!1;const c=e[o],d=t[o];if(s=r?r.call(n,c,d,o):void 0,!1===s||void 0===s&&c!==d)return!1}return!0}function Uu(e){return null!==e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Bu(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(0,o.isValidElement)(t)){const n=t;return e(n,r),n}const n=t;!function(e){if("string"===typeof e.type)return;const t=e.type.displayName||e.type.name||"the component";throw new Error("Only native element nodes can now be passed to React DnD connectors."+"You can either wrap ".concat(t," into a <div>, or turn it into a ")+"drag source or a drop target itself.")}(n);return function(e,t){const r=e.ref;return Iu("string"!==typeof r,"Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),r?(0,o.cloneElement)(e,{ref:e=>{zu(r,e),zu(t,e)}}):(0,o.cloneElement)(e,{ref:t})}(n,r?t=>e(t,r):e)}}function Wu(e){const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(r.endsWith("Ref"))t[r]=e[r];else{const e=Bu(n);t[r]=()=>e}}),t}function zu(e,t){"function"===typeof e?e(t):e.current=t}class Vu{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.dragPreview,r=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();r&&this.disconnectDragPreview(),this.handlerId&&(t?r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions)):this.lastConnectedDragPreview=t)}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!Fu(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!Fu(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=Wu({dragSource:(e,t)=>{this.clearDragSource(),this.dragSourceOptions=t||null,Uu(e)?this.dragSourceRef=e:this.dragSourceNode=e,this.reconnectDragSource()},dragPreview:(e,t)=>{this.clearDragPreview(),this.dragPreviewOptions=t||null,Uu(e)?this.dragPreviewRef=e:this.dragPreviewNode=e,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}const Hu=(0,o.createContext)({dragDropManager:void 0});function qu(){const{dragDropManager:e}=(0,o.useContext)(Hu);return Iu(null!=e,"Expected drag drop context"),e}let Ku=!1,Gu=!1;class Ju{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){Iu(!Ku,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Ku=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{Ku=!1}}isDragging(){if(!this.sourceId)return!1;Iu(!Gu,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Gu=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{Gu=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}class Yu{beginDrag(){const e=this.spec,t=this.monitor;let r=null;return r="object"===typeof e.item?e.item:"function"===typeof e.item?e.item(t):{},null!==r&&void 0!==r?r:null}canDrag(){const e=this.spec,t=this.monitor;return"boolean"===typeof e.canDrag?e.canDrag:"function"!==typeof e.canDrag||e.canDrag(t)}isDragging(e,t){const r=this.spec,n=this.monitor,{isDragging:s}=r;return s?s(n):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,r=this.connector,{end:n}=e;n&&n(t.getItem(),t),r.reconnect()}constructor(e,t,r){this.spec=e,this.monitor=t,this.connector=r}}function Qu(e,t,r){const n=qu(),s=function(e,t,r){const n=(0,o.useMemo)(()=>new Yu(e,t,r),[t,r]);return(0,o.useEffect)(()=>{n.spec=e},[e]),n}(e,t,r),a=function(e){return(0,o.useMemo)(()=>{const t=e.type;return Iu(null!=t,"spec.type must be defined"),t},[e])}(e);Du(function(){if(null!=a){const[e,o]=function(e,t,r){const n=r.getRegistry(),s=n.addSource(e,t);return[s,()=>n.removeSource(s)]}(a,s,n);return t.receiveHandlerId(e),r.receiveHandlerId(e),o}},[n,t,r,s,a])}function Xu(e,t){const r=Ou(e,t);Iu(!r.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const n=function(){const e=qu();return(0,o.useMemo)(()=>new Ju(e),[e])}(),s=function(e,t){const r=qu(),n=(0,o.useMemo)(()=>new Vu(r.getBackend()),[r]);return Du(()=>(n.dragSourceOptions=e||null,n.reconnect(),()=>n.disconnectDragSource()),[n,e]),Du(()=>(n.dragPreviewOptions=t||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,t]),n}(r.options,r.previewOptions);return Qu(r,n,s),[_u(r.collect,n,s),Lu(s),Ru(s)]}function $u(e){return(0,o.useMemo)(()=>e.hooks.dropTarget(),[e])}class Zu{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;this.handlerId&&(t?e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions)):this.lastConnectedDropTarget=t)}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!Fu(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=Wu({dropTarget:(e,t)=>{this.clearDropTarget(),this.dropTargetOptions=t,Uu(e)?this.dropTargetRef=e:this.dropTargetNode=e,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}let eh=!1;class th{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;Iu(!eh,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return eh=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{eh=!1}}isOver(e){return!!this.targetId&&this.internalMonitor.isOverTarget(this.targetId,e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}class rh{canDrop(){const e=this.spec,t=this.monitor;return!e.canDrop||e.canDrop(t.getItem(),t)}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function nh(e,t,r){const n=qu(),s=function(e,t){const r=(0,o.useMemo)(()=>new rh(e,t),[t]);return(0,o.useEffect)(()=>{r.spec=e},[e]),r}(e,t),a=function(e){const{accept:t}=e;return(0,o.useMemo)(()=>(Iu(null!=e.accept,"accept must be defined"),Array.isArray(t)?t:[t]),[t])}(e);Du(function(){const[e,o]=function(e,t,r){const n=r.getRegistry(),s=n.addTarget(e,t);return[s,()=>n.removeTarget(s)]}(a,s,n);return t.receiveHandlerId(e),r.receiveHandlerId(e),o},[n,t,s,r,a.map(e=>e.toString()).join("|")])}function sh(e,t){const r=Ou(e,t),n=function(){const e=qu();return(0,o.useMemo)(()=>new th(e),[e])}(),s=function(e){const t=qu(),r=(0,o.useMemo)(()=>new Zu(t.getBackend()),[t]);return Du(()=>(r.dropTargetOptions=e||null,r.reconnect(),()=>r.disconnectDropTarget()),[e]),r}(r.options);return nh(r,n,s),[_u(r.collect,n,s),$u(s)]}function ah(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var oh="function"===typeof Symbol&&Symbol.observable||"@@observable",ih=function(){return Math.random().toString(36).substring(7).split("").join(".")},lh={INIT:"@@redux/INIT"+ih(),REPLACE:"@@redux/REPLACE"+ih(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ih()}};function ch(e){if("object"!==typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function dh(e,t,r){var n;if("function"===typeof t&&"function"===typeof r||"function"===typeof r&&"function"===typeof arguments[3])throw new Error(ah(0));if("function"===typeof t&&"undefined"===typeof r&&(r=t,t=void 0),"undefined"!==typeof r){if("function"!==typeof r)throw new Error(ah(1));return r(dh)(e,t)}if("function"!==typeof e)throw new Error(ah(2));var s=e,a=t,o=[],i=o,l=!1;function c(){i===o&&(i=o.slice())}function d(){if(l)throw new Error(ah(3));return a}function u(e){if("function"!==typeof e)throw new Error(ah(4));if(l)throw new Error(ah(5));var t=!0;return c(),i.push(e),function(){if(t){if(l)throw new Error(ah(6));t=!1,c();var r=i.indexOf(e);i.splice(r,1),o=null}}}function h(e){if(!ch(e))throw new Error(ah(7));if("undefined"===typeof e.type)throw new Error(ah(8));if(l)throw new Error(ah(9));try{l=!0,a=s(a,e)}finally{l=!1}for(var t=o=i,r=0;r<t.length;r++){(0,t[r])()}return e}return h({type:lh.INIT}),(n={dispatch:h,subscribe:u,getState:d,replaceReducer:function(e){if("function"!==typeof e)throw new Error(ah(10));s=e,h({type:lh.REPLACE})}})[oh]=function(){var e,t=u;return(e={subscribe:function(e){if("object"!==typeof e||null===e)throw new Error(ah(11));function r(){e.next&&e.next(d())}return r(),{unsubscribe:t(r)}}})[oh]=function(){return this},e},n}function uh(e){return"object"===typeof e}const hh="dnd-core/INIT_COORDS",mh="dnd-core/BEGIN_DRAG",ph="dnd-core/PUBLISH_DRAG_SOURCE",gh="dnd-core/HOVER",fh="dnd-core/DROP",xh="dnd-core/END_DRAG";function vh(e,t){return{type:hh,payload:{sourceClientOffset:t||null,clientOffset:e||null}}}const yh={type:hh,payload:{clientOffset:null,sourceClientOffset:null}};function bh(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{publishSource:!0};const{publishSource:n=!0,clientOffset:s,getSourceClientOffset:a}=r,o=e.getMonitor(),i=e.getRegistry();e.dispatch(vh(s)),function(e,t,r){Iu(!t.isDragging(),"Cannot call beginDrag while dragging."),e.forEach(function(e){Iu(r.getSource(e),"Expected sourceIds to be registered.")})}(t,o,i);const l=function(e,t){let r=null;for(let n=e.length-1;n>=0;n--)if(t.canDragSource(e[n])){r=e[n];break}return r}(t,o);if(null==l)return void e.dispatch(yh);let c=null;if(s){if(!a)throw new Error("getSourceClientOffset must be defined");!function(e){Iu("function"===typeof e,"When clientOffset is provided, getSourceClientOffset must be a function.")}(a),c=a(l)}e.dispatch(vh(s,c));const d=i.getSource(l).beginDrag(o,l);if(null==d)return;!function(e){Iu(uh(e),"Item must be an object.")}(d),i.pinSource(l);const u=i.getSourceType(l);return{type:mh,payload:{itemType:u,item:d,sourceId:l,clientOffset:s||null,sourceClientOffset:c||null,isSourcePublic:!!n}}}}function wh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){wh(e,t,r[t])})}return e}function Nh(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=e.getMonitor(),n=e.getRegistry();!function(e){Iu(e.isDragging(),"Cannot call drop while not dragging."),Iu(!e.didDrop(),"Cannot call drop twice during one drag operation.")}(r);const s=function(e){const t=e.getTargetIds().filter(e.canDropOnTarget,e);return t.reverse(),t}(r);s.forEach((s,a)=>{const o=function(e,t,r,n){const s=r.getTarget(e);let a=s?s.drop(n,e):void 0;(function(e){Iu("undefined"===typeof e||uh(e),"Drop result must either be an object or undefined.")})(a),"undefined"===typeof a&&(a=0===t?{}:n.getDropResult());return a}(s,a,n,r),i={type:fh,payload:{dropResult:jh({},t,o)}};e.dispatch(i)})}}function Sh(e){return function(){const t=e.getMonitor(),r=e.getRegistry();!function(e){Iu(e.isDragging(),"Cannot call endDrag while not dragging.")}(t);const n=t.getSourceId();if(null!=n){r.getSource(n,!0).endDrag(t,n),r.unpinSource()}return{type:xh}}}function kh(e,t){return null===t?null===e:Array.isArray(e)?e.some(e=>e===t):e===t}function Ah(e){return function(t){let{clientOffset:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e){Iu(Array.isArray(e),"Expected targetIds to be an array.")}(t);const n=t.slice(0),s=e.getMonitor(),a=e.getRegistry();return function(e,t,r){for(let n=e.length-1;n>=0;n--){const s=e[n];kh(t.getTargetType(s),r)||e.splice(n,1)}}(n,a,s.getItemType()),function(e,t,r){Iu(t.isDragging(),"Cannot call hover while not dragging."),Iu(!t.didDrop(),"Cannot call hover after drop.");for(let n=0;n<e.length;n++){const t=e[n];Iu(e.lastIndexOf(t)===n,"Expected targetIds to be unique in the passed array.");Iu(r.getTarget(t),"Expected targetIds to be registered.")}}(n,s,a),function(e,t,r){e.forEach(function(e){r.getTarget(e).hover(t,e)})}(n,s,a),{type:gh,payload:{targetIds:n,clientOffset:r||null}}}}function Ch(e){return function(){if(e.getMonitor().isDragging())return{type:ph}}}class Eh{receiveBackend(e){this.backend=e}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){const e=this,{dispatch:t}=this.store;const r=function(e){return{beginDrag:bh(e),publishDragSource:Ch(e),hover:Ah(e),drop:Nh(e),endDrag:Sh(e)}}(this);return Object.keys(r).reduce((n,s)=>{const a=r[s];var o;return n[s]=(o=a,function(){for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];const a=o.apply(e,n);"undefined"!==typeof a&&t(a)}),n},{})}dispatch(e){this.store.dispatch(e)}constructor(e,t){this.isSetUp=!1,this.handleRefCountChange=()=>{const e=this.store.getState().refCount>0;this.backend&&(e&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!e&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=e,this.monitor=t,e.subscribe(this.handleRefCountChange)}}function Ph(e,t){return{x:e.x-t.x,y:e.y-t.y}}const Ih=[],Th=[];Ih.__IS_NONE__=!0,Th.__IS_ALL__=!0;class Dh{subscribeToStateChange(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{handlerIds:r}=t;Iu("function"===typeof e,"listener must be a function."),Iu("undefined"===typeof r||Array.isArray(r),"handlerIds, when specified, must be an array of strings.");let n=this.store.getState().stateId;return this.store.subscribe(()=>{const t=this.store.getState(),s=t.stateId;try{const a=s===n||s===n+1&&!function(e,t){if(e===Ih)return!1;if(e===Th||"undefined"===typeof t)return!0;const r=(n=e,t.filter(e=>n.indexOf(e)>-1));var n;return r.length>0}(t.dirtyHandlerIds,r);a||e()}finally{n=s}})}subscribeToOffsetChange(e){Iu("function"===typeof e,"listener must be a function.");let t=this.store.getState().dragOffset;return this.store.subscribe(()=>{const r=this.store.getState().dragOffset;r!==t&&(t=r,e())})}canDragSource(e){if(!e)return!1;const t=this.registry.getSource(e);return Iu(t,"Expected to find a valid source. sourceId=".concat(e)),!this.isDragging()&&t.canDrag(this,e)}canDropOnTarget(e){if(!e)return!1;const t=this.registry.getTarget(e);if(Iu(t,"Expected to find a valid target. targetId=".concat(e)),!this.isDragging()||this.didDrop())return!1;return kh(this.registry.getTargetType(e),this.getItemType())&&t.canDrop(this,e)}isDragging(){return Boolean(this.getItemType())}isDraggingSource(e){if(!e)return!1;const t=this.registry.getSource(e,!0);if(Iu(t,"Expected to find a valid source. sourceId=".concat(e)),!this.isDragging()||!this.isSourcePublic())return!1;return this.registry.getSourceType(e)===this.getItemType()&&t.isDragging(this,e)}isOverTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shallow:!1};if(!e)return!1;const{shallow:r}=t;if(!this.isDragging())return!1;const n=this.registry.getTargetType(e),s=this.getItemType();if(s&&!kh(n,s))return!1;const a=this.getTargetIds();if(!a.length)return!1;const o=a.indexOf(e);return r?o===a.length-1:o>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return Boolean(this.store.getState().dragOperation.isSourcePublic)}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return function(e){const{clientOffset:t,initialClientOffset:r,initialSourceClientOffset:n}=e;return t&&r&&n?Ph(function(e,t){return{x:e.x+t.x,y:e.y+t.y}}(t,n),r):null}(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return function(e){const{clientOffset:t,initialClientOffset:r}=e;return t&&r?Ph(t,r):null}(this.store.getState().dragOffset)}constructor(e,t){this.store=e,this.registry=t}}const Mh="undefined"!==typeof global?global:self,_h=Mh.MutationObserver||Mh.WebKitMutationObserver;function Oh(e){return function(){const t=setTimeout(n,0),r=setInterval(n,50);function n(){clearTimeout(t),clearInterval(r),e()}}}const Lh="function"===typeof _h?function(e){let t=1;const r=new _h(e),n=document.createTextNode("");return r.observe(n,{characterData:!0}),function(){t=-t,n.data=t}}:Oh;class Rh{call(){try{this.task&&this.task()}catch(e){this.onError(e)}finally{this.task=null,this.release(this)}}constructor(e,t){this.onError=e,this.release=t,this.task=null}}const Fh=new class{enqueueTask(e){const{queue:t,requestFlush:r}=this;t.length||(r(),this.flushing=!0),t[t.length]=e}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{const{queue:e}=this;for(;this.index<e.length;){const t=this.index;if(this.index++,e[t].call(),this.index>this.capacity){for(let t=0,r=e.length-this.index;t<r;t++)e[t]=e[t+this.index];e.length-=this.index,this.index=0}}e.length=0,this.index=0,this.flushing=!1},this.registerPendingError=e=>{this.pendingErrors.push(e),this.requestErrorThrow()},this.requestFlush=Lh(this.flush),this.requestErrorThrow=Oh(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}},Uh=new class{create(e){const t=this.freeTasks,r=t.length?t.pop():new Rh(this.onError,e=>t[t.length]=e);return r.task=e,r}constructor(e){this.onError=e,this.freeTasks=[]}}(Fh.registerPendingError);const Bh="dnd-core/ADD_SOURCE",Wh="dnd-core/ADD_TARGET",zh="dnd-core/REMOVE_SOURCE",Vh="dnd-core/REMOVE_TARGET";function Hh(e,t){t&&Array.isArray(e)?e.forEach(e=>Hh(e,!1)):Iu("string"===typeof e||"symbol"===typeof e,t?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}var qh;!function(e){e.SOURCE="SOURCE",e.TARGET="TARGET"}(qh||(qh={}));let Kh=0;function Gh(e){const t=(Kh++).toString();switch(e){case qh.SOURCE:return"S".concat(t);case qh.TARGET:return"T".concat(t);default:throw new Error("Unknown Handler Role: ".concat(e))}}function Jh(e){switch(e[0]){case"S":return qh.SOURCE;case"T":return qh.TARGET;default:throw new Error("Cannot parse handler ID: ".concat(e))}}function Yh(e,t){const r=e.entries();let n=!1;do{const{done:e,value:[,s]}=r.next();if(s===t)return!0;n=!!e}while(!n);return!1}class Qh{addSource(e,t){Hh(e),function(e){Iu("function"===typeof e.canDrag,"Expected canDrag to be a function."),Iu("function"===typeof e.beginDrag,"Expected beginDrag to be a function."),Iu("function"===typeof e.endDrag,"Expected endDrag to be a function.")}(t);const r=this.addHandler(qh.SOURCE,e,t);return this.store.dispatch(function(e){return{type:Bh,payload:{sourceId:e}}}(r)),r}addTarget(e,t){Hh(e,!0),function(e){Iu("function"===typeof e.canDrop,"Expected canDrop to be a function."),Iu("function"===typeof e.hover,"Expected hover to be a function."),Iu("function"===typeof e.drop,"Expected beginDrag to be a function.")}(t);const r=this.addHandler(qh.TARGET,e,t);return this.store.dispatch(function(e){return{type:Wh,payload:{targetId:e}}}(r)),r}containsHandler(e){return Yh(this.dragSources,e)||Yh(this.dropTargets,e)}getSource(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Iu(this.isSourceId(e),"Expected a valid source ID.");return t&&e===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(e)}getTarget(e){return Iu(this.isTargetId(e),"Expected a valid target ID."),this.dropTargets.get(e)}getSourceType(e){return Iu(this.isSourceId(e),"Expected a valid source ID."),this.types.get(e)}getTargetType(e){return Iu(this.isTargetId(e),"Expected a valid target ID."),this.types.get(e)}isSourceId(e){return Jh(e)===qh.SOURCE}isTargetId(e){return Jh(e)===qh.TARGET}removeSource(e){var t;Iu(this.getSource(e),"Expected an existing source."),this.store.dispatch(function(e){return{type:zh,payload:{sourceId:e}}}(e)),t=()=>{this.dragSources.delete(e),this.types.delete(e)},Fh.enqueueTask(Uh.create(t))}removeTarget(e){Iu(this.getTarget(e),"Expected an existing target."),this.store.dispatch(function(e){return{type:Vh,payload:{targetId:e}}}(e)),this.dropTargets.delete(e),this.types.delete(e)}pinSource(e){const t=this.getSource(e);Iu(t,"Expected an existing source."),this.pinnedSourceId=e,this.pinnedSource=t}unpinSource(){Iu(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(e,t,r){const n=Gh(e);return this.types.set(n,t),e===qh.SOURCE?this.dragSources.set(n,r):e===qh.TARGET&&this.dropTargets.set(n,r),n}constructor(e){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=e}}const Xh=(e,t)=>e===t;function $h(){let e=arguments.length>1?arguments[1]:void 0;switch(e.type){case gh:break;case Bh:case Wh:case Vh:case zh:return Ih;default:return Th}const{targetIds:t=[],prevTargetIds:r=[]}=e.payload,n=function(e,t){const r=new Map,n=e=>{r.set(e,r.has(e)?r.get(e)+1:1)};e.forEach(n),t.forEach(n);const s=[];return r.forEach((e,t)=>{1===e&&s.push(t)}),s}(t,r),s=n.length>0||!function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xh;if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!r(e[n],t[n]))return!1;return!0}(t,r);if(!s)return Ih;const a=r[r.length-1],o=t[t.length-1];return a!==o&&(a&&n.push(a),o&&n.push(o)),n}function Zh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const em={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function tm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:em,t=arguments.length>1?arguments[1]:void 0;const{payload:r}=t;switch(t.type){case hh:case mh:return{initialSourceClientOffset:r.sourceClientOffset,initialClientOffset:r.clientOffset,clientOffset:r.clientOffset};case gh:return n=e.clientOffset,s=r.clientOffset,!n&&!s||n&&s&&n.x===s.x&&n.y===s.y?e:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Zh(e,t,r[t])})}return e}({},e,{clientOffset:r.clientOffset});case xh:case fh:return em;default:return e}var n,s}function rm(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nm(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){rm(e,t,r[t])})}return e}const sm={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function am(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sm,t=arguments.length>1?arguments[1]:void 0;const{payload:r}=t;switch(t.type){case mh:return nm({},e,{itemType:r.itemType,item:r.item,sourceId:r.sourceId,isSourcePublic:r.isSourcePublic,dropResult:null,didDrop:!1});case ph:return nm({},e,{isSourcePublic:!0});case gh:return nm({},e,{targetIds:r.targetIds});case Vh:return-1===e.targetIds.indexOf(r.targetId)?e:nm({},e,{targetIds:(n=e.targetIds,s=r.targetId,n.filter(e=>e!==s))});case fh:return nm({},e,{dropResult:r.dropResult,didDrop:!0,targetIds:[]});case xh:return nm({},e,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return e}var n,s}function om(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch((arguments.length>1?arguments[1]:void 0).type){case Bh:case Wh:return e+1;case zh:case Vh:return e-1;default:return e}}function im(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)+1}function lm(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cm(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){lm(e,t,r[t])})}return e}function dm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return{dirtyHandlerIds:$h(e.dirtyHandlerIds,{type:t.type,payload:cm({},t.payload,{prevTargetIds:(r=e,n="dragOperation.targetIds",s=[],n.split(".").reduce((e,t)=>e&&e[t]?e[t]:s||null,r))})}),dragOffset:tm(e.dragOffset,t),refCount:om(e.refCount,t),dragOperation:am(e.dragOperation,t),stateId:im(e.stateId)};var r,n,s}function um(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=function(e){const t="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__;return dh(dm,e&&t&&t({name:"dnd-core",instanceId:"dnd-core"}))}(arguments.length>3&&void 0!==arguments[3]&&arguments[3]),s=new Dh(n,new Qh(n)),a=new Eh(n,s),o=e(a,t,r);return a.receiveBackend(o),a}function hm(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r,n,s={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}let mm=0;const pm=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var gm=(0,o.memo)(function(e){var{children:t}=e,r=hm(e,["children"]);const[n,s]=function(e){if("manager"in e){return[{dragDropManager:e.manager},!1]}const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fm(),r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const s=t;s[pm]||(s[pm]={dragDropManager:um(e,t,r,n)});return s[pm]}(e.backend,e.context,e.options,e.debugMode),r=!e.context;return[t,r]}(r);return(0,o.useEffect)(()=>{if(s){const e=fm();return++mm,()=>{0===--mm&&(e[pm]=null)}}},[]),(0,kt.jsx)(Hu.Provider,{value:n,children:t})});function fm(){return"undefined"!==typeof global?global:window}function xm(e){let t=null;return()=>(null==t&&(t=e()),t)}class vm{enter(e){const t=this.entered.length;return this.entered=function(e,t){const r=new Set,n=e=>r.add(e);e.forEach(n),t.forEach(n);const s=[];return r.forEach(e=>s.push(e)),s}(this.entered.filter(t=>this.isNodeInDocument(t)&&(!t.contains||t.contains(e))),[e]),0===t&&this.entered.length>0}leave(e){const t=this.entered.length;var r,n;return this.entered=(r=this.entered.filter(this.isNodeInDocument),n=e,r.filter(e=>e!==n)),t>0&&0===this.entered.length}reset(){this.entered=[]}constructor(e){this.entered=[],this.isNodeInDocument=e}}class ym{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(e=>{Object.defineProperty(this.item,e,{configurable:!0,enumerable:!0,get:()=>(console.warn("Browser doesn't allow reading \"".concat(e,'" until the drop event.')),null)})})}loadDataTransfer(e){if(e){const t={};Object.keys(this.config.exposeProperties).forEach(r=>{const n=this.config.exposeProperties[r];null!=n&&(t[r]={value:n(e,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,t)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(e,t){return t===e.getSourceId()}endDrag(){}constructor(e){this.config=e,this.item={},this.initializeExposedProperties()}}const bm="__NATIVE_FILE__",wm="__NATIVE_URL__",jm="__NATIVE_TEXT__",Nm="__NATIVE_HTML__";function Sm(e,t,r){const n=t.reduce((t,r)=>t||e.getData(r),"");return null!=n?n:r}const km={[bm]:{exposeProperties:{files:e=>Array.prototype.slice.call(e.files),items:e=>e.items,dataTransfer:e=>e},matchesTypes:["Files"]},[Nm]:{exposeProperties:{html:(e,t)=>Sm(e,t,""),dataTransfer:e=>e},matchesTypes:["Html","text/html"]},[wm]:{exposeProperties:{urls:(e,t)=>Sm(e,t,"").split("\n"),dataTransfer:e=>e},matchesTypes:["Url","text/uri-list"]},[jm]:{exposeProperties:{text:(e,t)=>Sm(e,t,""),dataTransfer:e=>e},matchesTypes:["Text","text/plain"]}};function Am(e){if(!e)return null;const t=Array.prototype.slice.call(e.types||[]);return Object.keys(km).filter(e=>{const r=km[e];return!!(null===r||void 0===r?void 0:r.matchesTypes)&&r.matchesTypes.some(e=>t.indexOf(e)>-1)})[0]||null}const Cm=xm(()=>/firefox/i.test(navigator.userAgent)),Em=xm(()=>Boolean(window.safari));class Pm{interpolate(e){const{xs:t,ys:r,c1s:n,c2s:s,c3s:a}=this;let o=t.length-1;if(e===t[o])return r[o];let i,l=0,c=a.length-1;for(;l<=c;){i=Math.floor(.5*(l+c));const n=t[i];if(n<e)l=i+1;else{if(!(n>e))return r[i];c=i-1}}o=Math.max(0,c);const d=e-t[o],u=d*d;return r[o]+n[o]*d+s[o]*u+a[o]*d*u}constructor(e,t){const{length:r}=e,n=[];for(let m=0;m<r;m++)n.push(m);n.sort((t,r)=>e[t]<e[r]?-1:1);const s=[],a=[],o=[];let i,l;for(let m=0;m<r-1;m++)i=e[m+1]-e[m],l=t[m+1]-t[m],a.push(i),s.push(l),o.push(l/i);const c=[o[0]];for(let m=0;m<a.length-1;m++){const e=o[m],t=o[m+1];if(e*t<=0)c.push(0);else{i=a[m];const r=a[m+1],n=i+r;c.push(3*n/((n+r)/e+(n+i)/t))}}c.push(o[o.length-1]);const d=[],u=[];let h;for(let m=0;m<c.length-1;m++){h=o[m];const e=c[m],t=1/a[m],r=e+c[m+1]-h-h;d.push((h-e-r)*t),u.push(r*t*t)}this.xs=e,this.ys=t,this.c1s=c,this.c2s=d,this.c3s=u}}function Im(e){const t=1===e.nodeType?e:e.parentElement;if(!t)return null;const{top:r,left:n}=t.getBoundingClientRect();return{x:n,y:r}}function Tm(e){return{x:e.clientX,y:e.clientY}}function Dm(e,t,r,n,s){const a=function(e){var t;return"IMG"===e.nodeName&&(Cm()||!(null===(t=document.documentElement)||void 0===t?void 0:t.contains(e)))}(t),o=Im(a?e:t),i={x:r.x-o.x,y:r.y-o.y},{offsetWidth:l,offsetHeight:c}=e,{anchorX:d,anchorY:u}=n,{dragPreviewWidth:h,dragPreviewHeight:m}=function(e,t,r,n){let s=e?t.width:r,a=e?t.height:n;return Em()&&e&&(a/=window.devicePixelRatio,s/=window.devicePixelRatio),{dragPreviewWidth:s,dragPreviewHeight:a}}(a,t,l,c),{offsetX:p,offsetY:g}=s,f=0===g||g;return{x:0===p||p?p:new Pm([0,.5,1],[i.x,i.x/l*h,i.x+h-l]).interpolate(d),y:f?g:(()=>{let e=new Pm([0,.5,1],[i.y,i.y/c*m,i.y+m-c]).interpolate(u);return Em()&&a&&(e+=(window.devicePixelRatio-1)*m),e})()}}class Mm{get window(){return this.globalContext?this.globalContext:"undefined"!==typeof window?window:void 0}get document(){var e;return(null===(e=this.globalContext)||void 0===e?void 0:e.document)?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var e;return(null===(e=this.optionsArgs)||void 0===e?void 0:e.rootElement)||this.window}constructor(e,t){this.ownerDocument=null,this.globalContext=e,this.optionsArgs=t}}function _m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Om(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_m(e,t,r[t])})}return e}class Lm{profile(){var e,t;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:(null===(e=this.dragStartSourceIds)||void 0===e?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:(null===(t=this.dragOverTargetIds)||void 0===t?void 0:t.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){const e=this.rootElement;if(void 0!==e){if(e.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}teardown(){const e=this.rootElement;var t;void 0!==e&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId&&(null===(t=this.window)||void 0===t||t.cancelAnimationFrame(this.asyncEndDragFrameId)))}connectDragPreview(e,t,r){return this.sourcePreviewNodeOptions.set(e,r),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDragSource(e,t,r){this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,r);const n=t=>this.handleDragStart(t,e),s=e=>this.handleSelectStart(e);return t.setAttribute("draggable","true"),t.addEventListener("dragstart",n),t.addEventListener("selectstart",s),()=>{this.sourceNodes.delete(e),this.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",n),t.removeEventListener("selectstart",s),t.setAttribute("draggable","false")}}connectDropTarget(e,t){const r=t=>this.handleDragEnter(t,e),n=t=>this.handleDragOver(t,e),s=t=>this.handleDrop(t,e);return t.addEventListener("dragenter",r),t.addEventListener("dragover",n),t.addEventListener("drop",s),()=>{t.removeEventListener("dragenter",r),t.removeEventListener("dragover",n),t.removeEventListener("drop",s)}}addEventListeners(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return Om({dropEffect:this.altKeyPressed?"copy":"move"},t||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const e=this.monitor.getSourceId();return Om({anchorX:.5,anchorY:.5,captureDraggingState:!1},this.sourcePreviewNodeOptions.get(e)||{})}isDraggingNativeItem(){const e=this.monitor.getItemType();return Object.keys(s).some(t=>s[t]===e)}beginDragNativeItem(e,t){this.clearCurrentDragSourceNode(),this.currentNativeSource=function(e,t){const r=km[e];if(!r)throw new Error("native type ".concat(e," has no configuration"));const n=new ym(r);return n.loadDataTransfer(t),n}(e,t),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(e){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;this.mouseMoveTimeoutTimer=setTimeout(()=>{var e;return null===(e=this.rootElement)||void 0===e?void 0:e.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},1e3)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){var e;if(this.currentDragSourceNode=null,this.rootElement)null===(e=this.window)||void 0===e||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0);return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(e,t){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t))}handleDragEnter(e,t){this.dragEnterTargetIds.unshift(t)}handleDragOver(e,t){null===this.dragOverTargetIds&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)}handleDrop(e,t){this.dropTargetIds.unshift(t)}constructor(e,t,r){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=e=>{const t=this.sourceNodes.get(e);return t&&Im(t)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=e=>Boolean(e&&this.document&&this.document.body&&this.document.body.contains(e)),this.endDragIfSourceWasRemovedFromDOM=()=>{const e=this.currentDragSourceNode;null==e||this.isNodeInDocument(e)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=e=>{null===this.hoverRafId&&"undefined"!==typeof requestAnimationFrame&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(e||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{null!==this.hoverRafId&&"undefined"!==typeof cancelAnimationFrame&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=e=>{if(e.defaultPrevented)return;const{dragStartSourceIds:t}=this;this.dragStartSourceIds=null;const r=Tm(e);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(t||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:r});const{dataTransfer:n}=e,s=Am(n);if(this.monitor.isDragging()){if(n&&"function"===typeof n.setDragImage){const e=this.monitor.getSourceId(),t=this.sourceNodes.get(e),s=this.sourcePreviewNodes.get(e)||t;if(s){const{anchorX:e,anchorY:a,offsetX:o,offsetY:i}=this.getCurrentSourcePreviewNodeOptions(),l=Dm(t,s,r,{anchorX:e,anchorY:a},{offsetX:o,offsetY:i});n.setDragImage(s,l.x,l.y)}}try{null===n||void 0===n||n.setData("application/json",{})}catch(ES){}this.setCurrentDragSourceNode(e.target);const{captureDraggingState:t}=this.getCurrentSourcePreviewNodeOptions();t?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(s)this.beginDragNativeItem(s);else{if(n&&!n.types&&(e.target&&!e.target.hasAttribute||!e.target.hasAttribute("draggable")))return;e.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=e=>{var t;(this.dragEnterTargetIds=[],this.isDraggingNativeItem())&&(null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer));if(!this.enterLeaveCounter.enter(e.target)||this.monitor.isDragging())return;const{dataTransfer:r}=e,n=Am(r);n&&this.beginDragNativeItem(n,r)},this.handleTopDragEnter=e=>{const{dragEnterTargetIds:t}=this;if(this.dragEnterTargetIds=[],!this.monitor.isDragging())return;this.altKeyPressed=e.altKey,t.length>0&&this.actions.hover(t,{clientOffset:Tm(e)});t.some(e=>this.monitor.canDropOnTarget(e))&&(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect()))},this.handleTopDragOverCapture=e=>{var t;(this.dragOverTargetIds=[],this.isDraggingNativeItem())&&(null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer))},this.handleTopDragOver=e=>{const{dragOverTargetIds:t}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging())return e.preventDefault(),void(e.dataTransfer&&(e.dataTransfer.dropEffect="none"));this.altKeyPressed=e.altKey,this.lastClientOffset=Tm(e),this.scheduleHover(t);(t||[]).some(e=>this.monitor.canDropOnTarget(e))?(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?e.preventDefault():(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=e=>{this.isDraggingNativeItem()&&e.preventDefault();this.enterLeaveCounter.leave(e.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=e=>{var t;(this.dropTargetIds=[],this.isDraggingNativeItem())?(e.preventDefault(),null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer)):Am(e.dataTransfer)&&e.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=e=>{const{dropTargetIds:t}=this;this.dropTargetIds=[],this.actions.hover(t,{clientOffset:Tm(e)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=e=>{const t=e.target;"function"===typeof t.dragDrop&&("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||(e.preventDefault(),t.dragDrop()))},this.options=new Mm(t,r),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.enterLeaveCounter=new vm(this.isNodeInDocument)}}const Rm=function(e,t,r){return new Lm(e,t,r)},Fm="user",Um=e=>{var t,r;let{user:n,isAssigned:s=!1,onRemove:a=null,colorMode:o,sourceRole:i=null}=e;const[{isDragging:l},c]=Xu({type:Fm,item:()=>({user:n,isAssigned:s,sourceRole:i}),collect:e=>({isDragging:e.isDragging()})});return(0,kt.jsxs)("div",{ref:c,className:"\n        flex items-center justify-between p-2 rounded cursor-move transition-all duration-200\n        ".concat(l?"opacity-50 scale-95":"opacity-100","\n        ").concat(s?o?"bg-[#232b4d] border border-gray-600 text-white":"bg-white border border-gray-300 text-gray-800":o?"bg-[#232b4d] border border-gray-600 text-white hover:bg-[#2a3555]":"bg-white border border-gray-300 text-gray-800 hover:bg-gray-50","\n        hover:shadow-sm\n      "),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold ".concat(o?"bg-[var(--color-primary-blueprint-blue)] text-white":"bg-blue-500 text-white"),children:(null===(t=n.firstName)||void 0===t?void 0:t[0])||(null===(r=n.name)||void 0===r?void 0:r[0])||"?"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-sm",children:n.firstName&&n.lastName?"".concat(n.firstName," ").concat(n.lastName):n.name}),n.email&&(0,kt.jsx)("div",{className:"text-xs ".concat(o?"text-gray-400":"text-gray-500"),children:n.email})]})]}),(0,kt.jsx)("div",{className:"px-2 py-1 rounded text-xs font-medium ".concat(o?"text-gray-400":"text-gray-500"),children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16"})})}),s&&a&&(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),a(n.id)},className:"w-6 h-6 rounded-full flex items-center justify-center text-xs hover:scale-110 transition-transform ".concat(o?"bg-red-900/50 text-red-300 hover:bg-red-800":"bg-red-100 text-red-600 hover:bg-red-200"),children:"\xd7"})]})},Bm=e=>{let{roleType:t,roleName:r,icon:n,colorScheme:s,users:a,onAddUser:o,onRemoveUser:i,colorMode:l}=e;const[{isOver:c,canDrop:d},u]=sh({accept:Fm,drop:e=>{e.sourceRole!==t&&o(t,e.user,e.sourceRole)},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})}),h=(e=>{const t={purple:{bg:l?"bg-[#232b4d]":"bg-white",border:l?"border-gray-600":"border-gray-300",hoverBg:l?"bg-[#2a3555]":"bg-gray-50",hoverBorder:"border-purple-400",text:l?"text-white":"text-gray-900",subtext:l?"text-gray-300":"text-gray-600",accent:"purple"},orange:{bg:l?"bg-[#232b4d]":"bg-white",border:l?"border-gray-600":"border-gray-300",hoverBg:l?"bg-[#2a3555]":"bg-gray-50",hoverBorder:"border-orange-400",text:l?"text-white":"text-gray-900",subtext:l?"text-gray-300":"text-gray-600",accent:"orange"},green:{bg:l?"bg-[#232b4d]":"bg-white",border:l?"border-gray-600":"border-gray-300",hoverBg:l?"bg-[#2a3555]":"bg-gray-50",hoverBorder:"border-green-400",text:l?"text-white":"text-gray-900",subtext:l?"text-gray-300":"text-gray-600",accent:"green"},red:{bg:l?"bg-[#232b4d]":"bg-white",border:l?"border-gray-600":"border-gray-300",hoverBg:l?"bg-[#2a3555]":"bg-gray-50",hoverBorder:"border-red-400",text:l?"text-white":"text-gray-900",subtext:l?"text-gray-300":"text-gray-600",accent:"red"},teal:{bg:l?"bg-[#232b4d]":"bg-white",border:l?"border-gray-600":"border-gray-300",hoverBg:l?"bg-[#2a3555]":"bg-gray-50",hoverBorder:"border-teal-400",text:l?"text-white":"text-gray-900",subtext:l?"text-gray-300":"text-gray-600",accent:"teal"}};return t[e]||t.purple})(s);return(0,kt.jsxs)("div",{ref:u,className:"\n        border border-dashed rounded-lg p-3 min-h-[120px] transition-all duration-200 shadow-sm\n        ".concat(c&&d?"".concat(h.hoverBg," ").concat(h.hoverBorder," shadow-md"):"".concat(h.bg," ").concat(h.border),"\n      "),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,kt.jsx)("span",{className:"text-lg",children:n}),(0,kt.jsx)("h4",{className:"font-semibold text-sm ".concat(h.text),children:r}),(0,kt.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded-full ".concat(l?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-600"),children:a.length})]}),(0,kt.jsx)("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:a.length>0?a.map(e=>{var r,n;return(0,kt.jsxs)("div",{className:"flex items-center justify-between p-1.5 rounded text-xs border ".concat(l?"bg-[#232b4d] border-gray-600":"bg-white border-gray-300"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,kt.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-xs font-semibold ".concat(l?"bg-[var(--color-primary-blueprint-blue)] text-white":"bg-blue-500 text-white"),children:(null===(r=e.firstName)||void 0===r?void 0:r[0])||(null===(n=e.name)||void 0===n?void 0:n[0])||"?"}),(0,kt.jsx)("span",{className:"font-medium text-xs truncate",children:e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.name})]}),(0,kt.jsx)("button",{onClick:()=>i(t,e.id),className:"w-4 h-4 rounded-full flex items-center justify-center text-xs hover:scale-110 transition-transform ".concat(l?"bg-red-900/50 text-red-300 hover:bg-red-800":"bg-red-100 text-red-600 hover:bg-red-200"),children:"\xd7"})]},e.id)}):(0,kt.jsxs)("div",{className:"\n            text-center py-3 text-xs rounded border border-dashed\n            ".concat(l?"text-gray-400 border-gray-600":"text-gray-500 border-gray-300","\n          "),children:[(0,kt.jsx)("div",{className:"mb-1 text-sm",children:"\ud83d\udc64"}),"Drop users here"]})})]})},Wm=e=>{let{colorMode:t,roleAssignments:r,setRoleAssignments:n,availableUsers:s,saveRoleAssignments:a}=e;const[i,l]=(0,o.useState)(""),c=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{l("Saving...");let o=(0,Y.A)({},r);s&&s!==e&&(o[s]=(o[s]||[]).filter(e=>e.id!==t.id)),o[e]||(o[e]=[]),o[e].find(e=>e.id===t.id)||(o[e]=[...o[e],t]),n(o),await a(o);const i=u(e),c=t.firstName&&t.lastName?"".concat(t.firstName," ").concat(t.lastName):t.name;s&&s!==e?Vr.success("".concat(c," moved to ").concat(i),{duration:2e3}):Vr.success("".concat(c," assigned to ").concat(i),{duration:2e3}),l("")}catch(o){console.error("Failed to save role assignments:",o),n(r),Vr.error("Failed to assign role: ".concat(o.message||"Unknown error"),{duration:3e3}),l("")}},d=async(e,t)=>{try{const s=(r[e]||[]).find(e=>e.id===t),o=s?s.firstName&&s.lastName?"".concat(s.firstName," ").concat(s.lastName):s.name:"User",i=(0,Y.A)((0,Y.A)({},r),{},{[e]:(r[e]||[]).filter(e=>e.id!==t)});n(i),await a(i);const l=u(e);Vr.success("".concat(o," removed from ").concat(l),{duration:2e3})}catch(s){console.error("Failed to save role assignments:",s),n(r),Vr.error("Failed to remove role: ".concat(s.message||"Unknown error"),{duration:3e3})}},u=e=>({projectManager:"Project Manager",fieldDirector:"Field Director",officeStaff:"Office Staff",administration:"Administration",subcontractor:"Subcontractor",locationManager:"Location Manager"}[e]||e),h=()=>{const e=Object.values(r).flat().map(e=>e.id);return s.filter(t=>!e.includes(t.id))};return(0,kt.jsx)(gm,{backend:Rm,children:(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"border rounded-lg p-3 shadow-sm ".concat(t?"bg-[#232b4d] border-gray-600":"bg-white border-gray-300"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("h3",{className:"font-bold text-base ".concat(t?"text-white":"text-gray-900"),children:"\ud83d\udc65 Role Management"}),i&&(0,kt.jsx)("div",{className:"text-sm font-medium text-blue-600",children:i})]}),(0,kt.jsx)("p",{className:"text-xs mt-1 ".concat(t?"text-gray-300":"text-gray-600"),children:"Drag users between roles or remove them entirely."})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,kt.jsx)("div",{className:"lg:col-span-1",children:(0,kt.jsxs)("div",{className:"sticky top-4 border rounded-lg p-3 max-h-[400px] shadow-sm ".concat(t?"bg-[#232b4d] border-gray-600":"bg-white border-gray-300"),children:[(0,kt.jsxs)("h4",{className:"font-semibold text-sm mb-2 ".concat(t?"text-white":"text-gray-900"),children:["Available Users (",h().length,")"]}),(0,kt.jsx)("div",{className:"space-y-1 overflow-y-auto max-h-[300px]",children:h().map(e=>(0,kt.jsx)(Um,{user:e,colorMode:t,sourceRole:null},e.id))}),0===h().length&&(0,kt.jsxs)("div",{className:"text-center py-8 text-sm ".concat(t?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)("div",{className:"mb-2 text-2xl",children:"\u2705"}),"All users assigned"]})]})}),(0,kt.jsx)("div",{className:"lg:col-span-2",children:(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,kt.jsx)(Bm,{roleType:"projectManager",roleName:"Project Manager",icon:"\ud83c\udfaf",colorScheme:"purple",users:r.projectManager||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Bm,{roleType:"fieldDirector",roleName:"Field Director",icon:"\ud83c\udfd7\ufe0f",colorScheme:"orange",users:r.fieldDirector||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Bm,{roleType:"officeStaff",roleName:"Office Staff",icon:"\ud83d\udccb",colorScheme:"green",users:r.officeStaff||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Bm,{roleType:"administration",roleName:"Administration",icon:"\u2699\ufe0f",colorScheme:"red",users:r.administration||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Bm,{roleType:"subcontractor",roleName:"Subcontractor",icon:"\ud83d\udd28",colorScheme:"blue",users:r.subcontractor||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Bm,{roleType:"locationManager",roleName:"Location Manager",icon:"\ud83d\udccd",colorScheme:"teal",users:r.locationManager||[],onAddUser:c,onRemoveUser:d,colorMode:t})]})})]})]})})},zm=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)([]),[s,a]=(0,o.useState)({}),[i,l]=(0,o.useState)(!0),[c,d]=(0,o.useState)("all");(0,o.useEffect)(()=>{u()},[c]);const u=async()=>{try{const[e,t]=await Promise.all([fetch("/api/follow-up/tracking?status=".concat("all"===c?"":c),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),fetch("/api/follow-up/stats",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})]),[r,s]=await Promise.all([e.json(),t.json()]);r.success&&n(r.data.tracking),s.success&&a(s.data)}catch(e){console.error("Error loading follow-up data:",e)}finally{l(!1)}},h=async e=>{try{const t=await fetch("/api/follow-up/tracking/".concat(e,"/complete"),{method:"PUT",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});(await t.json()).success&&u()}catch(t){console.error("Error completing follow-up:",t)}},m=e=>{switch(e){case"PENDING":return"text-yellow-600 bg-yellow-100";case"SENT":return"text-blue-600 bg-blue-100";case"COMPLETED":return"text-green-600 bg-green-100";case"CANCELLED":default:return"text-gray-600 bg-gray-100";case"FAILED":return"text-red-600 bg-red-100"}};return i?(0,kt.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[(0,kt.jsxs)("div",{className:"p-3 rounded border ".concat(t?"bg-[#181f3a] border-[#3b82f6]":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"text-xs font-semibold ".concat(t?"text-gray-300":"text-gray-600"),children:"Total"}),(0,kt.jsx)("div",{className:"text-lg font-bold ".concat(t?"text-white":"text-gray-800"),children:s.total||0})]}),(0,kt.jsxs)("div",{className:"p-3 rounded border ".concat(t?"bg-[#181f3a] border-[#3b82f6]":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"text-xs font-semibold ".concat(t?"text-gray-300":"text-gray-600"),children:"Pending"}),(0,kt.jsx)("div",{className:"text-lg font-bold ".concat(t?"text-white":"text-gray-800"),children:s.pending||0})]}),(0,kt.jsxs)("div",{className:"p-3 rounded border ".concat(t?"bg-[#181f3a] border-[#3b82f6]":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"text-xs font-semibold ".concat(t?"text-gray-300":"text-gray-600"),children:"Completed"}),(0,kt.jsx)("div",{className:"text-lg font-bold ".concat(t?"text-white":"text-gray-800"),children:s.completed||0})]}),(0,kt.jsxs)("div",{className:"p-3 rounded border ".concat(t?"bg-[#181f3a] border-[#3b82f6]":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"text-xs font-semibold ".concat(t?"text-gray-300":"text-gray-600"),children:"Cancelled"}),(0,kt.jsx)("div",{className:"text-lg font-bold ".concat(t?"text-white":"text-gray-800"),children:s.cancelled||0})]}),(0,kt.jsxs)("div",{className:"p-3 rounded border ".concat(t?"bg-[#181f3a] border-[#3b82f6]":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"text-xs font-semibold ".concat(t?"text-gray-300":"text-gray-600"),children:"Overdue"}),(0,kt.jsx)("div",{className:"text-lg font-bold ".concat(t?"text-white":"text-gray-800"),children:s.overdue||0})]})]}),(0,kt.jsx)("div",{className:"flex gap-2",children:(0,kt.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"px-3 py-1 rounded text-sm border ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white"),children:[(0,kt.jsx)("option",{value:"all",children:"All Status"}),(0,kt.jsx)("option",{value:"PENDING",children:"Pending"}),(0,kt.jsx)("option",{value:"SENT",children:"Sent"}),(0,kt.jsx)("option",{value:"COMPLETED",children:"Completed"}),(0,kt.jsx)("option",{value:"CANCELLED",children:"Cancelled"}),(0,kt.jsx)("option",{value:"FAILED",children:"Failed"})]})}),(0,kt.jsx)("div",{className:"space-y-2",children:0===r.length?(0,kt.jsx)("div",{className:"text-center py-8 ".concat(t?"text-gray-400":"text-gray-500"),children:"No follow-ups found"}):r.map(e=>{return(0,kt.jsx)("div",{className:"p-4 rounded border ".concat(t?"bg-[#181f3a] border-[#3b82f6]":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,kt.jsx)("span",{className:"px-2 py-1 rounded text-xs font-semibold ".concat(m(e.status)),children:e.status}),(0,kt.jsx)("span",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:e.originalItemType})]}),(0,kt.jsxs)("div",{className:"text-sm ".concat(t?"text-white":"text-gray-800"),children:["Project: ",e.project.projectName," (#",e.project.projectNumber,")"]}),(0,kt.jsxs)("div",{className:"text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:["Scheduled for: ",(r=e.scheduledFor,new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]}),e.metadata&&(0,kt.jsxs)("div",{className:"text-xs mt-1 ".concat(t?"text-gray-300":"text-gray-600"),children:["TASK"===e.originalItemType&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{children:["Task: ",e.metadata.taskTitle]}),(0,kt.jsxs)("div",{children:["Priority: ",e.metadata.taskPriority]}),e.metadata.taskDueDate&&(0,kt.jsxs)("div",{children:["Due: ",new Date(e.metadata.taskDueDate).toLocaleDateString()]})]}),"WORKFLOW_ALERT"===e.originalItemType&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{children:["Alert: ",e.metadata.alertTitle]}),(0,kt.jsxs)("div",{children:["Priority: ",e.metadata.alertPriority]}),e.metadata.stepName&&(0,kt.jsxs)("div",{children:["Step: ",e.metadata.stepName]})]})]}),e.followUpMessage&&(0,kt.jsxs)("div",{className:"text-xs mt-1 ".concat(t?"text-gray-300":"text-gray-600"),children:["Follow-up Message: ",e.followUpMessage]})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:["PENDING"===e.status&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:()=>h(e.id),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"Complete"}),(0,kt.jsx)("button",{onClick:()=>(async(e,t)=>{try{const r=await fetch("/api/follow-up/tracking/".concat(e,"/cancel"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({reason:t})});(await r.json()).success&&u()}catch(r){console.error("Error cancelling follow-up:",r)}})(e.id,"User cancelled"),className:"px-3 py-1 bg-gray-600 text-white text-xs rounded hover:bg-gray-700",children:"Cancel"})]}),"SENT"===e.status&&(0,kt.jsx)("button",{onClick:()=>h(e.id),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"Mark Complete"})]})]})},e.id);var r})})]})};const Vm=new class{constructor(){this.baseURL="".concat(Ds.API_BASE_URL,"/permissions")}getAuthHeaders(){const e=localStorage.getItem("authToken")||localStorage.getItem("token");return console.log("\ud83d\udd0d PERMISSION SERVICE: Token found:",e?"Yes":"No"),{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}async getAllPermissions(){try{const e=await fetch("".concat(this.baseURL),{method:"GET",headers:this.getAuthHeaders()});if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){throw console.error("Failed to fetch permissions:",e),e}}async getRolePermissions(e){try{const t=await fetch("".concat(this.baseURL,"/role/").concat(e),{method:"GET",headers:this.getAuthHeaders()});if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(t){throw console.error("Failed to fetch permissions for role ".concat(e,":"),t),t}}async updateRolePermissions(e,t){try{const r=await fetch("".concat(this.baseURL,"/role/").concat(e),{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify({permissions:t})});if(!r.ok)throw new Error("HTTP error! status: ".concat(r.status));return await r.json()}catch(r){throw console.error("Failed to update permissions for role ".concat(e,":"),r),r}}async getUserPermissions(e){try{const t=await fetch("".concat(this.baseURL,"/user/").concat(e),{method:"GET",headers:this.getAuthHeaders()});if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(t){throw console.error("Failed to fetch permissions for user ".concat(e,":"),t),t}}async checkPermissions(e){try{const t=await fetch("".concat(this.baseURL,"/check"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify({permissions:e})});if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(t){throw console.error("Failed to check permissions:",t),t}}async getPermissionMatrix(){try{console.log("\ud83d\udd0d PERMISSION SERVICE: Fetching permission matrix...");const e=this.getAuthHeaders();console.log("\ud83d\udd0d PERMISSION SERVICE: Headers:",e);const t=await fetch("".concat(this.baseURL,"/matrix"),{method:"GET",headers:e});if(console.log("\ud83d\udd0d PERMISSION SERVICE: Response status:",t.status),!t.ok){const e=await t.text();throw console.error("\ud83d\udd0d PERMISSION SERVICE: Error response:",e),new Error("HTTP error! status: ".concat(t.status," - ").concat(e))}const r=await t.json();return console.log("\ud83d\udd0d PERMISSION SERVICE: Response data:",r),r}catch(e){throw console.error("Failed to fetch permission matrix:",e),e}}async hasPermission(e){try{var t;return(null===(t=(await this.checkPermissions([e])).data.hasPermissions[0])||void 0===t?void 0:t.hasAccess)||!1}catch(r){return console.error("Failed to check permission ".concat(e,":"),r),!1}}async hasAnyPermission(e){try{return(await this.checkPermissions(e)).data.hasPermissions.some(e=>e.hasAccess)}catch(t){return console.error("Failed to check permissions:",t),!1}}async hasAllPermissions(e){try{return(await this.checkPermissions(e)).data.hasPermissions.every(e=>e.hasAccess)}catch(t){return console.error("Failed to check permissions:",t),!1}}},Hm=Vm,qm=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)("PROJECT_MANAGER"),[s,a]=(0,o.useState)({}),[i,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(null),[m,p]=(0,o.useState)(null),[g]=(0,o.useState)(()=>new Hm),f=[{value:"PROJECT_MANAGER",label:"Project Manager",icon:"\ud83d\udc77\u200d\u2642\ufe0f",description:"Coordinate project workflows, manage timelines, and oversee project delivery",color:"bg-green-100 text-green-800 border-green-200"},{value:"FIELD_DIRECTOR",label:"Field Director",icon:"\ud83d\udd28",description:"Oversee field operations, crew management, and on-site project execution",color:"bg-orange-100 text-orange-800 border-orange-200"},{value:"OFFICE_STAFF",label:"Office Staff",icon:"\ud83d\udc77",description:"Handle customer communications, scheduling, and administrative tasks",color:"bg-blue-100 text-blue-800 border-blue-200"},{value:"ADMINISTRATION",label:"Administration",icon:"\ud83d\udc51",description:"Manage company settings, users, and overall system configuration",color:"bg-purple-100 text-purple-800 border-purple-200"},{value:"SUBCONTRACTOR",label:"Subcontractor",icon:"\ud83d\udd27",description:"External contractor access for project work",color:"bg-yellow-100 text-yellow-800 border-yellow-200"},{value:"LOCATION_MANAGER",label:"Location Manager",icon:"\ud83c\udfe2",description:"Manage site-specific operations, coordinate with local teams, and oversee location-based project activities",color:"bg-teal-100 text-teal-800 border-teal-200"}],x=[{key:"CREATE_PROJECTS",name:"Create Projects",description:"Start new roofing projects",category:"Project Management",icon:"\ud83c\udfd7\ufe0f"},{key:"EDIT_PROJECTS",name:"Edit Projects",description:"Update project details and specifications",category:"Project Management",icon:"\u270f\ufe0f"},{key:"DELETE_PROJECTS",name:"Delete Projects",description:"Remove projects from system",category:"Project Management",icon:"\ud83d\uddd1\ufe0f"},{key:"MANAGE_USERS",name:"Manage Users",description:"Add, edit, or remove system users",category:"User Management",icon:"\ud83d\udc65"},{key:"VIEW_REPORTS",name:"View Reports",description:"Access project and financial reports",category:"Analytics",icon:"\ud83d\udcca"},{key:"MANAGE_FINANCES",name:"Manage Finances",description:"Handle project costs, estimates, and billing",category:"Financial",icon:"\ud83d\udcb0"},{key:"MANAGE_DOCUMENTS",name:"Manage Documents",description:"Upload, download, and organize project documents",category:"Documentation",icon:"\ud83d\udcc4"},{key:"MANAGE_CALENDAR",name:"Manage Calendar",description:"Schedule work, manage appointments",category:"Scheduling",icon:"\ud83d\udcc5"},{key:"USE_AI_FEATURES",name:"Use AI Features",description:"Access Bubbles AI and advanced features",category:"AI & Automation",icon:"\ud83e\udd16"}],v={PROJECT_MANAGER:["CREATE_PROJECTS","EDIT_PROJECTS","VIEW_REPORTS","MANAGE_DOCUMENTS","MANAGE_CALENDAR","USE_AI_FEATURES"],FIELD_DIRECTOR:["EDIT_PROJECTS","VIEW_REPORTS","MANAGE_DOCUMENTS","MANAGE_CALENDAR"],OFFICE_STAFF:["VIEW_REPORTS","MANAGE_DOCUMENTS","MANAGE_CALENDAR"],ADMINISTRATION:x.map(e=>e.key),SUBCONTRACTOR:["VIEW_REPORTS","MANAGE_DOCUMENTS"],LOCATION_MANAGER:["EDIT_PROJECTS","VIEW_REPORTS","MANAGE_DOCUMENTS","MANAGE_CALENDAR"]};(0,o.useEffect)(()=>{(async()=>{l(!0),h(null);try{const t={};for(const r of f)try{const e=await g.getRolePermissions(r.value);e.success&&e.data?t[r.value]=e.data.permissions||[]:t[r.value]=v[r.value]||[]}catch(e){console.warn("Failed to load permissions for ".concat(r.value,", using defaults:"),e),t[r.value]=v[r.value]||[]}a(t),p("Permissions loaded successfully"),setTimeout(()=>p(null),3e3)}catch(u){console.error("Error loading permissions:",u),h("Failed to load permissions. Using default settings.");const t={};f.forEach(e=>{t[e.value]=v[e.value]||[]}),a(t)}finally{l(!1)}})()},[g]);const y=s[r]||[],b=f.find(e=>e.value===r);return(0,kt.jsxs)("div",{className:"h-screen flex flex-col ".concat(t?"bg-gray-900":"bg-gray-50"),children:[m&&(0,kt.jsx)("div",{className:"p-3 border-b ".concat(t?"bg-green-900/20 border-green-500/40":"bg-green-50 border-green-200"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-green-600",children:"\u2705"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-green-300":"text-green-700"),children:m})]})}),u&&(0,kt.jsx)("div",{className:"p-3 border-b ".concat(t?"bg-red-900/20 border-red-500/40":"bg-red-50 border-red-200"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-red-600",children:"\u274c"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-red-300":"text-red-700"),children:u})]})}),(0,kt.jsx)("div",{className:"p-3 border-b ".concat(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-xl font-bold ".concat(t?"text-white":"text-gray-900"),children:"\ud83d\udd10 Role Permissions"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:"Manage what each role can access in your roofing business"}),i&&(0,kt.jsx)("p",{className:"text-xs ".concat(t?"text-blue-300":"text-blue-600"),children:"Loading permissions from database..."})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{const e=v[r]||[];a(t=>(0,Y.A)((0,Y.A)({},t),{},{[r]:e}))},className:"px-3 py-1.5 rounded text-sm ".concat(t?"bg-orange-600 hover:bg-orange-700 text-white":"bg-orange-500 hover:bg-orange-600 text-white"),children:"\ud83d\udd04 Reset"}),(0,kt.jsx)("button",{onClick:async()=>{d(!0),h(null),p(null);try{console.log("\ud83d\udcbe Saving role permissions to database:",s);const e=Object.entries(s).map(async e=>{let[t,r]=e;try{const e=await g.updateRolePermissions(t,r);if(!e.success)throw new Error(e.message||"Failed to save permissions for ".concat(t));return console.log("\u2705 Saved permissions for ".concat(t,":"),r),{role:t,success:!0}}catch(n){return console.error("\u274c Failed to save permissions for ".concat(t,":"),n),{role:t,success:!1,error:n.message}}}),t=await Promise.all(e),r=t.filter(e=>!e.success);if(0===r.length)p("All role permissions saved successfully!"),setTimeout(()=>p(null),5e3);else{if(!(r.length<t.length))throw new Error("Failed to save any role permissions");h("Some permissions saved successfully. Failed roles: ".concat(r.map(e=>e.role).join(", ")))}}catch(u){console.error("\u274c Error saving permissions:",u),h("Failed to save permissions: ".concat(u.message))}finally{d(!1)}},disabled:c||i,className:"px-3 py-1.5 rounded text-sm ".concat(c||i?"bg-gray-400 text-gray-200 cursor-not-allowed":t?"bg-green-600 hover:bg-green-700 text-white":"bg-green-500 hover:bg-green-600 text-white"),children:c?(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsx)("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}),(0,kt.jsx)("span",{children:"Saving..."})]}):"\ud83d\udcbe Save"})]})]})}),(0,kt.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,kt.jsxs)("div",{className:"w-48 border-r ".concat(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"p-2 border-b ".concat(t?"border-gray-700":"border-gray-200"),children:(0,kt.jsx)("h3",{className:"text-sm font-semibold ".concat(t?"text-white":"text-gray-900"),children:"Roles"})}),(0,kt.jsx)("div",{className:"p-2 space-y-1",children:f.map(e=>{var a;return(0,kt.jsx)("button",{onClick:()=>n(e.value),className:"w-full p-2 rounded text-left transition-all ".concat(r===e.value?t?"bg-blue-600 text-white":"bg-blue-500 text-white":t?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm",children:e.icon}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-sm",children:e.label}),(0,kt.jsxs)("div",{className:"text-xs opacity-75",children:[(null===(a=s[e.value])||void 0===a?void 0:a.length)||0," permissions"]})]})]})},e.value)})})]}),(0,kt.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,kt.jsx)("div",{className:"p-2 border-b ".concat(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-lg",children:null===b||void 0===b?void 0:b.icon}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-lg font-semibold ".concat(t?"text-white":"text-gray-900"),children:null===b||void 0===b?void 0:b.label}),(0,kt.jsxs)("p",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:[y.length,"/",x.length," permissions enabled"]})]})]}),(0,kt.jsxs)("div",{className:"text-right ".concat(t?"text-blue-400":"text-blue-600"),children:[(0,kt.jsxs)("div",{className:"text-lg font-bold",children:[Math.round(y.length/x.length*100),"%"]}),(0,kt.jsx)("div",{className:"text-xs",children:"Access"})]})]})}),(0,kt.jsx)("div",{className:"flex-1 p-2 overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full grid grid-cols-3 gap-2",children:x.map(e=>{const n=y.includes(e.key);return(0,kt.jsx)("div",{className:"border rounded p-2 cursor-pointer transition-all ".concat(n?t?"bg-green-900/20 border-green-600 text-green-300":"bg-green-50 border-green-200 text-green-800":t?"bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"),onClick:()=>{return t=e.key,void a(e=>{const n=e[r]||[],s=n.includes(t)?n.filter(e=>e!==t):[...n,t];return(0,Y.A)((0,Y.A)({},e),{},{[r]:s})});var t},children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-4 h-4 rounded border ".concat(n?"bg-green-500 border-green-500":t?"border-gray-500":"border-gray-400"),children:n&&(0,kt.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,kt.jsx)("div",{className:"w-1 h-1 bg-white rounded-full"})})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsx)("span",{className:"text-sm",children:e.icon}),(0,kt.jsx)("div",{className:"font-medium text-sm truncate",children:e.name})]}),(0,kt.jsx)("div",{className:"text-xs opacity-75 truncate",children:e.description})]})]})},e.key)})})})]})]})]})},Km=e=>{let{colorMode:t,setColorMode:r,currentUser:n,onUserUpdated:s}=e;const[a,i]=(0,o.useState)("profile"),[l,c]=(0,o.useState)(""),[d,u]=(0,o.useState)(""),[h,m]=(0,o.useState)(""),[p,g]=(0,o.useState)(""),[f,x]=(0,o.useState)("America/New_York"),[v,y]=(0,o.useState)("English"),[b,w]=(0,o.useState)(""),[j,N]=(0,o.useState)(""),[S,k]=(0,o.useState)(""),[A,C]=(0,o.useState)(""),[E,P]=(0,o.useState)(""),[I,T]=(0,o.useState)(!1),[D,M]=(0,o.useState)(""),[_,O]=(0,o.useState)(!1),[L,R]=(0,o.useState)(null),[F,U]=(0,o.useState)(null),[B,W]=(0,o.useState)(""),z=e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return M("Please select a valid image file"),T(!0),void setTimeout(()=>T(!1),3e3);if(t.size>5242880)return M("Image size must be less than 5MB"),T(!0),void setTimeout(()=>T(!1),3e3);R(t);const e=new FileReader;e.onload=e=>{U(e.target.result)},e.readAsDataURL(t)}},V=async()=>{try{const e=await fetch("/api/auth/remove-avatar",{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}),t=await e.json();if(!t.success)throw new Error(t.message||"Failed to remove profile picture");{const e=t.data.user;try{localStorage.setItem("user",JSON.stringify(e)),sessionStorage.setItem("user",JSON.stringify(e))}catch(Pr){}"function"===typeof s&&s(e),R(null),U(null),M("Profile picture removed successfully!"),T(!0),setTimeout(()=>T(!1),3e3)}}catch(ES){console.error("Remove profile picture failed:",ES),M(String((null===ES||void 0===ES?void 0:ES.message)||"Failed to remove profile picture")),T(!0),setTimeout(()=>T(!1),3e3)}},[H,q]=(0,o.useState)({projectManager:[],fieldDirector:[],officeStaff:[],administration:[],subcontractor:[]}),[K,G]=(0,o.useState)([]),[J,Q]=(0,o.useState)(!1),[X,$]=(0,o.useState)([]),[Z,ee]=(0,o.useState)(null),[te,re]=(0,o.useState)(!1),[ne,se]=(0,o.useState)(""),[ae,oe]=(0,o.useState)(null),ie=e=>{try{M(String(null!==e&&void 0!==e?e:"")),T(!0),setTimeout(()=>T(!1),2e3)}catch(Pr){}},[le,ce]=(0,o.useState)(!0),[de,ue]=(0,o.useState)(!1),[he,me]=(0,o.useState)(!0),[pe,ge]=(0,o.useState)(!0),[fe,xe]=(0,o.useState)(!0),[ve,ye]=(0,o.useState)(""),[be,we]=(0,o.useState)(null),[je,Ne]=(0,o.useState)(!1),[Se,ke]=(0,o.useState)(null),[Ae,Ce]=(0,o.useState)({isEnabled:!1,taskFollowUpDays:7,taskFollowUpHours:0,taskFollowUpMinutes:0,reminderFollowUpDays:3,reminderFollowUpHours:0,reminderFollowUpMinutes:0,alertFollowUpDays:5,alertFollowUpHours:0,alertFollowUpMinutes:0,maxFollowUpAttempts:3,followUpMessage:""}),[Ee,Pe]=(0,o.useState)(!1),Ie=async e=>{try{const t=localStorage.getItem("authToken")||localStorage.getItem("token");console.log("\ud83d\udcbe Saving role assignments:",e);const r={};Object.keys(e).forEach(t=>{const n=e[t]||[];r[t]=n.map(e=>e.id)}),console.log("\ud83d\udce4 Sending to backend:",r);const n=await fetch("".concat(Ds.API_BASE_URL,"/roles/sync"),{method:"POST",headers:(0,Y.A)({"Content-Type":"application/json"},t&&{Authorization:"Bearer ".concat(t)}),body:JSON.stringify({roleAssignments:r})});if(!n.ok){const e=await n.json();throw new Error(e.message||"HTTP error! status: ".concat(n.status))}const s=await n.json();console.log("\u2705 Role assignments saved successfully:",s)}catch(t){throw console.error("\u274c Error saving role assignments:",t),t}};(0,o.useEffect)(()=>{const e=n?"".concat(n.firstName||""," ").concat(n.lastName||"").trim():"";c(e),w((null===n||void 0===n?void 0:n.firstName)||""),N((null===n||void 0===n?void 0:n.lastName)||""),u((null===n||void 0===n?void 0:n.email)||""),m((null===n||void 0===n?void 0:n.phone)||""),g((null===n||void 0===n?void 0:n.company)||""),x((null===n||void 0===n?void 0:n.timezone)||"America/New_York"),y((null===n||void 0===n?void 0:n.language)||"English")},[n]),(0,o.useEffect)(()=>{let e=!0;return(async()=>{try{Q(!0);const r=localStorage.getItem("authToken")||localStorage.getItem("token");r||console.warn("\u26a0\ufe0f No auth token found"),console.log("\ud83d\udce1 Fetching users from API...");const n=await fetch("".concat(Ds.API_BASE_URL,"/roles/users"),{headers:{Authorization:"Bearer ".concat(r)}});if(n.ok){var t;const r=await n.json();console.log("\u2705 Received ".concat((null===(t=r.data)||void 0===t?void 0:t.length)||0," users from API")),e&&r.success&&r.data?G(r.data):console.warn("\u26a0\ufe0f API returned success but no data")}else console.error("\u274c API returned status ".concat(n.status));await(async()=>{try{const e=localStorage.getItem("authToken")||localStorage.getItem("token");if(!e)return void console.log("\u26a0\ufe0f No token available for loading role assignments");console.log("\ud83d\udce1 Loading role assignments...");const t=await fetch("".concat(Ds.API_BASE_URL,"/roles"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){const e=await t.json();if(console.log("\ud83d\udcca Role assignments received:",e),e.success){const t={projectManager:[],fieldDirector:[],officeStaff:[],administration:[],subcontractor:[],locationManager:[]};Object.keys(t).forEach(r=>{const n="projectManager"===r?"productManager":r,s=e.data[n]||e.data[r];if(s)if(Array.isArray(s))t[r]=s;else if(s.userId){const e=K.find(e=>e.id===s.userId);e&&(t[r]=[e])}}),console.log("\u2705 Setting role assignments (new format):",t),q(t)}}else console.error("\u274c Failed to load role assignments: ".concat(t.status))}catch(e){console.error("Error loading role assignments:",e)}})()}catch(r){console.error("Error loading users and roles:",r),ie("Failed to load users. Please check your connection.")}finally{Q(!1)}})(),()=>{e=!1}},[]);const Te=async()=>{if(!be||!ve)return void ie("Please select a file and workflow template");Ne(!0);const e=new FormData;e.append("file",be),e.append("workflowTemplateId",ve);try{const t=await fetch("".concat(Ds.API_BASE_URL,"/project-import/upload"),{method:"POST",body:e}),r=await t.json();if(r.success){const e=r.data.successful||0,t=r.data.failed||0;ke({total:r.data.total||0,successful:e,failed:r.data.errors||[]});let n="Import completed: ".concat(e," projects created successfully");t>0&&(n+=", ".concat(t," failed")),ie(n),we(null)}else ie("Import failed: ".concat(String(r.message||"Unknown error")))}catch(t){console.error("Error importing projects:",t),ie("Import failed due to an error")}finally{Ne(!1)}},De=e=>{try{let t,r;switch(e){case"combined":t="project_customer_combined_template.csv",r="/templates/project_customer_combined_template.csv";break;case"combined-instructions":t="Combined_Upload_Instructions.md",r="/templates/COMBINED_UPLOAD_INSTRUCTIONS.md";break;default:throw new Error("Invalid template type")}const n=document.createElement("a");n.href=r,n.download=t,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n),ie("Downloaded ".concat(e," template successfully!"))}catch(t){console.error("Error downloading template:",t),ie("Failed to download ".concat(e," template"))}};(0,o.useEffect)(()=>{(async()=>{try{const e=[{id:"standard",name:"Standard Roofing Workflow",description:"Default 7-phase roofing workflow"},{id:"express",name:"Express Workflow",description:"Simplified workflow for small projects"},{id:"insurance",name:"Insurance Claims Workflow",description:"Workflow optimized for insurance claims"}];$(e),e.length>0&&ye(e[0].id)}catch(e){console.error("Error fetching workflow templates:",e)}})()},[]);const Me=async()=>{Pe(!0);try{const e=await fetch("/api/follow-up/settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(Ae)}),t=await e.json();if(!t.success)throw new Error(t.message||"Failed to save follow-up settings");M("Follow-up settings saved successfully!"),T(!0),setTimeout(()=>T(!1),3e3)}catch(e){console.error("Error saving follow-up settings:",e),M("Failed to save follow-up settings"),T(!0),setTimeout(()=>T(!1),3e3)}finally{Pe(!1)}};(0,o.useEffect)(()=>{(async()=>{try{const e=await fetch("/api/follow-up/settings",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),t=await e.json();t.success&&Ce(t.data.settings)}catch(e){console.error("Error loading follow-up settings:",e)}})()},[]),(0,o.useEffect)(()=>{n&&(w(n.firstName||""),N(n.lastName||""),u(n.email||""),m(n.phone||""),W(n.displayName||""),c("".concat(n.firstName||""," ").concat(n.lastName||"").trim()))},[n]);const _e=[{id:"profile",label:"Profile",icon:"\ud83d\udc64"},{id:"security",label:"Security",icon:"\ud83d\udd12"},{id:"roles",label:"Roles",icon:"\ud83d\udc65"},{id:"permissions",label:"Permissions",icon:"\ud83d\udd10"},{id:"follow-up",label:"Bubbles AI",icon:"\ud83e\udd16"}],Oe=()=>(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,kt.jsxs)("div",{className:"relative",children:[F?(0,kt.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-blue-500",children:(0,kt.jsx)("img",{src:F,alt:"Profile",className:"w-full h-full object-cover"})}):null!==n&&void 0!==n&&n.avatar?(0,kt.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-blue-500",children:(0,kt.jsx)("img",{src:n.avatar.startsWith("spaces://")?"https://".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_NAME,".").concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_ENDPOINT,"/").concat(n.avatar.replace("spaces://","")):n.avatar,alt:"Profile",className:"w-full h-full object-cover"})}):(0,kt.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold ".concat("bg-gradient-to-br from-blue-500 to-blue-600 text-white"),children:"".concat(((null===n||void 0===n?void 0:n.firstName)||"U").charAt(0).toUpperCase()).concat(((null===n||void 0===n?void 0:n.lastName)||"").charAt(0).toUpperCase())}),(0,kt.jsx)("button",{type:"button",onClick:()=>document.getElementById("profile-picture-upload").click(),className:"absolute -bottom-1 -right-1 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-blue-600 transition-colors",title:"Change profile picture",children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(F||(null===n||void 0===n?void 0:n.avatar))&&(0,kt.jsx)("button",{type:"button",onClick:V,className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors shadow-sm",title:"Remove profile picture",children:(0,kt.jsx)("svg",{className:"w-1.5 h-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-bold ".concat(t?"text-white":"text-gray-800"),children:B||l||"".concat((null===n||void 0===n?void 0:n.firstName)||""," ").concat((null===n||void 0===n?void 0:n.lastName)||"").trim()||"User"}),(0,kt.jsx)("div",{className:"text-xs ".concat(t?"text-blue-200":"text-blue-600"),children:(()=>{const e=String((null===n||void 0===n?void 0:n.role)||"").toUpperCase();return null!==n&&void 0!==n&&n.position?n.position:"WORKER"===e?"User":(null===n||void 0===n?void 0:n.role)||"User"})()}),(0,kt.jsx)("div",{className:"text-[10px] ".concat(t?"text-gray-300":"text-gray-500"),children:d})]})]}),(0,kt.jsx)("input",{id:"profile-picture-upload",type:"file",accept:"image/*",onChange:z,className:"hidden"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"First Name"}),(0,kt.jsx)("input",{type:"text",value:b,onChange:e=>w(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Last Name"}),(0,kt.jsx)("input",{type:"text",value:j,onChange:e=>N(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Email Address"}),(0,kt.jsx)("input",{type:"email",value:d,onChange:e=>u(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Phone Number"}),(0,kt.jsx)("input",{type:"tel",value:h,onChange:e=>{const t=e.target.value;m(t)},onBlur:e=>{m(Xl(e.target.value))},placeholder:"(555) 555-5555",className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Display Name"}),(0,kt.jsx)("input",{type:"text",value:B,onChange:e=>W(e.target.value),placeholder:"How your name appears in the Bubbles system",className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")}),(0,kt.jsx)("p",{className:"text-xs mt-1 ".concat(t?"text-gray-400":"text-gray-500"),children:"How your name is displayed in the Bubbles system"})]})]})]}),[Le,Re]=(0,o.useState)(!1),Fe=async()=>{if(!window.confirm("\u26a0\ufe0f CLEAR ALL MOCK DATA?\n\nThis will permanently delete:\n\u2022 All tasks\n\u2022 All calendar events/reminders\n\u2022 All project messages\n\nThis action CANNOT be undone!\n\nAre you absolutely sure you want to proceed?"))return;if(window.confirm("\ud83d\udea8 FINAL CONFIRMATION\n\nYou are about to DELETE ALL tasks, reminders, and messages from the system.\n\nClick OK to proceed with deletion, or Cancel to abort.")){Re(!0);try{const e=localStorage.getItem("authToken")||localStorage.getItem("token"),t=await fetch("".concat(Ds.API_BASE_URL,"/tasks"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),r=await fetch("".concat(Ds.API_BASE_URL,"/calendar"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),n=await fetch("".concat(Ds.API_BASE_URL,"/project-messages"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),s={tasks:t.ok,calendar:r.ok,messages:n.ok};if(s.tasks&&s.calendar&&s.messages)ie("\u2705 All mock data has been cleared successfully!"),setTimeout(()=>{window.location.reload()},2e3);else{const e=[];s.tasks||e.push("tasks"),s.calendar||e.push("calendar events"),s.messages||e.push("messages"),ie("\u26a0\ufe0f Partial success. Failed to clear: ".concat(e.join(", ")))}}catch(e){console.error("Error clearing mock data:",e),ie("\u274c Failed to clear mock data: "+(e.message||"Unknown error"))}finally{Re(!1)}}};return(0,kt.jsx)("div",{className:"min-h-screen ".concat(t?"bg-[#0f172a]":"bg-gray-50"),children:(0,kt.jsx)("div",{className:"max-w-4xl mx-auto p-3",children:(0,kt.jsxs)("div",{className:"rounded-lg shadow-sm border ".concat(t?"bg-[#232b4d]/80 border-[#3b82f6]/40":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"flex flex-wrap border-b border-gray-200",children:_e.map(e=>(0,kt.jsxs)("button",{onClick:()=>i(e.id),className:"flex items-center gap-1 px-3 py-2 text-xs font-semibold transition-all duration-200 ".concat(a===e.id?"".concat(t?"text-blue-400 border-b-2 border-blue-400":"text-blue-600 border-b-2 border-blue-600"):"".concat(t?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800")),children:[(0,kt.jsx)("span",{className:"text-sm",children:e.icon}),e.label]},e.id))}),(0,kt.jsxs)("div",{className:"p-4",children:[(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!_){O(!0);try{var t;let e=null;if(L){const t=new FormData;t.append("avatar",L);const r=await fetch("/api/auth/upload-avatar",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:t}),n=await r.json();if(!n.success)throw new Error(n.message||"Failed to upload profile picture");e=n.data.user,R(null),U(null)}const r={firstName:b||void 0,lastName:j||void 0,phone:h||void 0,timezone:f,language:v,displayName:B||void 0},n=await Ds.authService.updateUserProfile(r);if(null===n||void 0===n||!n.success||null===n||void 0===n||null===(t=n.data)||void 0===t||!t.user)throw new Error((null===n||void 0===n?void 0:n.message)||"Failed to update profile");{const e=n.data.user;w(e.firstName||""),N(e.lastName||""),c("".concat(e.firstName||""," ").concat(e.lastName||"").trim());try{localStorage.setItem("user",JSON.stringify(e)),sessionStorage.setItem("user",JSON.stringify(e))}catch(Pr){}"function"===typeof s&&s(e),M("Profile updated successfully!"),T(!0),setTimeout(()=>T(!1),4e3)}}catch(ES){console.error("Profile save failed:",ES),M(String((null===ES||void 0===ES?void 0:ES.message)||"Failed to save")),T(!0),setTimeout(()=>T(!1),3e3)}finally{O(!1)}}},children:[(()=>{switch(a){case"profile":default:return Oe();case"security":return(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold mb-2 ".concat(t?"text-white":"text-gray-800"),children:"Change Password"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Current Password"}),(0,kt.jsx)("input",{type:"password",value:E,onChange:e=>P(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white"),autoComplete:"current-password"})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"New Password"}),(0,kt.jsx)("input",{type:"password",value:S,onChange:e=>k(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white"),autoComplete:"new-password"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Confirm New Password"}),(0,kt.jsx)("input",{type:"password",value:A,onChange:e=>C(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white"),autoComplete:"new-password"})]})]})]})]}),(0,kt.jsxs)("div",{className:"mt-6 border rounded-lg p-4 ".concat(t?"bg-red-900/20 border-red-500/40":"bg-red-50 border-red-200"),children:[(0,kt.jsxs)("h3",{className:"text-sm font-semibold mb-2 flex items-center gap-2 ".concat(t?"text-red-300":"text-red-900"),children:[(0,kt.jsx)("span",{children:"\ud83d\uddd1\ufe0f"}),"Clear All Mock Data"]}),(0,kt.jsx)("p",{className:"text-xs mb-3 ".concat(t?"text-red-200":"text-red-700"),children:"After trialing the software, use this to remove all test data and start fresh with real data."}),(0,kt.jsxs)("div",{className:"text-xs space-y-1 mb-3 ".concat(t?"text-red-200":"text-red-600"),children:[(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"\u26a0\ufe0f Warning:"})," This will permanently delete:"]}),(0,kt.jsxs)("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[(0,kt.jsx)("li",{children:"All tasks (TODO, IN_PROGRESS, DONE)"}),(0,kt.jsx)("li",{children:"All calendar events and reminders"}),(0,kt.jsx)("li",{children:"All project messages and conversations"})]}),(0,kt.jsx)("p",{className:"mt-2",children:(0,kt.jsx)("strong",{children:"\u274c This action CANNOT be undone!"})})]}),(0,kt.jsx)("button",{type:"button",onClick:Fe,disabled:Le,className:"w-full px-4 py-2 rounded font-semibold text-sm transition-colors ".concat(Le?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"),children:Le?(0,kt.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",fill:"none",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Clearing All Data..."]}):"\ud83d\uddd1\ufe0f Clear All Mock Data"})]})]});case"roles":return(0,kt.jsx)(Wm,{colorMode:t,roleAssignments:H,setRoleAssignments:q,availableUsers:K,saveRoleAssignments:Ie});case"permissions":return(0,kt.jsx)(qm,{colorMode:t});case"follow-up":return(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(t?"text-white":"text-gray-800"),children:"Follow-up Settings"}),(0,kt.jsx)("button",{onClick:Me,disabled:Ee,className:"px-4 py-2 rounded text-sm font-semibold transition-all duration-200 ".concat(Ee?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:Ee?"Saving...":"Save Settings"})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-3 rounded border",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold ".concat(t?"text-white":"text-gray-800"),children:"Enable Automatic Follow-ups"}),(0,kt.jsx)("p",{className:"text-xs ".concat(t?"text-gray-300":"text-gray-600"),children:"Automatically send follow-up reminders for tasks and alerts"})]}),(0,kt.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:Ae.isEnabled,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{isEnabled:e.target.checked})),className:"sr-only peer"}),(0,kt.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),Ae.isEnabled&&(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"border rounded p-4",children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold mb-3 ".concat(t?"text-white":"text-gray-800"),children:"Task Follow-up Timing"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:Ae.taskFollowUpDays,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{taskFollowUpDays:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:Ae.taskFollowUpHours,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{taskFollowUpHours:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:Ae.taskFollowUpMinutes,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{taskFollowUpMinutes:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]})]}),(0,kt.jsxs)("div",{className:"border rounded p-4",children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold mb-3 ".concat(t?"text-white":"text-gray-800"),children:"Reminder Follow-up Timing"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:Ae.reminderFollowUpDays,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{reminderFollowUpDays:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:Ae.reminderFollowUpHours,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{reminderFollowUpHours:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:Ae.reminderFollowUpMinutes,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{reminderFollowUpMinutes:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]})]}),(0,kt.jsxs)("div",{className:"border rounded p-4",children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold mb-3 ".concat(t?"text-white":"text-gray-800"),children:"Alert Follow-up Timing"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:Ae.alertFollowUpDays,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{alertFollowUpDays:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:Ae.alertFollowUpHours,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{alertFollowUpHours:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:Ae.alertFollowUpMinutes,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{alertFollowUpMinutes:parseInt(e.target.value)||0})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold mb-1 ".concat(t?"text-white":"text-gray-800"),children:"Max Follow-up Attempts"}),(0,kt.jsx)("input",{type:"number",min:"1",max:"10",value:Ae.maxFollowUpAttempts,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{maxFollowUpAttempts:parseInt(e.target.value)||3})),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold mb-1 ".concat(t?"text-white":"text-gray-800"),children:"Custom Follow-up Message"}),(0,kt.jsx)("textarea",{value:Ae.followUpMessage,onChange:e=>Ce(t=>(0,Y.A)((0,Y.A)({},t),{},{followUpMessage:e.target.value})),placeholder:"Enter a custom message for follow-up notifications...",rows:3,maxLength:1e3,className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")}),(0,kt.jsxs)("p",{className:"text-xs mt-1 ".concat(t?"text-gray-400":"text-gray-500"),children:[Ae.followUpMessage.length,"/1000 characters"]})]})]}),(0,kt.jsxs)("div",{className:"mt-6",children:[(0,kt.jsx)("h4",{className:"text-md font-semibold mb-3 ".concat(t?"text-white":"text-gray-800"),children:"Follow-up Tracking"}),(0,kt.jsx)(zm,{colorMode:t})]})]})]});case"complete-excel":return(0,kt.jsx)(Pu,{colorMode:t});case"project-import":return(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"bg-blue-900/20 border-blue-500/40":"bg-blue-50 border-blue-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(t?"text-blue-300":"text-blue-900"),children:"\ud83d\udccb Project Data Import"}),(0,kt.jsx)("p",{className:"text-sm mb-3 ".concat(t?"text-blue-200":"text-blue-700"),children:"Import projects with customer data. Each project will be initialized with the complete 91-line item workflow starting at the LEAD phase."}),(0,kt.jsxs)("div",{className:"text-xs space-y-1 ".concat(t?"text-blue-200":"text-blue-600"),children:[(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Required Columns:"})," projectNumber, projectName, primaryName, primaryEmail, primaryPhone, address, projectType, budget, startDate, endDate"]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Optional Columns:"})," secondaryName, secondaryEmail, secondaryPhone, primaryContact, notes (customer notes), status, priority, estimatedCost, actualCost, description (project description), pmPhone, pmEmail, progress"]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Valid Project Types:"})," ROOF_REPLACEMENT, KITCHEN_REMODEL, BATHROOM_RENOVATION, SIDING_INSTALLATION, WINDOW_REPLACEMENT, FLOORING, PAINTING, ELECTRICAL_WORK, PLUMBING, HVAC, DECK_CONSTRUCTION, LANDSCAPING, OTHER"]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Valid Statuses:"})," PENDING, IN_PROGRESS, COMPLETED, ON_HOLD"]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Valid Priorities:"})," LOW, MEDIUM, HIGH"]})]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"bg-gray-800/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(t?"text-blue-300":"text-blue-900"),children:"\ud83d\udd27 Workflow Template"}),(0,kt.jsx)("p",{className:"text-sm mb-3 ".concat(t?"text-gray-300":"text-gray-700"),children:"Select the workflow template to assign to imported projects"}),(0,kt.jsxs)("select",{value:ve,onChange:e=>ye(e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Select a workflow template..."}),X.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.name," - ",e.description]},e.id))]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"bg-gray-800/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(t?"text-blue-300":"text-blue-900"),children:"\ud83d\udcc4 Download CSV Template"}),(0,kt.jsx)("p",{className:"text-sm mb-3 ".concat(t?"text-gray-300":"text-gray-700"),children:"Download the combined Project + Customer template with project number field"}),(0,kt.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,kt.jsx)("button",{onClick:()=>De("combined"),className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 transition-colors text-sm font-medium",children:"\ud83c\udfd7\ufe0f\ud83d\udc65 Combined Template"}),(0,kt.jsx)("button",{onClick:()=>De("combined-instructions"),className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors text-sm font-medium",children:"\ud83d\udccb Upload Instructions"})]})]}),(0,kt.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(t?"border-gray-600 hover:border-gray-500":"border-gray-300 hover:border-gray-400"),children:[(0,kt.jsx)("div",{className:"text-4xl mb-4",children:"\ud83c\udfd7\ufe0f"}),be?(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"p-3 rounded border ".concat(t?"bg-gray-800 border-gray-600":"bg-gray-100 border-gray-300"),children:[(0,kt.jsxs)("p",{className:"text-sm font-medium ".concat(t?"text-white":"text-gray-800"),children:["Selected: ",be.name]}),(0,kt.jsxs)("p",{className:"text-xs ".concat(t?"text-gray-300":"text-gray-600"),children:["Size: ",(be.size/1024).toFixed(1)," KB"]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,kt.jsx)("button",{onClick:Te,disabled:je||!ve,className:"px-6 py-2 rounded font-medium transition-colors ".concat(je||!ve?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700"),children:je?"\ud83d\udd04 Importing...":"\ud83d\udce4 Import Projects"}),(0,kt.jsx)("button",{onClick:()=>{we(null),ke(null)},className:"px-4 py-2 rounded border transition-colors ".concat(t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"})]})]}):(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"cursor-pointer",children:[(0,kt.jsx)("span",{className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 transition-colors",children:"Choose Project File"}),(0,kt.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{const t=e.target.files[0];t&&(we(t),ke(null))},className:"hidden"})]}),(0,kt.jsx)("p",{className:"mt-2 text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:"Upload your Excel or CSV file with project data"}),(0,kt.jsx)("p",{className:"mt-1 text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:"Supported formats: .xlsx, .xls, .csv (max 10MB)"})]})]}),Se&&(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(Se.failed.length>0?t?"bg-yellow-900/20 border-yellow-500/40":"bg-yellow-50 border-yellow-200":t?"bg-green-900/20 border-green-500/40":"bg-green-50 border-green-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(Se.failed.length>0?t?"text-yellow-300":"text-yellow-900":t?"text-green-300":"text-green-900"),children:"\ud83d\udcca Import Results"}),(0,kt.jsxs)("div",{className:"text-sm space-y-2 ".concat(Se.failed.length>0?t?"text-yellow-200":"text-yellow-800":t?"text-green-200":"text-green-800"),children:[(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Total:"})," ",Se.total]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Successful:"})," ",Se.successful.length]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Failed:"})," ",Se.failed.length]})]}),Se.successful.length>0&&(0,kt.jsxs)("div",{className:"mt-4",children:[(0,kt.jsx)("h4",{className:"font-medium text-sm mb-2 ".concat(t?"text-green-300":"text-green-900"),children:"\u2705 Successfully Imported Projects:"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[Se.successful.slice(0,5).map((e,r)=>(0,kt.jsxs)("div",{className:"text-xs p-2 rounded ".concat(t?"bg-green-900/30":"bg-green-100"),children:[(0,kt.jsx)("strong",{children:e.projectNumber})," - ",e.customerName]},r)),Se.successful.length>5&&(0,kt.jsxs)("p",{className:"text-xs ".concat(t?"text-green-300":"text-green-700"),children:["... and ",Se.successful.length-5," more"]})]})]}),Se.failed.length>0&&(0,kt.jsxs)("div",{className:"mt-4",children:[(0,kt.jsx)("h4",{className:"font-medium text-sm mb-2 ".concat(t?"text-red-300":"text-red-900"),children:"\u274c Failed Imports:"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[Se.failed.slice(0,3).map((e,r)=>(0,kt.jsxs)("div",{className:"text-xs p-2 rounded ".concat(t?"bg-red-900/30":"bg-red-100"),children:[(0,kt.jsxs)("strong",{children:["Row ",e.row||r+1,":"]})," ",String(e.error||e.message||"Unknown error")]},r)),Se.failed.length>3&&(0,kt.jsxs)("p",{className:"text-xs ".concat(t?"text-red-300":"text-red-700"),children:["... and ",Se.failed.length-3," more errors"]})]})]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"bg-gray-800/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(t?"text-blue-300":"text-blue-900"),children:"\ud83d\udca1 Example Project Data"}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"min-w-full text-xs border-collapse ".concat(t?"border-gray-600":"border-gray-300"),children:[(0,kt.jsx)("thead",{children:(0,kt.jsxs)("tr",{className:t?"bg-gray-700/50":"bg-gray-100",children:[(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"projectNumber"}),(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"projectName"}),(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"primaryName"}),(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"primaryEmail"}),(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"address"})]})}),(0,kt.jsxs)("tbody",{children:[(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"12345"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"Smith Roof Replacement"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"John Smith"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"john.smith@email.com"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"123 Main St, Dallas TX"})]}),(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"12346"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"Doe Kitchen Remodel"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"Jane Doe"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"jane.doe@email.com"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"456 Oak Ave, Dallas TX"})]})]})]})})]})]});case"workflow-import":return(0,kt.jsx)(yu,{})}})(),("profile"===a||"security"===a)&&(0,kt.jsx)("div",{className:"flex justify-end pt-3 border-t border-gray-200 mt-4",children:(0,kt.jsx)("button",{type:"submit",disabled:_,className:"px-6 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm ".concat(_?"bg-gray-400 cursor-not-allowed":t?"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white shadow-blue-900/20":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white shadow-blue-600/20"," hover:shadow-md transform hover:scale-105"),children:(0,kt.jsx)("span",{className:"flex items-center gap-2",children:_?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,kt.jsx)("span",{children:"Saving..."})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"\ud83d\udcbe"}),(0,kt.jsx)("span",{children:"Save Changes"})]})})})})]}),I&&(0,kt.jsx)("div",{className:"fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 border-2 ".concat(t?"bg-green-800 border-green-600 text-white":"bg-green-100 border-green-300 text-green-800"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold text-sm",children:"Success!"}),(0,kt.jsx)("div",{className:"text-sm opacity-90",children:String(D)})]})]})})]})]})})})},Gm=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})},Jm=e=>{let{projects:t,tasks:r,activities:n,colorMode:s,onProjectSelect:a}=e;const[i,l]=(0,o.useState)(new Date),[c,d]=(0,o.useState)(new Date),[u,h]=(0,o.useState)("month"),[m,p]=(0,o.useState)("all"),[g,f]=(0,o.useState)(null),[x,v]=(0,o.useState)(!1),[y,b]=(0,o.useState)(!1),[w,j]=(0,o.useState)([]),[N,S]=(0,o.useState)(!1),[k,A]=(0,o.useState)(null),[C,E]=(0,o.useState)({title:"",type:"meeting",date:(new Date).toISOString().split("T")[0],time:"09:00",description:"",projectId:"",priority:"medium"}),P=e=>{const t=((null===e||void 0===e?void 0:e.type)||"").toLowerCase(),r=(null===e||void 0===e?void 0:e.title)||"",n=r.toLowerCase();return"task"===t||"alert"===t||r.includes("\u26a0\ufe0f")||n.includes("alert")};(0,o.useEffect)(()=>{(async()=>{try{const e=await Ds.authService.getCurrentUser();A(e)}catch(e){console.error("Failed to fetch current user:",e)}})()},[]);const I=async()=>{try{S(!0);const e=await fetch("/api/calendar-events");if(e.ok){const t=await e.json(),r=Array.isArray(t)?t:t.data||t.events||[];j(r.filter(e=>!P(e)))}}catch(e){console.error("Error fetching calendar events:",e),j([])}finally{S(!1)}};(0,o.useEffect)(()=>{I()},[]);const T=e=>{const r=[],n=e.toDateString(),s=e.toISOString().split("T")[0];Array.isArray(w)&&w.forEach(e=>{if(e.date===s){const t={id:e._id||"db-event-".concat(e.title),title:e.title,type:e.type,time:e.time,priority:e.priority,color:e.color||D(e.type),description:e.description,projectId:e.projectId};P(t)||r.push(t)}}),t.forEach(e=>{e.materialsDeliveryStart&&new Date(e.materialsDeliveryStart).toDateString()===n&&r.push({id:"delivery-".concat(e.id),title:"\ud83d\udce6 ".concat(e.projectName||e.name," - Materials"),type:"delivery",project:e,time:"8:00 AM",priority:"medium",color:"bg-amber-500"}),e.laborStart&&new Date(e.laborStart).toDateString()===n&&r.push({id:"labor-".concat(e.id),title:"\ud83d\udc77 ".concat(e.projectName||e.name," - Labor"),type:"labor",project:e,time:"7:00 AM",priority:"medium",color:"bg-indigo-500"})});return[{date:"2024-01-02",title:"\ud83c\udfe2 New Year Office Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-01-03",title:"\ud83d\udd27 Equipment Calibration",type:"maintenance",time:"8:00 AM"},{date:"2024-01-05",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-08",title:"\ud83d\udc65 Client Consultation - Johnson Roof",type:"meeting",time:"10:00 AM"},{date:"2024-01-09",title:"\ud83d\udcca Monthly Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-01-10",title:"\ud83d\udee0\ufe0f Tool Maintenance Day",type:"maintenance",time:"8:00 AM"},{date:"2024-01-12",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-15",title:"\ud83d\udcc5 Safety Training - Fall Protection",type:"training",time:"10:00 AM"},{date:"2024-01-17",title:"\ud83d\udcdd Permit Application Deadline",type:"deadline",time:"5:00 PM"},{date:"2024-01-19",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-23",title:"\ud83d\udd27 Vehicle Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-01-24",title:"\ud83d\udcca Project Progress Review",type:"meeting",time:"1:00 PM"},{date:"2024-01-26",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-29",title:"\ud83d\udc65 Insurance Agent Meeting",type:"meeting",time:"3:00 PM"},{date:"2024-01-30",title:"\ud83d\udcc5 OSHA Compliance Training",type:"training",time:"9:00 AM"},{date:"2024-01-31",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-02-02",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-05",title:"\ud83d\udc65 Client Meeting - Smith Residence",type:"meeting",time:"10:00 AM"},{date:"2024-02-06",title:"\ud83d\udd27 Equipment Inventory Check",type:"maintenance",time:"8:00 AM"},{date:"2024-02-07",title:"\ud83d\udcca Quarterly Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-02-09",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-12",title:"\ud83d\udc65 Subcontractor Coordination",type:"meeting",time:"11:00 AM"},{date:"2024-02-13",title:"\ud83d\udee0\ufe0f Safety Equipment Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-02-14",title:"\ud83d\udcc5 First Aid Training",type:"training",time:"10:00 AM"},{date:"2024-02-16",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-19",title:"\ud83d\udc65 Site Walkthrough - New Project",type:"inspection",time:"9:00 AM"},{date:"2024-02-20",title:"\ud83d\udcdd Insurance Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-02-21",title:"\ud83d\udd27 Generator Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-02-23",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-26",title:"\ud83d\udc65 Team Building Event",type:"meeting",time:"12:00 PM"},{date:"2024-02-27",title:"\ud83d\udcca Budget Review Meeting",type:"meeting",time:"1:00 PM"},{date:"2024-02-28",title:"\ud83d\udcc5 CPR Certification Renewal",type:"training",time:"9:00 AM"},{date:"2024-02-29",title:"\ud83d\udcdd Monthly Safety Reports",type:"deadline",time:"5:00 PM"},{date:"2024-03-01",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-04",title:"\ud83d\udc65 Client Presentation - Large Project",type:"meeting",time:"10:00 AM"},{date:"2024-03-05",title:"\ud83d\udd27 Compressor Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-03-06",title:"\ud83d\udcca Annual Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-03-08",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-11",title:"\ud83d\udc65 Architect Meeting - Design Review",type:"meeting",time:"11:00 AM"},{date:"2024-03-12",title:"\ud83d\udee0\ufe0f Scaffolding Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-03-13",title:"\ud83d\udcc5 Hazard Communication Training",type:"training",time:"10:00 AM"},{date:"2024-03-15",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-18",title:"\ud83d\udc65 Quality Control Review",type:"meeting",time:"1:00 PM"},{date:"2024-03-19",title:"\ud83d\udcdd Contract Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-03-20",title:"\ud83d\udd27 Welding Equipment Check",type:"maintenance",time:"8:00 AM"},{date:"2024-03-22",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-25",title:"\ud83d\udc65 Site Safety Audit",type:"inspection",time:"9:00 AM"},{date:"2024-03-26",title:"\ud83d\udcca Performance Review Meeting",type:"meeting",time:"2:00 PM"},{date:"2024-03-27",title:"\ud83d\udcc5 Confined Space Training",type:"training",time:"10:00 AM"},{date:"2024-03-29",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-31",title:"\ud83d\udcdd Quarterly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-04-01",title:"\ud83c\udfe2 Spring Safety Kickoff",type:"meeting",time:"8:00 AM"},{date:"2024-04-02",title:"\ud83d\udd27 Spring Equipment Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-04-03",title:"\ud83d\udc65 New Project Kickoff Meeting",type:"meeting",time:"10:00 AM"},{date:"2024-04-05",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-09",title:"\ud83d\udee0\ufe0f Electrical Safety Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-04-10",title:"\ud83d\udcc5 Ladder Safety Training",type:"training",time:"10:00 AM"},{date:"2024-04-12",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-15",title:"\ud83d\udc65 Subcontractor Safety Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-04-16",title:"\ud83d\udcdd Tax Filing Deadline",type:"deadline",time:"5:00 PM"},{date:"2024-04-17",title:"\ud83d\udd27 Crane Inspection",type:"maintenance",time:"8:00 AM"},{date:"2024-04-19",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-22",title:"\ud83d\udc65 Project Completion Review",type:"meeting",time:"1:00 PM"},{date:"2024-04-23",title:"\ud83d\udcca Monthly Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-04-24",title:"\ud83d\udcc5 Personal Protective Equipment Training",type:"training",time:"10:00 AM"},{date:"2024-04-26",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-29",title:"\ud83d\udc65 Insurance Claim Meeting",type:"meeting",time:"3:00 PM"},{date:"2024-04-30",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-05-01",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-03",title:"\ud83d\udc65 Client Meeting - Summer Projects",type:"meeting",time:"10:00 AM"},{date:"2024-05-06",title:"\ud83d\udd27 HVAC System Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-05-07",title:"\ud83d\udcca Q2 Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-05-10",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-13",title:"\ud83d\udc65 Site Safety Walkthrough",type:"inspection",time:"9:00 AM"},{date:"2024-05-14",title:"\ud83d\udcc5 Heat Stress Training",type:"training",time:"10:00 AM"},{date:"2024-05-17",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-20",title:"\ud83d\udc65 Equipment Rental Meeting",type:"meeting",time:"11:00 AM"},{date:"2024-05-21",title:"\ud83d\udcdd Permit Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-05-22",title:"\ud83d\udd27 Excavator Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-05-24",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-27",title:"\ud83d\udc65 Memorial Day Safety Briefing",type:"meeting",time:"8:00 AM"},{date:"2024-05-28",title:"\ud83d\udcca Monthly Progress Review",type:"meeting",time:"1:00 PM"},{date:"2024-05-29",title:"\ud83d\udcc5 Emergency Response Training",type:"training",time:"10:00 AM"},{date:"2024-05-31",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-06-03",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-05",title:"\ud83d\udc65 Summer Project Kickoff",type:"meeting",time:"10:00 AM"},{date:"2024-06-06",title:"\ud83d\udd27 Summer Equipment Prep",type:"maintenance",time:"8:00 AM"},{date:"2024-06-07",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-10",title:"\ud83d\udc65 Client Site Visit - Summer Homes",type:"meeting",time:"11:00 AM"},{date:"2024-06-11",title:"\ud83d\udee0\ufe0f Summer Safety Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-06-12",title:"\ud83d\udcc5 Heat Illness Prevention Training",type:"training",time:"10:00 AM"},{date:"2024-06-14",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-17",title:"\ud83d\udc65 Subcontractor Summer Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-06-18",title:"\ud83d\udcdd Insurance Mid-Year Review",type:"deadline",time:"4:00 PM"},{date:"2024-06-19",title:"\ud83d\udd27 Cooling System Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-06-21",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-24",title:"\ud83d\udc65 Summer Project Review",type:"meeting",time:"1:00 PM"},{date:"2024-06-25",title:"\ud83d\udcca Q2 Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-06-26",title:"\ud83d\udcc5 Summer Safety Training",type:"training",time:"10:00 AM"},{date:"2024-06-28",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-30",title:"\ud83d\udcdd Quarterly Reports Due",type:"deadline",time:"5:00 PM"}].forEach(e=>{e.date===s&&r.push({id:"mock-".concat(e.date,"-").concat(e.type),title:e.title,type:e.type,time:e.time,priority:"medium",color:D(e.type)})}),r},D=e=>{switch(e){case"meeting":return"bg-blue-500";case"training":return"bg-purple-500";case"maintenance":return"bg-orange-500";case"inspection":return"bg-yellow-500";case"deadline":return"bg-red-500";case"project-start":return"bg-green-500";case"project-end":return"bg-emerald-500";case"delivery":return"bg-amber-500";case"labor":return"bg-indigo-500";default:return"bg-gray-500"}},M=e=>"all"===m?e:e.filter(e=>e.type===m),_=e=>{l(t=>{const r=new Date(t);return r.setMonth(t.getMonth()+e),r})},O=e=>e.toDateString()===(new Date).toDateString(),L=e=>e.toDateString()===c.toDateString(),R=()=>{v(!1),f(null)},F=()=>{b(!1),E({title:"",type:"meeting",date:(new Date).toISOString().split("T")[0],time:"09:00",description:"",projectId:"",priority:"medium"})},U=(e,t)=>{E(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))},B=(e=>{const t=e.getFullYear(),r=e.getMonth(),n=new Date(t,r,1),s=new Date(t,r+1,0).getDate(),a=[];for(let i=n.getDay()-1;i>=0;i--){const e=new Date(t,r,-i);a.push({date:e,isCurrentMonth:!1,events:T(e)})}for(let i=1;i<=s;i++){const e=new Date(t,r,i);a.push({date:e,isCurrentMonth:!0,events:T(e)})}const o=42-a.length;for(let i=1;i<=o;i++){const e=new Date(t,r+1,i);a.push({date:e,isCurrentMonth:!1,events:T(e)})}return a})(i);return(0,kt.jsxs)("div",{className:"animate-fade-in w-full max-w-full",children:[(0,kt.jsx)("div",{className:"mb-4 p-4 rounded-xl shadow-lg ".concat(s?"bg-gradient-to-r from-[#1e293b] to-[#334155] border border-[#3b82f6]/20":"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200"),children:(0,kt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-3",children:[(0,kt.jsx)("div",{className:"flex-1",children:(0,kt.jsx)("p",{className:"text-sm ".concat(s?"text-gray-300":"text-gray-600"),children:"Manage schedules, meetings, and important company events"})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"flex rounded-md p-0.5 shadow-md ".concat(s?"bg-[#1e293b] border border-[#3b82f6]/30":"bg-white border border-gray-200"),children:["month","week","day"].map(e=>(0,kt.jsx)("button",{onClick:()=>h(e),className:"px-2 py-0.5 text-xs font-medium rounded transition-all duration-200 ".concat("".concat(u===e?s?"bg-[#3b82f6] text-white shadow-md":"bg-[var(--color-primary-blueprint-blue)] text-white shadow-md":s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100")),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,kt.jsxs)("button",{onClick:()=>{b(!0)},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all duration-200 shadow-lg ".concat(s?"bg-gradient-to-r from-[#3b82f6] to-[#2563eb] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700"),children:[(0,kt.jsx)(rn,{className:"w-3 h-3"}),"Add Event"]})]})]})}),(0,kt.jsx)("div",{className:"mb-3 p-3 rounded-xl shadow-md ".concat(s?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:(0,kt.jsx)("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All Events",icon:"\ud83d\udcc5"},{key:"meeting",label:"Meetings",icon:"\ud83d\udc65"},{key:"training",label:"Training",icon:"\ud83d\udcda"},{key:"maintenance",label:"Maintenance",icon:"\ud83d\udd27"},{key:"inspection",label:"Inspections",icon:"\ud83d\udd0d"},{key:"deadline",label:"Deadlines",icon:"\u23f0"},{key:"project-start",label:"Project Start",icon:"\ud83d\ude80"},{key:"project-end",label:"Project End",icon:"\ud83c\udfc1"},{key:"delivery",label:"Deliveries",icon:"\ud83d\udce6"},{key:"labor",label:"Labor",icon:"\ud83d\udc77"}].map(e=>(0,kt.jsxs)("button",{onClick:()=>p(e.key),className:"flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium transition-all duration-200 shadow-sm ".concat(m===e.key?"".concat(s?"bg-[#3b82f6] text-white shadow-md":"bg-[var(--color-primary-blueprint-blue)] text-white shadow-md"):"".concat(s?"bg-[#374151] text-gray-300 hover:text-white hover:bg-[#4b5563]":"bg-gray-100 text-gray-600 hover:text-gray-800 hover:bg-gray-200")),children:[(0,kt.jsx)("span",{className:"text-xs",children:e.icon}),e.label]},e.key))})}),(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3 p-3 rounded-xl shadow-md ".concat(s?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:[(0,kt.jsx)("button",{onClick:()=>_(-1),className:"p-1.5 rounded-md transition-all duration-200 shadow-sm ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"),children:(0,kt.jsx)(nn,{className:"w-4 h-4"})}),(0,kt.jsx)("h2",{className:"text-base font-bold ".concat(s?"text-white":"text-gray-800"),children:(W=i,W.toLocaleDateString("en-US",{month:"long",year:"numeric"}))}),(0,kt.jsx)("button",{onClick:()=>_(1),className:"p-1.5 rounded-md transition-all duration-200 shadow-sm ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"),children:(0,kt.jsx)(Gm,{className:"w-4 h-4"})})]}),(0,kt.jsxs)("div",{className:"rounded-lg shadow-lg border overflow-hidden ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"grid grid-cols-7 ".concat(s?"bg-gradient-to-r from-[#0f172a] to-[#1e293b] border-b border-[#3b82f6]/40":"bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200"),children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,kt.jsx)("div",{className:"p-2 text-center text-xs font-bold ".concat(s?"text-gray-300":"text-gray-700"),children:e},e))}),(0,kt.jsx)("div",{className:"grid grid-cols-7",children:B.map((e,t)=>(0,kt.jsxs)("div",{onClick:()=>(e=>{d(e)})(e.date),className:"min-h-[60px] p-1 border-r border-b cursor-pointer transition-all duration-200 ".concat(s?"border-[#3b82f6]/20 hover:bg-[#374151]/50":"border-gray-200 hover:bg-blue-50/50"," ").concat(e.isCurrentMonth?"":s?"bg-[#1e293b]/30":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-xs font-bold mb-1 ".concat(O(e.date)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full w-5 h-5 flex items-center justify-center shadow-md":L(e.date)?"".concat(s?"text-blue-400":"text-blue-600"," font-bold"):e.isCurrentMonth?s?"text-white":"text-gray-900":s?"text-gray-500":"text-gray-400"),children:e.date.getDate()}),(0,kt.jsxs)("div",{className:"space-y-0.5",children:[M(e.events).slice(0,1).map(e=>(0,kt.jsxs)("div",{onClick:t=>{t.stopPropagation(),(e=>{f(e),v(!0),e.project&&a&&a(e.project,"Project Workflow",null,"Company Calendar")})(e)},className:"text-xs p-0.5 rounded cursor-pointer transition-all duration-200 ".concat(e.color," text-white hover:opacity-90 shadow-sm"),title:"".concat(e.time," - ").concat(e.title),children:[(0,kt.jsx)("div",{className:"truncate font-medium text-xs",children:e.title}),(0,kt.jsx)("div",{className:"text-xs opacity-90",children:e.time})]},e.id)),M(e.events).length>1&&(0,kt.jsxs)("div",{className:"text-xs px-1 py-0.5 rounded shadow-sm ".concat(s?"bg-gray-600 text-gray-200":"bg-gray-200 text-gray-600"),children:["+",M(e.events).length-1," more"]})]})]},t))})]}),x&&g&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999] backdrop-blur-sm",children:(0,kt.jsx)("div",{className:"rounded-xl shadow-2xl max-w-md w-full mx-4 border ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(s?"text-white":"text-gray-800"),children:"Event Details"}),(0,kt.jsx)("button",{onClick:R,className:"p-2 rounded-lg transition-all duration-200 ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("div",{children:(0,kt.jsx)("div",{className:"inline-block px-3 py-1.5 rounded-lg text-sm font-medium text-white shadow-md ".concat(g.color),children:g.type.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase())})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-bold text-lg mb-2 ".concat(s?"text-white":"text-gray-800"),children:g.title}),(0,kt.jsxs)("p",{className:"text-sm ".concat(s?"text-gray-300":"text-gray-600"),children:[g.time," \u2022 ",c.toLocaleDateString()]})]}),g.project&&(0,kt.jsxs)("div",{className:"p-4 rounded-lg shadow-sm ".concat(s?"bg-[#374151] border border-[#3b82f6]/20":"bg-blue-50 border border-blue-200"),children:[(0,kt.jsx)("p",{className:"text-sm font-bold mb-1 ".concat(s?"text-gray-300":"text-gray-700"),children:"Related Project:"}),(0,kt.jsx)("p",{className:"text-sm ".concat(s?"text-white":"text-gray-800"),children:g.project.name})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:R,className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Close"}),g.project&&(0,kt.jsx)("button",{onClick:()=>{R(),a&&a(g.project,"Project Workflow",null,"Company Calendar")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gradient-to-r from-[#3b82f6] to-[#2563eb] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700"),children:"View Project"})]})]})})}),y&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999] backdrop-blur-sm",children:(0,kt.jsx)("div",{className:"rounded-xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto border ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(s?"text-white":"text-gray-800"),children:"Add New Event"}),(0,kt.jsx)("button",{onClick:F,className:"p-2 rounded-lg transition-all duration-200 ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"space-y-5",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Event Title *"}),(0,kt.jsx)("input",{type:"text",value:C.title,onChange:e=>U("title",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event title"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Event Type"}),(0,kt.jsxs)("select",{value:C.type,onChange:e=>U("type",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"meeting",children:"Meeting"}),(0,kt.jsx)("option",{value:"training",children:"Training"}),(0,kt.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,kt.jsx)("option",{value:"inspection",children:"Inspection"}),(0,kt.jsx)("option",{value:"deadline",children:"Deadline"}),(0,kt.jsx)("option",{value:"project-start",children:"Project Start"}),(0,kt.jsx)("option",{value:"project-end",children:"Project End"}),(0,kt.jsx)("option",{value:"delivery",children:"Delivery"}),(0,kt.jsx)("option",{value:"labor",children:"Labor"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Date"}),(0,kt.jsx)("input",{type:"date",value:C.date,onChange:e=>U("date",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Time"}),(0,kt.jsx)("input",{type:"time",value:C.time,onChange:e=>U("time",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200")})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Priority"}),(0,kt.jsxs)("select",{value:C.priority,onChange:e=>U("priority",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"low",children:"Low"}),(0,kt.jsx)("option",{value:"medium",children:"Medium"}),(0,kt.jsx)("option",{value:"high",children:"High"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Related Project (Optional)"}),(0,kt.jsxs)("select",{value:C.projectId,onChange:e=>U("projectId",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"",children:"No project"}),(t||[]).map(e=>(0,kt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Description (Optional)"}),(0,kt.jsx)("textarea",{value:C.description,onChange:e=>U("description",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event description..."})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:F,className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(C.title.trim())try{const e=C.time,[t,r]=e.split(":"),n=(new Date(2e3,0,1,t,r).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),new Date("".concat(C.date,"T").concat(C.time,":00"))),s=new Date(n.getTime()+36e5),a={title:C.title,description:C.description,startTime:n.toISOString(),endTime:s.toISOString(),eventType:C.type.toUpperCase(),organizerId:null===k||void 0===k?void 0:k.id,projectId:C.projectId||void 0},o=await fetch("/api/calendar-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok)throw new Error("Failed to create event");await o.json();alert('Event "'.concat(C.title,'" created successfully!')),F(),await I()}catch(e){console.error("Error creating event:",e),alert("Failed to create event. Please try again.")}else alert("Please enter an event title")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gradient-to-r from-[#3b82f6] to-[#2563eb] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700"),children:"Create Event"})]})]})})})]});var W},Ym=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})},Qm=e=>{let{projects:t,tasks:r,activities:n,colorMode:s,onProjectSelect:a}=e;const[i,l]=(0,o.useState)(new Date),[c,d]=(0,o.useState)(new Date),[u,h]=(0,o.useState)("month"),[m,p]=(0,o.useState)("all"),[g,f]=(0,o.useState)(null),[x,v]=(0,o.useState)(!1),[y,b]=(0,o.useState)(!1),[w,j]=(0,o.useState)([]),[N,S]=(0,o.useState)(!1),[k,A]=(0,o.useState)(null),[C,E]=(0,o.useState)({title:"",type:"meeting",date:(new Date).toISOString().split("T")[0],time:"09:00",description:"",projectId:"",priority:"medium"});(0,o.useEffect)(()=>{(async()=>{try{const e=await Ds.authService.getCurrentUser();A(e)}catch(e){console.error("Failed to fetch current user:",e)}})()},[]);const P=async()=>{try{S(!0);const e=await fetch("/api/calendar-events");if(e.ok){const t=await e.json(),r=Array.isArray(t)?t:t.data||t.events||[];j(r)}}catch(e){console.error("Error fetching calendar events:",e),j([])}finally{S(!1)}};(0,o.useEffect)(()=>{P()},[]);const I=e=>{const n=[],s=e.toDateString(),a=e.toISOString().split("T")[0];Array.isArray(w)&&w.forEach(e=>{e.date===a&&n.push({id:e._id||"db-event-".concat(e.title),title:e.title,type:e.type,time:e.time,priority:e.priority,color:e.color||T(e.type),description:e.description,projectId:e.projectId})}),t.forEach(e=>{e.startDate&&new Date(e.startDate).toDateString()===s&&n.push({id:"project-start-".concat(e.id),title:"\ud83d\ude80 ".concat(e.projectName||e.name," - Start"),type:"project-start",project:e,time:"9:00 AM",priority:"high",color:"bg-green-500"}),e.endDate&&new Date(e.endDate).toDateString()===s&&n.push({id:"project-end-".concat(e.id),title:"\ud83c\udfc1 ".concat(e.projectName||e.name," - Completion"),type:"project-end",project:e,time:"5:00 PM",priority:"high",color:"bg-emerald-500"}),e.materialsDeliveryStart&&new Date(e.materialsDeliveryStart).toDateString()===s&&n.push({id:"delivery-".concat(e.id),title:"\ud83d\udce6 ".concat(e.projectName||e.name," - Materials"),type:"delivery",project:e,time:"8:00 AM",priority:"medium",color:"bg-amber-500"}),e.laborStart&&new Date(e.laborStart).toDateString()===s&&n.push({id:"labor-".concat(e.id),title:"\ud83d\udc77 ".concat(e.projectName||e.name," - Labor"),type:"labor",project:e,time:"7:00 AM",priority:"medium",color:"bg-indigo-500"})}),r.forEach(e=>{e.alertDate&&new Date(e.alertDate).toDateString()===s&&n.push({id:"task-".concat(e.id),title:"\u26a0\ufe0f ".concat(e.title),type:"task",task:e,time:"12:00 PM",priority:e.priority,color:"high"===e.priority?"bg-red-500":"bg-purple-500"})});return[{date:"2024-01-02",title:"\ud83c\udfe2 New Year Office Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-01-03",title:"\ud83d\udd27 Equipment Calibration",type:"maintenance",time:"8:00 AM"},{date:"2024-01-05",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-08",title:"\ud83d\udc65 Client Consultation - Johnson Roof",type:"meeting",time:"10:00 AM"},{date:"2024-01-09",title:"\ud83d\udcca Monthly Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-01-10",title:"\ud83d\udee0\ufe0f Tool Maintenance Day",type:"maintenance",time:"8:00 AM"},{date:"2024-01-12",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-15",title:"\ud83d\udcc5 Safety Training - Fall Protection",type:"training",time:"10:00 AM"},{date:"2024-01-17",title:"\ud83d\udcdd Permit Application Deadline",type:"deadline",time:"5:00 PM"},{date:"2024-01-19",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-23",title:"\ud83d\udd27 Vehicle Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-01-24",title:"\ud83d\udcca Project Progress Review",type:"meeting",time:"1:00 PM"},{date:"2024-01-26",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-29",title:"\ud83d\udc65 Insurance Agent Meeting",type:"meeting",time:"3:00 PM"},{date:"2024-01-30",title:"\ud83d\udcc5 OSHA Compliance Training",type:"training",time:"9:00 AM"},{date:"2024-01-31",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-02-02",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-05",title:"\ud83d\udc65 Client Meeting - Smith Residence",type:"meeting",time:"10:00 AM"},{date:"2024-02-06",title:"\ud83d\udd27 Equipment Inventory Check",type:"maintenance",time:"8:00 AM"},{date:"2024-02-07",title:"\ud83d\udcca Quarterly Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-02-09",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-12",title:"\ud83d\udc65 Subcontractor Coordination",type:"meeting",time:"11:00 AM"},{date:"2024-02-13",title:"\ud83d\udee0\ufe0f Safety Equipment Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-02-14",title:"\ud83d\udcc5 First Aid Training",type:"training",time:"10:00 AM"},{date:"2024-02-16",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-19",title:"\ud83d\udc65 Site Walkthrough - New Project",type:"inspection",time:"9:00 AM"},{date:"2024-02-20",title:"\ud83d\udcdd Insurance Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-02-21",title:"\ud83d\udd27 Generator Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-02-23",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-26",title:"\ud83d\udc65 Team Building Event",type:"meeting",time:"12:00 PM"},{date:"2024-02-27",title:"\ud83d\udcca Budget Review Meeting",type:"meeting",time:"1:00 PM"},{date:"2024-02-28",title:"\ud83d\udcc5 CPR Certification Renewal",type:"training",time:"9:00 AM"},{date:"2024-02-29",title:"\ud83d\udcdd Monthly Safety Reports",type:"deadline",time:"5:00 PM"},{date:"2024-03-01",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-04",title:"\ud83d\udc65 Client Presentation - Large Project",type:"meeting",time:"10:00 AM"},{date:"2024-03-05",title:"\ud83d\udd27 Compressor Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-03-06",title:"\ud83d\udcca Annual Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-03-08",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-11",title:"\ud83d\udc65 Architect Meeting - Design Review",type:"meeting",time:"11:00 AM"},{date:"2024-03-12",title:"\ud83d\udee0\ufe0f Scaffolding Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-03-13",title:"\ud83d\udcc5 Hazard Communication Training",type:"training",time:"10:00 AM"},{date:"2024-03-15",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-18",title:"\ud83d\udc65 Quality Control Review",type:"meeting",time:"1:00 PM"},{date:"2024-03-19",title:"\ud83d\udcdd Contract Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-03-20",title:"\ud83d\udd27 Welding Equipment Check",type:"maintenance",time:"8:00 AM"},{date:"2024-03-22",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-25",title:"\ud83d\udc65 Site Safety Audit",type:"inspection",time:"9:00 AM"},{date:"2024-03-26",title:"\ud83d\udcca Performance Review Meeting",type:"meeting",time:"2:00 PM"},{date:"2024-03-27",title:"\ud83d\udcc5 Confined Space Training",type:"training",time:"10:00 AM"},{date:"2024-03-29",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-31",title:"\ud83d\udcdd Quarterly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-04-01",title:"\ud83c\udfe2 Spring Safety Kickoff",type:"meeting",time:"8:00 AM"},{date:"2024-04-02",title:"\ud83d\udd27 Spring Equipment Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-04-03",title:"\ud83d\udc65 New Project Kickoff Meeting",type:"meeting",time:"10:00 AM"},{date:"2024-04-05",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-09",title:"\ud83d\udee0\ufe0f Electrical Safety Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-04-10",title:"\ud83d\udcc5 Ladder Safety Training",type:"training",time:"10:00 AM"},{date:"2024-04-12",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-15",title:"\ud83d\udc65 Subcontractor Safety Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-04-16",title:"\ud83d\udcdd Tax Filing Deadline",type:"deadline",time:"5:00 PM"},{date:"2024-04-17",title:"\ud83d\udd27 Crane Inspection",type:"maintenance",time:"8:00 AM"},{date:"2024-04-19",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-22",title:"\ud83d\udc65 Project Completion Review",type:"meeting",time:"1:00 PM"},{date:"2024-04-23",title:"\ud83d\udcca Monthly Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-04-24",title:"\ud83d\udcc5 Personal Protective Equipment Training",type:"training",time:"10:00 AM"},{date:"2024-04-26",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-29",title:"\ud83d\udc65 Insurance Claim Meeting",type:"meeting",time:"3:00 PM"},{date:"2024-04-30",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-05-01",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-03",title:"\ud83d\udc65 Client Meeting - Summer Projects",type:"meeting",time:"10:00 AM"},{date:"2024-05-06",title:"\ud83d\udd27 HVAC System Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-05-07",title:"\ud83d\udcca Q2 Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-05-10",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-13",title:"\ud83d\udc65 Site Safety Walkthrough",type:"inspection",time:"9:00 AM"},{date:"2024-05-14",title:"\ud83d\udcc5 Heat Stress Training",type:"training",time:"10:00 AM"},{date:"2024-05-17",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-20",title:"\ud83d\udc65 Equipment Rental Meeting",type:"meeting",time:"11:00 AM"},{date:"2024-05-21",title:"\ud83d\udcdd Permit Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-05-22",title:"\ud83d\udd27 Excavator Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-05-24",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-27",title:"\ud83d\udc65 Memorial Day Safety Briefing",type:"meeting",time:"8:00 AM"},{date:"2024-05-28",title:"\ud83d\udcca Monthly Progress Review",type:"meeting",time:"1:00 PM"},{date:"2024-05-29",title:"\ud83d\udcc5 Emergency Response Training",type:"training",time:"10:00 AM"},{date:"2024-05-31",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-06-03",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-05",title:"\ud83d\udc65 Summer Project Kickoff",type:"meeting",time:"10:00 AM"},{date:"2024-06-06",title:"\ud83d\udd27 Summer Equipment Prep",type:"maintenance",time:"8:00 AM"},{date:"2024-06-07",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-10",title:"\ud83d\udc65 Client Site Visit - Summer Homes",type:"meeting",time:"11:00 AM"},{date:"2024-06-11",title:"\ud83d\udee0\ufe0f Summer Safety Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-06-12",title:"\ud83d\udcc5 Heat Illness Prevention Training",type:"training",time:"10:00 AM"},{date:"2024-06-14",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-17",title:"\ud83d\udc65 Subcontractor Summer Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-06-18",title:"\ud83d\udcdd Insurance Mid-Year Review",type:"deadline",time:"4:00 PM"},{date:"2024-06-19",title:"\ud83d\udd27 Cooling System Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-06-21",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-24",title:"\ud83d\udc65 Summer Project Review",type:"meeting",time:"1:00 PM"},{date:"2024-06-25",title:"\ud83d\udcca Q2 Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-06-26",title:"\ud83d\udcc5 Summer Safety Training",type:"training",time:"10:00 AM"},{date:"2024-06-28",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-30",title:"\ud83d\udcdd Quarterly Reports Due",type:"deadline",time:"5:00 PM"}].forEach(e=>{e.date===a&&n.push({id:"mock-".concat(e.date,"-").concat(e.type),title:e.title,type:e.type,time:e.time,priority:"medium",color:T(e.type)})}),n},T=e=>{switch(e){case"meeting":return"bg-blue-500";case"training":return"bg-purple-500";case"maintenance":return"bg-orange-500";case"inspection":return"bg-yellow-500";case"deadline":case"task":return"bg-red-500";case"project-start":return"bg-green-500";case"project-end":return"bg-emerald-500";case"delivery":return"bg-amber-500";case"labor":return"bg-indigo-500";default:return"bg-gray-500"}},D=e=>"all"===m?e:e.filter(e=>e.type===m),M=e=>{l(t=>{const r=new Date(t);return r.setMonth(t.getMonth()+e),r})},_=e=>e.toDateString()===(new Date).toDateString(),O=e=>e.toDateString()===c.toDateString(),L=()=>{v(!1),f(null)},R=()=>{b(!1),E({title:"",type:"meeting",date:(new Date).toISOString().split("T")[0],time:"09:00",description:"",projectId:"",priority:"medium"})},F=(e,t)=>{E(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))},U=(e=>{const t=e.getFullYear(),r=e.getMonth(),n=new Date(t,r,1),s=new Date(t,r+1,0).getDate(),a=[];for(let i=n.getDay()-1;i>=0;i--){const e=new Date(t,r,-i);a.push({date:e,isCurrentMonth:!1,events:I(e)})}for(let i=1;i<=s;i++){const e=new Date(t,r,i);a.push({date:e,isCurrentMonth:!0,events:I(e)})}const o=42-a.length;for(let i=1;i<=o;i++){const e=new Date(t,r+1,i);a.push({date:e,isCurrentMonth:!1,events:I(e)})}return a})(i);return(0,kt.jsxs)("div",{className:"animate-fade-in w-full max-w-full",children:[(0,kt.jsx)("div",{className:"mb-4 p-4 rounded-xl shadow-lg ".concat(s?"bg-gradient-to-r from-[#1e293b] to-[#334155] border border-[#3b82f6]/20":"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200"),children:(0,kt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-3",children:[(0,kt.jsx)("div",{className:"flex-1",children:(0,kt.jsx)("p",{className:"text-sm ".concat(s?"text-gray-300":"text-gray-600"),children:"View and manage project alerts in calendar format"})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"flex rounded-md p-0.5 shadow-md ".concat(s?"bg-[#1e293b] border border-[#3b82f6]/30":"bg-white border border-gray-200"),children:["month","week","day"].map(e=>(0,kt.jsx)("button",{onClick:()=>h(e),className:"px-2 py-0.5 text-xs font-medium rounded transition-all duration-200 ".concat("".concat(u===e?s?"bg-[#3b82f6] text-white shadow-md":"bg-[var(--color-primary-blueprint-blue)] text-white shadow-md":s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100")),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,kt.jsxs)("button",{onClick:()=>{b(!0)},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all duration-200 shadow-lg ".concat(s?"bg-gradient-to-r from-[#3b82f6] to-[#2563eb] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700"),children:[(0,kt.jsx)(rn,{className:"w-3 h-3"}),"Add Event"]})]})]})}),(0,kt.jsx)("div",{className:"mb-3 p-3 rounded-xl shadow-md ".concat(s?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:(0,kt.jsx)("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All Events",icon:"\ud83d\udcc5"},{key:"meeting",label:"Meetings",icon:"\ud83d\udc65"},{key:"training",label:"Training",icon:"\ud83d\udcda"},{key:"maintenance",label:"Maintenance",icon:"\ud83d\udd27"},{key:"inspection",label:"Inspections",icon:"\ud83d\udd0d"},{key:"deadline",label:"Deadlines",icon:"\u23f0"},{key:"project-start",label:"Project Start",icon:"\ud83d\ude80"},{key:"project-end",label:"Project End",icon:"\ud83c\udfc1"},{key:"delivery",label:"Deliveries",icon:"\ud83d\udce6"},{key:"labor",label:"Labor",icon:"\ud83d\udc77"},{key:"task",label:"Tasks",icon:"\ud83d\udccb"}].map(e=>(0,kt.jsxs)("button",{onClick:()=>p(e.key),className:"flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium transition-all duration-200 shadow-sm ".concat(m===e.key?"".concat(s?"bg-[#3b82f6] text-white shadow-md":"bg-[var(--color-primary-blueprint-blue)] text-white shadow-md"):"".concat(s?"bg-[#374151] text-gray-300 hover:text-white hover:bg-[#4b5563]":"bg-gray-100 text-gray-600 hover:text-gray-800 hover:bg-gray-200")),children:[(0,kt.jsx)("span",{className:"text-xs",children:e.icon}),e.label]},e.key))})}),(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3 p-3 rounded-xl shadow-md ".concat(s?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:[(0,kt.jsx)("button",{onClick:()=>M(-1),className:"p-1.5 rounded-md transition-all duration-200 shadow-sm ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"),children:(0,kt.jsx)(nn,{className:"w-4 h-4"})}),(0,kt.jsx)("h2",{className:"text-base font-bold ".concat(s?"text-white":"text-gray-800"),children:(B=i,B.toLocaleDateString("en-US",{month:"long",year:"numeric"}))}),(0,kt.jsx)("button",{onClick:()=>M(1),className:"p-1.5 rounded-md transition-all duration-200 shadow-sm ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"),children:(0,kt.jsx)(Ym,{className:"w-4 h-4"})})]}),(0,kt.jsxs)("div",{className:"rounded-lg shadow-lg border overflow-hidden ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"grid grid-cols-7 ".concat(s?"bg-gradient-to-r from-[#0f172a] to-[#1e293b] border-b border-[#3b82f6]/40":"bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200"),children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,kt.jsx)("div",{className:"p-2 text-center text-xs font-bold ".concat(s?"text-gray-300":"text-gray-700"),children:e},e))}),(0,kt.jsx)("div",{className:"grid grid-cols-7",children:U.map((e,t)=>(0,kt.jsxs)("div",{onClick:()=>(e=>{d(e)})(e.date),className:"min-h-[60px] p-1 border-r border-b cursor-pointer transition-all duration-200 ".concat(s?"border-[#3b82f6]/20 hover:bg-[#374151]/50":"border-gray-200 hover:bg-blue-50/50"," ").concat(e.isCurrentMonth?"":s?"bg-[#1e293b]/30":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-xs font-bold mb-1 ".concat(_(e.date)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full w-5 h-5 flex items-center justify-center shadow-md":O(e.date)?"".concat(s?"text-blue-400":"text-blue-600"," font-bold"):e.isCurrentMonth?s?"text-white":"text-gray-900":s?"text-gray-500":"text-gray-400"),children:e.date.getDate()}),(0,kt.jsxs)("div",{className:"space-y-0.5",children:[D(e.events).slice(0,1).map(e=>(0,kt.jsxs)("div",{onClick:t=>{t.stopPropagation(),(e=>{f(e),v(!0),e.project&&a&&a(e.project,"Project Workflow",null,"Alerts Calendar")})(e)},className:"text-xs p-0.5 rounded cursor-pointer transition-all duration-200 ".concat(e.color," text-white hover:opacity-90 shadow-sm"),title:"".concat(e.time," - ").concat(e.title),children:[(0,kt.jsx)("div",{className:"truncate font-medium text-xs",children:e.title}),(0,kt.jsx)("div",{className:"text-xs opacity-90",children:e.time})]},e.id)),D(e.events).length>1&&(0,kt.jsxs)("div",{className:"text-xs px-1 py-0.5 rounded shadow-sm ".concat(s?"bg-gray-600 text-gray-200":"bg-gray-200 text-gray-600"),children:["+",D(e.events).length-1," more"]})]})]},t))})]}),x&&g&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999] backdrop-blur-sm",children:(0,kt.jsx)("div",{className:"rounded-xl shadow-2xl max-w-md w-full mx-4 border ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(s?"text-white":"text-gray-800"),children:"Event Details"}),(0,kt.jsx)("button",{onClick:L,className:"p-2 rounded-lg transition-all duration-200 ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("div",{children:(0,kt.jsx)("div",{className:"inline-block px-3 py-1.5 rounded-lg text-sm font-medium text-white shadow-md ".concat(g.color),children:g.type.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase())})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-bold text-lg mb-2 ".concat(s?"text-white":"text-gray-800"),children:g.title}),(0,kt.jsxs)("p",{className:"text-sm ".concat(s?"text-gray-300":"text-gray-600"),children:[g.time," \u2022 ",c.toLocaleDateString()]})]}),g.project&&(0,kt.jsxs)("div",{className:"p-4 rounded-lg shadow-sm ".concat(s?"bg-[#374151] border border-[#3b82f6]/20":"bg-blue-50 border border-blue-200"),children:[(0,kt.jsx)("p",{className:"text-sm font-bold mb-1 ".concat(s?"text-gray-300":"text-gray-700"),children:"Related Project:"}),(0,kt.jsx)("p",{className:"text-sm ".concat(s?"text-white":"text-gray-800"),children:g.project.name})]}),g.task&&(0,kt.jsxs)("div",{className:"p-4 rounded-lg shadow-sm ".concat(s?"bg-[#374151] border border-[#3b82f6]/20":"bg-purple-50 border border-purple-200"),children:[(0,kt.jsx)("p",{className:"text-sm font-bold mb-1 ".concat(s?"text-gray-300":"text-gray-700"),children:"Related Task:"}),(0,kt.jsx)("p",{className:"text-sm ".concat(s?"text-white":"text-gray-800"),children:g.task.title})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:L,className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Close"}),g.project&&(0,kt.jsx)("button",{onClick:()=>{L(),a&&a(g.project,"Project Workflow",null,"Alerts Calendar")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gradient-to-r from-[#3b82f6] to-[#2563eb] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700"),children:"View Project"})]})]})})}),y&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999] backdrop-blur-sm",children:(0,kt.jsx)("div",{className:"rounded-xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto border ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(s?"text-white":"text-gray-800"),children:"Add New Event"}),(0,kt.jsx)("button",{onClick:R,className:"p-2 rounded-lg transition-all duration-200 ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"space-y-5",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Event Title *"}),(0,kt.jsx)("input",{type:"text",value:C.title,onChange:e=>F("title",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event title"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Event Type"}),(0,kt.jsxs)("select",{value:C.type,onChange:e=>F("type",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"meeting",children:"Meeting"}),(0,kt.jsx)("option",{value:"training",children:"Training"}),(0,kt.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,kt.jsx)("option",{value:"inspection",children:"Inspection"}),(0,kt.jsx)("option",{value:"deadline",children:"Deadline"}),(0,kt.jsx)("option",{value:"project-start",children:"Project Start"}),(0,kt.jsx)("option",{value:"project-end",children:"Project End"}),(0,kt.jsx)("option",{value:"delivery",children:"Delivery"}),(0,kt.jsx)("option",{value:"labor",children:"Labor"}),(0,kt.jsx)("option",{value:"task",children:"Task"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Date"}),(0,kt.jsx)("input",{type:"date",value:C.date,onChange:e=>F("date",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Time"}),(0,kt.jsx)("input",{type:"time",value:C.time,onChange:e=>F("time",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200")})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Priority"}),(0,kt.jsxs)("select",{value:C.priority,onChange:e=>F("priority",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"low",children:"Low"}),(0,kt.jsx)("option",{value:"medium",children:"Medium"}),(0,kt.jsx)("option",{value:"high",children:"High"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Related Project (Optional)"}),(0,kt.jsxs)("select",{value:C.projectId,onChange:e=>F("projectId",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"",children:"No project"}),(t||[]).map(e=>(0,kt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Description (Optional)"}),(0,kt.jsx)("textarea",{value:C.description,onChange:e=>F("description",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event description..."})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:R,className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(C.title.trim())try{const e=C.time,[t,r]=e.split(":"),n=(new Date(2e3,0,1,t,r).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),new Date("".concat(C.date,"T").concat(C.time,":00"))),s=new Date(n.getTime()+36e5),a={title:C.title,description:C.description,startTime:n.toISOString(),endTime:s.toISOString(),eventType:C.type.toUpperCase(),organizerId:null===k||void 0===k?void 0:k.id,projectId:C.projectId||void 0},o=await fetch("/api/calendar-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok)throw new Error("Failed to create event");await o.json();alert('Event "'.concat(C.title,'" created successfully!')),R(),await P()}catch(e){console.error("Error creating event:",e),alert("Failed to create event. Please try again.")}else alert("Please enter an event title")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gradient-to-r from-[#3b82f6] to-[#2563eb] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700"),children:"Create Event"})]})]})})})]});var B};function Xm(e,t){const r=new Date(e),n=new Date(t);return"".concat(r.toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ").concat(n.toLocaleDateString("en-US",{month:"short",day:"numeric"}))}function $m(e){return{Roofing:"bg-blue-500",Siding:"bg-green-500",Decking:"bg-yellow-500",Renovation:"bg-purple-500",Remodeling:"bg-pink-500",Electrical:"bg-orange-500",Plumbing:"bg-teal-500"}[e]||"bg-gray-500"}function Zm(e){switch(e){case"lead":return(0,kt.jsx)(Gr,{className:"w-4 h-4 text-purple-500"});case"prospect":return(0,kt.jsx)(Gr,{className:"w-4 h-4 text-orange-500"});case"approved":return(0,kt.jsx)(on,{className:"w-4 h-4 text-green-500"});case"execution":return(0,kt.jsx)(on,{className:"w-4 h-4 text-blue-500"});case"supplement":return(0,kt.jsx)(Gr,{className:"w-4 h-4 text-yellow-500"});case"completion":return(0,kt.jsx)(on,{className:"w-4 h-4 text-teal-500"});default:return(0,kt.jsx)(Gr,{className:"w-4 h-4 text-gray-400"})}}function ep(e){const t=new Date,r=new Date(e.materialsDeliveryStart),n=new Date(e.materialsDeliveryEnd);return t<r?{status:"pending",icon:"\u23f3",text:"Pending"}:t>=r&&t<=n?{status:"transit",icon:"\ud83d\ude9a",text:"In Transit"}:{status:"delivered",icon:"\u2714\ufe0f",text:"Delivered"}}function tp(e){const t=new Date,r=new Date(e.laborStart||e.startDate),n=new Date(e.laborEnd||e.endDate);return t<r?{status:"scheduled",icon:"\ud83d\udcc5",text:"Scheduled"}:t>=r&&t<=n?{status:"active",icon:"\ud83d\udee0\ufe0f",text:"In Progress"}:{status:"completed",icon:"\u2705",text:"Completed"}}function rp(){var e,t,n;const[s,a]=(0,o.useState)(null),[i,l]=(0,o.useState)(new Date),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)(""),[g,f]=(0,o.useState)(null),[x,v]=(0,o.useState)("weekly"),[y,b]=(0,o.useState)(!0),[w,j]=(0,o.useState)(""),[N,S]=(0,o.useState)(""),[k,A]=(0,o.useState)(""),[C,E]=(0,o.useState)(""),[P,I]=(0,o.useState)(!1),[T,D]=(0,o.useState)("materials"),[M,_]=(0,o.useState)(null),[O,L]=(0,o.useState)(null),[R,F]=(0,o.useState)(null),[U,B]=(0,o.useState)([]);(0,o.useEffect)(()=>{(async()=>{try{console.log("\ud83d\udd0d PROJECT SCHEDULES: Fetching workflow phases for status filter...");const e=(await Promise.resolve().then(r.bind(r,505))).default,t=(await e.get("/workflow-data/phases")).data;if(null===t||void 0===t||!t.success||!t.data)throw new Error("Invalid response format");{const e=t.data.map(e=>({id:e.id,name:e.name,displayName:e.displayName||e.name}));B(e),console.log("\u2705 PROJECT SCHEDULES: Loaded workflow phases from database:",e)}}catch(e){console.error("\u274c PROJECT SCHEDULES: Failed to fetch workflow phases:",e);B([{id:"LEAD",name:"LEAD",displayName:"Lead Phase"},{id:"PROSPECT",name:"PROSPECT",displayName:"Prospect"},{id:"APPROVED",name:"APPROVED",displayName:"Approved Phase"},{id:"EXECUTION",name:"EXECUTION",displayName:"Execution Phase"},{id:"COMPLETION",name:"COMPLETION",displayName:"Completion Phase"}]),console.log("\u26a0\ufe0f PROJECT SCHEDULES: Using fallback workflow phases due to API error")}})()},[]);const[W,z]=(0,o.useState)(()=>{const e=localStorage.getItem("projectSchedules");if(e)try{const t=JSON.parse(e);return[].map(e=>{const r=t.find(t=>t.id===e.id);return r?(0,Y.A)((0,Y.A)({},e),{},{laborStart:r.laborStart,laborEnd:r.laborEnd,materialsDeliveryStart:r.materialsDeliveryStart,materialsDeliveryEnd:r.materialsDeliveryEnd}):e})}catch(t){return console.error("Error loading saved schedules:",t),[]}return[]}),V=async()=>{try{b(!0);const e="localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname?"".concat(window.location.protocol,"//").concat(window.location.host):{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL||"http://localhost:8000",t=await fetch("".concat(e,"/api/schedules"));if(t.ok){const e=await t.json();console.log("Loaded schedules from backend:",e);const r=(W||[]).map(t=>{const r=e.find(e=>e.projectId===t.id);return r?(0,Y.A)((0,Y.A)({},t),{},{laborStart:r.laborStart,laborEnd:r.laborEnd,materialsDeliveryStart:r.materialsDeliveryStart,materialsDeliveryEnd:r.materialsDeliveryEnd}):t});z(r),H(r)}}catch(e){console.error("Error loading schedules from backend:",e)}finally{b(!1)}};(0,o.useEffect)(()=>{V()},[]),(0,o.useEffect)(()=>{const e=e=>{if(M){const t=e.target.closest("td");if(t){const e=parseInt(t.getAttribute("data-project-id")),r=parseInt(t.getAttribute("data-day-idx"));e&&void 0!==r&&e===M.projectId&&L({projectId:e,dayIdx:r})}}};return M&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",()=>{_(null),L(null)})),()=>{document.removeEventListener("mousemove",e)}},[M]);const H=e=>{try{const t=(e||[]).map(e=>({id:e.id,laborStart:e.laborStart,laborEnd:e.laborEnd,materialsDeliveryStart:e.materialsDeliveryStart,materialsDeliveryEnd:e.materialsDeliveryEnd}));localStorage.setItem("projectSchedules",JSON.stringify(t))}catch(t){console.error("Error saving schedules to localStorage:",t)}},q=new Date(i);q.setDate(i.getDate()-i.getDay());const K=function(e){const t=[],r=new Date(e);for(let n=0;n<7;n++){const e=new Date(r);e.setDate(r.getDate()+n),t.push(new Date(e))}return t}(q),G=(0,o.useMemo)(()=>{const e=new Set;return(W||[]).forEach(t=>{t.type&&e.add(t.type)}),Array.from(e)},[W]),J=(0,o.useMemo)(()=>(W||[]).filter(e=>{var t;const r=(c||"").toLowerCase(),n=!r||(e.name||"").toLowerCase().includes(r)||((null===(t=e.client)||void 0===t?void 0:t.name)||"").toLowerCase().includes(r)||(e.location||"").toLowerCase().includes(r),s=!u||e.type===u,a=!m||e.status===m;return n&&s&&a}),[W,c,u,m]),Q=J.filter(e=>!e.materialsDeliveryStart&&!e.laborStart&&!e.startDate),X=(e,t,r)=>{f((0,Y.A)((0,Y.A)({},t),{},{type:r})),D(r),e.dataTransfer.effectAllowed="move"},$=async(e,t)=>{if(console.log("Mouse up on project",e,"day",t),console.log("Drag start:",M),console.log("Drag end:",O),console.log("Selected type:",T),M&&M.projectId===e){const r=O||{projectId:e,dayIdx:t},n=Math.min(M.dayIdx,r.dayIdx),s=Math.max(M.dayIdx,r.dayIdx),a=K[n],o=K[s];console.log("Scheduling range:",n,"to",s),console.log("Start day:",a),console.log("End day:",o);const i={projectId:e,laborStart:"labor"===T?a.toISOString():void 0,laborEnd:"labor"===T?o.toISOString():void 0,materialsDeliveryStart:"materials"===T?a.toISOString():void 0,materialsDeliveryEnd:"materials"===T?o.toISOString():void 0};console.log("Sending payload:",i);try{const t="localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname?"".concat(window.location.protocol,"//").concat(window.location.host):{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL||"http://localhost:8000",r=await fetch("".concat(t,"/api/schedules"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!r.ok){const e=await r.text();throw console.error("Server response:",r.status,e),new Error("Failed to save schedule: ".concat(r.status," ").concat(e))}const n=await r.json();console.log("Schedule saved successfully:",n);const s=W.map(t=>t.id!==e?t:"materials"===T?(0,Y.A)((0,Y.A)({},t),{},{materialsDeliveryStart:a.toISOString(),materialsDeliveryEnd:o.toISOString()}):(0,Y.A)((0,Y.A)({},t),{},{laborStart:a.toISOString(),laborEnd:o.toISOString()}));z(s),H(s),alert("Successfully scheduled ".concat(T," for ").concat(a.toLocaleDateString()," to ").concat(o.toLocaleDateString()))}catch(ES){console.error("Error saving schedule:",ES),alert("Error saving schedule to backend: "+ES.message)}_(null),L(null)}};return(0,kt.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",style:{overflow:"hidden"},children:[y&&(0,kt.jsx)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,kt.jsx)("span",{className:"text-blue-700",children:"Loading schedules from server..."})]})}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Project Schedules"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Drag materials and labor buttons to schedule projects"})]}),(0,kt.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("button",{className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[(0,kt.jsx)(fn,{className:"w-4 h-4"}),"Add Project"]}),(0,kt.jsxs)("select",{value:x,onChange:e=>v(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,kt.jsx)("option",{value:"weekly",children:"Weekly View"}),(0,kt.jsx)("option",{value:"daily",children:"Daily View"}),(0,kt.jsx)("option",{value:"monthly",children:"Monthly View"})]})]})}),(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("button",{onClick:()=>{l(new Date)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Today"}),(0,kt.jsxs)("button",{onClick:V,disabled:y,className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{const e=new Date(i);e.setDate(i.getDate()-7),l(e)},className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,kt.jsx)(nn,{className:"w-5 h-5"})}),(0,kt.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:Xm(q,new Date(q.getTime()+5184e5))}),(0,kt.jsx)("button",{onClick:()=>{const e=new Date(i);e.setDate(i.getDate()+7),l(e)},className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,kt.jsx)(gn,{className:"w-5 h-5"})})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)(pn,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,kt.jsx)("input",{type:"text",placeholder:"Search projects...",value:c,onChange:e=>d(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-64"})]}),(0,kt.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,kt.jsx)("option",{value:"",children:"All Trades"}),G.map(e=>(0,kt.jsx)("option",{value:e,children:e},e))]}),(0,kt.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,kt.jsx)("option",{value:"",children:"All Status"}),U.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.displayName},e.id))]})]})]})]}),(0,kt.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,kt.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,kt.jsx)("span",{className:"font-semibold text-blue-800",children:"How to Schedule:"})]}),(0,kt.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,kt.jsxs)("p",{children:["\u2022 Drag the ",(0,kt.jsx)("span",{className:"font-semibold",children:"Materials"})," or ",(0,kt.jsx)("span",{className:"font-semibold",children:"Labor"})," buttons from each project row"]}),(0,kt.jsx)("p",{children:"\u2022 Drop them onto the calendar days to schedule delivery or work"}),(0,kt.jsx)("p",{children:"\u2022 Drag across multiple days to schedule longer periods"})]})]}),(0,kt.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:(0,kt.jsx)("div",{className:"overflow-x-auto",style:{overflowY:"hidden"},children:(0,kt.jsxs)("table",{className:"min-w-full table-fixed",style:{tableLayout:"fixed"},children:[(0,kt.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("th",{className:"sticky left-0 z-20 bg-gray-50 border-r border-gray-200 px-4 py-2 text-left text-sm font-semibold text-gray-900 w-64",children:"Projects"}),K.map((e,t)=>(0,kt.jsx)("th",{className:"px-4 py-4 text-center text-sm font-semibold text-gray-900 w-32",children:(0,kt.jsxs)("div",{className:"flex flex-col items-center",children:[(0,kt.jsx)("span",{className:"text-gray-500 text-xs",children:e.toLocaleDateString("en-US",{weekday:"short"})}),(0,kt.jsx)("span",{className:"text-lg font-bold",children:e.getDate()})]})},t))]})}),(0,kt.jsxs)("tbody",{children:[J.map((e,t)=>{var r,n;return(0,kt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,kt.jsx)("td",{className:"sticky left-0 z-10 bg-white border-r border-gray-200 px-3 py-2 align-top group",onMouseEnter:()=>F(e.id),onMouseLeave:()=>F(null),children:(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ".concat($m(e.type)),children:(null===(r=e.type)||void 0===r?void 0:r[0])||"P"}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900 truncate",children:e.name}),(0,kt.jsx)("div",{className:"text-xs text-gray-600 truncate",children:null===(n=e.client)||void 0===n?void 0:n.name}),(0,kt.jsxs)("div",{className:"flex gap-1 mt-1",children:[(0,kt.jsxs)("button",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded bg-blue-100 hover:bg-blue-200 text-blue-700 text-xs font-semibold cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:t=>X(t,e,"materials"),title:"Drag to schedule materials delivery",children:[(0,kt.jsx)(xn,{className:"w-3 h-3"})," Materials"]}),(0,kt.jsxs)("button",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded bg-green-100 hover:bg-green-200 text-green-700 text-xs font-semibold cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:t=>X(t,e,"labor"),title:"Drag to schedule labor",children:[(0,kt.jsx)(vn,{className:"w-3 h-3"})," Labor"]})]})]})]})}),K.map((t,r)=>{const n=function(e,t){if(!e.materialsDeliveryStart||!e.materialsDeliveryEnd)return!1;const r=new Date(e.materialsDeliveryStart),n=new Date(e.materialsDeliveryEnd);return r<=t&&t<=n}(e,t),s=function(e,t){if(!e.laborStart||!e.laborEnd)return!1;const r=new Date(e.laborStart),n=new Date(e.laborEnd);return r<=t&&t<=n}(e,t),o=((e,t)=>{if(!M||!O)return!1;if(M.projectId!==e)return!1;const r=Math.min(M.dayIdx,O.dayIdx),n=Math.max(M.dayIdx,O.dayIdx);return t>=r&&t<=n})(e.id,r);return(0,kt.jsx)("td",{className:"align-top px-2 py-2 w-32 h-20 border-r border-gray-100 ".concat(o?"materials"===T?"bg-blue-200":"bg-green-200":""),"data-project-id":e.id,"data-day-idx":r,onMouseDown:()=>{return t=e.id,n=r,console.log("Mouse down on project",t,"day",n,"type",T),_({projectId:t,dayIdx:n}),void L({projectId:t,dayIdx:n});var t,n},onMouseEnter:()=>{return t=e.id,n=r,void(M&&M.projectId===t&&(console.log("Mouse enter on project",t,"day",n),L({projectId:t,dayIdx:n})));var t,n},onMouseMove:()=>{return t=e.id,n=r,void(M&&M.projectId===t&&(console.log("Mouse move on project",t,"day",n),L({projectId:t,dayIdx:n})));var t,n},onMouseUp:()=>$(e.id,r),onDragOver:e=>{e.preventDefault(),e.currentTarget.style.backgroundColor=g?"materials"===g.type?"#dbeafe":"#dcfce7":""},onDragLeave:e=>{e.currentTarget.style.backgroundColor=""},onDrop:t=>{t.preventDefault(),t.currentTarget.style.backgroundColor="",g&&$(e.id,r)},style:{cursor:"pointer",userSelect:"none"},children:(0,kt.jsxs)("div",{className:"space-y-2",children:[n&&(0,kt.jsx)("div",{className:"group cursor-pointer",onClick:()=>a(e),children:(0,kt.jsxs)("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-2 shadow-sm hover:shadow-md transition-all duration-200",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,kt.jsx)(xn,{className:"w-3 h-3 text-blue-600"}),(0,kt.jsx)("span",{className:"text-xs font-medium text-blue-800",children:"Materials"})]}),(0,kt.jsx)("div",{className:"text-xs text-blue-700",children:ep(e).text})]})}),s&&(0,kt.jsx)("div",{className:"group cursor-pointer",onClick:()=>a(e),children:(0,kt.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded-lg p-2 shadow-sm hover:shadow-md transition-all duration-200",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,kt.jsx)(vn,{className:"w-3 h-3 text-green-600"}),(0,kt.jsx)("span",{className:"text-xs font-medium text-green-800",children:"Labor"})]}),(0,kt.jsx)("div",{className:"text-xs text-green-700",children:tp(e).text})]})}),!n&&!s&&(0,kt.jsx)("div",{className:"h-12 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 cursor-pointer flex items-center justify-center",style:{minHeight:"48px"},onDragOver:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#3b82f6",e.currentTarget.style.backgroundColor="#eff6ff"},onDragLeave:e=>{e.currentTarget.style.borderColor="",e.currentTarget.style.backgroundColor=""},onDrop:t=>{t.preventDefault(),t.currentTarget.style.borderColor="",t.currentTarget.style.backgroundColor="",g&&$(e.id,r)},children:(0,kt.jsx)("span",{className:"text-xs text-gray-400",children:"Drop to schedule"})})]})},r)})]},e.id)}),Q.length>0&&(0,kt.jsxs)("tr",{className:"border-t-2 border-yellow-300 bg-yellow-50",children:[(0,kt.jsx)("td",{className:"sticky left-0 z-10 bg-yellow-50 border-r border-gray-200 px-6 py-4 align-top",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm bg-yellow-500",children:"?"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold text-yellow-900",children:"Unscheduled Projects"}),(0,kt.jsxs)("div",{className:"text-xs text-yellow-700",children:[Q.length," projects"]})]})]})}),(0,kt.jsx)("td",{colSpan:K.length,className:"px-4 py-4",children:(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Q.map(e=>{var t,r;return(0,kt.jsx)("div",{draggable:!0,onDragStart:t=>X(t,e,"materials"),className:"group cursor-pointer",onClick:()=>a(e),children:(0,kt.jsxs)("div",{className:"rounded-lg p-3 shadow-sm border border-yellow-300 bg-white hover:shadow-md transition-all duration-200",children:[(0,kt.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"font-semibold text-sm text-gray-900 truncate",children:e.name}),(0,kt.jsx)("div",{className:"text-xs text-gray-600 truncate",children:null===(t=e.client)||void 0===t?void 0:t.name})]}),Zm(e.status)]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,kt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat($m(e.type)," text-white"),children:e.type}),(0,kt.jsxs)("span",{className:"text-gray-600",children:["$",null===(r=e.estimateValue)||void 0===r?void 0:r.toLocaleString()]})]})]})},e.id)})})})]})]})]})})}),s&&(0,kt.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,kt.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ".concat($m(s.type)),children:(null===(e=s.type)||void 0===e?void 0:e[0])||"P"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:s.name}),(0,kt.jsx)("p",{className:"text-sm text-gray-600",children:s.type})]})]}),(0,kt.jsx)("button",{onClick:()=>a(null),className:"text-gray-400 hover:text-gray-600",children:(0,kt.jsx)($r,{className:"w-6 h-6"})})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"Project Details"}),(0,kt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Client:"}),(0,kt.jsx)("span",{className:"font-medium",children:null===(t=s.client)||void 0===t?void 0:t.name})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Location:"}),(0,kt.jsx)("span",{className:"font-medium",children:s.location})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Project Manager:"}),(0,kt.jsx)("span",{className:"font-medium",children:s.projectManager?"".concat(s.projectManager.firstName," ").concat(s.projectManager.lastName):"Not Assigned"})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Value:"}),(0,kt.jsxs)("span",{className:"font-medium",children:["$",null===(n=s.estimateValue)||void 0===n?void 0:n.toLocaleString()]})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"Schedule & Status"}),(0,kt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Labor Period:"}),(0,kt.jsx)("span",{className:"font-medium",children:s.laborStart?Xm(s.laborStart,s.laborEnd):"Not Scheduled"})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Materials:"}),(0,kt.jsx)("span",{className:"font-medium",children:s.materialsDeliveryStart?Xm(s.materialsDeliveryStart,s.materialsDeliveryEnd):"Not Scheduled"})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Progress:"}),(0,kt.jsxs)("span",{className:"font-medium",children:[s.progress||0,"%"]})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,kt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("active"===s.status?"bg-green-100 text-green-800":"planning"===s.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})]})]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"Progress"}),(0,kt.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,kt.jsx)("div",{className:"bg-[var(--color-primary-blueprint-blue)] h-3 rounded-full transition-all duration-500",style:{width:"".concat(s.progress||0,"%")}})}),(0,kt.jsxs)("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[(0,kt.jsx)("span",{children:"0%"}),(0,kt.jsx)("span",{children:"100%"})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3",children:[(0,kt.jsx)("button",{className:"flex-1 px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 font-medium",children:"Edit Project"}),s.materialsDeliveryStart?(0,kt.jsx)("button",{className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium",onClick:()=>{const e=(0,Y.A)((0,Y.A)({},s),{},{materialsDeliveryStart:null,materialsDeliveryEnd:null}),t=W.map(t=>t.id===s.id?e:t);z(t),H(t),a(null)},children:"Clear Materials"}):(0,kt.jsx)("button",{className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",onClick:()=>{D("materials"),I(!0)},children:"Schedule Materials"}),s.laborStart?(0,kt.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium",onClick:()=>{const e=(0,Y.A)((0,Y.A)({},s),{},{laborStart:null,laborEnd:null}),t=W.map(t=>t.id===s.id?e:t);z(t),H(t),a(null)},children:"Clear Labor"}):(0,kt.jsx)("button",{className:"px-4 py-2 bg-[var(--color-success-green)] text-white rounded-lg hover:bg-green-700 font-medium",onClick:()=>{D("labor"),I(!0)},children:"Schedule Labor"})]})]})})}),P&&(0,kt.jsx)("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/50",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:["Schedule ","materials"===T?"Materials Delivery":"Labor"]}),(0,kt.jsx)("button",{onClick:()=>{I(!1),j(""),S(""),A(""),E("")},className:"text-gray-400 hover:text-gray-600",children:(0,kt.jsx)($r,{className:"w-6 h-6"})})]}),"materials"===T?(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Materials Delivery Start Date"}),(0,kt.jsx)("input",{type:"date",value:w,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Materials Delivery End Date"}),(0,kt.jsx)("input",{type:"date",value:N,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,kt.jsx)("button",{onClick:()=>(e=>{if(!e||!w||!N)return;console.log("Scheduling materials for:",e.name,"from",w,"to",N);const t=W.map(t=>t.id===e.id?(0,Y.A)((0,Y.A)({},t),{},{materialsDeliveryStart:w,materialsDeliveryEnd:N}):t);console.log("Updated projects:",t),z(t),a(null),I(!1),j(""),S(""),H(t)})(s),disabled:!w||!N,className:"w-full px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 font-medium disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Schedule Materials"})]}):(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Labor Start Date"}),(0,kt.jsx)("input",{type:"date",value:k,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Labor End Date"}),(0,kt.jsx)("input",{type:"date",value:C,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),(0,kt.jsx)("button",{onClick:()=>(e=>{if(!e||!k||!C)return;console.log("Scheduling labor for:",e.name,"from",k,"to",C);const t=W.map(t=>t.id===e.id?(0,Y.A)((0,Y.A)({},t),{},{laborStart:k,laborEnd:C}):t);console.log("Updated projects:",t),z(t),a(null),I(!1),A(""),E(""),H(t)})(s),disabled:!k||!C,className:"w-full px-4 py-2 bg-[var(--color-success-green)] text-white rounded-lg hover:bg-green-700 font-medium disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Schedule Labor"})]})]})})]})}const np=["title","titleId"];function sp(e,t){let{title:r,titleId:n}=e,s=Sn(e,np);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"}))}const ap=o.forwardRef(sp),op=()=>{const[e,t]=(0,o.useState)([]),[r,n]=(0,o.useState)([]),[s,a]=(0,o.useState)(!0),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)([]),[m,p]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1),[x,v]=(0,o.useState)([]),[y,b]=(0,o.useState)(!1),[w,j]=(0,o.useState)(null),[N,S]=(0,o.useState)(null),[k,A]=(0,o.useState)(new Set),[C,E]=(0,o.useState)(""),[P,I]=(0,o.useState)(null),[T,D]=(0,o.useState)(!1),M=async()=>{try{const e=await _s.assetsService.list({type:"FOLDER",limit:100});t((null===e||void 0===e?void 0:e.assets)||[])}catch(ES){console.error("Failed to load folders")}},_=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a(!0);try{const t=await _s.assetsService.list({parentId:e,search:i,limit:50});n((null===t||void 0===t?void 0:t.assets)||[]),h((null===t||void 0===t?void 0:t.breadcrumbs)||[])}catch(ES){Vr.error("Failed to load items")}finally{a(!1)}};(0,o.useEffect)(()=>{M()},[]),(0,o.useEffect)(()=>{_(c)},[c,i]),(0,o.useEffect)(()=>{const e=e=>{console.log("\ud83d\udd04 Documents & Resources received refresh event:",e.detail),M(),_(c)};return window.addEventListener("fm:refresh",e),()=>window.removeEventListener("fm:refresh",e)},[c]),(0,o.useEffect)(()=>{},[]);const O=async e=>{if(window.confirm("Delete this item?"))try{await _s.assetsService.bulkOperation({operation:"delete",assetIds:[e]}),await Promise.all([_(c),M()]),Vr.success("Deleted")}catch(ES){Vr.error("Delete failed")}},L=async()=>{if(C.trim()){console.log("Creating folder with:",{name:C,parentId:c});try{const e=await _s.assetsService.createFolder({name:C,parentId:c});console.log("Folder created successfully:",e),E(""),await Promise.all([M(),_(c)]),Vr.success('Folder "'.concat(C,'" created successfully!'))}catch(ES){var e,t,r,n,s,a,o,i,l,d;if(console.error("Failed to create folder:",{error:ES,response:null===(e=ES.response)||void 0===e?void 0:e.data,status:null===(t=ES.response)||void 0===t?void 0:t.status}),400===(null===(r=ES.response)||void 0===r?void 0:r.status))null!==(a=ES.response)&&void 0!==a&&null!==(o=a.data)&&void 0!==o&&null!==(i=o.message)&&void 0!==i&&i.toLowerCase().includes("already exists")?Vr.error('A folder named "'.concat(C,'" already exists in this location')):null!==(l=ES.response)&&void 0!==l&&null!==(d=l.data)&&void 0!==d&&d.message?Vr.error(ES.response.data.message):Vr.error("Invalid folder name. Please try a different name.");else if(401===(null===(n=ES.response)||void 0===n?void 0:n.status))Vr.error("Please log in to create folders");else if(403===(null===(s=ES.response)||void 0===s?void 0:s.status))Vr.error("You do not have permission to create folders here");else if("Network Error"===ES.message)Vr.error("Unable to connect to the server. Please check your connection.");else{var u,h;Vr.error((null===(u=ES.response)||void 0===u||null===(h=u.data)||void 0===h?void 0:h.message)||"Failed to create folder. Please try again.")}}}else Vr.error("Please enter a folder name")},R=(e,t)=>{j(t),e.dataTransfer.effectAllowed="move"},F=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},U=async(e,t)=>{if(e.preventDefault(),e.stopPropagation(),!w)return;if(w.id===t)return j(null),void S(null);const r=null!==t&&void 0!==t?t:null;if(w.parentId===r)return j(null),void S(null);try{await _s.assetsService.bulkOperation({operation:"move",assetIds:[w.id],data:{parentId:r}}),await M(),await _(c),Vr.success("Moved ".concat(w.title))}catch(ES){Vr.error("Move failed")}finally{j(null),S(null)}},B=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e.filter(e=>(e.parentId||null)===t)},W=r.filter(e=>"FOLDER"===e.type),z=r.filter(e=>"FOLDER"!==e.type),V=W.filter(e=>{var t;return null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase())}),H=z.filter(e=>{var t;return null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase())}),q=e=>{let{folder:t,level:r=0}=e;const n=k.has(t.id),s=B(t.id);return(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 py-2 px-3 rounded-lg cursor-pointer transition group ".concat(c===t.id?"bg-blue-50 text-blue-700":"hover:bg-slate-100"," ").concat(N===t.id?"bg-blue-50 ring-2 ring-blue-300":""),style:{paddingLeft:"".concat(16*r+12,"px")},onDragOver:e=>{F(e),S(t.id)},onDragLeave:()=>S(null),onDrop:e=>U(e,t.id),children:[s.length>0&&(0,kt.jsx)("button",{onClick:()=>(e=>{const t=new Set(k);t.has(e)?t.delete(e):t.add(e),A(t)})(t.id),className:"p-0.5",children:n?(0,kt.jsx)(Ca,{className:"h-4 w-4"}):(0,kt.jsx)(Ia,{className:"h-4 w-4"})}),(0,kt.jsx)(xl,{className:"h-5 w-5 flex-shrink-0 text-slate-500"}),(0,kt.jsx)("span",{className:"flex-1 text-sm truncate",onClick:()=>d(t.id),children:t.title}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),O(t.id)},className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-red-100 rounded",children:(0,kt.jsx)(Nl,{className:"h-4 w-4 text-red-600"})})]}),n&&s.map(e=>(0,kt.jsx)(q,{folder:e,level:r+1},e.id))]})};return(0,kt.jsxs)("div",{className:"h-screen flex flex-col bg-white",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 bg-gradient-to-r from-[#0089D1] to-[#0069B5] text-white shadow-lg",children:(0,kt.jsxs)("div",{className:"px-6 py-3 flex items-center justify-between gap-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold whitespace-nowrap",children:"All Folders"}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"text",placeholder:"New folder...",value:C,onChange:e=>E(e.target.value),onKeyDown:e=>"Enter"===e.key&&L(),className:"w-40 px-3 py-1.5 bg-white/20 border border-white/30 rounded-lg text-sm text-white placeholder-white/70 focus:bg-white/30 focus:outline-none"}),(0,kt.jsx)("button",{onClick:L,className:"px-2 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition",children:(0,kt.jsx)(Al,{className:"h-5 w-5"})})]})]}),(0,kt.jsxs)("div",{className:"flex-1 flex items-center gap-4",children:[(0,kt.jsxs)("div",{className:"flex-1 relative max-w-md",children:[(0,kt.jsx)(Fl,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-white/70"}),(0,kt.jsx)("input",{type:"text",placeholder:"Search...",value:i,onChange:e=>l(e.target.value),className:"w-full pl-9 pr-4 py-1.5 bg-white/20 border border-white/30 rounded-lg text-sm text-white placeholder-white/70 focus:bg-white/30 focus:outline-none"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,kt.jsx)("button",{onClick:()=>d(null),className:"text-white/90 hover:text-white font-medium",children:"Home"}),u.map((e,t)=>(0,kt.jsxs)(o.Fragment,{children:[(0,kt.jsx)("span",{className:"text-white/60",children:"/"}),(0,kt.jsx)("button",{onClick:()=>d(e.id),className:"text-white/90 hover:text-white",children:e.title})]},e.id))]})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsxs)("button",{onClick:()=>p(!0),className:"px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium transition",children:[(0,kt.jsx)(ap,{className:"h-4 w-4 inline mr-1.5"}),"Playbook"]}),(0,kt.jsxs)("button",{onClick:()=>f(!0),className:"px-3 py-1.5 bg-[#7ED242] text-white rounded-lg text-sm font-medium hover:bg-[#6BC22E] hover:shadow-lg transition",children:[(0,kt.jsx)(sc,{className:"h-4 w-4 inline mr-1.5"}),"Upload"]})]})]})}),(0,kt.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,kt.jsx)("div",{className:"w-80 border-r border-slate-200 bg-slate-50 flex flex-col overflow-hidden",children:(0,kt.jsxs)("div",{className:"flex-1 overflow-y-auto p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 py-2 px-3 rounded-lg cursor-pointer mb-1 ".concat(null===c?"bg-blue-50 text-blue-700":"hover:bg-slate-100"),onClick:()=>d(null),onDragOver:F,onDrop:e=>U(e,null),children:[(0,kt.jsx)(xl,{className:"h-5 w-5 text-slate-500"}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:"Home"})]}),B(null).map(e=>(0,kt.jsx)(q,{folder:e,level:0},e.id))]})}),(0,kt.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50",children:s?(0,kt.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#0089D1]"})}):(0,kt.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[V.map(e=>{var t,r,n,s;const a=null===(t=e.metadata)||void 0===t?void 0:t.isProjectFolder,o=null===(r=e.metadata)||void 0===r?void 0:r.projectNumber,i=null===(n=e.metadata)||void 0===n?void 0:n.customerName,l=null===(s=e.metadata)||void 0===s?void 0:s.address;return(0,kt.jsxs)("div",{draggable:!0,onDragStart:t=>R(t,e),onDragOver:F,onDrop:t=>U(t,e.id),onClick:()=>d(e.id),className:"p-3 bg-white border-2 rounded-xl cursor-pointer hover:shadow-md hover:border-blue-300 transition group relative ".concat((null===w||void 0===w?void 0:w.id)===e.id?"opacity-50":""," ").concat(N===e.id?"border-blue-400 bg-blue-50":"border-slate-200"),children:[(0,kt.jsx)(xl,{className:"h-10 w-10 text-amber-500 mx-auto mb-2"}),a&&o?(0,kt.jsxs)("div",{className:"text-center space-y-0.5",children:[(0,kt.jsxs)("p",{className:"text-xs font-bold text-blue-600",children:["#",o]}),(0,kt.jsx)("p",{className:"text-xs font-medium text-gray-800 leading-tight break-words",children:i||"Unknown"}),(0,kt.jsx)("p",{className:"text-xs text-gray-600 leading-tight break-words",children:l||e.title})]}):(0,kt.jsx)("p",{className:"text-xs font-medium text-center leading-tight break-words",children:e.title}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),O(e.id)},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1 bg-red-50 rounded hover:bg-red-100",children:(0,kt.jsx)(Nl,{className:"h-4 w-4 text-red-600"})})]},e.id)}),H.map(e=>(0,kt.jsxs)("div",{draggable:!0,onDragStart:t=>R(t,e),className:"p-4 bg-white border border-slate-200 rounded-xl hover:shadow-md hover:border-slate-300 transition group relative ".concat((null===w||void 0===w?void 0:w.id)===e.id?"opacity-50":""),onClick:()=>{I(e),D(!0)},children:[(0,kt.jsx)(Hl,{className:"h-12 w-12 text-blue-500 mx-auto mb-2"}),(0,kt.jsx)("p",{className:"text-sm font-medium text-center truncate mb-1",children:e.title}),(0,kt.jsxs)("p",{className:"text-xs text-slate-500 text-center",children:[(e.fileSize/1024/1024).toFixed(2)," MB"]}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),O(e.id)},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1 bg-red-50 rounded hover:bg-red-100",children:(0,kt.jsx)(Nl,{className:"h-4 w-4 text-red-600"})})]},e.id))]})})})]}),g&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full",children:[(0,kt.jsx)("h3",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Upload Files"}),(0,kt.jsx)("input",{type:"file",multiple:!0,onChange:e=>v(Array.from(e.target.files)),className:"mb-4 w-full"}),x.length>0&&(0,kt.jsx)("div",{className:"mb-4 space-y-2",children:x.map((e,t)=>(0,kt.jsx)("div",{className:"text-sm text-slate-600",children:e.name},t))}),(0,kt.jsxs)("div",{className:"flex gap-3",children:[(0,kt.jsx)("button",{onClick:()=>{f(!1),v([])},className:"flex-1 px-6 py-3 border-2 border-slate-300 rounded-xl font-medium hover:bg-slate-50 transition",children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(x.length){b(!0);try{const e=await _s.assetsService.uploadFiles({files:x,parentId:c});console.log("Upload result:",e),await _(c),f(!1),v([]),Vr.success("Uploaded successfully!")}catch(ES){console.error("Upload error:",ES),Vr.error("Upload failed: ".concat(ES.message||"Unknown error"))}finally{b(!1)}}},disabled:!x.length||y,className:"flex-1 px-6 py-3 bg-[#7ED242] text-white rounded-xl font-medium hover:bg-[#6BC22E] hover:shadow-lg disabled:bg-slate-300 disabled:cursor-not-allowed transition",children:y?"Uploading...":"Upload"})]})]})}),(0,kt.jsx)(pa,{visible:m,onClose:()=>p(!1),colorMode:!1}),(0,kt.jsx)(ra,{document:P,isOpen:T,onClose:()=>{D(!1),I(null)}})]})},ip=[{id:1,name:"Sarah Owner",status:"online"},{id:2,name:"Mike Rodriguez (PM)",status:"offline"},{id:3,name:"John Smith",status:"online"},{id:4,name:"Jane Doe",status:"offline"},{id:5,name:"Bob Wilson",status:"online"},{id:6,name:"Alice Johnson",status:"offline"}],lp={1:[{fromMe:!1,text:"Hey, can you review the new project docs?",timestamp:new Date(Date.now()-36e5).toLocaleString()},{fromMe:!0,text:"Sure, I will check them out today.",timestamp:new Date(Date.now()-34e5).toLocaleString()},{fromMe:!1,text:"Great! I've uploaded them to the shared drive.",timestamp:new Date(Date.now()-32e5).toLocaleString()},{fromMe:!0,text:"Perfect, I'll take a look this afternoon.",timestamp:new Date(Date.now()-3e6).toLocaleString()}],2:[{fromMe:!0,text:"Mike, what's the status on the Johnson project?",timestamp:new Date(Date.now()-72e5).toLocaleString()},{fromMe:!1,text:"We're on track. Should be done by Friday.",timestamp:new Date(Date.now()-7e6).toLocaleString()}],3:[{fromMe:!1,text:"Can you send me the material estimates?",timestamp:new Date(Date.now()-18e5).toLocaleString()},{fromMe:!0,text:"I'll get those to you within the hour.",timestamp:new Date(Date.now()-16e5).toLocaleString()}],4:[],5:[{fromMe:!0,text:"Bob, the permits came through!",timestamp:new Date(Date.now()-9e5).toLocaleString()}],6:[]},cp=e=>{var t;let{colorMode:r,projects:n,onProjectSelect:s,navigationContext:a,previousPage:i}=e;const{pushNavigation:l,goBack:c,canGoBack:d,getPrevious:u}=Ei(),{subjects:h}=xi();(0,o.useEffect)(()=>{console.log("\ud83d\udd0d MY MESSAGES: Component mounted"),console.log("\ud83d\udd0d MY MESSAGES: navigationContext from props:",a),console.log("\ud83d\udd0d MY MESSAGES: previousPage from props:",i);const e={pageName:"My Messages",sourcePage:window.location.pathname,timestamp:Date.now(),projects:n,fromPage:(null===a||void 0===a?void 0:a.fromPage)||i||"Dashboard",toPage:"Project Messages",urlParams:new URLSearchParams(window.location.search),scrollPosition:{x:window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,y:window.scrollY||window.pageYOffset||document.documentElement.scrollTop}};console.log("\ud83d\udd0d MY MESSAGES: Enhanced navigation context:",e),l("My Messages",{projects:n,navigationContext:e})},[l,n,a,i]);const m=e=>{console.log("\ud83d\udd0d MY MESSAGES: Handling manual back navigation to:",e.pageName),console.log("\ud83d\udd0d MY MESSAGES: navigationContext:",a);const t=null===a||void 0===a?void 0:a.isMenuNavigation;if(console.log("\ud83d\udd0d MY MESSAGES: isMenuNavigation:",t),t){const e=null===a||void 0===a?void 0:a.fromPage;if(console.log("\ud83d\udd0d MY MESSAGES: Menu navigation detected, going back to:",e),e&&"Project Messages"!==e)return void(s?s(null,e):window.location.href="/")}"Dashboard"===e.pageName||"Overview"===e.pageName?s?s(null,"Overview"):window.location.href="/":"Projects"===e.pageName?s?s(null,"Projects"):window.location.href="/projects":"Project Messages"===e.pageName?s?s(null,"Overview"):window.location.href="/":window.history.length>1?window.history.back():s?s(null,"Overview"):window.location.href="/"},p=()=>{console.log("\ud83d\udd0d MY MESSAGES: Handling fallback navigation"),console.log("\ud83d\udd0d MY MESSAGES: navigationContext:",a);const e=null===a||void 0===a?void 0:a.isMenuNavigation;console.log("\ud83d\udd0d MY MESSAGES: isMenuNavigation:",e);const t=(null===a||void 0===a?void 0:a.fromPage)||i;if(console.log("\ud83d\udd0d MY MESSAGES: From page from context:",t),e&&t&&"Project Messages"!==t)return console.log("\ud83d\udd0d MY MESSAGES: Menu navigation detected, going back to:",t),void(s?s(null,t):window.location.href="/");if(t&&"Project Messages"!==t)return console.log("\ud83d\udd0d MY MESSAGES: Navigating back to:",t),void(s?s(null,t):window.location.href="/");const r=document.referrer,n=window.location.host;r&&r.includes(n)&&window.history.length>1?window.history.back():s?s(null,"Overview"):window.location.href="/"},[g,f]=(0,o.useState)(null),[x,v]=(0,o.useState)(ip[0].id),[y,b]=(0,o.useState)(""),[w,j]=(0,o.useState)(lp),[N,S]=(0,o.useState)(""),[k,A]=(0,o.useState)(""),[C,E]=(0,o.useState)(""),[P,I]=(0,o.useState)([]),[T,D]=(0,o.useState)(!1),[M,_]=(0,o.useState)(""),[O,L]=(0,o.useState)([]),[R,F]=(0,o.useState)(!1);(0,o.useEffect)(()=>{const e=Ds.authService.getStoredUser();e&&f(e)},[]),(0,o.useEffect)(()=>{(async()=>{try{L([{id:1,name:"Sarah Owner",role:"Owner"},{id:2,name:"Mike Rodriguez",role:"Project Manager"},{id:3,name:"John Smith",role:"Field Director"},{id:4,name:"Jane Doe",role:"Administration"},{id:5,name:"Bob Wilson",role:"Roof Supervisor"},{id:6,name:"Alice Johnson",role:"Customer Service"}])}catch(e){console.error("Error fetching users:",e),L([])}})()},[]);const U=ip.find(e=>e.id===x),B=w[x]||[];return(0,o.useEffect)(()=>{x&&w[x]&&j(e=>(0,Y.A)((0,Y.A)({},e),{},{[x]:e[x].map(e=>(0,Y.A)((0,Y.A)({},e),{},{read:!0}))}))},[x]),(0,kt.jsx)("div",{className:"min-h-screen ".concat(r?"bg-slate-900":"bg-gray-50"),children:(0,kt.jsxs)("div",{className:"w-full max-w-6xl mx-auto py-6 px-4",children:[(0,kt.jsx)("div",{className:"mb-6",children:(0,kt.jsx)(Yi,{colorMode:r,variant:"secondary",preservePosition:!0,onClick:()=>{console.log("\ud83d\udd0d MY MESSAGES: handleBackNavigation called"),console.log("\ud83d\udd0d MY MESSAGES: navigationContext:",a),console.log("\ud83d\udd0d MY MESSAGES: previousPage:",i);const e=null===a||void 0===a?void 0:a.isMenuNavigation;if(console.log("\ud83d\udd0d MY MESSAGES: isMenuNavigation:",e),e){const e=null===a||void 0===a?void 0:a.fromPage;if(console.log("\ud83d\udd0d MY MESSAGES: Menu navigation detected, going back to:",e),e&&"Project Messages"!==e)return void(s?s(null,e):window.location.href="/")}if(d()){console.log("\ud83d\udd0d MY MESSAGES: Using navigation history for back navigation");const e=u();if(console.log("\ud83d\udd0d MY MESSAGES: Previous entry:",e),e){const t=c();console.log("\ud83d\udd0d MY MESSAGES: Navigation result:",t),t||m(e)}else console.log("\ud83d\udd0d MY MESSAGES: No previous entry, using browser back"),window.history.back()}else console.log("\ud83d\udd0d MY MESSAGES: No navigation history, using fallback"),p()},showNavigationInfo:!0,navigationContext:{currentPage:"My Messages",canGoBack:d(),previousPage:(null===(t=u())||void 0===t?void 0:t.pageName)||(null===a||void 0===a?void 0:a.fromPage)||i||"Dashboard"}})}),(0,kt.jsxs)("div",{className:"mb-3",children:[(0,kt.jsx)("h1",{className:"text-3xl font-bold ".concat(r?"text-white":"text-gray-900"," mb-1"),children:"My Messages"}),(0,kt.jsx)("p",{className:"text-lg ".concat(r?"text-slate-400":"text-gray-600"),children:"Direct conversations with team members"})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,kt.jsxs)("div",{className:"border-t-4 border-blue-400 shadow-[0_2px_8px_rgba(0,0,0,0.1)] rounded-[8px] p-4 ".concat(r?"bg-[#232b4d]/80":"bg-white"),children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold mb-4 ".concat(r?"text-white":"text-gray-800"),children:"Team Members"}),(0,kt.jsx)("div",{className:"space-y-2",children:ip.map(e=>{const t=(n=e.id,(w[n]||[]).filter(e=>!e.fromMe&&!e.read).length);var n;return(0,kt.jsx)("button",{onClick:()=>v(e.id),className:"w-full text-left p-3 rounded-lg transition-colors ".concat(x===e.id?r?"bg-[var(--color-primary-blueprint-blue)]/20 border border-blue-500/30":"bg-blue-50 border border-blue-200":r?"hover:bg-gray-700/30":"hover:bg-gray-50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:e.name.charAt(0)}),(0,kt.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 ".concat(r?"border-[#232b4d]":"border-white"," ").concat("online"===e.status?"bg-green-500":"bg-gray-400")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-sm ".concat(r?"text-white":"text-gray-900"),children:e.name}),(0,kt.jsx)("div",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-500"),children:"online"===e.status?"Online":"Offline"})]})]}),t>0&&(0,kt.jsx)("div",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:t})]})},e.id)})})]}),(0,kt.jsxs)("div",{className:"lg:col-span-2 border-t-4 border-blue-400 shadow-[0_2px_8px_rgba(0,0,0,0.1)] rounded-[8px] ".concat(r?"bg-[#232b4d]/80":"bg-white"," flex flex-col"),children:[(0,kt.jsx)("div",{className:"p-4 border-b ".concat(r?"border-gray-600":"border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:null===U||void 0===U?void 0:U.name.charAt(0)}),(0,kt.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 ".concat(r?"border-[#232b4d]":"border-white"," ").concat("online"===(null===U||void 0===U?void 0:U.status)?"bg-green-500":"bg-gray-400")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"font-semibold ".concat(r?"text-white":"text-gray-900"),children:null===U||void 0===U?void 0:U.name}),(0,kt.jsx)("p",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-500"),children:"online"===(null===U||void 0===U?void 0:U.status)?"Active now":"Last seen recently"})]})]})}),(0,kt.jsx)("div",{className:"flex-1 p-4 max-h-96 overflow-y-auto custom-scrollbar",children:0===B.length?(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"text-4xl mb-3",children:"\ud83d\udcac"}),(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(r?"text-gray-300":"text-gray-600"," mb-2"),children:"No messages yet"}),(0,kt.jsxs)("div",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-500"),children:["Start a conversation with ",null===U||void 0===U?void 0:U.name]})]}):(0,kt.jsx)("div",{className:"space-y-4",children:B.map((e,t)=>(0,kt.jsx)("div",{className:"flex ".concat(e.fromMe?"justify-end":"justify-start"),children:(0,kt.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(e.fromMe?"bg-[var(--color-primary-blueprint-blue)] text-white":r?"bg-gray-700 text-gray-200":"bg-gray-200 text-gray-800"),children:[(0,kt.jsx)("p",{className:"text-sm",children:e.text}),(0,kt.jsx)("p",{className:"text-xs mt-1 opacity-75",children:e.timestamp})]})},t))})}),(0,kt.jsxs)("div",{className:"p-4 border-t ".concat(r?"border-gray-600":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,kt.jsx)("button",{onClick:()=>F(!1),className:"px-3 py-2 rounded-lg text-xs font-medium transition-colors ".concat(R?r?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300":"bg-[var(--color-primary-blueprint-blue)] text-white"),children:"Quick Message"}),(0,kt.jsx)("button",{onClick:()=>F(!0),className:"px-3 py-2 rounded-lg text-xs font-medium transition-colors ".concat(R?"bg-[var(--color-primary-blueprint-blue)] text-white":r?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Project Message"})]}),R?(0,kt.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),N&&k&&C.trim()&&P.length>0){const e=n.find(e=>e.id===parseInt(N)),t={id:"msg_".concat(Date.now()),projectId:parseInt(N),projectName:(null===e||void 0===e?void 0:e.projectName)||(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.address)||"Unknown Project",projectNumber:(null===e||void 0===e?void 0:e.projectNumber)||Math.floor(9e4*Math.random())+1e4,subject:k,description:C,user:"You",timestamp:(new Date).toISOString(),type:"message",priority:"medium",recipients:P,hasTask:T,taskAssignedTo:T?M:null};console.log("New project message created:",t),S(""),A(""),E(""),I([]),D(!1),_(""),F(!1),alert("Project message sent successfully!")}},className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:["Project ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{value:N,onChange:e=>S(e.target.value),required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(r?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Select Project"}),(n||[]).map(e=>(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",e.projectName||e.name||e.address]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:["To ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{value:P||"",onChange:e=>{const t=Array.from(e.target.selectedOptions,e=>e.value);I(t)},multiple:!0,required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(r?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),style:{minHeight:"40px"},children:[(0,kt.jsx)("option",{value:"all",style:{fontWeight:"bold"},children:"All Users"}),O.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),(0,kt.jsx)("p",{className:"text-[10px] mt-1 ".concat(r?"text-gray-400":"text-gray-500"),children:"Hold Ctrl/Cmd to select multiple recipients"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:["Subject ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"text",placeholder:"Enter subject line...",value:k,onChange:e=>A(e.target.value),required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(r?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("input",{type:"checkbox",checked:T||!1,onChange:e=>D(e.target.checked),className:"mr-1"}),"Send as a Task"]}),T&&(0,kt.jsxs)("select",{value:M||"",onChange:e=>_(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(r?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Assign Task To..."}),O.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:["Message ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("textarea",{value:C,onChange:e=>E(e.target.value),placeholder:"Enter your message here...",required:!0,rows:2,className:"w-full px-2 py-1 border rounded text-xs resize-none ".concat(r?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1.5 pt-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{S(""),A(""),E(""),I([]),D(!1),_(""),F(!1)},className:"px-3 py-1.5 text-xs font-medium rounded border transition-colors ".concat(r?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!N||!k||!C.trim()||0===P.length,className:"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(N&&k&&C.trim()&&P.length>0?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Send Message"})]})]}):(0,kt.jsxs)("form",{onSubmit:e=>{e.preventDefault(),y.trim()&&(j(e=>(0,Y.A)((0,Y.A)({},e),{},{[x]:[...e[x]||[],{fromMe:!0,text:y.trim(),timestamp:(new Date).toLocaleString(),read:!0}]})),b(""))},className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"text",value:y,onChange:e=>b(e.target.value),placeholder:"Message ".concat(null===U||void 0===U?void 0:U.name,"..."),className:"flex-1 px-3 py-2 rounded-lg border text-sm ".concat(r?"bg-[#1e293b] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")}),(0,kt.jsx)("button",{type:"submit",disabled:!y.trim(),className:"px-4 py-2 rounded-lg font-medium text-sm transition-colors ".concat(y.trim()?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Send"})]})]})]})]})]})})},dp=()=>{const[e,t]=(0,o.useState)([]),[r,n]=(0,o.useState)(!0),[s,a]=(0,o.useState)(null),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)(""),[g,f]=(0,o.useState)(50),[x,v]=(0,o.useState)(0),[y,b]=(0,o.useState)(0);(0,o.useEffect)(()=>{w()},[u,m,g,x]);const w=async()=>{console.log("\ud83d\udce7 EMAIL HISTORY: fetchEmails called");try{var e;n(!0),a(null);const r=localStorage.getItem("token");if(console.log("\ud83d\udce7 EMAIL HISTORY: Token:",r?"Present":"Missing"),!r)return console.warn("\ud83d\udce7 EMAIL HISTORY: No token found"),a("Authentication required. Please log in."),void n(!1);const s=new URLSearchParams;u&&s.append("emailType",u),m&&s.append("status",m),s.append("limit",g),s.append("offset",x),console.log("\ud83d\udce7 EMAIL HISTORY: Fetching with params:",s.toString());const o=await fetch("/api/email/history?".concat(s),{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(console.log("\ud83d\udce7 EMAIL HISTORY: Response status:",o.status),!o.ok){if(401===o.status)throw new Error("Session expired. Please log in again.");throw new Error("Failed to fetch emails")}const i=await o.json();console.log("\ud83d\udce7 EMAIL HISTORY: Received data:",i),t(i.data.emails||[]),b(i.data.total||0),console.log("\ud83d\udce7 EMAIL HISTORY: Emails loaded:",(null===(e=i.data.emails)||void 0===e?void 0:e.length)||0)}catch(ES){console.error("\ud83d\udce7 EMAIL HISTORY: Error:",ES),a(ES.message)}finally{n(!1)}},j=e.filter(e=>{var t,r,n,s;if(!c)return!0;const a=c.toLowerCase();return(null===(t=e.subject)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(r=e.senderName)||void 0===r?void 0:r.toLowerCase().includes(a))||(null===(n=e.senderEmail)||void 0===n?void 0:n.toLowerCase().includes(a))||(null===(s=e.toEmails)||void 0===s?void 0:s.some(e=>e.toLowerCase().includes(a)))}),N={total:y,sent:e.filter(e=>"sent"===e.status).length,delivered:e.filter(e=>"delivered"===e.status).length,opened:e.filter(e=>"opened"===e.status).length};return(0,kt.jsx)("div",{className:"min-h-screen p-6",style:{backgroundColor:"var(--color-background-ash)"},children:(0,kt.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,kt.jsxs)("div",{className:"rounded-lg p-8 text-white",style:{background:"linear-gradient(to right, var(--color-brand-aqua-blue), var(--color-accent-vibrant-green))",boxShadow:"var(--shadow-medium)"},children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("div",{className:"bg-white bg-opacity-20 p-4 rounded-lg",children:(0,kt.jsx)(Sc,{className:"w-10 h-10"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-3xl font-bold",children:"Email History"}),(0,kt.jsx)("p",{className:"text-white text-opacity-90 mt-1",children:"View and manage all email communications"})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3",children:[(0,kt.jsxs)("button",{onClick:()=>{console.log("\ud83d\udce7 EMAIL HISTORY: Refresh button clicked"),w()},disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition-colors disabled:opacity-50 cursor-pointer",children:[(0,kt.jsx)(Ac,{className:"w-5 h-5 ".concat(r?"animate-spin":"")}),"Refresh"]}),(0,kt.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition-colors",children:[(0,kt.jsx)(wc,{className:"w-5 h-5"}),"Export"]})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",boxShadow:"var(--shadow-soft)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,kt.jsx)("div",{className:"text-3xl font-bold text-white",children:N.total}),(0,kt.jsx)("div",{className:"text-sm mt-1 text-white text-opacity-90",children:"Total Emails"})]}),(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",boxShadow:"var(--shadow-soft)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,kt.jsx)("div",{className:"text-3xl font-bold text-white",children:N.sent}),(0,kt.jsx)("div",{className:"text-sm mt-1 text-white text-opacity-90",children:"Sent"})]}),(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",boxShadow:"var(--shadow-soft)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,kt.jsx)("div",{className:"text-3xl font-bold text-white",children:N.delivered}),(0,kt.jsx)("div",{className:"text-sm mt-1 text-white text-opacity-90",children:"Delivered"})]}),(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",boxShadow:"var(--shadow-soft)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,kt.jsx)("div",{className:"text-3xl font-bold text-white",children:N.opened}),(0,kt.jsx)("div",{className:"text-sm mt-1 text-white text-opacity-90",children:"Opened"})]})]})]}),(0,kt.jsx)("div",{className:"bg-white rounded-lg p-6",style:{border:"1px solid var(--color-border-silver)",boxShadow:"var(--shadow-soft)"},children:(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold mb-2",style:{color:"var(--color-text-charcoal)"},children:"Search"}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)(Cc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-light-gray w-5 h-5"}),(0,kt.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Search by subject, sender, or recipient...",className:"w-full pl-10 pr-4 py-2 rounded-lg focus:outline-none",style:{border:"1px solid var(--color-border-silver)",transition:"all 0.2s"},onFocus:e=>{e.target.style.borderColor="var(--color-brand-aqua-blue)",e.target.style.boxShadow="0 0 0 3px rgba(0, 137, 209, 0.1)"},onBlur:e=>{e.target.style.borderColor="var(--color-border-silver)",e.target.style.boxShadow="none"}})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold mb-2",style:{color:"var(--color-text-charcoal)"},children:"Email Type"}),(0,kt.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 rounded-lg focus:outline-none",style:{border:"1px solid var(--color-border-silver)",transition:"all 0.2s"},onFocus:e=>{e.target.style.borderColor="var(--color-brand-aqua-blue)",e.target.style.boxShadow="0 0 0 3px rgba(0, 137, 209, 0.1)"},onBlur:e=>{e.target.style.borderColor="var(--color-border-silver)",e.target.style.boxShadow="none"},children:[(0,kt.jsx)("option",{value:"",children:"All Types"}),(0,kt.jsx)("option",{value:"project_update",children:"Project Update"}),(0,kt.jsx)("option",{value:"customer_communication",children:"Customer"}),(0,kt.jsx)("option",{value:"team_communication",children:"Team"}),(0,kt.jsx)("option",{value:"bubbles_ai",children:"AI Assistant"}),(0,kt.jsx)("option",{value:"general",children:"General"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold mb-2",style:{color:"var(--color-text-charcoal)"},children:"Status"}),(0,kt.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 rounded-lg focus:outline-none",style:{border:"1px solid var(--color-border-silver)",transition:"all 0.2s"},onFocus:e=>{e.target.style.borderColor="var(--color-brand-aqua-blue)",e.target.style.boxShadow="0 0 0 3px rgba(0, 137, 209, 0.1)"},onBlur:e=>{e.target.style.borderColor="var(--color-border-silver)",e.target.style.boxShadow="none"},children:[(0,kt.jsx)("option",{value:"",children:"All Status"}),(0,kt.jsx)("option",{value:"sent",children:"Sent"}),(0,kt.jsx)("option",{value:"delivered",children:"Delivered"}),(0,kt.jsx)("option",{value:"opened",children:"Opened"}),(0,kt.jsx)("option",{value:"failed",children:"Failed"}),(0,kt.jsx)("option",{value:"bounced",children:"Bounced"})]})]})]})}),s?(0,kt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-red-800",children:[(0,kt.jsx)("p",{className:"font-semibold",children:"Error loading emails"}),(0,kt.jsx)("p",{className:"text-sm mt-1",children:s})]}):(0,kt.jsxs)("div",{className:"bg-white rounded-lg p-6",style:{border:"1px solid var(--color-border-silver)",boxShadow:"var(--shadow-soft)"},children:[(0,kt.jsx)(nd,{emails:j,onEmailClick:l,loading:r,emptyMessage:"No emails found matching your filters"}),y>g&&(0,kt.jsxs)("div",{className:"flex items-center justify-between mt-6 pt-6 border-t border-border-silver",children:[(0,kt.jsxs)("div",{className:"text-sm text-text-light-gray",children:["Showing ",x+1," to ",Math.min(x+g,y)," of ",y," emails"]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{x>0&&v(Math.max(0,x-g))},disabled:0===x,className:"px-4 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",style:{backgroundColor:"var(--color-background-ash)",color:"var(--color-text-charcoal)"},onMouseEnter:e=>!e.target.disabled&&(e.target.style.backgroundColor="var(--color-brand-aqua-blue-light-tint)"),onMouseLeave:e=>e.target.style.backgroundColor="var(--color-background-ash)",children:"Previous"}),(0,kt.jsx)("button",{onClick:()=>{x+g<y&&v(x+g)},disabled:x+g>=y,className:"px-4 py-2 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",style:{backgroundColor:"var(--color-brand-aqua-blue)"},onMouseEnter:e=>!e.target.disabled&&(e.target.style.backgroundColor="var(--color-brand-deep-teal)"),onMouseLeave:e=>e.target.style.backgroundColor="var(--color-brand-aqua-blue)",children:"Next"})]})]})]}),i&&(0,kt.jsx)(Vd,{email:i,onClose:()=>l(null)})]})})};(()=>{const e=localStorage.getItem("mockFeedbackStore");if(e)try{return JSON.parse(e)}catch(t){console.error("Error parsing stored feedback data:",t)}new Date(Date.now()-1728e5).toISOString(),new Date(Date.now()-432e6).toISOString(),new Date(Date.now()-6048e5).toISOString(),new Date(Date.now()-2592e5).toISOString(),new Date(Date.now()-12096e5).toISOString(),new Date(Date.now()-864e5).toISOString(),new Date(Date.now()-2592e5).toISOString(),new Date(Date.now()-3456e5).toISOString()})();const up=async e=>(await new Promise(e=>setTimeout(e,200)),[{id:"1",type:"comment",title:"New comment on your feedback",message:'John Developer commented on "Dashboard loading slowly"',read:!1,createdAt:new Date(Date.now()-36e5).toISOString()},{id:"2",type:"vote",title:"Your feedback received an upvote",message:'Someone upvoted "Add bulk actions for project management"',read:!1,createdAt:new Date(Date.now()-72e5).toISOString()},{id:"3",type:"status_change",title:"Feedback status updated",message:'Your feedback "AI-powered predictions" is now Planned',read:!0,createdAt:new Date(Date.now()-864e5).toISOString()}]),hp=Gs("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),mp=Gs("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),pp=Gs("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),gp=Gs("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),fp=Gs("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),xp=Gs("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),vp=e=>{let{onSubmit:t,colorMode:r,currentUser:n,isOpen:s=!0,onClose:a}=e;const[i,l]=(0,o.useState)({type:"bug",title:"",description:"",stepsToReproduce:"",expectedBehavior:"",actualBehavior:"",severity:"medium",problem:"",proposal:"",impact:"",environment:"",tags:[]}),[c,d]=(0,o.useState)([]),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!1),g=(0,o.useRef)(null),f=[{id:"bug",label:"Bug Report",icon:hp,color:"red"},{id:"improvement",label:"Improvement",icon:mp,color:"blue"},{id:"idea",label:"New Idea",icon:Ys,color:"green"}],x=(e,t)=>{l(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))};return s?(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),i.title.trim()&&i.description.trim()){h(!0);try{const e={userAgent:navigator.userAgent,url:window.location.href,timestamp:(new Date).toISOString(),screen:{width:window.screen.width,height:window.screen.height}},r=(0,Y.A)((0,Y.A)({},i),{},{environment:e,attachments:c,authorId:null===n||void 0===n?void 0:n.id});await t(r),l({type:"bug",title:"",description:"",stepsToReproduce:"",expectedBehavior:"",actualBehavior:"",severity:"medium",problem:"",proposal:"",impact:"",environment:"",tags:[]}),d([]),a&&a()}catch(r){Vr.error("Failed to submit feedback")}finally{h(!1)}}else Vr.error("Title and description are required")},className:"overflow-y-auto",children:[(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-3 ".concat(r?"text-gray-300":"text-gray-700"),children:"Feedback Type"}),(0,kt.jsx)("div",{className:"grid grid-cols-3 gap-3",children:f.map(e=>{const t=e.icon;return(0,kt.jsxs)("button",{type:"button",onClick:()=>x("type",e.id),className:"p-4 rounded-xl border-2 transition-all ".concat(i.type===e.id?"border-".concat(e.color,"-500 bg-").concat(e.color,"-50"):r?"border-slate-600 bg-slate-700 hover:bg-slate-600":"border-gray-300 bg-white hover:bg-gray-50"),children:[(0,kt.jsx)(t,{className:"h-6 w-6 mx-auto mb-2 text-".concat(e.color,"-500")}),(0,kt.jsx)("span",{className:"text-sm font-medium ".concat(r?"text-white":"text-gray-900"),children:e.label})]},e.id)})})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:["Title ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"text",value:i.title,onChange:e=>x("title",e.target.value),placeholder:"Brief, descriptive title...",className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent"),required:!0})]}),"bug"===i.type&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Steps to Reproduce"}),(0,kt.jsx)("textarea",{value:i.stepsToReproduce,onChange:e=>x("stepsToReproduce",e.target.value),placeholder:"1. Go to...\n2. Click on...\n3. See error...",rows:4,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Expected Behavior"}),(0,kt.jsx)("textarea",{value:i.expectedBehavior,onChange:e=>x("expectedBehavior",e.target.value),placeholder:"What should happen...",rows:3,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Actual Behavior"}),(0,kt.jsx)("textarea",{value:i.actualBehavior,onChange:e=>x("actualBehavior",e.target.value),placeholder:"What actually happens...",rows:3,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Severity"}),(0,kt.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"low",label:"Low",color:"green"},{value:"medium",label:"Medium",color:"yellow"},{value:"high",label:"High",color:"orange"},{value:"critical",label:"Critical",color:"red"}].map(e=>(0,kt.jsxs)("button",{type:"button",onClick:()=>x("severity",e.value),className:"p-3 rounded-lg border-2 transition-all ".concat(i.severity===e.value?"border-".concat(e.color,"-500 bg-").concat(e.color,"-50"):r?"border-slate-600 bg-slate-700 hover:bg-slate-600":"border-gray-300 bg-white hover:bg-gray-50"),children:[(0,kt.jsx)("div",{className:"w-3 h-3 rounded-full bg-".concat(e.color,"-500 mx-auto mb-1")}),(0,kt.jsx)("span",{className:"text-xs font-medium ".concat(r?"text-white":"text-gray-900"),children:e.label})]},e.value))})]})]}),("improvement"===i.type||"idea"===i.type)&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"improvement"===i.type?"Current Problem":"Use Case"}),(0,kt.jsx)("textarea",{value:i.problem,onChange:e=>x("problem",e.target.value),placeholder:"Describe the current issue or use case...",rows:4,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"improvement"===i.type?"Proposed Solution":"Idea Description"}),(0,kt.jsx)("textarea",{value:i.proposal,onChange:e=>x("proposal",e.target.value),placeholder:"Describe your solution or idea...",rows:4,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Expected Impact"}),(0,kt.jsx)("textarea",{value:i.impact,onChange:e=>x("impact",e.target.value),placeholder:"How would this benefit users? What's the impact?",rows:3,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium ".concat(r?"text-gray-300":"text-gray-700"),children:["Description ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("div",{className:"flex space-x-2",children:(0,kt.jsx)("button",{type:"button",onClick:()=>p(!m),className:"text-sm px-3 py-1 rounded-lg ".concat(m?r?"bg-blue-600 text-white":"bg-blue-500 text-white":r?"bg-slate-700 text-gray-300":"bg-gray-100 text-gray-600"),children:m?"Edit":"Preview"})})]}),m?(0,kt.jsx)("div",{className:"p-4 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-300"),dangerouslySetInnerHTML:{__html:(v=i.description,v.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>"))}}):(0,kt.jsx)("textarea",{value:i.description,onChange:e=>x("description",e.target.value),placeholder:"Describe your feedback in detail... (Markdown supported)",rows:6,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent"),required:!0})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Attachments (Images/PDFs up to 10MB)"}),(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsx)("input",{ref:g,type:"file",multiple:!0,accept:"image/*,.pdf",onChange:e=>{const t=Array.from(e.target.files),r=t.filter(e=>{const t=e.size<=10485760,r=e.type.startsWith("image/")||"application/pdf"===e.type;return t&&r});r.length!==t.length&&Vr.error("Some files were rejected. Only images and PDFs up to 10MB are allowed."),d(e=>[...e,...r])},className:"hidden"}),(0,kt.jsxs)("button",{type:"button",onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.click()},className:"w-full p-4 border-2 border-dashed rounded-xl transition-colors ".concat(r?"border-slate-600 hover:border-slate-500 hover:bg-slate-700":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"),children:[(0,kt.jsx)(pp,{className:"h-6 w-6 mx-auto mb-2"}),(0,kt.jsx)("span",{className:"text-sm ".concat(r?"text-gray-300":"text-gray-600"),children:"Click to upload files"})]}),c.length>0&&(0,kt.jsx)("div",{className:"space-y-2",children:c.map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg ".concat(r?"bg-slate-700":"bg-gray-100"),children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[e.type.startsWith("image/")?(0,kt.jsx)(gp,{className:"h-4 w-4 text-blue-500"}):(0,kt.jsx)(fp,{className:"h-4 w-4 text-red-500"}),(0,kt.jsx)("span",{className:"text-sm ".concat(r?"text-white":"text-gray-900"),children:e.name}),(0,kt.jsxs)("span",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-500"),children:["(",(e.size/1024/1024).toFixed(1),"MB)"]})]}),(0,kt.jsx)("button",{type:"button",onClick:()=>(e=>{d(t=>t.filter((t,r)=>r!==e))})(t),className:"text-red-500 hover:text-red-700",children:(0,kt.jsx)(xp,{className:"h-4 w-4"})})]},t))})]})]}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,kt.jsx)("button",{type:"button",onClick:a,className:"px-6 py-3 rounded-xl font-medium transition-colors ".concat(r?"bg-slate-700 text-white hover:bg-slate-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:u||!i.title.trim()||!i.description.trim(),className:"px-6 py-3 rounded-xl font-medium transition-colors ".concat(!u&&i.title.trim()&&i.description.trim()?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:u?"Submitting...":"Submit Feedback"})]})]}):null;var v},yp=Gs("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),bp=Gs("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),wp=Gs("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),jp=Gs("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),Np=Gs("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Sp=Gs("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),kp=Gs("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Ap=Gs("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),Cp=Gs("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Ep=e=>{var t,r,n;let{feedback:s,currentUser:a,onVote:i,onClick:l,colorMode:c}=e;const[d,u]=(0,o.useState)(!1),h=(e=>{switch(e){case"BUG":default:return hp;case"IMPROVEMENT":return mp;case"IDEA":return Ys}})(s.type),m=(e=>{switch(e){case"OPEN":default:return yp;case"IN_REVIEW":return bp;case"PLANNED":return wp;case"IN_PROGRESS":return jp;case"DONE":return Np;case"CLOSED":return Sp}})(s.status),p=(e=>{switch(e){case"BUG":return"red";case"IMPROVEMENT":return"blue";case"IDEA":return"green";default:return"gray"}})(s.type),g=(e=>{switch(e){case"OPEN":case"DONE":return"green";case"IN_REVIEW":return"yellow";case"PLANNED":return"blue";case"IN_PROGRESS":return"purple";default:return"gray"}})(s.status),f=(e=>{switch(e){case"LOW":return"green";case"MEDIUM":return"yellow";case"HIGH":return"orange";case"CRITICAL":return"red";default:return"gray"}})(s.severity);return(0,kt.jsxs)("div",{onClick:l,className:"cursor-pointer transition-all duration-200 hover:shadow-lg ".concat(c?"bg-slate-800 border-slate-700":"bg-white border-gray-200"," border rounded-lg p-4 hover:scale-[1.01]"),children:[(0,kt.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,kt.jsx)("div",{className:"p-2 rounded-lg bg-".concat(p,"-100"),children:(0,kt.jsx)(h,{className:"h-5 w-5 text-".concat(p,"-600")})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(c?"text-white":"text-gray-900"," line-clamp-2"),children:s.title}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-".concat(p,"-100 text-").concat(p,"-800"),children:s.type}),(0,kt.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-".concat(g,"-100 text-").concat(g,"-800"),children:[(0,kt.jsx)(m,{className:"h-3 w-3 mr-1"}),s.status.replace("_"," ")]}),s.severity&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-".concat(f,"-100 text-").concat(f,"-800"),children:s.severity})]})]})]}),(0,kt.jsx)("div",{className:"flex items-center space-x-2",children:(0,kt.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,kt.jsx)(wp,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:rd(new Date(s.createdAt),{addSuffix:!0})})]})})]}),(0,kt.jsx)("div",{className:"mb-3 ".concat(c?"text-gray-300":"text-gray-600"," line-clamp-2"),children:s.description}),s.tags&&s.tags.length>0&&(0,kt.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[s.tags.slice(0,3).map((e,t)=>(0,kt.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ".concat(c?"bg-slate-700 text-slate-300":"bg-gray-100 text-gray-700"),children:[(0,kt.jsx)(kp,{className:"h-3 w-3 mr-1"}),e]},t)),s.tags.length>3&&(0,kt.jsxs)("span",{className:"text-xs ".concat(c?"text-gray-400":"text-gray-500"),children:["+",s.tags.length-3," more"]})]}),(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,kt.jsxs)("button",{onClick:async e=>{if(e.stopPropagation(),!d){u(!0);try{await i(s.id,s.hasVoted)}finally{u(!1)}}},disabled:d,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors ".concat(s.hasVoted?"bg-blue-100 text-blue-700":c?"bg-slate-700 text-gray-300 hover:bg-slate-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,kt.jsx)(Xs,{className:"h-4 w-4 ".concat(s.hasVoted?"text-blue-600":"")}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:s.voteCount||0})]}),(0,kt.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,kt.jsx)(Ap,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:s.commentCount||0})]}),s.assignee&&(0,kt.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,kt.jsx)(Cp,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:s.assignee.name})]})]}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(c?"bg-slate-700 text-white":"bg-gray-200 text-gray-700"),children:(null===(t=s.author)||void 0===t||null===(r=t.name)||void 0===r?void 0:r.charAt(0))||"U"}),(0,kt.jsxs)("div",{className:"text-sm",children:[(0,kt.jsx)("div",{className:"font-medium ".concat(c?"text-white":"text-gray-900"),children:(null===(n=s.author)||void 0===n?void 0:n.name)||"Anonymous"}),(0,kt.jsx)("div",{className:"text-xs ".concat(c?"text-gray-400":"text-gray-500"),children:rd(new Date(s.createdAt),{addSuffix:!0})})]})]})]}),s.developerResponseCount>0&&(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),l()},className:"mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200 cursor-pointer hover:bg-blue-100 transition-colors",children:(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,kt.jsxs)("span",{className:"text-sm font-medium text-blue-800",children:[s.developerResponseCount," developer response",1!==s.developerResponseCount?"s":""]}),(0,kt.jsx)("span",{className:"text-xs text-blue-600 ml-auto",children:"Click to view"})]})})]})},Pp=Gs("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);function Ip(e){if("undefined"===typeof Proxy)return e;const t=new Map;return new Proxy(function(){return e(...arguments)},{get:(r,n)=>"create"===n?e:(t.has(n)||t.set(n,e(n)),t.get(n))})}function Tp(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}const Dp=e=>Array.isArray(e);function Mp(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function _p(e){return"string"===typeof e||Array.isArray(e)}function Op(e){const t=[{},{}];return null===e||void 0===e||e.values.forEach((e,r)=>{t[0][r]=e.get(),t[1][r]=e.getVelocity()}),t}function Lp(e,t,r,n){if("function"===typeof t){const[s,a]=Op(n);t=t(void 0!==r?r:e.custom,s,a)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[s,a]=Op(n);t=t(void 0!==r?r:e.custom,s,a)}return t}function Rp(e,t,r){const n=e.getProps();return Lp(n,t,void 0!==r?r:n.custom,e)}const Fp=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Up=["initial",...Fp];function Bp(e){let t;return()=>(void 0===t&&(t=e()),t)}const Wp=Bp(()=>void 0!==window.ScrollTimeline);class zp{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let r=0;r<this.animations.length;r++)this.animations[r][e]=t}attachTimeline(e,t){const r=this.animations.map(r=>Wp()&&r.attachTimeline?r.attachTimeline(e):"function"===typeof t?t(r):void 0);return()=>{r.forEach((e,t)=>{e&&e(),this.animations[t].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach(t=>t[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Vp extends zp{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}function Hp(e,t){return e?e[t]||e.default||e:void 0}const qp=2e4;function Kp(e){let t=0;let r=e.next(t);for(;!r.done&&t<qp;)t+=50,r=e.next(t);return t>=qp?1/0:t}function Gp(e){return"function"===typeof e}function Jp(e,t){e.timeline=t,e.onfinish=null}const Yp=e=>Array.isArray(e)&&"number"===typeof e[0],Qp={linearEasing:void 0};function Xp(e,t){const r=Bp(e);return()=>{var e;return null!==(e=Qp[t])&&void 0!==e?e:r()}}const $p=Xp(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(It){return!1}return!0},"linearEasing"),Zp=(e,t,r)=>{const n=t-e;return 0===n?1:(r-e)/n},eg=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n="";const s=Math.max(Math.round(t/r),2);for(let a=0;a<s;a++)n+=e(Zp(0,s-1,a))+", ";return"linear(".concat(n.substring(0,n.length-2),")")};function tg(e){return Boolean("function"===typeof e&&$p()||!e||"string"===typeof e&&(e in ng||$p())||Yp(e)||Array.isArray(e)&&e.every(tg))}const rg=e=>{let[t,r,n,s]=e;return"cubic-bezier(".concat(t,", ").concat(r,", ").concat(n,", ").concat(s,")")},ng={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:rg([0,.65,.55,1]),circOut:rg([.55,0,1,.45]),backIn:rg([.31,.01,.66,-.59]),backOut:rg([.33,1.53,.69,.99])};function sg(e,t){return e?"function"===typeof e&&$p()?eg(e,t):Yp(e)?rg(e):Array.isArray(e)?e.map(e=>sg(e,t)||ng.easeOut):ng[e]:void 0}const ag={x:!1,y:!1};function og(){return ag.x||ag.y}function ig(e,t){const r=function(e,t,r){var n;if(e instanceof Element)return[e];if("string"===typeof e){let s=document;t&&(s=t.current);const a=null!==(n=null===r||void 0===r?void 0:r[e])&&void 0!==n?n:s.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}(e),n=new AbortController;return[r,(0,Y.A)((0,Y.A)({passive:!0},t),{},{signal:n.signal}),()=>n.abort()]}function lg(e){return t=>{"touch"===t.pointerType||og()||e(t)}}const cg=(e,t)=>!!t&&(e===t||cg(e,t.parentElement)),dg=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary,ug=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const hg=new WeakSet;function mg(e){return t=>{"Enter"===t.key&&e(t)}}function pg(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function gg(e){return dg(e)&&!og()}function fg(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[n,s,a]=ig(e,r),o=e=>{const n=e.currentTarget;if(!gg(e)||hg.has(n))return;hg.add(n);const a=t(e),o=(e,t)=>{window.removeEventListener("pointerup",i),window.removeEventListener("pointercancel",l),gg(e)&&hg.has(n)&&(hg.delete(n),"function"===typeof a&&a(e,{success:t}))},i=e=>{o(e,r.useGlobalTarget||cg(n,e.target))},l=e=>{o(e,!1)};window.addEventListener("pointerup",i,s),window.addEventListener("pointercancel",l,s)};return n.forEach(e=>{(function(e){return ug.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(r.useGlobalTarget?window:e).addEventListener("pointerdown",o,s),e.addEventListener("focus",e=>((e,t)=>{const r=e.currentTarget;if(!r)return;const n=mg(()=>{if(hg.has(r))return;pg(r,"down");const e=mg(()=>{pg(r,"up")});r.addEventListener("keyup",e,t),r.addEventListener("blur",()=>pg(r,"cancel"),t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)})(e,s),s)}),a}const xg=e=>1e3*e,vg=e=>e/1e3,yg=e=>e;const bg=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],wg=new Set(bg),jg=new Set(["width","height","top","left","right","bottom",...bg]),Ng=e=>Dp(e)?e[e.length-1]||0:e,Sg=!1,kg=!1;const Ag=["read","resolveKeyframes","update","preRender","render","postRender"];function Cg(e,t){let r=!1,n=!0;const s={delta:0,timestamp:0,isProcessing:!1},a=()=>r=!0,o=Ag.reduce((e,t)=>(e[t]=function(e){let t=new Set,r=new Set,n=!1,s=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function i(t){a.has(t)&&(l.schedule(t),e()),t(o)}const l={schedule:function(e){const s=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&n?t:r;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&a.add(e),s.has(e)||s.add(e),e},cancel:e=>{r.delete(e),a.delete(e)},process:e=>{o=e,n?s=!0:(n=!0,[t,r]=[r,t],t.forEach(i),t.clear(),n=!1,s&&(s=!1,l.process(e)))}};return l}(a),e),{}),{read:i,resolveKeyframes:l,update:c,preRender:d,render:u,postRender:h}=o,m=()=>{const a=kg?s.timestamp:performance.now();r=!1,s.delta=n?1e3/60:Math.max(Math.min(a-s.timestamp,40),1),s.timestamp=a,s.isProcessing=!0,i.process(s),l.process(s),c.process(s),d.process(s),u.process(s),h.process(s),s.isProcessing=!1,r&&t&&(n=!1,e(m))},p=Ag.reduce((t,a)=>{const i=o[a];return t[a]=function(t){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r||(r=!0,n=!0,s.isProcessing||e(m)),i.schedule(t,a,o)},t},{});return{schedule:p,cancel:e=>{for(let t=0;t<Ag.length;t++)o[Ag[t]].cancel(e)},state:s,steps:o}}const{schedule:Eg,cancel:Pg,state:Ig,steps:Tg}=Cg("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:yg,!0);let Dg;function Mg(){Dg=void 0}const _g={now:()=>(void 0===Dg&&_g.set(Ig.isProcessing||kg?Ig.timestamp:performance.now()),Dg),set:e=>{Dg=e,queueMicrotask(Mg)}};function Og(e,t){-1===e.indexOf(t)&&e.push(t)}function Lg(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class Rg{constructor(){this.subscriptions=[]}add(e){return Og(this.subscriptions,e),()=>Lg(this.subscriptions,e)}notify(e,t,r){const n=this.subscriptions.length;if(n)if(1===n)this.subscriptions[0](e,t,r);else for(let s=0;s<n;s++){const n=this.subscriptions[s];n&&n(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Fg(e,t){return t?e*(1e3/t):0}const Ug={current:void 0};class Bg{constructor(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=function(e){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=_g.now();t.updatedAt!==n&&t.setPrevFrameValue(),t.prev=t.current,t.setCurrent(e),t.current!==t.prev&&t.events.change&&t.events.change.notify(t.current),r&&t.events.renderRequest&&t.events.renderRequest.notify(t.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=_g.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(e=>!isNaN(parseFloat(e)))(this.current))}setPrevFrameValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Rg);const r=this.events[e].add(t);return"change"===e?()=>{r(),Eg.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return Ug.current&&Ug.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=_g.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return Fg(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Wg(e,t){return new Bg(e,t)}const zg=["transitionEnd","transition"];function Vg(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,Wg(r))}const Hg=e=>Boolean(e&&e.getVelocity);function qg(e,t){const r=e.getValue("willChange");if(function(e){return Boolean(Hg(e)&&e.add)}(r))return r.add(t)}const Kg=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Gg="data-"+Kg("framerAppearId");function Jg(e){return e.props[Gg]}const Yg=!1,Qg=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e;function Xg(e,t,r,n){if(e===t&&r===n)return yg;const s=t=>function(e,t,r,n,s){let a,o,i=0;do{o=t+(r-t)/2,a=Qg(o,n,s)-e,a>0?r=o:t=o}while(Math.abs(a)>1e-7&&++i<12);return o}(t,0,1,e,r);return e=>0===e||1===e?e:Qg(s(e),t,n)}const $g=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Zg=e=>t=>1-e(1-t),ef=Xg(.33,1.53,.69,.99),tf=Zg(ef),rf=$g(tf),nf=e=>(e*=2)<1?.5*tf(e):.5*(2-Math.pow(2,-10*(e-1))),sf=e=>1-Math.sin(Math.acos(e)),af=Zg(sf),of=$g(sf),lf=e=>/^0(?:[\0-\x08\x0E-\x1F!-\x2D\/-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+$/.test(e);function cf(e){return"number"===typeof e?0===e:null===e||("none"===e||"0"===e||lf(e))}const df=(e,t,r)=>r>t?t:r<e?e:r,uf={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},hf=(0,Y.A)((0,Y.A)({},uf),{},{transform:e=>df(0,1,e)}),mf=(0,Y.A)((0,Y.A)({},uf),{},{default:1}),pf=e=>Math.round(1e5*e)/1e5,gf=/-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/g;const ff=/^(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))$/i,xf=(e,t)=>r=>Boolean("string"===typeof r&&ff.test(r)&&r.startsWith(e)||t&&!function(e){return null==e}(r)&&Object.prototype.hasOwnProperty.call(r,t)),vf=(e,t,r)=>n=>{if("string"!==typeof n)return n;const[s,a,o,i]=n.match(gf);return{[e]:parseFloat(s),[t]:parseFloat(a),[r]:parseFloat(o),alpha:void 0!==i?parseFloat(i):1}},yf=(0,Y.A)((0,Y.A)({},uf),{},{transform:e=>Math.round((e=>df(0,255,e))(e))}),bf={test:xf("rgb","red"),parse:vf("red","green","blue"),transform:e=>{let{red:t,green:r,blue:n,alpha:s=1}=e;return"rgba("+yf.transform(t)+", "+yf.transform(r)+", "+yf.transform(n)+", "+pf(hf.transform(s))+")"}};const wf={test:xf("#"),parse:function(e){let t="",r="",n="",s="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),s=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),s=e.substring(4,5),t+=t,r+=r,n+=n,s+=s),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:s?parseInt(s,16)/255:1}},transform:bf.transform},jf=e=>({test:t=>"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>"".concat(t).concat(e)}),Nf=jf("deg"),Sf=jf("%"),kf=jf("px"),Af=jf("vh"),Cf=jf("vw"),Ef=(0,Y.A)((0,Y.A)({},Sf),{},{parse:e=>Sf.parse(e)/100,transform:e=>Sf.transform(100*e)}),Pf={test:xf("hsl","hue"),parse:vf("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:r,lightness:n,alpha:s=1}=e;return"hsla("+Math.round(t)+", "+Sf.transform(pf(r))+", "+Sf.transform(pf(n))+", "+pf(hf.transform(s))+")"}},If={test:e=>bf.test(e)||wf.test(e)||Pf.test(e),parse:e=>bf.test(e)?bf.parse(e):Pf.test(e)?Pf.parse(e):wf.parse(e),transform:e=>"string"===typeof e?e:e.hasOwnProperty("red")?bf.transform(e):Pf.transform(e)},Tf=/(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))/gi;const Df="number",Mf="color",_f=/var[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)|#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\)|-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/gi;function Of(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},s=[];let a=0;const o=t.replace(_f,e=>(If.test(e)?(n.color.push(a),s.push(Mf),r.push(If.parse(e))):e.startsWith("var(")?(n.var.push(a),s.push("var"),r.push(e)):(n.number.push(a),s.push(Df),r.push(parseFloat(e))),++a,"${}")).split("${}");return{values:r,split:o,indexes:n,types:s}}function Lf(e){return Of(e).values}function Rf(e){const{split:t,types:r}=Of(e),n=t.length;return e=>{let s="";for(let a=0;a<n;a++)if(s+=t[a],void 0!==e[a]){const t=r[a];s+=t===Df?pf(e[a]):t===Mf?If.transform(e[a]):e[a]}return s}}const Ff=e=>"number"===typeof e?0:e;const Uf={test:function(e){var t,r;return isNaN(e)&&"string"===typeof e&&((null===(t=e.match(gf))||void 0===t?void 0:t.length)||0)+((null===(r=e.match(Tf))||void 0===r?void 0:r.length)||0)>0},parse:Lf,createTransformer:Rf,getAnimatableNone:function(e){const t=Lf(e);return Rf(e)(t.map(Ff))}},Bf=new Set(["brightness","contrast","saturate","opacity"]);function Wf(e){const[t,r]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[n]=r.match(gf)||[];if(!n)return e;const s=r.replace(n,"");let a=Bf.has(t)?1:0;return n!==r&&(a*=100),t+"("+a+s+")"}const zf=/\b([\x2Da-z]*)\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\)/g,Vf=(0,Y.A)((0,Y.A)({},Uf),{},{getAnimatableNone:e=>{const t=e.match(zf);return t?t.map(Wf).join(" "):e}}),Hf={borderWidth:kf,borderTopWidth:kf,borderRightWidth:kf,borderBottomWidth:kf,borderLeftWidth:kf,borderRadius:kf,radius:kf,borderTopLeftRadius:kf,borderTopRightRadius:kf,borderBottomRightRadius:kf,borderBottomLeftRadius:kf,width:kf,maxWidth:kf,height:kf,maxHeight:kf,top:kf,right:kf,bottom:kf,left:kf,padding:kf,paddingTop:kf,paddingRight:kf,paddingBottom:kf,paddingLeft:kf,margin:kf,marginTop:kf,marginRight:kf,marginBottom:kf,marginLeft:kf,backgroundPositionX:kf,backgroundPositionY:kf},qf={rotate:Nf,rotateX:Nf,rotateY:Nf,rotateZ:Nf,scale:mf,scaleX:mf,scaleY:mf,scaleZ:mf,skew:Nf,skewX:Nf,skewY:Nf,distance:kf,translateX:kf,translateY:kf,translateZ:kf,x:kf,y:kf,z:kf,perspective:kf,transformPerspective:kf,opacity:hf,originX:Ef,originY:Ef,originZ:kf},Kf=(0,Y.A)((0,Y.A)({},uf),{},{transform:Math.round}),Gf=(0,Y.A)((0,Y.A)((0,Y.A)({},Hf),qf),{},{zIndex:Kf,size:kf,fillOpacity:hf,strokeOpacity:hf,numOctaves:Kf}),Jf=(0,Y.A)((0,Y.A)({},Gf),{},{color:If,backgroundColor:If,outlineColor:If,fill:If,stroke:If,borderColor:If,borderTopColor:If,borderRightColor:If,borderBottomColor:If,borderLeftColor:If,filter:Vf,WebkitFilter:Vf}),Yf=e=>Jf[e];function Qf(e,t){let r=Yf(e);return r!==Vf&&(r=Uf),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const Xf=new Set(["auto","none","0"]);const $f=e=>e===uf||e===kf,Zf=(e,t)=>parseFloat(e.split(", ")[t]),ex=(e,t)=>(r,n)=>{let{transform:s}=n;if("none"===s||!s)return 0;const a=s.match(/^matrix3d\(((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)\)$/);if(a)return Zf(a[1],t);{const t=s.match(/^matrix\(((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)\)$/);return t?Zf(t[1],e):0}},tx=new Set(["x","y","z"]),rx=bg.filter(e=>!tx.has(e));const nx={width:(e,t)=>{let{x:r}=e,{paddingLeft:n="0",paddingRight:s="0"}=t;return r.max-r.min-parseFloat(n)-parseFloat(s)},height:(e,t)=>{let{y:r}=e,{paddingTop:n="0",paddingBottom:s="0"}=t;return r.max-r.min-parseFloat(n)-parseFloat(s)},top:(e,t)=>{let{top:r}=t;return parseFloat(r)},left:(e,t)=>{let{left:r}=t;return parseFloat(r)},bottom:(e,t)=>{let{y:r}=e,{top:n}=t;return parseFloat(n)+(r.max-r.min)},right:(e,t)=>{let{x:r}=e,{left:n}=t;return parseFloat(n)+(r.max-r.min)},x:ex(4,13),y:ex(5,14)};nx.translateX=nx.x,nx.translateY=nx.y;const sx=new Set;let ax=!1,ox=!1;function ix(){if(ox){const e=Array.from(sx).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),r=new Map;t.forEach(e=>{const t=function(e){const t=[];return rx.forEach(r=>{const n=e.getValue(r);void 0!==n&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}(e);t.length&&(r.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=r.get(e);t&&t.forEach(t=>{let[r,n]=t;var s;null===(s=e.getValue(r))||void 0===s||s.set(n)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}ox=!1,ax=!1,sx.forEach(e=>e.complete()),sx.clear()}function lx(){sx.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(ox=!0)})}class cx{constructor(e,t,r,n,s){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=n,this.element=s,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(sx.add(this),ax||(ax=!0,Eg.read(lx),Eg.resolveKeyframes(ix))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:n}=this;for(let s=0;s<e.length;s++)if(null===e[s])if(0===s){const s=null===n||void 0===n?void 0:n.get(),a=e[e.length-1];if(void 0!==s)e[0]=s;else if(r&&t){const n=r.readValue(t,a);void 0!==n&&null!==n&&(e[0]=n)}void 0===e[0]&&(e[0]=a),n&&void 0===s&&n.set(e[0])}else e[s]=e[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),sx.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,sx.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}let dx=yg,ux=yg;const hx=e=>/^-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)$/.test(e),mx=e=>t=>"string"===typeof t&&t.startsWith(e),px=mx("--"),gx=mx("var(--"),fx=e=>!!gx(e)&&xx.test(e.split("/*")[0].trim()),xx=/var\(--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)$/i,vx=/^var\(--(?:([\x2D0-9A-Z_a-z]+)|([\x2D0-9A-Z_a-z]+), ?([ #%\(\),-\.0-9A-Za-z]+))\)/;function yx(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;ux(r<=4,'Max CSS variable fallback depth detected in property "'.concat(e,'". This may indicate a circular fallback dependency.'));const[n,s]=function(e){const t=vx.exec(e);if(!t)return[,];const[,r,n,s]=t;return["--".concat(null!==r&&void 0!==r?r:n),s]}(e);if(!n)return;const a=window.getComputedStyle(t).getPropertyValue(n);if(a){const e=a.trim();return hx(e)?parseFloat(e):e}return fx(s)?yx(s,t,r+1):s}const bx=e=>t=>t.test(e),wx=[uf,kf,Sf,Nf,Cf,Af,{test:e=>"auto"===e,parse:e=>e}],jx=e=>wx.find(bx(e));class Nx extends cx{constructor(e,t,r,n,s){super(e,t,r,n,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let i=0;i<e.length;i++){let r=e[i];if("string"===typeof r&&(r=r.trim(),fx(r))){const n=yx(r,t.current);void 0!==n&&(e[i]=n),i===e.length-1&&(this.finalKeyframe=r)}}if(this.resolveNoneKeyframes(),!jg.has(r)||2!==e.length)return;const[n,s]=e,a=jx(n),o=jx(s);if(a!==o)if($f(a)&&$f(o))for(let i=0;i<e.length;i++){const t=e[i];"string"===typeof t&&(e[i]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let n=0;n<e.length;n++)cf(e[n])&&r.push(n);r.length&&function(e,t,r){let n,s=0;for(;s<e.length&&!n;){const t=e[s];"string"===typeof t&&!Xf.has(t)&&Of(t).values.length&&(n=e[s]),s++}if(n&&r)for(const a of t)e[a]=Qf(r,n)}(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;"height"===r&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=nx[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const n=t[t.length-1];void 0!==n&&e.getValue(r,n).jump(n,!1)}measureEndState(){var e;const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const s=t.getValue(r);s&&s.jump(this.measuredOrigin,!1);const a=n.length-1,o=n[a];n[a]=nx[r](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach(e=>{let[r,n]=e;t.getValue(r).set(n)}),this.resolveNoneKeyframes()}}const Sx=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!Uf.test(e)&&"0"!==e||e.startsWith("url(")));function kx(e,t,r,n){const s=e[0];if(null===s)return!1;if("display"===t||"visibility"===t)return!0;const a=e[e.length-1],o=Sx(s,t),i=Sx(a,t);return dx(o===i,"You are trying to animate ".concat(t,' from "').concat(s,'" to "').concat(a,'". ').concat(s," is not an animatable value - to enable this animation set ").concat(s," to a value animatable to ").concat(a," via the `style` property.")),!(!o||!i)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}(e)||("spring"===r||Gp(r))&&n)}const Ax=e=>null!==e;function Cx(e,t,r){let{repeat:n,repeatType:s="loop"}=t;const a=e.filter(Ax),o=n&&"loop"!==s&&n%2===1?0:a.length-1;return o&&void 0!==r?r:a[o]}const Ex=["autoplay","delay","type","repeat","repeatDelay","repeatType"];class Px{constructor(e){let{autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:s=0,repeatDelay:a=0,repeatType:o="loop"}=e,i=Sn(e,Ex);this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=_g.now(),this.options=(0,Y.A)({autoplay:t,delay:r,type:n,repeat:s,repeatDelay:a,repeatType:o},i),this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(lx(),ix()),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=_g.now(),this.hasAttemptedResolve=!0;const{name:r,type:n,velocity:s,delay:a,onComplete:o,onUpdate:i,isGenerator:l}=this.options;if(!l&&!kx(e,r,n,s)){if(Yg||!a)return i&&i(Cx(e,this.options,t)),o&&o(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,t);!1!==c&&(this._resolved=(0,Y.A)({keyframes:e,finalKeyframe:t},c),this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Ix=(e,t,r)=>e+(t-e)*r;function Tx(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Dx(e,t){return r=>r>0?t:e}const Mx=(e,t,r)=>{const n=e*e,s=r*(t*t-n)+n;return s<0?0:Math.sqrt(s)},_x=[wf,bf,Pf];function Ox(e){const t=(r=e,_x.find(e=>e.test(r)));var r;if(dx(Boolean(t),"'".concat(e,"' is not an animatable color. Use the equivalent color code instead.")),!Boolean(t))return!1;let n=t.parse(e);return t===Pf&&(n=function(e){let{hue:t,saturation:r,lightness:n,alpha:s}=e;t/=360,r/=100,n/=100;let a=0,o=0,i=0;if(r){const e=n<.5?n*(1+r):n+r-n*r,s=2*n-e;a=Tx(s,e,t+1/3),o=Tx(s,e,t),i=Tx(s,e,t-1/3)}else a=o=i=n;return{red:Math.round(255*a),green:Math.round(255*o),blue:Math.round(255*i),alpha:s}}(n)),n}const Lx=(e,t)=>{const r=Ox(e),n=Ox(t);if(!r||!n)return Dx(e,t);const s=(0,Y.A)({},r);return e=>(s.red=Mx(r.red,n.red,e),s.green=Mx(r.green,n.green,e),s.blue=Mx(r.blue,n.blue,e),s.alpha=Ix(r.alpha,n.alpha,e),bf.transform(s))},Rx=(e,t)=>r=>t(e(r)),Fx=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(Rx)},Ux=new Set(["none","hidden"]);function Bx(e,t){return r=>Ix(e,t,r)}function Wx(e){return"number"===typeof e?Bx:"string"===typeof e?fx(e)?Dx:If.test(e)?Lx:Hx:Array.isArray(e)?zx:"object"===typeof e?If.test(e)?Lx:Vx:Dx}function zx(e,t){const r=[...e],n=r.length,s=e.map((e,r)=>Wx(e)(e,t[r]));return e=>{for(let t=0;t<n;t++)r[t]=s[t](e);return r}}function Vx(e,t){const r=(0,Y.A)((0,Y.A)({},e),t),n={};for(const s in r)void 0!==e[s]&&void 0!==t[s]&&(n[s]=Wx(e[s])(e[s],t[s]));return e=>{for(const t in n)r[t]=n[t](e);return r}}const Hx=(e,t)=>{const r=Uf.createTransformer(t),n=Of(e),s=Of(t);return n.indexes.var.length===s.indexes.var.length&&n.indexes.color.length===s.indexes.color.length&&n.indexes.number.length>=s.indexes.number.length?Ux.has(e)&&!s.values.length||Ux.has(t)&&!n.values.length?function(e,t){return Ux.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}(e,t):Fx(zx(function(e,t){var r;const n=[],s={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const o=t.types[a],i=e.indexes[o][s[o]],l=null!==(r=e.values[i])&&void 0!==r?r:0;n[a]=l,s[o]++}return n}(n,s),s.values),r):(dx(!0,"Complex values '".concat(e,"' and '").concat(t,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.")),Dx(e,t))};function qx(e,t,r){if("number"===typeof e&&"number"===typeof t&&"number"===typeof r)return Ix(e,t,r);return Wx(e)(e,t)}function Kx(e,t,r){const n=Math.max(t-5,0);return Fg(r-e(n),t-n)}const Gx={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Jx=.001;function Yx(e){let t,r,{duration:n=Gx.duration,bounce:s=Gx.bounce,velocity:a=Gx.velocity,mass:o=Gx.mass}=e;dx(n<=xg(Gx.maxDuration),"Spring duration must be 10 seconds or less");let i=1-s;i=df(Gx.minDamping,Gx.maxDamping,i),n=df(Gx.minDuration,Gx.maxDuration,vg(n)),i<1?(t=e=>{const t=e*i,r=t*n,s=t-a,o=Xx(e,i),l=Math.exp(-r);return Jx-s/o*l},r=e=>{const r=e*i*n,s=r*a+a,o=Math.pow(i,2)*Math.pow(e,2)*n,l=Math.exp(-r),c=Xx(Math.pow(e,2),i);return(-t(e)+Jx>0?-1:1)*((s-o)*l)/c}):(t=e=>Math.exp(-e*n)*((e-a)*n+1)-.001,r=e=>Math.exp(-e*n)*(n*n*(a-e)));const l=function(e,t,r){let n=r;for(let s=1;s<Qx;s++)n-=e(n)/t(n);return n}(t,r,5/n);if(n=xg(n),isNaN(l))return{stiffness:Gx.stiffness,damping:Gx.damping,duration:n};{const e=Math.pow(l,2)*o;return{stiffness:e,damping:2*i*Math.sqrt(o*e),duration:n}}}const Qx=12;function Xx(e,t){return e*Math.sqrt(1-t*t)}const $x=["duration","bounce"],Zx=["stiffness","damping","mass"];function ev(e,t){return t.some(t=>void 0!==e[t])}function tv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gx.visualDuration,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gx.bounce;const r="object"!==typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:s}=r;const a=r.keyframes[0],o=r.keyframes[r.keyframes.length-1],i={done:!1,value:a},{stiffness:l,damping:c,mass:d,duration:u,velocity:h,isResolvedFromDuration:m}=function(e){let t=(0,Y.A)({velocity:Gx.velocity,stiffness:Gx.stiffness,damping:Gx.damping,mass:Gx.mass,isResolvedFromDuration:!1},e);if(!ev(e,Zx)&&ev(e,$x))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(1.2*r),s=n*n,a=2*df(.05,1,1-(e.bounce||0))*Math.sqrt(s);t=(0,Y.A)((0,Y.A)({},t),{},{mass:Gx.mass,stiffness:s,damping:a})}else{const r=Yx(e);t=(0,Y.A)((0,Y.A)((0,Y.A)({},t),r),{},{mass:Gx.mass}),t.isResolvedFromDuration=!0}return t}((0,Y.A)((0,Y.A)({},r),{},{velocity:-vg(r.velocity||0)})),p=h||0,g=c/(2*Math.sqrt(l*d)),f=o-a,x=vg(Math.sqrt(l/d)),v=Math.abs(f)<5;let y;if(n||(n=v?Gx.restSpeed.granular:Gx.restSpeed.default),s||(s=v?Gx.restDelta.granular:Gx.restDelta.default),g<1){const e=Xx(x,g);y=t=>{const r=Math.exp(-g*x*t);return o-r*((p+g*x*f)/e*Math.sin(e*t)+f*Math.cos(e*t))}}else if(1===g)y=e=>o-Math.exp(-x*e)*(f+(p+x*f)*e);else{const e=x*Math.sqrt(g*g-1);y=t=>{const r=Math.exp(-g*x*t),n=Math.min(e*t,300);return o-r*((p+g*x*f)*Math.sinh(n)+e*f*Math.cosh(n))/e}}const b={calculatedDuration:m&&u||null,next:e=>{const t=y(e);if(m)i.done=e>=u;else{let r=0;g<1&&(r=0===e?xg(p):Kx(y,e,t));const a=Math.abs(r)<=n,l=Math.abs(o-t)<=s;i.done=a&&l}return i.value=i.done?o:t,i},toString:()=>{const e=Math.min(Kp(b),qp),t=eg(t=>b.next(e*t).value,e,30);return e+"ms "+t}};return b}function rv(e){let{keyframes:t,velocity:r=0,power:n=.8,timeConstant:s=325,bounceDamping:a=10,bounceStiffness:o=500,modifyTarget:i,min:l,max:c,restDelta:d=.5,restSpeed:u}=e;const h=t[0],m={done:!1,value:h},p=e=>void 0===l?c:void 0===c||Math.abs(l-e)<Math.abs(c-e)?l:c;let g=n*r;const f=h+g,x=void 0===i?f:i(f);x!==f&&(g=x-h);const v=e=>-g*Math.exp(-e/s),y=e=>x+v(e),b=e=>{const t=v(e),r=y(e);m.done=Math.abs(t)<=d,m.value=m.done?x:r};let w,j;const N=e=>{var t;(t=m.value,void 0!==l&&t<l||void 0!==c&&t>c)&&(w=e,j=tv({keyframes:[m.value,p(m.value)],velocity:Kx(y,e,m.value),damping:a,stiffness:o,restDelta:d,restSpeed:u}))};return N(0),{calculatedDuration:null,next:e=>{let t=!1;return j||void 0!==w||(t=!0,b(e),N(e)),void 0!==w&&e>=w?j.next(e-w):(!t&&b(e),m)}}}const nv=Xg(.42,0,1,1),sv=Xg(0,0,.58,1),av=Xg(.42,0,.58,1),ov={linear:yg,easeIn:nv,easeInOut:av,easeOut:sv,circIn:sf,circInOut:of,circOut:af,backIn:tf,backInOut:rf,backOut:ef,anticipate:nf},iv=e=>{if(Yp(e)){ux(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[t,r,n,s]=e;return Xg(t,r,n,s)}return"string"===typeof e?(ux(void 0!==ov[e],"Invalid easing type '".concat(e,"'")),ov[e]):e};function lv(e,t){let{clamp:r=!0,ease:n,mixer:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=e.length;if(ux(a===t.length,"Both input and output ranges must be the same length"),1===a)return()=>t[0];if(2===a&&t[0]===t[1])return()=>t[1];const o=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=function(e,t,r){const n=[],s=r||qx,a=e.length-1;for(let o=0;o<a;o++){let r=s(e[o],e[o+1]);if(t){const e=Array.isArray(t)?t[o]||yg:t;r=Fx(e,r)}n.push(r)}return n}(t,n,s),l=i.length,c=r=>{if(o&&r<e[0])return t[0];let n=0;if(l>1)for(;n<e.length-2&&!(r<e[n+1]);n++);const s=Zp(e[n],e[n+1],r);return i[n](s)};return r?t=>c(df(e[0],e[a-1],t)):c}function cv(e){const t=[0];return function(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const s=Zp(0,t,n);e.push(Ix(r,1,s))}}(t,e.length-1),t}function dv(e){let{duration:t=300,keyframes:r,times:n,ease:s="easeInOut"}=e;const a=(e=>Array.isArray(e)&&"number"!==typeof e[0])(s)?s.map(iv):iv(s),o={done:!1,value:r[0]},i=function(e,t){return e.map(e=>e*t)}(n&&n.length===r.length?n:cv(r),t),l=lv(i,r,{ease:Array.isArray(a)?a:(c=r,d=a,c.map(()=>d||av).splice(0,c.length-1))});var c,d;return{calculatedDuration:t,next:e=>(o.value=l(e),o.done=e>=t,o)}}const uv=e=>{const t=t=>{let{timestamp:r}=t;return e(r)};return{start:()=>Eg.update(t,!0),stop:()=>Pg(t),now:()=>Ig.isProcessing?Ig.timestamp:_g.now()}},hv={decay:rv,inertia:rv,tween:dv,keyframes:dv,spring:tv},mv=e=>e/100;class pv extends Px{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:t,motionValue:r,element:n,keyframes:s}=this.options,a=(null===n||void 0===n?void 0:n.KeyframeResolver)||cx;this.resolver=new a(s,(e,t)=>this.onKeyframesResolved(e,t),t,r,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:r=0,repeatDelay:n=0,repeatType:s,velocity:a=0}=this.options,o=Gp(t)?t:hv[t]||dv;let i,l;o!==dv&&"number"!==typeof e[0]&&(i=Fx(mv,qx(e[0],e[1])),e=[0,100]);const c=o((0,Y.A)((0,Y.A)({},this.options),{},{keyframes:e}));"mirror"===s&&(l=o((0,Y.A)((0,Y.A)({},this.options),{},{keyframes:[...e].reverse(),velocity:-a}))),null===c.calculatedDuration&&(c.calculatedDuration=Kp(c));const{calculatedDuration:d}=c,u=d+n;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:i,calculatedDuration:d,resolvedDuration:u,totalDuration:u*(r+1)-n}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{resolved:r}=this;if(!r){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:n,generator:s,mirroredGenerator:a,mapPercentToKeyframes:o,keyframes:i,calculatedDuration:l,totalDuration:c,resolvedDuration:d}=r;if(null===this.startTime)return s.next(0);const{delay:u,repeat:h,repeatType:m,repeatDelay:p,onUpdate:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const f=this.currentTime-u*(this.speed>=0?1:-1),x=this.speed>=0?f<0:f>c;this.currentTime=Math.max(f,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let v=this.currentTime,y=s;if(h){const e=Math.min(this.currentTime,c)/d;let t=Math.floor(e),r=e%1;!r&&e>=1&&(r=1),1===r&&t--,t=Math.min(t,h+1);Boolean(t%2)&&("reverse"===m?(r=1-r,p&&(r-=p/d)):"mirror"===m&&(y=a)),v=df(0,1,r)*d}const b=x?{done:!1,value:i[0]}:y.next(v);o&&(b.value=o(b.value));let{done:w}=b;x||null===l||(w=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const j=null===this.holdTime&&("finished"===this.state||"running"===this.state&&w);return j&&void 0!==n&&(b.value=Cx(i,this.options,n)),g&&g(b.value),j&&this.finish(),b}get duration(){const{resolved:e}=this;return e?vg(e.calculatedDuration):0}get time(){return vg(this.currentTime)}set time(e){e=xg(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=vg(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=uv,onPlay:t,startTime:r}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),t&&t();const n=this.driver.now();null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=n):this.startTime=null!==r&&void 0!==r?r:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const gv=new Set(["opacity","clipPath","filter","transform"]);const fv=Bp(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),xv=["onComplete","onUpdate","motionValue","element"],vv=["motionValue","onUpdate","onComplete","element"];const yv={anticipate:nf,backInOut:rf,circInOut:of};class bv extends Px{constructor(e){super(e);const{name:t,motionValue:r,element:n,keyframes:s}=this.options;this.resolver=new Nx(s,(e,t)=>this.onKeyframesResolved(e,t),t,r,n),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:r=300,times:n,ease:s,type:a,motionValue:o,name:i,startTime:l}=this.options;if(!o.owner||!o.owner.current)return!1;var c;if("string"===typeof s&&$p()&&s in yv&&(s=yv[s]),Gp((c=this.options).type)||"spring"===c.type||!tg(c.ease)){const t=this.options,{onComplete:o,onUpdate:i,motionValue:l,element:c}=t,d=Sn(t,xv),u=function(e,t){const r=new pv((0,Y.A)((0,Y.A)({},t),{},{keyframes:e,repeat:0,delay:0,isGenerator:!0}));let n={done:!1,value:e[0]};const s=[];let a=0;for(;!n.done&&a<2e4;)n=r.sample(a),s.push(n.value),a+=10;return{times:void 0,keyframes:s,duration:a-10,ease:"linear"}}(e,d);1===(e=u.keyframes).length&&(e[1]=e[0]),r=u.duration,n=u.times,s=u.ease,a="keyframes"}const d=function(e,t,r){let{delay:n=0,duration:s=300,repeat:a=0,repeatType:o="loop",ease:i="easeInOut",times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c={[t]:r};l&&(c.offset=l);const d=sg(i,s);return Array.isArray(d)&&(c.easing=d),e.animate(c,{delay:n,duration:s,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:a+1,direction:"reverse"===o?"alternate":"normal"})}(o.owner.current,i,e,(0,Y.A)((0,Y.A)({},this.options),{},{duration:r,times:n,ease:s}));return d.startTime=null!==l&&void 0!==l?l:this.calcStartTime(),this.pendingTimeline?(Jp(d,this.pendingTimeline),this.pendingTimeline=void 0):d.onfinish=()=>{const{onComplete:r}=this.options;o.set(Cx(e,this.options,t)),r&&r(),this.cancel(),this.resolveFinishedPromise()},{animation:d,duration:r,times:n,type:a,ease:s,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return vg(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return vg(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.currentTime=xg(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return yg;const{animation:r}=t;Jp(r,e)}else this.pendingTimeline=e;return yg}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:r,duration:n,type:s,ease:a,times:o}=e;if("idle"===t.playState||"finished"===t.playState)return;if(this.time){const e=this.options,{motionValue:t,onUpdate:i,onComplete:l,element:c}=e,d=Sn(e,vv),u=new pv((0,Y.A)((0,Y.A)({},d),{},{keyframes:r,duration:n,type:s,ease:a,times:o,isGenerator:!0})),h=xg(this.time);t.setWithVelocity(u.sample(h-10).value,u.sample(h).value,10)}const{onStop:i}=this.options;i&&i(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:r,repeatDelay:n,repeatType:s,damping:a,type:o}=e;if(!t||!t.owner||!(t.owner.current instanceof HTMLElement))return!1;const{onUpdate:i,transformTemplate:l}=t.owner.getProps();return fv()&&r&&gv.has(r)&&!i&&!l&&!n&&"mirror"!==s&&0!==a&&"inertia"!==o}}const wv={type:"spring",stiffness:500,damping:25,restSpeed:10},jv={type:"keyframes",duration:.8},Nv={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Sv=(e,t)=>{let{keyframes:r}=t;return r.length>2?jv:wg.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===r[1]?2*Math.sqrt(550):30,restSpeed:10}:wv:Nv},kv=["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","elapsed"];const Av=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return o=>{const i=Hp(n,e)||{},l=i.delay||n.delay||0;let{elapsed:c=0}=n;c-=xg(l);let d=(0,Y.A)((0,Y.A)({keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity()},i),{},{delay:-c,onUpdate:e=>{t.set(e),i.onUpdate&&i.onUpdate(e)},onComplete:()=>{o(),i.onComplete&&i.onComplete()},name:e,motionValue:t,element:a?void 0:s});(function(e){let{when:t,delay:r,delayChildren:n,staggerChildren:s,staggerDirection:a,repeat:o,repeatType:i,repeatDelay:l,from:c,elapsed:d}=e,u=Sn(e,kv);return!!Object.keys(u).length})(i)||(d=(0,Y.A)((0,Y.A)({},d),Sv(e,d))),d.duration&&(d.duration=xg(d.duration)),d.repeatDelay&&(d.repeatDelay=xg(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let u=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(d.duration=0,0===d.delay&&(u=!0)),(Yg||Sg)&&(u=!0,d.duration=0,d.delay=0),u&&!a&&void 0!==t.get()){const e=Cx(d.keyframes,i);if(void 0!==e)return Eg.update(()=>{d.onUpdate(e),d.onComplete()}),new Vp([])}return!a&&bv.supports(d)?new bv(d):new pv(d)}},Cv=["transition","transitionEnd"];function Ev(e,t){let{protectedKeys:r,needsAnimating:n}=e;const s=r.hasOwnProperty(t)&&!0!==n[t];return n[t]=!1,s}function Pv(e,t){let{delay:r=0,transitionOverride:n,type:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var a;let{transition:o=e.getDefaultTransition(),transitionEnd:i}=t,l=Sn(t,Cv);n&&(o=n);const c=[],d=s&&e.animationState&&e.animationState.getState()[s];for(const u in l){const t=e.getValue(u,null!==(a=e.latestValues[u])&&void 0!==a?a:null),n=l[u];if(void 0===n||d&&Ev(d,u))continue;const s=(0,Y.A)({delay:r},Hp(o||{},u));let i=!1;if(window.MotionHandoffAnimation){const t=Jg(e);if(t){const e=window.MotionHandoffAnimation(t,u,Eg);null!==e&&(s.startTime=e,i=!0)}}qg(e,u),t.start(Av(u,t,n,e.shouldReduceMotion&&jg.has(u)?{type:!1}:s,e,i));const h=t.animation;h&&c.push(h)}return i&&Promise.all(c).then(()=>{Eg.update(()=>{i&&function(e,t){let r=Rp(e,t)||{},{transitionEnd:n={},transition:s={}}=r,a=Sn(r,zg);a=(0,Y.A)((0,Y.A)({},a),n);for(const o in a)Vg(e,o,Ng(a[o]))}(e,i)})}),c}function Iv(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n;const s=Rp(e,t,"exit"===r.type?null===(n=e.presenceContext)||void 0===n?void 0:n.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=s||{};r.transitionOverride&&(a=r.transitionOverride);const o=s?()=>Promise.all(Pv(e,s,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:s=0,staggerChildren:o,staggerDirection:i}=a;return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5?arguments[5]:void 0;const o=[],i=(e.variantChildren.size-1)*n,l=1===s?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*n}:function(){return i-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*n};return Array.from(e.variantChildren).sort(Tv).forEach((e,n)=>{e.notify("AnimationStart",t),o.push(Iv(e,t,(0,Y.A)((0,Y.A)({},a),{},{delay:r+l(n)})).then(()=>e.notify("AnimationComplete",t)))}),Promise.all(o)}(e,t,s+n,o,i,r)}:()=>Promise.resolve(),{when:l}=a;if(l){const[e,t]="beforeChildren"===l?[o,i]:[i,o];return e().then(()=>t())}return Promise.all([o(),i(r.delay)])}function Tv(e,t){return e.sortNodePosition(t)}const Dv=Up.length;function Mv(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&Mv(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let r=0;r<Dv;r++){const n=Up[r],s=e.props[n];(_p(s)||!1===s)&&(t[n]=s)}return t}const _v=["transition","transitionEnd"],Ov=[...Fp].reverse(),Lv=Fp.length;function Rv(e){return t=>Promise.all(t.map(t=>{let{animation:r,options:n}=t;return function(e,t){let r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const s=t.map(t=>Iv(e,t,n));r=Promise.all(s)}else if("string"===typeof t)r=Iv(e,t,n);else{const s="function"===typeof t?Rp(e,t,n.custom):t;r=Promise.all(Pv(e,s,n))}return r.then(()=>{e.notify("AnimationComplete",t)})}(e,r,n)}))}function Fv(e){let t=Rv(e),r=Wv(),n=!0;const s=t=>(r,n)=>{var s;const a=Rp(e,n,"exit"===t?null===(s=e.presenceContext)||void 0===s?void 0:s.custom:void 0);if(a){const{transition:e,transitionEnd:t}=a,n=Sn(a,_v);r=(0,Y.A)((0,Y.A)((0,Y.A)({},r),n),t)}return r};function a(a){const{props:o}=e,i=Mv(e.parent)||{},l=[],c=new Set;let d={},u=1/0;for(let t=0;t<Lv;t++){const h=Ov[t],m=r[h],p=void 0!==o[h]?o[h]:i[h],g=_p(p),f=h===a?m.isActive:null;!1===f&&(u=t);let x=p===i[h]&&p!==o[h]&&g;if(x&&n&&e.manuallyAnimateOnMount&&(x=!1),m.protectedKeys=(0,Y.A)({},d),!m.isActive&&null===f||!p&&!m.prevProp||Tp(p)||"boolean"===typeof p)continue;const v=Uv(m.prevProp,p);let y=v||h===a&&m.isActive&&!x&&g||t>u&&g,b=!1;const w=Array.isArray(p)?p:[p];let j=w.reduce(s(h),{});!1===f&&(j={});const{prevResolvedValues:N={}}=m,S=(0,Y.A)((0,Y.A)({},N),j),k=t=>{y=!0,c.has(t)&&(b=!0,c.delete(t)),m.needsAnimating[t]=!0;const r=e.getValue(t);r&&(r.liveStyle=!1)};for(const e in S){const t=j[e],r=N[e];if(d.hasOwnProperty(e))continue;let n=!1;n=Dp(t)&&Dp(r)?!Mp(t,r):t!==r,n?void 0!==t&&null!==t?k(e):c.add(e):void 0!==t&&c.has(e)?k(e):m.protectedKeys[e]=!0}m.prevProp=p,m.prevResolvedValues=j,m.isActive&&(d=(0,Y.A)((0,Y.A)({},d),j)),n&&e.blockInitialAnimation&&(y=!1);y&&(!(x&&v)||b)&&l.push(...w.map(e=>({animation:e,options:{type:h}})))}if(c.size){const t={};c.forEach(r=>{const n=e.getBaseTarget(r),s=e.getValue(r);s&&(s.liveStyle=!0),t[r]=null!==n&&void 0!==n?n:null}),l.push({animation:t})}let h=Boolean(l.length);return!n||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(h=!1),n=!1,h?t(l):Promise.resolve()}return{animateChanges:a,setActive:function(t,n){var s;if(r[t].isActive===n)return Promise.resolve();null===(s=e.variantChildren)||void 0===s||s.forEach(e=>{var r;return null===(r=e.animationState)||void 0===r?void 0:r.setActive(t,n)}),r[t].isActive=n;const o=a(t);for(const e in r)r[e].protectedKeys={};return o},setAnimateFunction:function(r){t=r(e)},getState:()=>r,reset:()=>{r=Wv(),n=!0}}}function Uv(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!Mp(t,e)}function Bv(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Wv(){return{animate:Bv(!0),whileInView:Bv(),whileHover:Bv(),whileTap:Bv(),whileDrag:Bv(),whileFocus:Bv(),exit:Bv()}}class zv{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Vv=0;const Hv={animation:{Feature:class extends zv{constructor(e){super(e),e.animationState||(e.animationState=Fv(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Tp(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends zv{constructor(){super(...arguments),this.id=Vv++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const n=this.node.animationState.setActive("exit",!e);t&&!e&&n.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}};function qv(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function Kv(e){return{point:{x:e.pageX,y:e.pageY}}}function Gv(e,t,r,n){return qv(e,t,(e=>t=>dg(t)&&e(t,Kv(t)))(r),n)}const Jv=(e,t)=>Math.abs(e-t);class Yv{constructor(e,t){let{transformPagePoint:r,contextWindow:n,dragSnapToOrigin:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=$v(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,r=function(e,t){const r=Jv(e.x,t.x),n=Jv(e.y,t.y);return Math.sqrt(r**2+n**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!r)return;const{point:n}=e,{timestamp:s}=Ig;this.history.push((0,Y.A)((0,Y.A)({},n),{},{timestamp:s}));const{onStart:a,onMove:o}=this.handlers;t||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Qv(t,this.transformPagePoint),Eg.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:r,onSessionEnd:n,resumeAnimation:s}=this.handlers;if(this.dragSnapToOrigin&&s&&s(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=$v("pointercancel"===e.type?this.lastMoveEventInfo:Qv(t,this.transformPagePoint),this.history);this.startEvent&&r&&r(e,a),n&&n(e,a)},!dg(e))return;this.dragSnapToOrigin=s,this.handlers=t,this.transformPagePoint=r,this.contextWindow=n||window;const a=Qv(Kv(e),this.transformPagePoint),{point:o}=a,{timestamp:i}=Ig;this.history=[(0,Y.A)((0,Y.A)({},o),{},{timestamp:i})];const{onSessionStart:l}=t;l&&l(e,$v(a,this.history)),this.removeListeners=Fx(Gv(this.contextWindow,"pointermove",this.handlePointerMove),Gv(this.contextWindow,"pointerup",this.handlePointerUp),Gv(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Pg(this.updatePoint)}}function Qv(e,t){return t?{point:t(e.point)}:e}function Xv(e,t){return{x:e.x-t.x,y:e.y-t.y}}function $v(e,t){let{point:r}=e;return{point:r,delta:Xv(r,ey(t)),offset:Xv(r,Zv(t)),velocity:ty(t,.1)}}function Zv(e){return e[0]}function ey(e){return e[e.length-1]}function ty(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const s=ey(e);for(;r>=0&&(n=e[r],!(s.timestamp-n.timestamp>xg(t)));)r--;if(!n)return{x:0,y:0};const a=vg(s.timestamp-n.timestamp);if(0===a)return{x:0,y:0};const o={x:(s.x-n.x)/a,y:(s.y-n.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function ry(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function ny(e){return e.max-e.min}function sy(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=n,e.originPoint=Ix(t.min,t.max,e.origin),e.scale=ny(r)/ny(t),e.translate=Ix(r.min,r.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function ay(e,t,r,n){sy(e.x,t.x,r.x,n?n.originX:void 0),sy(e.y,t.y,r.y,n?n.originY:void 0)}function oy(e,t,r){e.min=r.min+t.min,e.max=e.min+ny(t)}function iy(e,t,r){e.min=t.min-r.min,e.max=e.min+ny(t)}function ly(e,t,r){iy(e.x,t.x,r.x),iy(e.y,t.y,r.y)}function cy(e,t,r){return{min:void 0!==t?e.min+t:void 0,max:void 0!==r?e.max+r-(e.max-e.min):void 0}}function dy(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}const uy=.35;function hy(e,t,r){return{min:my(e,t),max:my(e,r)}}function my(e,t){return"number"===typeof e?e:e[t]||0}const py=()=>({x:{min:0,max:0},y:{min:0,max:0}});function gy(e){return[e("x"),e("y")]}function fy(e){let{top:t,left:r,right:n,bottom:s}=e;return{x:{min:r,max:n},y:{min:t,max:s}}}function xy(e){return void 0===e||1===e}function vy(e){let{scale:t,scaleX:r,scaleY:n}=e;return!xy(t)||!xy(r)||!xy(n)}function yy(e){return vy(e)||by(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function by(e){return wy(e.x)||wy(e.y)}function wy(e){return e&&"0%"!==e}function jy(e,t,r){return r+t*(e-r)}function Ny(e,t,r,n,s){return void 0!==s&&(e=jy(e,s,n)),jy(e,r,n)+t}function Sy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;e.min=Ny(e.min,t,r,n,s),e.max=Ny(e.max,t,r,n,s)}function ky(e,t){let{x:r,y:n}=t;Sy(e.x,r.translate,r.scale,r.originPoint),Sy(e.y,n.translate,n.scale,n.originPoint)}const Ay=.999999999999,Cy=1.0000000000001;function Ey(e,t){e.min=e.min+t,e.max=e.max+t}function Py(e,t,r,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;Sy(e,t,r,Ix(e.min,e.max,s),n)}function Iy(e,t){Py(e.x,t.x,t.scaleX,t.scale,t.originX),Py(e.y,t.y,t.scaleY,t.scale,t.originY)}function Ty(e,t){return fy(function(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}(e.getBoundingClientRect(),t))}const Dy=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null},My=new WeakMap;class _y{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e){let{snapToCursor:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:r}=this.visualElement;if(r&&!1===r.isPresent)return;const{dragSnapToOrigin:n}=this.getProps();this.panSession=new Yv(e,{onSessionStart:e=>{const{dragSnapToOrigin:r}=this.getProps();r?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Kv(e).point)},onStart:(e,t)=>{const{drag:r,dragPropagation:n,onDragStart:s}=this.getProps();if(r&&!n&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(a=r)||"y"===a?ag[a]?null:(ag[a]=!0,()=>{ag[a]=!1}):ag.x||ag.y?null:(ag.x=ag.y=!0,()=>{ag.x=ag.y=!1}),!this.openDragLock))return;var a;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),gy(e=>{let t=this.getAxisMotionValue(e).get()||0;if(Sf.test(t)){const{projection:r}=this.visualElement;if(r&&r.layout){const n=r.layout.layoutBox[e];if(n){t=ny(n)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),s&&Eg.postRender(()=>s(e,t)),qg(this.visualElement,"transform");const{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:r,dragDirectionLock:n,onDirectionLock:s,onDrag:a}=this.getProps();if(!r&&!this.openDragLock)return;const{offset:o}=t;if(n&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=null;Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x");return r}(o),void(null!==this.currentDirection&&s&&s(this.currentDirection));this.updateAxis("x",t.point,o),this.updateAxis("y",t.point,o),this.visualElement.render(),a&&a(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>gy(e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:n,contextWindow:Dy(this.visualElement)})}stop(e,t){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:n}=t;this.startAnimation(n);const{onDragEnd:s}=this.getProps();s&&Eg.postRender(()=>s(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:n}=this.getProps();if(!r||!Oy(e,n,this.currentDirection))return;const s=this.getAxisMotionValue(e);let a=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(a=function(e,t,r){let{min:n,max:s}=t;return void 0!==n&&e<n?e=r?Ix(n,e,r.min):Math.max(e,n):void 0!==s&&e>s&&(e=r?Ix(s,e,r.max):Math.min(e,s)),e}(a,this.constraints[e],this.elastic[e])),s.set(a)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,s=this.constraints;t&&ry(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!n)&&function(e,t){let{top:r,left:n,bottom:s,right:a}=t;return{x:cy(e.x,n,a),y:cy(e.y,r,s)}}(n.layoutBox,t),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:uy;return!1===e?e=0:!0===e&&(e=uy),{x:hy(e,"left","right"),y:hy(e,"top","bottom")}}(r),s!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&gy(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const r={};return void 0!==t.min&&(r.min=t.min-e.min),void 0!==t.max&&(r.max=t.max-e.min),r}(n.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!ry(e))return!1;const r=e.current;ux(null!==r,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const s=function(e,t,r){const n=Ty(e,r),{scroll:s}=t;return s&&(Ey(n.x,s.offset.x),Ey(n.y,s.offset.y)),n}(r,n.root,this.visualElement.getTransformPagePoint());let a=function(e,t){return{x:dy(e.x,t.x),y:dy(e.y,t.y)}}(n.layout.layoutBox,s);if(t){const e=t(function(e){let{x:t,y:r}=e;return{top:r.min,right:t.max,bottom:r.max,left:t.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=fy(e))}return a}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:n,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),i=this.constraints||{},l=gy(o=>{if(!Oy(o,t,this.currentDirection))return;let l=i&&i[o]||{};a&&(l={min:0,max:0});const c=n?200:1e6,d=n?40:1e7,u=(0,Y.A)((0,Y.A)({type:"inertia",velocity:r?e[o]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10},s),l);return this.startAxisValueAnimation(o,u)});return Promise.all(l).then(o)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return qg(this.visualElement,e),r.start(Av(e,r,0,t,this.visualElement,!1))}stopAnimation(){gy(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){gy(e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()})}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t="_drag".concat(e.toUpperCase()),r=this.visualElement.getProps(),n=r[t];return n||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){gy(t=>{const{drag:r}=this.getProps();if(!Oy(t,r,this.currentDirection))return;const{projection:n}=this.visualElement,s=this.getAxisMotionValue(t);if(n&&n.layout){const{min:r,max:a}=n.layout.layoutBox[t];s.set(e[t]-Ix(r,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!ry(t)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};gy(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const r=t.get();n[e]=function(e,t){let r=.5;const n=ny(e),s=ny(t);return s>n?r=Zp(t.min,t.max-n,e.min):n>s&&(r=Zp(e.min,e.max-s,t.min)),df(0,1,r)}({min:r,max:r},this.constraints[e])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),gy(t=>{if(!Oy(t,e,null))return;const r=this.getAxisMotionValue(t),{min:s,max:a}=this.constraints[t];r.set(Ix(s,a,n[t]))})}addListeners(){if(!this.visualElement.current)return;My.set(this.visualElement,this);const e=Gv(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:r=!0}=this.getProps();t&&r&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();ry(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,n=r.addEventListener("measure",t);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Eg.read(t);const s=qv(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:r}=e;this.isDragging&&r&&(gy(e=>{const r=this.getAxisMotionValue(e);r&&(this.originPoint[e]+=t[e].translate,r.set(r.get()+t[e].translate))}),this.visualElement.render())});return()=>{s(),e(),n(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:s=!1,dragElastic:a=uy,dragMomentum:o=!0}=e;return(0,Y.A)((0,Y.A)({},e),{},{drag:t,dragDirectionLock:r,dragPropagation:n,dragConstraints:s,dragElastic:a,dragMomentum:o})}}function Oy(e,t,r){return(!0===t||t===e)&&(null===r||r===e)}const Ly=e=>(t,r)=>{e&&Eg.postRender(()=>e(t,r))};const Ry=(0,o.createContext)(null);function Fy(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=(0,o.useContext)(Ry);if(null===t)return[!0,null];const{isPresent:r,onExitComplete:n,register:s}=t,a=(0,o.useId)();(0,o.useEffect)(()=>{e&&s(a)},[e]);const i=(0,o.useCallback)(()=>e&&n&&n(a),[a,n,e]);return!r&&n?[!1,i]:[!0]}const Uy=(0,o.createContext)({}),By=(0,o.createContext)({}),Wy={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function zy(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Vy={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!kf.test(e))return e;e=parseFloat(e)}const r=zy(e,t.target.x),n=zy(e,t.target.y);return"".concat(r,"% ").concat(n,"%")}},Hy={correct:(e,t)=>{let{treeScale:r,projectionDelta:n}=t;const s=e,a=Uf.parse(e);if(a.length>5)return s;const o=Uf.createTransformer(e),i="number"!==typeof a[0]?1:0,l=n.x.scale*r.x,c=n.y.scale*r.y;a[0+i]/=l,a[1+i]/=c;const d=Ix(l,c,.5);return"number"===typeof a[2+i]&&(a[2+i]/=d),"number"===typeof a[3+i]&&(a[3+i]/=d),o(a)}},qy={};const{schedule:Ky,cancel:Gy}=Cg(queueMicrotask,!1);class Jy extends o.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:n}=this.props,{projection:s}=e;var a;a=Qy,Object.assign(qy,a),s&&(t.group&&t.group.add(s),r&&r.register&&n&&r.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions((0,Y.A)((0,Y.A)({},s.options),{},{onExitComplete:()=>this.safeToRemove()}))),Wy.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:n,isPresent:s}=this.props,a=r.projection;return a?(a.isPresent=s,n||e.layoutDependency!==t||void 0===t?a.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?a.promote():a.relegate()||Eg.postRender(()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Ky.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:n}=e;n&&(n.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Yy(e){const[t,r]=Fy(),n=(0,o.useContext)(Uy);return(0,kt.jsx)(Jy,(0,Y.A)((0,Y.A)({},e),{},{layoutGroup:n,switchLayoutGroup:(0,o.useContext)(By),isPresent:t,safeToRemove:r}))}const Qy={borderRadius:(0,Y.A)((0,Y.A)({},Vy),{},{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:Vy,borderTopRightRadius:Vy,borderBottomLeftRadius:Vy,borderBottomRightRadius:Vy,boxShadow:Hy};const Xy=(e,t)=>e.depth-t.depth;class $y{constructor(){this.children=[],this.isDirty=!1}add(e){Og(this.children,e),this.isDirty=!0}remove(e){Lg(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Xy),this.isDirty=!1,this.children.forEach(e)}}function Zy(e,t){const r=_g.now(),n=s=>{let{timestamp:a}=s;const o=a-r;o>=t&&(Pg(n),e(o-t))};return Eg.read(n,!0),()=>Pg(n)}function eb(e){const t=Hg(e)?e.get():e;return r=t,Boolean(r&&"object"===typeof r&&r.mix&&r.toValue)?t.toValue():t;var r}const tb=["TopLeft","TopRight","BottomLeft","BottomRight"],rb=tb.length,nb=e=>"string"===typeof e?parseFloat(e):e,sb=e=>"number"===typeof e||kf.test(e);function ab(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const ob=lb(0,.5,af),ib=lb(.5,.95,yg);function lb(e,t,r){return n=>n<e?0:n>t?1:r(Zp(e,t,n))}function cb(e,t){e.min=t.min,e.max=t.max}function db(e,t){cb(e.x,t.x),cb(e.y,t.y)}function ub(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function hb(e,t,r,n,s){return e=jy(e-=t,1/r,n),void 0!==s&&(e=jy(e,1/s,n)),e}function mb(e,t,r,n,s){let[a,o,i]=r;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,s=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;Sf.test(t)&&(t=parseFloat(t),t=Ix(o.min,o.max,t/100)-o.min);if("number"!==typeof t)return;let i=Ix(a.min,a.max,n);e===a&&(i-=t),e.min=hb(e.min,t,r,i,s),e.max=hb(e.max,t,r,i,s)}(e,t[a],t[o],t[i],t.scale,n,s)}const pb=["x","scaleX","originX"],gb=["y","scaleY","originY"];function fb(e,t,r,n){mb(e.x,t,pb,r?r.x:void 0,n?n.x:void 0),mb(e.y,t,gb,r?r.y:void 0,n?n.y:void 0)}function xb(e){return 0===e.translate&&1===e.scale}function vb(e){return xb(e.x)&&xb(e.y)}function yb(e,t){return e.min===t.min&&e.max===t.max}function bb(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function wb(e,t){return bb(e.x,t.x)&&bb(e.y,t.y)}function jb(e){return ny(e.x)/ny(e.y)}function Nb(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Sb{constructor(){this.members=[]}add(e){Og(this.members,e),e.scheduleRender()}remove(e){if(Lg(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let r;for(let n=t;n>=0;n--){const e=this.members[n];if(!1!==e.isPresent){r=e;break}}return!!r&&(this.promote(r),!0)}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;!1===n&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const kb={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Ab="undefined"!==typeof window&&void 0!==window.MotionDebug,Cb=["","X","Y","Z"],Eb={visibility:"hidden"};let Pb=0;function Ib(e,t,r,n){const{latestValues:s}=t;s[e]&&(r[e]=s[e],t.setStaticValue(e,0),n&&(n[e]=0))}function Tb(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=Jg(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:t,layoutId:n}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Eg,!(t||n))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&Tb(n)}function Db(e){let{attachResizeListener:t,defaultParent:r,measureScroll:n,checkIsScrollRoot:s,resetTransform:a}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===r||void 0===r?void 0:r();this.id=Pb++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ab&&(kb.totalNodes=kb.resolvedTargetDeltas=kb.recalculatedProjection=0),this.nodes.forEach(Ob),this.nodes.forEach(zb),this.nodes.forEach(Vb),this.nodes.forEach(Lb),Ab&&window.MotionDebug.record(kb)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let r=0;r<this.path.length;r++)this.path[r].shouldResetTransform=!0;this.root===this&&(this.nodes=new $y)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Rg),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];t&&t.notify(...n)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.hasTreeAnimated;if(this.instance)return;var n;this.isSVG=(n=e)instanceof SVGElement&&"svg"!==n.tagName,this.instance=e;const{layoutId:s,layout:a,visualElement:o}=this.options;if(o&&!o.current&&o.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),r&&(a||s)&&(this.isLayoutDirty=!0),t){let r;const n=()=>this.root.updateBlockedByResize=!1;t(e,()=>{this.root.updateBlockedByResize=!0,r&&r(),r=Zy(n,250),Wy.hasAnimatedSinceResize&&(Wy.hasAnimatedSinceResize=!1,this.nodes.forEach(Wb))})}s&&this.root.registerSharedNode(s,this),!1!==this.options.animate&&o&&(s||a)&&this.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:r,hasRelativeTargetChanged:n,layout:s}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const a=this.options.transition||o.getDefaultTransition()||Yb,{onLayoutAnimationStart:i,onLayoutAnimationComplete:l}=o.getProps(),c=!this.targetLayout||!wb(this.targetLayout,s)||n,d=!r&&n;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||d||r&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(t,d);const e=(0,Y.A)((0,Y.A)({},Hp(a,"layout")),{},{onPlay:i,onComplete:l});(o.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e)}else r||Wb(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=s})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Pg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Hb),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Tb(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let s=0;s<this.path.length;s++){const e=this.path[s];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:r}=this.options;if(void 0===t&&!r)return;const n=this.getTransformTemplate();this.prevTransformTemplateValue=n?n(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(Fb);this.isUpdating||this.nodes.forEach(Ub),this.isUpdating=!1,this.nodes.forEach(Bb),this.nodes.forEach(Mb),this.nodes.forEach(_b),this.clearAllSnapshots();const e=_g.now();Ig.delta=df(0,1e3/60,e-Ig.timestamp),Ig.timestamp=e,Ig.isProcessing=!0,Tg.update.process(Ig),Tg.preRender.process(Ig),Tg.render.process(Ig),Ig.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Ky.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Rb),this.sharedNodes.forEach(qb)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Eg.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Eg.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let r=0;r<this.path.length;r++){this.path[r].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t){const t=s(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!a)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!vb(this.projectionDelta),r=this.getTransformTemplate(),n=r?r(this.latestValues,""):void 0,s=n!==this.prevTransformTemplateValue;e&&(t||yy(this.latestValues)||s)&&(a(this.instance,n),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let r=this.removeElementScroll(t);var n;return e&&(r=this.removeTransform(r)),$b((n=r).x),$b(n.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:r,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const r=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(ew))){const{scroll:e}=this.root;e&&(Ey(r.x,e.offset.x),Ey(r.y,e.offset.y))}return r}removeElementScroll(e){var t;const r={x:{min:0,max:0},y:{min:0,max:0}};if(db(r,e),null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)return r;for(let n=0;n<this.path.length;n++){const t=this.path[n],{scroll:s,options:a}=t;t!==this.root&&s&&a.layoutScroll&&(s.wasRoot&&db(r,e),Ey(r.x,s.offset.x),Ey(r.y,s.offset.y))}return r}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r={x:{min:0,max:0},y:{min:0,max:0}};db(r,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&Iy(r,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),yy(e.latestValues)&&Iy(r,e.latestValues)}return yy(this.latestValues)&&Iy(r,this.latestValues),r}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};db(t,e);for(let r=0;r<this.path.length;r++){const e=this.path[r];if(!e.instance)continue;if(!yy(e.latestValues))continue;vy(e.latestValues)&&e.updateSnapshot();const n=py();db(n,e.measurePageBox()),fb(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,n)}return yy(this.latestValues)&&fb(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options=(0,Y.A)((0,Y.A)((0,Y.A)({},this.options),e),{},{crossfade:void 0===e.crossfade||e.crossfade})}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ig.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const r=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=r.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=r.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=r.isSharedProjectionDirty);const n=Boolean(this.resumingFrom)||this!==r;if(!(e||n&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:s,layoutId:a}=this.options;if(this.layout&&(s||a)){if(this.resolvedRelativeTargetAt=Ig.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},ly(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),db(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,i,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,i=this.relativeTarget,l=this.relativeParent.target,oy(o.x,i.x,l.x),oy(o.y,i.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):db(this.target,this.layout.layoutBox),ky(this.target,this.targetDelta)):db(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},ly(this.relativeTargetOrigin,this.target,e.target),db(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ab&&kb.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!vy(this.parent.latestValues)&&!by(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),r=Boolean(this.resumingFrom)||this!==t;let n=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(n=!1),r&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===Ig.timestamp&&(n=!1),n)return;const{layout:s,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!s&&!a)return;db(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,i=this.treeScale.y;!function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=r.length;if(!s)return;let a,o;t.x=t.y=1;for(let i=0;i<s;i++){a=r[i],o=a.projectionDelta;const{visualElement:s}=a.options;s&&s.props.style&&"contents"===s.props.style.display||(n&&a.options.layoutScroll&&a.scroll&&a!==a.root&&Iy(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,ky(e,o)),n&&yy(a.latestValues)&&Iy(e,a.latestValues))}t.x<Cy&&t.x>Ay&&(t.x=1),t.y<Cy&&t.y>Ay&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,r),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(ub(this.prevProjectionDelta.x,this.projectionDelta.x),ub(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),ay(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===o&&this.treeScale.y===i&&Nb(this.projectionDelta.x,this.prevProjectionDelta.x)&&Nb(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Ab&&kb.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t;if(null===(t=this.options.visualElement)||void 0===t||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this.snapshot,n=r?r.latestValues:{},s=(0,Y.A)({},this.latestValues),a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const o={x:{min:0,max:0},y:{min:0,max:0}},i=(r?r.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(i&&!c&&!0===this.options.crossfade&&!this.path.some(Jb));let u;this.animationProgress=0,this.mixTargetDelta=t=>{const r=t/1e3;Kb(a.x,e.x,r),Kb(a.y,e.y,r),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ly(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,r,n){Gb(e.x,t.x,r.x,n),Gb(e.y,t.y,r.y,n)}(this.relativeTarget,this.relativeTargetOrigin,o,r),u&&function(e,t){return yb(e.x,t.x)&&yb(e.y,t.y)}(this.relativeTarget,u)&&(this.isProjectionDirty=!1),u||(u={x:{min:0,max:0},y:{min:0,max:0}}),db(u,this.relativeTarget)),i&&(this.animationValues=s,function(e,t,r,n,s,a){s?(e.opacity=Ix(0,void 0!==r.opacity?r.opacity:1,ob(n)),e.opacityExit=Ix(void 0!==t.opacity?t.opacity:1,0,ib(n))):a&&(e.opacity=Ix(void 0!==t.opacity?t.opacity:1,void 0!==r.opacity?r.opacity:1,n));for(let o=0;o<rb;o++){const s="border".concat(tb[o],"Radius");let a=ab(t,s),i=ab(r,s);void 0===a&&void 0===i||(a||(a=0),i||(i=0),0===a||0===i||sb(a)===sb(i)?(e[s]=Math.max(Ix(nb(a),nb(i),n),0),(Sf.test(i)||Sf.test(a))&&(e[s]+="%")):e[s]=i)}(t.rotate||r.rotate)&&(e.rotate=Ix(t.rotate||0,r.rotate||0,n))}(s,n,this.latestValues,r,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=r},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Pg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Eg.update(()=>{Wy.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,r){const n=Hg(e)?e:Wg(e);return n.start(Av("",n,t,r)),n.animation}(0,1e3,(0,Y.A)((0,Y.A)({},e),{},{onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}})),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:r,layout:n,latestValues:s}=e;if(t&&r&&n){if(this!==e&&this.layout&&n&&Zb(this.options.animationType,this.layout.layoutBox,n.layoutBox)){r=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=ny(this.layout.layoutBox.x);r.x.min=e.target.x.min,r.x.max=r.x.min+t;const n=ny(this.layout.layoutBox.y);r.y.min=e.target.y.min,r.y.max=r.y.min+n}db(t,r),Iy(t,s),ay(this.projectionDeltaWithTransform,this.layoutCorrected,t,s)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Sb);this.sharedNodes.get(e).add(t);const r=t.options.initialPromotionConfig;t.promote({transition:r?r.transition:void 0,preserveFollowOpacity:r&&r.shouldPreserveFollowOpacity?r.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=this.getStack();n&&n.promote(this,r),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:r}=e;if((r.z||r.rotate||r.rotateX||r.rotateY||r.rotateZ||r.skewX||r.skewY)&&(t=!0),!t)return;const n={};r.z&&Ib("z",e,n,this.animationValues);for(let s=0;s<Cb.length;s++)Ib("rotate".concat(Cb[s]),e,n,this.animationValues),Ib("skew".concat(Cb[s]),e,n,this.animationValues);e.render();for(const s in n)e.setStaticValue(s,n[s]),this.animationValues&&(this.animationValues[s]=n[s]);e.scheduleRender()}getProjectionStyles(e){var t,r;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Eb;const n={visibility:""},s=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,n.opacity="",n.pointerEvents=eb(null===e||void 0===e?void 0:e.pointerEvents)||"",n.transform=s?s(this.latestValues,""):"none",n;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=eb(null===e||void 0===e?void 0:e.pointerEvents)||""),this.hasProjected&&!yy(this.latestValues)&&(t.transform=s?s({},""):"none",this.hasProjected=!1),t}const o=a.animationValues||a.latestValues;this.applyTransformsToTarget(),n.transform=function(e,t,r){let n="";const s=e.x.translate/t.x,a=e.y.translate/t.y,o=(null===r||void 0===r?void 0:r.z)||0;if((s||a||o)&&(n="translate3d(".concat(s,"px, ").concat(a,"px, ").concat(o,"px) ")),1===t.x&&1===t.y||(n+="scale(".concat(1/t.x,", ").concat(1/t.y,") ")),r){const{transformPerspective:e,rotate:t,rotateX:s,rotateY:a,skewX:o,skewY:i}=r;e&&(n="perspective(".concat(e,"px) ").concat(n)),t&&(n+="rotate(".concat(t,"deg) ")),s&&(n+="rotateX(".concat(s,"deg) ")),a&&(n+="rotateY(".concat(a,"deg) ")),o&&(n+="skewX(".concat(o,"deg) ")),i&&(n+="skewY(".concat(i,"deg) "))}const i=e.x.scale*t.x,l=e.y.scale*t.y;return 1===i&&1===l||(n+="scale(".concat(i,", ").concat(l,")")),n||"none"}(this.projectionDeltaWithTransform,this.treeScale,o),s&&(n.transform=s(o,n.transform));const{x:i,y:l}=this.projectionDelta;n.transformOrigin="".concat(100*i.origin,"% ").concat(100*l.origin,"% 0"),a.animationValues?n.opacity=a===this?null!==(r=null!==(t=o.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==r?r:1:this.preserveOpacity?this.latestValues.opacity:o.opacityExit:n.opacity=a===this?void 0!==o.opacity?o.opacity:"":void 0!==o.opacityExit?o.opacityExit:0;for(const c in qy){if(void 0===o[c])continue;const{correct:e,applyTo:t}=qy[c],r="none"===n.transform?o[c]:e(o[c],a);if(t){const e=t.length;for(let s=0;s<e;s++)n[t[s]]=r}else n[c]=r}return this.options.layoutId&&(n.pointerEvents=a===this?eb(null===e||void 0===e?void 0:e.pointerEvents)||"":"none"),n}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()}),this.root.nodes.forEach(Fb),this.root.sharedNodes.clear()}}}function Mb(e){e.updateLayout()}function _b(e){var t;const r=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:n}=e.layout,{animationType:s}=e.options,a=r.source!==e.layout.source;"size"===s?gy(e=>{const n=a?r.measuredBox[e]:r.layoutBox[e],s=ny(n);n.min=t[e].min,n.max=n.min+s}):Zb(s,r.layoutBox,t)&&gy(n=>{const s=a?r.measuredBox[n]:r.layoutBox[n],o=ny(t[n]);s.max=s.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[n].max=e.relativeTarget[n].min+o)});const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};ay(o,t,r.layoutBox);const i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?ay(i,e.applyTransform(n,!0),r.measuredBox):ay(i,t,r.layoutBox);const l=!vb(o);let c=!1;if(!e.resumeFrom){const n=e.getClosestProjectingParent();if(n&&!n.resumeFrom){const{snapshot:s,layout:a}=n;if(s&&a){const o={x:{min:0,max:0},y:{min:0,max:0}};ly(o,r.layoutBox,s.layoutBox);const i={x:{min:0,max:0},y:{min:0,max:0}};ly(i,t,a.layoutBox),wb(o,i)||(c=!0),n.options.layoutRoot&&(e.relativeTarget=i,e.relativeTargetOrigin=o,e.relativeParent=n)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:r,delta:i,layoutDelta:o,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function Ob(e){Ab&&kb.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Lb(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Rb(e){e.clearSnapshot()}function Fb(e){e.clearMeasurements()}function Ub(e){e.isLayoutDirty=!1}function Bb(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Wb(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function zb(e){e.resolveTargetDelta()}function Vb(e){e.calcProjection()}function Hb(e){e.resetSkewAndRotation()}function qb(e){e.removeLeadSnapshot()}function Kb(e,t,r){e.translate=Ix(t.translate,0,r),e.scale=Ix(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function Gb(e,t,r,n){e.min=Ix(t.min,r.min,n),e.max=Ix(t.max,r.max,n)}function Jb(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Yb={duration:.45,ease:[.4,0,.1,1]},Qb=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Xb=Qb("applewebkit/")&&!Qb("chrome/")?Math.round:yg;function $b(e){e.min=Xb(e.min),e.max=Xb(e.max)}function Zb(e,t,r){return"position"===e||"preserve-aspect"===e&&!function(e,t,r){return Math.abs(e-t)<=r}(jb(t),jb(r),.2)}function ew(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const tw=Db({attachResizeListener:(e,t)=>qv(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rw={current:void 0},nw=Db({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!rw.current){const e=new tw({});e.mount(window),e.setOptions({layoutScroll:!0}),rw.current=e}return rw.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),sw={pan:{Feature:class extends zv{constructor(){super(...arguments),this.removePointerDownListener=yg}onPointerDown(e){this.session=new Yv(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Dy(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:Ly(e),onStart:Ly(t),onMove:r,onEnd:(e,t)=>{delete this.session,n&&Eg.postRender(()=>n(e,t))}}}mount(){this.removePointerDownListener=Gv(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends zv{constructor(e){super(e),this.removeGroupControls=yg,this.removeListeners=yg,this.controls=new _y(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||yg}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:nw,MeasureLayout:Yy}};function aw(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover","Start"===r);const s=n["onHover"+r];s&&Eg.postRender(()=>s(t,Kv(t)))}function ow(e,t,r){const{props:n}=e;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap","Start"===r);const s=n["onTap"+("End"===r?"":r)];s&&Eg.postRender(()=>s(t,Kv(t)))}const iw=["root"],lw=new WeakMap,cw=new WeakMap,dw=e=>{const t=lw.get(e.target);t&&t(e)},uw=e=>{e.forEach(dw)};function hw(e,t,r){const n=function(e){let{root:t}=e,r=Sn(e,iw);const n=t||document;cw.has(n)||cw.set(n,{});const s=cw.get(n),a=JSON.stringify(r);return s[a]||(s[a]=new IntersectionObserver(uw,(0,Y.A)({root:t},r))),s[a]}(t);return lw.set(e,r),n.observe(e),()=>{lw.delete(e),n.unobserve(e)}}const mw={some:0,all:1};const pw={inView:{Feature:class extends zv{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:n="some",once:s}=e,a={root:t?t.current:void 0,rootMargin:r,threshold:"number"===typeof n?n:mw[n]};return hw(this.node.current,a,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,s&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:r,onViewportLeave:n}=this.node.getProps(),a=t?r:n;a&&a(e)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,r=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:r={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==r[e]}(e,t));r&&this.startObserver()}unmount(){}}},tap:{Feature:class extends zv{mount(){const{current:e}=this.node;e&&(this.unmount=fg(e,e=>(ow(this.node,e,"Start"),(e,t)=>{let{success:r}=t;return ow(this.node,e,r?"End":"Cancel")}),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends zv{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(It){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Fx(qv(this.node.current,"focus",()=>this.onFocus()),qv(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends zv{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[n,s,a]=ig(e,r),o=lg(e=>{const{target:r}=e,n=t(e);if("function"!==typeof n||!r)return;const a=lg(e=>{n(e),r.removeEventListener("pointerleave",a)});r.addEventListener("pointerleave",a,s)});return n.forEach(e=>{e.addEventListener("pointerenter",o,s)}),a}(e,e=>(aw(this.node,e,"Start"),e=>aw(this.node,e,"End"))))}unmount(){}}}},gw={layout:{ProjectionNode:nw,MeasureLayout:Yy}},fw=(0,o.createContext)({strict:!1}),xw=(0,o.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),vw=(0,o.createContext)({});function yw(e){return Tp(e.animate)||Up.some(t=>_p(e[t]))}function bw(e){return Boolean(yw(e)||e.variants)}function ww(e){const{initial:t,animate:r}=function(e,t){if(yw(e)){const{initial:t,animate:r}=e;return{initial:!1===t||_p(t)?t:void 0,animate:_p(r)?r:void 0}}return!1!==e.inherit?t:{}}(e,(0,o.useContext)(vw));return(0,o.useMemo)(()=>({initial:t,animate:r}),[jw(t),jw(r)])}function jw(e){return Array.isArray(e)?e.join(" "):e}const Nw="undefined"!==typeof window,Sw={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},kw={};for(const IS in Sw)kw[IS]={isEnabled:e=>Sw[IS].some(t=>!!e[t])};const Aw=Symbol.for("motionComponentSymbol");function Cw(e,t,r){return(0,o.useCallback)(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&("function"===typeof r?r(n):ry(r)&&(r.current=n))},[t])}const Ew=Nw?o.useLayoutEffect:o.useEffect;function Pw(e,t,r,n,s){var a,i;const{visualElement:l}=(0,o.useContext)(vw),c=(0,o.useContext)(fw),d=(0,o.useContext)(Ry),u=(0,o.useContext)(xw).reducedMotion,h=(0,o.useRef)(null);n=n||c.renderer,!h.current&&n&&(h.current=n(e,{visualState:t,parent:l,props:r,presenceContext:d,blockInitialAnimation:!!d&&!1===d.initial,reducedMotionConfig:u}));const m=h.current,p=(0,o.useContext)(By);!m||m.projection||!s||"html"!==m.type&&"svg"!==m.type||function(e,t,r,n){const{layoutId:s,layout:a,drag:o,dragConstraints:i,layoutScroll:l,layoutRoot:c}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:Iw(e.parent)),e.projection.setOptions({layoutId:s,layout:a,alwaysMeasureLayout:Boolean(o)||i&&ry(i),visualElement:e,animationType:"string"===typeof a?a:"both",initialPromotionConfig:n,layoutScroll:l,layoutRoot:c})}(h.current,r,s,p);const g=(0,o.useRef)(!1);(0,o.useInsertionEffect)(()=>{m&&g.current&&m.update(r,d)});const f=r[Gg],x=(0,o.useRef)(Boolean(f)&&!(null===(a=window.MotionHandoffIsComplete)||void 0===a?void 0:a.call(window,f))&&(null===(i=window.MotionHasOptimisedAnimation)||void 0===i?void 0:i.call(window,f)));return Ew(()=>{m&&(g.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),Ky.render(m.render),x.current&&m.animationState&&m.animationState.animateChanges())}),(0,o.useEffect)(()=>{m&&(!x.current&&m.animationState&&m.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,f)}),x.current=!1))}),m}function Iw(e){if(e)return!1!==e.options.allowProjection?e.projection:Iw(e.parent)}function Tw(e){let{preloadedFeatures:t,createVisualElement:r,useRender:n,useVisualState:s,Component:a}=e;var i,l;function c(e,t){let i;const l=(0,Y.A)((0,Y.A)((0,Y.A)({},(0,o.useContext)(xw)),e),{},{layoutId:Dw(e)}),{isStatic:c}=l,d=ww(e),u=s(e,c);if(!c&&Nw){!function(){(0,o.useContext)(fw).strict;0}();const e=function(e){const{drag:t,layout:r}=kw;if(!t&&!r)return{};const n=(0,Y.A)((0,Y.A)({},t),r);return{MeasureLayout:(null===t||void 0===t?void 0:t.isEnabled(e))||(null===r||void 0===r?void 0:r.isEnabled(e))?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}(l);i=e.MeasureLayout,d.visualElement=Pw(a,u,l,r,e.ProjectionNode)}return(0,kt.jsxs)(vw.Provider,{value:d,children:[i&&d.visualElement?(0,kt.jsx)(i,(0,Y.A)({visualElement:d.visualElement},l)):null,n(a,e,Cw(u,d.visualElement,t),u,c,d.visualElement)]})}t&&function(e){for(const t in e)kw[t]=(0,Y.A)((0,Y.A)({},kw[t]),e[t])}(t),c.displayName="motion.".concat("string"===typeof a?a:"create(".concat(null!==(l=null!==(i=a.displayName)&&void 0!==i?i:a.name)&&void 0!==l?l:"",")"));const d=(0,o.forwardRef)(c);return d[Aw]=a,d}function Dw(e){let{layoutId:t}=e;const r=(0,o.useContext)(Uy).id;return r&&void 0!==t?r+"-"+t:t}const Mw=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function _w(e){return"string"===typeof e&&!e.includes("-")&&!!(Mw.indexOf(e)>-1||/[A-Z]/.test(e))}function Ow(e){const t=(0,o.useRef)(null);return null===t.current&&(t.current=e()),t.current}const Lw=["transitionEnd","transition"];const Rw=e=>(t,r)=>{const n=(0,o.useContext)(vw),s=(0,o.useContext)(Ry),a=()=>function(e,t,r,n){let{scrapeMotionValuesFromProps:s,createRenderState:a,onUpdate:o}=e;const i={latestValues:Fw(t,r,n,s),renderState:a()};return o&&(i.onMount=e=>o((0,Y.A)({props:t,current:e},i)),i.onUpdate=e=>o(e)),i}(e,t,n,s);return r?a():Ow(a)};function Fw(e,t,r,n){const s={},a=n(e,{});for(const h in a)s[h]=eb(a[h]);let{initial:o,animate:i}=e;const l=yw(e),c=bw(e);t&&c&&!l&&!1!==e.inherit&&(void 0===o&&(o=t.initial),void 0===i&&(i=t.animate));let d=!!r&&!1===r.initial;d=d||!1===o;const u=d?i:o;if(u&&"boolean"!==typeof u&&!Tp(u)){const t=Array.isArray(u)?u:[u];for(let r=0;r<t.length;r++){const n=Lp(e,t[r]);if(n){const{transitionEnd:e,transition:t}=n,r=Sn(n,Lw);for(const n in r){let e=r[n];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(s[n]=e)}for(const n in e)s[n]=e[n]}}}return s}const Uw=(e,t)=>t&&"number"===typeof e?t.transform(e):e,Bw={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Ww=bg.length;function zw(e,t,r){const{style:n,vars:s,transformOrigin:a}=e;let o=!1,i=!1;for(const l in t){const e=t[l];if(wg.has(l))o=!0;else if(px(l))s[l]=e;else{const t=Uw(e,Gf[l]);l.startsWith("origin")?(i=!0,a[l]=t):n[l]=t}}if(t.transform||(o||r?n.transform=function(e,t,r){let n="",s=!0;for(let a=0;a<Ww;a++){const o=bg[a],i=e[o];if(void 0===i)continue;let l=!0;if(l="number"===typeof i?i===(o.startsWith("scale")?1:0):0===parseFloat(i),!l||r){const e=Uw(i,Gf[o]);l||(s=!1,n+="".concat(Bw[o]||o,"(").concat(e,") ")),r&&(t[o]=e)}}return n=n.trim(),r?n=r(t,s?"":n):s&&(n="none"),n}(t,e.transform,r):n.transform&&(n.transform="none")),i){const{originX:e="50%",originY:t="50%",originZ:r=0}=a;n.transformOrigin="".concat(e," ").concat(t," ").concat(r)}}const Vw={offset:"stroke-dashoffset",array:"stroke-dasharray"},Hw={offset:"strokeDashoffset",array:"strokeDasharray"};function qw(e,t,r){return"string"===typeof e?e:kf.transform(t+r*e)}const Kw=["attrX","attrY","attrScale","originX","originY","pathLength","pathSpacing","pathOffset"];function Gw(e,t,r,n){let{attrX:s,attrY:a,attrScale:o,originX:i,originY:l,pathLength:c,pathSpacing:d=1,pathOffset:u=0}=t;if(zw(e,Sn(t,Kw),n),r)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:h,style:m,dimensions:p}=e;h.transform&&(p&&(m.transform=h.transform),delete h.transform),p&&(void 0!==i||void 0!==l||m.transform)&&(m.transformOrigin=function(e,t,r){const n=qw(t,e.x,e.width),s=qw(r,e.y,e.height);return"".concat(n," ").concat(s)}(p,void 0!==i?i:.5,void 0!==l?l:.5)),void 0!==s&&(h.x=s),void 0!==a&&(h.y=a),void 0!==o&&(h.scale=o),void 0!==c&&function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const a=s?Vw:Hw;e[a.offset]=kf.transform(-n);const o=kf.transform(t),i=kf.transform(r);e[a.array]="".concat(o," ").concat(i)}(h,c,d,u,!1)}const Jw=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Yw=()=>(0,Y.A)((0,Y.A)({},{style:{},transform:{},transformOrigin:{},vars:{}}),{},{attrs:{}}),Qw=e=>"string"===typeof e&&"svg"===e.toLowerCase();function Xw(e,t,r,n){let{style:s,vars:a}=t;Object.assign(e.style,s,n&&n.getProjectionStyles(r));for(const o in a)e.style.setProperty(o,a[o])}const $w=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Zw(e,t,r,n){Xw(e,t,void 0,n);for(const s in t.attrs)e.setAttribute($w.has(s)?s:Kg(s),t.attrs[s])}function ej(e,t){let{layout:r,layoutId:n}=t;return wg.has(e)||e.startsWith("origin")||(r||void 0!==n)&&(!!qy[e]||"opacity"===e)}function tj(e,t,r){var n;const{style:s}=e,a={};for(const o in s)(Hg(s[o])||t.style&&Hg(t.style[o])||ej(o,e)||void 0!==(null===(n=null===r||void 0===r?void 0:r.getValue(o))||void 0===n?void 0:n.liveStyle))&&(a[o]=s[o]);return a}function rj(e,t,r){const n=tj(e,t,r);for(const s in e)if(Hg(e[s])||Hg(t[s])){n[-1!==bg.indexOf(s)?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s]=e[s]}return n}const nj=["x","y","width","height","cx","cy","r"],sj={useVisualState:Rw({scrapeMotionValuesFromProps:rj,createRenderState:Yw,onUpdate:e=>{let{props:t,prevProps:r,current:n,renderState:s,latestValues:a}=e;if(!n)return;let o=!!t.drag;if(!o)for(const l in a)if(wg.has(l)){o=!0;break}if(!o)return;let i=!r;if(r)for(let l=0;l<nj.length;l++){const e=nj[l];t[e]!==r[e]&&(i=!0)}i&&Eg.read(()=>{!function(e,t){try{t.dimensions="function"===typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(It){t.dimensions={x:0,y:0,width:0,height:0}}}(n,s),Eg.render(()=>{Gw(s,a,Qw(n.tagName),t.transformTemplate),Zw(n,s)})})}})},aj={useVisualState:Rw({scrapeMotionValuesFromProps:tj,createRenderState:Jw})};function oj(e,t,r){for(const n in t)Hg(t[n])||ej(n,r)||(e[n]=t[n])}function ij(e,t){const r={};return oj(r,e.style||{},e),Object.assign(r,function(e,t){let{transformTemplate:r}=e;return(0,o.useMemo)(()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return zw(e,t,r),Object.assign({},e.vars,e.style)},[t])}(e,t)),r}function lj(e,t){const r={},n=ij(e,t);return e.drag&&!1!==e.dragListener&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=!0===e.drag?"none":"pan-".concat("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const cj=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function dj(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||cj.has(e)}let uj=e=>!dj(e);try{(hj=require("@emotion/is-prop-valid").default)&&(uj=e=>e.startsWith("on")?!dj(e):hj(e))}catch(PS){}var hj;function mj(e,t,r,n){const s=(0,o.useMemo)(()=>{const r=Yw();return Gw(r,t,Qw(n),e.transformTemplate),(0,Y.A)((0,Y.A)({},r.attrs),{},{style:(0,Y.A)({},r.style)})},[t]);if(e.style){const t={};oj(t,e.style,e),s.style=(0,Y.A)((0,Y.A)({},t),s.style)}return s}function pj(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(t,r,n,s,a)=>{let{latestValues:i}=s;const l=(_w(t)?mj:lj)(r,i,a,t),c=function(e,t,r){const n={};for(const s in e)"values"===s&&"object"===typeof e.values||(uj(s)||!0===r&&dj(s)||!t&&!dj(s)||e.draggable&&s.startsWith("onDrag"))&&(n[s]=e[s]);return n}(r,"string"===typeof t,e),d=t!==o.Fragment?(0,Y.A)((0,Y.A)((0,Y.A)({},c),l),{},{ref:n}):{},{children:u}=r,h=(0,o.useMemo)(()=>Hg(u)?u.get():u,[u]);return(0,o.createElement)(t,(0,Y.A)((0,Y.A)({},d),{},{children:h}))}}function gj(e,t){return function(r){let{forwardMotionProps:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{forwardMotionProps:!1};const s=_w(r)?sj:aj;return Tw((0,Y.A)((0,Y.A)({},s),{},{preloadedFeatures:e,useRender:pj(n),createVisualElement:t,Component:r}))}}const fj={current:null},xj={current:!1};const vj=[...wx,If,Uf],yj=new WeakMap;const bj=["willChange"],wj=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class jj{scrapeMotionValuesFromProps(e,t,r){return{}}constructor(e){let{parent:t,props:r,presenceContext:n,reducedMotionConfig:s,blockInitialAnimation:a,visualState:o}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=cx,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=_g.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Eg.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:d}=o;this.onUpdate=d,this.latestValues=l,this.baseTarget=(0,Y.A)({},l),this.initialValues=r.initial?(0,Y.A)({},l):{},this.renderState=c,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=s,this.options=i,this.blockInitialAnimation=Boolean(a),this.isControllingVariants=yw(r),this.isVariantNode=bw(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const u=this.scrapeMotionValuesFromProps(r,{},this),{willChange:h}=u,m=Sn(u,bj);for(const p in m){const e=m[p];void 0!==l[p]&&Hg(e)&&e.set(l[p],!1)}}mount(e){this.current=e,yj.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),xj.current||function(){if(xj.current=!0,Nw)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>fj.current=e.matches;e.addListener(t),t()}else fj.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||fj.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){yj.delete(this.current),this.projection&&this.projection.unmount(),Pg(this.notifyUpdate),Pg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=wg.has(e),n=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&Eg.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0)}),s=t.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{n(),s(),a&&a(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in kw){const t=kw[e];if(!t)continue;const{isEnabled:r,Feature:n}=t;if(!this.features[e]&&n&&r(this.props)&&(this.features[e]=new n(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<wj.length;r++){const t=wj[r];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const n=e["on"+t];n&&(this.propEventSubscriptions[t]=this.on(t,n))}this.prevMotionValues=function(e,t,r){for(const n in t){const s=t[n],a=r[n];if(Hg(s))e.addValue(n,s);else if(Hg(a))e.addValue(n,Wg(s,{owner:e}));else if(a!==s)if(e.hasValue(n)){const t=e.getValue(n);!0===t.liveStyle?t.jump(s):t.hasAnimated||t.set(s)}else{const t=e.getStaticValue(n);e.addValue(n,Wg(void 0!==t?t:s,{owner:e}))}}for(const n in r)void 0===t[n]&&e.removeValue(n);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return void 0===r&&void 0!==t&&(r=Wg(null===t?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){var r;let n=void 0===this.latestValues[e]&&this.current?null!==(r=this.getBaseTargetFromProps(this.props,e))&&void 0!==r?r:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var s;return void 0!==n&&null!==n&&("string"===typeof n&&(hx(n)||lf(n))?n=parseFloat(n):(s=n,!vj.find(bx(s))&&Uf.test(t)&&(n=Qf(e,t))),this.setBaseTarget(e,Hg(n)?n.get():n)),Hg(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:r}=this.props;let n;if("string"===typeof r||"object"===typeof r){const s=Lp(this.props,r,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);s&&(n=s[e])}if(r&&void 0!==n)return n;const s=this.getBaseTargetFromProps(this.props,e);return void 0===s||Hg(s)?void 0!==this.initialValues[e]&&void 0===n?void 0:this.baseTarget[e]:s}on(e,t){return this.events[e]||(this.events[e]=new Rg),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.events[e].notify(...r)}}}class Nj extends jj{constructor(){super(...arguments),this.KeyframeResolver=Nx}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:r,style:n}=t;delete r[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Hg(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent="".concat(e))}))}}class Sj extends Nj{constructor(){super(...arguments),this.type="html",this.renderInstance=Xw}readValueFromInstance(e,t){if(wg.has(t)){const e=Yf(t);return e&&e.default||0}{const n=(r=e,window.getComputedStyle(r)),s=(px(t)?n.getPropertyValue(t):n[t])||0;return"string"===typeof s?s.trim():s}var r}measureInstanceViewportBox(e,t){let{transformPagePoint:r}=t;return Ty(e,r)}build(e,t,r){zw(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return tj(e,t,r)}}class kj extends Nj{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=py}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(wg.has(t)){const e=Yf(t);return e&&e.default||0}return t=$w.has(t)?t:Kg(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return rj(e,t,r)}build(e,t,r){Gw(e,t,this.isSVGTag,r.transformTemplate)}renderInstance(e,t,r,n){Zw(e,t,0,n)}mount(e){this.isSVGTag=Qw(e.tagName),super.mount(e)}}const Aj=(e,t)=>_w(e)?new kj(t):new Sj(t,{allowProjection:e!==o.Fragment}),Cj=Ip(gj((0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},Hv),pw),sw),gw),Aj));class Ej extends o.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Pj(e){let{children:t,isPresent:r}=e;const n=(0,o.useId)(),s=(0,o.useRef)(null),a=(0,o.useRef)({width:0,height:0,top:0,left:0}),{nonce:i}=(0,o.useContext)(xw);return(0,o.useInsertionEffect)(()=>{const{width:e,height:t,top:o,left:l}=a.current;if(r||!s.current||!e||!t)return;s.current.dataset.motionPopId=n;const c=document.createElement("style");return i&&(c.nonce=i),document.head.appendChild(c),c.sheet&&c.sheet.insertRule('\n          [data-motion-pop-id="'.concat(n,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(o,"px !important;\n            left: ").concat(l,"px !important;\n          }\n        ")),()=>{document.head.removeChild(c)}},[r]),(0,kt.jsx)(Ej,{isPresent:r,childRef:s,sizeRef:a,children:o.cloneElement(t,{ref:s})})}const Ij=e=>{let{children:t,initial:r,isPresent:n,onExitComplete:s,custom:a,presenceAffectsLayout:i,mode:l}=e;const c=Ow(Tj),d=(0,o.useId)(),u=(0,o.useCallback)(e=>{c.set(e,!0);for(const t of c.values())if(!t)return;s&&s()},[c,s]),h=(0,o.useMemo)(()=>({id:d,initial:r,isPresent:n,custom:a,onExitComplete:u,register:e=>(c.set(e,!1),()=>c.delete(e))}),i?[Math.random(),u]:[n,u]);return(0,o.useMemo)(()=>{c.forEach((e,t)=>c.set(t,!1))},[n]),o.useEffect(()=>{!n&&!c.size&&s&&s()},[n]),"popLayout"===l&&(t=(0,kt.jsx)(Pj,{isPresent:n,children:t})),(0,kt.jsx)(Ry.Provider,{value:h,children:t})};function Tj(){return new Map}const Dj=e=>e.key||"";function Mj(e){const t=[];return o.Children.forEach(e,e=>{(0,o.isValidElement)(e)&&t.push(e)}),t}const _j=e=>{let{children:t,custom:r,initial:n=!0,onExitComplete:s,presenceAffectsLayout:a=!0,mode:i="sync",propagate:l=!1}=e;const[c,d]=Fy(l),u=(0,o.useMemo)(()=>Mj(t),[t]),h=l&&!c?[]:u.map(Dj),m=(0,o.useRef)(!0),p=(0,o.useRef)(u),g=Ow(()=>new Map),[f,x]=(0,o.useState)(u),[v,y]=(0,o.useState)(u);Ew(()=>{m.current=!1,p.current=u;for(let e=0;e<v.length;e++){const t=Dj(v[e]);h.includes(t)?g.delete(t):!0!==g.get(t)&&g.set(t,!1)}},[v,h.length,h.join("-")]);const b=[];if(u!==f){let e=[...u];for(let t=0;t<v.length;t++){const r=v[t],n=Dj(r);h.includes(n)||(e.splice(t,0,r),b.push(r))}return"wait"===i&&b.length&&(e=b),y(Mj(e)),void x(u)}const{forceRender:w}=(0,o.useContext)(Uy);return(0,kt.jsx)(kt.Fragment,{children:v.map(e=>{const t=Dj(e),o=!(l&&!c)&&(u===v||h.includes(t));return(0,kt.jsx)(Ij,{isPresent:o,initial:!(m.current&&!n)&&void 0,custom:o?void 0:r,presenceAffectsLayout:a,mode:i,onExitComplete:o?void 0:()=>{if(!g.has(t))return;g.set(t,!0);let e=!0;g.forEach(t=>{t||(e=!1)}),e&&(null===w||void 0===w||w(),y(p.current),l&&(null===d||void 0===d||d()),s&&s())},children:e},t)})})},Oj=e=>{let{notifications:t,colorMode:r}=e;const[n,s]=(0,o.useState)(!1),a=(null===t||void 0===t?void 0:t.filter(e=>!e.read).length)||0;return(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsxs)("button",{onClick:()=>s(!n),className:"relative p-2 rounded-lg transition-colors ".concat(r?"hover:bg-slate-700":"hover:bg-gray-100"),children:[(0,kt.jsx)(Pp,{className:"h-6 w-6 ".concat(r?"text-gray-300":"text-gray-600")}),a>0&&(0,kt.jsx)(Cj.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:a>9?"9+":a})]}),(0,kt.jsx)(_j,{children:n&&(0,kt.jsxs)(Cj.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},className:"absolute right-0 top-full mt-2 w-80 ".concat(r?"bg-slate-800 border-slate-700":"bg-white border-gray-200"," border rounded-xl shadow-xl z-50"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-4 border-b ".concat(r?"border-slate-700":"border-gray-200"),children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(r?"text-white":"text-gray-900"),children:"Notifications"}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[a>0&&(0,kt.jsx)("button",{onClick:()=>{console.log("Marking all notifications as read")},className:"text-sm ".concat(r?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:"Mark all read"}),(0,kt.jsx)("button",{onClick:()=>s(!1),className:"p-1 rounded ".concat(r?"hover:bg-slate-700":"hover:bg-gray-100"),children:(0,kt.jsx)(xp,{className:"h-4 w-4"})})]})]}),(0,kt.jsx)("div",{className:"max-h-96 overflow-y-auto",children:t&&t.length>0?(0,kt.jsx)("div",{className:"divide-y divide-gray-200",children:t.slice(0,10).map(e=>{const t=(e=>{switch(e){case"comment":return Ap;case"vote":return Xs;case"status_change":return Np;case"bug":return hp;default:return Pp}})(e.type),n=(e=>{switch(e){case"comment":return"text-blue-500";case"vote":return"text-green-500";case"status_change":return"text-purple-500";case"bug":return"text-red-500";default:return"text-gray-500"}})(e.type);return(0,kt.jsx)(Cj.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"p-4 hover:bg-gray-50 transition-colors ".concat(e.read?"":r?"bg-blue-900/20":"bg-blue-50"),children:(0,kt.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 ".concat(n),children:(0,kt.jsx)(t,{className:"h-5 w-5"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("p",{className:"text-sm font-medium ".concat(r?"text-white":"text-gray-900"),children:e.title}),!e.read&&(0,kt.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"})]}),(0,kt.jsx)("p",{className:"text-sm ".concat(r?"text-gray-300":"text-gray-600"," mt-1"),children:e.message}),(0,kt.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,kt.jsx)("span",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-500"),children:rd(new Date(e.createdAt),{addSuffix:!0})}),!e.read&&(0,kt.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Marking notification as read:",t);var t},className:"text-xs ".concat(r?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:"Mark as read"})]})]})]})},e.id)})}):(0,kt.jsxs)("div",{className:"p-8 text-center",children:[(0,kt.jsx)(Pp,{className:"h-12 w-12 mx-auto mb-4 ".concat(r?"text-gray-600":"text-gray-400")}),(0,kt.jsx)("h3",{className:"text-lg font-medium ".concat(r?"text-gray-300":"text-gray-900"," mb-2"),children:"No notifications"}),(0,kt.jsx)("p",{className:"text-sm ".concat(r?"text-gray-400":"text-gray-500"),children:"You're all caught up! New notifications will appear here."})]})}),t&&t.length>10&&(0,kt.jsx)("div",{className:"p-4 border-t ".concat(r?"border-slate-700":"border-gray-200"),children:(0,kt.jsx)("button",{className:"w-full text-sm ".concat(r?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:"View all notifications"})})]})})]})},Lj=Gs("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Rj=Gs("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),Fj=e=>{var t,r;let{feedback:n,currentUser:s,onClose:a,onStatusChange:i,colorMode:l}=e;const[c,d]=(0,o.useState)([]),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1),[x,v]=(0,o.useState)(!1),[y,b]=(0,o.useState)(!1),[w,j]=(0,o.useState)("");(0,o.useEffect)(()=>{(async()=>{const e=await Ds.feedbackService.getComments(n.id);console.log("Comments loaded via API:",e.data),d(Array.isArray(e.data)?e.data:[])})()},[n.id]),(0,o.useEffect)(()=>{const e=e=>{"Escape"===e.key&&a()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]);const N="DEVELOPER"===(null===s||void 0===s?void 0:s.role)||"ADMIN"===(null===s||void 0===s?void 0:s.role),S=[{value:"OPEN",label:"Open",icon:yp,color:"green"},{value:"IN_REVIEW",label:"In Review",icon:wp,color:"yellow"},{value:"PLANNED",label:"Planned",icon:Np,color:"blue"},{value:"IN_PROGRESS",label:"In Progress",icon:jp,color:"purple"},{value:"DONE",label:"Done",icon:Np,color:"green"},{value:"CLOSED",label:"Closed",icon:Sp,color:"gray"}],k=e=>{i(n.id,{assigneeId:e}),v(!1)},A=()=>{if(w.trim()){const e=[...n.tags||[],w.trim()];i(n.id,{tags:e}),j(""),b(!1)}},C=(e=>{switch(e){case"BUG":default:return hp;case"IMPROVEMENT":return mp;case"IDEA":return Ys}})(n.type),E=(e=>{switch(e){case"BUG":return"red";case"IMPROVEMENT":return"blue";case"IDEA":return"green";default:return"gray"}})(n.type);return(0,kt.jsx)(Cj.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-end z-50",onClick:a,children:(0,kt.jsxs)(Cj.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"w-full max-w-2xl h-full ".concat(l?"bg-slate-800":"bg-white"," shadow-2xl"),onClick:e=>e.stopPropagation(),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b ".concat(l?"border-slate-700":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,kt.jsx)("div",{className:"p-2 rounded-lg bg-".concat(E,"-100"),children:(0,kt.jsx)(C,{className:"h-5 w-5 text-".concat(E,"-600")})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold ".concat(l?"text-white":"text-gray-900"),children:n.title}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-".concat(E,"-100 text-").concat(E,"-800"),children:n.type}),(0,kt.jsxs)("span",{className:"text-sm ".concat(l?"text-gray-400":"text-gray-500"),children:["#",n.id.slice(-6)]})]})]})]}),(0,kt.jsx)("button",{onClick:a,className:"p-2 rounded-lg transition-colors ".concat(l?"hover:bg-slate-700 text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-500 hover:text-gray-700"),title:"Close (Esc)",children:(0,kt.jsx)(xp,{className:"h-6 w-6"})})]}),(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto max-h-[calc(100vh-200px)]",children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsx)("div",{className:"prose max-w-none ".concat(l?"prose-invert":""),children:(0,kt.jsx)("div",{className:"whitespace-pre-wrap ".concat(l?"text-gray-300":"text-gray-700"),children:n.description})}),n.attachments&&n.attachments.length>0&&(0,kt.jsxs)("div",{className:"mt-6",children:[(0,kt.jsx)("h4",{className:"text-sm font-medium mb-3 ".concat(l?"text-gray-300":"text-gray-700"),children:"Attachments"}),(0,kt.jsx)("div",{className:"grid grid-cols-2 gap-4",children:n.attachments.map((e,t)=>(0,kt.jsx)("div",{className:"p-3 rounded-lg border ".concat(l?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"text-sm font-medium",children:e.name}),(0,kt.jsxs)("div",{className:"text-xs text-gray-500",children:["(",(e.size/1024/1024).toFixed(1),"MB)"]})]})},t))})]}),N&&(0,kt.jsxs)("div",{className:"mt-6 p-4 rounded-lg border border-blue-200 bg-blue-50",children:[(0,kt.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-3",children:"Developer Controls"}),(0,kt.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsxs)("button",{onClick:()=>f(!g),className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50",children:[(0,kt.jsx)("span",{className:"text-sm",children:"Status"}),(0,kt.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:n.status})]}),g&&(0,kt.jsx)("div",{className:"absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:S.map(e=>{const t=e.icon;return(0,kt.jsxs)("button",{onClick:()=>{return t=e.value,i(n.id,{status:t}),void f(!1);var t},className:"w-full flex items-center space-x-2 px-3 py-2 text-left hover:bg-gray-50",children:[(0,kt.jsx)(t,{className:"h-4 w-4"}),(0,kt.jsx)("span",{className:"text-sm",children:e.label})]},e.value)})})]}),(0,kt.jsx)("div",{className:"relative",children:(0,kt.jsx)("select",{value:n.severity||"MEDIUM",onChange:e=>{return t=e.target.value,void i(n.id,{severity:t});var t},className:"px-3 py-2 rounded-lg border border-gray-300 bg-white text-sm",children:[{value:"LOW",label:"Low",color:"green"},{value:"MEDIUM",label:"Medium",color:"yellow"},{value:"HIGH",label:"High",color:"orange"},{value:"CRITICAL",label:"Critical",color:"red"}].map(e=>(0,kt.jsx)("option",{value:e.value,children:e.label},e.value))})}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsxs)("button",{onClick:()=>v(!x),className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50",children:[(0,kt.jsx)(Cp,{className:"h-4 w-4"}),(0,kt.jsx)("span",{className:"text-sm",children:"Assign"})]}),x&&(0,kt.jsxs)("div",{className:"absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:[(0,kt.jsx)("button",{onClick:()=>k(null),className:"w-full flex items-center space-x-2 px-3 py-2 text-left hover:bg-gray-50",children:(0,kt.jsx)("span",{className:"text-sm",children:"Unassigned"})}),(0,kt.jsx)("button",{onClick:()=>k("dev1"),className:"w-full flex items-center space-x-2 px-3 py-2 text-left hover:bg-gray-50",children:(0,kt.jsx)("span",{className:"text-sm",children:"John Developer"})})]})]})]}),(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,kt.jsx)(kp,{className:"h-4 w-4 text-gray-500"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Tags"}),(0,kt.jsx)("button",{onClick:()=>b(!y),className:"text-blue-500 hover:text-blue-600",children:(0,kt.jsx)(Lj,{className:"h-4 w-4"})})]}),(0,kt.jsx)("div",{className:"flex flex-wrap gap-2",children:null===(t=n.tags)||void 0===t?void 0:t.map((e,t)=>(0,kt.jsxs)("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-md text-xs bg-gray-100 text-gray-700",children:[(0,kt.jsx)("span",{children:e}),(0,kt.jsx)("button",{onClick:()=>(e=>{var t;const r=(null===(t=n.tags)||void 0===t?void 0:t.filter(t=>t!==e))||[];i(n.id,{tags:r})})(e),className:"text-gray-500 hover:text-red-500",children:(0,kt.jsx)(xp,{className:"h-3 w-3"})})]},t))}),y&&(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,kt.jsx)("input",{type:"text",value:w,onChange:e=>j(e.target.value),placeholder:"Add tag...",className:"flex-1 px-2 py-1 text-sm border border-gray-300 rounded",onKeyPress:e=>"Enter"===e.key&&A()}),(0,kt.jsx)("button",{onClick:A,className:"px-2 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Add"})]})]})]}),(0,kt.jsxs)("div",{className:"mt-8",children:[(0,kt.jsxs)("h4",{className:"text-lg font-semibold mb-4 ".concat(l?"text-white":"text-gray-900"),children:["Comments (",c.length,")"]}),console.log("Total comments in state:",c.length,c),(0,kt.jsx)("div",{className:"mb-6 p-4 rounded-lg border ".concat(l?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(l?"bg-slate-600 text-white":"bg-gray-200 text-gray-700"),children:(null===s||void 0===s||null===(r=s.name)||void 0===r?void 0:r.charAt(0))||"U"}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("textarea",{value:u,onChange:e=>h(e.target.value),placeholder:"Add a comment...",rows:3,className:"w-full px-3 py-2 rounded-lg border ".concat(l?"bg-slate-600 border-slate-500 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")}),(0,kt.jsx)("div",{className:"flex justify-end mt-2",children:(0,kt.jsxs)("button",{onClick:async()=>{if(u.trim()){p(!0);try{var e,t;const r=await Ds.feedbackService.addComment(n.id,{body:u,isDeveloper:N,parentId:null});if(console.log("Comment created via API:",r.data),console.log("Comment ID from API:",null===(e=r.data)||void 0===e?void 0:e.id),console.log("Full comment object:",JSON.stringify(r.data,null,2)),null===(t=r.data)||void 0===t||!t.id)return console.error("Comment created but no ID returned from API"),void fr.error("Comment created but missing ID");const s=r.data;console.log("Adding comment to state:",s),d(e=>{const t=[s,...e];return console.log("Previous comments:",e),console.log("New comment being added:",s),console.log("New comments state:",t),console.log("New comments length:",t.length),t}),h(""),fr.success("Comment posted successfully!")}catch(r){console.error("Failed to submit comment:",r),fr.error("Failed to post comment. Please try again.")}finally{p(!1)}}},disabled:!u.trim()||m,className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors ".concat(!u.trim()||m?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),children:[(0,kt.jsx)(ea,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:m?"Posting...":"Post Comment"})]})})]})]})}),(0,kt.jsx)("div",{className:"space-y-4",children:Array.isArray(c)&&c.map((e,t)=>{var r,n,s;return console.log("Rendering comment:",e.id,"at index:",t),(0,kt.jsx)("div",{className:"p-4 rounded-lg border ".concat(e.isPinned?"border-yellow-300 bg-yellow-50":l?"bg-slate-700 border-slate-600":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(e.isDeveloper?"bg-blue-500 text-white":l?"bg-slate-600 text-white":"bg-gray-200 text-gray-700"),children:(null===(r=e.author)||void 0===r||null===(n=r.name)||void 0===n?void 0:n.charAt(0))||"U"}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,kt.jsx)("span",{className:"font-medium ".concat(l?"text-white":"text-gray-900"),children:(null===(s=e.author)||void 0===s?void 0:s.name)||"Anonymous"}),e.isDeveloper&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Developer"}),e.isPinned&&(0,kt.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,kt.jsx)(Rj,{className:"h-3 w-3 mr-1"}),"Pinned"]}),(0,kt.jsx)("span",{className:"text-xs ".concat(l?"text-gray-400":"text-gray-500"),children:(()=>{try{if(!e.createdAt)return"Just now";const t=new Date(e.createdAt);return isNaN(t.getTime())?"Just now":rd(t,{addSuffix:!0})}catch(t){return"Just now"}})()})]}),(0,kt.jsx)("div",{className:"whitespace-pre-wrap ".concat(l?"text-gray-300":"text-gray-700"),children:e.body})]})]})},e.id||"comment-".concat(t,"-").concat(Date.now()))})})]})]})})]})})},Uj=Gs("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),Bj=e=>{let{colorMode:t,currentUser:r}=e;const n=Ct(),[s,a]=(0,o.useState)("all"),[i,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)({status:"all",severity:"all",dateRange:"all",sortBy:"newest"}),[g,f]=(0,o.useState)(""),{data:x,isLoading:v,error:y}=Cs({queryKey:["feedback",s,m,g],queryFn:async()=>{const e=(0,Y.A)((0,Y.A)({},m),{},{search:g});if("all"!==s){const t={bugs:"BUG",improvements:"IMPROVEMENT",ideas:"IDEA",mine:"MINE",following:"FOLLOWING"};e.type=t[s]||s.toUpperCase()}const t=await Ds.feedbackService.getFeedback(e);return console.log("API Response for",s,":",t.data),t.data}}),{data:b}=Cs({queryKey:["notifications",null===r||void 0===r?void 0:r.id],queryFn:async()=>{try{return await Ds.feedbackService.getNotifications(null===r||void 0===r?void 0:r.id)}catch(y){return console.log("Using mock notifications service"),await up(null===r||void 0===r?void 0:r.id)}},enabled:!(null===r||void 0===r||!r.id)}),w=Ts({mutationFn:async e=>{const t=await Ds.feedbackService.createFeedback(e);return console.log("Feedback created via API:",t.data),t.data},onSuccess:e=>{console.log("Feedback submitted successfully:",e),fr.success("Feedback submitted successfully!"),n.invalidateQueries(["feedback"])},onError:e=>{console.error("Failed to submit feedback:",e),fr.error("Failed to submit feedback")}}),j=Ts({mutationFn:async e=>{let{feedbackId:t,action:r}=e;const n=await Ds.feedbackService.vote(t,r);return console.log("Vote recorded via API:",n.data),n.data},onSuccess:()=>{n.invalidateQueries(["feedback"])}}),N=Ts({mutationFn:async e=>{let{feedbackId:t,status:r,assigneeId:n,tags:s}=e;const a=await Ds.feedbackService.updateStatus(t,{status:r,assigneeId:n,tags:s});return console.log("Status updated via API:",a.data),a.data},onSuccess:()=>{n.invalidateQueries(["feedback"]),fr.success("Status updated successfully")}}),S=Array.isArray(null===x||void 0===x?void 0:x.data)?x.data:[],k=Array.isArray(b)?b.filter(e=>!e.read):[];return console.log("=== FEEDBACK DEBUG ==="),console.log("Current activeTab:",s),console.log("feedbackData:",x),console.log("feedbackData type:",typeof x),console.log("feedbackData.data:",null===x||void 0===x?void 0:x.data),console.log("feedbackData.data type:",typeof(null===x||void 0===x?void 0:x.data)),console.log("filteredFeedback length:",S.length),console.log("filteredFeedback:",S),console.log("isLoading:",v),console.log("error:",y),console.log("=== END DEBUG ==="),console.log("=== API CONFIGURATION ==="),console.log("API Base URL:","localhost"===window.location.hostname?"http://localhost:5000/api":"".concat(window.location.protocol,"//").concat(window.location.host,"/api")),console.log("Current User:",null===r||void 0===r?void 0:r.id),console.log("=== END API CONFIG ==="),(0,kt.jsxs)("div",{className:"min-h-screen ".concat(t?"bg-slate-900":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"border-b ".concat(t?"bg-slate-800 border-slate-700":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"px-4 py-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("div",{className:"flex items-center space-x-2",children:(0,kt.jsx)(Oj,{notifications:k,colorMode:t})}),(0,kt.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(t?"bg-blue-600 text-white hover:bg-blue-700":"bg-blue-500 text-white hover:bg-blue-600"),children:"Submit Feedback"})]}),(0,kt.jsx)("div",{className:"flex items-center space-x-1 mt-3",children:["all","bugs","improvements","ideas","mine","following"].map(e=>(0,kt.jsx)("button",{onClick:()=>a(e),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat(s===e?t?"bg-blue-600 text-white":"bg-blue-500 text-white":t?"text-gray-300 hover:text-white hover:bg-slate-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})}),(0,kt.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:[(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("input",{type:"text",placeholder:"Search feedback...",value:g,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(t?"bg-slate-800 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500")}),(0,kt.jsx)(Uj,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"})]})}),(0,kt.jsx)("div",{className:"space-y-3",children:v?(0,kt.jsx)("div",{className:"space-y-3",children:[...Array(3)].map((e,r)=>(0,kt.jsxs)("div",{className:"animate-pulse ".concat(t?"bg-slate-800":"bg-white"," rounded-lg p-4"),children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,kt.jsx)("div",{className:"h-8 w-8 rounded-lg ".concat(t?"bg-slate-700":"bg-gray-200")}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("div",{className:"h-4 w-3/4 rounded ".concat(t?"bg-slate-700":"bg-gray-200"," mb-2")}),(0,kt.jsx)("div",{className:"h-3 w-1/2 rounded ".concat(t?"bg-slate-700":"bg-gray-200")})]})]}),(0,kt.jsx)("div",{className:"h-3 w-full rounded ".concat(t?"bg-slate-700":"bg-gray-200"," mb-2")}),(0,kt.jsx)("div",{className:"h-3 w-2/3 rounded ".concat(t?"bg-slate-700":"bg-gray-200")})]},r))}):0===S.length?(0,kt.jsxs)("div",{className:"text-center py-8 ".concat(t?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)(Qs,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),(0,kt.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No feedback found"}),(0,kt.jsx)("p",{children:"Try adjusting your filters or search terms."})]}):S.map(e=>(0,kt.jsx)(Ep,{feedback:e,onClick:()=>(e=>{d(e),l(!0)})(e),colorMode:t},e.id))})]}),i&&c&&(0,kt.jsx)(Fj,{feedback:c,onClose:()=>l(!1),onVote:(e,t)=>{j.mutate({feedbackId:e,action:t})},onStatusChange:(e,t)=>{N.mutate((0,Y.A)({feedbackId:e},t))},colorMode:t,currentUser:r}),u&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-hidden rounded-lg ".concat(t?"bg-slate-800":"bg-white"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b ".concat(t?"border-slate-700":"border-gray-200"),children:[(0,kt.jsx)("h2",{className:"text-2xl font-bold ".concat(t?"text-white":"text-gray-900"),children:"Submit Feedback"}),(0,kt.jsx)("button",{onClick:()=>h(!1),className:"p-2 rounded-lg ".concat(t?"hover:bg-slate-700":"hover:bg-gray-100"),children:(0,kt.jsx)(xp,{className:"h-6 w-6"})})]}),(0,kt.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:(0,kt.jsx)(vp,{onSubmit:async e=>{await w.mutateAsync(e),h(!1)},onClose:()=>h(!1),colorMode:t,currentUser:r})})]})})]})},Wj=e=>{let{onLoginSuccess:t}=e;const[r,n]=(0,o.useState)("login"),[s,a]=(0,o.useState)(""),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)(""),[g,f]=(0,o.useState)(!1),[x,v]=(0,o.useState)({type:"",text:""}),[y,b]=(0,o.useState)(null);(0,o.useEffect)(()=>{w();const{data:{subscription:e}}=Nn.supabase.auth.onAuthStateChange((e,t)=>{b((null===t||void 0===t?void 0:t.user)||null)});return()=>e.unsubscribe()},[]);const w=async()=>{const e=await(0,Nn.HW)();b(e)},j=async()=>{f(!0);try{await(0,Nn.CI)(),v({type:"success",text:"Signed out successfully!"}),b(null)}catch(e){v({type:"error",text:e.message})}finally{f(!1)}};var N,S,k,A;return y&&(0,Nn.mJ)(y)?t?(t(y),null):(0,kt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full",children:[(0,kt.jsxs)("div",{className:"text-center mb-6",children:[(0,kt.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Welcome!"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"You are logged in"})]}),(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Logged in as:"}),(0,kt.jsx)("p",{className:"text-lg font-semibold text-gray-800",children:null!==(N=y.user_metadata)&&void 0!==N&&N.first_name&&null!==(S=y.user_metadata)&&void 0!==S&&S.last_name?"".concat(y.user_metadata.first_name," ").concat(y.user_metadata.last_name):y.email}),(null===(k=y.user_metadata)||void 0===k?void 0:k.first_name)&&(null===(A=y.user_metadata)||void 0===A?void 0:A.last_name)&&(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:y.email})]}),(0,kt.jsx)("button",{onClick:j,disabled:g,className:"w-full py-3 px-4 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg transition-colors duration-200 disabled:opacity-50",children:g?"Signing out...":"Sign Out"}),x.text&&(0,kt.jsx)("div",{className:"mt-4 p-3 rounded-lg text-sm ".concat("error"===x.type?"bg-red-100 text-red-700":"success"===x.type?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:x.text})]})}):(0,kt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full",children:[(0,kt.jsxs)("div",{className:"text-center mb-8",children:[(0,kt.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"login"===r?"Welcome Back":"signup"===r?"Create Account":"Reset Password"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"login"===r?"Sign in to your account":"signup"===r?"Sign up for a new account":"Enter your email to reset password"})]}),(0,kt.jsxs)("form",{onSubmit:"login"===r?async e=>{e.preventDefault(),f(!0),v({type:"",text:""});try{const{data:e,error:r}=await Nn.supabase.auth.signInWithPassword({email:s,password:i});if(r)throw r;null!==e&&void 0!==e&&e.user&&((0,Nn.mJ)(e.user)?(v({type:"success",text:"Login successful!"}),t&&t(e.user)):(v({type:"warning",text:"Please verify your email before logging in. Check your inbox for the verification link."}),await(0,Nn.CI)()))}catch(r){v({type:"error",text:r.message})}finally{f(!1)}}:"signup"===r?async e=>{if(e.preventDefault(),i===c)if(u.trim()&&m.trim()){f(!0),v({type:"",text:""});try{const{data:e,error:t}=await Nn.supabase.auth.signUp({email:s,password:i,options:{emailRedirectTo:"".concat(window.location.origin,"/dashboard"),data:{first_name:u.trim(),last_name:m.trim()}}});if(t)throw t;null!==e&&void 0!==e&&e.user&&(v({type:"success",text:"Account created! Please check your email to verify your account."}),a(""),l(""),d(""),h(""),p(""),setTimeout(()=>n("login"),3e3))}catch(t){v({type:"error",text:t.message})}finally{f(!1)}}else v({type:"error",text:"Please provide both first and last name"});else v({type:"error",text:"Passwords do not match"})}:async e=>{e.preventDefault(),f(!0),v({type:"",text:""});try{await(0,Nn.J1)(s),v({type:"success",text:"Password reset email sent! Please check your inbox."}),a(""),setTimeout(()=>n("login"),5e3)}catch(t){v({type:"error",text:t.message})}finally{f(!1)}},children:[(0,kt.jsxs)("div",{className:"space-y-4",children:["signup"===r&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,kt.jsx)("input",{id:"firstName",type:"text",value:u,onChange:e=>h(e.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"John"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),(0,kt.jsx)("input",{id:"lastName",type:"text",value:m,onChange:e=>p(e.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Doe"})]})]})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,kt.jsx)("input",{id:"email",type:"email",value:s,onChange:e=>a(e.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"you@example.com"})]}),"forgot"!==r&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,kt.jsx)("input",{id:"password",type:"password",value:i,onChange:e=>l(e.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",minLength:6})]}),"signup"===r&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,kt.jsx)("input",{id:"confirmPassword",type:"password",value:c,onChange:e=>d(e.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",minLength:6})]})]}),"login"===r&&(0,kt.jsx)("div",{className:"mt-4 text-right",children:(0,kt.jsx)("button",{type:"button",onClick:()=>n("forgot"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Forgot password?"})}),(0,kt.jsx)("button",{type:"submit",disabled:g,className:"w-full mt-6 py-3 px-4 bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 disabled:opacity-50",children:g?"Processing...":"login"===r?"Sign In":"signup"===r?"Sign Up":"Send Reset Email"})]}),(0,kt.jsx)("div",{className:"mt-6 text-center",children:"login"===r?(0,kt.jsxs)("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",(0,kt.jsx)("button",{onClick:()=>n("signup"),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign up"})]}):"signup"===r?(0,kt.jsxs)("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",(0,kt.jsx)("button",{onClick:()=>n("login"),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign in"})]}):(0,kt.jsx)("button",{onClick:()=>n("login"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Back to login"})}),x.text&&(0,kt.jsx)("div",{className:"mt-6 p-3 rounded-lg text-sm ".concat("error"===x.type?"bg-red-100 text-red-700":"success"===x.type?"bg-green-100 text-green-700":"warning"===x.type?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"),children:x.text})]})})},zj=()=>{const[e,t]=(0,o.useState)(""),[r,n]=(0,o.useState)(""),[s,a]=(0,o.useState)(!1),[i,l]=(0,o.useState)({type:"",text:""}),[c,d]=(0,o.useState)(!1),u=F();(0,o.useEffect)(()=>{h()},[]);const h=async()=>{const{data:{session:e},error:t}=await Nn.supabase.auth.getSession();if(t)return console.error("Error checking recovery session:",t),void l({type:"error",text:"Invalid or expired reset link. Please request a new password reset."});e?d(!0):l({type:"error",text:"No valid reset session found. Please check your email for the reset link."})};return(0,kt.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, rgba(26, 90, 153, 0.18), rgba(232, 240, 247, 0.9))"},children:(0,kt.jsxs)("div",{className:"rounded-2xl shadow-xl p-8 max-w-md w-full",style:{backgroundColor:"var(--color-surface-white)",boxShadow:"var(--shadow-medium)"},children:[(0,kt.jsxs)("div",{className:"text-center mb-8",children:[(0,kt.jsx)("div",{className:"mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4",style:{backgroundColor:"var(--color-primary-light-tint)",color:"var(--color-primary-blueprint-blue)"},children:(0,kt.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 011.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),(0,kt.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Reset Password"}),(0,kt.jsx)("p",{className:"text-gray-600",children:c?"Enter your new password below":"Checking reset link..."})]}),c?(0,kt.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),e===r)if(e.length<6)l({type:"error",text:"Password must be at least 6 characters long"});else{a(!0),l({type:"",text:""});try{await(0,Nn.f3)(e),l({type:"success",text:"Password updated successfully! Redirecting to login..."}),t(""),n(""),setTimeout(()=>{u("/login")},3e3)}catch(o){console.error("Error updating password:",o),l({type:"error",text:o.message||"Failed to update password. Please try again."})}finally{a(!1)}}else l({type:"error",text:"Passwords do not match"})},children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),(0,kt.jsx)("input",{id:"newPassword",type:"password",value:e,onChange:e=>t(e.target.value),required:!0,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{borderColor:"var(--color-border-gray)",backgroundColor:"var(--color-surface-white)"},placeholder:"Enter new password",minLength:6,disabled:s}),(0,kt.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Minimum 6 characters"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),(0,kt.jsx)("input",{id:"confirmPassword",type:"password",value:r,onChange:e=>n(e.target.value),required:!0,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{borderColor:"var(--color-border-gray)",backgroundColor:"var(--color-surface-white)"},placeholder:"Confirm new password",minLength:6,disabled:s})]})]}),(0,kt.jsx)("button",{type:"submit",disabled:s||!e||!r,className:"btn btn-secondary w-full mt-6 disabled:opacity-50 disabled:cursor-not-allowed",children:s?(0,kt.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsxs)("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",style:{color:"var(--color-surface-white)"},children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating Password..."]}):"Update Password"})]}):(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 mx-auto",style:{borderBottom:"2px solid var(--color-primary-blueprint-blue)",borderTop:"2px solid transparent"}}),(0,kt.jsx)("p",{className:"mt-4 text-sm text-gray-600",children:"Validating reset link\u2026"})]}),i.text&&(0,kt.jsx)("div",{className:"mt-6 p-3 rounded-lg text-sm",style:{backgroundColor:"error"===i.type?"var(--color-danger-light-tint)":"success"===i.type?"rgba(16, 185, 129, 0.12)":"var(--color-primary-light-tint)",color:"error"===i.type?"var(--color-danger-red)":"success"===i.type?"var(--color-success-green)":"var(--color-primary-blueprint-blue)"},children:i.text}),c&&(0,kt.jsx)("div",{className:"mt-6 text-center",children:(0,kt.jsx)("button",{onClick:()=>u("/login"),className:"text-sm font-medium transition-colors",style:{color:"var(--color-primary-blueprint-blue)"},children:"Back to Login"})})]})})},Vj=["title","titleId"];function Hj(e,t){let{title:r,titleId:n}=e,s=Sn(e,Vj);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"}))}const qj=o.forwardRef(Hj),Kj=["title","titleId"];function Gj(e,t){let{title:r,titleId:n}=e,s=Sn(e,Kj);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z"}))}const Jj=o.forwardRef(Gj),Yj=["title","titleId"];function Qj(e,t){let{title:r,titleId:n}=e,s=Sn(e,Yj);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}))}const Xj=o.forwardRef(Qj),$j=["title","titleId"];function Zj(e,t){let{title:r,titleId:n}=e,s=Sn(e,$j);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const eN=o.forwardRef(Zj),tN=["title","titleId"];function rN(e,t){let{title:r,titleId:n}=e,s=Sn(e,tN);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"}))}const nN=o.forwardRef(rN),sN=[{id:"ADMIN",name:"Administration",description:"Manage company settings, users, and overall system configuration",icon:qj,color:"bg-purple-500",features:["User Management","System Settings","Financial Controls","Company Configuration"]},{id:"FIELD_DIRECTOR",name:"Field Director",description:"Oversee field operations, crew management, and on-site project execution",icon:Jj,color:"bg-orange-500",features:["Crew Management","Safety Oversight","Quality Control","Equipment Coordination"]},{id:"OFFICE_STAFF",name:"Office Staff",description:"Handle customer communications, scheduling, and administrative tasks",icon:Xj,color:"bg-blue-500",features:["Customer Service","Scheduling","Documentation","Communication"]},{id:"OWNER",name:"Owner",description:"Full system access with advanced workflow customization and business controls",icon:eN,color:"bg-green-500",features:["Complete Access","Workflow Design","Business Analytics","Strategic Planning"],isOwner:!0},{id:"PROJECT_MANAGER",name:"Project Manager",description:"Coordinate project workflows, manage timelines, and oversee project delivery",icon:nN,color:"bg-indigo-500",features:["Project Coordination","Timeline Management","Resource Planning","Client Relations"]},{id:"LOCATION_MANAGER",name:"Location Manager",description:"Manage site-specific operations, coordinate with local teams, and oversee location-based project activities",icon:qj,color:"bg-teal-500",features:["Site Management","Local Coordination","Location Oversight","Regional Operations"]}],aN=e=>{let{onRoleSelected:t,loading:r=!1}=e;const[n,s]=(0,o.useState)(null),[a,i]=(0,o.useState)(null);return(0,kt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,kt.jsxs)("div",{className:"max-w-6xl w-full",children:[(0,kt.jsxs)("div",{className:"text-center mb-12",children:[(0,kt.jsx)("div",{className:"mx-auto w-16 h-16 bg-[var(--color-primary-blueprint-blue)] rounded-full flex items-center justify-center mb-6",children:(0,kt.jsx)(nN,{className:"w-8 h-8 text-white"})}),(0,kt.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Welcome to Kenstruction"}),(0,kt.jsx)("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Let's set up your account by selecting your role. This helps us customize your experience and provide the right tools for your work."})]}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:sN.map(e=>{const t=e.icon,r=n===e.id,o=a===e.id;return(0,kt.jsxs)("div",{className:"\n                  relative bg-white rounded-xl shadow-lg border-2 transition-all duration-300 cursor-pointer\n                  transform hover:scale-105 hover:shadow-xl\n                  ".concat(r?"border-blue-500 ring-4 ring-blue-200 shadow-xl scale-105":"border-gray-200 hover:border-gray-300","\n                  ").concat(e.isOwner?"ring-2 ring-green-200":"","\n                "),onClick:()=>{return t=e.id,void s(t);var t},onMouseEnter:()=>i(e.id),onMouseLeave:()=>i(null),children:[e.isOwner&&(0,kt.jsx)("div",{className:"absolute -top-3 -right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full",children:"RECOMMENDED"}),r&&(0,kt.jsx)("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsx)("div",{className:"w-16 h-16 ".concat(e.color," rounded-lg flex items-center justify-center mb-4 mx-auto transition-transform duration-300 ").concat(o?"scale-110":""),children:(0,kt.jsx)(t,{className:"w-8 h-8 text-white"})}),(0,kt.jsx)("h3",{className:"text-xl font-semibold text-gray-900 text-center mb-3",children:e.name}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm text-center mb-4 min-h-[3rem]",children:e.description}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Key Responsibilities"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[e.features.slice(0,3).map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,kt.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full mr-2 flex-shrink-0"}),e]},t)),e.features.length>3&&(0,kt.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["+",e.features.length-3," more..."]})]})]})]})]},e.id)})}),(0,kt.jsx)("div",{className:"flex justify-center space-x-4",children:(0,kt.jsx)("button",{onClick:()=>{n&&t&&t(n)},disabled:!n||r,className:"\n              px-8 py-3 rounded-lg font-semibold text-white transition-all duration-300\n              transform hover:scale-105 disabled:transform-none\n              ".concat(n&&!r?"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 shadow-lg hover:shadow-xl":"bg-gray-400 cursor-not-allowed","\n            "),children:r?(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,kt.jsx)("span",{children:"Setting up your account..."})]}):"Continue"})}),(0,kt.jsxs)("div",{className:"text-center mt-8",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Don't worry, you can change your role later in the settings if needed."}),"OWNER"===n&&(0,kt.jsx)("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg max-w-md mx-auto",children:(0,kt.jsxs)("p",{className:"text-sm text-green-700",children:[(0,kt.jsx)("strong",{children:"Owner Role Selected:"})," You'll be guided through a quick setup process to customize your workflows and get the most out of the system."]})})]})]})})},oN=["title","titleId"];function iN(e,t){let{title:r,titleId:n}=e,s=Sn(e,oN);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"}))}const lN=o.forwardRef(iN),cN=["title","titleId"];function dN(e,t){let{title:r,titleId:n}=e,s=Sn(e,cN);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12a7.5 7.5 0 0 0 15 0m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m16.5 0H21m-1.5 0H12m-8.457 3.077 1.41-.513m14.095-5.13 1.41-.513M5.106 17.785l1.15-.964m11.49-9.642 1.149-.964M7.501 19.795l.75-1.3m7.5-12.99.75-1.3m-6.063 16.658.26-1.477m2.605-14.772.26-1.477m0 17.726-.26-1.477M10.698 4.614l-.26-1.477M16.5 19.794l-.75-1.299M7.5 4.205 12 12m6.894 5.785-1.149-.964M6.256 7.178l-1.15-.964m15.352 8.864-1.41-.513M4.954 9.435l-1.41-.514M12.002 12l-3.75 6.495"}))}const uN=o.forwardRef(dN),hN=["title","titleId"];function mN(e,t){let{title:r,titleId:n}=e,s=Sn(e,hN);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}const pN=o.forwardRef(mN),gN=["title","titleId"];function fN(e,t){let{title:r,titleId:n}=e,s=Sn(e,gN);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"}))}const xN=o.forwardRef(fN),vN=[{id:"default",title:"Use Default Roofing Workflow",description:"Start with our proven roofing workflow that includes all standard phases and line items",icon:vu,color:"bg-green-500",features:["15 workflow phases from Lead to Completion","86 professionally named line items","Automated alerts and progression","Ready to use immediately"],recommended:!0},{id:"customize",title:"Customize Default Workflow",description:"Start with the default workflow but modify phases, sections, and line items to fit your process",icon:lN,color:"bg-blue-500",features:["Built on proven foundation","Add or remove phases","Customize line item names","Tailor to your specific needs"]},{id:"create",title:"Create New Workflow",description:"Build a completely custom workflow from scratch with your own phases and processes",icon:ap,color:"bg-purple-500",features:["Complete creative control","Define your own phases","Custom line items and sections","Advanced workflow design"],advanced:!0}],yN=e=>{let{onComplete:t,onBack:r,currentUser:n}=e;const[s,a]=(0,o.useState)(1),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(null),g=()=>(0,kt.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,kt.jsxs)("div",{className:"text-center mb-12",children:[(0,kt.jsx)("div",{className:"mx-auto w-16 h-16 bg-[var(--color-primary-blueprint-blue)] rounded-full flex items-center justify-center mb-6",children:(0,kt.jsx)(uN,{className:"w-8 h-8 text-white"})}),(0,kt.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Set Up Your Project Workflow"}),(0,kt.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Choose how you'd like to configure your project workflow system. This determines how your projects will be managed and tracked."})]}),(0,kt.jsx)("div",{className:"grid gap-6 mb-8",children:vN.map(e=>{const t=e.icon,r=i===e.id;return(0,kt.jsxs)("div",{className:"\n                relative bg-white rounded-xl border-2 p-6 cursor-pointer transition-all duration-300\n                hover:shadow-lg transform hover:scale-[1.02]\n                ".concat(r?"border-blue-500 ring-4 ring-blue-200 shadow-xl":"border-gray-200 hover:border-gray-300","\n              "),onClick:()=>l(e.id),children:[(0,kt.jsxs)("div",{className:"absolute top-4 right-4 flex space-x-2",children:[e.recommended&&(0,kt.jsx)("span",{className:"bg-green-100 text-green-700 text-xs font-medium px-3 py-1 rounded-full",children:"RECOMMENDED"}),e.advanced&&(0,kt.jsx)("span",{className:"bg-purple-100 text-purple-700 text-xs font-medium px-3 py-1 rounded-full",children:"ADVANCED"})]}),r&&(0,kt.jsx)("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,kt.jsxs)("div",{className:"flex items-start space-x-6",children:[(0,kt.jsx)("div",{className:"w-16 h-16 ".concat(e.color," rounded-lg flex items-center justify-center flex-shrink-0"),children:(0,kt.jsx)(t,{className:"w-8 h-8 text-white"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:e.title}),(0,kt.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,kt.jsx)("div",{className:"grid grid-cols-2 gap-2",children:e.features.map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[(0,kt.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full mr-2 flex-shrink-0"}),e]},t))})]})]})]},e.id)})}),"create"===i&&(0,kt.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-6 mb-8",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Workflow Name"}),(0,kt.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Enter a name for your custom workflow (e.g., 'Premium Roofing Process')",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,kt.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Give your workflow a descriptive name that reflects your business process."})]})]}),f=()=>{const e=vN.find(e=>e.id===i);return(0,kt.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,kt.jsxs)("div",{className:"text-center mb-8",children:[(0,kt.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Workflow Setup Complete!"}),(0,kt.jsxs)("p",{className:"text-lg text-gray-600",children:["Your ",null===e||void 0===e?void 0:e.title.toLowerCase()," is ready to use."]})]}),(0,kt.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-8 mb-8",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,kt.jsx)("div",{className:"w-12 h-12 ".concat(null===e||void 0===e?void 0:e.color," rounded-lg flex items-center justify-center"),children:(0,kt.jsx)(e.icon,{className:"w-6 h-6 text-white"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"create"===i&&c?c:null===e||void 0===e?void 0:e.title}),(0,kt.jsx)("p",{className:"text-gray-600",children:null===e||void 0===e?void 0:e.description})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,kt.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:"15"}),(0,kt.jsx)("div",{className:"text-sm text-gray-600",children:"Workflow Phases"})]}),(0,kt.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-green-600 mb-1",children:"86"}),(0,kt.jsx)("div",{className:"text-sm text-gray-600",children:"Line Items"})]}),(0,kt.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-purple-600 mb-1",children:"Auto"}),(0,kt.jsx)("div",{className:"text-sm text-gray-600",children:"Alert System"})]})]}),(0,kt.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,kt.jsx)("h4",{className:"font-semibold text-blue-900 mb-3",children:"What happens next:"}),(0,kt.jsxs)("div",{className:"space-y-2 text-sm text-blue-800",children:[(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)(vu,{className:"w-4 h-4 mr-2 text-blue-600"}),"Your workflow system will be activated"]}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)(vu,{className:"w-4 h-4 mr-2 text-blue-600"}),"All projects will use this workflow structure"]}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)(vu,{className:"w-4 h-4 mr-2 text-blue-600"}),"Automatic alerts will be enabled for line items"]}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)(vu,{className:"w-4 h-4 mr-2 text-blue-600"}),"You can customize workflows anytime in Settings"]})]})]})]})]})},x=async()=>{h(!0);try{const e={workflowOption:i,customWorkflowName:"create"===i?c:null,completedAt:(new Date).toISOString()};console.log("Completing onboarding with:",e),t&&t(e)}catch(e){console.error("Error completing onboarding:",e)}finally{h(!1)}},v=()=>1!==s||!!i&&!("create"===i&&!c.trim());return(0,kt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 py-8 px-4",children:[(0,kt.jsx)("div",{className:"max-w-2xl mx-auto mb-8",children:(0,kt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(s>=1?"bg-[var(--color-primary-blueprint-blue)] text-white":"bg-gray-200 text-gray-600"),children:"1"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Workflow Selection"})]}),(0,kt.jsx)("div",{className:"flex-1 h-1 rounded ".concat(s>=2?"bg-[var(--color-primary-blueprint-blue)]":"bg-gray-200")}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(s>=2?"bg-[var(--color-primary-blueprint-blue)] text-white":"bg-gray-200 text-gray-600"),children:"2"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Setup Complete"})]})]})}),(0,kt.jsx)("div",{className:"mb-8",children:1===s?(0,kt.jsx)(g,{}):(0,kt.jsx)(f,{})}),(0,kt.jsxs)("div",{className:"max-w-5xl mx-auto flex justify-between items-center",children:[(0,kt.jsxs)("button",{onClick:1===s?r:()=>a(1),className:"flex items-center space-x-2 px-6 py-3 text-gray-600 hover:text-gray-800 transition-colors",children:[(0,kt.jsx)(pN,{className:"w-4 h-4"}),(0,kt.jsx)("span",{children:"Back"})]}),(0,kt.jsx)("button",{onClick:async()=>{if(1===s){if(!i)return;if("create"===i&&!c.trim())return;h(!0);try{await new Promise(e=>setTimeout(e,1e3)),a(2)}catch(e){console.error("Error setting up workflow:",e)}finally{h(!1)}}else await x()},disabled:!v()||u,className:"\n            flex items-center space-x-2 px-8 py-3 rounded-lg font-semibold text-white transition-all duration-300\n            transform hover:scale-105 disabled:transform-none\n            ".concat(v()&&!u?"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 shadow-lg hover:shadow-xl":"bg-gray-400 cursor-not-allowed","\n          "),children:u?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,kt.jsx)("span",{children:"Setting up..."})]}):1===s?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"Continue"}),(0,kt.jsx)(xN,{className:"w-4 h-4"})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"Complete Setup"}),(0,kt.jsx)(vu,{className:"w-4 h-4"})]})})]})]})},bN={ADMIN:"ADMIN",FIELD_DIRECTOR:"FOREMAN",OFFICE_STAFF:"WORKER",OWNER:"ADMIN",PROJECT_MANAGER:"PROJECT_MANAGER",LOCATION_MANAGER:"LOCATION_MANAGER"},wN=e=>{let{currentUser:t,onComplete:r}=e;const[n,s]=(0,o.useState)("role-selection"),[a,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)(null);(0,o.useEffect)(()=>{(null!==t&&void 0!==t&&t.hasCompletedOnboarding||"WORKER"!==(null===t||void 0===t?void 0:t.role))&&(null===r||void 0===r||r())},[t,r]);const h=async e=>{c(!0),u(null);try{const t=bN[e]||e,r=await Ds.onboardingService.updateRole({role:t,onboardingRole:e,hasCompletedOnboarding:"OWNER"!==e});if(!r.success)throw new Error(r.message||"Failed to update user role");i(e),"OWNER"===e?s("owner-onboarding"):p({role:e,mappedRole:t,completedAt:(new Date).toISOString()})}catch(ES){console.error("Error updating user role:",ES),u("Failed to update your role. Please try again.")}finally{c(!1)}},m=async e=>{c(!0);try{const t=await Ds.onboardingService.completeOnboarding({role:a,workflowSetup:e,completedAt:(new Date).toISOString()});if(!t.success)throw new Error(t.message||"Failed to complete onboarding");p({role:a,mappedRole:bN[a],workflowSetup:e,completedAt:(new Date).toISOString()})}catch(ES){console.error("Error completing onboarding:",ES),u("Failed to complete onboarding. Please try again."),c(!1)}},p=e=>{const n=(0,Y.A)((0,Y.A)({},t),{},{role:e.mappedRole,onboardingRole:e.role,hasCompletedOnboarding:!0,onboardingData:e});localStorage.setItem("user",JSON.stringify(n)),r&&r(e)},g=()=>{s("role-selection"),i(null),u(null)};if(d)return(0,kt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,kt.jsxs)("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center",children:[(0,kt.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,kt.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Setup Error"}),(0,kt.jsx)("p",{className:"text-gray-600 mb-6",children:d}),(0,kt.jsx)("button",{onClick:()=>{u(null),s("role-selection")},className:"w-full bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors",children:"Try Again"})]})});switch(n){case"role-selection":return(0,kt.jsx)(aN,{onRoleSelected:h,loading:l});case"owner-onboarding":return(0,kt.jsx)(yN,{currentUser:t,onComplete:m,onBack:g});default:return null}},jN=()=>(0,kt.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{verticalAlign:"middle"},children:[(0,kt.jsx)("path",{d:"M12 6.5L13.2 10.8L17.5 12L13.2 13.2L12 17.5L10.8 13.2L6.5 12L10.8 10.8L12 6.5Z",fill:"#3b82f6"}),(0,kt.jsx)("rect",{x:"17.5",y:"4.5",width:"2",height:"2",rx:"1",fill:"#3b82f6"}),(0,kt.jsx)("rect",{x:"17.5",y:"17.5",width:"2",height:"2",rx:"1",fill:"#3b82f6"})]}),NN=()=>(0,kt.jsxs)("div",{className:"flex items-center justify-center gap-1 mt-2 w-full",children:[(0,kt.jsx)("span",{className:"text-base font-semibold text-brand-500 tracking-wide",children:"AI-Powered"}),(0,kt.jsx)(jN,{})]});function SN(e){return Array.isArray?Array.isArray(e):"[object Array]"===TN(e)}function kN(e){return"string"===typeof e}function AN(e){return"number"===typeof e}function CN(e){return!0===e||!1===e||function(e){return EN(e)&&null!==e}(e)&&"[object Boolean]"==TN(e)}function EN(e){return"object"===typeof e}function PN(e){return void 0!==e&&null!==e}function IN(e){return!e.trim().length}function TN(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const DN=Object.prototype.hasOwnProperty;class MN{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(e=>{let r=_N(e);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(e=>{e.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function _N(e){let t=null,r=null,n=null,s=1,a=null;if(kN(e)||SN(e))n=e,t=ON(e),r=LN(e);else{if(!DN.call(e,"name"))throw new Error((e=>"Missing ".concat(e," property in key"))("name"));const o=e.name;if(n=o,DN.call(e,"weight")&&(s=e.weight,s<=0))throw new Error((e=>"Property 'weight' in key '".concat(e,"' must be a positive integer"))(o));t=ON(o),r=LN(o),a=e.getFn}return{path:t,id:r,weight:s,src:n,getFn:a}}function ON(e){return SN(e)?e:e.split(".")}function LN(e){return SN(e)?e.join("."):e}const RN={useExtendedSearch:!1,getFn:function(e,t){let r=[],n=!1;const s=(e,t,a)=>{if(PN(e))if(t[a]){const o=e[t[a]];if(!PN(o))return;if(a===t.length-1&&(kN(o)||AN(o)||CN(o)))r.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;let t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(o));else if(SN(o)){n=!0;for(let e=0,r=o.length;e<r;e+=1)s(o[e],t,a+1)}else t.length&&s(o,t,a+1)}else r.push(e)};return s(e,kN(t)?t.split("."):t,0),n?r:r[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var FN=(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},{isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1}),{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1}),{location:0,threshold:.6,distance:100}),RN);const UN=/[^ ]+/g;class BN{constructor(){let{getFn:e=FN.getFn,fieldNormWeight:t=FN.fieldNormWeight}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.norm=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const r=new Map,n=Math.pow(10,t);return{get(t){const s=t.match(UN).length;if(r.has(s))return r.get(s);const a=1/Math.pow(s,.5*e),o=parseFloat(Math.round(a*n)/n);return r.set(s,o),o},clear(){r.clear()}}}(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.docs=e}setIndexRecords(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.records=e}setKeys(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.keys=e,this._keysMap={},e.forEach((e,t)=>{this._keysMap[e.id]=t})}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,kN(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();kN(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,r=this.size();t<r;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!PN(e)||IN(e))return;let r={v:e,i:t,n:this.norm.get(e)};this.records.push(r)}_addObject(e,t){let r={i:t,$:{}};this.keys.forEach((t,n)=>{let s=t.getFn?t.getFn(e):this.getFn(e,t.path);if(PN(s))if(SN(s)){let e=[];const t=[{nestedArrIndex:-1,value:s}];for(;t.length;){const{nestedArrIndex:r,value:n}=t.pop();if(PN(n))if(kN(n)&&!IN(n)){let t={v:n,i:r,n:this.norm.get(n)};e.push(t)}else SN(n)&&n.forEach((e,r)=>{t.push({nestedArrIndex:r,value:e})})}r.$[n]=e}else if(kN(s)&&!IN(s)){let e={v:s,n:this.norm.get(s)};r.$[n]=e}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function WN(e,t){let{getFn:r=FN.getFn,fieldNormWeight:n=FN.fieldNormWeight}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=new BN({getFn:r,fieldNormWeight:n});return s.setKeys(e.map(_N)),s.setSources(t),s.create(),s}function zN(e){let{errors:t=0,currentLocation:r=0,expectedLocation:n=0,distance:s=FN.distance,ignoreLocation:a=FN.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=t/e.length;if(a)return o;const i=Math.abs(n-r);return s?o+i/s:i?1:o}const VN=32;function HN(e,t,r){let{location:n=FN.location,distance:s=FN.distance,threshold:a=FN.threshold,findAllMatches:o=FN.findAllMatches,minMatchCharLength:i=FN.minMatchCharLength,includeMatches:l=FN.includeMatches,ignoreLocation:c=FN.ignoreLocation}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.length>VN)throw new Error("Pattern length exceeds max of ".concat(VN,"."));const d=t.length,u=e.length,h=Math.max(0,Math.min(n,u));let m=a,p=h;const g=i>1||l,f=g?Array(u):[];let x;for(;(x=e.indexOf(t,p))>-1;){let e=zN(t,{currentLocation:x,expectedLocation:h,distance:s,ignoreLocation:c});if(m=Math.min(e,m),p=x+d,g){let e=0;for(;e<d;)f[x+e]=1,e+=1}}p=-1;let v=[],y=1,b=d+u;const w=1<<d-1;for(let N=0;N<d;N+=1){let n=0,a=b;for(;n<a;){zN(t,{errors:N,currentLocation:h+a,expectedLocation:h,distance:s,ignoreLocation:c})<=m?n=a:b=a,a=Math.floor((b-n)/2+n)}b=a;let i=Math.max(1,h-a+1),l=o?u:Math.min(h+a,u)+d,x=Array(l+2);x[l+1]=(1<<N)-1;for(let o=l;o>=i;o-=1){let n=o-1,a=r[e.charAt(n)];if(g&&(f[n]=+!!a),x[o]=(x[o+1]<<1|1)&a,N&&(x[o]|=(v[o+1]|v[o])<<1|1|v[o+1]),x[o]&w&&(y=zN(t,{errors:N,currentLocation:n,expectedLocation:h,distance:s,ignoreLocation:c}),y<=m)){if(m=y,p=n,p<=h)break;i=Math.max(1,2*h-p)}}if(zN(t,{errors:N+1,currentLocation:h,expectedLocation:h,distance:s,ignoreLocation:c})>m)break;v=x}const j={isMatch:p>=0,score:Math.max(.001,y)};if(g){const e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FN.minMatchCharLength,r=[],n=-1,s=-1,a=0;for(let o=e.length;a<o;a+=1){let o=e[a];o&&-1===n?n=a:o||-1===n||(s=a-1,s-n+1>=t&&r.push([n,s]),n=-1)}return e[a-1]&&a-n>=t&&r.push([n,a-1]),r}(f,i);e.length?l&&(j.indices=e):j.isMatch=!1}return j}function qN(e){let t={};for(let r=0,n=e.length;r<n;r+=1){const s=e.charAt(r);t[s]=(t[s]||0)|1<<n-r-1}return t}const KN=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class GN{constructor(e){let{location:t=FN.location,threshold:r=FN.threshold,distance:n=FN.distance,includeMatches:s=FN.includeMatches,findAllMatches:a=FN.findAllMatches,minMatchCharLength:o=FN.minMatchCharLength,isCaseSensitive:i=FN.isCaseSensitive,ignoreDiacritics:l=FN.ignoreDiacritics,ignoreLocation:c=FN.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.options={location:t,threshold:r,distance:n,includeMatches:s,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:i,ignoreDiacritics:l,ignoreLocation:c},e=i?e:e.toLowerCase(),e=l?KN(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const d=(e,t)=>{this.chunks.push({pattern:e,alphabet:qN(e),startIndex:t})},u=this.pattern.length;if(u>VN){let e=0;const t=u%VN,r=u-t;for(;e<r;)d(this.pattern.substr(e,VN),e),e+=VN;if(t){const e=u-VN;d(this.pattern.substr(e),e)}}else d(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:r,includeMatches:n}=this.options;if(e=t?e:e.toLowerCase(),e=r?KN(e):e,this.pattern===e){let t={isMatch:!0,score:0};return n&&(t.indices=[[0,e.length-1]]),t}const{location:s,distance:a,threshold:o,findAllMatches:i,minMatchCharLength:l,ignoreLocation:c}=this.options;let d=[],u=0,h=!1;this.chunks.forEach(t=>{let{pattern:r,alphabet:m,startIndex:p}=t;const{isMatch:g,score:f,indices:x}=HN(e,r,m,{location:s+p,distance:a,threshold:o,findAllMatches:i,minMatchCharLength:l,includeMatches:n,ignoreLocation:c});g&&(h=!0),u+=f,g&&x&&(d=[...d,...x])});let m={isMatch:h,score:h?u/this.chunks.length:1};return h&&n&&(m.indices=d),m}}class JN{constructor(e){this.pattern=e}static isMultiMatch(e){return YN(e,this.multiRegex)}static isSingleMatch(e){return YN(e,this.singleRegex)}search(){}}function YN(e,t){const r=e.match(t);return r?r[1]:null}class QN extends JN{constructor(e){let{location:t=FN.location,threshold:r=FN.threshold,distance:n=FN.distance,includeMatches:s=FN.includeMatches,findAllMatches:a=FN.findAllMatches,minMatchCharLength:o=FN.minMatchCharLength,isCaseSensitive:i=FN.isCaseSensitive,ignoreDiacritics:l=FN.ignoreDiacritics,ignoreLocation:c=FN.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),this._bitapSearch=new GN(e,{location:t,threshold:r,distance:n,includeMatches:s,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:i,ignoreDiacritics:l,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class XN extends JN{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t,r=0;const n=[],s=this.pattern.length;for(;(t=e.indexOf(this.pattern,r))>-1;)r=t+s,n.push([t,r-1]);const a=!!n.length;return{isMatch:a,score:a?0:1,indices:n}}}const $N=[class extends JN{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},XN,class extends JN{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},class extends JN{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends JN{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends JN{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},class extends JN{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},QN],ZN=$N.length,eS=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;const tS=new Set([QN.type,XN.type]);class rS{constructor(e){let{isCaseSensitive:t=FN.isCaseSensitive,ignoreDiacritics:r=FN.ignoreDiacritics,includeMatches:n=FN.includeMatches,minMatchCharLength:s=FN.minMatchCharLength,ignoreLocation:a=FN.ignoreLocation,findAllMatches:o=FN.findAllMatches,location:i=FN.location,threshold:l=FN.threshold,distance:c=FN.distance}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:s,findAllMatches:o,ignoreLocation:a,location:i,threshold:l,distance:c},e=t?e:e.toLowerCase(),e=r?KN(e):e,this.pattern=e,this.query=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.split("|").map(e=>{let r=e.trim().split(eS).filter(e=>e&&!!e.trim()),n=[];for(let s=0,a=r.length;s<a;s+=1){const e=r[s];let a=!1,o=-1;for(;!a&&++o<ZN;){const r=$N[o];let s=r.isMultiMatch(e);s&&(n.push(new r(s,t)),a=!0)}if(!a)for(o=-1;++o<ZN;){const r=$N[o];let s=r.isSingleMatch(e);if(s){n.push(new r(s,t));break}}}return n})}(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:s}=this.options;e=n?e:e.toLowerCase(),e=s?KN(e):e;let a=0,o=[],i=0;for(let l=0,c=t.length;l<c;l+=1){const n=t[l];o.length=0,a=0;for(let t=0,s=n.length;t<s;t+=1){const s=n[t],{isMatch:l,indices:c,score:d}=s.search(e);if(!l){i=0,a=0,o.length=0;break}if(a+=1,i+=d,r){const e=s.constructor.type;tS.has(e)?o=[...o,...c]:o.push(c)}}if(a){let e={isMatch:!0,score:i/a};return r&&(e.indices=o),e}}return{isMatch:!1,score:1}}}const nS=[];function sS(e,t){for(let r=0,n=nS.length;r<n;r+=1){let n=nS[r];if(n.condition(e,t))return new n(e,t)}return new GN(e,t)}const aS="$and",oS="$or",iS="$path",lS="$val",cS=e=>!(!e[aS]&&!e[oS]),dS=e=>({[aS]:Object.keys(e).map(t=>({[t]:e[t]}))});function uS(e,t){let{auto:r=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=e=>{let s=Object.keys(e);const a=(e=>!!e[iS])(e);if(!a&&s.length>1&&!cS(e))return n(dS(e));if((e=>!SN(e)&&EN(e)&&!cS(e))(e)){const n=a?e[iS]:s[0],o=a?e[lS]:e[n];if(!kN(o))throw new Error((e=>"Invalid value for key ".concat(e))(n));const i={keyId:LN(n),pattern:o};return r&&(i.searcher=sS(o,t)),i}let o={children:[],operator:s[0]};return s.forEach(t=>{const r=e[t];SN(r)&&r.forEach(e=>{o.children.push(n(e))})}),o};return cS(e)||(e=dS(e)),n(e)}function hS(e,t){const r=e.matches;t.matches=[],PN(r)&&r.forEach(e=>{if(!PN(e.indices)||!e.indices.length)return;const{indices:r,value:n}=e;let s={indices:r,value:n};e.key&&(s.key=e.key.src),e.idx>-1&&(s.refIndex=e.idx),t.matches.push(s)})}function mS(e,t){t.score=e.score}class pS{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;this.options=(0,Y.A)((0,Y.A)({},FN),t),this.options.useExtendedSearch,this._keyStore=new MN(this.options.keys),this.setCollection(e,r)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof BN))throw new Error("Incorrect 'index' type");this._myIndex=t||WN(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){PN(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>!1;const t=[];for(let r=0,n=this._docs.length;r<n;r+=1){const s=this._docs[r];e(s,r)&&(this.removeAt(r),r-=1,n-=1,t.push(s))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e){let{limit:t=-1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{includeMatches:r,includeScore:n,shouldSort:s,sortFn:a,ignoreFieldNorm:o}=this.options;let i=kN(e)?kN(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,t){let{ignoreFieldNorm:r=FN.ignoreFieldNorm}=t;e.forEach(e=>{let t=1;e.matches.forEach(e=>{let{key:n,norm:s,score:a}=e;const o=n?n.weight:null;t*=Math.pow(0===a&&o?Number.EPSILON:a,(o||1)*(r?1:s))}),e.score=t})}(i,{ignoreFieldNorm:o}),s&&i.sort(a),AN(t)&&t>-1&&(i=i.slice(0,t)),function(e,t){let{includeMatches:r=FN.includeMatches,includeScore:n=FN.includeScore}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=[];return r&&s.push(hS),n&&s.push(mS),e.map(e=>{const{idx:r}=e,n={item:t[r],refIndex:r};return s.length&&s.forEach(t=>{t(e,n)}),n})}(i,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(e){const t=sS(e,this.options),{records:r}=this._myIndex,n=[];return r.forEach(e=>{let{v:r,i:s,n:a}=e;if(!PN(r))return;const{isMatch:o,score:i,indices:l}=t.searchIn(r);o&&n.push({item:r,idx:s,matches:[{score:i,value:r,norm:a,indices:l}]})}),n}_searchLogical(e){const t=uS(e,this.options),r=(e,t,n)=>{if(!e.children){const{keyId:r,searcher:s}=e,a=this._findMatches({key:this._keyStore.get(r),value:this._myIndex.getValueForItemAtKeyId(t,r),searcher:s});return a&&a.length?[{idx:n,item:t,matches:a}]:[]}const s=[];for(let a=0,o=e.children.length;a<o;a+=1){const o=e.children[a],i=r(o,t,n);if(i.length)s.push(...i);else if(e.operator===aS)return[]}return s},n=this._myIndex.records,s={},a=[];return n.forEach(e=>{let{$:n,i:o}=e;if(PN(n)){let e=r(t,n,o);e.length&&(s[o]||(s[o]={idx:o,item:n,matches:[]},a.push(s[o])),e.forEach(e=>{let{matches:t}=e;s[o].matches.push(...t)}))}}),a}_searchObjectList(e){const t=sS(e,this.options),{keys:r,records:n}=this._myIndex,s=[];return n.forEach(e=>{let{$:n,i:a}=e;if(!PN(n))return;let o=[];r.forEach((e,r)=>{o.push(...this._findMatches({key:e,value:n[r],searcher:t}))}),o.length&&s.push({idx:a,item:n,matches:o})}),s}_findMatches(e){let{key:t,value:r,searcher:n}=e;if(!PN(r))return[];let s=[];if(SN(r))r.forEach(e=>{let{v:r,i:a,n:o}=e;if(!PN(r))return;const{isMatch:i,score:l,indices:c}=n.searchIn(r);i&&s.push({score:l,key:t,value:r,idx:a,norm:o,indices:c})});else{const{v:e,n:a}=r,{isMatch:o,score:i,indices:l}=n.searchIn(e);o&&s.push({score:i,key:t,value:e,norm:a,indices:l})}return s}}pS.version="7.1.0",pS.createIndex=WN,pS.parseIndex=function(e){let{getFn:t=FN.getFn,fieldNormWeight:r=FN.fieldNormWeight}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{keys:n,records:s}=e,a=new BN({getFn:t,fieldNormWeight:r});return a.setKeys(n),a.setIndexRecords(s),a},pS.config=FN,pS.parseQuery=uS,function(){nS.push(...arguments)}(rS);const gS=e=>{if(!e)return"";const t=e.replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):e},fS={includeScore:!0,includeMatches:!0,threshold:.2,keys:[{name:"projectNumber",weight:15},{name:"name",weight:12},{name:"projectName",weight:12},{name:"address",weight:11},{name:"customer.name",weight:10},{name:"customer.primaryName",weight:10},{name:"client.name",weight:10},{name:"customer.phone",weight:9},{name:"customer.primaryPhone",weight:9},{name:"client.phone",weight:9},{name:"customer.email",weight:9},{name:"customer.primaryEmail",weight:9},{name:"client.email",weight:9},{name:"projectManager.name",weight:8},{name:"projectManager.firstName",weight:8},{name:"phase",weight:8},{name:"status",weight:7},{name:"projectType",weight:7},{name:"type",weight:7},{name:"description",weight:5},{name:"notes",weight:4}]},xS={includeScore:!0,includeMatches:!0,threshold:.2,keys:[{name:"name",weight:10},{name:"primaryName",weight:10},{name:"email",weight:8},{name:"primaryEmail",weight:8},{name:"phone",weight:8},{name:"primaryPhone",weight:8},{name:"address",weight:6},{name:"secondaryName",weight:7},{name:"secondaryEmail",weight:7},{name:"secondaryPhone",weight:7}]},vS={includeScore:!0,includeMatches:!0,threshold:.2,keys:[{name:"subject",weight:8},{name:"content",weight:6},{name:"description",weight:6},{name:"projectName",weight:5},{name:"author",weight:4},{name:"projectNumber",weight:5}]};class yS{constructor(){this.data={projects:[],customers:[],messages:[]},this.fuseInstances={projects:null,customers:null,messages:null}}updateData(e){let{projects:t=[],activities:r=[]}=e;this.data.projects=t||[],this.data.messages=r||[],this.data.customers=this.extractCustomers(this.data.projects),this.fuseInstances.projects=new pS(this.data.projects,fS),this.fuseInstances.customers=new pS(this.data.customers,xS),this.fuseInstances.messages=new pS(this.data.messages,vS)}extractCustomers(e){const t=new Map;return e.forEach(e=>{const r=e.client||e.customer;if(r&&(r.name||r.primaryName)){const n=r.name||r.primaryName,s=n.toLowerCase();t.has(s)||t.set(s,{id:r.id||"customer-".concat(t.size),name:n,primaryName:r.primaryName||r.name,email:r.email||r.primaryEmail,primaryEmail:r.primaryEmail||r.email,phone:r.phone||r.primaryPhone,primaryPhone:r.primaryPhone||r.phone,secondaryName:r.secondaryName,secondaryEmail:r.secondaryEmail,secondaryPhone:r.secondaryPhone,address:r.address||e.address,projects:[]}),t.get(s).projects.push(e)}}),Array.from(t.values())}search(e){if(!e||e.trim().length<1)return[];const t=[];if(this.fuseInstances.projects){const r=this.fuseInstances.projects.search(e);t.push(...this.formatProjectResults(r))}if(this.fuseInstances.customers){const r=this.fuseInstances.customers.search(e);t.push(...this.formatCustomerResults(r))}if(this.fuseInstances.messages){const r=this.fuseInstances.messages.search(e);t.push(...this.formatMessageResults(r))}return t.sort((e,t)=>(e.fuseScore||1)-(t.fuseScore||1)).slice(0,50)}formatProjectResults(e){return e.map(e=>{var t;const r=e.item,n=r.client||r.customer,s=(null===n||void 0===n?void 0:n.name)||(null===n||void 0===n?void 0:n.primaryName)||"Unknown Customer",a=(0,Y.A)((0,Y.A)({},r),{},{currentWorkflowItem:this.getProjectWorkflowInfo(r)});return{id:r.id,type:"project",category:"Projects",title:(null===(t=r.projectNumber)||void 0===t?void 0:t.toString())||"No Project #",subtitle:s,description:r.address||r.projectName||r.name||"No address",fuseScore:e.score,matches:e.matches,data:a,navigationTarget:{page:"projects",projectId:r.id,project:(0,Y.A)((0,Y.A)({},a),{},{scrollToProjectId:String(r.id)})}}})}getProjectWorkflowInfo(e){try{if(e&&e.workflowState){return{section:e.workflowState.currentSectionName||e.workflowState.sectionDisplayName||e.workflowState.sectionName,lineItem:e.workflowState.currentLineItemName||e.workflowState.stepName||e.workflowState.lineItemName,phase:e.workflowState.currentPhase||e.workflowState.phaseName||e.workflowState.phase,stepId:e.workflowState.currentLineItem||e.workflowState.stepId,sectionId:e.workflowState.currentSection||e.workflowState.sectionId}}}catch(ES){}return{section:e.currentSection||e.section||e.sectionName||"Initial Inspection",lineItem:e.currentLineItem||e.stepName||e.lineItemName||"Review Site & Structure",phase:e.phase||e.currentPhase||e.phaseName||"LEAD",stepId:e.currentLineItemId||e.stepId,sectionId:e.currentSectionId||e.sectionId}}formatCustomerResults(e){return e.map(e=>{const t=e.item;return{id:t.id,type:"customer",category:"Customers",title:t.name||t.primaryName,subtitle:gS(t.phone||t.primaryPhone)||t.email||t.primaryEmail||"No contact info",description:"".concat(t.projects.length," project(s)"),fuseScore:e.score,matches:e.matches,data:t,navigationTarget:{page:"customers",customerId:t.id}}})}formatMessageResults(e){return e.map(e=>{const t=e.item,r=this.data.projects.find(e=>e.id===t.projectId||e._id===t.projectId);return{id:t.id,type:"message",category:"Messages",title:t.subject||"Message",subtitle:(null===r||void 0===r?void 0:r.projectNumber)||t.projectName||"Unknown Project",description:t.content||t.description||"",fuseScore:e.score,matches:e.matches,data:t,navigationTarget:{page:"project-messages",projectId:t.projectId,messageId:t.id,project:r}}})}}const bS=class{constructor(){this.initializeNLP()}initializeNLP(){this.entities={status:{completed:["completed","finished","done","complete","closed"],"in-progress":["in progress","ongoing","active","current","working","progress"],"not-started":["not started","pending","new","upcoming"],"on-hold":["on hold","paused","suspended","delayed","hold"]},phase:{LEAD:["lead","leads","prospect"],APPROVED:["approved","approval","contract","contracted"],EXECUTION:["execution","construction","building","work","installing"],COMPLETION:["completion","completed","finished","done"]},timeframe:{today:["today","this day"],"this-week":["this week","current week"],"last-week":["last week","past week","previous week"],"this-month":["this month","current month"],"last-month":["last month","past month","previous month"],"last-quarter":["last quarter","past quarter","previous quarter","past 3 months"],"last-year":["last year","past year","previous year"]},projectType:{roof:["roof","roofing","roofs","shingle","shingles"],repair:["repair","repairs","fix","maintenance"],replacement:["replacement","replace","new roof"],inspection:["inspection","inspect","assessment"]}},this.intentPatterns=[{pattern:/(?:show|find|list|get)\s+(?:me\s+)?(.+?)\s+projects?/i,intent:"search.projects"},{pattern:/(?:show|find|list|get)\s+(?:me\s+)?(completed|finished|done)\s+projects?/i,intent:"search.by.status"},{pattern:/(?:show|find|list|get)\s+(?:me\s+)?(in.progress|ongoing|active)\s+projects?/i,intent:"search.by.status"},{pattern:/(?:show|find|list|get)\s+(?:me\s+)?projects?\s+from\s+(.+)/i,intent:"search.by.timeframe"},{pattern:/(?:show|find|list|get)\s+(?:me\s+)?(lead|approved|execution|completion)\s+(?:phase\s+)?projects?/i,intent:"search.by.phase"},{pattern:/(?:find|show)\s+(?:me\s+)?customer\s+(.+)/i,intent:"search.customer"},{pattern:/(?:find|show)\s+(?:me\s+)?project\s+(.+)/i,intent:"search.project"},{pattern:/(completed|finished|done)\s+projects?/i,intent:"search.by.status"},{pattern:/(in.progress|ongoing|active)\s+projects?/i,intent:"search.by.status"},{pattern:/projects?\s+from\s+(.+)/i,intent:"search.by.timeframe"},{pattern:/(lead|approved|execution|completion)\s+projects?/i,intent:"search.by.phase"},{pattern:/(roof|roofing|repair|replacement)\s+projects?/i,intent:"search.by.type"}]}async process(e,t){const r=t.toLowerCase().trim();let n="None",s=[],a=.3;for(const o of this.intentPatterns){const e=r.match(o.pattern);if(e){n=o.intent,a=.8;const t=e[1]||e[0];s=this.extractEntities(t,r);break}}return"None"===n&&(s=this.extractEntities(r,r),s.length>0&&(n=this.determineIntentFromEntities(s),a=.6)),{intent:n,score:a,entities:s}}extractEntities(e,t){const r=[],n=e.toLowerCase();if(Object.keys(this.entities).forEach(e=>{Object.keys(this.entities[e]).forEach(t=>{const s=this.entities[e][t];for(const a of s)if(n.includes(a.toLowerCase()))return void r.push({entity:e,resolution:{value:t},sourceText:a,confidence:.9})})}),!r.some(e=>"customer"===e.entity||"project"===e.entity)){const e=n.split(/\s+/).filter(e=>e.length>2&&!this.isKnownKeyword(e)&&/^[a-zA-Z0-9]+$/.test(e));e.length>0&&r.push({entity:"searchText",resolution:{value:e.join(" ")},sourceText:e.join(" "),confidence:.7})}return r}isKnownKeyword(e){return["show","find","get","list","search","me","all","the","projects","project","customer","customers","from","by","with","and","or","in","on","at","to","for"].includes(e.toLowerCase())}determineIntentFromEntities(e){const t=e.map(e=>e.entity);return t.includes("status")?"search.by.status":t.includes("phase")?"search.by.phase":t.includes("timeframe")?"search.by.timeframe":t.includes("projectType")?"search.by.type":t.includes("searchText")?"search.general":"None"}isNaturalLanguageQuery(e){const t=["show","find","get","list","search","display","last","past","previous","this","current","today","yesterday","week","month","quarter","year","completed","finished","done","progress","ongoing","pending","active","hold","paused","lead","approved","execution","completion","roof","roofing","repair","replacement","inspection","what","which","who","when","where","how","from","with","all","projects","customers"],r=e.toLowerCase();if(r.split(/\s+/).length>=3){return t.some(e=>r.includes(e))}return[/show me.*projects/i,/find.*projects/i,/projects from/i,/completed.*projects/i,/.*last (week|month|quarter|year)/i,/.*this (week|month)/i].some(t=>t.test(e))}};const wS=class{constructor(){this.nlpManager=new bS,this.conventionalSearchService=new yS,this.isInitialized=!0}updateData(e){this.conventionalSearchService.updateData(e)}async search(e){try{const t=await this.nlpManager.process("en",e.toLowerCase()),r=t.intent,n=t.entities||[],s=t.score||0;if(s<.3)return console.log("\ud83d\udd0d Low NLP confidence, using conventional search"),this.conventionalSearchService.search(e);console.log("\ud83e\udd16 NLP Intent:",r,"Entities:",n,"Confidence:",s);const a=this.buildStructuredQuery(r,n,e);return this.executeStructuredSearch(a,e)}catch(t){return console.error("\ud83d\udea8 NLP search error, falling back to conventional search:",t),this.conventionalSearchService.search(e)}}buildStructuredQuery(e,t,r){const n={intent:e,filters:{},searchText:null,originalQuery:r,confidence:t.length>0?Math.max(...t.map(e=>e.confidence||.7)):.5};return t.forEach(e=>{switch(e.entity){case"status":n.filters.status=e.resolution.value;break;case"phase":n.filters.phase=e.resolution.value.toUpperCase();break;case"timeframe":n.filters.timeframe=e.resolution.value;break;case"projectType":n.filters.projectType=e.resolution.value;break;case"searchText":n.searchText=e.resolution.value;break;default:n.searchText||(n.searchText=e.sourceText)}}),n}async executeStructuredSearch(e,t){const{intent:r,filters:n,searchText:s}=e;try{const a=await fetch("/api/search/advanced",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intent:r,filters:n,searchText:s,originalQuery:t,entities:[],limit:50})});if(!a.ok)throw new Error("Search API error: ".concat(a.status));const o=await a.json();if(o.success&&o.data.results)return o.data.results.map(t=>(0,Y.A)((0,Y.A)({},t),{},{nlp:{intent:r,confidence:e.confidence||.8,isStructuredSearch:!0,apiSource:!0}}));throw new Error("Invalid API response")}catch(a){return console.error("\ud83d\udea8 API search failed, falling back to client-side:",a),this.executeClientSideSearch(e,t)}}executeClientSideSearch(e,t){const{intent:r,filters:n,searchText:s}=e;let a=[];const o=this.conventionalSearchService.data.projects||[],i=this.conventionalSearchService.data.customers||[];this.conventionalSearchService.data.messages;switch(r){case"search.by.status":a=this.filterProjectsByStatus(o,n.status);break;case"search.by.phase":a=this.filterProjectsByPhase(o,n.phase);break;case"search.by.timeframe":a=this.filterProjectsByTimeframe(o,n.timeframe);break;case"search.by.type":a=this.filterProjectsByType(o,n.projectType);break;case"search.customer":s&&(a=this.searchCustomers(i,s));break;case"search.project":s&&(a=this.searchProjects(o,s));break;default:a=this.conventionalSearchService.search(t)}return a.map(t=>(0,Y.A)((0,Y.A)({},t),{},{nlp:{intent:r,confidence:e.confidence,isStructuredSearch:!0,clientSideFallback:!0}}))}filterProjectsByStatus(e,t){const r=e.filter(e=>{const r=(e.status||"").toLowerCase();switch(t){case"completed":return r.includes("completed")||r.includes("finished")||r.includes("done");case"in-progress":return r.includes("progress")||r.includes("active")||r.includes("ongoing");case"not-started":return r.includes("not started")||r.includes("pending")||r.includes("new");case"on-hold":return r.includes("hold")||r.includes("paused")||r.includes("suspended");default:return!1}});return this.conventionalSearchService.formatProjectResults(r.map(e=>({item:e,score:.1})))}filterProjectsByPhase(e,t){const r=e.filter(e=>(e.phase||"").toUpperCase()===t);return this.conventionalSearchService.formatProjectResults(r.map(e=>({item:e,score:.1})))}filterProjectsByTimeframe(e,t){const r=new Date,n=e.filter(e=>{const n=new Date(e.createdAt||e.dateCreated||r);switch(t){case"today":return n.toDateString()===r.toDateString();case"this-week":return n>=new Date(r.setDate(r.getDate()-r.getDay()));case"last-week":const e=new Date(r.setDate(r.getDate()-r.getDay()-7)),t=new Date(r.setDate(r.getDate()-r.getDay()));return n>=e&&n<=t;case"this-month":return n.getMonth()===r.getMonth()&&n.getFullYear()===r.getFullYear();case"last-month":const s=new Date(r.getFullYear(),r.getMonth()-1,1),a=new Date(r.getFullYear(),r.getMonth(),0);return n>=s&&n<=a;case"last-quarter":return n>=new Date(r.getFullYear(),r.getMonth()-3,1);case"last-year":const o=new Date(r.getFullYear()-1,0,1),i=new Date(r.getFullYear()-1,11,31);return n>=o&&n<=i;default:return!1}});return this.conventionalSearchService.formatProjectResults(n.map(e=>({item:e,score:.1})))}filterProjectsByType(e,t){const r=e.filter(e=>(e.projectType||e.type||"").toLowerCase().includes(t));return this.conventionalSearchService.formatProjectResults(r.map(e=>({item:e,score:.1})))}searchCustomers(e,t){const r=e.filter(e=>{const r=(e.name||e.primaryName||"").toLowerCase(),n=(e.email||e.primaryEmail||"").toLowerCase(),s=(e.phone||e.primaryPhone||"").toLowerCase();return r.includes(t.toLowerCase())||n.includes(t.toLowerCase())||s.includes(t.toLowerCase())});return this.conventionalSearchService.formatCustomerResults(r.map(e=>({item:e,score:.1})))}searchProjects(e,t){const r=e.filter(e=>{const r=(e.projectNumber||"").toString().toLowerCase(),n=(e.name||e.projectName||"").toLowerCase(),s=(e.address||"").toLowerCase();return r.includes(t.toLowerCase())||n.includes(t.toLowerCase())||s.includes(t.toLowerCase())});return this.conventionalSearchService.formatProjectResults(r.map(e=>({item:e,score:.1})))}},jS=e=>{let{text:t,matches:r=[],query:n=""}=e;const s="string"===typeof t?t:null==t?"":String(t);if(!r||0===r.length||!s)return(0,kt.jsx)("span",{children:s});const a=r.filter(e=>e.value===s||"string"===typeof e.value&&e.value.includes(s));if(0===a.length){if(!n.trim())return(0,kt.jsx)("span",{children:s});const e=new RegExp(n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),t=s.split(e),r=s.match(e)||[];return(0,kt.jsx)("span",{children:t.map((e,t)=>(0,kt.jsxs)(o.Fragment,{children:[e,r[t]&&(0,kt.jsx)("strong",{className:"search-highlight",children:r[t]})]},t))})}const i=[];let l=0;return(a[0].indices||[]).forEach((e,t)=>{let[r,n]=e;r>l&&i.push((0,kt.jsx)("span",{children:s.substring(l,r)},"unmatched-".concat(t,"-pre"))),i.push((0,kt.jsx)("strong",{className:"search-highlight",children:s.substring(r,n+1)},"matched-".concat(t))),l=n+1}),l<s.length&&i.push((0,kt.jsx)("span",{children:s.substring(l)},"unmatched-post")),(0,kt.jsx)("span",{children:i})};function NS(e){let{projects:t=[],activities:r=[],handleCreateAlert:n,handleAddActivity:s,onNavigateToResult:a,colorMode:i=!1,className:l=""}=e;const[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)([]),[m,p]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1),[x,v]=(0,o.useState)([]),[y,b]=(0,o.useState)(!1),w=(0,o.useRef)(null),j=(0,o.useRef)(null),N=(0,o.useRef)(null),S=(0,o.useMemo)(()=>{const e=new yS;return e.updateData({projects:t,activities:r}),e},[t,r]),k=(0,o.useMemo)(()=>{const e=new wS;return e.updateData({projects:t,activities:r}),e},[t,r]);(0,o.useEffect)(()=>{const e=setTimeout(async()=>{if(c.length<1)return h([]),void p(!1);p(!0);try{let r,n=!1;try{var e;n="function"===typeof(null===k||void 0===k||null===(e=k.nlpManager)||void 0===e?void 0:e.isNaturalLanguageQuery)&&k.nlpManager.isNaturalLanguageQuery(c)}catch(t){console.warn("NL detection failed, falling back to conventional search:",t),n=!1}n?(console.log("\ud83e\udd16 Using NL search for:",c),r=await k.search(c)):(console.log("\ud83d\udd0d Using conventional search for:",c),r=S.search(c)),h(r)}catch(r){console.error("Search error:",r);const e=S.search(c);h(e)}p(!1)},150);return()=>clearTimeout(e)},[c,S,k]),(0,o.useEffect)(()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&f(!1)};document.addEventListener("mousedown",e);const t=e=>{(e.ctrlKey||e.metaKey)&&("k"===e.key||"K"===e.key)&&(e.preventDefault(),j.current&&(j.current.focus(),f(!0)))};return document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[]);const A=e=>{let{phase:t,size:r="md"}=e;const n=(e=>Bn.getPhaseButtonProps(e))(t),s="sm"===r?"w-8 h-8 text-xs":"w-10 h-10 text-sm";return(0,kt.jsx)("div",{className:"".concat(n.bgColor," ").concat(n.textColor," ").concat(s," rounded-full flex items-center justify-center font-bold shadow-sm border border-white/20"),title:n.fullName,children:n.initials})},C=(e,t)=>e.matches?e.matches.filter(e=>{const r="string"===typeof e.key?e.key:"";return r===t||r.endsWith(t)||r.includes(t)}):[],E=e=>{if(!e||"string"!==typeof e)return"Address not available";const t=e.split(",").map(e=>e.trim()).filter(Boolean);return 0===t.length?"Address not available":t.join(", ")},P=e=>{f(!1),d(""),a&&(e.navigationTarget||("Projects"===e.category?e.navigationTarget={page:"projects",project:e.data}:"Customers"===e.category?e.navigationTarget={page:"Profile",project:e.data}:e.navigationTarget={page:"projects"}),a(e))},I=(0,o.useMemo)(()=>{const e=u.reduce((e,t)=>{const r=t.category;return e[r]||(e[r]=[]),e[r].push(t),e},{});return Object.keys(e).forEach(t=>{e[t]=e[t].slice(0,10)}),e},[u]),T=e=>{switch(e){case"Projects":return(0,kt.jsx)("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})});case"Customers":return(0,kt.jsx)("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})});case"Messages":return(0,kt.jsx)("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})});default:return(0,kt.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}};return(0,kt.jsxs)("div",{className:"global-search-container ".concat(g?"search-active":""," ").concat(l),ref:w,children:[(0,kt.jsx)("div",{className:"search-icon-wrapper",children:(0,kt.jsx)("svg",{className:"search-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,kt.jsx)("input",{ref:j,type:"text",className:"global-search-input ".concat(i?"dark-mode":""),placeholder:"Search projects, customers, or alerts...",value:c,onChange:e=>d(e.target.value),onKeyDown:e=>{"Escape"!==e.key?"Enter"===e.key&&u&&u.length>0&&P(u[0]):f(!1)},onFocus:()=>{f(!0),(()=>{const e=[];for(let t=0;t<6;t++){const r={id:Date.now()+t,size:10*Math.random()+5,left:40*Math.random()-20,delay:.5*Math.random()};e.push(r)}v(e),b(!0),setTimeout(()=>{v([]),b(!1)},1500)})()}}),x.length>0&&(0,kt.jsx)("div",{className:"bubbles-container",children:x.map(e=>(0,kt.jsx)("div",{className:"bubble",style:{width:"".concat(e.size,"px"),height:"".concat(e.size,"px"),left:"".concat(e.left,"px"),animationDelay:"".concat(e.delay,"s")}},e.id))}),y&&(0,kt.jsx)("div",{className:"ripple-effect"}),c&&(0,kt.jsx)("button",{className:"search-clear-btn",onClick:()=>d(""),type:"button",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),g&&c.length>0&&(0,kt.jsxs)("div",{ref:N,className:"search-results-dropdown-simple ".concat(i?"bg-[#1e293b] border-gray-600":""),children:[m&&(0,kt.jsx)("div",{className:"search-result-item-message",children:"Loading..."}),!m&&0===Object.keys(I).length&&(0,kt.jsxs)("div",{className:"search-result-item-message",children:['No results found for "',c,'"']}),!m&&Object.entries(I).map(e=>{let[t,r]=e;return(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"px-4 py-2 border-b sticky top-0 z-10 ".concat(i?"bg-[#232b4d] border-gray-600 text-gray-300":"bg-gray-50 border-gray-200 text-gray-700"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[T(t),(0,kt.jsxs)("span",{className:"text-xs font-semibold uppercase tracking-wide",children:[t," (",r.length,")"]})]})}),r.map((e,r)=>{var n,s,o,l,d,u;return(0,kt.jsxs)("div",{className:"search-result-item-simplified border-b border-gray-100 p-4 cursor-pointer ".concat(i?"border-gray-600 hover:bg-gray-700/50":"hover:bg-gray-50"),onClick:()=>P(e),children:["Projects"===t&&(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"customer-contact-section",children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(i?"text-gray-200":"text-gray-800"),children:(0,kt.jsx)(jS,{text:(null===(n=e.data.customer)||void 0===n?void 0:n.primaryName)||e.data.clientName||e.subtitle||"Unknown Customer",matches:C(e,"client"),query:c})}),(0,kt.jsxs)("div",{className:"text-xs flex gap-4 mt-1 ".concat(i?"text-gray-400":"text-gray-600"),children:[(null===(s=e.data.customer)||void 0===s?void 0:s.primaryPhone)&&(0,kt.jsxs)("span",{children:["\ud83d\udcde ",e.data.customer.primaryPhone]}),(null===(o=e.data.customer)||void 0===o?void 0:o.primaryEmail)&&(0,kt.jsxs)("span",{children:["\u2709\ufe0f ",e.data.customer.primaryEmail]})]})]}),(0,kt.jsxs)("div",{className:"project-info-section",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,kt.jsx)(A,{phase:e.data.phase,size:"sm"}),(0,kt.jsxs)("div",{className:"text-sm ".concat(i?"text-gray-300":"text-gray-700"," flex items-center gap-2"),children:[(0,kt.jsxs)("button",{className:"font-semibold hover:underline ".concat(i?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"),onClick:t=>{t.stopPropagation(),a&&a((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Project Profile",project:e.data}}))},title:"View Project Profile",children:["#",String(e.data.projectNumber||e.data.id||"00000").padStart(5,"0")]}),(0,kt.jsx)("span",{className:"".concat(i?"text-gray-500":"text-gray-400"),children:"\u2022"}),(0,kt.jsx)(jS,{text:e.data.projectName||e.title||"Unnamed Project",matches:C(e,"name"),query:c})]})]}),(0,kt.jsxs)("div",{className:"text-xs space-y-1 ".concat(i?"text-gray-400":"text-gray-600"),children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("strong",{children:"Phase:"})," ",e.data.phase||"Unknown"]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("strong",{children:"Section:"})," ",(null===(l=e.data.currentWorkflowItem)||void 0===l?void 0:l.section)||"Not Available"]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("strong",{children:"Line Item:"}),null!==(d=e.data.currentWorkflowItem)&&void 0!==d&&d.lineItem?(0,kt.jsx)("button",{className:"ml-1 hover:underline ".concat(i?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"),onClick:async t=>{if(t.stopPropagation(),a&&e.data.currentWorkflowItem)try{console.log("\ud83c\udfaf SEARCH LINE ITEM: Starting navigation to line item in workflow"),console.log("\ud83c\udfaf SEARCH LINE ITEM: Project:",e.data.projectName),console.log("\ud83c\udfaf SEARCH LINE ITEM: Line Item:",e.data.currentWorkflowItem.lineItem),console.log("\ud83c\udfaf SEARCH LINE ITEM: Section:",e.data.currentWorkflowItem.section),console.log("\ud83c\udfaf SEARCH LINE ITEM: Phase:",e.data.phase);const t=e.data.phase||"LEAD",r=e.data.currentWorkflowItem.section||"Unknown Section",n=e.data.currentWorkflowItem.lineItem||"Unknown Item",s=await fetch("/api/workflow-data/project-position/".concat(e.data.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(s.ok){const o=await s.json();if(o.success&&o.data){const s=o.data;console.log("\ud83c\udfaf SEARCH LINE ITEM: Project position data:",s);const i=s.currentLineItemId||s.currentLineItem||"".concat(t,"-").concat(r,"-0"),l=s.currentSectionId||s.currentSection||r.toLowerCase().replace(/\s+/g,"-");console.log("\ud83c\udfaf SEARCH LINE ITEM: Target IDs:",{targetLineItemId:i,targetSectionId:l}),a((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Project Workflow",project:(0,Y.A)((0,Y.A)({},e.data),{},{highlightStep:n,highlightLineItem:n,targetPhase:t,targetSection:r,targetLineItem:n,scrollToCurrentLineItem:!0,navigationTarget:{phase:t,section:r,lineItem:n,stepName:n,lineItemId:i,workflowId:s.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(i),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:l,expandPhase:!0,expandSection:!0,autoOpen:!0}}),targetLineItemId:i,targetSectionId:l}}))}else{console.error("\ud83c\udfaf SEARCH LINE ITEM: Position response not successful, using fallback");const s="".concat(t,"-").concat(r,"-0"),o=r.toLowerCase().replace(/\s+/g,"-");a((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Project Workflow",project:(0,Y.A)((0,Y.A)({},e.data),{},{highlightStep:n,highlightLineItem:n,targetPhase:t,targetSection:r,targetLineItem:n,scrollToCurrentLineItem:!0,navigationTarget:{phase:t,section:r,lineItem:n,stepName:n,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(s),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:o,expandPhase:!0,expandSection:!0,autoOpen:!0}}),targetLineItemId:s,targetSectionId:o}}))}}else{console.error("\ud83c\udfaf SEARCH LINE ITEM: Failed to get project position, using fallback");const s="".concat(t,"-").concat(r,"-0"),o=r.toLowerCase().replace(/\s+/g,"-");a((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Project Workflow",project:(0,Y.A)((0,Y.A)({},e.data),{},{highlightStep:n,highlightLineItem:n,targetPhase:t,targetSection:r,targetLineItem:n,scrollToCurrentLineItem:!0,navigationTarget:{phase:t,section:r,lineItem:n,stepName:n,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(s),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:o,expandPhase:!0,expandSection:!0,autoOpen:!0}}),targetLineItemId:s,targetSectionId:o}}))}}catch(r){console.error("\ud83c\udfaf SEARCH LINE ITEM: Error in navigation:",r),a((0,Y.A)((0,Y.A)({},e),{},{page:"Project Workflow"}))}},title:"Navigate to Line Item in Workflow",children:e.data.currentWorkflowItem.lineItem}):(0,kt.jsx)("span",{className:"ml-1",children:"Not Available"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("strong",{children:"Address:"})," ",E((u=e.data,u&&(u.address||u.customer&&u.customer.address||u.client&&u.client.address)||""))]})]})]})]}),"Customers"===t&&(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(i?"text-gray-200":"text-gray-800"),children:(0,kt.jsx)(jS,{text:e.title,matches:C(e,"name"),query:c})}),(0,kt.jsxs)("div",{className:"text-xs flex gap-4 ".concat(i?"text-gray-400":"text-gray-600"),children:[e.data.phone&&(0,kt.jsxs)("span",{children:["\ud83d\udcde ",e.data.phone]}),e.data.email&&(0,kt.jsxs)("span",{children:["\u2709\ufe0f ",e.data.email]})]}),(0,kt.jsxs)("div",{className:"text-xs ".concat(i?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("strong",{children:"Address:"})," ",E(e.data.address)]}),e.data.projectId&&(0,kt.jsx)("div",{children:(0,kt.jsx)("button",{className:"text-xs hover:underline ".concat(i?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"),onClick:t=>{t.stopPropagation(),a&&a((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Profile",project:{id:e.data.projectId}}}))},title:"View Customer's Project",children:"View Project \u2192"})})]}),"Messages"===t&&(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("div",{className:"text-sm ".concat(i?"text-gray-200":"text-gray-800"),children:(0,kt.jsx)(jS,{text:e.title,matches:C(e,"subject"),query:c})}),(0,kt.jsx)("div",{className:"text-xs ".concat(i?"text-gray-400":"text-gray-600"),children:(0,kt.jsx)(jS,{text:e.subtitle||e.description,matches:C(e,"content"),query:c})})]})]},"".concat(t,"-").concat(r))})]},t)})]})]})}const SS=e=>{let{isOpen:t,onClose:n,onProjectCreated:s}=e;const[a,i]=(0,o.useState)({customerName:"",customerEmail:"",customerPhones:[{number:"",type:"MOBILE",isPrimary:!0}],customerTypeOfContact:"PRIMARY_CONTACT",secondaryName:"",secondaryEmail:"",secondaryPhones:[{number:"",type:"MOBILE",isPrimary:!0}],secondaryTypeOfContact:"SECONDARY_CONTACT",primaryContact:"PRIMARY",address:"",projectTypes:[],description:"",startingPhase:"LEAD",projectManagerId:"",leadSourceId:"",subcontractorIds:[]}),[l,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)(1),[h,m]=(0,o.useState)({}),[p,g]=(0,o.useState)([]),[f,x]=(0,o.useState)(!0),[v,y]=(0,o.useState)([]),[b,w]=(0,o.useState)([]),[j,N]=(0,o.useState)(!1),[S,k]=(0,o.useState)(!1),[A,C]=(0,o.useState)(!1),[E,P]=(0,o.useState)([]),I=[{value:"MOBILE",label:"Mobile"},{value:"HOME",label:"Home"},{value:"WORK",label:"Work"}],T=(e,t,r,n)=>{const s="primary"===e?"customerPhones":"secondaryPhones";i(e=>(0,Y.A)((0,Y.A)({},e),{},{[s]:e[s].map((e,s)=>s===t?(0,Y.A)((0,Y.A)({},e),{},{[r]:n}):e)}))},D=()=>((0,o.useEffect)(()=>{const e=setTimeout(()=>{C(!1)},5e3);return()=>clearTimeout(e)},[]),(0,kt.jsx)("div",{className:"fixed top-4 right-4 z-[99999] animate-in slide-in-from-right duration-300",children:(0,kt.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg shadow-lg p-4 max-w-sm",children:(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-green-800",children:"Project Created Successfully!"}),(0,kt.jsx)("p",{className:"text-sm text-green-700 mt-1",children:"Your new project has been added to the system and is ready for management."})]}),(0,kt.jsx)("button",{onClick:()=>C(!1),className:"flex-shrink-0 text-green-400 hover:text-green-600 transition-colors",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})),M=e=>{let{requirements:t}=e;return 0===t.length?null:(0,kt.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4",children:(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("div",{className:"w-6 h-6 bg-amber-100 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-amber-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-amber-800 mb-2",children:"Complete the following to continue:"}),(0,kt.jsx)("ul",{className:"space-y-1",children:t.map((e,t)=>(0,kt.jsxs)("li",{className:"flex items-center gap-2 text-sm text-amber-700",children:[(0,kt.jsx)("svg",{className:"w-4 h-4 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e]},t))})]})]})})},_=e=>{let{customerType:t,phones:r,errors:n={}}=e;return(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Phone Numbers"}),r.map((e,n)=>(0,kt.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,kt.jsx)("div",{className:"flex-1",children:(0,kt.jsx)("input",{type:"tel",value:e.number,onChange:e=>{const r=F(e.target.value);T(t,n,"number",r)},className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300 text-sm ".concat(e.isPrimary?"border-blue-300 bg-blue-50":"border-gray-200"),placeholder:"(865) 555-1212"})}),(0,kt.jsx)("div",{className:"w-24",children:(0,kt.jsx)("select",{value:e.type,onChange:e=>T(t,n,"type",e.target.value),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300 text-sm ".concat(e.isPrimary?"border-blue-300 bg-blue-50":"border-gray-200"),children:I.map(e=>(0,kt.jsx)("option",{value:e.value,children:e.label},e.value))})}),r.length>1&&(0,kt.jsxs)("div",{className:"flex gap-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>((e,t)=>{const r="primary"===e?"customerPhones":"secondaryPhones";i(e=>(0,Y.A)((0,Y.A)({},e),{},{[r]:e[r].map((e,r)=>(0,Y.A)((0,Y.A)({},e),{},{isPrimary:r===t}))}))})(t,n),className:"p-2 rounded-lg transition-colors ".concat(e.isPrimary?"bg-blue-100 text-blue-700 border border-blue-300":"text-gray-500 hover:text-blue-600 hover:bg-blue-50 border border-gray-200"),title:e.isPrimary?"Primary phone":"Set as primary phone",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,kt.jsx)("button",{type:"button",onClick:()=>((e,t)=>{const r="primary"===e?"customerPhones":"secondaryPhones";i(e=>(0,Y.A)((0,Y.A)({},e),{},{[r]:e[r].filter((e,r)=>r!==t)}))})(t,n),className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Remove phone number",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},n)),(0,kt.jsxs)("button",{type:"button",onClick:()=>(e=>{const t="primary"===e?"customerPhones":"secondaryPhones";i(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:[...e[t],{number:"",type:"MOBILE",isPrimary:!1}]}))})(t),className:"w-full p-2 border border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-all duration-200 flex items-center justify-center gap-2 text-sm",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Phone Number"]})]})},O=[{value:"ROOFING",label:"Roofing",icon:"\ud83c\udfe0",description:"Roof installation and repair"},{value:"GUTTERS",label:"Gutters",icon:"\ud83c\udf27\ufe0f",description:"Gutter installation and maintenance"},{value:"INTERIOR_PAINT",label:"Interior Paint",icon:"\ud83c\udfa8",description:"Interior painting services"},{value:"FENCE",label:"Fence",icon:"\ud83d\udd32",description:"Fence installation and repair"},{value:"WATER_LEAK",label:"Water Leak",icon:"\ud83d\udca7",description:"Water leak detection and repair"},{value:"MOLD",label:"Mold",icon:"\ud83e\udda0",description:"Mold remediation and prevention"},{value:"WINDOWS",label:"Windows",icon:"\ud83e\ude9f",description:"Window installation and replacement"},{value:"SIDING",label:"Siding",icon:"\ud83c\udfd8\ufe0f",description:"Siding installation and repair"},{value:"DECKS",label:"Decks",icon:"\ud83c\udfd7\ufe0f",description:"Deck construction and repair"},{value:"REPAIR_EXTERIOR",label:"Repair - Exterior",icon:"\ud83d\udd27",description:"Exterior repairs and maintenance"},{value:"REPAIR_INTERIOR",label:"Repair - Interior",icon:"\ud83d\udee0\ufe0f",description:"Interior repairs and maintenance"}],L=[{value:"LEAD",label:"Lead",description:"Initial lead capture and qualification",icon:"\ud83d\udccb"},{value:"PROSPECT",label:"Prospect",description:"Prospect development and estimation",icon:"\ud83d\udd0d"},{value:"APPROVED",label:"Approved",description:"Approved projects ready for execution",icon:"\u2705"},{value:"EXECUTION",label:"Execution",description:"Active project execution",icon:"\ud83d\udea7"},{value:"SECOND_SUPPLEMENT",label:"2nd Supplement",description:"Supplemental estimates and approvals",icon:"\ud83d\udcdd"},{value:"COMPLETION",label:"Completion",description:"Financial processing and project closeout",icon:"\ud83c\udf89"}],R=[{id:1,title:"Customer Information",description:"Primary and secondary customer details"},{id:2,title:"Project Details",description:"Project type and configuration"},{id:3,title:"Review & Create",description:"Final review and submission"}];(0,o.useEffect)(()=>{t?(async()=>{try{var e;const{usersService:n}=await Promise.resolve().then(r.bind(r,505)),s=await n.getTeamMembers(),a=Array.isArray(null===s||void 0===s||null===(e=s.data)||void 0===e?void 0:e.teamMembers)?s.data.teamMembers:[];g(a);try{const e=localStorage.getItem("authToken")||localStorage.getItem("token"),t=await fetch("".concat(Ds.API_BASE_URL,"/roles"),{method:"GET",headers:(0,Y.A)({"Content-Type":"application/json"},e&&{Authorization:"Bearer ".concat(e)})});if(t.ok){const e=await t.json();if(e.success&&e.data){const t=[];if(e.data.projectManager)if(Array.isArray(e.data.projectManager))t.push(...e.data.projectManager);else if(e.data.projectManager.userId){const r=a.find(t=>t.id===e.data.projectManager.userId);r&&t.push(r)}if(e.data.productManager&&e.data.productManager.userId){const r=a.find(t=>t.id===e.data.productManager.userId);r&&!t.find(e=>e.id===r.id)&&t.push(r)}y(t);const r=[];if(e.data.subcontractor)if(Array.isArray(e.data.subcontractor))r.push(...e.data.subcontractor);else if(e.data.subcontractor.userId){const t=a.find(t=>t.id===e.data.subcontractor.userId);t&&r.push(t)}w(r)}}}catch(t){console.error("Error fetching role assignments:",t),y([]),w([])}}catch(n){console.error("Error fetching users:",n)}finally{x(!1)}})():(z(),N(!1),k(!1))},[t]);const F=e=>{if(!e)return e;const t=e.replace(/[^\d]/g,"");return 0===t.length?"":t.length<4?t:t.length<7?"(".concat(t.slice(0,3),") ").concat(t.slice(3)):"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6,10))},U=e=>{const{name:t,value:r}=e.target;i(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:r})),h[t]&&m(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:""}))},B=e=>{const t={},r=[];if(1===e){a.customerName.trim()||(t.customerName="Primary customer name is required",r.push("Enter primary customer name")),a.customerEmail.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.customerEmail)||(t.customerEmail="Please enter a valid email address",r.push("Enter a valid email address")):(t.customerEmail="Primary customer email is required",r.push("Enter primary customer email")),a.address.trim()||(t.address="Project address is required",r.push("Enter project address"));(a.secondaryName||a.secondaryEmail||a.secondaryPhones.some(e=>e.number.trim()))&&(a.secondaryName.trim()||(t.secondaryName="Secondary customer name is required when secondary info is provided",r.push("Enter secondary customer name")),a.secondaryEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.secondaryEmail)&&(t.secondaryEmail="Please enter a valid secondary email address",r.push("Enter a valid secondary email address")))}return 2===e&&(0===a.projectTypes.length&&(t.projectTypes="Please select at least one trade type",r.push("Select at least one trade type")),a.projectManagerId||(t.projectManagerId="Please select a project manager",r.push("Select a project manager"))),m(t),P(r),0===Object.keys(t).length},W=async e=>{if(e.preventDefault(),B(d)){c(!0);try{var t;const e={primaryName:a.customerName.trim(),primaryEmail:a.customerEmail.trim(),primaryPhone:null!==(t=a.customerPhones[0])&&void 0!==t&&t.number?a.customerPhones[0].number.trim():"555-555-5555",primaryContact:a.primaryContact,address:a.address.trim()};a.customerPhones.length>0&&(e.primaryPhones=a.customerPhones.filter(e=>e.number.trim()).map(e=>({number:e.number.trim(),type:e.type,isPrimary:e.isPrimary}))),a.secondaryName&&a.secondaryName.trim()&&(e.secondaryName=a.secondaryName.trim()),a.secondaryEmail&&a.secondaryEmail.trim()&&(e.secondaryEmail=a.secondaryEmail.trim()),a.secondaryPhones.length>0&&(e.secondaryPhones=a.secondaryPhones.filter(e=>e.number.trim()).map(e=>({number:e.number.trim(),type:e.type,isPrimary:e.isPrimary}))),console.log("\ud83d\udd0d Sending customer data:",e);const o=await Ds.default.post("/customers",e);if(!o.data.success){const e=o.data.errors?Object.values(o.data.errors).join(", "):o.data.message||"Failed to create customer";throw new Error(e)}const i=o.data.data.id,l=(a.address,{projectName:a.address||"New Project",projectType:a.projectTypes[0],additionalTrades:a.projectTypes.slice(1),tradeTypes:a.projectTypes,description:a.description,budget:1e3,customerId:i,projectManagerId:a.projectManagerId,startDate:(new Date).toISOString(),endDate:new Date(Date.now()+7776e6).toISOString(),startingPhase:a.startingPhase,leadSourceId:a.leadSourceId||void 0}),c=await Ds.default.post("/projects",l);if(!c.data.success)throw new Error(c.data.message||"Failed to create project");if(console.log("\u2705 Project created successfully with trades:",a.projectTypes),a.subcontractorIds.length>0&&c.data.data.id)try{for(const e of a.subcontractorIds)await Ds.default.post("/projects/".concat(c.data.data.id,"/team-members"),{userId:e,role:"SUBCONTRACTOR"});console.log("\u2705 Subcontractors added to project")}catch(r){console.error("Error adding subcontractors to project:",r)}s&&s(c.data.data),C(!0),z(),n()}catch(o){if(console.error("Error creating project:",o),o.response&&o.response.data){console.error("Server validation error:",o.response.data);const e=o.response.data;let t=e.message||"Failed to create customer";e.errors&&(t=Object.entries(e.errors).map(e=>{let[t,r]=e;return"".concat(t,": ").concat(r)}).join("\n")),alert("Error creating project:\n"+t)}else alert("Error creating project: "+o.message)}finally{c(!1)}}},z=()=>{i({customerName:"",customerEmail:"",customerPhones:[{number:"",type:"MOBILE",isPrimary:!0}],customerTypeOfContact:"PRIMARY_CONTACT",secondaryName:"",secondaryEmail:"",secondaryPhones:[{number:"",type:"MOBILE",isPrimary:!0}],secondaryTypeOfContact:"SECONDARY_CONTACT",primaryContact:"PRIMARY",address:"",projectTypes:[],description:"",startingPhase:"LEAD",projectManagerId:"",leadSourceId:"",subcontractorIds:[]}),u(1),m({})};return t?(0,kt.jsxs)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[99999] p-4",children:[(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col animate-fade-in",children:[(0,kt.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-3 flex-shrink-0",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-lg font-bold",children:"Create New Project"}),(0,kt.jsx)("p",{className:"text-blue-100 mt-0.5 text-sm",children:"Add a new project to your portfolio"})]}),(0,kt.jsx)("button",{onClick:()=>{z(),n()},className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsx)("div",{className:"flex items-center justify-center mt-3",children:R.map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all duration-300 ".concat(d>=e.id?"bg-white text-blue-600 border-white":"border-white/30 text-white/30"),children:d>e.id?(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):(0,kt.jsx)("span",{className:"font-semibold text-sm",children:e.id})}),t<R.length-1&&(0,kt.jsx)("div",{className:"w-12 h-0.5 mx-2 transition-all duration-300 ".concat(d>e.id?"bg-white":"bg-white/30")})]},e.id))})]}),(0,kt.jsx)("div",{className:"p-3 flex-1 overflow-y-auto modal-content",children:(0,kt.jsxs)("form",{onSubmit:W,children:[1===d&&(0,kt.jsxs)("div",{className:"space-y-3 animate-slide-up",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Customer Information"}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Enter primary and secondary customer details"})]}),(0,kt.jsx)(M,{requirements:E}),(0,kt.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3",children:[(0,kt.jsxs)("h4",{className:"text-base font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),"Primary Customer"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:["Name ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"text",name:"customerName",value:a.customerName,onChange:U,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 text-sm ".concat(h.customerName?"border-red-300 bg-red-50":"border-gray-200 hover:border-gray-300"),placeholder:"Primary customer full name"}),h.customerName&&(0,kt.jsxs)("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.customerName]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:["Email ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"email",name:"customerEmail",value:a.customerEmail,onChange:U,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 text-sm ".concat(h.customerEmail?"border-red-300 bg-red-50":"border-gray-200 hover:border-gray-300"),placeholder:"primary@email.com"}),h.customerEmail&&(0,kt.jsxs)("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.customerEmail]})]}),(0,kt.jsx)("div",{children:(0,kt.jsx)(_,{customerType:"primary",phones:a.customerPhones,errors:h})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Type of Contact"}),(0,kt.jsxs)("select",{name:"customerTypeOfContact",value:a.customerTypeOfContact,onChange:U,className:"w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300 text-sm",children:[(0,kt.jsx)("option",{value:"PRIMARY_CONTACT",children:"Primary Contact"}),(0,kt.jsx)("option",{value:"SECONDARY_CONTACT",children:"Secondary Contact"}),(0,kt.jsx)("option",{value:"TENANT",children:"Tenant"}),(0,kt.jsx)("option",{value:"PROPERTY_MANAGER",children:"Property Manager Contact"}),(0,kt.jsx)("option",{value:"GENERAL_CONTRACTOR",children:"General Contractor"})]})]}),(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsxs)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:["Project Address ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)(Si,{name:"address",value:a.address,onChange:U,placeholder:"Full project address",className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 text-sm ".concat(h.address?"border-red-300 bg-red-50":"border-gray-200 hover:border-gray-300"),required:!0}),h.address&&(0,kt.jsxs)("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.address]})]})]})]}),j?(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("h4",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})}),"Secondary Customer"]}),(0,kt.jsx)("button",{type:"button",onClick:()=>{N(!1),i(e=>(0,Y.A)((0,Y.A)({},e),{},{secondaryName:"",secondaryEmail:"",secondaryPhones:[{number:"",type:"MOBILE",isPrimary:!0}],secondaryTypeOfContact:"SECONDARY_CONTACT"}))},className:"text-gray-400 hover:text-red-500 transition-colors",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Name"}),(0,kt.jsx)("input",{type:"text",name:"secondaryName",value:a.secondaryName,onChange:U,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 text-sm ".concat(h.secondaryName?"border-red-300 bg-red-50":"border-gray-200 hover:border-gray-300"),placeholder:"Secondary customer name"}),h.secondaryName&&(0,kt.jsxs)("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.secondaryName]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Email"}),(0,kt.jsx)("input",{type:"email",name:"secondaryEmail",value:a.secondaryEmail,onChange:U,className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 text-sm ".concat(h.secondaryEmail?"border-red-300 bg-red-50":"border-gray-200 hover:border-gray-300"),placeholder:"secondary@email.com"}),h.secondaryEmail&&(0,kt.jsxs)("p",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.secondaryEmail]})]}),(0,kt.jsx)("div",{children:(0,kt.jsx)(_,{customerType:"secondary",phones:a.secondaryPhones,errors:h})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Type of Contact"}),(0,kt.jsxs)("select",{name:"secondaryTypeOfContact",value:a.secondaryTypeOfContact,onChange:U,className:"w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300 text-sm",children:[(0,kt.jsx)("option",{value:"PRIMARY_CONTACT",children:"Primary Contact"}),(0,kt.jsx)("option",{value:"SECONDARY_CONTACT",children:"Secondary Contact"}),(0,kt.jsx)("option",{value:"TENANT",children:"Tenant"}),(0,kt.jsx)("option",{value:"PROPERTY_MANAGER",children:"Property Manager Contact"}),(0,kt.jsx)("option",{value:"GENERAL_CONTRACTOR",children:"General Contractor"})]})]}),!j&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Primary Contact"}),(0,kt.jsxs)("select",{name:"primaryContact",value:a.primaryContact,onChange:U,className:"w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300 text-sm",children:[(0,kt.jsx)("option",{value:"PRIMARY",children:"Primary Customer"}),(0,kt.jsx)("option",{value:"SECONDARY",children:"Secondary Customer"})]})]})]})]}):(0,kt.jsx)("div",{children:(0,kt.jsxs)("button",{type:"button",onClick:()=>N(!0),className:"w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-all duration-200 flex items-center justify-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Secondary Customer"]})})]}),2===d&&(0,kt.jsxs)("div",{className:"space-y-3 animate-slide-up",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Project Configuration"}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Select project type and starting phase"})]}),(0,kt.jsx)(M,{requirements:E}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-semibold text-gray-700 mb-2",children:["Trade Types ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:O.map(e=>(0,kt.jsxs)("label",{className:"relative p-2 border rounded-lg cursor-pointer transition-all duration-200 group ".concat(a.projectTypes.includes(e.value)?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"," ").concat(h.projectTypes?"border-red-300 bg-red-50":""),children:[(0,kt.jsx)("input",{type:"checkbox",checked:a.projectTypes.includes(e.value),onChange:()=>{return t=e.value,i(e=>(0,Y.A)((0,Y.A)({},e),{},{projectTypes:e.projectTypes.includes(t)?e.projectTypes.filter(e=>e!==t):[...e.projectTypes,t]})),void(h.projectTypes&&m(e=>(0,Y.A)((0,Y.A)({},e),{},{projectTypes:""})));var t},className:"sr-only"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-6 h-6 rounded flex items-center justify-center text-sm transition-all duration-200 ".concat(a.projectTypes.includes(e.value)?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:e.icon}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900",children:e.label}),(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]}),a.projectTypes.includes(e.value)&&(0,kt.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},e.value))}),h.projectTypes&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.projectTypes]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:["Starting Phase ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Select the phase to start the project. All previous phases will be automatically marked as completed."}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:L.map(e=>(0,kt.jsxs)("label",{className:"relative p-4 border-2 rounded-xl cursor-pointer transition-all duration-200 group ".concat(a.startingPhase===e.value?"border-green-500 bg-green-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"),children:[(0,kt.jsx)("input",{type:"radio",name:"startingPhase",value:e.value,checked:a.startingPhase===e.value,onChange:()=>(e=>{i(t=>(0,Y.A)((0,Y.A)({},t),{},{startingPhase:e}))})(e.value),className:"sr-only"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg transition-all duration-200 ".concat(a.startingPhase===e.value?"bg-green-500 text-white":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:e.icon}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900",children:e.label}),(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]}),a.startingPhase===e.value&&(0,kt.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},e.value))})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Project Manager ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{name:"projectManagerId",value:a.projectManagerId,onChange:U,className:"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300",disabled:f,children:[(0,kt.jsx)("option",{value:"",children:"Select a project manager"}),v.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),f&&(0,kt.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Loading project managers..."}),!f&&0===v.length&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-amber-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"No project managers assigned in Settings \u2192 Roles"]}),h.projectManagerId&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.projectManagerId]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Lead Source"}),(0,kt.jsxs)("select",{name:"leadSourceId",value:a.leadSourceId,onChange:U,className:"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300",children:[(0,kt.jsx)("option",{value:"",children:"Select a lead source (optional)"}),["Website","Google Maps","Social Media","Word of Mouth"].map((e,t)=>(0,kt.jsx)("option",{value:e,children:e},t))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Subcontractors (Optional)"}),(0,kt.jsx)("div",{className:"border-2 border-gray-200 rounded-xl p-4 max-h-48 overflow-y-auto",children:b.length>0?b.map(e=>(0,kt.jsxs)("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:a.subcontractorIds.includes(e.id),onChange:t=>{const r=t.target.checked?[...a.subcontractorIds,e.id]:a.subcontractorIds.filter(t=>t!==e.id);i((0,Y.A)((0,Y.A)({},a),{},{subcontractorIds:r}))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,kt.jsxs)("span",{className:"text-sm text-gray-700",children:[e.firstName," ",e.lastName]})]},e.id)):(0,kt.jsx)("p",{className:"text-sm text-gray-500 text-center py-2",children:"No subcontractors assigned in Settings \u2192 Roles"})}),a.subcontractorIds.length>0&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[a.subcontractorIds.length," subcontractor",a.subcontractorIds.length>1?"s":""," selected"]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Project Description"}),(0,kt.jsx)("textarea",{name:"description",value:a.description,onChange:U,rows:3,className:"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300 resize-none",placeholder:"Describe the project scope, special requirements, or additional notes..."})]})]}),3===d&&(0,kt.jsxs)("div",{className:"space-y-3 animate-slide-up",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Review Project Details"}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Please review all information before creating the project"})]}),(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-semibold text-sm text-gray-900 mb-2",children:"Customer Information"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:"Primary Customer:"}),(0,kt.jsx)("p",{className:"font-medium text-sm",children:a.customerName||"Not specified"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Primary Email:"}),(0,kt.jsx)("p",{className:"font-medium",children:a.customerEmail||"Not specified"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Primary Phone:"}),(0,kt.jsx)("p",{className:"font-medium",children:a.customerPhone||"Not specified"})]}),a.secondaryName&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Secondary Customer:"}),(0,kt.jsx)("p",{className:"font-medium",children:a.secondaryName})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Secondary Email:"}),(0,kt.jsx)("p",{className:"font-medium",children:a.secondaryEmail||"Not specified"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Secondary Phone:"}),(0,kt.jsx)("p",{className:"font-medium",children:a.secondaryPhone||"Not specified"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Primary Contact:"}),(0,kt.jsx)("p",{className:"font-medium",children:"PRIMARY"===a.primaryContact?"Primary Customer":"Secondary Customer"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Project Address:"}),(0,kt.jsx)("p",{className:"font-medium",children:a.address||"Not specified"})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-semibold text-sm text-gray-900 mb-2",children:"Project Configuration"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Project Name:"}),(0,kt.jsx)("p",{className:"font-medium",children:a.address||"Auto-generated from address"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Trade Types:"}),(0,kt.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:a.projectTypes.map(e=>{const t=O.find(t=>t.value===e);return(0,kt.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[null===t||void 0===t?void 0:t.icon," ",null===t||void 0===t?void 0:t.label]},e)})})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Starting Phase:"}),(0,kt.jsx)("div",{className:"flex items-center gap-1 mt-1",children:(()=>{const e=L.find(e=>e.value===a.startingPhase);return(0,kt.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 rounded-lg text-sm",children:[null===e||void 0===e?void 0:e.icon," ",null===e||void 0===e?void 0:e.label]})})()})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Project Manager:"}),(0,kt.jsx)("p",{className:"font-medium",children:a.projectManagerId?(()=>{const e=[...v,...p].find(e=>e.id===a.projectManagerId);return e?"".concat(e.firstName," ").concat(e.lastName):"Not found"})():"Not assigned"})]})]})]})]}),a.description&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Description:"}),(0,kt.jsx)("p",{className:"mt-1 text-gray-900",children:a.description})]})]})]})]})}),(0,kt.jsx)("div",{className:"bg-gray-50 px-3 py-2 border-t border-gray-200 flex-shrink-0",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("button",{type:"button",onClick:()=>{u(e=>Math.max(e-1,1)),P([])},disabled:1===d,className:"px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center gap-2 text-sm ".concat(1===d?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:text-gray-900 hover:bg-gray-200"),children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Previous"]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{z(),n()},className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg font-semibold hover:bg-gray-50 transition-all duration-200 text-sm",children:"Cancel"}),d<3?(0,kt.jsxs)("button",{type:"button",onClick:()=>{B(d)&&(u(e=>Math.min(e+1,3)),P([]))},className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg font-semibold hover:bg-blue-700 transition-all duration-200 flex items-center gap-2 text-sm",children:["Next",(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}):(0,kt.jsx)("button",{type:"submit",onClick:W,disabled:l,className:"px-4 py-2 bg-[var(--color-success-green)] text-white rounded-lg font-semibold hover:bg-green-700 disabled:bg-green-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 text-sm",children:l?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Creating..."]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Create Project"]})})]})]})})]}),A&&(0,kt.jsx)(D,{})]}):null},kS=new St({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4),refetchOnWindowFocus:!1,refetchOnReconnect:!0},mutations:{retry:1}}});function AS(){const[e,t]=(0,o.useState)("Overview"),[n,s]=(0,o.useState)(!1),[a,i]=(0,o.useState)(!1),[l,c]=(0,o.useState)(()=>{try{const e=localStorage.getItem("sidebarPinned");return!e||JSON.parse(e)}catch(Pr){return!0}}),[d,u]=(0,o.useState)(!1),[h,m]=(0,o.useState)(!1),[p,g]=(0,o.useState)(!1),[f,x]=(0,o.useState)(()=>{try{const e=localStorage.getItem("user");if(e)return JSON.parse(e)}catch(Pr){}try{const e=sessionStorage.getItem("user");if(e)return JSON.parse(e)}catch(Pr){}return null}),[v,y]=(0,o.useState)(!1),[b,w]=(0,o.useState)(!1),[j,N]=(0,o.useState)([]),[S,k]=(0,o.useState)([]),[A,C]=(0,o.useState)([]),[E,P]=(0,o.useState)(!1),[I,T]=(0,o.useState)(null),D=(0,o.useRef)(null),M=(0,o.useRef)(0),_=(M.current,(0,o.useRef)({})),O=e=>{try{if(!e)return;_.current[e]=(()=>{try{var e,t,r,n;const s=[window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,(null===(e=document.querySelector(".flex-1.overflow-y-auto"))||void 0===e?void 0:e.scrollTop)||0,(null===(t=document.querySelector("main"))||void 0===t?void 0:t.scrollTop)||0,(null===(r=document.querySelector("#root"))||void 0===r?void 0:r.scrollTop)||0,(null===(n=document.querySelector(".overflow-y-auto"))||void 0===n?void 0:n.scrollTop)||0];return Math.max(...s)}catch(Pr){return window.pageYOffset||0}})()}catch(Pr){}},[L,R]=(0,o.useState)({selectedProject:null,projectInitialView:"Profile",projectSourceSection:null,previousPage:"Overview"}),[F,U]=(0,o.useState)(!1),[B,W]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{const e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(e)try{if(e.startsWith("demo-")||e.startsWith("temp-token-")){const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);return x(t),void y(!0)}}try{const t=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){const e=await t.json();return x(e.user),void y(!0)}localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken")}catch(r){return console.log("Token verification failed, using fallback auth"),void await q()}}catch(n){console.error("Token verification failed:",n),localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken")}const t=await(0,Nn.HW)();t&&(0,Nn.mJ)(t)?await V(t):"localhost"===window.location.hostname||window.location.hostname.includes("ondigitalocean.app")?await q():(y(!1),x(null))})()},[]),(0,o.useEffect)(()=>{(async()=>{if(v&&f)try{const e=!1===f.hasCompletedOnboarding||"WORKER"===f.role&&!f.id;console.log("\ud83d\udd0d ONBOARDING: Checking status for user:",f),console.log("\ud83d\udd0d ONBOARDING: User role:",f.role),console.log("\ud83d\udd0d ONBOARDING: User ID:",f.id),console.log("\ud83d\udd0d ONBOARDING: hasCompletedOnboarding:",f.hasCompletedOnboarding),console.log("\ud83d\udd0d ONBOARDING: needsOnboarding result:",e),U(e),W(!0)}catch(e){console.error("Error checking onboarding status:",e),W(!0)}})()},[v,f]);const z=e=>{console.log("Onboarding completed:",e);const t=(0,Y.A)((0,Y.A)({},f),{},{role:(null===e||void 0===e?void 0:e.mappedRole)||(null===e||void 0===e?void 0:e.role)||(null===f||void 0===f?void 0:f.role),hasCompletedOnboarding:!0,onboardingData:e});x(t),U(!1),localStorage.setItem("user",JSON.stringify(t))},V=async e=>{if(e)try{var t,r,n,s;const a="localhost"===window.location.hostname?"http://localhost:5000/api/auth/supabase-token-exchange":"/api/auth/supabase-token-exchange",o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,firstName:(null===(t=e.user_metadata)||void 0===t?void 0:t.firstName)||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"User",lastName:(null===(n=e.user_metadata)||void 0===n?void 0:n.lastName)||"",role:(null===(s=e.user_metadata)||void 0===s?void 0:s.role)||"WORKER"})});if(o.ok){const e=await o.json();e.success&&e.token&&e.user&&(sessionStorage.setItem("authToken",e.token),localStorage.setItem("authToken",e.token),localStorage.setItem("user",JSON.stringify(e.user)),x(e.user),y(!0))}else console.error("Token exchange failed with status:",o.status),await H(e)}catch(a){console.error("Failed to exchange Supabase token:",a),await H(e)}},H=async e=>{var t,r,n,s;console.log("Using fallback authentication for user:",e.email);const a={id:e.id||"temp-"+Date.now(),email:e.email,firstName:(null===(t=e.user_metadata)||void 0===t?void 0:t.firstName)||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"User",lastName:(null===(n=e.user_metadata)||void 0===n?void 0:n.lastName)||"",role:(null===(s=e.user_metadata)||void 0===s?void 0:s.role)||"WORKER",isActive:!0,theme:"LIGHT"},o="temp-token-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);sessionStorage.setItem("authToken",o),localStorage.setItem("authToken",o),localStorage.setItem("user",JSON.stringify(a)),x(a),y(!0),console.log("Fallback authentication completed for:",a.email)},q=async()=>{console.log("Using demo authentication for development");const e={id:"demo-user-"+Date.now(),email:"demo@roofingapp.com",firstName:"Demo",lastName:"User",role:"ADMIN",isActive:!0,theme:"LIGHT"},t="demo-token-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);sessionStorage.setItem("authToken",t),localStorage.setItem("authToken",t),localStorage.setItem("user",JSON.stringify(e)),x(e),y(!0),console.log("Demo authentication completed for:",e.email)};(0,o.useEffect)(()=>{if(!v)return;let e=!1;return(async()=>{try{P(!0),T(null);const t=await Ds.projectsService.getAll();if(e)return;if(t.success&&t.data){const e=(t.data.projects||t.data||[]).map(e=>(0,Y.A)((0,Y.A)({},e),{},{id:e.id||e._id,name:e.name||e.projectName,client:e.client||{name:"Unknown Client",email:"",phone:""},projectManager:e.projectManager||{firstName:"Sarah",lastName:"Johnson",email:"sarah.johnson@company.com",phone:"5559876543"}}));C(e),console.log("\u2705 Fetched projects from API:",e.length)}else C([])}catch(t){if(e)return;console.error("Error fetching projects:",t),T(t.message),C([])}finally{e||P(!1)}})(),()=>{e=!0}},[v]),(0,o.useEffect)(()=>{if(!v)return;(async()=>{try{console.log("\ud83d\udd0d Fetching activities from API...");const e=await Ds.activitiesService.getAll();if(e.success&&e.data){const t=(Array.isArray(e.data)?e.data:Array.isArray(e.data.activities)?e.data.activities:[]).map(e=>(0,Y.A)((0,Y.A)({},e),{},{id:e.id||e._id,projectId:e.projectId||e.project_id,subject:e.subject||e.title,content:e.content||e.description||e.message,author:e.author||e.user||e.createdBy||"Unknown User",timestamp:e.timestamp||e.createdAt||e.date||(new Date).toISOString()}));N(t),console.log("\u2705 Fetched activities from API:",t.length)}else console.warn("Failed to fetch activities:",e.message),N([])}catch(e){console.error("Error fetching activities:",e),N([])}})()},[v]);const K=()=>(null===f||void 0===f?void 0:f.email)||"";if((0,o.useEffect)(()=>{const e=e=>{D.current&&!D.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,o.useEffect)(()=>{if(Date.now()<M.current)return void(e=>{try{const t=_.current[e];if(null==t)return;const r=()=>{window.scrollTo({top:t,left:0,behavior:"auto"}),[document.querySelector(".flex-1.overflow-y-auto"),document.querySelector("main"),document.querySelector("#root"),document.querySelector(".overflow-y-auto")].forEach(e=>{e&&(e.scrollTop=t)})};r(),setTimeout(r,50),setTimeout(r,120),setTimeout(r,250)}catch(Pr){}})(e);window.scrollTo({top:0,behavior:"auto"}),document.body.scrollTop=0,document.documentElement.scrollTop=0,document.documentElement.scrollLeft=0,document.body.scrollLeft=0;const t=[document.querySelector("main"),document.querySelector("#root"),document.querySelector(".overflow-y-auto"),document.querySelector(".flex-1"),document.querySelector("[data-section]"),document.querySelector(".h-full"),document.querySelector('[class*="overflow"]'),document.querySelector(".scroll-container"),document.querySelector(".content-area"),document.querySelector(".flex-1.overflow-y-auto")];t.forEach(e=>{e&&(e.scrollTop=0,e.scrollLeft=0)});const r=()=>{window.scrollTo({top:0,behavior:"auto"}),document.body.scrollTop=0,document.documentElement.scrollTop=0,t.forEach(e=>{e&&(e.scrollTop=0)})};r(),setTimeout(r,5),setTimeout(r,15),setTimeout(r,30),setTimeout(r,60),setTimeout(r,120),setTimeout(r,250),setTimeout(r,500),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},600)},[e]),(0,o.useEffect)(()=>{if(L.selectedProject){const e=()=>{const e=document.querySelector(".flex-1.overflow-y-auto");e&&(e.scrollTop=0),window.scrollTo(0,0);[document.querySelector("main"),document.querySelector("#root"),document.querySelector(".overflow-y-auto"),document.querySelector(".flex-1"),document.querySelector("[data-section]"),document.querySelector(".h-full"),document.querySelector('[class*="overflow"]'),document.querySelector(".scroll-container"),document.querySelector(".content-area"),document.querySelector(".flex-1.overflow-y-auto")].forEach(e=>{e&&(e.scrollTop=0,e.scrollLeft=0)})};e(),setTimeout(e,10),setTimeout(e,50),setTimeout(e,100),setTimeout(e,500),setTimeout(e,1e3)}},[L.selectedProject]),(0,o.useEffect)(()=>{const t=t=>{try{var r;const n=(null===t||void 0===t?void 0:t.detail)||{},s=n.projectId||(null===(r=n.project)||void 0===r?void 0:r.id);if(!s)return;const a=A.find(e=>String(e.id)===String(s))||n.project;if(!a)return;R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:a,projectInitialView:"Project Documents",projectSourceSection:"Documents & Resources",previousPage:e}))}catch(ES){console.error("Failed to handle app:openProjectDocuments event",ES)}};return window.addEventListener("app:openProjectDocuments",t),()=>window.removeEventListener("app:openProjectDocuments",t)},[A,e]),(0,o.useEffect)(()=>{const e=()=>{try{R(e=>{if(!e||!e.dashboardState)return e;const t=(0,Y.A)({},e.dashboardState);return t.workflowRestore&&delete t.workflowRestore,(0,Y.A)((0,Y.A)({},e),{},{dashboardState:t})})}catch(It){console.warn("Failed to clear dashboard workflowRestore",It)}};return window.addEventListener("dashboard:clearWorkflowRestore",e),()=>window.removeEventListener("dashboard:clearWorkflowRestore",e)},[]),!v)return(0,kt.jsx)(Et,{client:kS,children:(0,kt.jsx)(Wj,{onLoginSuccess:V})});const G=r=>{console.log("\ud83d\udd0d APP: navigate called with page:",r),console.log("\ud83d\udd0d APP: Current activePage:",e),O(e),R(t=>(0,Y.A)((0,Y.A)({},t),{},{previousPage:e,selectedProject:null,dashboardState:"Overview"===r?null:t.dashboardState,navigationContext:(0,Y.A)((0,Y.A)({},t.navigationContext),{},{fromPage:e,toPage:r,timestamp:Date.now(),isMenuNavigation:!0})})),t(r),s(!1)},J=function(r){var n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Project Workflow",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(console.log("\ud83d\udd0d APP: handleProjectSelect called with:"),console.log("\ud83d\udd0d APP: project:",null===r||void 0===r?void 0:r.name),console.log("\ud83d\udd0d APP: view:",a),console.log("\ud83d\udd0d APP: phase:",o),console.log("\ud83d\udd0d APP: sourceSection:",i),console.log("\ud83d\udd0d APP: targetLineItemId:",l),console.log("\ud83d\udd0d APP: targetSectionId:",c),!r&&("Overview"===a||"Projects"===a||"Project Messages"===a||"AI Assistant"===a||"AI Tools"===a||"Company Calendar"===a||"Archived Projects"===a||"Settings"===a||"Estimator"===a))return console.log("\ud83d\udd0d APP: Null project with page navigation, going to:",a),R(e=>{const t={targetLineItemId:e.targetLineItemId||null,targetSectionId:e.targetSectionId||null,project:e.selectedProject||e.scrollToProject||null};return(0,Y.A)((0,Y.A)({},e),{},{dashboardState:(0,Y.A)((0,Y.A)({},e.dashboardState||{}),{},{workflowRestore:t})})}),t(a),void s(!1);if("Projects"===a)return console.log("\ud83d\udd0d APP: Setting activePage to Projects"),console.log("\ud83d\udd0d APP: Current activePage before update:",e),t("Projects"),console.log("\ud83d\udd0d APP: Setting navigationState with selectedProject: null"),console.log("\ud83d\udd0d APP: Current navigationState before update:",L),R(t=>{const n=(0,Y.A)((0,Y.A)({},t),{},{selectedProject:null,projectSourceSection:i,previousPage:e,scrollToProject:r,dashboardState:(0,Y.A)((0,Y.A)({},t.dashboardState||{}),{},{selectedPhase:o||t.dashboardState&&t.dashboardState.selectedPhase||null,expandedPhases:t.dashboardState&&t.dashboardState.expandedPhases||null,scrollToProject:r})});return console.log("\ud83d\udd0d APP: New navigationState:",n),console.log("\ud83d\udd0d APP: Preserved dashboard state:",null===r||void 0===r?void 0:r.dashboardState),n}),s(!1),void console.log("\ud83d\udd0d APP: Navigation setup complete, returning early");const d=(null===r||void 0===r?void 0:r.id)||(null===r||void 0===r?void 0:r._id)||(null===r||void 0===r?void 0:r.projectId)||(null===r||void 0===r?void 0:r.project_id),u=A.find(e=>String(e.id)===String(d)),h=u?(0,Y.A)((0,Y.A)((0,Y.A)({},u),r),{},{id:u.id,_id:u._id}):(0,Y.A)((0,Y.A)({},r),{},{id:d||"temp-".concat(Date.now()),name:(null===r||void 0===r?void 0:r.name)||(null===r||void 0===r?void 0:r.projectName)||"Selected Project"});try{null!==h&&void 0!==h&&h.id&&sessionStorage.setItem("aiAssistant.lastProjectId",String(h.id))}catch(Pr){}const m="current-alerts"===((null===r||void 0===r?void 0:r.returnToSection)||"").toString().toLowerCase()?"Current Alerts":null;let p=i||(null===r||void 0===r?void 0:r.navigationSource)||m||L.projectSourceSection||null;"Current Alerts"===L.projectSourceSection&&"Current Alerts"!==p&&(p="Current Alerts");const g={selectedProject:h,projectInitialView:a,projectSourceSection:p,previousPage:"Current Alerts"===p?"Overview":L.selectedProject?L.previousPage:e,dashboardState:(0,Y.A)((0,Y.A)({},(null===r||void 0===r?void 0:r.dashboardState)||L.dashboardState||{}),l?{workflowRestore:{targetLineItemId:l,targetSectionId:c,project:h}}:{}),targetLineItemId:l,targetSectionId:c,selectionNonce:(null===r||void 0===r||null===(n=r.navigationTarget)||void 0===n?void 0:n.nonce)||Date.now()};console.log("\ud83d\udd0d APP: Setting navigationState:",g),console.log("\ud83d\udd0d APP: Dashboard state being preserved:",null===r||void 0===r?void 0:r.dashboardState),R(g),s(!1)},Q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(console.log("\ud83d\udd0d BACK_TO_PROJECTS: handleBackToProjects called"),console.log("\ud83d\udd0d BACK_TO_PROJECTS: projectSourceSection:",L.projectSourceSection),console.log("\ud83d\udd0d BACK_TO_PROJECTS: previousPage:",L.previousPage),console.log("\ud83d\udd0d BACK_TO_PROJECTS: selectedProject:",L.selectedProject),console.log("\ud83d\udd0d BACK_TO_PROJECTS: specificProject passed:",e),"Project Workflow Alerts"===L.projectSourceSection){console.log("\ud83d\udd0d BACK_TO_PROJECTS: Navigating back to ProjectDetailPage with Alerts tab");const e=L.selectedProject||L.scrollToProject;if(e)return void R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:e,projectInitialView:"Alerts",projectSourceSection:"Project Workflow Alerts"}))}if("Current Alerts"===L.projectSourceSection||L.selectedProject&&"current-alerts"===L.selectedProject.returnToSection||L.dashboardState&&L.dashboardState.currentAlertsState)return console.log("\ud83d\udd0d BACK_TO_PROJECTS: PRIORITY HANDLING - Navigating back to Current Alerts section"),M.current=Date.now()+1500,R(e=>(0,Y.A)((0,Y.A)({},e),{},{selectedProject:null,dashboardState:null})),t("Overview"),setTimeout(()=>{const e=document.querySelector('[data-section="current-alerts"]');e?(console.log("\ud83d\udd0d BACK_TO_PROJECTS: Successfully scrolled to Current Alerts section"),e.scrollIntoView({behavior:"smooth",block:"start"}),e.style.boxShadow="0 0 10px rgba(59, 130, 246, 0.5)",setTimeout(()=>{e.style.boxShadow="",M.current=0},2e3)):(console.warn("\ud83d\udd0d BACK_TO_PROJECTS: Current Alerts section not found, retrying..."),setTimeout(()=>{const e=document.querySelector('[data-section="current-alerts"]');e?(console.log("\ud83d\udd0d BACK_TO_PROJECTS: Found Current Alerts section on retry"),e.scrollIntoView({behavior:"smooth",block:"start"}),M.current=0):(console.error("\ud83d\udd0d BACK_TO_PROJECTS: Current Alerts section still not found"),M.current=0)},500))},100),void setTimeout(()=>{const e=document.querySelector('[data-section="current-alerts"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},700);if("Project Phases"===L.projectSourceSection&&L.selectedProject){console.log("\ud83d\udd0d BACK_TO_PROJECTS: Coming from Project Phases section, returning to Overview with phase restored");const e=L.selectedProject.dashboardState;return console.log("\ud83d\udd0d BACK_TO_PROJECTS: Dashboard state from project:",e),R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:null,dashboardState:e})),t("Overview"),void setTimeout(()=>{const e=document.querySelector('[data-section="project-phases"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)}if(R(e=>(0,Y.A)((0,Y.A)({},e),{},{selectedProject:null})),"Projects"===L.previousPage)t("Projects");else if("Overview"===L.previousPage){const r=L.dashboardState;if(console.log("\ud83d\udd0d BACK_TO_PROJECTS: Dashboard state for restoration:",r),"Project Messages"===L.projectSourceSection||"My Project Messages"===L.projectSourceSection)return t("Overview"),void setTimeout(()=>{const e=document.querySelector('[data-section="project-messages"]');e?e.scrollIntoView({behavior:"smooth",block:"start"}):setTimeout(()=>{const e=document.querySelector('[data-section="project-messages"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},200)},150);"Project Cubes"===L.projectSourceSection?(t("Overview"),setTimeout(()=>{const e=document.querySelector('[data-section="project-cubes"]');e?e.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},500)):"Project Phases"===L.projectSourceSection?(t("Overview"),console.log("\ud83d\udd0d BACK_TO_PROJECTS: Project Phases - dashboard state being restored:",r),console.log("\ud83d\udd0d BACK_TO_PROJECTS: selectedPhase in dashboard state:",null===r||void 0===r?void 0:r.selectedPhase),R(t=>{const n=(0,Y.A)((0,Y.A)({},t),{},{dashboardState:r,scrollToProject:e||t.scrollToProject});return console.log("\ud83d\udd0d BACK_TO_PROJECTS: New navigation state:",n),n}),setTimeout(()=>{const e=document.querySelector('[data-section="project-phases"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)):(t("Overview"),setTimeout(()=>{const e=document.querySelector('[data-section="project-cubes"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100))}else t(L.previousPage)},X=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"General Update";try{const n={type:"message_sent",description:t,projectId:e?e.id:null,priority:"Low",metadata:{subject:r}},s=await Ds.activitiesService.create(n);s.success&&s.activity&&N(e=>[s.activity,...e])}catch(n){console.error("Error creating activity:",n);const s={id:Date.now(),author:Hr(f),avatar:"I",content:t,timestamp:(new Date).toISOString(),projectId:e?e.id:null,project:e?e.name:null,subject:r};N(e=>[s,...e])}},$=e=>{const t=(A||[]).map(t=>t.id===e.id?e:t);C(t),R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:e}))},Z=e=>{C(t=>[e,...t])},ee=[{name:"Dashboard",icon:(0,kt.jsx)(Kr,{}),page:"Overview"},{name:"My Messages",icon:(0,kt.jsx)(sn,{}),page:"Project Messages"},{name:"Company Calendar",icon:(0,kt.jsx)(ln,{}),page:"Company Calendar"},{isSeparator:!0},{name:"Bubbles",icon:(0,kt.jsx)(Yr,{}),page:"AI Assistant",isAIAssistant:!0},{name:"AI Estimate Analysis",icon:(0,kt.jsx)(Gr,{}),page:"Estimator"},{name:"AI Training Tools",icon:(0,kt.jsx)(en,{}),page:"AI Tools"},{name:"Project Schedules",icon:(0,kt.jsx)(ln,{}),page:"Project Schedules",isDisabled:!0},{name:"Documents & Resources",icon:(0,kt.jsx)(Gr,{}),page:"Documents & Resources"},{name:"AI Knowledge Base",icon:(0,kt.jsx)(sn,{}),page:"Training & Knowledge Base"},{name:"Feedback Hub",icon:(0,kt.jsx)(Jr,{}),page:"Feedback Hub"},{name:"Archived Projects",icon:(0,kt.jsx)(cn,{}),page:"Archived Projects"}];return F&&B?(0,kt.jsxs)(Et,{client:kS,children:[(0,kt.jsx)(Xd,{children:(0,kt.jsx)(wN,{currentUser:f,onComplete:z})}),(0,kt.jsx)(zr,{})]}):B?"/reset-password"===window.location.pathname?(0,kt.jsx)(Et,{client:kS,children:(0,kt.jsx)(Xd,{children:(0,kt.jsx)(zj,{})})}):(0,kt.jsxs)(Et,{client:kS,children:[(0,kt.jsx)(Xd,{children:(0,kt.jsx)(Ui,{children:(0,kt.jsxs)(vi,{children:[(0,kt.jsxs)("div",{className:"flex h-screen font-sans overflow-hidden transition-colors duration-500 ".concat(d?"bg-gradient-to-br from-[#e3edf7] via-[#c7d2fe] to-[#e0f2fe] text-gray-900":"Overview"===e?"bg-gradient-to-br from-green-50 via-white to-green-50 text-gray-900":"bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 text-gray-900"),children:[n&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>s(!1)}),(0,kt.jsxs)("aside",{className:"fixed lg:static inset-y-0 left-0 z-50 flex flex-col transition-all duration-300 ease-in-out\n                ".concat(d?"bg-gradient-to-b from-neutral-900 via-neutral-800 to-neutral-900 border-r-2 border-brand-500 text-white":"bg-white/90 backdrop-blur-md shadow-strong border-r border-white/20 text-gray-900","\n                ").concat(n?"translate-x-0":"-translate-x-full lg:translate-x-0","\n                mobile-safe-area"),style:{width:a&&!l?"64px":"288px"},onMouseEnter:()=>!l&&i(!1),onMouseLeave:()=>!l&&setTimeout(()=>i(!0),300),children:[(0,kt.jsxs)("div",{className:"p-3 flex flex-col items-center border-b ".concat(d?"border-brand-500 bg-gradient-to-r from-neutral-800 to-neutral-900":"border-neutral-200 bg-gradient-to-r from-white to-neutral-50"),children:[a?(0,kt.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center font-bold text-xl ".concat(d?"bg-brand-500 text-white":"bg-blue-600 text-white"," shadow-lg"),children:"K"}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"w-40 h-16 rounded-xl flex items-center justify-center shadow-brand-glow overflow-hidden border-2 ".concat(d?"bg-neutral-800 border-brand-500":"bg-white border-neutral-200"),children:(0,kt.jsx)("img",{src:d?"/kenstruction-logo-dark.png":"/kenstruction-logo.png",alt:"Kenstruction Logo",className:"w-full h-full object-contain rounded-xl"})}),(0,kt.jsx)(NN,{})]}),(0,kt.jsx)("button",{onClick:()=>{const e=!l;c(e),localStorage.setItem("sidebarPinned",JSON.stringify(e)),e||i(!0)},className:"mt-2 p-1.5 rounded-lg transition-colors ".concat(d?"hover:bg-neutral-700 text-gray-300":"hover:bg-gray-100 text-gray-600"),title:l?"Auto-collapse sidebar":"Pin sidebar",children:l?(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{d:"M16 12V4H17V2H7V4H8V12L6 14V16H11.2V22H12.8V16H18V14L16 12Z"})}):(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12V4H17V2H7V4H8V12L6 14V16H11.2V22H12.8V16H18V14L16 12Z"})})})]}),(0,kt.jsx)("nav",{className:"flex-1 py-3 space-y-1.5 overflow-hidden transition-all duration-300 ".concat(a?"px-2":"pl-5 pr-4"),children:ee.map((t,r)=>t.isAIAssistant?(0,kt.jsxs)("button",{onClick:()=>G(t.page),className:"w-full text-left flex items-center gap-3 py-2 px-4 text-[10px] font-semibold rounded-lg transition-all duration-200 ".concat(e!==t.page||L.selectedProject?d?"text-[#e0eaff] hover:bg-[#232526]/60 hover:text-[#26d0ce]":"text-gray-700 hover:bg-white/80 hover:text-primary-700 hover:shadow-soft":d?"bg-gradient-to-r from-[#232526] via-[#26d0ce] to-[#1a2980] text-white shadow-md":"bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-md"),children:[(0,kt.jsx)("span",{className:"w-4 h-4 flex items-center justify-center",children:t.icon}),!a&&(0,kt.jsx)("span",{className:"flex-1",children:t.name})]},t.name):t.isDropdown?(0,kt.jsxs)("div",{className:"relative group",children:[(0,kt.jsxs)("button",{className:"w-full text-left flex items-center gap-3 py-2.5 px-4 font-bold rounded-lg uppercase tracking-wide text-[9px] transition-all duration-200 ".concat(d?"text-[#f2fcfe] hover:bg-[#232526]/60":"text-gray-700 hover:bg-white/80"),tabIndex:0,"aria-haspopup":"true","aria-expanded":"false",children:[(0,kt.jsx)("span",{className:"w-5 h-5 flex items-center justify-center",children:t.icon}),!a&&(0,kt.jsx)("span",{className:"flex-1",children:t.name}),!a&&(0,kt.jsx)("span",{className:"ml-auto",children:(0,kt.jsx)(tn,{className:"w-3 h-3"})})]}),(0,kt.jsx)("div",{className:"absolute left-0 top-full z-20 min-w-[180px] bg-gradient-to-b from-[#232b4d] to-[#181f3a] shadow-xl rounded-lg py-2 opacity-0 group-hover:opacity-100 group-hover:pointer-events-auto pointer-events-none transition-all duration-200 border border-[#3b82f6] text-white",style:{marginTop:2},children:t.children.map(e=>(0,kt.jsxs)("button",{onClick:()=>G(e.page),className:"w-full text-left flex items-center gap-3 py-2 px-4 text-[9px] font-semibold rounded-lg hover:bg-[#232526]/60 hover:text-[#26d0ce] transition-all duration-200",children:[(0,kt.jsx)("span",{children:e.icon}),(0,kt.jsx)("span",{children:e.name})]},e.name))})]},t.name):t.isSection?(0,kt.jsxs)("div",{className:"mt-4 mb-2 flex items-center gap-3 font-bold text-[9px] uppercase tracking-wide ".concat(d?"text-[#f2fcfe] drop-shadow-lg":"text-gray-700 dark:text-gray-200"),children:[(0,kt.jsx)("span",{className:"w-5 h-5 flex items-center justify-center",children:t.icon}),(0,kt.jsx)("span",{children:t.name})]},t.name):t.isSubItem?(0,kt.jsxs)("button",{onClick:()=>G(t.page),className:"w-full text-left flex items-center gap-3 py-2 px-4 ml-4 text-[9px] font-semibold rounded-lg transition-all duration-200 ".concat(e!==t.page||L.selectedProject?d?"text-[#f2fcfe] hover:bg-[#232526]/60 hover:text-[#26d0ce]":"text-gray-700 hover:bg-white/80 hover:text-primary-700 hover:shadow-soft":d?"bg-gradient-to-r from-[#232526] via-[#26d0ce] to-[#1a2980] text-white shadow-md":"bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-md"),children:[(0,kt.jsx)("span",{className:"w-4 h-4 flex items-center justify-center",children:t.icon}),!a&&(0,kt.jsx)("span",{className:"flex-1",children:t.name})]},t.name):t.isBullet?(0,kt.jsxs)("button",{onClick:()=>G(t.page),className:"w-full text-left flex items-center gap-3 pl-12 pr-4 py-2 text-[9px] font-medium rounded transition-all duration-200 group ".concat(d?"text-[#e0eaff] hover:bg-[#232526]/40 hover:text-[#26d0ce]":"text-gray-600 hover:bg-blue-50 hover:text-blue-700 dark:hover:bg-blue-900/30"),children:[(0,kt.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-gradient-to-tr ".concat(d?"from-[#26d0ce] to-[#1a2980]":"from-blue-400 to-emerald-400"," mr-2 group-hover:from-blue-600 group-hover:to-emerald-600")}),(0,kt.jsx)("span",{children:t.name})]},t.name):t.isSeparator?(0,kt.jsx)("div",{className:"my-3 mx-4 border-t ".concat(d?"border-[#26d0ce]/40":"border-gray-300 dark:border-gray-700")},r):(0,kt.jsxs)("button",{onClick:()=>!t.isDisabled&&G(t.page),disabled:t.isDisabled,className:"w-full text-left flex items-center gap-3 py-2 px-4 text-[10px] font-semibold rounded-lg transition-all duration-200 ".concat(t.isDisabled?d?"text-gray-500 cursor-not-allowed opacity-50":"text-gray-400 cursor-not-allowed opacity-50":e!==t.page||L.selectedProject?d?"text-[#e0eaff] hover:bg-[#232526]/60 hover:text-[#26d0ce]":"text-gray-700 hover:bg-white/80 hover:text-primary-700 hover:shadow-soft":d?"bg-gradient-to-r from-[#232526] via-[#26d0ce] to-[#1a2980] text-white shadow-md":"bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-md"),children:[(0,kt.jsxs)("span",{className:"w-4 h-4 flex items-center justify-center relative",children:[t.icon,a&&t.badge&&t.badge>0&&(0,kt.jsx)("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"})]}),!a&&(0,kt.jsx)("span",{className:"flex-1",children:t.name}),!a&&t.badge&&t.badge>0&&(0,kt.jsx)("span",{className:"inline-flex items-center justify-center min-w-[18px] h-[18px] px-1 text-[7px] font-bold rounded-full ml-2 ".concat("Project Messages"===t.page?d?"bg-blue-500 text-white shadow-lg":"bg-blue-500 text-white shadow-md":d?"bg-red-500 text-white shadow-lg":"bg-red-500 text-white shadow-md"),children:t.badge>99?"99+":t.badge})]},t.name))})]}),(0,kt.jsxs)("main",{className:"flex-1 flex flex-col min-w-0 text-xs font-sans transition-colors duration-500 ".concat(d?"bg-gradient-to-br from-neutral-900 via-neutral-800 to-neutral-900 text-white":""),style:{minWidth:0,fontSize:"12px"},children:[(0,kt.jsxs)("header",{className:"hidden lg:flex items-center justify-between p-4 border-b transition-all duration-300 z-[9999] ".concat(d?"bg-neutral-800/80 backdrop-blur-sm border-brand-500/40 text-white":"bg-white/95 backdrop-blur-sm border-neutral-200 shadow-sm"),children:[(0,kt.jsxs)("div",{className:"flex items-center flex-1 min-w-0",children:["Overview"!==e&&(0,kt.jsxs)("div",{className:"flex-shrink-0",children:[(0,kt.jsx)("h1",{className:"text-xl font-bold ".concat(d?"text-white":"text-gray-800"),children:"Alerts"===e?"Project Alerts":"Company Calendar"===e?"Company Calendar":"Email History"===e?"Email History":"AI Assistant"===e?"":"AI Tools"===e?"AI Training Tools":"Archived Projects"===e?"Archived Projects":"Project Messages"===e?"Messages":"Estimator"===e?"Estimate Comparison & Analysis":"Customers"===e?"Customer Management":"Projects"===e?"Project Workflow":e}),(0,kt.jsx)("p",{className:"text-sm font-medium ".concat(d?"text-gray-200":"text-gray-600"),children:"Alerts"===e?"Monitor project alerts, tasks, and urgent notifications.":"Project Schedules"===e?"Plan and organize project timelines and milestones":"Company Calendar"===e?"Company-wide events, meetings, and project schedules":"Email History"===e?"View all sent emails with tracking, attachments, and project associations":"AI Assistant"===e?"":"AI Tools"===e?"Advanced AI-powered construction management tools":"Archived Projects"===e?"Completed projects and historical records":"Project Messages"===e?"Stay up-to-date with activity feeds and manage important project messages in one place.":"Estimator"===e?"Upload documents to generate a discrepancy report or a pre-estimate advisory.":"Customers"===e?"Manage customer information, contacts, and project associations":"Project management and construction oversight"})]}),(0,kt.jsx)("div",{className:"flex-1 max-w-3xl xl:max-w-4xl mx-8",children:(0,kt.jsx)(NS,{projects:A,activities:j,onNavigateToResult:e=>{if(console.log("\ud83d\udd0d Search navigation called with result:",e),!e||!e.navigationTarget)return void console.error("\u274c Invalid search result - missing navigationTarget");const r=e.navigationTarget;if(console.log("\ud83d\udd0d Navigation target:",r),"Project Workflow"===r.page&&r.project)return console.log("\ud83d\udd0d Navigating directly to Project Workflow from search with targeting"),void J(r.project,"Project Workflow",null,"Global Search",r.targetLineItemId,r.targetSectionId);if("project"===e.type&&e.data)return console.log("\ud83d\udd0d Navigating to project detail:",e.data.projectNumber||e.data.id),void J(e.data,"Project Profile",null,"Global Search");switch(r.page){case"project-detail":r.project&&J(r.project,"Project Workflow",null,"Global Search");break;case"project-messages":r.project&&J(r.project,"Messages",null,"Global Search");break;case"projects":r.project?J(r.project,"Project Profile",null,"Global Search"):t("Projects");break;case"Profile":case"Project Profile":r.project&&J(r.project,"Project Profile",null,"Global Search");break;case"Project Workflow":r.project&&J(r.project,"Project Workflow",null,"Global Search",r.targetLineItemId,r.targetSectionId);break;default:console.log("Unhandled search navigation - defaulting to Projects page"),t("Projects")}},handleCreateAlert:e=>{console.log("ACTION: Creating alert for project:",e),alert('Creating an alert for "'.concat(e.name||e.projectName,'"...'))},handleAddActivity:e=>{console.log("ACTION: Adding activity for project:",e),alert('Adding an activity for "'.concat(e.name||e.projectName,'"...'))},colorMode:d,className:"w-full"})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[(0,kt.jsxs)("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-soft hover:shadow-medium hover:-translate-y-0.5 border border-blue-500/20",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),(0,kt.jsx)("span",{children:"Add Project"})]}),(0,kt.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(d?"bg-[#1e293b] hover:bg-[#232b4d] text-white":"bg-gray-100 hover:bg-gray-200"),children:(0,kt.jsx)(Jr,{})}),(0,kt.jsxs)("div",{className:"relative",ref:D,children:[(0,kt.jsx)("button",{onClick:()=>m(!h),className:"flex items-center gap-3 p-2 rounded-lg transition-colors ".concat(d?"bg-[#1e293b] hover:bg-[#232b4d] text-white":"bg-gray-100 hover:bg-gray-200"),children:null!==f&&void 0!==f&&f.avatar?(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden border-2 border-blue-500",children:(0,kt.jsx)("img",{src:f.avatar.startsWith("spaces://")?"https://".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_NAME,".").concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBL-BzpAUPd-Deu8LndaoQO367iokdlehM",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_ENDPOINT,"/").concat(f.avatar.replace("spaces://","")):f.avatar,alt:"Profile",className:"w-full h-full object-cover"})}):(0,kt.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center text-white font-semibold text-sm",children:qr(f)})}),h&&(0,kt.jsx)("div",{className:"absolute right-0 top-full mt-2 w-56 rounded-lg shadow-xl z-[99999] border ".concat(d?"bg-[#1e293b] border-brand-500/40 text-white":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"py-2",children:[(0,kt.jsx)("div",{className:"px-4 pb-2 text-[10px] ".concat(d?"text-gray-300":"text-gray-500"),children:"Signed in as"}),(0,kt.jsx)("div",{className:"px-4 pb-2 text-sm font-medium truncate ".concat(d?"text-white":"text-gray-900"),title:K(),children:K()}),(0,kt.jsx)("div",{className:"".concat(d?"border-[#3b82f6]/30":"border-gray-200"," border-t my-2")}),(0,kt.jsxs)("button",{onClick:()=>{m(!1),G("Settings")},className:"w-full text-left px-4 py-2 text-sm flex items-center gap-2 ".concat(d?"text-white hover:bg-[#232b4d]":"text-gray-700 hover:bg-gray-100"),children:[(0,kt.jsx)(Qr,{})," Settings"]}),(0,kt.jsx)("div",{className:"".concat(d?"border-[#3b82f6]/30":"border-gray-200"," border-t my-2")}),(0,kt.jsxs)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),m(!1),(async()=>{const{supabase:e}=await Promise.resolve().then(r.bind(r,759));await e.auth.signOut(),localStorage.removeItem("authToken"),localStorage.removeItem("user"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("user"),y(!1),x(null)})()},className:"w-full text-left px-4 py-2 text-sm flex items-center gap-2 ".concat(d?"text-red-300 hover:bg-[#3b0f0f]":"text-red-600 hover:bg-red-50"),children:[(0,kt.jsx)(Xr,{})," Logout"]})]})})]})]})]}),(0,kt.jsxs)("header",{className:"lg:hidden border-b p-3 flex items-center justify-between transition-colors duration-500 ".concat(d?"bg-neutral-800 border-brand-500 text-white":"bg-white/80 backdrop-blur-sm border-neutral-200"),children:[(0,kt.jsx)("button",{onClick:()=>s(!0),className:"p-2 rounded-lg transition-colors ".concat(d?"bg-[#232b4d] hover:bg-[#1e293b] text-white":"bg-gray-100 hover:bg-gray-200"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("img",{src:d?"/kenstruction-logo-dark.png":"/kenstruction-logo.png",alt:"Kenstruction Logo",className:"w-8 h-8 rounded-lg"}),(0,kt.jsx)("span",{className:"ml-2 font-semibold ".concat(d?"text-white":"text-gray-800"),children:"Kenstruction"})]}),(0,kt.jsx)("div",{className:"w-10"})," "]}),(0,kt.jsx)("div",{className:"flex-1 p-4 overflow-x-hidden",children:(0,kt.jsx)("div",{className:"flex-1 overflow-hidden",children:(console.log("\ud83d\udd0d MAIN_RENDER: navigationState.selectedProject:",L.selectedProject),console.log("\ud83d\udd0d MAIN_RENDER: activePage:",e),L.selectedProject?(console.log("\ud83d\udd0d MAIN_RENDER: Rendering ProjectDetailPage"),(0,kt.jsx)(Kd,{project:L.selectedProject,initialView:L.projectInitialView,onBack:Q,colorMode:d,previousPage:L.previousPage,projectSourceSection:L.projectSourceSection,onSendMessage:X,tasks:S,projects:A,onUpdate:$,activities:j,onAddActivity:X,onProjectSelect:J,targetLineItemId:L.targetLineItemId,targetSectionId:L.targetSectionId,selectionNonce:L.selectionNonce})):(console.log("\ud83d\udd0d MAIN_RENDER: Rendering renderPage()"),(()=>{switch(console.log("\ud83d\udd0d RENDER: renderPage called with activePage:",e),console.log("\ud83d\udd0d RENDER: navigationState.selectedProject:",L.selectedProject),e){case"Overview":default:return(0,kt.jsx)(ji,{tasks:S,activities:j,onProjectSelect:J,onAddActivity:X,dashboardState:L.dashboardState});case"Projects":return(0,kt.jsx)(al,{onProjectSelect:J,onCreateProject:Z,projects:A,colorMode:d,projectSourceSection:L.projectSourceSection,onNavigateBack:Q,scrollToProject:L.scrollToProject});case"Project Messages":return(0,kt.jsx)(cp,{colorMode:d,projects:A,onProjectSelect:J,navigationContext:L.navigationContext,previousPage:L.previousPage});case"Project Schedules":return(0,kt.jsx)(rp,{});case"Company Calendar":return(0,kt.jsx)(Jm,{projects:A,tasks:S,activities:j,onProjectSelect:J,colorMode:d});case"Feedback Hub":return(0,kt.jsx)(Bj,{colorMode:d,currentUser:f});case"Documents & Resources":return(0,kt.jsx)(op,{});case"Alerts Calendar":return(0,kt.jsx)(Qm,{projects:A,tasks:S,activities:j,onProjectSelect:J,colorMode:d});case"AI Tools":return(0,kt.jsx)(nu,{colorMode:d});case"Training & Knowledge Base":return(0,kt.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-10",children:[(0,kt.jsx)("p",{className:"text-lg text-gray-600 mb-8",children:"AI Powered Guidance for Company Information Below"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-t-4 border-blue-500 flex flex-col gap-2 hover:shadow-xl transition",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6.5V18a2 2 0 002 2h12a2 2 0 002-2V6.5M4 6.5L12 3l8 3.5"})}),(0,kt.jsx)("span",{className:"font-bold text-blue-700 text-lg",children:"AI Company Documents"})]}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Instantly search, summarize, and answer questions about your company handbooks, policies, and internal documents using AI."})]}),(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-t-4 border-green-500 flex flex-col gap-2 hover:shadow-xl transition",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17v-2a2 2 0 012-2h2a2 2 0 012 2v2m-6 0h6a2 2 0 002-2v-5a2 2 0 00-2-2h-2a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2v2"})}),(0,kt.jsx)("span",{className:"font-bold text-green-700 text-lg",children:"AI Project Documents"})]}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Get AI-powered insights, summaries, and answers from your project files, contracts, and technical documents."})]}),(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-t-4 border-yellow-500 flex flex-col gap-2 hover:shadow-xl transition",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("svg",{className:"w-6 h-6 text-yellow-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,kt.jsx)("span",{className:"font-bold text-yellow-700 text-lg",children:"AI Manufacturer Guidance"})]}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Access up-to-date, AI-curated manufacturer recommendations, product specs, and compliance information."})]}),(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-t-4 border-purple-500 flex flex-col gap-2 hover:shadow-xl transition",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("svg",{className:"w-6 h-6 text-purple-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 01-8 0m8 0V5a4 4 0 00-8 0v2m8 0a4 4 0 01-8 0V7"})}),(0,kt.jsx)("span",{className:"font-bold text-purple-700 text-lg",children:"AI Installation Guidance"})]}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Get step-by-step, AI-driven installation instructions and troubleshooting for your field teams."})]})]})]});case"Archived Projects":return(0,kt.jsx)(Gd,{projects:A,colorMode:d,onProjectSelect:J,navigate:G});case"Email History":return(0,kt.jsx)(dp,{colorMode:d});case"AI Assistant":return(0,kt.jsx)(ru,{projects:A,colorMode:d,onProjectSelect:J});case"Settings":return(0,kt.jsx)(Km,{colorMode:d,currentUser:f,onUserUpdated:e=>{try{x(e),localStorage.setItem("user",JSON.stringify(e)),sessionStorage.setItem("user",JSON.stringify(e))}catch(Pr){}}});case"Estimator":return(0,kt.jsx)(ou,{})}})()))})})]})]}),(0,kt.jsx)(SS,{isOpen:p,onClose:()=>g(!1),onProjectCreated:e=>{console.log("Project created:",e),g(!1),Ds.projectsService&&Ds.projectsService.getProjects&&Ds.projectsService.getProjects().then(e=>{e.data&&e.data.success&&C(e.data.data)}).catch(e=>{console.error("Error refreshing projects:",e)})}})]})})}),(0,kt.jsx)(zr,{})]}):(0,kt.jsxs)(Et,{client:kS,children:[(0,kt.jsx)(Xd,{children:(0,kt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center",children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,kt.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Setting up your workspace..."}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare everything for you."})]})})}),(0,kt.jsx)(zr,{})]})}function CS(){const e=L(),t=o.useContext(M).navigationType,r=(0,o.useRef)(new Map);return(0,o.useEffect)(()=>{const t=()=>{r.current.set(e.key,window.scrollY)};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[e.key]),(0,o.useEffect)(()=>{if("POP"===t){var n;const t=null!==(n=r.current.get(e.key))&&void 0!==n?n:0;window.scrollTo({top:t,left:0,behavior:"auto"})}else window.scrollTo({top:0,left:0,behavior:"auto"})},[e.pathname,e.search,e.hash,e.key,t]),null}l.createRoot(document.getElementById("root")).render((0,kt.jsx)(o.StrictMode,{children:(0,kt.jsxs)(K,{children:[(0,kt.jsx)(CS,{}),(0,kt.jsx)(AS,{})]})}))})();
//# sourceMappingURL=main.1c9149c7.js.map