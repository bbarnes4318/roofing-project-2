/*! For license information please see main.2e302e97.js.LICENSE.txt */
(()=>{"use strict";var e={122:e=>{e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,a,s;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(a=n;0!==a--;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(s=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(a=n;0!==a--;)if(!Object.prototype.hasOwnProperty.call(r,s[a]))return!1;for(a=n;0!==a--;){var o=s[a];if(!e(t[o],r[o]))return!1}return!0}return t!==t&&r!==r}},579:(e,t,r)=>{e.exports=r(1153)},759:(e,t,r)=>{r.d(t,{supabase:()=>nr,f3:()=>ar});class n extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",r=arguments.length>2?arguments[2]:void 0;super(e),this.name=t,this.context=r}}class a extends n{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class s extends n{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class o extends n{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var i;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(i||(i={}));var l=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{l(n.next(e))}catch(_t){s(_t)}}function i(e){try{l(n.throw(e))}catch(_t){s(_t)}}function l(e){e.done?a(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};class c{constructor(e){let{headers:t={},customFetch:n,region:a=i.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=t,this.region=a,this.fetch=(e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then(r.bind(r,4630)).then(e=>{let{default:r}=e;return r(...t)})}:fetch),function(){return t(...arguments)}})(n)}setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;return l(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:l}=t;let c={},{region:d}=t;d||(d=this.region);const u=new URL("".concat(this.url,"/").concat(e));let h;d&&"any"!==d&&(c["x-region"]=d,u.searchParams.set("forceFunctionRegion",d)),l&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&("undefined"!==typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",h=l):"string"===typeof l?(c["Content-Type"]="text/plain",h=l):"undefined"!==typeof FormData&&l instanceof FormData?h=l:(c["Content-Type"]="application/json",h=JSON.stringify(l)));const m=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:h}).catch(e=>{throw new a(e)}),p=m.headers.get("x-relay-error");if(p&&"true"===p)throw new s(m);if(!m.ok)throw new o(m);let f,g=(null!==(r=m.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return f="application/json"===g?yield m.json():"application/octet-stream"===g?yield m.blob():"text/event-stream"===g?m:"multipart/form-data"===g?yield m.formData():yield m.text(),{data:f,error:null,response:m}}catch(n){return{data:null,error:n,response:n instanceof o||n instanceof s?n.context:void 0}}})}}var d=r(7980);const{PostgrestClient:u,PostgrestQueryBuilder:h,PostgrestFilterBuilder:m,PostgrestTransformBuilder:p,PostgrestBuilder:f,PostgrestError:g}=d;const v=class{static detectEnvironment(){var e;if("undefined"!==typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!==typeof r.g&&"undefined"!==typeof r.g.WebSocket)return{type:"native",constructor:r.g.WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocketPair&&"undefined"===typeof globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!==typeof globalThis&&globalThis.EdgeRuntime||"undefined"!==typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!==typeof process&&process.versions&&process.versions.node){const e=parseInt(process.versions.node.split(".")[0]);return e>=22?"undefined"!==typeof globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(e," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(e," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(yl){return!1}}},x="realtime-js/".concat("2.15.1"),b=1e4;var y,w,j,N,S,k;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(y||(y={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(w||(w={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(j||(j={})),function(e){e.websocket="websocket"}(N||(N={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(S||(S={}));class A{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"===typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),a=t.getUint8(2);let s=this.HEADER_LENGTH+2;const o=r.decode(e.slice(s,s+n));s+=n;const i=r.decode(e.slice(s,s+a));s+=a;return{ref:null,topic:o,event:i,payload:JSON.parse(r.decode(e.slice(s,e.byteLength)))}}}class C{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(k||(k={}));const E=function(e,t){var r;const n=null!==(r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce((r,a)=>(r[a]=P(a,e,t,n),r),{})},P=(e,t,r,n)=>{const a=t.find(t=>t.name===e),s=null===a||void 0===a?void 0:a.type,o=r[e];return s&&!n.includes(s)?_(s,o):I(o)},_=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return M(t,r)}switch(e){case k.bool:return T(t);case k.float4:case k.float8:case k.int2:case k.int4:case k.int8:case k.numeric:case k.oid:return L(t);case k.json:case k.jsonb:return D(t);case k.timestamp:return O(t);case k.abstime:case k.date:case k.daterange:case k.int4range:case k.int8range:case k.money:case k.reltime:case k.text:case k.time:case k.timestamptz:case k.timetz:case k.tsrange:case k.tstzrange:default:return I(t)}},I=e=>e,T=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},L=e=>{if("string"===typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},D=e=>{if("string"===typeof e)try{return JSON.parse(e)}catch(t){return console.log("JSON parse error: ".concat(t)),e}return e},M=(e,t)=>{if("string"!==typeof e)return e;const r=e.length-1,n=e[r];if("{"===e[0]&&"}"===n){let n;const a=e.slice(1,r);try{n=JSON.parse("["+a+"]")}catch(Pr){n=a?a.split(","):[]}return n.map(e=>_(t,e))}return e},O=e=>"string"===typeof e?e.replace(" ","T"):e,R=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class F{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b;this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(e){let{status:t,response:r}=e;this.recHooks.filter(e=>e.status===t).forEach(e=>e.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var U,B,z,W;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(U||(U={}));class q{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null===t||void 0===t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.joinRef=this.channel._joinRef(),this.state=q.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=q.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],n()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=q.syncDiff(this.state,e,t,r),n())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const a=this.cloneDeep(e),s=this.transformState(t),o={},i={};return this.map(a,(e,t)=>{s[e]||(i[e]=t)}),this.map(s,(e,t)=>{const r=a[e];if(r){const n=t.map(e=>e.presence_ref),a=r.map(e=>e.presence_ref),s=t.filter(e=>a.indexOf(e.presence_ref)<0),l=r.filter(e=>n.indexOf(e.presence_ref)<0);s.length>0&&(o[e]=s),l.length>0&&(i[e]=l)}else o[e]=t}),this.syncDiff(a,{joins:o,leaves:i},r,n)}static syncDiff(e,t,r,n){const{joins:a,leaves:s}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(a,(t,n)=>{var a;const s=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=this.cloneDeep(n),s.length>0){const r=e[t].map(e=>e.presence_ref),n=s.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...n)}r(t,s,n)}),this.map(s,(t,r)=>{let a=e[t];if(!a)return;const s=r.map(e=>e.presence_ref);a=a.filter(e=>s.indexOf(e.presence_ref)<0),e[t]=a,n(t,a,r),0===a.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return t[r]="metas"in n?n.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(B||(B={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(z||(z={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(W||(W={}));class V{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},r=arguments.length>2?arguments[2]:void 0;this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=w.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new F(this,j.join,this.params,this.timeout),this.rejoinTimer=new C(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=w.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=w.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=w.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=w.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=w.errored,this.rejoinTimer.scheduleTimeout())}),this._on(j.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new q(this),this.broadcastEndpointURL=R(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==w.closed){const{config:{broadcast:a,presence:s,private:o}}=this.params,i=null!==(n=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==n?n:[],l=!!this.bindings[z.PRESENCE]&&this.bindings[z.PRESENCE].length>0,c={},d={broadcast:a,presence:Object.assign(Object.assign({},s),{enabled:l}),postgres_changes:i,private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null===e||void 0===e?void 0:e(W.CHANNEL_ERROR,t)),this._onClose(()=>null===e||void 0===e?void 0:e(W.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async t=>{let{postgres_changes:r}=t;var n;if(this.socket.setAuth(),void 0!==r){const t=this.bindings.postgres_changes,a=null!==(n=null===t||void 0===t?void 0:t.length)&&void 0!==n?n:0,s=[];for(let n=0;n<a;n++){const a=t[n],{filter:{event:o,schema:i,table:l,filter:c}}=a,d=r&&r[n];if(!d||d.event!==o||d.schema!==i||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=w.errored,void(null===e||void 0===e||e(W.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));s.push(Object.assign(Object.assign({},a),{id:d.id}))}return this.bindings.postgres_changes=s,void(e&&e(W.SUBSCRIBED))}null===e||void 0===e||e(W.SUBSCRIBED)}).receive("error",t=>{this.state=w.errored,null===e||void 0===e||e(W.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null===e||void 0===e||e(W.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===w.joined&&e===z.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,n;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var n,a,s;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(s=null===(a=null===(n=this.params)||void 0===n?void 0:n.config)||void 0===a?void 0:a.broadcast)||void 0===s?void 0:s.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:s,payload:o}=e,i={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(n=e.body)||void 0===n?void 0:n.cancel()),e.ok?"ok":"error"}catch(a){return"AbortError"===a.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=w.leaving;const t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger(j.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new F(this,j.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null===r||void 0===r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=w.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const n=new AbortController,a=setTimeout(()=>n.abort(),r),s=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(a),s}_push(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let n=new F(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(e.event),e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,a;const s=e.toLocaleLowerCase(),{close:o,error:i,leave:l,join:c}=j;if(r&&[o,i,l,c].indexOf(s)>=0&&r!==this._joinRef())return;let d=this._onMessage(s,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(e=>{var t,r,n;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(n=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===n?void 0:n.toLocaleLowerCase())===s}).map(e=>e.callback(d,r)):null===(a=this.bindings[s])||void 0===a||a.filter(e=>{var r,n,a,o,i,l;if(["broadcast","presence","postgres_changes"].includes(s)){if("id"in e){const s=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return s&&(null===(n=t.ids)||void 0===n?void 0:n.includes(s))&&("*"===o||(null===o||void 0===o?void 0:o.toLocaleLowerCase())===(null===(a=t.data)||void 0===a?void 0:a.type.toLocaleLowerCase()))}{const r=null===(i=null===(o=null===e||void 0===e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===i?void 0:i.toLocaleLowerCase();return"*"===r||r===(null===(l=null===t||void 0===t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===s}).map(e=>{if("object"===typeof d&&"ids"in d){const e=d.data,{schema:t,table:r,commit_timestamp:n,type:a,errors:s}=e,o={schema:t,table:r,commit_timestamp:n,eventType:a,new:{},old:{},errors:s};d=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(d,r)})}_isClosed(){return this.state===w.closed}_isJoined(){return this.state===w.joined}_isJoining(){return this.state===w.joining}_isLeaving(){return this.state===w.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,r){const n=e.toLocaleLowerCase(),a={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(a):this.bindings[n]=[a],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var n;return!((null===(n=e.type)||void 0===n?void 0:n.toLocaleLowerCase())===r&&V.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(j.close,{},e)}_onError(e){this._on(j.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=w.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=E(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=E(e.columns,e.old_record)),t}}const H=()=>{},G=25e3,K=10,J=100,Y=[1e3,2e3,5e3,1e4];class X{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=b,this.transport=null,this.heartbeatIntervalMs=G,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=H,this.ref=0,this.reconnectTimer=null,this.logger=H,this.conn=null,this.sendBuffer=[],this.serializer=new A,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then(r.bind(r,4630)).then(e=>{let{default:r}=e;return r(...t)}).catch(e=>{throw new Error("Failed to load @supabase/node-fetch: ".concat(e.message,". ")+"This is required for HTTP requests in Node.js environments without native fetch.")})}:fetch),function(){return t(...arguments)}},!(null===(n=null===t||void 0===t?void 0:t.params)||void 0===n?void 0:n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint="".concat(e,"/").concat(N.websocket),this.httpEndpoint=R(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null===t||void 0===t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=v.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error("".concat(t,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw new Error("WebSocket not available: ".concat(t))}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,null!==t&&void 0!==t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case y.connecting:return S.Connecting;case y.open:return S.Open;case y.closing:return S.Closing;default:return S.Closed}}isConnected(){return this.connectionState()===S.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};const r="realtime:".concat(e),n=this.getChannels().find(e=>e.topic===r);if(n)return n;{const r=new V("realtime:".concat(e),t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:n,ref:a}=e,s=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push","".concat(t," ").concat(r," (").concat(a,")"),n),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},J);this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{"phoenix"===e.topic&&"phx_reply"===e.event&&this.heartbeatCallback("ok"===e.payload.status?"ok":"error"),e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:r,payload:n,ref:a}=e,s=a?"(".concat(a,")"):"",o=n.status||"";this.log("receive","".concat(o," ").concat(t," ").concat(r," ").concat(s).trim(),n),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,n,a)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL())),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(j.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return"".concat(e).concat(r).concat(n)}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=t||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const r={access_token:e,version:x};e&&t.updateJoinPayload(r),t.joinedOnce&&t._isJoined()&&t._push(j.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this.setAuth().catch(t=>{this.log("error","error setting auth in ".concat(e),t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(_t){this.log("error","error in ".concat(e," callback"),_t)}})}catch(_t){this.log("error","error triggering ".concat(e," callbacks"),_t)}}_setupReconnectionTimer(){this.reconnectTimer=new C(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},K)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,a,s,o,i,l;if(this.transport=null!==(t=null===e||void 0===e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null===e||void 0===e?void 0:e.timeout)&&void 0!==r?r:b,this.heartbeatIntervalMs=null!==(n=null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&void 0!==n?n:G,this.worker=null!==(a=null===e||void 0===e?void 0:e.worker)&&void 0!==a&&a,this.accessToken=null!==(s=null===e||void 0===e?void 0:e.accessToken)&&void 0!==s?s:null,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),((null===e||void 0===e?void 0:e.logLevel)||(null===e||void 0===e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(o=null===e||void 0===e?void 0:e.reconnectAfterMs)&&void 0!==o?o:e=>Y[e-1]||1e4,this.encode=null!==(i=null===e||void 0===e?void 0:e.encode)&&void 0!==i?i:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(l=null===e||void 0===e?void 0:e.decode)&&void 0!==l?l:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}}}class Q extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Z(e){return"object"===typeof e&&null!==e&&"__isStorageError"in e}class $ extends Q{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ee extends Q{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var te=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{l(n.next(e))}catch(_t){s(_t)}}function i(e){try{l(n.throw(e))}catch(_t){s(_t)}}function l(e){e.done?a(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const re=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then(r.bind(r,4630)).then(e=>{let{default:r}=e;return r(...t)})}:fetch),function(){return t(...arguments)}},ne=e=>{if(Array.isArray(e))return e.map(e=>ne(e));if("function"===typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(e=>{let[r,n]=e;const a=r.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[a]=ne(n)}),t};var ae=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{l(n.next(e))}catch(_t){s(_t)}}function i(e){try{l(n.throw(e))}catch(_t){s(_t)}}function l(e){e.done?a(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const se=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),oe=(e,t,n)=>ae(void 0,void 0,void 0,function*(){const a=yield te(void 0,void 0,void 0,function*(){return"undefined"===typeof Response?(yield Promise.resolve().then(r.bind(r,4630))).Response:Response});e instanceof a&&!(null===n||void 0===n?void 0:n.noResolveJson)?e.json().then(r=>{const n=e.status||500,a=(null===r||void 0===r?void 0:r.statusCode)||n+"";t(new $(se(r),n,a))}).catch(e=>{t(new ee(se(e),e))}):t(new ee(se(e),e))}),ie=(e,t,r,n)=>{const a={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(n)?(a.headers=Object.assign({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),a.body=JSON.stringify(n)):a.body=n,(null===t||void 0===t?void 0:t.duplex)&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),r)):a};function le(e,t,r,n,a,s){return ae(this,void 0,void 0,function*(){return new Promise((o,i)=>{e(r,ie(t,n,a,s)).then(e=>{if(!e.ok)throw e;return(null===n||void 0===n?void 0:n.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>oe(e,i,n))})})}function ce(e,t,r,n){return ae(this,void 0,void 0,function*(){return le(e,"GET",t,r,n)})}function de(e,t,r,n,a){return ae(this,void 0,void 0,function*(){return le(e,"POST",t,n,a,r)})}function ue(e,t,r,n,a){return ae(this,void 0,void 0,function*(){return le(e,"PUT",t,n,a,r)})}function he(e,t,r,n,a){return ae(this,void 0,void 0,function*(){return le(e,"DELETE",t,n,a,r)})}var me=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{l(n.next(e))}catch(_t){s(_t)}}function i(e){try{l(n.throw(e))}catch(_t){s(_t)}}function l(e){e.done?a(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const pe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},fe={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ge{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.url=e,this.headers=t,this.bucketId=r,this.fetch=re(n)}uploadOrUpdate(e,t,r,n){return me(this,void 0,void 0,function*(){try{let a;const s=Object.assign(Object.assign({},fe),n);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(s.upsert)});const i=s.metadata;"undefined"!==typeof Blob&&r instanceof Blob?(a=new FormData,a.append("cacheControl",s.cacheControl),i&&a.append("metadata",this.encodeMetadata(i)),a.append("",r)):"undefined"!==typeof FormData&&r instanceof FormData?(a=r,a.append("cacheControl",s.cacheControl),i&&a.append("metadata",this.encodeMetadata(i))):(a=r,o["cache-control"]="max-age=".concat(s.cacheControl),o["content-type"]=s.contentType,i&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(i)))),(null===n||void 0===n?void 0:n.headers)&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield("PUT"==e?ue:de)(this.fetch,"".concat(this.url,"/object/").concat(c),a,Object.assign({headers:o},(null===s||void 0===s?void 0:s.duplex)?{duplex:s.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(a){if(Z(a))return{data:null,error:a};throw a}})}upload(e,t,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return me(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),s=this._getFinalPath(a),o=new URL(this.url+"/object/upload/sign/".concat(s));o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:fe.upsert},n),s=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!==typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!==typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,s["cache-control"]="max-age=".concat(t.cacheControl),s["content-type"]=t.contentType);return{data:{path:a,fullPath:(yield ue(this.fetch,o.toString(),e,{headers:s})).Key},error:null}}catch(i){if(Z(i))return{data:null,error:i};throw i}})}createSignedUploadUrl(e,t){return me(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);(null===t||void 0===t?void 0:t.upsert)&&(n["x-upsert"]="true");const a=yield de(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(r),{},{headers:n}),s=new URL(this.url+a.url),o=s.searchParams.get("token");if(!o)throw new Q("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:o},error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}update(e,t,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return me(this,void 0,void 0,function*(){try{return{data:yield de(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===r||void 0===r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}copy(e,t,r){return me(this,void 0,void 0,function*(){try{return{data:{path:(yield de(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===r||void 0===r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return me(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),a=yield de(this.fetch,"".concat(this.url,"/object/sign/").concat(n),Object.assign({expiresIn:t},(null===r||void 0===r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const s=(null===r||void 0===r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"";return a={signedUrl:encodeURI("".concat(this.url).concat(a.signedURL).concat(s))},{data:a,error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return me(this,void 0,void 0,function*(){try{const n=yield de(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers}),a=(null===r||void 0===r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"";return{data:n.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI("".concat(this.url).concat(e.signedURL).concat(a)):null})),error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}download(e,t){return me(this,void 0,void 0,function*(){const r="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{}),a=n?"?".concat(n):"";try{const t=this._getFinalPath(e),n=yield ce(this.fetch,"".concat(this.url,"/").concat(r,"/").concat(t).concat(a),{headers:this.headers,noResolveJson:!0});return{data:yield n.blob(),error:null}}catch(s){if(Z(s))return{data:null,error:s};throw s}})}info(e){return me(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield ce(this.fetch,"".concat(this.url,"/object/info/").concat(t),{headers:this.headers});return{data:ne(e),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}exists(e){return me(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r,n){return ae(this,void 0,void 0,function*(){return le(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}(this.fetch,"".concat(this.url,"/object/").concat(t),{headers:this.headers}),{data:!0,error:null}}catch(r){if(Z(r)&&r instanceof ee){const e=r.originalError;if([400,404].includes(null===e||void 0===e?void 0:e.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],a=(null===t||void 0===t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==a&&n.push(a);const s="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{});""!==o&&n.push(o);let i=n.join("&");return""!==i&&(i="?".concat(i)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(s,"/public/").concat(r).concat(i))}}}remove(e){return me(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}})}list(e,t,r){return me(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},pe),t),{prefix:e||""});return{data:yield de(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),n,{headers:this.headers},r),error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}listV2(e,t){return me(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield de(this.fetch,"".concat(this.url,"/object/list-v2/").concat(this.bucketId),r,{headers:this.headers},t),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!==typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}}const ve={"X-Client-Info":"storage-js/".concat("2.11.0")};var xe=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{l(n.next(e))}catch(_t){s(_t)}}function i(e){try{l(n.throw(e))}catch(_t){s(_t)}}function l(e){e.done?a(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};class be{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const a=new URL(e);if(null===n||void 0===n?void 0:n.useNewHostname){/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase."))}this.url=a.href,this.headers=Object.assign(Object.assign({},ve),t),this.fetch=re(r)}listBuckets(){return xe(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers}),error:null}}catch(e){if(Z(e))return{data:null,error:e};throw e}})}getBucket(e){return xe(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}})}createBucket(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return xe(this,void 0,void 0,function*(){try{return{data:yield de(this.fetch,"".concat(this.url,"/bucket"),{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return xe(this,void 0,void 0,function*(){try{return{data:yield ue(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}emptyBucket(e){return xe(this,void 0,void 0,function*(){try{return{data:yield de(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}})}deleteBucket(e){return xe(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}})}}class ye extends be{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}from(e){return new ge(this.url,this.headers,e,this.fetch)}}let we="";we="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const je={headers:{"X-Client-Info":"supabase-js-".concat(we,"/").concat("2.56.0")}},Ne={schema:"public"},Se={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ke={};var Ae=r(4630),Ce=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{l(n.next(e))}catch(_t){s(_t)}}function i(e){try{l(n.throw(e))}catch(_t){s(_t)}}function l(e){e.done?a(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const Ee=e=>{let t;return t=e||("undefined"===typeof fetch?Ae.default:fetch),function(){return t(...arguments)}},Pe=(e,t,r)=>{const n=Ee(r),a="undefined"===typeof Headers?Ae.Headers:Headers;return(r,s)=>Ce(void 0,void 0,void 0,function*(){var o;const i=null!==(o=yield t())&&void 0!==o?o:e;let l=new a(null===s||void 0===s?void 0:s.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization","Bearer ".concat(i)),n(r,Object.assign(Object.assign({},s),{headers:l}))})};var _e=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{l(n.next(e))}catch(_t){s(_t)}}function i(e){try{l(n.throw(e))}catch(_t){s(_t)}}function l(e){e.done?a(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};const Ie="2.71.1",Te=3e4,Le=9e4,De={"X-Client-Info":"gotrue-js/".concat(Ie)},Me="X-Supabase-Api-Version",Oe={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Re=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Fe extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Ue(e){return"object"===typeof e&&null!==e&&"__isAuthError"in e}class Be extends Fe{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class ze extends Fe{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class We extends Fe{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class qe extends We{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Ve extends We{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class He extends We{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ge extends We{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ke extends We{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Je extends We{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ye(e){return Ue(e)&&"AuthRetryableFetchError"===e.name}class Xe extends We{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Qe extends We{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),$e=" \t\n\r=".split(""),et=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<$e.length;t+=1)e[$e[t].charCodeAt(0)]=-2;for(let t=0;t<Ze.length;t+=1)e[Ze[t].charCodeAt(0)]=t;return e})();function tt(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(Ze[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(Ze[e]),t.queuedBits-=6}}function rt(e,t,r){const n=et[e];if(!(n>-1)){if(-2===n)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function nt(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},n={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},s=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(0===(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,n,r)};for(let o=0;o<e.length;o+=1)rt(e.charCodeAt(o),a,s);return t.join("")}function at(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}t(e)}function st(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const t=1024*(n-55296)&65535;n=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}at(n,t)}}function ot(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};for(let a=0;a<e.length;a+=1)rt(e.charCodeAt(a),r,n);return new Uint8Array(t)}function it(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};return e.forEach(e=>tt(e,r,n)),tt(null,r,n),t.join("")}const lt=()=>"undefined"!==typeof window&&"undefined"!==typeof document,ct={tested:!1,writable:!1},dt=()=>{if(!lt())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(_t){return!1}if(ct.tested)return ct.writable;const e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ct.tested=!0,ct.writable=!0}catch(_t){ct.tested=!0,ct.writable=!1}return ct.writable};const ut=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then(r.bind(r,4630)).then(e=>{let{default:r}=e;return r(...t)})}:fetch),function(){return t(...arguments)}},ht=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},mt=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(yl){return r}},pt=async(e,t)=>{await e.removeItem(t)};class ft{constructor(){this.promise=new ft.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function gt(e){const t=e.split(".");if(3!==t.length)throw new Qe("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!Re.test(t[r]))throw new Qe("JWT not in base64url format");return{header:JSON.parse(nt(t[0])),payload:JSON.parse(nt(t[1])),signature:ot(t[2]),raw:{header:t[0],payload:t[1]}}}function vt(e){return("0"+e.toString(16)).substr(-2)}async function xt(e){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function bt(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=function(){const e=new Uint32Array(56);if("undefined"===typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let n=0;n<56;n++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,vt).join("")}();let a=n;r&&(a+="/PASSWORD_RECOVERY"),await ht(e,"".concat(t,"-code-verifier"),a);const s=await xt(n);return[s,n===s?"plain":"s256"]}ft.promiseConstructor=Promise;const yt=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const wt=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function jt(e){if(!wt.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Nt(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"===typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function St(e){return JSON.parse(JSON.stringify(e))}var kt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};const At=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ct=[502,503,504];async function Et(e){var t,r;if(!("object"===typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"===typeof r.json))throw new Je(At(e),0);if(Ct.includes(e.status))throw new Je(At(e),e.status);let n,a;try{n=await e.json()}catch(_t){throw new ze(At(_t),_t)}const s=function(e){const t=e.headers.get(Me);if(!t)return null;if(!t.match(yt))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(_t){return null}}(e);if(s&&s.getTime()>=Oe.timestamp&&"object"===typeof n&&n&&"string"===typeof n.code?a=n.code:"object"===typeof n&&n&&"string"===typeof n.error_code&&(a=n.error_code),a){if("weak_password"===a)throw new Xe(At(n),e.status,(null===(t=n.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===a)throw new qe}else if("object"===typeof n&&n&&"object"===typeof n.weak_password&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0))throw new Xe(At(n),e.status,n.weak_password.reasons);throw new Be(At(n),e.status||500,a)}async function Pt(e,t,r,n){var a;const s=Object.assign({},null===n||void 0===n?void 0:n.headers);s[Me]||(s[Me]=Oe.name),(null===n||void 0===n?void 0:n.jwt)&&(s.Authorization="Bearer ".concat(n.jwt));const o=null!==(a=null===n||void 0===n?void 0:n.query)&&void 0!==a?a:{};(null===n||void 0===n?void 0:n.redirectTo)&&(o.redirect_to=n.redirectTo);const i=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,r,n,a,s){const o=((e,t,r,n)=>{const a={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===t||void 0===t?void 0:t.headers),a.body=JSON.stringify(n),Object.assign(Object.assign({},a),r))})(t,n,a,s);let i;try{i=await e(r,Object.assign({},o))}catch(_t){throw console.error(_t),new Je(At(_t),0)}i.ok||await Et(i);if(null===n||void 0===n?void 0:n.noResolveJson)return i;try{return await i.json()}catch(_t){await Et(_t)}}(e,t,r+i,{headers:s,noResolveJson:null===n||void 0===n?void 0:n.noResolveJson},{},null===n||void 0===n?void 0:n.body);return(null===n||void 0===n?void 0:n.xform)?null===n||void 0===n?void 0:n.xform(l):{data:Object.assign({},l),error:null}}function It(e){var t;let r=null;var n;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(n=e.expires_in,Math.round(Date.now()/1e3)+n)));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Tt(e){const t=It(e);return!t.error&&e.weak_password&&"object"===typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"===typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Lt(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Dt(e){return{data:e,error:null}}function Mt(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:a,verification_type:s}=e,o=kt(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:n,redirect_to:a,verification_type:s},user:Object.assign({},o)},error:null}}function Ot(e){return e}const Rt=["global","local","others"];var Ft=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};class Ut{constructor(e){let{url:t="",headers:r={},fetch:n}=e;this.url=t,this.headers=r,this.fetch=ut(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rt[0];if(Rt.indexOf(t)<0)throw new Error("@supabase/auth-js: Parameter scope must be one of ".concat(Rt.join(", ")));try{return await Pt(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await Pt(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Lt})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ft(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=null===r||void 0===r?void 0:r.newEmail,delete n.newEmail),await Pt(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:n,headers:this.headers,xform:Mt,redirectTo:null===t||void 0===t?void 0:t.redirectTo})}catch(t){if(Ue(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Pt(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:Lt})}catch(t){if(Ue(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,a,s,o,i;try{const l={nextPage:null,lastPage:0,total:0},c=await Pt(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(a=null===(n=null===e||void 0===e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==a?a:""},xform:Ot});if(c.error)throw c.error;const d=await c.json(),u=null!==(s=c.headers.get("x-total-count"))&&void 0!==s?s:0,h=null!==(i=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==i?i:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(r,"Page")]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Ue(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){jt(e);try{return await Pt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:Lt})}catch(t){if(Ue(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){jt(e);try{return await Pt(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:Lt})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async deleteUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];jt(e);try{return await Pt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:Lt})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){jt(e.userId);try{const{data:t,error:r}=await Pt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async _deleteFactor(e){jt(e.userId),jt(e.id);try{return{data:await Pt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}}}function Bt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const zt=!!(globalThis&&dt()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Wt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class qt extends Wt{}async function Vt(e,t,r){zt&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),zt&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async n=>{if(!n){if(0===t)throw zt&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new qt('Acquiring an exclusive Navigator LockManager lock "'.concat(e,'" immediately failed'));if(zt)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(_t){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",_t)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}zt&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,n.name);try{return await r()}finally{zt&&console.log("@supabase/gotrue-js: navigatorLock: released",e,n.name)}}))}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(_t){"undefined"!==typeof self&&(self.globalThis=self)}}();const Ht={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:De,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Gt(e,t,r){return await r()}const Kt={};class Jt{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jt.nextInstanceID,Jt.nextInstanceID+=1,this.instanceID>0&&lt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Ht),e);if(this.logDebugMessages=!!n.debug,"function"===typeof n.debug&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Ut({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=ut(n.fetch),this.lock=n.lock||Gt,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:lt()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Vt:this.lock=Gt,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:dt()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Bt(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Bt(this.memoryStorage)),lt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(_t){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",_t)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=Kt[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Kt[this.storageKey]=Object.assign(Object.assign({},Kt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Kt[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Kt[this.storageKey]=Object.assign(Object.assign({},Kt[this.storageKey]),{cachedAt:e})}_debug(){if(this.logDebugMessages){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger("GoTrueClient@".concat(this.instanceID," (").concat(Ie,") ").concat((new Date).toISOString()),...t)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(_t){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),lt()&&this.detectSessionInUrl&&"none"!==r){const{data:n,error:a}=await this._getSessionFromURL(t,r);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),function(e){return Ue(e)&&"AuthImplicitGrantRedirectError"===e.name}(a)){const t=null===(e=a.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:a}}return await this._removeSession(),{error:a}}const{session:s,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",s,"redirect type",o),await this._saveSession(s),setTimeout(async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Ue(t)?{error:t}:{error:new ze("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const a=await Pt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(r=null===(t=null===e||void 0===e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(n=null===e||void 0===e?void 0:e.options)||void 0===n?void 0:n.captchaToken}},xform:It}),{data:s,error:o}=a;if(o||!s)return{data:{user:null,session:null},error:o};const i=s.session,l=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(a){if(Ue(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(e){var t,r,n;try{let a;if("email"in e){const{email:r,password:n,options:s}=e;let o=null,i=null;"pkce"===this.flowType&&([o,i]=await bt(this.storage,this.storageKey)),a=await Pt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo,body:{email:r,password:n,data:null!==(t=null===s||void 0===s?void 0:s.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken},code_challenge:o,code_challenge_method:i},xform:It})}else{if(!("phone"in e))throw new He("You must provide either an email or phone number and a password");{const{phone:t,password:s,options:o}=e;a=await Pt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:t,password:s,data:null!==(r=null===o||void 0===o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(n=null===o||void 0===o?void 0:o.channel)&&void 0!==n?n:"sms",gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}},xform:It})}}const{data:s,error:o}=a;if(o||!s)return{data:{user:null,session:null},error:o};const i=s.session,l=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(a){if(Ue(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:n,options:a}=e;t=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:r,password:n,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},xform:Tt})}else{if(!("phone"in e))throw new He("You must provide either an email or phone number and a password");{const{phone:r,password:n,options:a}=e;t=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:r,password:n,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},xform:Tt})}}const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n}):{data:{user:null,session:null},error:new Ve}}catch(t){if(Ue(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,a;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error('@supabase/auth-js: Unsupported chain "'.concat(t,'"'))}async signInWithSolana(e){var t,r,n,a,s,o,i,l,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:f,options:g}=e;let v;if(lt())if("object"===typeof h)v=h;else{const e=window;if(!("solana"in e)||"object"!==typeof e.solana||!("signIn"in e.solana&&"function"===typeof e.solana.signIn||"signMessage"in e.solana&&"function"===typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!==typeof h||!(null===g||void 0===g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=h}const x=new URL(null!==(t=null===g||void 0===g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in v&&v.signIn){const e=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null===g||void 0===g?void 0:g.signInWithSolana),{version:"1",domain:x.host,uri:x.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&"object"===typeof e[0])t=e[0];else{if(!(e&&"object"===typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"===typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"===typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in v)||"function"!==typeof v.signMessage||!("publicKey"in v)||"object"!==typeof v||!v.publicKey||!("toBase58"in v.publicKey)||"function"!==typeof v.publicKey.toBase58)throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=["".concat(x.host," wants you to sign in with your Solana account:"),v.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1","URI: ".concat(x.href),"Issued At: ".concat(null!==(n=null===(r=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==n?n:(new Date).toISOString()),...(null===(a=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===a?void 0:a.notBefore)?["Not Before: ".concat(g.signInWithSolana.notBefore)]:[],...(null===(s=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===s?void 0:s.expirationTime)?["Expiration Time: ".concat(g.signInWithSolana.expirationTime)]:[],...(null===(o=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===o?void 0:o.chainId)?["Chain ID: ".concat(g.signInWithSolana.chainId)]:[],...(null===(i=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===i?void 0:i.nonce)?["Nonce: ".concat(g.signInWithSolana.nonce)]:[],...(null===(l=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?["Request ID: ".concat(g.signInWithSolana.requestId)]:[],...(null===(d=null===(c=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...g.signInWithSolana.resources.map(e=>"- ".concat(e))]:[]].join("\n");const e=await v.signMessage((new TextEncoder).encode(m),"utf8");if(!e||!(e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:r}=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:it(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:It});if(r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:r}):{data:{user:null,session:null},error:new Ve}}catch(f){if(Ue(f))return{data:{user:null,session:null},error:f};throw f}}async _exchangeCodeForSession(e){const t=await mt(this.storage,"".concat(this.storageKey,"-code-verifier")),[r,n]=(null!==t&&void 0!==t?t:"").split("/");try{const{data:t,error:a}=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:It});if(await pt(this.storage,"".concat(this.storageKey,"-code-verifier")),a)throw a;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!==n&&void 0!==n?n:null}),error:a}):{data:{user:null,session:null,redirectType:null},error:new Ve}}catch(a){if(Ue(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:a,nonce:s}=e,o=await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:r,id_token:n,access_token:a,nonce:s,gotrue_meta_security:{captcha_token:null===t||void 0===t?void 0:t.captchaToken}},xform:It}),{data:i,error:l}=o;return l?{data:{user:null,session:null},error:l}:i&&i.session&&i.user?(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:i,error:l}):{data:{user:null,session:null},error:new Ve}}catch(t){if(Ue(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,a,s;try{if("email"in e){const{email:n,options:a}=e;let s=null,o=null;"pkce"===this.flowType&&([s,o]=await bt(this.storage,this.storageKey));const{error:i}=await Pt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:n,data:null!==(t=null===a||void 0===a?void 0:a.data)&&void 0!==t?t:{},create_user:null===(r=null===a||void 0===a?void 0:a.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken},code_challenge:s,code_challenge_method:o},redirectTo:null===a||void 0===a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:i}=await Pt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:t,data:null!==(n=null===r||void 0===r?void 0:r.data)&&void 0!==n?n:{},create_user:null===(a=null===r||void 0===r?void 0:r.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken},channel:null!==(s=null===r||void 0===r?void 0:r.channel)&&void 0!==s?s:"sms"}});return{data:{user:null,session:null,messageId:null===o||void 0===o?void 0:o.message_id},error:i}}throw new He("You must provide either an email or phone number.")}catch(o){if(Ue(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let n,a;"options"in e&&(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo,a=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:s,error:o}=await Pt(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:n,xform:It});if(o)throw o;if(!s)throw new Error("An error occurred on token verification.");const i=s.session,l=s.user;return(null===i||void 0===i?void 0:i.access_token)&&(await this._saveSession(i),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(n){if(Ue(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let a=null,s=null;return"pkce"===this.flowType&&([a,s]=await bt(this.storage,this.storageKey)),await Pt(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(n=null===e||void 0===e?void 0:e.options)||void 0===n?void 0:n.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:s}),headers:this.headers,xform:Dt})}catch(a){if(Ue(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new qe;const{error:n}=await Pt(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(Ue(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t="".concat(this.url,"/resend");if("email"in e){const{email:r,type:n,options:a}=e,{error:s}=await Pt(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},redirectTo:null===a||void 0===a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:s}}if("phone"in e){const{phone:r,type:n,options:a}=e,{data:s,error:o}=await Pt(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null===s||void 0===s?void 0:s.message_id},error:o}}throw new He("You must provide either an email or phone number and a type")}catch(t){if(Ue(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(_t){}})()),r}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(_t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await mt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<Le;if(this._debug("#__loadSession()","session has".concat(r?"":" not"," expired"),"expires_at",e.expires_at),!r){if(this.userStorage){const t=await mt(this.userStorage,this.storageKey+"-user");(null===t||void 0===t?void 0:t.user)?e.user=t.user:e.user=Nt()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,r,n)=>(t||"user"!==r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,r,n))})}return{data:{session:e},error:null}}const{session:n,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Pt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:Lt}):await this._useSession(async e=>{var t,r,n;const{data:a,error:s}=e;if(s)throw s;return(null===(t=a.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Pt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!==(n=null===(r=a.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0,xform:Lt}):{data:{user:null},error:new qe}})}catch(t){if(Ue(t))return function(e){return Ue(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await pt(this.storage,"".concat(this.storageKey,"-code-verifier"))),{data:{user:null},error:t};throw t}}async updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async r=>{const{data:n,error:a}=r;if(a)throw a;if(!n.session)throw new qe;const s=n.session;let o=null,i=null;"pkce"===this.flowType&&null!=e.email&&([o,i]=await bt(this.storage,this.storageKey));const{data:l,error:c}=await Pt(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null===t||void 0===t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:i}),jwt:s.access_token,xform:Lt});if(c)throw c;return s.user=l.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),{data:{user:s.user},error:null}})}catch(r){if(Ue(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new qe;const t=Date.now()/1e3;let r=t,n=!0,a=null;const{payload:s}=gt(e.access_token);if(s.exp&&(r=s.exp,n=r<=t),n){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};a=t}else{const{data:n,error:s}=await this._getUser(e.access_token);if(s)throw s;a={access_token:e.access_token,refresh_token:e.refresh_token,user:n.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(Ue(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:n,error:a}=t;if(a)throw a;e=null!==(r=n.session)&&void 0!==r?r:void 0}if(!(null===e||void 0===e?void 0:e.refresh_token))throw new qe;const{session:n,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Ue(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!lt())throw new Ge("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ge(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Ke("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Ge("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ke("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const n=new URL(window.location.href);return n.searchParams.delete("code"),window.history.replaceState(window.history.state,"",n.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:a,refresh_token:s,expires_in:o,expires_at:i,token_type:l}=e;if(!a||!o||!s||!l)throw new Ge("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(o);let u=c+d;i&&(u=parseInt(i));const h=u-c;1e3*h<=Te&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(h,"s, should have been closer to ").concat(d,"s"));const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:f}=await this._getUser(a);if(f)throw f;const g={provider_token:r,provider_refresh_token:n,access_token:a,expires_in:d,expires_at:u,refresh_token:s,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(r){if(Ue(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await mt(this.storage,"".concat(this.storageKey,"-code-verifier"));return!(!e.code||!t)}async signOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async t=>{var r;const{data:n,error:a}=t;if(a)return{error:a};const s=null===(r=n.session)||void 0===r?void 0:r.access_token;if(s){const{error:t}=await this.admin.signOut(s,e);if(t&&(!function(e){return Ue(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await pt(this.storage,"".concat(this.storageKey,"-code-verifier"))),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:n},error:a}=t;if(a)throw a;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(a){await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,n=null;"pkce"===this.flowType&&([r,n]=await bt(this.storage,this.storageKey,!0));try{return await Pt(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(Ue(a))return{data:null,error:a};throw a}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async t=>{var r,n,a,s,o;const{data:i,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});return await Pt(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(s=i.session)||void 0===s?void 0:s.access_token)&&void 0!==o?o:void 0})});if(n)throw n;return lt()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null===r||void 0===r?void 0:r.url),{data:{provider:e.provider,url:null===r||void 0===r?void 0:r.url},error:null}}catch(r){if(Ue(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:a,error:s}=t;if(s)throw s;return await Pt(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:null!==(n=null===(r=a.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{const r=Date.now();return await function(e,t){const r=new Promise((r,n)=>{(async()=>{for(let a=0;a<1/0;a++)try{const n=await e(a);if(!t(a,null,n))return void r(n)}catch(_t){if(!t(a,_t))return void n(_t)}})()});return r}(async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Pt(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:It})),(e,t)=>{const n=200*Math.pow(2,e);return t&&Ye(t)&&Date.now()+n-r<Te})}catch(r){if(this._debug(t,"error",r),Ue(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return"object"===typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),lt()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await mt(this.storage,this.storageKey);if(a&&this.userStorage){let t=await mt(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:a.user},await ht(this.userStorage,this.storageKey+"-user",t)),a.user=null!==(e=null===t||void 0===t?void 0:t.user)&&void 0!==e?e:Nt()}else if(a&&!a.user&&!a.user){const e=await mt(this.storage,this.storageKey+"-user");e&&(null===e||void 0===e?void 0:e.user)?(a.user=e.user,await pt(this.storage,this.storageKey+"-user"),await ht(this.storage,this.storageKey,a)):a.user=Nt()}if(this._debug(r,"session from storage",a),!this._isValidSession(a))return this._debug(r,"session is not valid"),void(null!==a&&await this._removeSession());const s=1e3*(null!==(t=a.expires_at)&&void 0!==t?t:1/0)-Date.now()<Le;if(this._debug(r,"session has".concat(s?"":" not"," expired with margin of ").concat(Le,"s")),s){if(this.autoRefreshToken&&a.refresh_token){const{error:e}=await this._callRefreshToken(a.refresh_token);e&&(console.error(e),Ye(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(a.user&&!0===a.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(a.access_token);!t&&(null===e||void 0===e?void 0:e.user)?(a.user=e.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(n){console.error("Error getting user data:",n),this._debug(r,"error getting user data, skipping SIGNED_IN notification",n)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){return this._debug(r,"error",a),void console.error(a)}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new qe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(n,"begin");try{this.refreshingDeferred=new ft;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new qe;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const n={session:t.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(a){if(this._debug(n,"error",a),Ue(a)){const e={session:null,error:a};return Ye(a)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(a),a}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n="#_notifyAllSubscribers(".concat(e,")");this._debug(n,"begin",t,"broadcast = ".concat(r));try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(_t){n.push(_t)}});if(await Promise.all(a),n.length>0){for(let e=0;e<n.length;e+=1)console.error(n[e]);throw n[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await ht(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const n=St(e);await ht(this.storage,this.storageKey,n)}else{const e=St(t);await ht(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await pt(this.storage,this.storageKey),await pt(this.storage,this.storageKey+"-code-verifier"),await pt(this.storage,this.storageKey+"-user"),this.userStorage&&await pt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&lt()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(_t){console.error("removing visibilitychange callback failed",_t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Te);this.autoRefreshTicker=e,e&&"object"===typeof e&&"function"===typeof e.unref?e.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const n=Math.floor((1e3*r.expires_at-e)/Te);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(n," ticks, a tick lasts ").concat(Te,"ms, refresh threshold is ").concat(3," ticks")),n<=3&&await this._callRefreshToken(r.refresh_token)})}catch(_t){console.error("Auto refresh tick failed with error. This is likely a transient error.",_t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(_t){if(!(_t.isAcquireTimeout||_t instanceof Wt))throw _t;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!lt()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=["provider=".concat(encodeURIComponent(t))];if((null===r||void 0===r?void 0:r.redirectTo)&&n.push("redirect_to=".concat(encodeURIComponent(r.redirectTo))),(null===r||void 0===r?void 0:r.scopes)&&n.push("scopes=".concat(encodeURIComponent(r.scopes))),"pkce"===this.flowType){const[e,t]=await bt(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(e)),code_challenge_method:"".concat(encodeURIComponent(t))});n.push(r.toString())}if(null===r||void 0===r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);n.push(e.toString())}return(null===r||void 0===r?void 0:r.skipBrowserRedirect)&&n.push("skip_http_redirect=".concat(r.skipBrowserRedirect)),"".concat(e,"?").concat(n.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:a}=t;return a?{data:null,error:a}:await Pt(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null===(r=null===n||void 0===n?void 0:n.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:a,error:s}=t;if(s)return{data:null,error:s};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:i,error:l}=await Pt(this.fetch,"POST","".concat(this.url,"/factors"),{body:o,headers:this.headers,jwt:null===(r=null===a||void 0===a?void 0:a.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(n=null===i||void 0===i?void 0:i.totp)||void 0===n?void 0:n.qr_code)&&(i.totp.qr_code="data:image/svg+xml;utf-8,".concat(i.totp.qr_code)),{data:i,error:null})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:a}=t;if(a)return{data:null,error:a};const{data:s,error:o}=await Pt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null===n||void 0===n?void 0:n.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),{data:s,error:o})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:a}=t;return a?{data:null,error:a}:await Pt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:{channel:e.channel},headers:this.headers,jwt:null===(r=null===n||void 0===n?void 0:n.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Ue(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null===e||void 0===e?void 0:e.factors)||[],n=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status),a=r.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:n,phone:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:a}=e;if(a)return{data:null,error:a};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=gt(n.access_token);let o=null;s.aal&&(o=s.aal);let i=o;(null!==(r=null===(t=n.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(i="aal2");return{data:{currentLevel:o,nextLevel:i,currentAuthenticationMethods:s.amr||[]},error:null}}))}async fetchJwk(e){let t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]}).keys.find(t=>t.kid===e);if(t)return t;const r=Date.now();if(t=this.jwks.keys.find(t=>t.kid===e),t&&this.jwks_cached_at+6e5>r)return t;const{data:n,error:a}=await Pt(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(a)throw a;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=r,t=n.keys.find(t=>t.kid===e),t||null):null}async getClaims(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};r=e.session.access_token}const{header:n,payload:a,signature:s,raw:{header:o,payload:i}}=gt(r);(null===t||void 0===t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(a.exp);const l=n.alg&&!n.alg.startsWith("HS")&&n.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(n.kid,(null===t||void 0===t?void 0:t.keys)?{keys:t.keys}:null===t||void 0===t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:a,header:n,signature:s},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(n.alg),d=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,s,function(e){const t=[];return st(e,e=>t.push(e)),new Uint8Array(t)}("".concat(o,".").concat(i))))throw new Qe("Invalid JWT signature");return{data:{claims:a,header:n,signature:s},error:null}}catch(r){if(Ue(r))return{data:null,error:r};throw r}}}Jt.nextInstanceID=0;const Yt=Jt;class Xt extends Yt{constructor(e){super(e)}}var Qt=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{l(n.next(e))}catch(_t){s(_t)}}function i(e){try{l(n.throw(e))}catch(_t){s(_t)}}function l(e){e.done?a(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(o,i)}l((n=n.apply(e,t||[])).next())})};class Zt{constructor(e,t,r){var n,a,s;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=function(e){return e.endsWith("/")?e:e+"/"}(e),i=new URL(o);this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const l="sb-".concat(i.hostname.split(".")[0],"-auth-token"),c=function(e,t){var r,n;const{db:a,auth:s,realtime:o,global:i}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),a),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},d),o),storage:{},global:Object.assign(Object.assign(Object.assign({},u),i),{headers:Object.assign(Object.assign({},null!==(r=null===u||void 0===u?void 0:u.headers)&&void 0!==r?r:{}),null!==(n=null===i||void 0===i?void 0:i.headers)&&void 0!==n?n:{})}),accessToken:()=>_e(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!==r&&void 0!==r?r:{},{db:Ne,realtime:ke,auth:Object.assign(Object.assign({},Se),{storageKey:l}),global:je});this.storageKey=null!==(n=c.auth.storageKey)&&void 0!==n?n:"",this.headers=null!==(a=c.global.headers)&&void 0!==a?a:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(s=c.auth)&&void 0!==s?s:{},this.headers,c.global.fetch),this.fetch=Pe(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.rest=new u(new URL("rest/v1",i).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new ye(this.storageUrl.href,this.headers,this.fetch,null===r||void 0===r?void 0:r.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new c(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.rest.rpc(e,t,r)}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Qt(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient(e,t,r){let{autoRefreshToken:n,persistSession:a,detectSessionInUrl:s,storage:o,storageKey:i,flowType:l,lock:c,debug:d}=e;const u={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new Xt({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),t),storageKey:i,autoRefreshToken:n,persistSession:a,detectSessionInUrl:s,storage:o,flowType:l,lock:c,debug:d,fetch:r,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new X(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null===e||void 0===e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null===t||void 0===t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=r}}(function(){if("undefined"!==typeof window)return!1;if("undefined"===typeof process)return!1;const e=process.version;if(void 0===e||null===e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("\u26a0\ufe0f  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const $t="https://kqotdxuhptpkmbsrvjga.supabase.co",er="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",tr=Boolean($t&&er);tr||console.warn("Supabase env not set. Define REACT_APP_SUPABASE_URL and REACT_APP_SUPABASE_ANON_KEY.");let rr=null;tr&&(rr=((e,t,r)=>new Zt(e,t,r))($t,er,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"}}));const nr=rr||{auth:{onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}}),signOut:async()=>({error:null}),signUp:async()=>{throw new Error("Supabase is not configured")},signInWithPassword:async()=>{throw new Error("Supabase is not configured")},resetPasswordForEmail:async()=>{throw new Error("Supabase is not configured")},getUser:async()=>({data:{user:null},error:null})}},ar=async e=>{const{error:t}=await nr.auth.updateUser({password:e});if(t)throw t}},816:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(2284);function a(e){var t=function(e,t){if("object"!=(0,n.A)(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=(0,n.A)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,n.A)(t)?t:t+""}},1153:(e,t,r)=>{var n=r(5043),a=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,s={},c=null,d=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:a,type:e,key:c,ref:d,props:s,_owner:i.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},1210:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(8829)),s=n(r(5736));class o{constructor(e){let{headers:t={},schema:r,fetch:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=n}from(e){const t=new URL("".concat(this.url,"/").concat(e));return new a.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new o(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:r=!1,get:n=!1,count:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var o;let i;const l=new URL("".concat(this.url,"/rpc/").concat(e));let c;r||n?(i=r?"HEAD":"GET",Object.entries(t).filter(e=>{let[t,r]=e;return void 0!==r}).map(e=>{let[t,r]=e;return[t,Array.isArray(r)?"{".concat(r.join(","),"}"):"".concat(r)]}).forEach(e=>{let[t,r]=e;l.searchParams.append(t,r)})):(i="POST",c=t);const d=new Headers(this.headers);return a&&d.set("Prefer","count=".concat(a)),new s.default({method:i,url:l,headers:d,schema:this.schemaName,body:c,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}}t.default=o},1298:(e,t,r)=>{r.r(t),r.d(t,{PERMISSIONS:()=>n,ROLE_HIERARCHY:()=>u,ROLE_PERMISSIONS:()=>a,canAccessDataLevel:()=>c,default:()=>f,filterDataByPermissions:()=>d,getRoleColor:()=>p,getRoleDisplayName:()=>m,getRolePermissions:()=>l,hasAllPermissions:()=>i,hasAnyPermission:()=>o,hasPermission:()=>s,isRoleHigher:()=>h});const n={PROJECTS_CREATE:"projects.create",PROJECTS_READ:"projects.read",PROJECTS_UPDATE:"projects.update",PROJECTS_DELETE:"projects.delete",PROJECTS_ASSIGN:"projects.assign",PROJECTS_VIEW_ALL:"projects.view_all",PROJECTS_VIEW_ASSIGNED:"projects.view_assigned",USERS_CREATE:"users.create",USERS_READ:"users.read",USERS_UPDATE:"users.update",USERS_DELETE:"users.delete",USERS_MANAGE_ROLES:"users.manage_roles",USERS_VIEW_ALL:"users.view_all",FINANCES_VIEW:"finances.view",FINANCES_EDIT:"finances.edit",FINANCES_APPROVE:"finances.approve",FINANCES_EXPORT:"finances.export",FINANCES_DELETE:"finances.delete",DOCUMENTS_UPLOAD:"documents.upload",DOCUMENTS_DOWNLOAD:"documents.download",DOCUMENTS_DELETE:"documents.delete",DOCUMENTS_SHARE:"documents.share",DOCUMENTS_VIEW_ALL:"documents.view_all",REPORTS_VIEW:"reports.view",REPORTS_GENERATE:"reports.generate",REPORTS_EXPORT:"reports.export",REPORTS_ADVANCED:"reports.advanced",AI_BUBBLES:"ai.bubbles",AI_ADVANCED:"ai.advanced",AI_MANAGE_SETTINGS:"ai.manage_settings",SETTINGS_VIEW:"settings.view",SETTINGS_EDIT:"settings.edit",SETTINGS_MANAGE_INTEGRATIONS:"settings.manage_integrations",SETTINGS_SYSTEM_CONFIG:"settings.system_config",CALENDAR_VIEW:"calendar.view",CALENDAR_EDIT:"calendar.edit",CALENDAR_MANAGE:"calendar.manage",WORKFLOW_VIEW:"workflow.view",WORKFLOW_EDIT:"workflow.edit",WORKFLOW_MANAGE:"workflow.manage",WORKFLOW_APPROVE:"workflow.approve",COMMUNICATION_SEND:"communication.send",COMMUNICATION_MANAGE:"communication.manage",COMMUNICATION_BULK:"communication.bulk",DATA_PUBLIC:"data.public",DATA_INTERNAL:"data.internal",DATA_CONFIDENTIAL:"data.confidential",DATA_RESTRICTED:"data.restricted"},a={ADMIN:[n.PROJECTS_CREATE,n.PROJECTS_READ,n.PROJECTS_UPDATE,n.PROJECTS_DELETE,n.PROJECTS_ASSIGN,n.PROJECTS_VIEW_ALL,n.USERS_CREATE,n.USERS_READ,n.USERS_UPDATE,n.USERS_DELETE,n.USERS_MANAGE_ROLES,n.USERS_VIEW_ALL,n.FINANCES_VIEW,n.FINANCES_EDIT,n.FINANCES_APPROVE,n.FINANCES_EXPORT,n.FINANCES_DELETE,n.DOCUMENTS_UPLOAD,n.DOCUMENTS_DOWNLOAD,n.DOCUMENTS_DELETE,n.DOCUMENTS_SHARE,n.DOCUMENTS_VIEW_ALL,n.REPORTS_VIEW,n.REPORTS_GENERATE,n.REPORTS_EXPORT,n.REPORTS_ADVANCED,n.AI_BUBBLES,n.AI_ADVANCED,n.AI_MANAGE_SETTINGS,n.SETTINGS_VIEW,n.SETTINGS_EDIT,n.SETTINGS_MANAGE_INTEGRATIONS,n.SETTINGS_SYSTEM_CONFIG,n.CALENDAR_VIEW,n.CALENDAR_EDIT,n.CALENDAR_MANAGE,n.WORKFLOW_VIEW,n.WORKFLOW_EDIT,n.WORKFLOW_MANAGE,n.WORKFLOW_APPROVE,n.COMMUNICATION_SEND,n.COMMUNICATION_MANAGE,n.COMMUNICATION_BULK,n.DATA_PUBLIC,n.DATA_INTERNAL,n.DATA_CONFIDENTIAL,n.DATA_RESTRICTED],MANAGER:[n.PROJECTS_CREATE,n.PROJECTS_READ,n.PROJECTS_UPDATE,n.PROJECTS_ASSIGN,n.PROJECTS_VIEW_ALL,n.USERS_READ,n.USERS_UPDATE,n.USERS_VIEW_ALL,n.FINANCES_VIEW,n.FINANCES_EDIT,n.FINANCES_EXPORT,n.DOCUMENTS_UPLOAD,n.DOCUMENTS_DOWNLOAD,n.DOCUMENTS_SHARE,n.DOCUMENTS_VIEW_ALL,n.REPORTS_VIEW,n.REPORTS_GENERATE,n.REPORTS_EXPORT,n.AI_BUBBLES,n.AI_ADVANCED,n.SETTINGS_VIEW,n.SETTINGS_EDIT,n.CALENDAR_VIEW,n.CALENDAR_EDIT,n.CALENDAR_MANAGE,n.WORKFLOW_VIEW,n.WORKFLOW_EDIT,n.WORKFLOW_MANAGE,n.COMMUNICATION_SEND,n.COMMUNICATION_MANAGE,n.COMMUNICATION_BULK,n.DATA_PUBLIC,n.DATA_INTERNAL,n.DATA_CONFIDENTIAL],PROJECT_MANAGER:[n.PROJECTS_CREATE,n.PROJECTS_READ,n.PROJECTS_UPDATE,n.PROJECTS_VIEW_ASSIGNED,n.USERS_READ,n.FINANCES_VIEW,n.DOCUMENTS_UPLOAD,n.DOCUMENTS_DOWNLOAD,n.DOCUMENTS_SHARE,n.REPORTS_VIEW,n.REPORTS_GENERATE,n.AI_BUBBLES,n.SETTINGS_VIEW,n.CALENDAR_VIEW,n.CALENDAR_EDIT,n.WORKFLOW_VIEW,n.WORKFLOW_EDIT,n.COMMUNICATION_SEND,n.DATA_PUBLIC,n.DATA_INTERNAL],FOREMAN:[n.PROJECTS_READ,n.PROJECTS_VIEW_ASSIGNED,n.DOCUMENTS_UPLOAD,n.DOCUMENTS_DOWNLOAD,n.REPORTS_VIEW,n.AI_BUBBLES,n.CALENDAR_VIEW,n.WORKFLOW_VIEW,n.WORKFLOW_EDIT,n.COMMUNICATION_SEND,n.DATA_PUBLIC,n.DATA_INTERNAL],WORKER:[n.PROJECTS_READ,n.PROJECTS_VIEW_ASSIGNED,n.DOCUMENTS_DOWNLOAD,n.CALENDAR_VIEW,n.WORKFLOW_VIEW,n.DATA_PUBLIC],CLIENT:[n.PROJECTS_READ,n.PROJECTS_VIEW_ASSIGNED,n.DOCUMENTS_DOWNLOAD,n.REPORTS_VIEW,n.CALENDAR_VIEW,n.DATA_PUBLIC],SUBCONTRACTOR:[n.PROJECTS_READ,n.PROJECTS_VIEW_ASSIGNED,n.DOCUMENTS_DOWNLOAD,n.CALENDAR_VIEW,n.WORKFLOW_VIEW,n.DATA_PUBLIC]},s=(e,t)=>{if(!e||!t)return!1;return(a[e.toUpperCase()]||[]).includes(t)},o=(e,t)=>!!(e&&t&&Array.isArray(t))&&t.some(t=>s(e,t)),i=(e,t)=>!!(e&&t&&Array.isArray(t))&&t.every(t=>s(e,t)),l=e=>e&&a[e.toUpperCase()]||[],c=(e,t)=>{const r={public:[n.DATA_PUBLIC],internal:[n.DATA_PUBLIC,n.DATA_INTERNAL],confidential:[n.DATA_PUBLIC,n.DATA_INTERNAL,n.DATA_CONFIDENTIAL],restricted:[n.DATA_PUBLIC,n.DATA_INTERNAL,n.DATA_CONFIDENTIAL,n.DATA_RESTRICTED]};return o(e,r[t]||[])},d=(e,t,r)=>c(e,r)?t:[],u={ADMIN:100,MANAGER:80,PROJECT_MANAGER:60,FOREMAN:40,WORKER:20,CLIENT:10,SUBCONTRACTOR:10},h=(e,t)=>(u[null===e||void 0===e?void 0:e.toUpperCase()]||0)>(u[null===t||void 0===t?void 0:t.toUpperCase()]||0),m=e=>({ADMIN:"Administrator",MANAGER:"Manager",PROJECT_MANAGER:"Project Manager",FOREMAN:"Foreman",WORKER:"Worker",CLIENT:"Client",SUBCONTRACTOR:"Subcontractor"}[null===e||void 0===e?void 0:e.toUpperCase()]||e),p=e=>({ADMIN:"red",MANAGER:"purple",PROJECT_MANAGER:"blue",FOREMAN:"orange",WORKER:"green",CLIENT:"gray",SUBCONTRACTOR:"yellow"}[null===e||void 0===e?void 0:e.toUpperCase()]||"gray"),f={PERMISSIONS:n,ROLE_PERMISSIONS:a,hasPermission:s,hasAnyPermission:o,hasAllPermissions:i,getRolePermissions:l,canAccessDataLevel:c,filterDataByPermissions:d,ROLE_HIERARCHY:u,isRoleHigher:h,getRoleDisplayName:m,getRoleColor:p}},2284:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}r.d(t,{A:()=>n})},2611:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=r},2730:(e,t,r)=>{var n=r(5043),a=r(7067);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,i={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(i[e]=t,e=0;e<t.length;e++)o.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},p={};function f(e,t,r,n,a,s,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function x(e){return e[1].toUpperCase()}function b(e,t,r,n){var a=g.hasOwnProperty(t)?g[t]:null;(null!==a?0!==a.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,r,n){if(null===t||"undefined"===typeof t||function(e,t,r,n){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,r,a,n)&&(r=null),n||null===a?function(e){return!!u.call(p,e)||!u.call(m,e)&&(h.test(e)?p[e]=!0:(m[e]=!0,!1))}(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=null===r?3!==a.type&&"":r:(t=a.attributeName,n=a.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(a=a.type)||4===a&&!0===r?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,x);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,x);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,x);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var y=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),j=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),T=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function M(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var O,R=Object.assign;function F(e){if(void 0===O)try{throw Error()}catch(Ot){var t=Ot.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var U=!1;function B(e,t){if(!e||U)return"";U=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(Tt){var n=Tt}Reflect.construct(e,[],t)}else{try{t.call()}catch(Tt){n=Tt}e.call(t.prototype)}else{try{throw Error()}catch(Tt){n=Tt}e()}}catch(Tt){if(Tt&&n&&"string"===typeof Tt.stack){for(var a=Tt.stack.split("\n"),s=n.stack.split("\n"),o=a.length-1,i=s.length-1;1<=o&&0<=i&&a[o]!==s[i];)i--;for(;1<=o&&0<=i;o--,i--)if(a[o]!==s[i]){if(1!==o||1!==i)do{if(o--,0>--i||a[o]!==s[i]){var l="\n"+a[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=i);break}}}finally{U=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?F(e):""}function z(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case N:return"Fragment";case j:return"Portal";case k:return"Profiler";case S:return"StrictMode";case P:return"Suspense";case _:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:W(e.type)||"Memo";case T:t=e._payload,e=e._init;try{return W(e(t))}catch(Ot){}}return null}function q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var a=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){n=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=H(e)?e.checked?"true":"false":e.value),(e=n)!==r&&(t.setValue(e),!0)}function J(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var r=t.checked;return R({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function X(e,t){var r=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;r=V(null!=t.value?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Z(e,t){Q(e,t);var r=V(t.value),n=t.type;if(null!=r)"number"===n?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,r):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function ee(e,t,r){"number"===t&&J(e.ownerDocument)===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var te=Array.isArray;function re(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+V(r),t=null,a=0;a<e.length;a++){if(e[a].value===r)return e[a].selected=!0,void(n&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return R({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(s(92));if(te(r)){if(1<r.length)throw Error(s(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:V(r)}}function se(e,t){var r=V(t.value),n=V(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=n&&(e.defaultValue=""+n)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ie(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ie(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r)})}:e}(function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ue(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function pe(e,t,r){return null==t||"boolean"===typeof t||""===t?"":r||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function fe(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var n=0===r.indexOf("--"),a=pe(r,t[r],n);"float"===r&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}Object.keys(he).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]})});var ge=R({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function ye(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,je=null,Ne=null;function Se(e){if(e=Ea(e)){if("function"!==typeof we)throw Error(s(280));var t=e.stateNode;t&&(t=_a(t),we(e.stateNode,e.type,t))}}function ke(e){je?Ne?Ne.push(e):Ne=[e]:je=e}function Ae(){if(je){var e=je,t=Ne;if(Ne=je=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Ce(e,t){return e(t)}function Ee(){}var Pe=!1;function _e(e,t,r){if(Pe)return e(t,r);Pe=!0;try{return Ce(e,t,r)}finally{Pe=!1,(null!==je||null!==Ne)&&(Ee(),Ae())}}function Ie(e,t){var r=e.stateNode;if(null===r)return null;var n=_a(r);if(null===n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(r&&"function"!==typeof r)throw Error(s(231,t,typeof r));return r}var Te=!1;if(d)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Te=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(Lt){Te=!1}function De(e,t,r,n,a,s,o,i,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(d){this.onError(d)}}var Me=!1,Oe=null,Re=!1,Fe=null,Ue={onError:function(e){Me=!0,Oe=e}};function Be(e,t,r,n,a,s,o,i,l){Me=!1,Oe=null,De.apply(Ue,arguments)}function ze(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(ze(e)!==e)throw Error(s(188))}function Ve(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=ze(e)))throw Error(s(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(n=a.return)){r=n;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===r)return qe(a),e;if(o===n)return qe(a),t;o=o.sibling}throw Error(s(188))}if(r.return!==n.return)r=a,n=o;else{for(var i=!1,l=a.child;l;){if(l===r){i=!0,r=a,n=o;break}if(l===n){i=!0,n=a,r=o;break}l=l.sibling}if(!i){for(l=o.child;l;){if(l===r){i=!0,r=o,n=a;break}if(l===n){i=!0,n=o,r=a;break}l=l.sibling}if(!i)throw Error(s(189))}}if(r.alternate!==n)throw Error(s(190))}if(3!==r.tag)throw Error(s(188));return r.stateNode.current===r?e:t}(e),null!==e?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var Ge=a.unstable_scheduleCallback,Ke=a.unstable_cancelCallback,Je=a.unstable_shouldYield,Ye=a.unstable_requestPaint,Xe=a.unstable_now,Qe=a.unstable_getCurrentPriorityLevel,Ze=a.unstable_ImmediatePriority,$e=a.unstable_UserBlockingPriority,et=a.unstable_NormalPriority,tt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,nt=null,at=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/it|0)|0},ot=Math.log,it=Math.LN2;var lt=64,ct=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ut(e,t){var r=e.pendingLanes;if(0===r)return 0;var n=0,a=e.suspendedLanes,s=e.pingedLanes,o=268435455&r;if(0!==o){var i=o&~a;0!==i?n=dt(i):0!==(s&=o)&&(n=dt(s))}else 0!==(o=r&~a)?n=dt(o):0!==s&&(n=dt(s));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&a)&&((a=n&-n)>=(s=t&-t)||16===a&&0!==(4194240&s)))return t;if(0!==(4&n)&&(n|=16&r),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)a=1<<(r=31-st(t)),n|=e[r],t&=~a;return n}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function ft(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function gt(e,t,r){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=r}function vt(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-st(r),a=1<<n;a&t|e[n]&t&&(e[n]|=t),r&=~a}}var xt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var yt,wt,jt,Nt,St,kt=!1,At=[],Ct=null,Et=null,Pt=null,Dt=new Map,Mt=new Map,Rt=[],Ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ut(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":Et=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mt.delete(t.pointerId)}}function Wt(e,t,r,n,a,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[a]},null!==t&&(null!==(t=Ea(t))&&wt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Vt(e){var t=Ca(e.target);if(null!==t){var r=ze(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=We(r)))return e.blockedOn=t,void St(e.priority,function(){jt(r)})}else if(3===t&&r.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function Ht(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=rr(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==r)return null!==(t=Ea(r))&&wt(t),e.blockedOn=r,!1;var n=new(r=e.nativeEvent).constructor(r.type,r);be=n,r.target.dispatchEvent(n),be=null,t.shift()}return!0}function Gt(e,t,r){Ht(e)&&r.delete(t)}function Kt(){kt=!1,null!==Ct&&Ht(Ct)&&(Ct=null),null!==Et&&Ht(Et)&&(Et=null),null!==Pt&&Ht(Pt)&&(Pt=null),Dt.forEach(Gt),Mt.forEach(Gt)}function Jt(e,t){e.blockedOn===t&&(e.blockedOn=null,kt||(kt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Kt)))}function Yt(e){function t(t){return Jt(t,e)}if(0<At.length){Jt(At[0],e);for(var r=1;r<At.length;r++){var n=At[r];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Ct&&Jt(Ct,e),null!==Et&&Jt(Et,e),null!==Pt&&Jt(Pt,e),Dt.forEach(t),Mt.forEach(t),r=0;r<Rt.length;r++)(n=Rt[r]).blockedOn===e&&(n.blockedOn=null);for(;0<Rt.length&&null===(r=Rt[0]).blockedOn;)Vt(r),null===r.blockedOn&&Rt.shift()}var Xt=y.ReactCurrentBatchConfig,Qt=!0;function Zt(e,t,r,n){var a=xt,s=Xt.transition;Xt.transition=null;try{xt=1,er(e,t,r,n)}finally{xt=a,Xt.transition=s}}function $t(e,t,r,n){var a=xt,s=Xt.transition;Xt.transition=null;try{xt=4,er(e,t,r,n)}finally{xt=a,Xt.transition=s}}function er(e,t,r,n){if(Qt){var a=rr(e,t,r,n);if(null===a)$n(e,t,n,tr,r),Ut(e,n);else if(function(e,t,r,n,a){switch(t){case"focusin":return Ct=Wt(Ct,e,t,r,n,a),!0;case"dragenter":return Et=Wt(Et,e,t,r,n,a),!0;case"mouseover":return Pt=Wt(Pt,e,t,r,n,a),!0;case"pointerover":var s=a.pointerId;return Dt.set(s,Wt(Dt.get(s)||null,e,t,r,n,a)),!0;case"gotpointercapture":return s=a.pointerId,Mt.set(s,Wt(Mt.get(s)||null,e,t,r,n,a)),!0}return!1}(a,e,t,r,n))n.stopPropagation();else if(Ut(e,n),4&t&&-1<Ft.indexOf(e)){for(;null!==a;){var s=Ea(a);if(null!==s&&yt(s),null===(s=rr(e,t,r,n))&&$n(e,t,n,tr,r),s===a)break;a=s}null!==a&&n.stopPropagation()}else $n(e,t,n,null,r)}}var tr=null;function rr(e,t,r,n){if(tr=null,null!==(e=Ca(e=ye(n))))if(null===(t=ze(e)))e=null;else if(13===(r=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===r){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return tr=e,null}function nr(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Ze:return 1;case $e:return 4;case et:case tt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var ar=null,sr=null,or=null;function ir(){if(or)return or;var e,t,r=sr,n=r.length,a="value"in ar?ar.value:ar.textContent,s=a.length;for(e=0;e<n&&r[e]===a[e];e++);var o=n-e;for(t=1;t<=o&&r[n-t]===a[s-t];t++);return or=a.slice(e,1<t?1-t:void 0)}function cr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function dr(){return!0}function ur(){return!1}function hr(e){function t(t,r,n,a,s){for(var o in this._reactName=t,this._targetInst=n,this.type=r,this.nativeEvent=a,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?dr:ur,this.isPropagationStopped=ur,this}return R(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=dr)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=dr)},persist:function(){},isPersistent:dr}),t}var mr,pr,fr,gr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vr=hr(gr),xr=R({},gr,{view:0,detail:0}),br=hr(xr),yr=R({},xr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lr,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==fr&&(fr&&"mousemove"===e.type?(mr=e.screenX-fr.screenX,pr=e.screenY-fr.screenY):pr=mr=0,fr=e),mr)},movementY:function(e){return"movementY"in e?e.movementY:pr}}),wr=hr(yr),jr=hr(R({},yr,{dataTransfer:0})),Nr=hr(R({},xr,{relatedTarget:0})),kr=hr(R({},gr,{animationName:0,elapsedTime:0,pseudoElement:0})),Ar=R({},gr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Cr=hr(Ar),Er=hr(R({},gr,{data:0})),Pr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_r={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ir={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Ir[e])&&!!t[e]}function Lr(){return Tr}var Dr=R({},xr,{key:function(e){if(e.key){var t=Pr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=cr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_r[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lr,charCode:function(e){return"keypress"===e.type?cr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?cr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Mr=hr(Dr),Or=hr(R({},yr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rr=hr(R({},xr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lr})),Fr=hr(R({},gr,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ur=R({},yr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Br=hr(Ur),zr=[9,13,27,32],Wr=d&&"CompositionEvent"in window,qr=null;d&&"documentMode"in document&&(qr=document.documentMode);var Vr=d&&"TextEvent"in window&&!qr,Hr=d&&(!Wr||qr&&8<qr&&11>=qr),Gr=String.fromCharCode(32),Kr=!1;function Jr(e,t){switch(e){case"keyup":return-1!==zr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Xr=!1;var Qr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Qr[e.type]:"textarea"===t}function $r(e,t,r,n){ke(n),0<(t=ta(t,"onChange")).length&&(r=new vr("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var en=null,tn=null;function rn(e){Kn(e,0)}function nn(e){if(K(Pa(e)))return e}function an(e,t){if("change"===e)return t}var sn=!1;if(d){var on;if(d){var ln="oninput"in document;if(!ln){var cn=document.createElement("div");cn.setAttribute("oninput","return;"),ln="function"===typeof cn.oninput}on=ln}else on=!1;sn=on&&(!document.documentMode||9<document.documentMode)}function dn(){en&&(en.detachEvent("onpropertychange",un),tn=en=null)}function un(e){if("value"===e.propertyName&&nn(tn)){var t=[];$r(t,tn,e,ye(e)),_e(rn,t)}}function hn(e,t,r){"focusin"===e?(dn(),tn=r,(en=t).attachEvent("onpropertychange",un)):"focusout"===e&&dn()}function mn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return nn(tn)}function pn(e,t){if("click"===e)return nn(t)}function fn(e,t){if("input"===e||"change"===e)return nn(t)}var gn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function vn(e,t){if(gn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var a=r[n];if(!u.call(t,a)||!gn(e[a],t[a]))return!1}return!0}function xn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function bn(e,t){var r,n=xn(e);for(e=0;n;){if(3===n.nodeType){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=xn(n)}}function yn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?yn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function wn(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var r="string"===typeof t.contentWindow.location.href}catch(Bt){r=!1}if(!r)break;t=J((e=t.contentWindow).document)}return t}function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function Nn(e){var t=wn(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&yn(r.ownerDocument.documentElement,r)){if(null!==n&&jn(r))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if((e=(t=r.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=r.textContent.length,s=Math.min(n.start,a);n=void 0===n.end?s:Math.min(n.end,a),!e.extend&&s>n&&(a=n,n=s,s=a),a=bn(r,s);var o=bn(r,n);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=r;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof r.focus&&r.focus(),r=0;r<t.length;r++)(e=t[r]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Sn=d&&"documentMode"in document&&11>=document.documentMode,kn=null,An=null,Cn=null,En=!1;function Pn(e,t,r){var n=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;En||null==kn||kn!==J(n)||("selectionStart"in(n=kn)&&jn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Cn&&vn(Cn,n)||(Cn=n,0<(n=ta(An,"onSelect")).length&&(t=new vr("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=kn)))}function _n(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var In={animationend:_n("Animation","AnimationEnd"),animationiteration:_n("Animation","AnimationIteration"),animationstart:_n("Animation","AnimationStart"),transitionend:_n("Transition","TransitionEnd")},Tn={},Ln={};function Dn(e){if(Tn[e])return Tn[e];if(!In[e])return e;var t,r=In[e];for(t in r)if(r.hasOwnProperty(t)&&t in Ln)return Tn[e]=r[t];return e}d&&(Ln=document.createElement("div").style,"AnimationEvent"in window||(delete In.animationend.animation,delete In.animationiteration.animation,delete In.animationstart.animation),"TransitionEvent"in window||delete In.transitionend.transition);var Mn=Dn("animationend"),On=Dn("animationiteration"),Rn=Dn("animationstart"),Fn=Dn("transitionend"),Un=new Map,Bn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zn(e,t){Un.set(e,t),l(t,[e])}for(var Wn=0;Wn<Bn.length;Wn++){var qn=Bn[Wn];zn(qn.toLowerCase(),"on"+(qn[0].toUpperCase()+qn.slice(1)))}zn(Mn,"onAnimationEnd"),zn(On,"onAnimationIteration"),zn(Rn,"onAnimationStart"),zn("dblclick","onDoubleClick"),zn("focusin","onFocus"),zn("focusout","onBlur"),zn(Fn,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vn));function Gn(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,function(e,t,r,n,a,o,i,l,c){if(Be.apply(this,arguments),Me){if(!Me)throw Error(s(198));var d=Oe;Me=!1,Oe=null,Re||(Re=!0,Fe=d)}}(n,t,void 0,e),e.currentTarget=null}function Kn(e,t){t=0!==(4&t);for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var o=n.length-1;0<=o;o--){var i=n[o],l=i.instance,c=i.currentTarget;if(i=i.listener,l!==s&&a.isPropagationStopped())break e;Gn(a,i,c),s=l}else for(o=0;o<n.length;o++){if(l=(i=n[o]).instance,c=i.currentTarget,i=i.listener,l!==s&&a.isPropagationStopped())break e;Gn(a,i,c),s=l}}}if(Re)throw e=Fe,Re=!1,Fe=null,e}function Jn(e,t){var r=t[Sa];void 0===r&&(r=t[Sa]=new Set);var n=e+"__bubble";r.has(n)||(Zn(t,e,2,!1),r.add(n))}function Yn(e,t,r){var n=0;t&&(n|=4),Zn(r,e,n,t)}var Xn="_reactListening"+Math.random().toString(36).slice(2);function Qn(e){if(!e[Xn]){e[Xn]=!0,o.forEach(function(t){"selectionchange"!==t&&(Hn.has(t)||Yn(t,!1,e),Yn(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Xn]||(t[Xn]=!0,Yn("selectionchange",!1,t))}}function Zn(e,t,r,n){switch(nr(t)){case 1:var a=Zt;break;case 4:a=$t;break;default:a=er}r=a.bind(null,t,r,e),a=void 0,!Te||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),n?void 0!==a?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):void 0!==a?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function $n(e,t,r,n,a){var s=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var o=n.tag;if(3===o||4===o){var i=n.stateNode.containerInfo;if(i===a||8===i.nodeType&&i.parentNode===a)break;if(4===o)for(o=n.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===a||8===l.nodeType&&l.parentNode===a))return;o=o.return}for(;null!==i;){if(null===(o=Ca(i)))return;if(5===(l=o.tag)||6===l){n=s=o;continue e}i=i.parentNode}}n=n.return}_e(function(){var n=s,a=ye(r),o=[];e:{var i=Un.get(e);if(void 0!==i){var l=vr,c=e;switch(e){case"keypress":if(0===cr(r))break e;case"keydown":case"keyup":l=Mr;break;case"focusin":c="focus",l=Nr;break;case"focusout":c="blur",l=Nr;break;case"beforeblur":case"afterblur":l=Nr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=wr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=jr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Rr;break;case Mn:case On:case Rn:l=kr;break;case Fn:l=Fr;break;case"scroll":l=br;break;case"wheel":l=Br;break;case"copy":case"cut":case"paste":l=Cr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Or}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==i?i+"Capture":null:i;d=[];for(var m,p=n;null!==p;){var f=(m=p).stateNode;if(5===m.tag&&null!==f&&(m=f,null!==h&&(null!=(f=Ie(p,h))&&d.push(ea(p,f,m)))),u)break;p=p.return}0<d.length&&(i=new l(i,c,null,r,a),o.push({event:i,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(i="mouseover"===e||"pointerover"===e)||r===be||!(c=r.relatedTarget||r.fromElement)||!Ca(c)&&!c[Na])&&(l||i)&&(i=a.window===a?a:(i=a.ownerDocument)?i.defaultView||i.parentWindow:window,l?(l=n,null!==(c=(c=r.relatedTarget||r.toElement)?Ca(c):null)&&(c!==(u=ze(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(d=wr,f="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(d=Or,f="onPointerLeave",h="onPointerEnter",p="pointer"),u=null==l?i:Pa(l),m=null==c?i:Pa(c),(i=new d(f,p+"leave",l,r,a)).target=u,i.relatedTarget=m,f=null,Ca(a)===n&&((d=new d(h,p+"enter",c,r,a)).target=m,d.relatedTarget=u,f=d),u=f,l&&c)e:{for(h=c,p=0,m=d=l;m;m=ra(m))p++;for(m=0,f=h;f;f=ra(f))m++;for(;0<p-m;)d=ra(d),p--;for(;0<m-p;)h=ra(h),m--;for(;p--;){if(d===h||null!==h&&d===h.alternate)break e;d=ra(d),h=ra(h)}d=null}else d=null;null!==l&&na(o,i,l,d,!1),null!==c&&null!==u&&na(o,u,c,d,!0)}if("select"===(l=(i=n?Pa(n):window).nodeName&&i.nodeName.toLowerCase())||"input"===l&&"file"===i.type)var g=an;else if(Zr(i))if(sn)g=fn;else{g=mn;var v=hn}else(l=i.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(g=pn);switch(g&&(g=g(e,n))?$r(o,g,r,a):(v&&v(e,i,n),"focusout"===e&&(v=i._wrapperState)&&v.controlled&&"number"===i.type&&ee(i,"number",i.value)),v=n?Pa(n):window,e){case"focusin":(Zr(v)||"true"===v.contentEditable)&&(kn=v,An=n,Cn=null);break;case"focusout":Cn=An=kn=null;break;case"mousedown":En=!0;break;case"contextmenu":case"mouseup":case"dragend":En=!1,Pn(o,r,a);break;case"selectionchange":if(Sn)break;case"keydown":case"keyup":Pn(o,r,a)}var x;if(Wr)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Xr?Jr(e,r)&&(b="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(b="onCompositionStart");b&&(Hr&&"ko"!==r.locale&&(Xr||"onCompositionStart"!==b?"onCompositionEnd"===b&&Xr&&(x=ir()):(sr="value"in(ar=a)?ar.value:ar.textContent,Xr=!0)),0<(v=ta(n,b)).length&&(b=new Er(b,e,null,r,a),o.push({event:b,listeners:v}),x?b.data=x:null!==(x=Yr(r))&&(b.data=x))),(x=Vr?function(e,t){switch(e){case"compositionend":return Yr(t);case"keypress":return 32!==t.which?null:(Kr=!0,Gr);case"textInput":return(e=t.data)===Gr&&Kr?null:e;default:return null}}(e,r):function(e,t){if(Xr)return"compositionend"===e||!Wr&&Jr(e,t)?(e=ir(),or=sr=ar=null,Xr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Hr&&"ko"!==t.locale?null:t.data}}(e,r))&&(0<(n=ta(n,"onBeforeInput")).length&&(a=new Er("onBeforeInput","beforeinput",null,r,a),o.push({event:a,listeners:n}),a.data=x))}Kn(o,t)})}function ea(e,t,r){return{instance:e,listener:t,currentTarget:r}}function ta(e,t){for(var r=t+"Capture",n=[];null!==e;){var a=e,s=a.stateNode;5===a.tag&&null!==s&&(a=s,null!=(s=Ie(e,r))&&n.unshift(ea(e,s,a)),null!=(s=Ie(e,t))&&n.push(ea(e,s,a))),e=e.return}return n}function ra(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function na(e,t,r,n,a){for(var s=t._reactName,o=[];null!==r&&r!==n;){var i=r,l=i.alternate,c=i.stateNode;if(null!==l&&l===n)break;5===i.tag&&null!==c&&(i=c,a?null!=(l=Ie(r,s))&&o.unshift(ea(r,l,i)):a||null!=(l=Ie(r,s))&&o.push(ea(r,l,i))),r=r.return}0!==o.length&&e.push({event:t,listeners:o})}var aa=/\r\n?/g,sa=/\u0000|\uFFFD/g;function oa(e){return("string"===typeof e?e:""+e).replace(aa,"\n").replace(sa,"")}function ia(e,t,r){if(t=oa(t),oa(e)!==t&&r)throw Error(s(425))}function la(){}var ca=null,da=null;function ua(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ha="function"===typeof setTimeout?setTimeout:void 0,ma="function"===typeof clearTimeout?clearTimeout:void 0,pa="function"===typeof Promise?Promise:void 0,fa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof pa?function(e){return pa.resolve(null).then(e).catch(ga)}:ha;function ga(e){setTimeout(function(){throw e})}function va(e,t){var r=t,n=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&8===a.nodeType)if("/$"===(r=a.data)){if(0===n)return e.removeChild(a),void Yt(t);n--}else"$"!==r&&"$?"!==r&&"$!"!==r||n++;r=a}while(r);Yt(t)}function xa(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ba(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r){if(0===t)return e;t--}else"/$"===r&&t++}e=e.previousSibling}return null}var ya=Math.random().toString(36).slice(2),wa="__reactFiber$"+ya,ja="__reactProps$"+ya,Na="__reactContainer$"+ya,Sa="__reactEvents$"+ya,ka="__reactListeners$"+ya,Aa="__reactHandles$"+ya;function Ca(e){var t=e[wa];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Na]||r[wa]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=ba(e);null!==e;){if(r=e[wa])return r;e=ba(e)}return t}r=(e=r).parentNode}return null}function Ea(e){return!(e=e[wa]||e[Na])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Pa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function _a(e){return e[ja]||null}var Ia=[],Ta=-1;function La(e){return{current:e}}function Da(e){0>Ta||(e.current=Ia[Ta],Ia[Ta]=null,Ta--)}function Ma(e,t){Ta++,Ia[Ta]=e.current,e.current=t}var Oa={},Ra=La(Oa),Fa=La(!1),Ua=Oa;function Ba(e,t){var r=e.type.contextTypes;if(!r)return Oa;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a,s={};for(a in r)s[a]=t[a];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function za(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Wa(){Da(Fa),Da(Ra)}function qa(e,t,r){if(Ra.current!==Oa)throw Error(s(168));Ma(Ra,t),Ma(Fa,r)}function Va(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return r;for(var a in n=n.getChildContext())if(!(a in t))throw Error(s(108,q(e)||"Unknown",a));return R({},r,n)}function Ha(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Oa,Ua=Ra.current,Ma(Ra,e),Ma(Fa,Fa.current),!0}function Ga(e,t,r){var n=e.stateNode;if(!n)throw Error(s(169));r?(e=Va(e,t,Ua),n.__reactInternalMemoizedMergedChildContext=e,Da(Fa),Da(Ra),Ma(Ra,e)):Da(Fa),Ma(Fa,r)}var Ka=null,Ja=!1,Ya=!1;function Xa(e){null===Ka?Ka=[e]:Ka.push(e)}function Qa(){if(!Ya&&null!==Ka){Ya=!0;var e=0,t=xt;try{var r=Ka;for(xt=1;e<r.length;e++){var n=r[e];do{n=n(!0)}while(null!==n)}Ka=null,Ja=!1}catch(_t){throw null!==Ka&&(Ka=Ka.slice(e+1)),Ge(Ze,Qa),_t}finally{xt=t,Ya=!1}}return null}var Za=[],$a=0,es=null,ts=0,rs=[],ns=0,as=null,ss=1,os="";function is(e,t){Za[$a++]=ts,Za[$a++]=es,es=e,ts=t}function ls(e,t,r){rs[ns++]=ss,rs[ns++]=os,rs[ns++]=as,as=e;var n=ss;e=os;var a=32-st(n)-1;n&=~(1<<a),r+=1;var s=32-st(t)+a;if(30<s){var o=a-a%5;s=(n&(1<<o)-1).toString(32),n>>=o,a-=o,ss=1<<32-st(t)+a|r<<a|n,os=s+e}else ss=1<<s|r<<a|n,os=e}function cs(e){null!==e.return&&(is(e,1),ls(e,1,0))}function ds(e){for(;e===es;)es=Za[--$a],Za[$a]=null,ts=Za[--$a],Za[$a]=null;for(;e===as;)as=rs[--ns],rs[ns]=null,os=rs[--ns],rs[ns]=null,ss=rs[--ns],rs[ns]=null}var us=null,hs=null,ms=!1,ps=null;function fs(e,t){var r=Bc(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,null===(t=e.deletions)?(e.deletions=[r],e.flags|=16):t.push(r)}function gs(e,t){switch(e.tag){case 5:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,us=e,hs=xa(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,us=e,hs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(r=null!==as?{id:ss,overflow:os}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},(r=Bc(18,null,null,0)).stateNode=t,r.return=e,e.child=r,us=e,hs=null,!0);default:return!1}}function vs(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function xs(e){if(ms){var t=hs;if(t){var r=t;if(!gs(e,t)){if(vs(e))throw Error(s(418));t=xa(r.nextSibling);var n=us;t&&gs(e,t)?fs(n,r):(e.flags=-4097&e.flags|2,ms=!1,us=e)}}else{if(vs(e))throw Error(s(418));e.flags=-4097&e.flags|2,ms=!1,us=e}}}function bs(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;us=e}function ys(e){if(e!==us)return!1;if(!ms)return bs(e),ms=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ua(e.type,e.memoizedProps)),t&&(t=hs)){if(vs(e))throw ws(),Error(s(418));for(;t;)fs(e,t),t=xa(t.nextSibling)}if(bs(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r){if(0===t){hs=xa(e.nextSibling);break e}t--}else"$"!==r&&"$!"!==r&&"$?"!==r||t++}e=e.nextSibling}hs=null}}else hs=us?xa(e.stateNode.nextSibling):null;return!0}function ws(){for(var e=hs;e;)e=xa(e.nextSibling)}function js(){hs=us=null,ms=!1}function Ns(e){null===ps?ps=[e]:ps.push(e)}var Ss=y.ReactCurrentBatchConfig;function ks(e,t,r){if(null!==(e=r.ref)&&"function"!==typeof e&&"object"!==typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(s(309));var n=r.stateNode}if(!n)throw Error(s(147,e));var a=n,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(s(284));if(!r._owner)throw Error(s(290,e))}return e}function As(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Cs(e){return(0,e._init)(e._payload)}function Es(e){function t(t,r){if(e){var n=t.deletions;null===n?(t.deletions=[r],t.flags|=16):n.push(r)}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Wc(e,t)).index=0,e.sibling=null,e}function o(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.flags|=2,r):n:(t.flags|=2,r):(t.flags|=1048576,r)}function i(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,r,n){return null===t||6!==t.tag?((t=Gc(r,e.mode,n)).return=e,t):((t=a(t,r)).return=e,t)}function c(e,t,r,n){var s=r.type;return s===N?u(e,t,r.props.children,n,r.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===T&&Cs(s)===t.type)?((n=a(t,r.props)).ref=ks(e,t,r),n.return=e,n):((n=qc(r.type,r.key,r.props,null,e.mode,n)).ref=ks(e,t,r),n.return=e,n)}function d(e,t,r,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Kc(r,e.mode,n)).return=e,t):((t=a(t,r.children||[])).return=e,t)}function u(e,t,r,n,s){return null===t||7!==t.tag?((t=Vc(r,e.mode,n,s)).return=e,t):((t=a(t,r)).return=e,t)}function h(e,t,r){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Gc(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(r=qc(t.type,t.key,t.props,null,e.mode,r)).ref=ks(e,null,t),r.return=e,r;case j:return(t=Kc(t,e.mode,r)).return=e,t;case T:return h(e,(0,t._init)(t._payload),r)}if(te(t)||M(t))return(t=Vc(t,e.mode,r,null)).return=e,t;As(e,t)}return null}function m(e,t,r,n){var a=null!==t?t.key:null;if("string"===typeof r&&""!==r||"number"===typeof r)return null!==a?null:l(e,t,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return r.key===a?c(e,t,r,n):null;case j:return r.key===a?d(e,t,r,n):null;case T:return m(e,t,(a=r._init)(r._payload),n)}if(te(r)||M(r))return null!==a?null:u(e,t,r,n,null);As(e,r)}return null}function p(e,t,r,n,a){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(r)||null,""+n,a);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return c(t,e=e.get(null===n.key?r:n.key)||null,n,a);case j:return d(t,e=e.get(null===n.key?r:n.key)||null,n,a);case T:return p(e,t,r,(0,n._init)(n._payload),a)}if(te(n)||M(n))return u(t,e=e.get(r)||null,n,a,null);As(t,n)}return null}function f(a,s,i,l){for(var c=null,d=null,u=s,f=s=0,g=null;null!==u&&f<i.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var v=m(a,u,i[f],l);if(null===v){null===u&&(u=g);break}e&&u&&null===v.alternate&&t(a,u),s=o(v,s,f),null===d?c=v:d.sibling=v,d=v,u=g}if(f===i.length)return r(a,u),ms&&is(a,f),c;if(null===u){for(;f<i.length;f++)null!==(u=h(a,i[f],l))&&(s=o(u,s,f),null===d?c=u:d.sibling=u,d=u);return ms&&is(a,f),c}for(u=n(a,u);f<i.length;f++)null!==(g=p(u,a,f,i[f],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),s=o(g,s,f),null===d?c=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(a,e)}),ms&&is(a,f),c}function g(a,i,l,c){var d=M(l);if("function"!==typeof d)throw Error(s(150));if(null==(l=d.call(l)))throw Error(s(151));for(var u=d=null,f=i,g=i=0,v=null,x=l.next();null!==f&&!x.done;g++,x=l.next()){f.index>g?(v=f,f=null):v=f.sibling;var b=m(a,f,x.value,c);if(null===b){null===f&&(f=v);break}e&&f&&null===b.alternate&&t(a,f),i=o(b,i,g),null===u?d=b:u.sibling=b,u=b,f=v}if(x.done)return r(a,f),ms&&is(a,g),d;if(null===f){for(;!x.done;g++,x=l.next())null!==(x=h(a,x.value,c))&&(i=o(x,i,g),null===u?d=x:u.sibling=x,u=x);return ms&&is(a,g),d}for(f=n(a,f);!x.done;g++,x=l.next())null!==(x=p(f,a,g,x.value,c))&&(e&&null!==x.alternate&&f.delete(null===x.key?g:x.key),i=o(x,i,g),null===u?d=x:u.sibling=x,u=x);return e&&f.forEach(function(e){return t(a,e)}),ms&&is(a,g),d}return function e(n,s,o,l){if("object"===typeof o&&null!==o&&o.type===N&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var c=o.key,d=s;null!==d;){if(d.key===c){if((c=o.type)===N){if(7===d.tag){r(n,d.sibling),(s=a(d,o.props.children)).return=n,n=s;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===T&&Cs(c)===d.type){r(n,d.sibling),(s=a(d,o.props)).ref=ks(n,d,o),s.return=n,n=s;break e}r(n,d);break}t(n,d),d=d.sibling}o.type===N?((s=Vc(o.props.children,n.mode,l,o.key)).return=n,n=s):((l=qc(o.type,o.key,o.props,null,n.mode,l)).ref=ks(n,s,o),l.return=n,n=l)}return i(n);case j:e:{for(d=o.key;null!==s;){if(s.key===d){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){r(n,s.sibling),(s=a(s,o.children||[])).return=n,n=s;break e}r(n,s);break}t(n,s),s=s.sibling}(s=Kc(o,n.mode,l)).return=n,n=s}return i(n);case T:return e(n,s,(d=o._init)(o._payload),l)}if(te(o))return f(n,s,o,l);if(M(o))return g(n,s,o,l);As(n,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==s&&6===s.tag?(r(n,s.sibling),(s=a(s,o)).return=n,n=s):(r(n,s),(s=Gc(o,n.mode,l)).return=n,n=s),i(n)):r(n,s)}}var Ps=Es(!0),_s=Es(!1),Is=La(null),Ts=null,Ls=null,Ds=null;function Ms(){Ds=Ls=Ts=null}function Os(e){var t=Is.current;Da(Is),e._currentValue=t}function Rs(e,t,r){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Fs(e,t){Ts=e,Ds=Ls=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ei=!0),e.firstContext=null)}function Us(e){var t=e._currentValue;if(Ds!==e)if(e={context:e,memoizedValue:t,next:null},null===Ls){if(null===Ts)throw Error(s(308));Ls=e,Ts.dependencies={lanes:0,firstContext:e}}else Ls=Ls.next=e;return t}var Bs=null;function zs(e){null===Bs?Bs=[e]:Bs.push(e)}function Ws(e,t,r,n){var a=t.interleaved;return null===a?(r.next=r,zs(t)):(r.next=a.next,a.next=r),t.interleaved=r,qs(e,n)}function qs(e,t){e.lanes|=t;var r=e.alternate;for(null!==r&&(r.lanes|=t),r=e,e=e.return;null!==e;)e.childLanes|=t,null!==(r=e.alternate)&&(r.childLanes|=t),r=e,e=e.return;return 3===r.tag?r.stateNode:null}var Vs=!1;function Hs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ks(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Js(e,t,r){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Rl)){var a=n.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),n.pending=t,qs(e,r)}return null===(a=n.interleaved)?(t.next=t,zs(n)):(t.next=a.next,a.next=t),n.interleaved=t,qs(e,r)}function Ys(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&r))){var n=t.lanes;r|=n&=e.pendingLanes,t.lanes=r,vt(e,r)}}function Xs(e,t){var r=e.updateQueue,n=e.alternate;if(null!==n&&r===(n=n.updateQueue)){var a=null,s=null;if(null!==(r=r.firstBaseUpdate)){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===s?a=s=o:s=s.next=o,r=r.next}while(null!==r);null===s?a=s=t:s=s.next=t}else a=s=t;return r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:s,shared:n.shared,effects:n.effects},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Qs(e,t,r,n){var a=e.updateQueue;Vs=!1;var s=a.firstBaseUpdate,o=a.lastBaseUpdate,i=a.shared.pending;if(null!==i){a.shared.pending=null;var l=i,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var d=e.alternate;null!==d&&((i=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===i?d.firstBaseUpdate=c:i.next=c,d.lastBaseUpdate=l))}if(null!==s){var u=a.baseState;for(o=0,d=c=l=null,i=s;;){var h=i.lane,m=i.eventTime;if((n&h)===h){null!==d&&(d=d.next={eventTime:m,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var p=e,f=i;switch(h=t,m=r,f.tag){case 1:if("function"===typeof(p=f.payload)){u=p.call(m,u,h);break e}u=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=f.payload)?p.call(m,u,h):p)||void 0===h)break e;u=R({},u,h);break e;case 2:Vs=!0}}null!==i.callback&&0!==i.lane&&(e.flags|=64,null===(h=a.effects)?a.effects=[i]:h.push(i))}else m={eventTime:m,lane:h,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===d?(c=d=m,l=u):d=d.next=m,o|=h;if(null===(i=i.next)){if(null===(i=a.shared.pending))break;i=(h=i).next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}if(null===d&&(l=u),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=d,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===s&&(a.shared.lanes=0);Hl|=o,e.lanes=o,e.memoizedState=u}}function Zs(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(null!==a){if(n.callback=null,n=r,"function"!==typeof a)throw Error(s(191,a));a.call(n)}}}var $s={},eo=La($s),to=La($s),ro=La($s);function no(e){if(e===$s)throw Error(s(174));return e}function ao(e,t){switch(Ma(ro,t),Ma(to,e),Ma(eo,$s),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Da(eo),Ma(eo,t)}function so(){Da(eo),Da(to),Da(ro)}function oo(e){no(ro.current);var t=no(eo.current),r=le(t,e.type);t!==r&&(Ma(to,e),Ma(eo,r))}function io(e){to.current===e&&(Da(eo),Da(to))}var lo=La(0);function co(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var uo=[];function ho(){for(var e=0;e<uo.length;e++)uo[e]._workInProgressVersionPrimary=null;uo.length=0}var mo=y.ReactCurrentDispatcher,po=y.ReactCurrentBatchConfig,fo=0,go=null,vo=null,xo=null,bo=!1,yo=!1,wo=0,jo=0;function No(){throw Error(s(321))}function So(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!gn(e[r],t[r]))return!1;return!0}function ko(e,t,r,n,a,o){if(fo=o,go=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,mo.current=null===e||null===e.memoizedState?li:ci,e=r(n,a),yo){o=0;do{if(yo=!1,wo=0,25<=o)throw Error(s(301));o+=1,xo=vo=null,t.updateQueue=null,mo.current=di,e=r(n,a)}while(yo)}if(mo.current=ii,t=null!==vo&&null!==vo.next,fo=0,xo=vo=go=null,bo=!1,t)throw Error(s(300));return e}function Ao(){var e=0!==wo;return wo=0,e}function Co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===xo?go.memoizedState=xo=e:xo=xo.next=e,xo}function Eo(){if(null===vo){var e=go.alternate;e=null!==e?e.memoizedState:null}else e=vo.next;var t=null===xo?go.memoizedState:xo.next;if(null!==t)xo=t,vo=e;else{if(null===e)throw Error(s(310));e={memoizedState:(vo=e).memoizedState,baseState:vo.baseState,baseQueue:vo.baseQueue,queue:vo.queue,next:null},null===xo?go.memoizedState=xo=e:xo=xo.next=e}return xo}function Po(e,t){return"function"===typeof t?t(e):t}function _o(e){var t=Eo(),r=t.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=e;var n=vo,a=n.baseQueue,o=r.pending;if(null!==o){if(null!==a){var i=a.next;a.next=o.next,o.next=i}n.baseQueue=a=o,r.pending=null}if(null!==a){o=a.next,n=n.baseState;var l=i=null,c=null,d=o;do{var u=d.lane;if((fo&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,i=n):c=c.next=h,go.lanes|=u,Hl|=u}d=d.next}while(null!==d&&d!==o);null===c?i=n:c.next=l,gn(n,t.memoizedState)||(Ei=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=c,r.lastRenderedState=n}if(null!==(e=r.interleaved)){a=e;do{o=a.lane,go.lanes|=o,Hl|=o,a=a.next}while(a!==e)}else null===a&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Io(e){var t=Eo(),r=t.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,o=t.memoizedState;if(null!==a){r.pending=null;var i=a=a.next;do{o=e(o,i.action),i=i.next}while(i!==a);gn(o,t.memoizedState)||(Ei=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function To(){}function Lo(e,t){var r=go,n=Eo(),a=t(),o=!gn(n.memoizedState,a);if(o&&(n.memoizedState=a,Ei=!0),n=n.queue,Ho(Oo.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||null!==xo&&1&xo.memoizedState.tag){if(r.flags|=2048,Bo(9,Mo.bind(null,r,n,a,t),void 0,null),null===Fl)throw Error(s(349));0!==(30&fo)||Do(r,t,a)}return a}function Do(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=go.updateQueue)?(t={lastEffect:null,stores:null},go.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function Mo(e,t,r,n){t.value=r,t.getSnapshot=n,Ro(t)&&Fo(e)}function Oo(e,t,r){return r(function(){Ro(t)&&Fo(e)})}function Ro(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!gn(e,r)}catch(Bt){return!0}}function Fo(e){var t=qs(e,1);null!==t&&uc(t,e,1,-1)}function Uo(e){var t=Co();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Po,lastRenderedState:e},t.queue=e,e=e.dispatch=ni.bind(null,go,e),[t.memoizedState,e]}function Bo(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},null===(t=go.updateQueue)?(t={lastEffect:null,stores:null},go.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e),e}function zo(){return Eo().memoizedState}function Wo(e,t,r,n){var a=Co();go.flags|=e,a.memoizedState=Bo(1|t,r,void 0,void 0===n?null:n)}function qo(e,t,r,n){var a=Eo();n=void 0===n?null:n;var s=void 0;if(null!==vo){var o=vo.memoizedState;if(s=o.destroy,null!==n&&So(n,o.deps))return void(a.memoizedState=Bo(t,r,s,n))}go.flags|=e,a.memoizedState=Bo(1|t,r,s,n)}function Vo(e,t){return Wo(8390656,8,e,t)}function Ho(e,t){return qo(2048,8,e,t)}function Go(e,t){return qo(4,2,e,t)}function Ko(e,t){return qo(4,4,e,t)}function Jo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Yo(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,qo(4,4,Jo.bind(null,t,e),r)}function Xo(){}function Qo(e,t){var r=Eo();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&So(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Zo(e,t){var r=Eo();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&So(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function $o(e,t,r){return 0===(21&fo)?(e.baseState&&(e.baseState=!1,Ei=!0),e.memoizedState=r):(gn(r,t)||(r=pt(),go.lanes|=r,Hl|=r,e.baseState=!0),t)}function ei(e,t){var r=xt;xt=0!==r&&4>r?r:4,e(!0);var n=po.transition;po.transition={};try{e(!1),t()}finally{xt=r,po.transition=n}}function ti(){return Eo().memoizedState}function ri(e,t,r){var n=dc(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},ai(e))si(t,r);else if(null!==(r=Ws(e,t,r,n))){uc(r,e,n,cc()),oi(r,t,n)}}function ni(e,t,r){var n=dc(e),a={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(ai(e))si(t,a);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,i=s(o,r);if(a.hasEagerState=!0,a.eagerState=i,gn(i,o)){var l=t.interleaved;return null===l?(a.next=a,zs(t)):(a.next=l.next,l.next=a),void(t.interleaved=a)}}catch(Tt){}null!==(r=Ws(e,t,a,n))&&(uc(r,e,n,a=cc()),oi(r,t,n))}}function ai(e){var t=e.alternate;return e===go||null!==t&&t===go}function si(e,t){yo=bo=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function oi(e,t,r){if(0!==(4194240&r)){var n=t.lanes;r|=n&=e.pendingLanes,t.lanes=r,vt(e,r)}}var ii={readContext:Us,useCallback:No,useContext:No,useEffect:No,useImperativeHandle:No,useInsertionEffect:No,useLayoutEffect:No,useMemo:No,useReducer:No,useRef:No,useState:No,useDebugValue:No,useDeferredValue:No,useTransition:No,useMutableSource:No,useSyncExternalStore:No,useId:No,unstable_isNewReconciler:!1},li={readContext:Us,useCallback:function(e,t){return Co().memoizedState=[e,void 0===t?null:t],e},useContext:Us,useEffect:Vo,useImperativeHandle:function(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Wo(4194308,4,Jo.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Wo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Wo(4,2,e,t)},useMemo:function(e,t){var r=Co();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Co();return t=void 0!==r?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=ri.bind(null,go,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},Co().memoizedState=e},useState:Uo,useDebugValue:Xo,useDeferredValue:function(e){return Co().memoizedState=e},useTransition:function(){var e=Uo(!1),t=e[0];return e=ei.bind(null,e[1]),Co().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=go,a=Co();if(ms){if(void 0===r)throw Error(s(407));r=r()}else{if(r=t(),null===Fl)throw Error(s(349));0!==(30&fo)||Do(n,t,r)}a.memoizedState=r;var o={value:r,getSnapshot:t};return a.queue=o,Vo(Oo.bind(null,n,o,e),[e]),n.flags|=2048,Bo(9,Mo.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=Co(),t=Fl.identifierPrefix;if(ms){var r=os;t=":"+t+"R"+(r=(ss&~(1<<32-st(ss)-1)).toString(32)+r),0<(r=wo++)&&(t+="H"+r.toString(32)),t+=":"}else t=":"+t+"r"+(r=jo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ci={readContext:Us,useCallback:Qo,useContext:Us,useEffect:Ho,useImperativeHandle:Yo,useInsertionEffect:Go,useLayoutEffect:Ko,useMemo:Zo,useReducer:_o,useRef:zo,useState:function(){return _o(Po)},useDebugValue:Xo,useDeferredValue:function(e){return $o(Eo(),vo.memoizedState,e)},useTransition:function(){return[_o(Po)[0],Eo().memoizedState]},useMutableSource:To,useSyncExternalStore:Lo,useId:ti,unstable_isNewReconciler:!1},di={readContext:Us,useCallback:Qo,useContext:Us,useEffect:Ho,useImperativeHandle:Yo,useInsertionEffect:Go,useLayoutEffect:Ko,useMemo:Zo,useReducer:Io,useRef:zo,useState:function(){return Io(Po)},useDebugValue:Xo,useDeferredValue:function(e){var t=Eo();return null===vo?t.memoizedState=e:$o(t,vo.memoizedState,e)},useTransition:function(){return[Io(Po)[0],Eo().memoizedState]},useMutableSource:To,useSyncExternalStore:Lo,useId:ti,unstable_isNewReconciler:!1};function ui(e,t){if(e&&e.defaultProps){for(var r in t=R({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}return t}function hi(e,t,r,n){r=null===(r=r(n,t=e.memoizedState))||void 0===r?t:R({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}var mi={isMounted:function(e){return!!(e=e._reactInternals)&&ze(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=cc(),a=dc(e),s=Ks(n,a);s.payload=t,void 0!==r&&null!==r&&(s.callback=r),null!==(t=Js(e,s,a))&&(uc(t,e,a,n),Ys(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=cc(),a=dc(e),s=Ks(n,a);s.tag=1,s.payload=t,void 0!==r&&null!==r&&(s.callback=r),null!==(t=Js(e,s,a))&&(uc(t,e,a,n),Ys(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=cc(),n=dc(e),a=Ks(r,n);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Js(e,a,n))&&(uc(t,e,n,r),Ys(t,e,n))}};function pi(e,t,r,n,a,s,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!vn(r,n)||!vn(a,s))}function fi(e,t,r){var n=!1,a=Oa,s=t.contextType;return"object"===typeof s&&null!==s?s=Us(s):(a=za(t)?Ua:Ra.current,s=(n=null!==(n=t.contextTypes)&&void 0!==n)?Ba(e,a):Oa),t=new t(r,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=mi,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=s),t}function gi(e,t,r,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&mi.enqueueReplaceState(t,t.state,null)}function vi(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs={},Hs(e);var s=t.contextType;"object"===typeof s&&null!==s?a.context=Us(s):(s=za(t)?Ua:Ra.current,a.context=Ba(e,s)),a.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(hi(e,t,s,r),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&mi.enqueueReplaceState(a,a.state,null),Qs(e,r,a,n),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function xi(e,t){try{var r="",n=t;do{r+=z(n),n=n.return}while(n);var a=r}catch(zt){a="\nError generating stack: "+zt.message+"\n"+zt.stack}return{value:e,source:t,stack:a,digest:null}}function bi(e,t,r){return{value:e,source:null,stack:null!=r?r:null,digest:null!=t?t:null}}function yi(e,t){try{console.error(t.value)}catch(Ot){setTimeout(function(){throw Ot})}}var wi="function"===typeof WeakMap?WeakMap:Map;function ji(e,t,r){(r=Ks(-1,r)).tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){$l||($l=!0,ec=n),yi(0,t)},r}function Ni(e,t,r){(r=Ks(-1,r)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var a=t.value;r.payload=function(){return n(a)},r.callback=function(){yi(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(r.callback=function(){yi(0,t),"function"!==typeof n&&(null===tc?tc=new Set([this]):tc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),r}function Si(e,t,r){var n=e.pingCache;if(null===n){n=e.pingCache=new wi;var a=new Set;n.set(t,a)}else void 0===(a=n.get(t))&&(a=new Set,n.set(t,a));a.has(r)||(a.add(r),e=Dc.bind(null,e,t,r),t.then(e,e))}function ki(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ai(e,t,r,n,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,1===r.tag&&(null===r.alternate?r.tag=17:((t=Ks(-1,1)).tag=2,Js(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var Ci=y.ReactCurrentOwner,Ei=!1;function Pi(e,t,r,n){t.child=null===e?_s(t,null,r,n):Ps(t,e.child,r,n)}function _i(e,t,r,n,a){r=r.render;var s=t.ref;return Fs(t,a),n=ko(e,t,r,n,s,a),r=Ao(),null===e||Ei?(ms&&r&&cs(t),t.flags|=1,Pi(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,$i(e,t,a))}function Ii(e,t,r,n,a){if(null===e){var s=r.type;return"function"!==typeof s||zc(s)||void 0!==s.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=qc(r.type,null,n,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ti(e,t,s,n,a))}if(s=e.child,0===(e.lanes&a)){var o=s.memoizedProps;if((r=null!==(r=r.compare)?r:vn)(o,n)&&e.ref===t.ref)return $i(e,t,a)}return t.flags|=1,(e=Wc(s,n)).ref=t.ref,e.return=t,t.child=e}function Ti(e,t,r,n,a){if(null!==e){var s=e.memoizedProps;if(vn(s,n)&&e.ref===t.ref){if(Ei=!1,t.pendingProps=n=s,0===(e.lanes&a))return t.lanes=e.lanes,$i(e,t,a);0!==(131072&e.flags)&&(Ei=!0)}}return Mi(e,t,r,n,a)}function Li(e,t,r){var n=t.pendingProps,a=n.children,s=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ma(Wl,zl),zl|=r;else{if(0===(1073741824&r))return e=null!==s?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ma(Wl,zl),zl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==s?s.baseLanes:r,Ma(Wl,zl),zl|=n}else null!==s?(n=s.baseLanes|r,t.memoizedState=null):n=r,Ma(Wl,zl),zl|=n;return Pi(e,t,a,r),t.child}function Di(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Mi(e,t,r,n,a){var s=za(r)?Ua:Ra.current;return s=Ba(t,s),Fs(t,a),r=ko(e,t,r,n,s,a),n=Ao(),null===e||Ei?(ms&&n&&cs(t),t.flags|=1,Pi(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,$i(e,t,a))}function Oi(e,t,r,n,a){if(za(r)){var s=!0;Ha(t)}else s=!1;if(Fs(t,a),null===t.stateNode)Zi(e,t),fi(t,r,n),vi(t,r,n,a),n=!0;else if(null===e){var o=t.stateNode,i=t.memoizedProps;o.props=i;var l=o.context,c=r.contextType;"object"===typeof c&&null!==c?c=Us(c):c=Ba(t,c=za(r)?Ua:Ra.current);var d=r.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate;u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(i!==n||l!==c)&&gi(t,o,n,c),Vs=!1;var h=t.memoizedState;o.state=h,Qs(t,n,o,a),l=t.memoizedState,i!==n||h!==l||Fa.current||Vs?("function"===typeof d&&(hi(t,r,d,n),l=t.memoizedState),(i=Vs||pi(t,r,i,n,h,l,c))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),o.props=n,o.state=l,o.context=c,n=i):("function"===typeof o.componentDidMount&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,Gs(e,t),i=t.memoizedProps,c=t.type===t.elementType?i:ui(t.type,i),o.props=c,u=t.pendingProps,h=o.context,"object"===typeof(l=r.contextType)&&null!==l?l=Us(l):l=Ba(t,l=za(r)?Ua:Ra.current);var m=r.getDerivedStateFromProps;(d="function"===typeof m||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(i!==u||h!==l)&&gi(t,o,n,l),Vs=!1,h=t.memoizedState,o.state=h,Qs(t,n,o,a);var p=t.memoizedState;i!==u||h!==p||Fa.current||Vs?("function"===typeof m&&(hi(t,r,m,n),p=t.memoizedState),(c=Vs||pi(t,r,c,n,h,p,l)||!1)?(d||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(n,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(n,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=p),o.props=n,o.state=p,o.context=l,n=c):("function"!==typeof o.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return Ri(e,t,r,n,s,a)}function Ri(e,t,r,n,a,s){Di(e,t);var o=0!==(128&t.flags);if(!n&&!o)return a&&Ga(t,r,!1),$i(e,t,s);n=t.stateNode,Ci.current=t;var i=o&&"function"!==typeof r.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&o?(t.child=Ps(t,e.child,null,s),t.child=Ps(t,null,i,s)):Pi(e,t,i,s),t.memoizedState=n.state,a&&Ga(t,r,!0),t.child}function Fi(e){var t=e.stateNode;t.pendingContext?qa(0,t.pendingContext,t.pendingContext!==t.context):t.context&&qa(0,t.context,!1),ao(e,t.containerInfo)}function Ui(e,t,r,n,a){return js(),Ns(a),t.flags|=256,Pi(e,t,r,n),t.child}var Bi,zi,Wi,qi,Vi={dehydrated:null,treeContext:null,retryLane:0};function Hi(e){return{baseLanes:e,cachePool:null,transitions:null}}function Gi(e,t,r){var n,a=t.pendingProps,o=lo.current,i=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&o)),n?(i=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ma(lo,1&o),null===e)return xs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=a.children,e=a.fallback,i?(a=t.mode,i=t.child,l={mode:"hidden",children:l},0===(1&a)&&null!==i?(i.childLanes=0,i.pendingProps=l):i=Hc(l,a,0,null),e=Vc(e,a,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Hi(r),t.memoizedState=Vi,e):Ki(t,l));if(null!==(o=e.memoizedState)&&null!==(n=o.dehydrated))return function(e,t,r,n,a,o,i){if(r)return 256&t.flags?(t.flags&=-257,Ji(e,t,i,n=bi(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=n.fallback,a=t.mode,n=Hc({mode:"visible",children:n.children},a,0,null),(o=Vc(o,a,i,null)).flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,0!==(1&t.mode)&&Ps(t,e.child,null,i),t.child.memoizedState=Hi(i),t.memoizedState=Vi,o);if(0===(1&t.mode))return Ji(e,t,i,null);if("$!"===a.data){if(n=a.nextSibling&&a.nextSibling.dataset)var l=n.dgst;return n=l,Ji(e,t,i,n=bi(o=Error(s(419)),n,void 0))}if(l=0!==(i&e.childLanes),Ei||l){if(null!==(n=Fl)){switch(i&-i){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(n.suspendedLanes|i))?0:a)&&a!==o.retryLane&&(o.retryLane=a,qs(e,a),uc(n,e,a,-1))}return Sc(),Ji(e,t,i,n=bi(Error(s(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Oc.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,hs=xa(a.nextSibling),us=t,ms=!0,ps=null,null!==e&&(rs[ns++]=ss,rs[ns++]=os,rs[ns++]=as,ss=e.id,os=e.overflow,as=t),t=Ki(t,n.children),t.flags|=4096,t)}(e,t,l,a,n,o,r);if(i){i=a.fallback,l=t.mode,n=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&l)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Wc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==n?i=Wc(n,i):(i=Vc(i,l,r,null)).flags|=2,i.return=t,a.return=t,a.sibling=i,t.child=a,a=i,i=t.child,l=null===(l=e.child.memoizedState)?Hi(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=e.childLanes&~r,t.memoizedState=Vi,a}return e=(i=e.child).sibling,a=Wc(i,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=r),a.return=t,a.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=a,t.memoizedState=null,a}function Ki(e,t){return(t=Hc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ji(e,t,r,n){return null!==n&&Ns(n),Ps(t,e.child,null,r),(e=Ki(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Yi(e,t,r){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Rs(e.return,t,r)}function Xi(e,t,r,n,a){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailMode=a)}function Qi(e,t,r){var n=t.pendingProps,a=n.revealOrder,s=n.tail;if(Pi(e,t,n.children,r),0!==(2&(n=lo.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Yi(e,r,t);else if(19===e.tag)Yi(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Ma(lo,n),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;null!==r;)null!==(e=r.alternate)&&null===co(e)&&(a=r),r=r.sibling;null===(r=a)?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),Xi(t,!1,a,r,s);break;case"backwards":for(r=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===co(e)){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}Xi(t,!0,r,null,s);break;case"together":Xi(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Zi(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $i(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),Hl|=t.lanes,0===(r&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(r=Wc(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Wc(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function el(e,t){if(!ms)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function tl(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,n=0;if(t)for(var a=e.child;null!==a;)r|=a.lanes|a.childLanes,n|=14680064&a.subtreeFlags,n|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function rl(e,t,r){var n=t.pendingProps;switch(ds(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tl(t),null;case 1:case 17:return za(t.type)&&Wa(),tl(t),null;case 3:return n=t.stateNode,so(),Da(Fa),Da(Ra),ho(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ys(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ps&&(fc(ps),ps=null))),zi(e,t),tl(t),null;case 5:io(t);var a=no(ro.current);if(r=t.type,null!==e&&null!=t.stateNode)Wi(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(s(166));return tl(t),null}if(e=no(eo.current),ys(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[wa]=t,n[ja]=o,e=0!==(1&t.mode),r){case"dialog":Jn("cancel",n),Jn("close",n);break;case"iframe":case"object":case"embed":Jn("load",n);break;case"video":case"audio":for(a=0;a<Vn.length;a++)Jn(Vn[a],n);break;case"source":Jn("error",n);break;case"img":case"image":case"link":Jn("error",n),Jn("load",n);break;case"details":Jn("toggle",n);break;case"input":X(n,o),Jn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Jn("invalid",n);break;case"textarea":ae(n,o),Jn("invalid",n)}for(var l in ve(r,o),a=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==o.suppressHydrationWarning&&ia(n.textContent,c,e),a=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&ia(n.textContent,c,e),a=["children",""+c]):i.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Jn("scroll",n)}switch(r){case"input":G(n),$(n,o,!0);break;case"textarea":G(n),oe(n);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(n.onclick=la)}n=a,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ie(r)),"http://www.w3.org/1999/xhtml"===e?"script"===r?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(r,{is:n.is}):(e=l.createElement(r),"select"===r&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,r),e[wa]=t,e[ja]=n,Bi(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(r,n),r){case"dialog":Jn("cancel",e),Jn("close",e),a=n;break;case"iframe":case"object":case"embed":Jn("load",e),a=n;break;case"video":case"audio":for(a=0;a<Vn.length;a++)Jn(Vn[a],e);a=n;break;case"source":Jn("error",e),a=n;break;case"img":case"image":case"link":Jn("error",e),Jn("load",e),a=n;break;case"details":Jn("toggle",e),a=n;break;case"input":X(e,n),a=Y(e,n),Jn("invalid",e);break;case"option":default:a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=R({},n,{value:void 0}),Jn("invalid",e);break;case"textarea":ae(e,n),a=ne(e,n),Jn("invalid",e)}for(o in ve(r,a),c=a)if(c.hasOwnProperty(o)){var d=c[o];"style"===o?fe(e,d):"dangerouslySetInnerHTML"===o?null!=(d=d?d.__html:void 0)&&de(e,d):"children"===o?"string"===typeof d?("textarea"!==r||""!==d)&&ue(e,d):"number"===typeof d&&ue(e,""+d):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(i.hasOwnProperty(o)?null!=d&&"onScroll"===o&&Jn("scroll",e):null!=d&&b(e,o,d,l))}switch(r){case"input":G(e),$(e,n,!1);break;case"textarea":G(e),oe(e);break;case"option":null!=n.value&&e.setAttribute("value",""+V(n.value));break;case"select":e.multiple=!!n.multiple,null!=(o=n.value)?re(e,!!n.multiple,o,!1):null!=n.defaultValue&&re(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=la)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return tl(t),null;case 6:if(e&&null!=t.stateNode)qi(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(s(166));if(r=no(ro.current),no(eo.current),ys(t)){if(n=t.stateNode,r=t.memoizedProps,n[wa]=t,(o=n.nodeValue!==r)&&null!==(e=us))switch(e.tag){case 3:ia(n.nodeValue,r,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&ia(n.nodeValue,r,0!==(1&e.mode))}o&&(t.flags|=4)}else(n=(9===r.nodeType?r:r.ownerDocument).createTextNode(n))[wa]=t,t.stateNode=n}return tl(t),null;case 13:if(Da(lo),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ms&&null!==hs&&0!==(1&t.mode)&&0===(128&t.flags))ws(),js(),t.flags|=98560,o=!1;else if(o=ys(t),null!==n&&null!==n.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[wa]=t}else js(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;tl(t),o=!1}else null!==ps&&(fc(ps),ps=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=r,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&lo.current)?0===ql&&(ql=3):Sc())),null!==t.updateQueue&&(t.flags|=4),tl(t),null);case 4:return so(),zi(e,t),null===e&&Qn(t.stateNode.containerInfo),tl(t),null;case 10:return Os(t.type._context),tl(t),null;case 19:if(Da(lo),null===(o=t.memoizedState))return tl(t),null;if(n=0!==(128&t.flags),null===(l=o.rendering))if(n)el(o,!1);else{if(0!==ql||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=co(e))){for(t.flags|=128,el(o,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;null!==r;)e=n,(o=r).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Ma(lo,1&lo.current|2),t.child}e=e.sibling}null!==o.tail&&Xe()>Ql&&(t.flags|=128,n=!0,el(o,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=co(l))){if(t.flags|=128,n=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.flags|=4),el(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ms)return tl(t),null}else 2*Xe()-o.renderingStartTime>Ql&&1073741824!==r&&(t.flags|=128,n=!0,el(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(r=o.last)?r.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Xe(),t.sibling=null,r=lo.current,Ma(lo,n?1&r|2:1&r),t):(tl(t),null);case 22:case 23:return yc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&zl)&&(tl(t),6&t.subtreeFlags&&(t.flags|=8192)):tl(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function nl(e,t){switch(ds(t),t.tag){case 1:return za(t.type)&&Wa(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return so(),Da(Fa),Da(Ra),ho(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return io(t),null;case 13:if(Da(lo),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));js()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Da(lo),null;case 4:return so(),null;case 10:return Os(t.type._context),null;case 22:case 23:return yc(),null;default:return null}}Bi=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},zi=function(){},Wi=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,no(eo.current);var s,o=null;switch(r){case"input":a=Y(e,a),n=Y(e,n),o=[];break;case"select":a=R({},a,{value:void 0}),n=R({},n,{value:void 0}),o=[];break;case"textarea":a=ne(e,a),n=ne(e,n),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof n.onClick&&(e.onclick=la)}for(d in ve(r,n),r=null,a)if(!n.hasOwnProperty(d)&&a.hasOwnProperty(d)&&null!=a[d])if("style"===d){var l=a[d];for(s in l)l.hasOwnProperty(s)&&(r||(r={}),r[s]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(i.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in n){var c=n[d];if(l=null!=a?a[d]:void 0,n.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(r||(r={}),r[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(r||(r={}),r[s]=c[s])}else r||(o||(o=[]),o.push(d,r)),r=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(i.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Jn("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}r&&(o=o||[]).push("style",r);var d=o;(t.updateQueue=d)&&(t.flags|=4)}},qi=function(e,t,r,n){r!==n&&(t.flags|=4)};var al=!1,sl=!1,ol="function"===typeof WeakSet?WeakSet:Set,il=null;function ll(e,t){var r=e.ref;if(null!==r)if("function"===typeof r)try{r(null)}catch(Bt){Lc(e,t,Bt)}else r.current=null}function cl(e,t,r){try{r()}catch(Bt){Lc(e,t,Bt)}}var dl=!1;function ul(e,t,r){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var a=n=n.next;do{if((a.tag&e)===e){var s=a.destroy;a.destroy=void 0,void 0!==s&&cl(t,r,s)}a=a.next}while(a!==n)}}function hl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function ml(e){var t=e.ref;if(null!==t){var r=e.stateNode;e.tag,e=r,"function"===typeof t?t(e):t.current=e}}function pl(e){var t=e.alternate;null!==t&&(e.alternate=null,pl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[wa],delete t[ja],delete t[Sa],delete t[ka],delete t[Aa])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function fl(e){return 5===e.tag||3===e.tag||4===e.tag}function gl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||fl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function vl(e,t,r){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!==(r=r._reactRootContainer)&&void 0!==r||null!==t.onclick||(t.onclick=la));else if(4!==n&&null!==(e=e.child))for(vl(e,t,r),e=e.sibling;null!==e;)vl(e,t,r),e=e.sibling}function xl(e,t,r){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==n&&null!==(e=e.child))for(xl(e,t,r),e=e.sibling;null!==e;)xl(e,t,r),e=e.sibling}var bl=null,yl=!1;function wl(e,t,r){for(r=r.child;null!==r;)jl(e,t,r),r=r.sibling}function jl(e,t,r){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(nt,r)}catch(qt){}switch(r.tag){case 5:sl||ll(r,t);case 6:var n=bl,a=yl;bl=null,wl(e,t,r),yl=a,null!==(bl=n)&&(yl?(e=bl,r=r.stateNode,8===e.nodeType?e.parentNode.removeChild(r):e.removeChild(r)):bl.removeChild(r.stateNode));break;case 18:null!==bl&&(yl?(e=bl,r=r.stateNode,8===e.nodeType?va(e.parentNode,r):1===e.nodeType&&va(e,r),Yt(e)):va(bl,r.stateNode));break;case 4:n=bl,a=yl,bl=r.stateNode.containerInfo,yl=!0,wl(e,t,r),bl=n,yl=a;break;case 0:case 11:case 14:case 15:if(!sl&&(null!==(n=r.updateQueue)&&null!==(n=n.lastEffect))){a=n=n.next;do{var s=a,o=s.destroy;s=s.tag,void 0!==o&&(0!==(2&s)||0!==(4&s))&&cl(r,t,o),a=a.next}while(a!==n)}wl(e,t,r);break;case 1:if(!sl&&(ll(r,t),"function"===typeof(n=r.stateNode).componentWillUnmount))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(qt){Lc(r,t,qt)}wl(e,t,r);break;case 21:wl(e,t,r);break;case 22:1&r.mode?(sl=(n=sl)||null!==r.memoizedState,wl(e,t,r),sl=n):wl(e,t,r);break;default:wl(e,t,r)}}function Nl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new ol),t.forEach(function(t){var n=Rc.bind(null,e,t);r.has(t)||(r.add(t),t.then(n,n))})}}function Sl(e,t){var r=t.deletions;if(null!==r)for(var n=0;n<r.length;n++){var a=r[n];try{var o=e,i=t,l=i;e:for(;null!==l;){switch(l.tag){case 5:bl=l.stateNode,yl=!1;break e;case 3:case 4:bl=l.stateNode.containerInfo,yl=!0;break e}l=l.return}if(null===bl)throw Error(s(160));jl(o,i,a),bl=null,yl=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(Tt){Lc(a,t,Tt)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)kl(t,e),t=t.sibling}function kl(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Sl(t,e),Al(e),4&n){try{ul(3,e,e.return),hl(3,e)}catch(It){Lc(e,e.return,It)}try{ul(5,e,e.return)}catch(It){Lc(e,e.return,It)}}break;case 1:Sl(t,e),Al(e),512&n&&null!==r&&ll(r,r.return);break;case 5:if(Sl(t,e),Al(e),512&n&&null!==r&&ll(r,r.return),32&e.flags){var a=e.stateNode;try{ue(a,"")}catch(It){Lc(e,e.return,It)}}if(4&n&&null!=(a=e.stateNode)){var o=e.memoizedProps,i=null!==r?r.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&Q(a,o),xe(l,i);var d=xe(l,o);for(i=0;i<c.length;i+=2){var u=c[i],h=c[i+1];"style"===u?fe(a,h):"dangerouslySetInnerHTML"===u?de(a,h):"children"===u?ue(a,h):b(a,u,h,d)}switch(l){case"input":Z(a,o);break;case"textarea":se(a,o);break;case"select":var m=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?re(a,!!o.multiple,p,!1):m!==!!o.multiple&&(null!=o.defaultValue?re(a,!!o.multiple,o.defaultValue,!0):re(a,!!o.multiple,o.multiple?[]:"",!1))}a[ja]=o}catch(It){Lc(e,e.return,It)}}break;case 6:if(Sl(t,e),Al(e),4&n){if(null===e.stateNode)throw Error(s(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(It){Lc(e,e.return,It)}}break;case 3:if(Sl(t,e),Al(e),4&n&&null!==r&&r.memoizedState.isDehydrated)try{Yt(t.containerInfo)}catch(It){Lc(e,e.return,It)}break;case 4:default:Sl(t,e),Al(e);break;case 13:Sl(t,e),Al(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Xl=Xe())),4&n&&Nl(e);break;case 22:if(u=null!==r&&null!==r.memoizedState,1&e.mode?(sl=(d=sl)||u,Sl(t,e),sl=d):Sl(t,e),Al(e),8192&n){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(il=e,u=e.child;null!==u;){for(h=il=u;null!==il;){switch(p=(m=il).child,m.tag){case 0:case 11:case 14:case 15:ul(4,m,m.return);break;case 1:ll(m,m.return);var f=m.stateNode;if("function"===typeof f.componentWillUnmount){n=m,r=m.return;try{t=n,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(It){Lc(n,r,It)}}break;case 5:ll(m,m.return);break;case 22:if(null!==m.memoizedState){_l(h);continue}}null!==p?(p.return=m,il=p):_l(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{a=h.stateNode,d?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=h.stateNode,i=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",i))}catch(It){Lc(e,e.return,It)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(It){Lc(e,e.return,It)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Sl(t,e),Al(e),4&n&&Nl(e);case 21:}}function Al(e){var t=e.flags;if(2&t){try{e:{for(var r=e.return;null!==r;){if(fl(r)){var n=r;break e}r=r.return}throw Error(s(160))}switch(n.tag){case 5:var a=n.stateNode;32&n.flags&&(ue(a,""),n.flags&=-33),xl(e,gl(e),a);break;case 3:case 4:var o=n.stateNode.containerInfo;vl(e,gl(e),o);break;default:throw Error(s(161))}}catch(Sr){Lc(e,e.return,Sr)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Cl(e,t,r){il=e,El(e,t,r)}function El(e,t,r){for(var n=0!==(1&e.mode);null!==il;){var a=il,s=a.child;if(22===a.tag&&n){var o=null!==a.memoizedState||al;if(!o){var i=a.alternate,l=null!==i&&null!==i.memoizedState||sl;i=al;var c=sl;if(al=o,(sl=l)&&!c)for(il=a;null!==il;)l=(o=il).child,22===o.tag&&null!==o.memoizedState?Il(a):null!==l?(l.return=o,il=l):Il(a);for(;null!==s;)il=s,El(s,t,r),s=s.sibling;il=a,al=i,sl=c}Pl(e)}else 0!==(8772&a.subtreeFlags)&&null!==s?(s.return=a,il=s):Pl(e)}}function Pl(e){for(;null!==il;){var t=il;if(0!==(8772&t.flags)){var r=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:sl||hl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!sl)if(null===r)n.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:ui(t.type,r.memoizedProps);n.componentDidUpdate(a,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Zs(t,o,n);break;case 3:var i=t.updateQueue;if(null!==i){if(r=null,null!==t.child)switch(t.child.tag){case 5:case 1:r=t.child.stateNode}Zs(t,i,r)}break;case 5:var l=t.stateNode;if(null===r&&4&t.flags){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Yt(h)}}}break;default:throw Error(s(163))}sl||512&t.flags&&ml(t)}catch(m){Lc(t,t.return,m)}}if(t===e){il=null;break}if(null!==(r=t.sibling)){r.return=t.return,il=r;break}il=t.return}}function _l(e){for(;null!==il;){var t=il;if(t===e){il=null;break}var r=t.sibling;if(null!==r){r.return=t.return,il=r;break}il=t.return}}function Il(e){for(;null!==il;){var t=il;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{hl(4,t)}catch(Sr){Lc(t,r,Sr)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var a=t.return;try{n.componentDidMount()}catch(Sr){Lc(t,a,Sr)}}var s=t.return;try{ml(t)}catch(Sr){Lc(t,s,Sr)}break;case 5:var o=t.return;try{ml(t)}catch(Sr){Lc(t,o,Sr)}}}catch(Sr){Lc(t,t.return,Sr)}if(t===e){il=null;break}var i=t.sibling;if(null!==i){i.return=t.return,il=i;break}il=t.return}}var Tl,Ll=Math.ceil,Dl=y.ReactCurrentDispatcher,Ml=y.ReactCurrentOwner,Ol=y.ReactCurrentBatchConfig,Rl=0,Fl=null,Ul=null,Bl=0,zl=0,Wl=La(0),ql=0,Vl=null,Hl=0,Gl=0,Kl=0,Jl=null,Yl=null,Xl=0,Ql=1/0,Zl=null,$l=!1,ec=null,tc=null,rc=!1,nc=null,ac=0,sc=0,oc=null,ic=-1,lc=0;function cc(){return 0!==(6&Rl)?Xe():-1!==ic?ic:ic=Xe()}function dc(e){return 0===(1&e.mode)?1:0!==(2&Rl)&&0!==Bl?Bl&-Bl:null!==Ss.transition?(0===lc&&(lc=pt()),lc):0!==(e=xt)?e:e=void 0===(e=window.event)?16:nr(e.type)}function uc(e,t,r,n){if(50<sc)throw sc=0,oc=null,Error(s(185));gt(e,r,n),0!==(2&Rl)&&e===Fl||(e===Fl&&(0===(2&Rl)&&(Gl|=r),4===ql&&gc(e,Bl)),hc(e,n),1===r&&0===Rl&&0===(1&t.mode)&&(Ql=Xe()+500,Ja&&Qa()))}function hc(e,t){var r=e.callbackNode;!function(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-st(s),i=1<<o,l=a[o];-1===l?0!==(i&r)&&0===(i&n)||(a[o]=ht(i,t)):l<=t&&(e.expiredLanes|=i),s&=~i}}(e,t);var n=ut(e,e===Fl?Bl:0);if(0===n)null!==r&&Ke(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=r&&Ke(r),1===t)0===e.tag?function(e){Ja=!0,Xa(e)}(vc.bind(null,e)):Xa(vc.bind(null,e)),fa(function(){0===(6&Rl)&&Qa()}),r=null;else{switch(bt(n)){case 1:r=Ze;break;case 4:r=$e;break;case 16:default:r=et;break;case 536870912:r=rt}r=Fc(r,mc.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function mc(e,t){if(ic=-1,lc=0,0!==(6&Rl))throw Error(s(327));var r=e.callbackNode;if(Ic()&&e.callbackNode!==r)return null;var n=ut(e,e===Fl?Bl:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=kc(e,n);else{t=n;var a=Rl;Rl|=2;var o=Nc();for(Fl===e&&Bl===t||(Zl=null,Ql=Xe()+500,wc(e,t));;)try{Cc();break}catch(qt){jc(e,qt)}Ms(),Dl.current=o,Rl=a,null!==Ul?t=0:(Fl=null,Bl=0,t=ql)}if(0!==t){if(2===t&&(0!==(a=mt(e))&&(n=a,t=pc(e,a))),1===t)throw r=Vl,wc(e,0),gc(e,n),hc(e,Xe()),r;if(6===t)gc(e,n);else{if(a=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var r=t.updateQueue;if(null!==r&&null!==(r=r.stores))for(var n=0;n<r.length;n++){var a=r[n],s=a.getSnapshot;a=a.value;try{if(!gn(s(),a))return!1}catch(i){return!1}}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=kc(e,n))&&(0!==(o=mt(e))&&(n=o,t=pc(e,o))),1===t))throw r=Vl,wc(e,0),gc(e,n),hc(e,Xe()),r;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(s(345));case 2:case 5:_c(e,Yl,Zl);break;case 3:if(gc(e,n),(130023424&n)===n&&10<(t=Xl+500-Xe())){if(0!==ut(e,0))break;if(((a=e.suspendedLanes)&n)!==n){cc(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ha(_c.bind(null,e,Yl,Zl),t);break}_c(e,Yl,Zl);break;case 4:if(gc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,a=-1;0<n;){var i=31-st(n);o=1<<i,(i=t[i])>a&&(a=i),n&=~o}if(n=a,10<(n=(120>(n=Xe()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ll(n/1960))-n)){e.timeoutHandle=ha(_c.bind(null,e,Yl,Zl),n);break}_c(e,Yl,Zl);break;default:throw Error(s(329))}}}return hc(e,Xe()),e.callbackNode===r?mc.bind(null,e):null}function pc(e,t){var r=Jl;return e.current.memoizedState.isDehydrated&&(wc(e,t).flags|=256),2!==(e=kc(e,t))&&(t=Yl,Yl=r,null!==t&&fc(t)),e}function fc(e){null===Yl?Yl=e:Yl.push.apply(Yl,e)}function gc(e,t){for(t&=~Kl,t&=~Gl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-st(t),n=1<<r;e[r]=-1,t&=~n}}function vc(e){if(0!==(6&Rl))throw Error(s(327));Ic();var t=ut(e,0);if(0===(1&t))return hc(e,Xe()),null;var r=kc(e,t);if(0!==e.tag&&2===r){var n=mt(e);0!==n&&(t=n,r=pc(e,n))}if(1===r)throw r=Vl,wc(e,0),gc(e,t),hc(e,Xe()),r;if(6===r)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_c(e,Yl,Zl),hc(e,Xe()),null}function xc(e,t){var r=Rl;Rl|=1;try{return e(t)}finally{0===(Rl=r)&&(Ql=Xe()+500,Ja&&Qa())}}function bc(e){null!==nc&&0===nc.tag&&0===(6&Rl)&&Ic();var t=Rl;Rl|=1;var r=Ol.transition,n=xt;try{if(Ol.transition=null,xt=1,e)return e()}finally{xt=n,Ol.transition=r,0===(6&(Rl=t))&&Qa()}}function yc(){zl=Wl.current,Da(Wl)}function wc(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(-1!==r&&(e.timeoutHandle=-1,ma(r)),null!==Ul)for(r=Ul.return;null!==r;){var n=r;switch(ds(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&Wa();break;case 3:so(),Da(Fa),Da(Ra),ho();break;case 5:io(n);break;case 4:so();break;case 13:case 19:Da(lo);break;case 10:Os(n.type._context);break;case 22:case 23:yc()}r=r.return}if(Fl=e,Ul=e=Wc(e.current,null),Bl=zl=t,ql=0,Vl=null,Kl=Gl=Hl=0,Yl=Jl=null,null!==Bs){for(t=0;t<Bs.length;t++)if(null!==(n=(r=Bs[t]).interleaved)){r.interleaved=null;var a=n.next,s=r.pending;if(null!==s){var o=s.next;s.next=a,n.next=o}r.pending=n}Bs=null}return e}function jc(e,t){for(;;){var r=Ul;try{if(Ms(),mo.current=ii,bo){for(var n=go.memoizedState;null!==n;){var a=n.queue;null!==a&&(a.pending=null),n=n.next}bo=!1}if(fo=0,xo=vo=go=null,yo=!1,wo=0,Ml.current=null,null===r||null===r.return){ql=1,Vl=t,Ul=null;break}e:{var o=e,i=r.return,l=r,c=t;if(t=Bl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=ki(i);if(null!==p){p.flags&=-257,Ai(p,i,l,0,t),1&p.mode&&Si(o,d,t),c=d;var f=(t=p).updateQueue;if(null===f){var g=new Set;g.add(c),t.updateQueue=g}else f.add(c);break e}if(0===(1&t)){Si(o,d,t),Sc();break e}c=Error(s(426))}else if(ms&&1&l.mode){var v=ki(i);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),Ai(v,i,l,0,t),Ns(xi(c,l));break e}}o=c=xi(c,l),4!==ql&&(ql=2),null===Jl?Jl=[o]:Jl.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Xs(o,ji(0,c,t));break e;case 1:l=c;var x=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof x.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===tc||!tc.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Xs(o,Ni(o,l,t));break e}}o=o.return}while(null!==o)}Pc(r)}catch(y){t=y,Ul===r&&null!==r&&(Ul=r=r.return);continue}break}}function Nc(){var e=Dl.current;return Dl.current=ii,null===e?ii:e}function Sc(){0!==ql&&3!==ql&&2!==ql||(ql=4),null===Fl||0===(268435455&Hl)&&0===(268435455&Gl)||gc(Fl,Bl)}function kc(e,t){var r=Rl;Rl|=2;var n=Nc();for(Fl===e&&Bl===t||(Zl=null,wc(e,t));;)try{Ac();break}catch(_t){jc(e,_t)}if(Ms(),Rl=r,Dl.current=n,null!==Ul)throw Error(s(261));return Fl=null,Bl=0,ql}function Ac(){for(;null!==Ul;)Ec(Ul)}function Cc(){for(;null!==Ul&&!Je();)Ec(Ul)}function Ec(e){var t=Tl(e.alternate,e,zl);e.memoizedProps=e.pendingProps,null===t?Pc(e):Ul=t,Ml.current=null}function Pc(e){var t=e;do{var r=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(r=rl(r,t,zl)))return void(Ul=r)}else{if(null!==(r=nl(r,t)))return r.flags&=32767,void(Ul=r);if(null===e)return ql=6,void(Ul=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ul=t);Ul=t=e}while(null!==t);0===ql&&(ql=5)}function _c(e,t,r){var n=xt,a=Ol.transition;try{Ol.transition=null,xt=1,function(e,t,r,n){do{Ic()}while(null!==nc);if(0!==(6&Rl))throw Error(s(327));r=e.finishedWork;var a=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(function(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-st(r),s=1<<a;t[a]=0,n[a]=-1,e[a]=-1,r&=~s}}(e,o),e===Fl&&(Ul=Fl=null,Bl=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||rc||(rc=!0,Fc(et,function(){return Ic(),null})),o=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||o){o=Ol.transition,Ol.transition=null;var i=xt;xt=1;var l=Rl;Rl|=4,Ml.current=null,function(e,t){if(ca=Qt,jn(e=wn())){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(n&&0!==n.rangeCount){r=n.anchorNode;var a=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch(lr){r=null;break e}var i=0,l=-1,c=-1,d=0,u=0,h=e,m=null;t:for(;;){for(var p;h!==r||0!==a&&3!==h.nodeType||(l=i+a),h!==o||0!==n&&3!==h.nodeType||(c=i+n),3===h.nodeType&&(i+=h.nodeValue.length),null!==(p=h.firstChild);)m=h,h=p;for(;;){if(h===e)break t;if(m===r&&++d===a&&(l=i),m===o&&++u===n&&(c=i),null!==(p=h.nextSibling))break;m=(h=m).parentNode}h=p}r=-1===l||-1===c?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(da={focusedElem:e,selectionRange:r},Qt=!1,il=t;null!==il;)if(e=(t=il).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,il=e;else for(;null!==il;){t=il;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,v=f.memoizedState,x=t.stateNode,b=x.getSnapshotBeforeUpdate(t.elementType===t.type?g:ui(t.type,g),v);x.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(s(163))}}catch(lr){Lc(t,t.return,lr)}if(null!==(e=t.sibling)){e.return=t.return,il=e;break}il=t.return}f=dl,dl=!1}(e,r),kl(r,e),Nn(da),Qt=!!ca,da=ca=null,e.current=r,Cl(r,e,a),Ye(),Rl=l,xt=i,Ol.transition=o}else e.current=r;if(rc&&(rc=!1,nc=e,ac=a),o=e.pendingLanes,0===o&&(tc=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(nt,e,void 0,128===(128&e.current.flags))}catch(t){}}(r.stateNode),hc(e,Xe()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],n(a.value,{componentStack:a.stack,digest:a.digest});if($l)throw $l=!1,e=ec,ec=null,e;0!==(1&ac)&&0!==e.tag&&Ic(),o=e.pendingLanes,0!==(1&o)?e===oc?sc++:(sc=0,oc=e):sc=0,Qa()}(e,t,r,n)}finally{Ol.transition=a,xt=n}return null}function Ic(){if(null!==nc){var e=bt(ac),t=Ol.transition,r=xt;try{if(Ol.transition=null,xt=16>e?16:e,null===nc)var n=!1;else{if(e=nc,nc=null,ac=0,0!==(6&Rl))throw Error(s(331));var a=Rl;for(Rl|=4,il=e.current;null!==il;){var o=il,i=o.child;if(0!==(16&il.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(il=d;null!==il;){var u=il;switch(u.tag){case 0:case 11:case 15:ul(8,u,o)}var h=u.child;if(null!==h)h.return=u,il=h;else for(;null!==il;){var m=(u=il).sibling,p=u.return;if(pl(u),u===d){il=null;break}if(null!==m){m.return=p,il=m;break}il=p}}}var f=o.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}il=o}}if(0!==(2064&o.subtreeFlags)&&null!==i)i.return=o,il=i;else e:for(;null!==il;){if(0!==(2048&(o=il).flags))switch(o.tag){case 0:case 11:case 15:ul(9,o,o.return)}var x=o.sibling;if(null!==x){x.return=o.return,il=x;break e}il=o.return}}var b=e.current;for(il=b;null!==il;){var y=(i=il).child;if(0!==(2064&i.subtreeFlags)&&null!==y)y.return=i,il=y;else e:for(i=b;null!==il;){if(0!==(2048&(l=il).flags))try{switch(l.tag){case 0:case 11:case 15:hl(9,l)}}catch(j){Lc(l,l.return,j)}if(l===i){il=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,il=w;break e}il=l.return}}if(Rl=a,Qa(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(nt,e)}catch(j){}n=!0}return n}finally{xt=r,Ol.transition=t}}return!1}function Tc(e,t,r){e=Js(e,t=ji(0,t=xi(r,t),1),1),t=cc(),null!==e&&(gt(e,1,t),hc(e,t))}function Lc(e,t,r){if(3===e.tag)Tc(e,e,r);else for(;null!==t;){if(3===t.tag){Tc(t,e,r);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===tc||!tc.has(n))){t=Js(t,e=Ni(t,e=xi(r,e),1),1),e=cc(),null!==t&&(gt(t,1,e),hc(t,e));break}}t=t.return}}function Dc(e,t,r){var n=e.pingCache;null!==n&&n.delete(t),t=cc(),e.pingedLanes|=e.suspendedLanes&r,Fl===e&&(Bl&r)===r&&(4===ql||3===ql&&(130023424&Bl)===Bl&&500>Xe()-Xl?wc(e,0):Kl|=r),hc(e,t)}function Mc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var r=cc();null!==(e=qs(e,t))&&(gt(e,t,r),hc(e,r))}function Oc(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),Mc(e,r)}function Rc(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;null!==a&&(r=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(s(314))}null!==n&&n.delete(t),Mc(e,r)}function Fc(e,t){return Ge(e,t)}function Uc(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bc(e,t,r,n){return new Uc(e,t,r,n)}function zc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Wc(e,t){var r=e.alternate;return null===r?((r=Bc(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=14680064&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function qc(e,t,r,n,a,o){var i=2;if(n=e,"function"===typeof e)zc(e)&&(i=1);else if("string"===typeof e)i=5;else e:switch(e){case N:return Vc(r.children,a,o,t);case S:i=8,a|=8;break;case k:return(e=Bc(12,r,t,2|a)).elementType=k,e.lanes=o,e;case P:return(e=Bc(13,r,t,a)).elementType=P,e.lanes=o,e;case _:return(e=Bc(19,r,t,a)).elementType=_,e.lanes=o,e;case L:return Hc(r,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:i=10;break e;case C:i=9;break e;case E:i=11;break e;case I:i=14;break e;case T:i=16,n=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Bc(i,r,t,a)).elementType=e,t.type=n,t.lanes=o,t}function Vc(e,t,r,n){return(e=Bc(7,e,n,t)).lanes=r,e}function Hc(e,t,r,n){return(e=Bc(22,e,n,t)).elementType=L,e.lanes=r,e.stateNode={isHidden:!1},e}function Gc(e,t,r){return(e=Bc(6,e,null,t)).lanes=r,e}function Kc(e,t,r){return(t=Bc(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Jc(e,t,r,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ft(0),this.expirationTimes=ft(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ft(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Yc(e,t,r,n,a,s,o,i,l){return e=new Jc(e,t,r,i,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Bc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Hs(s),e}function Xc(e){if(!e)return Oa;e:{if(ze(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(za(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var r=e.type;if(za(r))return Va(e,r,t)}return t}function Qc(e,t,r,n,a,s,o,i,l){return(e=Yc(r,n,!0,e,0,s,0,i,l)).context=Xc(null),r=e.current,(s=Ks(n=cc(),a=dc(r))).callback=void 0!==t&&null!==t?t:null,Js(r,s,a),e.current.lanes=a,gt(e,a,n),hc(e,n),e}function Zc(e,t,r,n){var a=t.current,s=cc(),o=dc(a);return r=Xc(r),null===t.context?t.context=r:t.pendingContext=r,(t=Ks(s,o)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Js(a,t,o))&&(uc(e,a,o,s),Ys(e,a,o)),o}function $c(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function ed(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function td(e,t){ed(e,t),(e=e.alternate)&&ed(e,t)}Tl=function(e,t,r){if(null!==e)if(e.memoizedProps!==t.pendingProps||Fa.current)Ei=!0;else{if(0===(e.lanes&r)&&0===(128&t.flags))return Ei=!1,function(e,t,r){switch(t.tag){case 3:Fi(t),js();break;case 5:oo(t);break;case 1:za(t.type)&&Ha(t);break;case 4:ao(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Ma(Is,n._currentValue),n._currentValue=a;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Ma(lo,1&lo.current),t.flags|=128,null):0!==(r&t.child.childLanes)?Gi(e,t,r):(Ma(lo,1&lo.current),null!==(e=$i(e,t,r))?e.sibling:null);Ma(lo,1&lo.current);break;case 19:if(n=0!==(r&t.childLanes),0!==(128&e.flags)){if(n)return Qi(e,t,r);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ma(lo,lo.current),n)break;return null;case 22:case 23:return t.lanes=0,Li(e,t,r)}return $i(e,t,r)}(e,t,r);Ei=0!==(131072&e.flags)}else Ei=!1,ms&&0!==(1048576&t.flags)&&ls(t,ts,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Zi(e,t),e=t.pendingProps;var a=Ba(t,Ra.current);Fs(t,r),a=ko(null,t,n,e,a,r);var o=Ao();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,za(n)?(o=!0,Ha(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Hs(t),a.updater=mi,t.stateNode=a,a._reactInternals=t,vi(t,n,e,r),t=Ri(null,t,n,!0,o,r)):(t.tag=0,ms&&o&&cs(t),Pi(null,t,a,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Zi(e,t),e=t.pendingProps,n=(a=n._init)(n._payload),t.type=n,a=t.tag=function(e){if("function"===typeof e)return zc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===I)return 14}return 2}(n),e=ui(n,e),a){case 0:t=Mi(null,t,n,e,r);break e;case 1:t=Oi(null,t,n,e,r);break e;case 11:t=_i(null,t,n,e,r);break e;case 14:t=Ii(null,t,n,ui(n.type,e),r);break e}throw Error(s(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,Mi(e,t,n,a=t.elementType===n?a:ui(n,a),r);case 1:return n=t.type,a=t.pendingProps,Oi(e,t,n,a=t.elementType===n?a:ui(n,a),r);case 3:e:{if(Fi(t),null===e)throw Error(s(387));n=t.pendingProps,a=(o=t.memoizedState).element,Gs(e,t),Qs(t,n,null,r);var i=t.memoizedState;if(n=i.element,o.isDehydrated){if(o={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ui(e,t,n,r,a=xi(Error(s(423)),t));break e}if(n!==a){t=Ui(e,t,n,r,a=xi(Error(s(424)),t));break e}for(hs=xa(t.stateNode.containerInfo.firstChild),us=t,ms=!0,ps=null,r=_s(t,null,n,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(js(),n===a){t=$i(e,t,r);break e}Pi(e,t,n,r)}t=t.child}return t;case 5:return oo(t),null===e&&xs(t),n=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,i=a.children,ua(n,a)?i=null:null!==o&&ua(n,o)&&(t.flags|=32),Di(e,t),Pi(e,t,i,r),t.child;case 6:return null===e&&xs(t),null;case 13:return Gi(e,t,r);case 4:return ao(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Ps(t,null,n,r):Pi(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,_i(e,t,n,a=t.elementType===n?a:ui(n,a),r);case 7:return Pi(e,t,t.pendingProps,r),t.child;case 8:case 12:return Pi(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,o=t.memoizedProps,i=a.value,Ma(Is,n._currentValue),n._currentValue=i,null!==o)if(gn(o.value,i)){if(o.children===a.children&&!Fa.current){t=$i(e,t,r);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){i=o.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===o.tag){(c=Ks(-1,r&-r)).tag=2;var d=o.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}o.lanes|=r,null!==(c=o.alternate)&&(c.lanes|=r),Rs(o.return,r,t),l.lanes|=r;break}c=c.next}}else if(10===o.tag)i=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(i=o.return))throw Error(s(341));i.lanes|=r,null!==(l=i.alternate)&&(l.lanes|=r),Rs(i,r,t),i=o.sibling}else i=o.child;if(null!==i)i.return=o;else for(i=o;null!==i;){if(i===t){i=null;break}if(null!==(o=i.sibling)){o.return=i.return,i=o;break}i=i.return}o=i}Pi(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,Fs(t,r),n=n(a=Us(a)),t.flags|=1,Pi(e,t,n,r),t.child;case 14:return a=ui(n=t.type,t.pendingProps),Ii(e,t,n,a=ui(n.type,a),r);case 15:return Ti(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ui(n,a),Zi(e,t),t.tag=1,za(n)?(e=!0,Ha(t)):e=!1,Fs(t,r),fi(t,n,a),vi(t,n,a,r),Ri(null,t,n,!0,e,r);case 19:return Qi(e,t,r);case 22:return Li(e,t,r)}throw Error(s(156,t.tag))};var rd="function"===typeof reportError?reportError:function(e){console.error(e)};function nd(e){this._internalRoot=e}function ad(e){this._internalRoot=e}function sd(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function od(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function id(){}function ld(e,t,r,n,a){var s=r._reactRootContainer;if(s){var o=s;if("function"===typeof a){var i=a;a=function(){var e=$c(o);i.call(e)}}Zc(t,o,e,a)}else o=function(e,t,r,n,a){if(a){if("function"===typeof n){var s=n;n=function(){var e=$c(o);s.call(e)}}var o=Qc(t,n,e,0,null,!1,0,"",id);return e._reactRootContainer=o,e[Na]=o.current,Qn(8===e.nodeType?e.parentNode:e),bc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof n){var i=n;n=function(){var e=$c(l);i.call(e)}}var l=Yc(e,0,!1,null,0,!1,0,"",id);return e._reactRootContainer=l,e[Na]=l.current,Qn(8===e.nodeType?e.parentNode:e),bc(function(){Zc(t,l,r,n)}),l}(r,t,e,a,n);return $c(o)}ad.prototype.render=nd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Zc(e,t,null,null)},ad.prototype.unmount=nd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;bc(function(){Zc(null,e,null,null)}),t[Na]=null}},ad.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Rt.length&&0!==t&&t<Rt[r].priority;r++);Rt.splice(r,0,e),0===r&&Vt(e)}},yt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=dt(t.pendingLanes);0!==r&&(vt(t,1|r),hc(t,Xe()),0===(6&Rl)&&(Ql=Xe()+500,Qa()))}break;case 13:bc(function(){var t=qs(e,1);if(null!==t){var r=cc();uc(t,e,1,r)}}),td(e,1)}},wt=function(e){if(13===e.tag){var t=qs(e,134217728);if(null!==t)uc(t,e,134217728,cc());td(e,134217728)}},jt=function(e){if(13===e.tag){var t=dc(e),r=qs(e,t);if(null!==r)uc(r,e,t,cc());td(e,t)}},Nt=function(){return xt},St=function(e,t){var r=xt;try{return xt=e,t()}finally{xt=r}},we=function(e,t,r){switch(t){case"input":if(Z(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=_a(n);if(!a)throw Error(s(90));K(n),Z(n,a)}}}break;case"textarea":se(e,r);break;case"select":null!=(t=r.value)&&re(e,!!r.multiple,t,!1)}},Ce=xc,Ee=bc;var cd={usingClientEntryPoint:!1,Events:[Ea,Pa,_a,ke,Ae,xc]},dd={findFiberByHostInstance:Ca,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ud={bundleType:dd.bundleType,version:dd.version,rendererPackageName:dd.rendererPackageName,rendererConfig:dd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ve(e))?null:e.stateNode},findFiberByHostInstance:dd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var hd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hd.isDisabled&&hd.supportsFiber)try{nt=hd.inject(ud),at=hd}catch(Lt){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cd,t.createPortal=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!sd(t))throw Error(s(200));return function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:j,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}}(e,t,null,r)},t.createRoot=function(e,t){if(!sd(e))throw Error(s(299));var r=!1,n="",a=rd;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Yc(e,1,!1,null,0,r,0,n,a),e[Na]=t.current,Qn(8===e.nodeType?e.parentNode:e),new nd(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=Ve(t))?null:e.stateNode},t.flushSync=function(e){return bc(e)},t.hydrate=function(e,t,r){if(!od(t))throw Error(s(200));return ld(null,e,t,!0,r)},t.hydrateRoot=function(e,t,r){if(!sd(e))throw Error(s(405));var n=null!=r&&r.hydratedSources||null,a=!1,o="",i=rd;if(null!==r&&void 0!==r&&(!0===r.unstable_strictMode&&(a=!0),void 0!==r.identifierPrefix&&(o=r.identifierPrefix),void 0!==r.onRecoverableError&&(i=r.onRecoverableError)),t=Qc(t,null,e,1,null!=r?r:null,a,0,o,i),e[Na]=t.current,Qn(e),n)for(e=0;e<n.length;e++)a=(a=(r=n[e])._getVersion)(r._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new ad(t)},t.render=function(e,t,r){if(!od(t))throw Error(s(200));return ld(null,e,t,!1,r)},t.unmountComponentAtNode=function(e){if(!od(e))throw Error(s(40));return!!e._reactRootContainer&&(bc(function(){ld(null,null,e,!1,function(){e._reactRootContainer=null,e[Na]=null})}),!0)},t.unstable_batchedUpdates=xc,t.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!od(r))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return ld(e,t,r,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},4202:(e,t)=>{var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function v(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||p}function x(){}function b(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},x.prototype=v.prototype;var y=b.prototype=new x;y.constructor=b,f(y,v.prototype),y.isPureReactComponent=!0;var w=Array.isArray,j=Object.prototype.hasOwnProperty,N={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,n){var a,s={},o=null,i=null;if(null!=t)for(a in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(o=""+t.key),t)j.call(t,a)&&!S.hasOwnProperty(a)&&(s[a]=t[a]);var l=arguments.length-2;if(1===l)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(e&&e.defaultProps)for(a in l=e.defaultProps)void 0===s[a]&&(s[a]=l[a]);return{$$typeof:r,type:e,key:o,ref:i,props:s,_owner:N.current}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function P(e,t,a,s,o){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var l=!1;if(null===e)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case r:case n:l=!0}}if(l)return o=o(l=e),e=""===s?"."+E(l,0):s,w(o)?(a="",null!=e&&(a=e.replace(C,"$&/")+"/"),P(o,t,a,"",function(e){return e})):null!=o&&(A(o)&&(o=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(l=0,s=""===s?".":s+":",w(e))for(var c=0;c<e.length;c++){var d=s+E(i=e[c],c);l+=P(i,t,a,d,o)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=m&&e[m]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(i=e.next()).done;)l+=P(i=i.value,t,a,d=s+E(i,c++),o);else if("object"===i)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function _(e,t,r){if(null==e)return e;var n=[],a=0;return P(e,n,"","",function(e){return t.call(r,e,a++)}),n}function I(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var T={current:null},L={transition:null},D={ReactCurrentDispatcher:T,ReactCurrentBatchConfig:L,ReactCurrentOwner:N};function M(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:_,forEach:function(e,t,r){_(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return _(e,function(){t++}),t},toArray:function(e){return _(e,function(e){return e})||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=s,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=M,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=f({},e.props),s=e.key,o=e.ref,i=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,i=N.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)j.call(t,c)&&!S.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];a.children=l}return{$$typeof:r,type:e.type,key:s,ref:o,props:a,_owner:i}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:i,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=M,t.useCallback=function(e,t){return T.current.useCallback(e,t)},t.useContext=function(e){return T.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return T.current.useDeferredValue(e)},t.useEffect=function(e,t){return T.current.useEffect(e,t)},t.useId=function(){return T.current.useId()},t.useImperativeHandle=function(e,t,r){return T.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return T.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return T.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return T.current.useMemo(e,t)},t.useReducer=function(e,t,r){return T.current.useReducer(e,t,r)},t.useRef=function(e){return T.current.useRef(e)},t.useState=function(e){return T.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return T.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return T.current.useTransition()},t.version="18.3.1"},4391:(e,t,r)=>{var n=r(7950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},4467:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(816);function a(e,t,r){return(t=(0,n.A)(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},4505:(e,t,r)=>{r.r(t),r.d(t,{API_BASE_URL:()=>s,API_ORIGIN:()=>o,activitiesService:()=>g,aiService:()=>N,authService:()=>u,bubblesService:()=>S,calendarService:()=>j,companyDocsService:()=>v,customersService:()=>f,default:()=>L,documentsService:()=>y,feedbackService:()=>T,healthService:()=>C,messagesService:()=>x,notificationsService:()=>w,onboardingService:()=>h,phaseOverrideService:()=>_,projectMessagesService:()=>b,projectsService:()=>m,rolesService:()=>P,tasksService:()=>p,usersService:()=>E,workflowAlertsService:()=>k,workflowImportService:()=>I,workflowService:()=>A});var n=r(9379),a=r(9722);const s=(()=>{if("undefined"!==typeof window){const e=window.location.host;if(console.log("\ud83d\udd0d API CONFIG: Current host:",e),!e.includes("localhost")&&!e.includes("127.0.0.1")){const t="".concat(window.location.protocol,"//").concat(e,"/api");return console.log("\ud83d\udd0d API CONFIG: Using production API:",t),t}}return{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL?(console.log("\ud83d\udd0d API CONFIG: Using env var API:",{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL),{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL):(console.log("\ud83d\udd0d API CONFIG: Using localhost fallback"),"http://localhost:5000/api")})(),o=(()=>{try{if(s.endsWith("/api"))return s.slice(0,-4)}catch(Pr){}return s})(),i=(()=>{try{if("undefined"!==typeof window)return"".concat(window.location.protocol,"//").concat(window.location.host,"/api")}catch(Pr){}return null})(),l=new Map,c=a.A.create({baseURL:s,timeout:2e4,headers:{"Content-Type":"application/json"}});let d=!1;c.interceptors.request.use(e=>{if("get"===e.method){const t="".concat(e.url).concat(JSON.stringify(e.params||{})),r=l.get(t);if(r&&Date.now()-r.timestamp<5e3)return Promise.reject({cached:!0,data:r.data,config:e})}const t=localStorage.getItem("authToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>{if("get"===e.config.method){const t="".concat(e.config.url).concat(JSON.stringify(e.config.params||{}));if(l.set(t,{timestamp:Date.now(),data:e.data}),l.size>100){const e=Date.now();for(const[t,r]of l.entries())e-r.timestamp>15e3&&l.delete(t)}}return e},e=>{var t,r,a,o,u,h,m,p,f,g,v;const x=!e.response||"Network Error"===e.message||"ERR_NETWORK"===e.code,b="ECONNABORTED"===e.code||/timeout/i.test(e.message||"");if((x||b)&&(null===(t=e.config)||void 0===t||!t.__triedSameOrigin)&&i&&c.defaults.baseURL!==i)try{const t=(0,n.A)((0,n.A)({},e.config),{},{baseURL:i,__triedSameOrigin:!0});return c.request(t)}catch(Pr){}if((null===(r=e.response)||void 0===r?void 0:r.status)>=500&&"get"===(null===(a=e.config)||void 0===a?void 0:a.method)){const t="".concat(e.config.url).concat(JSON.stringify(e.config.params||{})),r=l.get(t);if(r)return Promise.resolve({data:r.data,config:e.config,cached:!0})}if(e.cached)return Promise.resolve({data:e.data,config:e.config,cached:!0});if(console.error("\ud83d\udea8 API ERROR:",{url:null===(o=e.config)||void 0===o?void 0:o.url,method:null===(u=e.config)||void 0===u?void 0:u.method,status:null===(h=e.response)||void 0===h?void 0:h.status,statusText:null===(m=e.response)||void 0===m?void 0:m.statusText,data:null===(p=e.response)||void 0===p?void 0:p.data,message:e.message}),401===(null===(f=e.response)||void 0===f?void 0:f.status)&&!d){d=!0,console.warn("\ud83d\udd10 Session expired or invalid token - redirecting to login...");try{localStorage.removeItem("authToken"),localStorage.removeItem("token"),localStorage.removeItem("user"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("token"),sessionStorage.removeItem("user")}catch(Pr){}return l.clear(),"undefined"!==typeof window&&window.dispatchEvent(new CustomEvent("auth:sessionExpired",{detail:{message:"Your session has expired. Please log in again."}})),setTimeout(()=>{d=!1},2e3),e.message="Session expired. Please log in again.",Promise.reject(e)}if(x||b){const t=e.config&&(e.config.baseURL||c.defaults.baseURL)||s||"server";e.message="Network error: Cannot reach ".concat(t,". Please ensure the backend is running.")}else(null===(g=e.response)||void 0===g?void 0:g.status)>=500?e.message="Server error: The server is experiencing issues. Please try again later.":404===(null===(v=e.response)||void 0===v?void 0:v.status)&&(e.message="Not found: The requested resource could not be found.");return Promise.reject(e)});const u={logout:()=>{try{localStorage.removeItem("authToken"),localStorage.removeItem("token"),localStorage.removeItem("user")}catch(Pr){}try{sessionStorage.removeItem("authToken"),sessionStorage.removeItem("token"),sessionStorage.removeItem("user")}catch(Pr){}},getCurrentUser:async()=>(await c.get("/auth/me")).data,isAuthenticated:()=>{const e=localStorage.getItem("authToken");return Boolean(e)},getStoredUser:()=>{const e=localStorage.getItem("user");if(e)try{return JSON.parse(e)}catch(Pr){}const t=sessionStorage.getItem("user");if(t)try{return JSON.parse(t)}catch(Pr){}return null},updateUserProfile:async e=>{const t=await c.put("/auth/profile",e);return t.data.data&&t.data.data.user&&localStorage.setItem("user",JSON.stringify(t.data.data.user)),t.data}},h={getOnboardingStatus:async()=>(await c.get("/onboarding/status")).data,updateRole:async e=>{const t=await c.put("/onboarding/role",e);return t.data.data&&t.data.data.user&&localStorage.setItem("user",JSON.stringify(t.data.data.user)),t.data},completeOnboarding:async e=>{const t=await c.post("/onboarding/complete",{onboardingData:e});return t.data.data&&t.data.data.user&&localStorage.setItem("user",JSON.stringify(t.data.data.user)),t.data},getAvailableRoles:async()=>(await c.get("/onboarding/roles")).data,resetOnboarding:async()=>{const e=await c.post("/onboarding/reset");return e.data.data&&e.data.data.user&&localStorage.setItem("user",JSON.stringify(e.data.data.user)),e.data}},m={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/projects",{params:e})).data},getById:async e=>(await c.get("/projects/".concat(e))).data,create:async e=>(await c.post("/projects",e)).data,update:async(e,t)=>(await c.put("/projects/".concat(e),t)).data,delete:async e=>(await c.delete("/projects/".concat(e))).data,archive:async e=>(await c.patch("/projects/".concat(e,"/archive"))).data,getArchived:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/projects",{params:(0,n.A)((0,n.A)({},e),{},{includeArchived:"only"})})).data},updateProgress:async(e,t)=>(await c.patch("/projects/".concat(e,"/progress"),{progress:t})).data,updateStatus:async(e,t)=>(await c.patch("/projects/".concat(e,"/status"),{status:t})).data,getStats:async()=>(await c.get("/projects/stats/overview")).data,search:async e=>(await c.get("/projects/search/query?q=".concat(encodeURIComponent(e)))).data,getWorkflow:async e=>(await c.get("/test/workflow/".concat(e))).data,updateWorkflowStep:async(e,t,r)=>(await c.put("/test/workflow/".concat(e,"/step/").concat(t),r)).data,getPets:async e=>(await c.get("/projects/".concat(e,"/pets"))).data,createPet:async(e,t)=>(await c.post("/projects/".concat(e,"/pets"),t)).data,updatePet:async(e,t,r)=>(await c.put("/projects/".concat(e,"/pets/").concat(t),r)).data,deletePet:async(e,t)=>(await c.delete("/projects/".concat(e,"/pets/").concat(t))).data},p={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/tasks",{params:e})).data},getById:async e=>(await c.get("/tasks/".concat(e))).data,create:async e=>(await c.post("/tasks",e)).data,update:async(e,t)=>(await c.put("/tasks/".concat(e),t)).data,delete:async e=>(await c.delete("/tasks/".concat(e))).data,updateStatus:async(e,t)=>(await c.patch("/tasks/".concat(e,"/status"),{status:t})).data,assign:async(e,t)=>(await c.patch("/tasks/".concat(e,"/assign"),{assignedTo:t})).data,getByProject:async e=>(await c.get("/tasks/project/".concat(e))).data,getAssignedToUser:async e=>(await c.get("/tasks/assigned/".concat(e))).data,addComment:async(e,t)=>(await c.post("/tasks/".concat(e,"/comments"),{content:t})).data},f={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/customers",{params:e})).data},getById:async e=>(await c.get("/customers/".concat(e))).data,create:async e=>(await c.post("/customers",e)).data,update:async(e,t)=>(await c.put("/customers/".concat(e),t)).data,delete:async e=>(await c.delete("/customers/".concat(e))).data,search:async e=>(await c.get("/customers/search/query?q=".concat(encodeURIComponent(e)))).data,getFamilyMembers:async e=>(await c.get("/customers/".concat(e,"/family-members"))).data,createFamilyMember:async(e,t)=>(await c.post("/customers/".concat(e,"/family-members"),t)).data,updateFamilyMember:async(e,t,r)=>(await c.put("/customers/".concat(e,"/family-members/").concat(t),r)).data,deleteFamilyMember:async(e,t)=>(await c.delete("/customers/".concat(e,"/family-members/").concat(t))).data},g={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/activities",{params:e})).data},getRecent:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return(await c.get("/activities/recent",{params:{limit:e}})).data},getByProject:async e=>(await c.get("/activities/project/".concat(e))).data,create:async e=>(await c.post("/activities",e)).data},v={listAssets:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/company-docs/assets",{params:e})).data},uploadAsset:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new FormData;r.append("file",e),t.title&&r.append("title",t.title),t.description&&r.append("description",t.description),t.tags&&r.append("tags",JSON.stringify(t.tags)),t.section&&r.append("section",t.section),t.parentId&&r.append("parentId",t.parentId),void 0!==t.sortOrder&&r.append("sortOrder",t.sortOrder.toString());return(await c.post("/company-docs/assets/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data},deleteAsset:async e=>(await c.delete("/company-docs/assets/".concat(e))).data,downloadAsset:async e=>await c.get("/company-docs/assets/".concat(e,"/download"),{responseType:"blob"}),getAssetPreview:async e=>(await c.get("/company-docs/assets/".concat(e,"/preview"))).data,generateThumbnail:async e=>(await c.post("/company-docs/assets/".concat(e,"/thumbnail"))).data,getAssetVersions:async e=>(await c.get("/company-docs/assets/".concat(e,"/versions"))).data,createAssetVersion:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new FormData;n.append("file",t),r.description&&n.append("description",r.description),r.versionNumber&&n.append("versionNumber",r.versionNumber);return(await c.post("/company-docs/assets/".concat(e,"/versions"),n,{headers:{"Content-Type":"multipart/form-data"}})).data},getAssetStats:async()=>(await c.get("/company-docs/assets/stats")).data,searchAssets:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/company-docs/assets/search",{params:e})).data},createFolder:async e=>(await c.post("/company-docs/folders",e)).data,updateAsset:async(e,t)=>(await c.patch("/company-docs/assets/".concat(e),t)).data,reorderAssets:async e=>(await c.patch("/company-docs/assets/reorder",{updates:e})).data,bulkDeleteAssets:async e=>(await c.delete("/company-docs/assets/bulk",{data:{ids:e}})).data,bulkMoveAssets:async(e,t)=>(await c.patch("/company-docs/assets/bulk-move",{ids:e,parentId:t})).data,renameAsset:async(e,t)=>(await c.patch("/company-docs/assets/".concat(e),{title:t})).data,moveAsset:async(e,t)=>(await c.patch("/company-docs/assets/".concat(e),{parentId:t})).data,toggleFavorite:async e=>(await c.post("/company-docs/assets/".concat(e,"/favorite"))).data,listTemplates:async()=>(await c.get("/company-docs/templates")).data,createTemplate:async(e,t)=>{const r=new FormData;if(r.append("file",e),r.append("name",t.name),t.description&&r.append("description",t.description),t.format&&r.append("format",t.format),t.section&&r.append("section",t.section),void 0!==t.fields){const e="string"===typeof t.fields?t.fields:JSON.stringify(t.fields);r.append("fields",e)}return(await c.post("/company-docs/templates",r,{headers:{"Content-Type":"multipart/form-data"}})).data},generate:async e=>(await c.post("/company-docs/generate",e)).data,deleteTemplate:async e=>(await c.delete("/company-docs/templates/".concat(e))).data,updateTemplate:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new FormData;if(t.name&&n.append("name",t.name),void 0!==t.description&&n.append("description",t.description),t.format&&n.append("format",t.format),void 0!==t.section&&n.append("section",t.section),void 0!==t.fields){const e="string"===typeof t.fields?t.fields:JSON.stringify(t.fields);n.append("fields",e)}r&&n.append("file",r);return(await c.patch("/company-docs/templates/".concat(e),n,{headers:{"Content-Type":"multipart/form-data"}})).data}},x={getConversation:async e=>(await c.get("/messages/".concat(e))).data,send:async e=>(await c.post("/messages",e)).data,getConversations:async()=>(await c.get("/messages/conversations")).data,getUnreadCount:async()=>(await c.get("/messages/unread/count")).data,getUnreadBySender:async()=>(await c.get("/messages/unread/by-sender")).data},b={getByProject:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await c.get("/project-messages/".concat(e),{params:t})).data},create:async function(e){let{content:t,subject:r,priority:n="MEDIUM",parentMessageId:a,recipients:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o={content:t,subject:r,priority:n};a&&(o.parentMessageId=a),Array.isArray(s)&&s.length>0&&(o.recipients=s);return(await c.post("/project-messages/".concat(e),o)).data},markRead:async e=>(await c.patch("/project-messages/".concat(e,"/read"))).data,getThread:async e=>(await c.get("/project-messages/thread/".concat(e))).data,delete:async e=>(await c.delete("/project-messages/".concat(e))).data},y={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/documents",{params:e})).data},getByProject:async e=>(await c.get("/documents/project/".concat(e))).data,upload:async e=>(await c.post("/documents/upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,delete:async e=>(await c.delete("/documents/".concat(e))).data,download:async e=>await c.get("/documents/".concat(e,"/download"),{responseType:"blob"})},w={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/notifications",{params:e})).data},getUnreadCount:async()=>(await c.get("/notifications/unread/count")).data,markAsRead:async e=>(await c.post("/notifications/".concat(e,"/read"))).data,markAllAsRead:async()=>(await c.post("/notifications/read-all")).data,create:async e=>(await c.post("/notifications",e)).data},j={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/calendar-events",{params:e})).data},create:async e=>(await c.post("/calendar-events",e)).data,update:async(e,t)=>(await c.put("/calendar-events/".concat(e),t)).data,delete:async e=>(await c.delete("/calendar-events/".concat(e))).data},N={chat:async e=>(await c.post("/ai/chat",{message:e})).data,getCapabilities:async()=>(await c.get("/ai/capabilities")).data,analyzeProject:async e=>(await c.post("/ai/analyze-project",{projectId:e})).data},S={chat:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r={message:e,context:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}};null!==t&&void 0!==t&&""!==String(t).trim()&&(r.projectId=String(t));return(await c.post("/bubbles/chat",r)).data},completeAction:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return(await c.post("/bubbles/complete-action",{pendingAction:e,selectedRecipientIds:t,customEmails:r})).data},getCurrentStep:async e=>(await c.get("/bubbles/project/".concat(e,"/current-step"))).data,executeAction:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await c.post("/bubbles/action",{actionType:e,parameters:t})).data},getHistory:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return(await c.get("/bubbles/history",{params:{limit:e}})).data},resetContext:async()=>(await c.post("/bubbles/reset")).data,getStatus:async()=>(await c.get("/bubbles/status")).data,quickActions:{completeTask:async(e,t)=>await S.executeAction("complete_task",{projectId:e,lineItemId:t}),createAlert:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MEDIUM";return await S.executeAction("create_alert",{projectId:e,message:t,priority:r})},listProjects:async()=>await S.executeAction("list_projects"),checkAlerts:async()=>await S.executeAction("check_alerts")},insights:{getProjectInsights:async e=>(await c.get("/bubbles/insights/project/".concat(e))).data,getPortfolioInsights:async()=>(await c.get("/bubbles/insights/portfolio")).data,getProjectPrediction:async e=>(await c.get("/bubbles/insights/prediction/".concat(e))).data,getProjectRisks:async e=>(await c.get("/bubbles/insights/risks/".concat(e))).data,getOptimizationRecommendations:async e=>(await c.get("/bubbles/insights/optimization/".concat(e))).data}},k={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.get("/alerts",{params:e})).data},getByProject:async e=>(await c.get("/alerts/project/".concat(e))).data,getByUser:async e=>(await c.get("/alerts",{params:{userId:e}})).data,getByPriority:async e=>(await c.get("/alerts",{params:{priority:e}})).data,getSummary:async()=>(await c.get("/alerts/stats")).data,acknowledge:async e=>(await c.patch("/alerts/".concat(e,"/read"))).data,dismiss:async e=>(await c.delete("/alerts/".concat(e))).data,completeStep:async function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return(await c.post("/workflows/complete-item",{projectId:t,lineItemId:r,notes:n,alertId:e})).data},markAllAsRead:async()=>(await c.patch("/alerts/read-all")).data,create:async e=>(await c.post("/alerts",e)).data,triggerManualCheck:async()=>(await c.post("/alerts/check-workflow")).data,getWorkflowStats:async()=>(await c.get("/alerts/workflow-stats")).data,assignAlert:async(e,t)=>(await c.patch("/alerts/".concat(e,"/assign"),{assignedTo:t})).data,dismissAlert:async e=>(await c.patch("/alerts/".concat(e,"/dismiss"))).data,completeAlert:async e=>(await c.patch("/alerts/".concat(e,"/complete"))).data},A={getByProject:async e=>(await c.get("/workflows/project/".concat(e))).data,create:async(e,t)=>(await c.post("/workflows/project/".concat(e),t)).data,updateStep:async(e,t,r)=>(await c.put("/workflows/".concat(e,"/steps/").concat(t),r)).data,completeStep:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";console.log("\ud83d\ude80 Frontend: Completing line item ".concat(t," for project ").concat(e));return(await c.post("/workflows/complete-item",{projectId:e,lineItemId:t,notes:r||""})).data},completeSubTask:async(e,t,r)=>(await c.post("/workflows/".concat(e,"/steps/").concat(t,"/subtasks/").concat(r,"/complete"))).data,assignTeamMember:async(e,t,r)=>(await c.put("/workflows/".concat(e,"/steps/").concat(t,"/assign"),{assignedTo:r})).data,getProgress:async e=>(await c.get("/workflows/project/".concat(e,"/alerts"))).data,getStats:async()=>(await c.get("/workflows/stats")).data},C={getHealth:async()=>(await c.get("/health")).data,getDetailedHealth:async()=>(await c.get("/health/detailed")).data},E={getTeamMembers:async()=>(await c.get("/users/team-members")).data,deleteUser:async e=>(await c.delete("/users/".concat(e))).data},P={getUsers:async()=>(await c.get("/roles/users")).data},_={getAvailablePhases:async()=>(await c.get("/phase-override/phases")).data,getProjectPhaseStatus:async e=>(await c.get("/phase-override/project/".concat(e,"/status"))).data,overrideProjectPhase:async(e,t,r,n)=>(await c.post("/phase-override/project/".concat(e,"/override"),{toPhase:t,reason:r,userId:n})).data,revertPhaseOverride:async(e,t,r)=>(await c.post("/phase-override/project/".concat(e,"/revert"),{overrideId:t,userId:r})).data,getSuppressedAlerts:async e=>(await c.get("/phase-override/project/".concat(e,"/suppressed-alerts"))).data},I={uploadFile:async e=>(await c.post("/workflow-import/upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,getPreview:async e=>(await c.get("/workflow-import/preview/".concat(e))).data,confirmImport:async(e,t)=>(await c.post("/workflow-import/confirm/".concat(e),t)).data,downloadTemplate:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xlsx";const t=await c.get("/workflow-import/template",{params:{format:e},responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=r,n.setAttribute("download","workflow_template.".concat(e)),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)},cancelImport:async e=>(await c.delete("/workflow-import/cancel/".concat(e))).data},T={getFeedback:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c.get("/feedback",{params:e})},getFeedbackById:e=>c.get("/feedback/".concat(e)),createFeedback:e=>c.post("/feedback",e),updateFeedback:(e,t)=>c.patch("/feedback/".concat(e),t),deleteFeedback:e=>c.delete("/feedback/".concat(e)),vote:(e,t)=>c.post("/feedback/".concat(e,"/vote"),{action:t}),updateStatus:(e,t)=>c.patch("/feedback/".concat(e,"/status"),t),addComment:(e,t)=>c.post("/feedback/".concat(e,"/comments"),t),getComments:e=>c.get("/feedback/".concat(e,"/comments")),deleteComment:(e,t)=>c.delete("/feedback/".concat(e,"/comments/").concat(t)),follow:e=>c.post("/feedback/".concat(e,"/follow")),unfollow:e=>c.delete("/feedback/".concat(e,"/follow")),checkFollowStatus:e=>c.get("/feedback/".concat(e,"/follow")),uploadFile:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"attachment";const r=new FormData;return r.append("file",e),r.append("type",t),c.post("/upload",r,{headers:{"Content-Type":"multipart/form-data"}})},getNotifications:e=>c.get("/users/".concat(e,"/notifications")),markNotificationAsRead:e=>c.patch("/notifications/".concat(e,"/read")),markAllNotificationsAsRead:e=>c.patch("/users/".concat(e,"/notifications/read-all")),subscribeToFeedback:e=>c.post("/feedback/".concat(e,"/subscribe")),unsubscribeFromFeedback:e=>c.delete("/feedback/".concat(e,"/subscribe")),getFeedbackAnalytics:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c.get("/feedback/analytics",{params:e})},getFeedbackStats:()=>c.get("/feedback/stats"),searchFeedback:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c.get("/feedback/search",{params:(0,n.A)({q:e},t)})},getTags:()=>c.get("/tags"),createTag:e=>c.post("/tags",e),findDuplicates:e=>c.get("/feedback/".concat(e,"/duplicates")),mergeFeedback:(e,t)=>c.post("/feedback/".concat(e,"/merge"),{targetId:t})},L=c},4612:(e,t)=>{function r(e,t){var r=e.length;e.push(t);e:for(;0<r;){var n=r-1>>>1,a=e[n];if(!(0<s(a,t)))break e;e[n]=t,e[r]=a,r=n}}function n(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,a=e.length,o=a>>>1;n<o;){var i=2*(n+1)-1,l=e[i],c=i+1,d=e[c];if(0>s(l,r))c<a&&0>s(d,l)?(e[n]=d,e[c]=r,n=c):(e[n]=l,e[i]=r,n=i);else{if(!(c<a&&0>s(d,r)))break e;e[n]=d,e[c]=r,n=c}}}return t}function s(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();t.unstable_now=function(){return i.now()-l}}var c=[],d=[],u=1,h=null,m=3,p=!1,f=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,x="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function y(e){for(var t=n(d);null!==t;){if(null===t.callback)a(d);else{if(!(t.startTime<=e))break;a(d),t.sortIndex=t.expirationTime,r(c,t)}t=n(d)}}function w(e){if(g=!1,y(e),!f)if(null!==n(c))f=!0,L(j);else{var t=n(d);null!==t&&D(w,t.startTime-e)}}function j(e,r){f=!1,g&&(g=!1,x(A),A=-1),p=!0;var s=m;try{for(y(r),h=n(c);null!==h&&(!(h.expirationTime>r)||e&&!P());){var o=h.callback;if("function"===typeof o){h.callback=null,m=h.priorityLevel;var i=o(h.expirationTime<=r);r=t.unstable_now(),"function"===typeof i?h.callback=i:h===n(c)&&a(c),y(r)}else a(c);h=n(c)}if(null!==h)var l=!0;else{var u=n(d);null!==u&&D(w,u.startTime-r),l=!1}return l}finally{h=null,m=s,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var N,S=!1,k=null,A=-1,C=5,E=-1;function P(){return!(t.unstable_now()-E<C)}function _(){if(null!==k){var e=t.unstable_now();E=e;var r=!0;try{r=k(!0,e)}finally{r?N():(S=!1,k=null)}}else S=!1}if("function"===typeof b)N=function(){b(_)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,T=I.port2;I.port1.onmessage=_,N=function(){T.postMessage(null)}}else N=function(){v(_,0)};function L(e){k=e,S||(S=!0,N())}function D(e,r){A=v(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,L(j))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var r=m;m=t;try{return e()}finally{m=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=m;m=e;try{return t()}finally{m=r}},t.unstable_scheduleCallback=function(e,a,s){var o=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,e){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return e={id:u++,callback:a,priorityLevel:e,startTime:s,expirationTime:i=s+i,sortIndex:-1},s>o?(e.sortIndex=s,r(d,e),null===n(c)&&e===n(d)&&(g?(x(A),A=-1):g=!0,D(w,s-o))):(e.sortIndex=i,r(c,e),f||p||(f=!0,L(j))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=m;return function(){var r=m;m=t;try{return e.apply(this,arguments)}finally{m=r}}}},4630:(e,t,r)=>{r.r(t),r.d(t,{Headers:()=>o,Request:()=>i,Response:()=>l,default:()=>s,fetch:()=>a});var n=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof r.g)return r.g;throw new Error("unable to locate global object")}();const a=n.fetch,s=n.fetch.bind(n),o=n.Headers,i=n.Request,l=n.Response},5043:(e,t,r)=>{e.exports=r(4202)},5736:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(7374));class s extends a.default{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"===typeof e&&new RegExp("[,()]").test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"in.(".concat(r,")")),this}contains(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return"string"===typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t){let{config:r,type:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a="";"plain"===n?a="pl":"phrase"===n?a="ph":"websearch"===n&&(a="w");const s=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append(e,"".concat(a,"fts").concat(s,".").concat(t)),this}match(e){return Object.entries(e).forEach(e=>{let[t,r]=e;this.url.searchParams.append(t,"eq.".concat(r))}),this}not(e,t,r){return this.url.searchParams.append(e,"not.".concat(t,".").concat(r)),this}or(e){let{foreignTable:t,referencedTable:r=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=r?"".concat(r,".or"):"or";return this.url.searchParams.append(n,"(".concat(e,")")),this}filter(e,t,r){return this.url.searchParams.append(e,"".concat(t,".").concat(r)),this}}t.default=s},7067:(e,t,r)=>{e.exports=r(4612)},7374:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(9286));class s extends a.default{select(e){let t=!1;const r=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e){let{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:a=n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=a?"".concat(a,".order"):"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,"".concat(o?"".concat(o,","):"").concat(e,".").concat(t?"asc":"desc").concat(void 0===r?"":r?".nullsfirst":".nullslast")),this}limit(e){let{foreignTable:t,referencedTable:r=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n="undefined"===typeof r?"limit":"".concat(r,".limit");return this.url.searchParams.set(n,"".concat(e)),this}range(e,t){let{foreignTable:r,referencedTable:n=r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a="undefined"===typeof n?"offset":"".concat(n,".offset"),s="undefined"===typeof n?"limit":"".concat(n,".limit");return this.url.searchParams.set(a,"".concat(e)),this.url.searchParams.set(s,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain(){let{analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:a=!1,format:s="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var o;const i=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(s,'; for="').concat(l,'"; options=').concat(i,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}}t.default=s},7877:(e,t,r)=>{r.d(t,{A:()=>c,assetsService:()=>l});var n=r(9722);const a=async e=>{var t,r;const n=await o.get("/assets/".concat(e,"/download"),{responseType:"blob"}),a=(null===(t=n.headers)||void 0===t?void 0:t["content-type"])||"application/octet-stream",s=i(null===(r=n.headers)||void 0===r?void 0:r["content-disposition"])||"download";return{blob:new Blob([n.data],{type:a}),contentType:a,filename:s}},s=(()=>{if("undefined"!==typeof window){const e=window.location.host,t=window.location.protocol;if(!e.includes("localhost")&&!e.includes("127.0.0.1"))return"".concat(t,"//").concat(e,"/api/company-docs-enhanced");if({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL){const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL.replace(/\/$/,"");return"".concat(e,"/company-docs-enhanced")}return"http://localhost:5000/api/company-docs-enhanced"}return{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL?"".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL.replace(/\/$/,""),"/company-docs-enhanced"):"http://localhost:5000/api/company-docs-enhanced"})(),o=n.A.create({baseURL:s});o.interceptors.request.use(e=>{const t="undefined"!==typeof sessionStorage&&(sessionStorage.getItem("authToken")||sessionStorage.getItem("token"))||"undefined"!==typeof localStorage&&(localStorage.getItem("authToken")||localStorage.getItem("token"));return t&&(e.headers.Authorization="Bearer ".concat(t)),e});const i=e=>{try{if(!e||"string"!==typeof e)return null;const t=e.match(/filename\*=UTF-8''([^;]+)/i);if(t&&t[1])return decodeURIComponent(t[1]);const r=e.match(/filename\s*=\s*"?([^";]+)"?/i);if(r&&r[1])return r[1]}catch(Pr){}return null},l={list:async function(){var e;let{parentId:t=null,search:r="",page:n=1,limit:a=50,sortBy:s,sortOrder:i,type:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const c={parentId:null===t?"null":t,page:n,limit:a};r&&(c.search=r),s&&(c.sortBy=s),i&&(c.sortOrder=i),l&&(c.type=l);return null===(e=(await o.get("/assets",{params:c})).data)||void 0===e?void 0:e.data},listFolders:async function(){let{parentId:e=null,sortBy:t="title",sortOrder:r="asc",limit:n=1e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=await l.list({parentId:e,type:"FOLDER",sortBy:t,sortOrder:r,limit:n});return(null===a||void 0===a?void 0:a.assets)||[]},get:async e=>{var t,r;return null===(t=(await o.get("/assets/".concat(e))).data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.asset},getViewUrl:async e=>{var t;return null===(t=(await o.get("/assets/".concat(e,"/view-url"))).data)||void 0===t?void 0:t.data},createFolder:async e=>{let{name:t,parentId:r=null,description:n="",metadata:a=null}=e;try{var s,i,l;console.log("Creating folder with payload:",{name:t,parentId:r,description:n,metadata:a});const e="OFFICE_DOCUMENTS",c={name:t,title:t,folderName:t,description:n||"",parentId:r&&"null"!==r&&"undefined"!==r?r:null,section:e,isPublic:!1,accessLevel:"private",type:"FOLDER",tags:[],isActive:!0,version:1,metadata:a};console.log("Using section:",e),console.log("Sending payload to /folders:",c);const d=await o.post("/folders",c);return console.log("Folder created successfully:",d.data),(null===(s=d.data)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.folder)||(null===(l=d.data)||void 0===l?void 0:l.data)||d.data}catch(g){var c,d,u,h,m,p,f;console.error("Error in createFolder:",{message:g.message,response:null===(c=g.response)||void 0===c?void 0:c.data,status:null===(d=g.response)||void 0===d?void 0:d.status,config:{url:null===(u=g.config)||void 0===u?void 0:u.url,method:null===(h=g.config)||void 0===h?void 0:h.method,data:null===(m=g.config)||void 0===m?void 0:m.data}});const e=(null===(p=g.response)||void 0===p||null===(f=p.data)||void 0===f?void 0:f.message)||"Failed to create folder",t=new Error(e);throw t.response=g.response,t}},updateAsset:async(e,t)=>{var r,n;return null===(r=(await o.patch("/assets/".concat(e),t)).data)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.asset},bulkOperation:async e=>{var t;let{operation:r,assetIds:n,data:a={}}=e;return null===(t=(await o.post("/bulk-operation",{operation:r,assetIds:n,data:a})).data)||void 0===t?void 0:t.data},uploadFiles:async function(){let{files:e,parentId:t=null,description:r="",tags:n=[],metadata:a={},onUploadProgress:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e||!Array.isArray(e)||0===e.length)throw new Error("No files provided for upload");console.log("\ud83d\udce4 Uploading files:",e.map(e=>({name:e.name||e.title||"unnamed",size:e.size,type:e.type})));const i=new FormData;for(const o of e){if(!(o instanceof File))throw console.error("Invalid file object:",o),new Error("Invalid file object: ".concat(o.name||"unknown"," must be a File instance"));i.append("files",o)}null!==t&&i.append("parentId",t),r&&i.append("description",r),null!==n&&void 0!==n&&n.length&&i.append("tags",JSON.stringify(n)),a&&Object.keys(a).length>0&&i.append("metadata",JSON.stringify(a));const l={headers:{"Content-Type":"multipart/form-data"}};"function"===typeof s&&(l.onUploadProgress=s);try{const e=await o.post("/assets/upload",i,l);if(console.log("\u2705 Upload response:",e.data),e.data&&e.data.success)return e.data.data;{var c,d;const t=(null===(c=e.data)||void 0===c?void 0:c.message)||(null===(d=e.data)||void 0===d?void 0:d.error)||"Upload failed";throw console.error("\u274c Upload failed:",t),new Error(t)}}catch(N){var u,h,m,p,f,g,v,x;if(console.error("\u274c Upload error in assetsService:",{message:N.message,response:null===(u=N.response)||void 0===u?void 0:u.data,status:null===(h=N.response)||void 0===h?void 0:h.status,statusText:null===(m=N.response)||void 0===m?void 0:m.statusText}),413===(null===(p=N.response)||void 0===p?void 0:p.status))throw new Error("File too large. Maximum file size is 50MB");if(400===(null===(f=N.response)||void 0===f?void 0:f.status)){var b,y,w,j;const e=(null===(b=N.response)||void 0===b||null===(y=b.data)||void 0===y?void 0:y.message)||(null===(w=N.response)||void 0===w||null===(j=w.data)||void 0===j?void 0:j.error)||"Invalid file format";throw new Error(e)}if(401===(null===(g=N.response)||void 0===g?void 0:g.status))throw new Error("Please log in to upload files");if(403===(null===(v=N.response)||void 0===v?void 0:v.status))throw new Error("You do not have permission to upload files");if((null===(x=N.response)||void 0===x?void 0:x.status)>=500)throw new Error("Server error. Please try again later");if("Network Error"===N.message||"ERR_NETWORK"===N.code)throw new Error("Network error. Please check your connection and try again");throw N}},downloadUrl:e=>"".concat(s,"/assets/").concat(e,"/download"),downloadBlob:a,openInNewTab:async e=>{const t=(()=>{try{return window.open("about:blank","_blank")}catch(Pr){return null}})();try{const{blob:r}=await a(e),n=URL.createObjectURL(r);t?t.location.href=n:window.location.href=n,setTimeout(()=>URL.revokeObjectURL(n),6e4)}catch(r){try{t&&!t.closed&&t.close()}catch(Pr){}throw r}},saveToDisk:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"download";const{blob:r,filename:n}=await a(e),s=URL.createObjectURL(r),o=document.createElement("a");o.href=s,o.download=n||t,document.body.appendChild(o),o.click(),o.remove(),setTimeout(()=>URL.revokeObjectURL(s),6e4)}},c=l},7950:(e,t,r)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(2730)},7980:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const a=n(r(1210));t.PostgrestClient=a.default;const s=n(r(8829));t.PostgrestQueryBuilder=s.default;const o=n(r(5736));t.PostgrestFilterBuilder=o.default;const i=n(r(7374));t.PostgrestTransformBuilder=i.default;const l=n(r(9286));t.PostgrestBuilder=l.default;const c=n(r(2611));t.PostgrestError=c.default,t.default={PostgrestClient:a.default,PostgrestQueryBuilder:s.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:l.default,PostgrestError:c.default}},8829:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(5736));t.default=class{constructor(e,t){let{headers:r={},schema:n,fetch:a}=t;this.url=e,this.headers=new Headers(r),this.schema=n,this.fetch=a}select(e){let{head:t=!1,count:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t?"HEAD":"GET";let s=!1;const o=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!s?"":('"'===e&&(s=!s),e)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer","count=".concat(r)),new a.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e){let{count:t,defaultToNull:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;if(t&&this.headers.append("Prefer","count=".concat(t)),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new a.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e){let{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:s=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var o;if(this.headers.append("Prefer","resolution=".concat(r?"ignore":"merge","-duplicates")),void 0!==t&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer","count=".concat(n)),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new a.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(o=this.fetch)&&void 0!==o?o:fetch})}update(e){let{count:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;return t&&this.headers.append("Prefer","count=".concat(t)),new a.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete(){let{count:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return e&&this.headers.append("Prefer","count=".concat(e)),new a.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}}},9286:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(4630)),s=n(r(2611));t.default=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:"undefined"===typeof fetch?this.fetch=a.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,n,a;let o=null,i=null,l=null,c=e.status,d=e.statusText;if(e.ok){if("HEAD"!==this.method){const r=await e.text();""===r||(i="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}const a=null===(r=this.headers.get("Prefer"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),s=null===(n=e.headers.get("content-range"))||void 0===n?void 0:n.split("/");a&&s&&s.length>1&&(l=parseInt(s[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(o={code:"PGRST116",details:"Results contain ".concat(i.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,l=null,c=406,d="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=await e.text();try{o=JSON.parse(t),Array.isArray(o)&&404===e.status&&(i=[],o=null,c=200,d="OK")}catch(Hf){404===e.status&&""===t?(c=204,d="No Content"):o={message:t}}if(o&&this.isMaybeSingle&&(null===(a=null===o||void 0===o?void 0:o.details)||void 0===a?void 0:a.includes("0 rows"))&&(o=null,c=200,d="OK"),o&&this.shouldThrowOnError)throw new s.default(o)}return{error:o,data:i,count:l,status:c,statusText:d}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,n;return{error:{message:"".concat(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),details:"".concat(null!==(r=null===e||void 0===e?void 0:e.stack)&&void 0!==r?r:""),hint:"",code:"".concat(null!==(n=null===e||void 0===e?void 0:e.code)&&void 0!==n?n:"")},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}}},9379:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(4467);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){(0,n.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}},9722:(e,t,r)=>{r.d(t,{A:()=>Et});var n={};function a(e,t){return function(){return e.apply(t,arguments)}}r.r(n),r.d(n,{hasBrowserEnv:()=>ce,hasStandardBrowserEnv:()=>ue,hasStandardBrowserWebWorkerEnv:()=>he,navigator:()=>de,origin:()=>me});const{toString:s}=Object.prototype,{getPrototypeOf:o}=Object,{iterator:i,toStringTag:l}=Symbol,c=(e=>t=>{const r=s.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),d=e=>(e=e.toLowerCase(),t=>c(t)===e),u=e=>t=>typeof t===e,{isArray:h}=Array,m=u("undefined");function p(e){return null!==e&&!m(e)&&null!==e.constructor&&!m(e.constructor)&&v(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const f=d("ArrayBuffer");const g=u("string"),v=u("function"),x=u("number"),b=e=>null!==e&&"object"===typeof e,y=e=>{if("object"!==c(e))return!1;const t=o(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(l in e)&&!(i in e)},w=d("Date"),j=d("File"),N=d("Blob"),S=d("FileList"),k=d("URLSearchParams"),[A,C,E,P]=["ReadableStream","Request","Response","Headers"].map(d);function _(e,t){let r,n,{allOwnKeys:a=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),h(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{if(p(e))return;const n=a?Object.getOwnPropertyNames(e):Object.keys(e),s=n.length;let o;for(r=0;r<s;r++)o=n[r],t.call(null,e[o],o,e)}}function I(e,t){if(p(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n,a=r.length;for(;a-- >0;)if(n=r[a],t===n.toLowerCase())return n;return null}const T="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,L=e=>!m(e)&&e!==T;const D=(M="undefined"!==typeof Uint8Array&&o(Uint8Array),e=>M&&e instanceof M);var M;const O=d("HTMLFormElement"),R=(e=>{let{hasOwnProperty:t}=e;return(e,r)=>t.call(e,r)})(Object.prototype),F=d("RegExp"),U=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};_(r,(r,a)=>{let s;!1!==(s=t(r,a,e))&&(n[a]=s||r)}),Object.defineProperties(e,n)};const B=d("AsyncFunction"),z=((e,t)=>{return e?setImmediate:t?(r="axios@".concat(Math.random()),n=[],T.addEventListener("message",e=>{let{source:t,data:a}=e;t===T&&a===r&&n.length&&n.shift()()},!1),e=>{n.push(e),T.postMessage(r,"*")}):e=>setTimeout(e);var r,n})("function"===typeof setImmediate,v(T.postMessage)),W="undefined"!==typeof queueMicrotask?queueMicrotask.bind(T):"undefined"!==typeof process&&process.nextTick||z,q={isArray:h,isArrayBuffer:f,isBuffer:p,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||v(e.append)&&("formdata"===(t=c(e))||"object"===t&&v(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&f(e.buffer),t},isString:g,isNumber:x,isBoolean:e=>!0===e||!1===e,isObject:b,isPlainObject:y,isEmptyObject:e=>{if(!b(e)||p(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(_t){return!1}},isReadableStream:A,isRequest:C,isResponse:E,isHeaders:P,isUndefined:m,isDate:w,isFile:j,isBlob:N,isRegExp:F,isFunction:v,isStream:e=>b(e)&&v(e.pipe),isURLSearchParams:k,isTypedArray:D,isFileList:S,forEach:_,merge:function e(){const{caseless:t}=L(this)&&this||{},r={},n=(n,a)=>{const s=t&&I(r,a)||a;y(r[s])&&y(n)?r[s]=e(r[s],n):y(n)?r[s]=e({},n):h(n)?r[s]=n.slice():r[s]=n};for(let a=0,s=arguments.length;a<s;a++)arguments[a]&&_(arguments[a],n);return r},extend:function(e,t,r){let{allOwnKeys:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return _(t,(t,n)=>{r&&v(t)?e[n]=a(t,r):e[n]=t},{allOwnKeys:n}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let a,s,i;const l={};if(t=t||{},null==e)return t;do{for(a=Object.getOwnPropertyNames(e),s=a.length;s-- >0;)i=a[s],n&&!n(i,e,t)||l[i]||(t[i]=e[i],l[i]=!0);e=!1!==r&&o(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:c,kindOfTest:d,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(h(e))return e;let t=e.length;if(!x(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[i]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:O,hasOwnProperty:R,hasOwnProp:R,reduceDescriptors:U,freezeMethods:e=>{U(e,(t,r)=>{if(v(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];v(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach(e=>{r[e]=!0})};return h(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:I,global:T,isContextDefined:L,isSpecCompliantForm:function(e){return!!(e&&v(e.append)&&"FormData"===e[l]&&e[i])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(b(e)){if(t.indexOf(e)>=0)return;if(p(e))return e;if(!("toJSON"in e)){t[n]=e;const a=h(e)?[]:{};return _(e,(e,t)=>{const s=r(e,n+1);!m(s)&&(a[t]=s)}),t[n]=void 0,a}}return e};return r(e,0)},isAsyncFn:B,isThenable:e=>e&&(b(e)||v(e))&&v(e.then)&&v(e.catch),setImmediate:z,asap:W,isIterable:e=>null!=e&&v(e[i])};function V(e,t,r,n,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status?a.status:null)}q.inherits(V,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:q.toJSONObject(this.config),code:this.code,status:this.status}}});const H=V.prototype,G={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{G[e]={value:e}}),Object.defineProperties(V,G),Object.defineProperty(H,"isAxiosError",{value:!0}),V.from=(e,t,r,n,a,s)=>{const o=Object.create(H);return q.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),V.call(o,e.message,t,r,n,a),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};const K=V;function J(e){return q.isPlainObject(e)||q.isArray(e)}function Y(e){return q.endsWith(e,"[]")?e.slice(0,-2):e}function X(e,t,r){return e?e.concat(t).map(function(e,t){return e=Y(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}const Q=q.toFlatObject(q,{},null,function(e){return/^is[A-Z]/.test(e)});const Z=function(e,t,r){if(!q.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=q.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!q.isUndefined(t[e])})).metaTokens,a=r.visitor||c,s=r.dots,o=r.indexes,i=(r.Blob||"undefined"!==typeof Blob&&Blob)&&q.isSpecCompliantForm(t);if(!q.isFunction(a))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(q.isDate(e))return e.toISOString();if(q.isBoolean(e))return e.toString();if(!i&&q.isBlob(e))throw new K("Blob is not supported. Use a Buffer instead.");return q.isArrayBuffer(e)||q.isTypedArray(e)?i&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,a){let i=e;if(e&&!a&&"object"===typeof e)if(q.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(q.isArray(e)&&function(e){return q.isArray(e)&&!e.some(J)}(e)||(q.isFileList(e)||q.endsWith(r,"[]"))&&(i=q.toArray(e)))return r=Y(r),i.forEach(function(e,n){!q.isUndefined(e)&&null!==e&&t.append(!0===o?X([r],n,s):null===o?r:r+"[]",l(e))}),!1;return!!J(e)||(t.append(X(a,r,s),l(e)),!1)}const d=[],u=Object.assign(Q,{defaultVisitor:c,convertValue:l,isVisitable:J});if(!q.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!q.isUndefined(r)){if(-1!==d.indexOf(r))throw Error("Circular reference detected in "+n.join("."));d.push(r),q.forEach(r,function(r,s){!0===(!(q.isUndefined(r)||null===r)&&a.call(t,r,q.isString(s)?s.trim():s,n,u))&&e(r,n?n.concat(s):[s])}),d.pop()}}(e),t};function $(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function ee(e,t){this._pairs=[],e&&Z(e,this,t)}const te=ee.prototype;te.append=function(e,t){this._pairs.push([e,t])},te.toString=function(e){const t=e?function(t){return e.call(this,t,$)}:$;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const re=ee;function ne(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ae(e,t,r){if(!t)return e;const n=r&&r.encode||ne;q.isFunction(r)&&(r={serialize:r});const a=r&&r.serialize;let s;if(s=a?a(t,r):q.isURLSearchParams(t)?t.toString():new re(t,r).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}const se=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){q.forEach(this.handlers,function(t){null!==t&&e(t)})}},oe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var ie=r(9379);const le={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:re,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ce="undefined"!==typeof window&&"undefined"!==typeof document,de="object"===typeof navigator&&navigator||void 0,ue=ce&&(!de||["ReactNative","NativeScript","NS"].indexOf(de.product)<0),he="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,me=ce&&window.location.href||"http://localhost",pe=(0,ie.A)((0,ie.A)({},n),le);const fe=function(e){function t(e,r,n,a){let s=e[a++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),i=a>=e.length;if(s=!s&&q.isArray(n)?n.length:s,i)return q.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o;n[s]&&q.isObject(n[s])||(n[s]=[]);return t(e,r,n[s],a)&&q.isArray(n[s])&&(n[s]=function(e){const t={},r=Object.keys(e);let n;const a=r.length;let s;for(n=0;n<a;n++)s=r[n],t[s]=e[s];return t}(n[s])),!o}if(q.isFormData(e)&&q.isFunction(e.entries)){const r={};return q.forEachEntry(e,(e,n)=>{t(function(e){return q.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,r,0)}),r}return null};const ge={transitional:oe,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,a=q.isObject(e);a&&q.isHTMLForm(e)&&(e=new FormData(e));if(q.isFormData(e))return n?JSON.stringify(fe(e)):e;if(q.isArrayBuffer(e)||q.isBuffer(e)||q.isStream(e)||q.isFile(e)||q.isBlob(e)||q.isReadableStream(e))return e;if(q.isArrayBufferView(e))return e.buffer;if(q.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Z(e,new pe.classes.URLSearchParams,(0,ie.A)({visitor:function(e,t,r,n){return pe.isNode&&q.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=q.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Z(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return a||n?(t.setContentType("application/json",!1),function(e,t,r){if(q.isString(e))try{return(t||JSON.parse)(e),q.trim(e)}catch(_t){if("SyntaxError"!==_t.name)throw _t}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ge.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(q.isResponse(e)||q.isReadableStream(e))return e;if(e&&q.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(_t){if(r){if("SyntaxError"===_t.name)throw K.from(_t,K.ERR_BAD_RESPONSE,this,null,this.response);throw _t}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:pe.classes.FormData,Blob:pe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};q.forEach(["delete","get","head","post","put","patch"],e=>{ge.headers[e]={}});const ve=ge,xe=q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),be=Symbol("internals");function ye(e){return e&&String(e).trim().toLowerCase()}function we(e){return!1===e||null==e?e:q.isArray(e)?e.map(we):String(e)}function je(e,t,r,n,a){return q.isFunction(n)?n.call(this,t,r):(a&&(t=r),q.isString(t)?q.isString(n)?-1!==t.indexOf(n):q.isRegExp(n)?n.test(t):void 0:void 0)}class Ne{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function a(e,t,r){const a=ye(t);if(!a)throw new Error("header name must be a non-empty string");const s=q.findKey(n,a);(!s||void 0===n[s]||!0===r||void 0===r&&!1!==n[s])&&(n[s||t]=we(e))}const s=(e,t)=>q.forEach(e,(e,r)=>a(e,r,t));if(q.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(q.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let r,n,a;return e&&e.split("\n").forEach(function(e){a=e.indexOf(":"),r=e.substring(0,a).trim().toLowerCase(),n=e.substring(a+1).trim(),!r||t[r]&&xe[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t})(e),t);else if(q.isObject(e)&&q.isIterable(e)){let r,n,a={};for(const t of e){if(!q.isArray(t))throw TypeError("Object iterator must return a key-value pair");a[n=t[0]]=(r=a[n])?q.isArray(r)?[...r,t[1]]:[r,t[1]]:t[1]}s(a,t)}else null!=e&&a(t,e,r);return this}get(e,t){if(e=ye(e)){const r=q.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(q.isFunction(t))return t.call(this,e,r);if(q.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ye(e)){const r=q.findKey(this,e);return!(!r||void 0===this[r]||t&&!je(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function a(e){if(e=ye(e)){const a=q.findKey(r,e);!a||t&&!je(0,r[a],a,t)||(delete r[a],n=!0)}}return q.isArray(e)?e.forEach(a):a(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const a=t[r];e&&!je(0,this[a],a,e,!0)||(delete this[a],n=!0)}return n}normalize(e){const t=this,r={};return q.forEach(this,(n,a)=>{const s=q.findKey(r,a);if(s)return t[s]=we(n),void delete t[a];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}(a):String(a).trim();o!==a&&delete t[a],t[o]=we(n),r[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return q.forEach(this,(r,n)=>{null!=r&&!1!==r&&(t[n]=e&&q.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,r]=e;return t+": "+r}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return n.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[be]=this[be]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=ye(e);t[n]||(!function(e,t){const r=q.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(e,r,a){return this[n].call(this,t,e,r,a)},configurable:!0})})}(r,e),t[n]=!0)}return q.isArray(e)?e.forEach(n):n(e),this}}Ne.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),q.reduceDescriptors(Ne.prototype,(e,t)=>{let{value:r}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(e){this[n]=e}}}),q.freezeMethods(Ne);const Se=Ne;function ke(e,t){const r=this||ve,n=t||r,a=Se.from(n.headers);let s=n.data;return q.forEach(e,function(e){s=e.call(r,s,a.normalize(),t?t.status:void 0)}),a.normalize(),s}function Ae(e){return!(!e||!e.__CANCEL__)}function Ce(e,t,r){K.call(this,null==e?"canceled":e,K.ERR_CANCELED,t,r),this.name="CanceledError"}q.inherits(Ce,K,{__CANCEL__:!0});const Ee=Ce;function Pe(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new K("Request failed with status code "+r.status,[K.ERR_BAD_REQUEST,K.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}const _e=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let a,s=0,o=0;return t=void 0!==t?t:1e3,function(i){const l=Date.now(),c=n[o];a||(a=l),r[s]=i,n[s]=l;let d=o,u=0;for(;d!==s;)u+=r[d++],d%=e;if(s=(s+1)%e,s===o&&(o=(o+1)%e),l-a<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}};const Ie=function(e,t){let r,n,a=0,s=1e3/t;const o=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();a=s,r=null,n&&(clearTimeout(n),n=null),e(...t)};return[function(){const e=Date.now(),t=e-a;for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];t>=s?o(l,e):(r=l,n||(n=setTimeout(()=>{n=null,o(r)},s-t)))},()=>r&&o(r)]},Te=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0;const a=_e(50,250);return Ie(r=>{const s=r.loaded,o=r.lengthComputable?r.total:void 0,i=s-n,l=a(i);n=s;e({loaded:s,total:o,progress:o?s/o:void 0,bytes:i,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:r,lengthComputable:null!=o,[t?"download":"upload"]:!0})},r)},Le=(e,t)=>{const r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},De=e=>function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return q.asap(()=>e(...r))},Me=pe.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,pe.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(pe.origin),pe.navigator&&/(msie|trident)/i.test(pe.navigator.userAgent)):()=>!0,Oe=pe.hasStandardBrowserEnv?{write(e,t,r,n,a,s){const o=[e+"="+encodeURIComponent(t)];q.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),q.isString(n)&&o.push("path="+n),q.isString(a)&&o.push("domain="+a),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Re(e,t,r){let n=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(n||0==r)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Fe=e=>e instanceof Se?(0,ie.A)({},e):e;function Ue(e,t){t=t||{};const r={};function n(e,t,r,n){return q.isPlainObject(e)&&q.isPlainObject(t)?q.merge.call({caseless:n},e,t):q.isPlainObject(t)?q.merge({},t):q.isArray(t)?t.slice():t}function a(e,t,r,a){return q.isUndefined(t)?q.isUndefined(e)?void 0:n(void 0,e,0,a):n(e,t,0,a)}function s(e,t){if(!q.isUndefined(t))return n(void 0,t)}function o(e,t){return q.isUndefined(t)?q.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function i(r,a,s){return s in t?n(r,a):s in e?n(void 0,r):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:i,headers:(e,t,r)=>a(Fe(e),Fe(t),0,!0)};return q.forEach(Object.keys((0,ie.A)((0,ie.A)({},e),t)),function(n){const s=l[n]||a,o=s(e[n],t[n],n);q.isUndefined(o)&&s!==i||(r[n]=o)}),r}const Be=e=>{const t=Ue({},e);let r,{data:n,withXSRFToken:a,xsrfHeaderName:s,xsrfCookieName:o,headers:i,auth:l}=t;if(t.headers=i=Se.from(i),t.url=ae(Re(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&i.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),q.isFormData(n))if(pe.hasStandardBrowserEnv||pe.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(!1!==(r=i.getContentType())){const[e,...t]=r?r.split(";").map(e=>e.trim()).filter(Boolean):[];i.setContentType([e||"multipart/form-data",...t].join("; "))}if(pe.hasStandardBrowserEnv&&(a&&q.isFunction(a)&&(a=a(t)),a||!1!==a&&Me(t.url))){const e=s&&o&&Oe.read(o);e&&i.set(s,e)}return t},ze="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,r){const n=Be(e);let a=n.data;const s=Se.from(n.headers).normalize();let o,i,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:m}=n;function p(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let f=new XMLHttpRequest;function g(){if(!f)return;const n=Se.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());Pe(function(e){t(e),p()},function(e){r(e),p()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(r(new K("Request aborted",K.ECONNABORTED,e,f)),f=null)},f.onerror=function(){r(new K("Network Error",K.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const a=n.transitional||oe;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),r(new K(t,a.clarifyTimeoutError?K.ETIMEDOUT:K.ECONNABORTED,e,f)),f=null},void 0===a&&s.setContentType(null),"setRequestHeader"in f&&q.forEach(s.toJSON(),function(e,t){f.setRequestHeader(t,e)}),q.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),m&&([l,d]=Te(m,!0),f.addEventListener("progress",l)),h&&f.upload&&([i,c]=Te(h),f.upload.addEventListener("progress",i),f.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{f&&(r(!t||t.type?new Ee(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);v&&-1===pe.protocols.indexOf(v)?r(new K("Unsupported protocol "+v+":",K.ERR_BAD_REQUEST,e)):f.send(a||null)})},We=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController;const a=function(e){if(!r){r=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof K?t:new Ee(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,a(new K("timeout ".concat(t," of ms exceeded"),K.ETIMEDOUT))},t);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(a):e.removeEventListener("abort",a)}),e=null)};e.forEach(e=>e.addEventListener("abort",a));const{signal:i}=n;return i.unsubscribe=()=>q.asap(o),i}};function qe(e,t){this.v=e,this.k=t}function Ve(e){return function(){return new He(e.apply(this,arguments))}}function He(e){var t,r;function n(t,r){try{var s=e[t](r),o=s.value,i=o instanceof qe;Promise.resolve(i?o.v:o).then(function(r){if(i){var l="return"===t?"return":"next";if(!o.k||r.done)return n(l,r);r=e[l](r).value}a(s.done?"return":"normal",r)},function(e){n("throw",e)})}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,a){return new Promise(function(s,o){var i={key:e,arg:a,resolve:s,reject:o,next:null};r?r=r.next=i:(t=r=i,n(e,a))})},"function"!=typeof e.return&&(this.return=void 0)}function Ge(e){return new qe(e,0)}function Ke(e){var t={},r=!1;function n(t,n){return r=!0,n=new Promise(function(r){r(e[t](n))}),{done:!1,value:new qe(n,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):n("return",e)}),t}function Je(e){var t,r,n,a=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);a--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new Ye(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Ye(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Ye=function(e){this.s=e,this.n=e.next},Ye.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new Ye(e)}He.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},He.prototype.next=function(e){return this._invoke("next",e)},He.prototype.throw=function(e){return this._invoke("throw",e)},He.prototype.return=function(e){return this._invoke("return",e)};const Xe=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let n,a=0;for(;a<r;)n=a+t,yield e.slice(a,n),a=n},Qe=function(){var e=Ve(function*(e,t){var r,n=!1,a=!1;try{for(var s,o=Je(Ze(e));n=!(s=yield Ge(o.next())).done;n=!1){const e=s.value;yield*Ke(Je(Xe(e,t)))}}catch(i){a=!0,r=i}finally{try{n&&null!=o.return&&(yield Ge(o.return()))}finally{if(a)throw r}}});return function(t,r){return e.apply(this,arguments)}}(),Ze=function(){var e=Ve(function*(e){if(e[Symbol.asyncIterator])return void(yield*Ke(Je(e)));const t=e.getReader();try{for(;;){const{done:e,value:r}=yield Ge(t.read());if(e)break;yield r}}finally{yield Ge(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),$e=(e,t,r,n)=>{const a=Qe(e,t);let s,o=0,i=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await a.next();if(t)return i(),void e.close();let s=n.byteLength;if(r){let e=o+=s;r(e)}e.enqueue(new Uint8Array(n))}catch(t){throw i(t),t}},cancel:e=>(i(e),a.return())},{highWaterMark:2})},et="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,tt=et&&"function"===typeof ReadableStream,rt=et&&("function"===typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),nt=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return!!e(...r)}catch(_t){return!1}},at=tt&&nt(()=>{let e=!1;const t=new Request(pe.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),st=tt&&nt(()=>q.isReadableStream(new Response("").body)),ot={stream:st&&(e=>e.body)};var it;et&&(it=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ot[e]&&(ot[e]=q.isFunction(it[e])?t=>t[e]():(t,r)=>{throw new K("Response type '".concat(e,"' is not supported"),K.ERR_NOT_SUPPORT,r)})}));const lt=async(e,t)=>{const r=q.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(q.isBlob(e))return e.size;if(q.isSpecCompliantForm(e)){const t=new Request(pe.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return q.isArrayBufferView(e)||q.isArrayBuffer(e)?e.byteLength:(q.isURLSearchParams(e)&&(e+=""),q.isString(e)?(await rt(e)).byteLength:void 0)})(t):r},ct=et&&(async e=>{let{url:t,method:r,data:n,signal:a,cancelToken:s,timeout:o,onDownloadProgress:i,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=Be(e);c=c?(c+"").toLowerCase():"text";let m,p=We([a,s&&s.toAbortSignal()],o);const f=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let g;try{if(l&&at&&"get"!==r&&"head"!==r&&0!==(g=await lt(d,n))){let e,r=new Request(t,{method:"POST",body:n,duplex:"half"});if(q.isFormData(n)&&(e=r.headers.get("content-type"))&&d.setContentType(e),r.body){const[e,t]=Le(g,Te(De(l)));n=$e(r.body,65536,e,t)}}q.isString(u)||(u=u?"include":"omit");const a="credentials"in Request.prototype;m=new Request(t,(0,ie.A)((0,ie.A)({},h),{},{signal:p,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:a?u:void 0}));let s=await fetch(m,h);const o=st&&("stream"===c||"response"===c);if(st&&(i||o&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=q.toFiniteNumber(s.headers.get("content-length")),[r,n]=i&&Le(t,Te(De(i),!0))||[];s=new Response($e(s.body,65536,r,()=>{n&&n(),f&&f()}),e)}c=c||"text";let v=await ot[q.findKey(ot,c)||"text"](s,e);return!o&&f&&f(),await new Promise((t,r)=>{Pe(t,r,{data:v,headers:Se.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:m})})}catch(v){if(f&&f(),v&&"TypeError"===v.name&&/Load failed|fetch/i.test(v.message))throw Object.assign(new K("Network Error",K.ERR_NETWORK,e,m),{cause:v.cause||v});throw K.from(v,v&&v.code,e,m)}}),dt={http:null,xhr:ze,fetch:ct};q.forEach(dt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(_t){}Object.defineProperty(e,"adapterName",{value:t})}});const ut=e=>"- ".concat(e),ht=e=>q.isFunction(e)||null===e||!1===e,mt=e=>{e=q.isArray(e)?e:[e];const{length:t}=e;let r,n;const a={};for(let s=0;s<t;s++){let t;if(r=e[s],n=r,!ht(r)&&(n=dt[(t=String(r)).toLowerCase()],void 0===n))throw new K("Unknown adapter '".concat(t,"'"));if(n)break;a[t||"#"+s]=n}if(!n){const e=Object.entries(a).map(e=>{let[t,r]=e;return"adapter ".concat(t," ")+(!1===r?"is not supported by the environment":"is not available in the build")});let r=t?e.length>1?"since :\n"+e.map(ut).join("\n"):" "+ut(e[0]):"as no adapter specified";throw new K("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return n};function pt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ee(null,e)}function ft(e){pt(e),e.headers=Se.from(e.headers),e.data=ke.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return mt(e.adapter||ve.adapter)(e).then(function(t){return pt(e),t.data=ke.call(e,e.transformResponse,t),t.headers=Se.from(t.headers),t},function(t){return Ae(t)||(pt(e),t&&t.response&&(t.response.data=ke.call(e,e.transformResponse,t.response),t.response.headers=Se.from(t.response.headers))),Promise.reject(t)})}const gt="1.11.0",vt={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{vt[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const xt={};vt.transitional=function(e,t,r){function n(e,t){return"[Axios v"+gt+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,a,s)=>{if(!1===e)throw new K(n(a," has been removed"+(t?" in "+t:"")),K.ERR_DEPRECATED);return t&&!xt[a]&&(xt[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,a,s)}},vt.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};const bt={assertOptions:function(e,t,r){if("object"!==typeof e)throw new K("options must be an object",K.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let a=n.length;for(;a-- >0;){const s=n[a],o=t[s];if(o){const t=e[s],r=void 0===t||o(t,s,e);if(!0!==r)throw new K("option "+s+" must be "+r,K.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new K("Unknown option "+s,K.ERR_BAD_OPTION)}},validators:vt},yt=bt.validators;class wt{constructor(e){this.defaults=e||{},this.interceptors={request:new se,response:new se}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{r.stack?t&&!String(r.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+t):r.stack=t}catch(_t){}}throw r}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=Ue(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:a}=t;void 0!==r&&bt.assertOptions(r,{silentJSONParsing:yt.transitional(yt.boolean),forcedJSONParsing:yt.transitional(yt.boolean),clarifyTimeoutError:yt.transitional(yt.boolean)},!1),null!=n&&(q.isFunction(n)?t.paramsSerializer={serialize:n}:bt.assertOptions(n,{encode:yt.function,serialize:yt.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),bt.assertOptions(t,{baseUrl:yt.spelling("baseURL"),withXsrfToken:yt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=a&&q.merge(a.common,a[t.method]);a&&q.forEach(["delete","get","head","post","put","patch","common"],e=>{delete a[e]}),t.headers=Se.concat(s,a);const o=[];let i=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!i){const e=[ft.bind(this),void 0];for(e.unshift(...o),e.push(...l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(m){t.call(this,m);break}}try{c=ft.call(this,h)}catch(m){return Promise.reject(m)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return ae(Re((e=Ue(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}q.forEach(["delete","get","head","options"],function(e){wt.prototype[e]=function(t,r){return this.request(Ue(r||{},{method:e,url:t,data:(r||{}).data}))}}),q.forEach(["post","put","patch"],function(e){function t(t){return function(r,n,a){return this.request(Ue(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}wt.prototype[e]=t(),wt.prototype[e+"Form"]=t(!0)});const jt=wt;class Nt{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,n,a){r.reason||(r.reason=new Ee(e,n,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;const t=new Nt(function(t){e=t});return{token:t,cancel:e}}}const St=Nt;const kt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kt).forEach(e=>{let[t,r]=e;kt[r]=t});const At=kt;const Ct=function e(t){const r=new jt(t),n=a(jt.prototype.request,r);return q.extend(n,jt.prototype,r,{allOwnKeys:!0}),q.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e(Ue(t,r))},n}(ve);Ct.Axios=jt,Ct.CanceledError=Ee,Ct.CancelToken=St,Ct.isCancel=Ae,Ct.VERSION=gt,Ct.toFormData=Z,Ct.AxiosError=K,Ct.Cancel=Ct.CanceledError,Ct.all=function(e){return Promise.all(e)},Ct.spread=function(e){return function(t){return e.apply(null,t)}},Ct.isAxiosError=function(e){return q.isObject(e)&&!0===e.isAxiosError},Ct.mergeConfig=Ue,Ct.AxiosHeaders=Se,Ct.formToJSON=e=>fe(q.isHTMLForm(e)?new FormData(e):e),Ct.getAdapter=mt,Ct.HttpStatusCode=At,Ct.default=Ct;const Et=Ct}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}r.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(n,a){if(1&a&&(n=this(n)),8&a)return n;if("object"===typeof n&&n){if(4&a&&n.__esModule)return n;if(16&a&&"function"===typeof n.then)return n}var s=Object.create(null);r.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var i=2&a&&n;("object"==typeof i||"function"==typeof i)&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach(e=>o[e]=()=>n[e]);return o.default=()=>n,r.d(s,o),s}})(),r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,n)=>(r.f[n](e,t),t),[])),r.u=e=>"static/js/"+e+"."+{239:"382b0bcd",455:"df19cd58",841:"4aa10d61",977:"4ca11c06"}[e]+".chunk.js",r.miniCssF=e=>{},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(_t){if("object"===typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="react-dashboard:";r.l=(n,a,s,o)=>{if(e[n])e[n].push(a);else{var i,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+s){i=u;break}}i||(l=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.setAttribute("data-webpack",t+s),i.src=n),e[n]=[a];var h=(t,r)=>{i.onerror=i.onload=null,clearTimeout(m);var a=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),a&&a.forEach(e=>e(r)),t)return t(r)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),l&&document.head.appendChild(i)}}})(),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/",(()=>{var e={792:0};r.f.j=(t,n)=>{var a=r.o(e,t)?e[t]:void 0;if(0!==a)if(a)n.push(a[2]);else{var s=new Promise((r,n)=>a=e[t]=[r,n]);n.push(a[2]=s);var o=r.p+r.u(t),i=new Error;r.l(o,n=>{if(r.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var s=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",i.name="ChunkLoadError",i.type=s,i.request=o,a[1](i)}},"chunk-"+t,t)}};var t=(t,n)=>{var a,s,o=n[0],i=n[1],l=n[2],c=0;if(o.some(t=>0!==e[t])){for(a in i)r.o(i,a)&&(r.m[a]=i[a]);if(l)l(r)}for(t&&t(n);c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunkreact_dashboard=self.webpackChunkreact_dashboard||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n={};r.r(n),r.d(n,{Decoder:()=>zo,Encoder:()=>Uo,PacketType:()=>Fo,protocol:()=>Ro});var a={};r.r(a),r.d(a,{FILE:()=>Px,HTML:()=>Tx,TEXT:()=>Ix,URL:()=>_x});var s,o=r(5043),i=r.t(o,2),l=r(4391),c=r(7950),d=r.t(c,2);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(s||(s={}));const h="popstate";function m(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function p(e,t){return{usr:e.state,key:e.key,idx:t}}function f(e,t,r,n){return void 0===r&&(r=null),u({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?v(t):t,{state:r,key:t&&t.key||n||Math.random().toString(36).substr(2,8)})}function g(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&"?"!==r&&(t+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function v(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function x(e,t,r,n){void 0===n&&(n={});let{window:a=document.defaultView,v5Compat:o=!1}=n,i=a.history,l=s.Pop,c=null,d=v();function v(){return(i.state||{idx:null}).idx}function x(){l=s.Pop;let e=v(),t=null==e?null:e-d;d=e,c&&c({action:l,location:y.location,delta:t})}function b(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,r="string"===typeof e?e:g(e);return r=r.replace(/ $/,"%20"),m(t,"No window.location.(origin|href) available to create URL for href: "+r),new URL(r,t)}null==d&&(d=0,i.replaceState(u({},i.state,{idx:d}),""));let y={get action(){return l},get location(){return e(a,i)},listen(e){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(h,x),c=e,()=>{a.removeEventListener(h,x),c=null}},createHref:e=>t(a,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l=s.Push;let n=f(y.location,e,t);r&&r(n,e),d=v()+1;let u=p(n,d),h=y.createHref(n);try{i.pushState(u,"",h)}catch(m){if(m instanceof DOMException&&"DataCloneError"===m.name)throw m;a.location.assign(h)}o&&c&&c({action:l,location:y.location,delta:1})},replace:function(e,t){l=s.Replace;let n=f(y.location,e,t);r&&r(n,e),d=v();let a=p(n,d),u=y.createHref(n);i.replaceState(a,"",u),o&&c&&c({action:l,location:y.location,delta:0})},go:e=>i.go(e)};return y}var b;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(b||(b={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function y(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&"/"!==n?null:e.slice(r)||"/"}function w(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+r+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function j(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function N(e,t){let r=j(e);return t?r.map((e,t)=>t===r.length-1?e.pathname:e.pathnameBase):r.map(e=>e.pathnameBase)}function S(e,t,r,n){let a;void 0===n&&(n=!1),"string"===typeof e?a=v(e):(a=u({},e),m(!a.pathname||!a.pathname.includes("?"),w("?","pathname","search",a)),m(!a.pathname||!a.pathname.includes("#"),w("#","pathname","hash",a)),m(!a.search||!a.search.includes("#"),w("#","search","hash",a)));let s,o=""===e||""===a.pathname,i=o?"/":a.pathname;if(null==i)s=r;else{let e=t.length-1;if(!n&&i.startsWith("..")){let t=i.split("/");for(;".."===t[0];)t.shift(),e-=1;a.pathname=t.join("/")}s=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:r,search:n="",hash:a=""}="string"===typeof e?v(e):e,s=r?r.startsWith("/")?r:function(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)}),r.length>1?r.join("/"):"/"}(r,t):t;return{pathname:s,search:A(n),hash:C(a)}}(a,s),c=i&&"/"!==i&&i.endsWith("/"),d=(o||"."===i)&&r.endsWith("/");return l.pathname.endsWith("/")||!c&&!d||(l.pathname+="/"),l}const k=e=>e.join("/").replace(/\/\/+/g,"/"),A=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",C=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;const E=["post","put","patch","delete"],P=(new Set(E),["get",...E]);new Set(P),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_.apply(this,arguments)}const I=o.createContext(null);const T=o.createContext(null);const L=o.createContext(null);const D=o.createContext({outlet:null,matches:[],isDataRoute:!1});function M(){return null!=o.useContext(L)}function O(){return M()||m(!1),o.useContext(L).location}function R(e){o.useContext(T).static||o.useLayoutEffect(e)}function F(){let{isDataRoute:e}=o.useContext(D);return e?function(){let{router:e}=z(U.UseNavigateStable),t=W(B.UseNavigateStable),r=o.useRef(!1);R(()=>{r.current=!0});let n=o.useCallback(function(n,a){void 0===a&&(a={}),r.current&&("number"===typeof n?e.navigate(n):e.navigate(n,_({fromRouteId:t},a)))},[e,t]);return n}():function(){M()||m(!1);let e=o.useContext(I),{basename:t,future:r,navigator:n}=o.useContext(T),{matches:a}=o.useContext(D),{pathname:s}=O(),i=JSON.stringify(N(a,r.v7_relativeSplatPath)),l=o.useRef(!1);return R(()=>{l.current=!0}),o.useCallback(function(r,a){if(void 0===a&&(a={}),!l.current)return;if("number"===typeof r)return void n.go(r);let o=S(r,JSON.parse(i),s,"path"===a.relative);null==e&&"/"!==t&&(o.pathname="/"===o.pathname?t:k([t,o.pathname])),(a.replace?n.replace:n.push)(o,a.state,a)},[t,n,i,s,e])}()}o.Component;var U=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(U||{}),B=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(B||{});function z(e){let t=o.useContext(I);return t||m(!1),t}function W(e){let t=function(){let e=o.useContext(D);return e||m(!1),e}(),r=t.matches[t.matches.length-1];return r.route.id||m(!1),r.route.id}function q(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}i.startTransition;function V(e){let{basename:t="/",children:r=null,location:n,navigationType:a=s.Pop,navigator:i,static:l=!1,future:c}=e;M()&&m(!1);let d=t.replace(/^\/*/,"/"),u=o.useMemo(()=>({basename:d,navigator:i,static:l,future:_({v7_relativeSplatPath:!1},c)}),[d,c,i,l]);"string"===typeof n&&(n=v(n));let{pathname:h="/",search:p="",hash:f="",state:g=null,key:x="default"}=n,b=o.useMemo(()=>{let e=y(h,d);return null==e?null:{location:{pathname:e,search:p,hash:f,state:g,key:x},navigationType:a}},[d,h,p,f,g,x,a]);return null==b?null:o.createElement(T.Provider,{value:u},o.createElement(L.Provider,{children:r,value:b}))}new Promise(()=>{});o.Component;new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(_t){}new Map;const H=i.startTransition;d.flushSync,i.useId;function G(e){let{basename:t,children:r,future:n,window:a}=e,s=o.useRef();var i;null==s.current&&(s.current=(void 0===(i={window:a,v5Compat:!0})&&(i={}),x(function(e,t){let{pathname:r,search:n,hash:a}=e.location;return f("",{pathname:r,search:n,hash:a},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:g(t)},null,i)));let l=s.current,[c,d]=o.useState({action:l.action,location:l.location}),{v7_startTransition:u}=n||{},h=o.useCallback(e=>{u&&H?H(()=>d(e)):d(e)},[d,u]);return o.useLayoutEffect(()=>l.listen(h),[l,h]),o.useEffect(()=>q(n),[n]),o.createElement(V,{basename:t,children:r,location:c.location,navigationType:c.action,navigator:l,future:n})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var K,J;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(K||(K={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(J||(J={}));var Y=r(9379);function X(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Q(e,t,r){X(e,t),t.set(e,r)}function Z(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}function $(e,t){return e.get(Z(e,t))}function ee(e,t,r){return e.set(Z(e,t),r),r}var te="undefined"===typeof window||"Deno"in globalThis;function re(){}function ne(e){return"number"===typeof e&&e>=0&&e!==1/0}function ae(e,t){return Math.max(e+(t||0)-Date.now(),0)}function se(e,t){return"function"===typeof e?e(t):e}function oe(e,t){return"function"===typeof e?e(t):e}function ie(e,t){const{type:r="all",exact:n,fetchStatus:a,predicate:s,queryKey:o,stale:i}=e;if(o)if(n){if(t.queryHash!==ce(o,t.options))return!1}else if(!ue(t.queryKey,o))return!1;if("all"!==r){const e=t.isActive();if("active"===r&&!e)return!1;if("inactive"===r&&e)return!1}return("boolean"!==typeof i||t.isStale()===i)&&((!a||a===t.state.fetchStatus)&&!(s&&!s(t)))}function le(e,t){const{exact:r,status:n,predicate:a,mutationKey:s}=e;if(s){if(!t.options.mutationKey)return!1;if(r){if(de(t.options.mutationKey)!==de(s))return!1}else if(!ue(t.options.mutationKey,s))return!1}return(!n||t.state.status===n)&&!(a&&!a(t))}function ce(e,t){return((null===t||void 0===t?void 0:t.queryKeyHashFn)||de)(e)}function de(e){return JSON.stringify(e,(e,t)=>fe(t)?Object.keys(t).sort().reduce((e,r)=>(e[r]=t[r],e),{}):t)}function ue(e,t){return e===t||typeof e===typeof t&&(!(!e||!t||"object"!==typeof e||"object"!==typeof t)&&Object.keys(t).every(r=>ue(e[r],t[r])))}function he(e,t){if(e===t)return e;const r=pe(e)&&pe(t);if(r||fe(e)&&fe(t)){const n=r?e:Object.keys(e),a=n.length,s=r?t:Object.keys(t),o=s.length,i=r?[]:{},l=new Set(n);let c=0;for(let d=0;d<o;d++){const n=r?d:s[d];(!r&&l.has(n)||r)&&void 0===e[n]&&void 0===t[n]?(i[n]=void 0,c++):(i[n]=he(e[n],t[n]),i[n]===e[n]&&void 0!==e[n]&&c++)}return a===o&&c===a?e:i}return t}function me(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function pe(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function fe(e){if(!ge(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!!ge(r)&&(!!r.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function ge(e){return"[object Object]"===Object.prototype.toString.call(e)}function ve(e,t,r){return"function"===typeof r.structuralSharing?r.structuralSharing(e,t):!1!==r.structuralSharing?he(e,t):t}function xe(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=[...e,t];return r&&n.length>r?n.slice(1):n}function be(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var ye=Symbol();function we(e,t){return!e.queryFn&&null!==t&&void 0!==t&&t.initialPromise?()=>t.initialPromise:e.queryFn&&e.queryFn!==ye?e.queryFn:()=>Promise.reject(new Error("Missing queryFn: '".concat(e.queryHash,"'")))}function je(e,t){return"function"===typeof e?e(...t):!!e}function Ne(e,t){X(e,t),t.add(e)}var Se=e=>setTimeout(e,0);var ke,Ae,Ce,Ee,Pe,_e,Ie=function(){let e=[],t=0,r=e=>{e()},n=e=>{e()},a=Se;const s=n=>{t?e.push(n):a(()=>{r(n)})};return{batch:s=>{let o;t++;try{o=s()}finally{t--,t||(()=>{const t=e;e=[],t.length&&a(()=>{n(()=>{t.forEach(e=>{r(e)})})})})()}return o},batchCalls:e=>function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];s(()=>{e(...r)})},schedule:s,setNotifyFunction:e=>{r=e},setBatchNotifyFunction:e=>{n=e},setScheduler:e=>{a=e}}}(),Te=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Le=new(ke=new WeakMap,Ae=new WeakMap,Ce=new WeakMap,class extends Te{constructor(){super(),Q(this,ke,void 0),Q(this,Ae,void 0),Q(this,Ce,void 0),ee(Ce,this,e=>{if(!te&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){$(Ae,this)||this.setEventListener($(Ce,this))}onUnsubscribe(){var e;this.hasListeners()||(null===(e=$(Ae,this))||void 0===e||e.call(this),ee(Ae,this,void 0))}setEventListener(e){var t;ee(Ce,this,e),null===(t=$(Ae,this))||void 0===t||t.call(this),ee(Ae,this,e(e=>{"boolean"===typeof e?this.setFocused(e):this.onFocus()}))}setFocused(e){$(ke,this)!==e&&(ee(ke,this,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return"boolean"===typeof $(ke,this)?$(ke,this):"hidden"!==(null===(e=globalThis.document)||void 0===e?void 0:e.visibilityState)}}),De=new(Ee=new WeakMap,Pe=new WeakMap,_e=new WeakMap,class extends Te{constructor(){super(),Q(this,Ee,!0),Q(this,Pe,void 0),Q(this,_e,void 0),ee(_e,this,e=>{if(!te&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){$(Pe,this)||this.setEventListener($(_e,this))}onUnsubscribe(){var e;this.hasListeners()||(null===(e=$(Pe,this))||void 0===e||e.call(this),ee(Pe,this,void 0))}setEventListener(e){var t;ee(_e,this,e),null===(t=$(Pe,this))||void 0===t||t.call(this),ee(Pe,this,e(this.setOnline.bind(this)))}setOnline(e){$(Ee,this)!==e&&(ee(Ee,this,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return $(Ee,this)}});function Me(){let e,t;const r=new Promise((r,n)=>{e=r,t=n});function n(e){Object.assign(r,e),delete r.resolve,delete r.reject}return r.status="pending",r.catch(()=>{}),r.resolve=t=>{n({status:"fulfilled",value:t}),e(t)},r.reject=e=>{n({status:"rejected",reason:e}),t(e)},r}function Oe(e){return Math.min(1e3*2**e,3e4)}function Re(e){return"online"!==(null!==e&&void 0!==e?e:"online")||De.isOnline()}var Fe,Ue=class extends Error{constructor(e){super("CancelledError"),this.revert=null===e||void 0===e?void 0:e.revert,this.silent=null===e||void 0===e?void 0:e.silent}};function Be(e){return e instanceof Ue}function ze(e){let t,r=!1,n=0,a=!1;const s=Me(),o=()=>Le.isFocused()&&("always"===e.networkMode||De.isOnline())&&e.canRun(),i=()=>Re(e.networkMode)&&e.canRun(),l=r=>{var n,o;a||(a=!0,null===(n=e.onSuccess)||void 0===n||n.call(e,r),null===(o=t)||void 0===o||o(),s.resolve(r))},c=r=>{var n,o;a||(a=!0,null===(n=e.onError)||void 0===n||n.call(e,r),null===(o=t)||void 0===o||o(),s.reject(r))},d=()=>new Promise(r=>{var n;t=e=>{(a||o())&&r(e)},null===(n=e.onPause)||void 0===n||n.call(e)}).then(()=>{var r;(t=void 0,a)||(null===(r=e.onContinue)||void 0===r||r.call(e))}),u=()=>{if(a)return;let t;const s=0===n?e.initialPromise:void 0;try{t=null!==s&&void 0!==s?s:e.fn()}catch(i){t=Promise.reject(i)}Promise.resolve(t).then(l).catch(t=>{var s,i,l;if(a)return;const h=null!==(s=e.retry)&&void 0!==s?s:te?0:3,m=null!==(i=e.retryDelay)&&void 0!==i?i:Oe,p="function"===typeof m?m(n,t):m,f=!0===h||"number"===typeof h&&n<h||"function"===typeof h&&h(n,t);var g;!r&&f?(n++,null===(l=e.onFail)||void 0===l||l.call(e,n,t),(g=p,new Promise(e=>{setTimeout(e,g)})).then(()=>o()?void 0:d()).then(()=>{r?c(t):u()})):c(t)})};return{promise:s,cancel:t=>{var r;a||(c(new Ue(t)),null===(r=e.abort)||void 0===r||r.call(e))},continue:()=>{var e;return null===(e=t)||void 0===e||e(),s},cancelRetry:()=>{r=!0},continueRetry:()=>{r=!1},canStart:i,start:()=>(i()?u():d().then(u),s)}}var We,qe,Ve,He,Ge,Ke,Je,Ye,Xe,Qe=(Fe=new WeakMap,class{constructor(){Q(this,Fe,void 0)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ne(this.gcTime)&&ee(Fe,this,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,null!==e&&void 0!==e?e:te?1/0:3e5)}clearGcTimeout(){$(Fe,this)&&(clearTimeout($(Fe,this)),ee(Fe,this,void 0))}}),Ze=(We=new WeakMap,qe=new WeakMap,Ve=new WeakMap,He=new WeakMap,Ge=new WeakMap,Ke=new WeakMap,Je=new WeakMap,Ye=new WeakSet,class extends Qe{constructor(e){var t;super(),Ne(this,Ye),Q(this,We,void 0),Q(this,qe,void 0),Q(this,Ve,void 0),Q(this,He,void 0),Q(this,Ge,void 0),Q(this,Ke,void 0),Q(this,Je,void 0),ee(Je,this,!1),ee(Ke,this,e.defaultOptions),this.setOptions(e.options),this.observers=[],ee(He,this,e.client),ee(Ve,this,$(He,this).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,ee(We,this,function(e){const t="function"===typeof e.initialData?e.initialData():e.initialData,r=void 0!==t,n=r?"function"===typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?null!==n&&void 0!==n?n:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}(this.options)),this.state=null!==(t=e.state)&&void 0!==t?t:$(We,this),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return null===(e=$(Ge,this))||void 0===e?void 0:e.promise}setOptions(e){this.options=(0,Y.A)((0,Y.A)({},$(Ke,this)),e),this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||$(Ve,this).remove(this)}setData(e,t){const r=ve(this.state.data,e,this.options);return Z(Ye,this,$e).call(this,{data:r,type:"success",dataUpdatedAt:null===t||void 0===t?void 0:t.updatedAt,manual:null===t||void 0===t?void 0:t.manual}),r}setState(e,t){Z(Ye,this,$e).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var t,r;const n=null===(t=$(Ge,this))||void 0===t?void 0:t.promise;return null===(r=$(Ge,this))||void 0===r||r.cancel(e),n?n.then(re).catch(re):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState($(We,this))}isActive(){return this.observers.some(e=>!1!==oe(e.options.enabled,this))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ye||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===se(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!ae(this.state.dataUpdatedAt,e))}onFocus(){var e;const t=this.observers.find(e=>e.shouldFetchOnWindowFocus());null===t||void 0===t||t.refetch({cancelRefetch:!1}),null===(e=$(Ge,this))||void 0===e||e.continue()}onOnline(){var e;const t=this.observers.find(e=>e.shouldFetchOnReconnect());null===t||void 0===t||t.refetch({cancelRefetch:!1}),null===(e=$(Ge,this))||void 0===e||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),$(Ve,this).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||($(Ge,this)&&($(Je,this)?$(Ge,this).cancel({revert:!0}):$(Ge,this).cancelRetry()),this.scheduleGc()),$(Ve,this).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Z(Ye,this,$e).call(this,{type:"invalidate"})}fetch(e,t){var r,n;if("idle"!==this.state.fetchStatus)if(void 0!==this.state.data&&null!==t&&void 0!==t&&t.cancelRefetch)this.cancel({silent:!0});else if($(Ge,this))return $(Ge,this).continueRetry(),$(Ge,this).promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const a=new AbortController,s=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(ee(Je,this,!0),a.signal)})},o=()=>{const e=we(this.options,t),r=(()=>{const e={client:$(He,this),queryKey:this.queryKey,meta:this.meta};return s(e),e})();return ee(Je,this,!1),this.options.persister?this.options.persister(e,r,this):e(r)},i=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:$(He,this),state:this.state,fetchFn:o};return s(e),e})();var l;(null===(r=this.options.behavior)||void 0===r||r.onFetch(i,this),ee(qe,this,this.state),"idle"===this.state.fetchStatus||this.state.fetchMeta!==(null===(n=i.fetchOptions)||void 0===n?void 0:n.meta))&&Z(Ye,this,$e).call(this,{type:"fetch",meta:null===(l=i.fetchOptions)||void 0===l?void 0:l.meta});const c=e=>{var t,r,n,a;(Be(e)&&e.silent||Z(Ye,this,$e).call(this,{type:"error",error:e}),Be(e))||(null===(t=(r=$(Ve,this).config).onError)||void 0===t||t.call(r,e,this),null===(n=(a=$(Ve,this).config).onSettled)||void 0===n||n.call(a,this.state.data,e,this));this.scheduleGc()};return ee(Ge,this,ze({initialPromise:null===t||void 0===t?void 0:t.initialPromise,fn:i.fetchFn,abort:a.abort.bind(a),onSuccess:e=>{var t,r,n,a;if(void 0!==e){try{this.setData(e)}catch(s){return void c(s)}null===(t=(r=$(Ve,this).config).onSuccess)||void 0===t||t.call(r,e,this),null===(n=(a=$(Ve,this).config).onSettled)||void 0===n||n.call(a,e,this.state.error,this),this.scheduleGc()}else c(new Error("".concat(this.queryHash," data is undefined")))},onError:c,onFail:(e,t)=>{Z(Ye,this,$e).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{Z(Ye,this,$e).call(this,{type:"pause"})},onContinue:()=>{Z(Ye,this,$e).call(this,{type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0})),$(Ge,this).start()}});function $e(e){this.state=(t=>{var r,n;switch(e.type){case"failed":return(0,Y.A)((0,Y.A)({},t),{},{fetchFailureCount:e.failureCount,fetchFailureReason:e.error});case"pause":return(0,Y.A)((0,Y.A)({},t),{},{fetchStatus:"paused"});case"continue":return(0,Y.A)((0,Y.A)({},t),{},{fetchStatus:"fetching"});case"fetch":return(0,Y.A)((0,Y.A)((0,Y.A)({},t),et(t.data,this.options)),{},{fetchMeta:null!==(r=e.meta)&&void 0!==r?r:null});case"success":return ee(qe,this,void 0),(0,Y.A)((0,Y.A)({},t),{},{data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:null!==(n=e.dataUpdatedAt)&&void 0!==n?n:Date.now(),error:null,isInvalidated:!1,status:"success"},!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null});case"error":const a=e.error;return Be(a)&&a.revert&&$(qe,this)?(0,Y.A)((0,Y.A)({},$(qe,this)),{},{fetchStatus:"idle"}):(0,Y.A)((0,Y.A)({},t),{},{error:a,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"});case"invalidate":return(0,Y.A)((0,Y.A)({},t),{},{isInvalidated:!0});case"setState":return(0,Y.A)((0,Y.A)({},t),e.state)}})(this.state),Ie.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),$(Ve,this).notify({query:this,type:"updated",action:e})})}function et(e,t){return(0,Y.A)({fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Re(t.networkMode)?"fetching":"paused"},void 0===e&&{error:null,status:"pending"})}var tt,rt,nt,at,st,ot,it,lt=(Xe=new WeakMap,class extends Te{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),Q(this,Xe,void 0),this.config=e,ee(Xe,this,new Map)}build(e,t,r){var n;const a=t.queryKey,s=null!==(n=t.queryHash)&&void 0!==n?n:ce(a,t);let o=this.get(s);return o||(o=new Ze({client:e,queryKey:a,queryHash:s,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(a)}),this.add(o)),o}add(e){$(Xe,this).has(e.queryHash)||($(Xe,this).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=$(Xe,this).get(e.queryHash);t&&(e.destroy(),t===e&&$(Xe,this).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ie.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return $(Xe,this).get(e)}getAll(){return[...$(Xe,this).values()]}find(e){const t=(0,Y.A)({exact:!0},e);return this.getAll().find(e=>ie(t,e))}findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>ie(e,t)):t}notify(e){Ie.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Ie.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ie.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}}),ct=(tt=new WeakMap,rt=new WeakMap,nt=new WeakMap,at=new WeakSet,class extends Qe{constructor(e){super(),Ne(this,at),Q(this,tt,void 0),Q(this,rt,void 0),Q(this,nt,void 0),this.mutationId=e.mutationId,ee(rt,this,e.mutationCache),ee(tt,this,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){$(tt,this).includes(e)||($(tt,this).push(e),this.clearGcTimeout(),$(rt,this).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){ee(tt,this,$(tt,this).filter(t=>t!==e)),this.scheduleGc(),$(rt,this).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){$(tt,this).length||("pending"===this.state.status?this.scheduleGc():$(rt,this).remove(this))}continue(){var e,t;return null!==(e=null===(t=$(nt,this))||void 0===t?void 0:t.continue())&&void 0!==e?e:this.execute(this.state.variables)}async execute(e){var t;const r=()=>{Z(at,this,dt).call(this,{type:"continue"})};ee(nt,this,ze({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{Z(at,this,dt).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{Z(at,this,dt).call(this,{type:"pause"})},onContinue:r,retry:null!==(t=this.options.retry)&&void 0!==t?t:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>$(rt,this).canRun(this)}));const n="pending"===this.state.status,a=!$(nt,this).canStart();try{var s,o,i,l,c,d,u,h;if(n)r();else{var m,p,f,g;Z(at,this,dt).call(this,{type:"pending",variables:e,isPaused:a}),await(null===(m=(p=$(rt,this).config).onMutate)||void 0===m?void 0:m.call(p,e,this));const t=await(null===(f=(g=this.options).onMutate)||void 0===f?void 0:f.call(g,e));t!==this.state.context&&Z(at,this,dt).call(this,{type:"pending",context:t,variables:e,isPaused:a})}const t=await $(nt,this).start();return await(null===(s=(o=$(rt,this).config).onSuccess)||void 0===s?void 0:s.call(o,t,e,this.state.context,this)),await(null===(i=(l=this.options).onSuccess)||void 0===i?void 0:i.call(l,t,e,this.state.context)),await(null===(c=(d=$(rt,this).config).onSettled)||void 0===c?void 0:c.call(d,t,null,this.state.variables,this.state.context,this)),await(null===(u=(h=this.options).onSettled)||void 0===u?void 0:u.call(h,t,null,e,this.state.context)),Z(at,this,dt).call(this,{type:"success",data:t}),t}catch(k){try{var v,x,b,y,w,j,N,S;throw await(null===(v=(x=$(rt,this).config).onError)||void 0===v?void 0:v.call(x,k,e,this.state.context,this)),await(null===(b=(y=this.options).onError)||void 0===b?void 0:b.call(y,k,e,this.state.context)),await(null===(w=(j=$(rt,this).config).onSettled)||void 0===w?void 0:w.call(j,void 0,k,this.state.variables,this.state.context,this)),await(null===(N=(S=this.options).onSettled)||void 0===N?void 0:N.call(S,void 0,k,e,this.state.context)),k}finally{Z(at,this,dt).call(this,{type:"error",error:k})}}finally{$(rt,this).runNext(this)}}});function dt(e){this.state=(t=>{switch(e.type){case"failed":return(0,Y.A)((0,Y.A)({},t),{},{failureCount:e.failureCount,failureReason:e.error});case"pause":return(0,Y.A)((0,Y.A)({},t),{},{isPaused:!0});case"continue":return(0,Y.A)((0,Y.A)({},t),{},{isPaused:!1});case"pending":return(0,Y.A)((0,Y.A)({},t),{},{context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()});case"success":return(0,Y.A)((0,Y.A)({},t),{},{data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1});case"error":return(0,Y.A)((0,Y.A)({},t),{},{data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"})}})(this.state),Ie.batch(()=>{$(tt,this).forEach(t=>{t.onMutationUpdate(e)}),$(rt,this).notify({mutation:this,type:"updated",action:e})})}var ut,ht,mt,pt,ft,gt,vt,xt,bt=(st=new WeakMap,ot=new WeakMap,it=new WeakMap,class extends Te{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),Q(this,st,void 0),Q(this,ot,void 0),Q(this,it,void 0),this.config=e,ee(st,this,new Set),ee(ot,this,new Map),ee(it,this,0)}build(e,t,r){var n;const a=new ct({mutationCache:this,mutationId:ee(it,this,(n=$(it,this),++n)),options:e.defaultMutationOptions(t),state:r});return this.add(a),a}add(e){$(st,this).add(e);const t=yt(e);if("string"===typeof t){const r=$(ot,this).get(t);r?r.push(e):$(ot,this).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if($(st,this).delete(e)){const t=yt(e);if("string"===typeof t){const r=$(ot,this).get(t);if(r)if(r.length>1){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}else r[0]===e&&$(ot,this).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=yt(e);if("string"===typeof t){const r=$(ot,this).get(t),n=null===r||void 0===r?void 0:r.find(e=>"pending"===e.state.status);return!n||n===e}return!0}runNext(e){const t=yt(e);if("string"===typeof t){var r,n;const a=null===(r=$(ot,this).get(t))||void 0===r?void 0:r.find(t=>t!==e&&t.state.isPaused);return null!==(n=null===a||void 0===a?void 0:a.continue())&&void 0!==n?n:Promise.resolve()}return Promise.resolve()}clear(){Ie.batch(()=>{$(st,this).forEach(e=>{this.notify({type:"removed",mutation:e})}),$(st,this).clear(),$(ot,this).clear()})}getAll(){return Array.from($(st,this))}find(e){const t=(0,Y.A)({exact:!0},e);return this.getAll().find(e=>le(t,e))}findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getAll().filter(t=>le(e,t))}notify(e){Ie.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return Ie.batch(()=>Promise.all(e.map(e=>e.continue().catch(re))))}});function yt(e){var t;return null===(t=e.options.scope)||void 0===t?void 0:t.id}function wt(e){return{onFetch:(t,r)=>{var n,a,s;const o=t.options,i=null===(n=t.fetchOptions)||void 0===n||null===(n=n.meta)||void 0===n||null===(n=n.fetchMore)||void 0===n?void 0:n.direction,l=(null===(a=t.state.data)||void 0===a?void 0:a.pages)||[],c=(null===(s=t.state.data)||void 0===s?void 0:s.pageParams)||[];let d={pages:[],pageParams:[]},u=0;const h=async()=>{let r=!1;const n=we(t.options,t.fetchOptions),a=async(e,a,s)=>{if(r)return Promise.reject();if(null==a&&e.pages.length)return Promise.resolve(e);const o=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:a,direction:s?"backward":"forward",meta:t.options.meta};var n;return n=e,Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(t.signal.aborted?r=!0:t.signal.addEventListener("abort",()=>{r=!0}),t.signal)}),e})(),i=await n(o),{maxPages:l}=t.options,c=s?be:xe;return{pages:c(e.pages,i,l),pageParams:c(e.pageParams,a,l)}};if(i&&l.length){const e="backward"===i,t={pages:l,pageParams:c},r=(e?Nt:jt)(o,t);d=await a(t,r,e)}else{const t=null!==e&&void 0!==e?e:l.length;do{var s;const e=0===u?null!==(s=c[0])&&void 0!==s?s:o.initialPageParam:jt(o,d);if(u>0&&null==e)break;d=await a(d,e),u++}while(u<t)}return d};t.options.persister?t.fetchFn=()=>{var e,n;return null===(e=(n=t.options).persister)||void 0===e?void 0:e.call(n,h,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=h}}}function jt(e,t){let{pages:r,pageParams:n}=t;const a=r.length-1;return r.length>0?e.getNextPageParam(r[a],r,n[a],n):void 0}function Nt(e,t){var r;let{pages:n,pageParams:a}=t;return n.length>0?null===(r=e.getPreviousPageParam)||void 0===r?void 0:r.call(e,n[0],n,a[0],a):void 0}var St=(ut=new WeakMap,ht=new WeakMap,mt=new WeakMap,pt=new WeakMap,ft=new WeakMap,gt=new WeakMap,vt=new WeakMap,xt=new WeakMap,class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Q(this,ut,void 0),Q(this,ht,void 0),Q(this,mt,void 0),Q(this,pt,void 0),Q(this,ft,void 0),Q(this,gt,void 0),Q(this,vt,void 0),Q(this,xt,void 0),ee(ut,this,e.queryCache||new lt),ee(ht,this,e.mutationCache||new bt),ee(mt,this,e.defaultOptions||{}),ee(pt,this,new Map),ee(ft,this,new Map),ee(gt,this,0)}mount(){var e;ee(gt,this,(e=$(gt,this),e++,e)),1===$(gt,this)&&(ee(vt,this,Le.subscribe(async e=>{e&&(await this.resumePausedMutations(),$(ut,this).onFocus())})),ee(xt,this,De.subscribe(async e=>{e&&(await this.resumePausedMutations(),$(ut,this).onOnline())})))}unmount(){var e,t,r;ee(gt,this,(e=$(gt,this),e--,e)),0===$(gt,this)&&(null===(t=$(vt,this))||void 0===t||t.call(this),ee(vt,this,void 0),null===(r=$(xt,this))||void 0===r||r.call(this),ee(xt,this,void 0))}isFetching(e){return $(ut,this).findAll((0,Y.A)((0,Y.A)({},e),{},{fetchStatus:"fetching"})).length}isMutating(e){return $(ht,this).findAll((0,Y.A)((0,Y.A)({},e),{},{status:"pending"})).length}getQueryData(e){var t;const r=this.defaultQueryOptions({queryKey:e});return null===(t=$(ut,this).get(r.queryHash))||void 0===t?void 0:t.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=$(ut,this).build(this,t),n=r.state.data;return void 0===n?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(se(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return $(ut,this).findAll(e).map(e=>{let{queryKey:t,state:r}=e;return[t,r.data]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),a=$(ut,this).get(n.queryHash),s=function(e,t){return"function"===typeof e?e(t):e}(t,null===a||void 0===a?void 0:a.state.data);if(void 0!==s)return $(ut,this).build(this,n).setData(s,(0,Y.A)((0,Y.A)({},r),{},{manual:!0}))}setQueriesData(e,t,r){return Ie.batch(()=>$(ut,this).findAll(e).map(e=>{let{queryKey:n}=e;return[n,this.setQueryData(n,t,r)]}))}getQueryState(e){var t;const r=this.defaultQueryOptions({queryKey:e});return null===(t=$(ut,this).get(r.queryHash))||void 0===t?void 0:t.state}removeQueries(e){const t=$(ut,this);Ie.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const r=$(ut,this);return Ie.batch(()=>(r.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries((0,Y.A)({type:"active"},e),t)))}cancelQueries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=(0,Y.A)({revert:!0},t),n=Ie.batch(()=>$(ut,this).findAll(e).map(e=>e.cancel(r)));return Promise.all(n).then(re).catch(re)}invalidateQueries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ie.batch(()=>{var r,n;return $(ut,this).findAll(e).forEach(e=>{e.invalidate()}),"none"===(null===e||void 0===e?void 0:e.refetchType)?Promise.resolve():this.refetchQueries((0,Y.A)((0,Y.A)({},e),{},{type:null!==(r=null!==(n=null===e||void 0===e?void 0:e.refetchType)&&void 0!==n?n:null===e||void 0===e?void 0:e.type)&&void 0!==r?r:"active"}),t)})}refetchQueries(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=(0,Y.A)((0,Y.A)({},r),{},{cancelRefetch:null===(t=r.cancelRefetch)||void 0===t||t}),a=Ie.batch(()=>$(ut,this).findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,n);return n.throwOnError||(t=t.catch(re)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(a).then(re)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const r=$(ut,this).build(this,t);return r.isStaleByTime(se(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(re).catch(re)}fetchInfiniteQuery(e){return e.behavior=wt(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(re).catch(re)}ensureInfiniteQueryData(e){return e.behavior=wt(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return De.isOnline()?$(ht,this).resumePausedMutations():Promise.resolve()}getQueryCache(){return $(ut,this)}getMutationCache(){return $(ht,this)}getDefaultOptions(){return $(mt,this)}setDefaultOptions(e){ee(mt,this,e)}setQueryDefaults(e,t){$(pt,this).set(de(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...$(pt,this).values()],r={};return t.forEach(t=>{ue(e,t.queryKey)&&Object.assign(r,t.defaultOptions)}),r}setMutationDefaults(e,t){$(ft,this).set(de(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...$(ft,this).values()],r={};return t.forEach(t=>{ue(e,t.mutationKey)&&Object.assign(r,t.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t=(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},$(mt,this).queries),this.getQueryDefaults(e.queryKey)),e),{},{_defaulted:!0});return t.queryHash||(t.queryHash=ce(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===ye&&(t.enabled=!1),t}defaultMutationOptions(e){return null!==e&&void 0!==e&&e._defaulted?e:(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},$(mt,this).mutations),(null===e||void 0===e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey)),e),{},{_defaulted:!0})}clear(){$(ut,this).clear(),$(ht,this).clear()}}),kt=r(579),At=o.createContext(void 0),Ct=e=>{const t=o.useContext(At);if(e)return e;if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Et=e=>{let{client:t,children:r}=e;return o.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),(0,kt.jsx)(At.Provider,{value:t,children:r})};function Pt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}let _t={data:""},It=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||_t,Tt=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Lt=/\/\*[^]*?\*\/|  +/g,Dt=/\n+/g,Mt=(e,t)=>{let r="",n="",a="";for(let s in e){let o=e[s];"@"==s[0]?"i"==s[1]?r=s+" "+o+";":n+="f"==s[1]?Mt(o,s):s+"{"+Mt(o,"k"==s[1]?"":t)+"}":"object"==typeof o?n+=Mt(o,t?t.replace(/([^,])+/g,e=>s.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):s):null!=o&&(s=/^--/.test(s)?s:s.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=Mt.p?Mt.p(s,o):s+":"+o+";")}return r+(t&&a?t+"{"+a+"}":a)+n},Ot={},Rt=e=>{if("object"==typeof e){let t="";for(let r in e)t+=r+Rt(e[r]);return t}return e},Ft=(e,t,r,n,a)=>{let s=Rt(e),o=Ot[s]||(Ot[s]=(e=>{let t=0,r=11;for(;t<e.length;)r=101*r+e.charCodeAt(t++)>>>0;return"go"+r})(s));if(!Ot[o]){let t=s!==e?e:(e=>{let t,r,n=[{}];for(;t=Tt.exec(e.replace(Lt,""));)t[4]?n.shift():t[3]?(r=t[3].replace(Dt," ").trim(),n.unshift(n[0][r]=n[0][r]||{})):n[0][t[1]]=t[2].replace(Dt," ").trim();return n[0]})(e);Ot[o]=Mt(a?{["@keyframes "+o]:t}:t,r?"":"."+o)}let i=r&&Ot.g?Ot.g:null;return r&&(Ot.g=Ot[o]),((e,t,r,n)=>{n?t.data=t.data.replace(n,e):-1===t.data.indexOf(e)&&(t.data=r?e+t.data:t.data+e)})(Ot[o],t,n,i),o};function Ut(e){let t=this||{},r=e.call?e(t.p):e;return Ft(r.unshift?r.raw?((e,t,r)=>e.reduce((e,n,a)=>{let s=t[a];if(s&&s.call){let e=s(r),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;s=t?"."+t:e&&"object"==typeof e?e.props?"":Mt(e,""):!1===e?"":e}return e+n+(null==s?"":s)},""))(r,[].slice.call(arguments,1),t.p):r.reduce((e,r)=>Object.assign(e,r&&r.call?r(t.p):r),{}):r,It(t.target),t.g,t.o,t.k)}Ut.bind({g:1});let Bt,zt,Wt,qt=Ut.bind({k:1});function Vt(e,t){let r=this||{};return function(){let n=arguments;function a(s,o){let i=Object.assign({},s),l=i.className||a.className;r.p=Object.assign({theme:zt&&zt()},i),r.o=/ *go\d+/.test(l),i.className=Ut.apply(r,n)+(l?" "+l:""),t&&(i.ref=o);let c=e;return e[0]&&(c=i.as||e,delete i.as),Wt&&c[0]&&Wt(i),Bt(c,i)}return t?t(a):a}}var Ht,Gt,Kt,Jt,Yt,Xt,Qt,Zt,$t,er,tr,rr,nr,ar,sr,or,ir=(e,t)=>(e=>"function"==typeof e)(e)?e(t):e,lr=(()=>{let e=0;return()=>(++e).toString()})(),cr=(()=>{let e;return()=>{if(void 0===e&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),dr=(e,t)=>{switch(t.type){case 0:return(0,Y.A)((0,Y.A)({},e),{},{toasts:[t.toast,...e.toasts].slice(0,20)});case 1:return(0,Y.A)((0,Y.A)({},e),{},{toasts:e.toasts.map(e=>e.id===t.toast.id?(0,Y.A)((0,Y.A)({},e),t.toast):e)});case 2:let{toast:r}=t;return dr(e,{type:e.toasts.find(e=>e.id===r.id)?1:0,toast:r});case 3:let{toastId:n}=t;return(0,Y.A)((0,Y.A)({},e),{},{toasts:e.toasts.map(e=>e.id===n||void 0===n?(0,Y.A)((0,Y.A)({},e),{},{dismissed:!0,visible:!1}):e)});case 4:return void 0===t.toastId?(0,Y.A)((0,Y.A)({},e),{},{toasts:[]}):(0,Y.A)((0,Y.A)({},e),{},{toasts:e.toasts.filter(e=>e.id!==t.toastId)});case 5:return(0,Y.A)((0,Y.A)({},e),{},{pausedAt:t.time});case 6:let a=t.time-(e.pausedAt||0);return(0,Y.A)((0,Y.A)({},e),{},{pausedAt:void 0,toasts:e.toasts.map(e=>(0,Y.A)((0,Y.A)({},e),{},{pauseDuration:e.pauseDuration+a}))})}},ur=[],hr={toasts:[],pausedAt:void 0},mr=e=>{hr=dr(hr,e),ur.forEach(e=>{e(hr)})},pr={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},fr=e=>(t,r)=>{let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",r=arguments.length>2?arguments[2]:void 0;return(0,Y.A)((0,Y.A)({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0},r),{},{id:(null==r?void 0:r.id)||lr()})}(t,e,r);return mr({type:2,toast:n}),n.id},gr=(e,t)=>fr("blank")(e,t);gr.error=fr("error"),gr.success=fr("success"),gr.loading=fr("loading"),gr.custom=fr("custom"),gr.dismiss=e=>{mr({type:3,toastId:e})},gr.remove=e=>mr({type:4,toastId:e}),gr.promise=(e,t,r)=>{let n=gr.loading(t.loading,(0,Y.A)((0,Y.A)({},r),null==r?void 0:r.loading));return"function"==typeof e&&(e=e()),e.then(e=>{let a=t.success?ir(t.success,e):void 0;return a?gr.success(a,(0,Y.A)((0,Y.A)({id:n},r),null==r?void 0:r.success)):gr.dismiss(n),e}).catch(e=>{let a=t.error?ir(t.error,e):void 0;a?gr.error(a,(0,Y.A)((0,Y.A)({id:n},r),null==r?void 0:r.error)):gr.dismiss(n)}),e};var vr=(e,t)=>{mr({type:1,toast:{id:e,height:t}})},xr=()=>{mr({type:5,time:Date.now()})},br=new Map,yr=e=>{let{toasts:t,pausedAt:r}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,o.useState)(hr),n=(0,o.useRef)(hr);(0,o.useEffect)(()=>(n.current!==hr&&r(hr),ur.push(r),()=>{let e=ur.indexOf(r);e>-1&&ur.splice(e,1)}),[]);let a=t.toasts.map(t=>{var r,n,a;return(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},e),e[t.type]),t),{},{removeDelay:t.removeDelay||(null==(r=e[t.type])?void 0:r.removeDelay)||(null==e?void 0:e.removeDelay),duration:t.duration||(null==(n=e[t.type])?void 0:n.duration)||(null==e?void 0:e.duration)||pr[t.type],style:(0,Y.A)((0,Y.A)((0,Y.A)({},e.style),null==(a=e[t.type])?void 0:a.style),t.style)})});return(0,Y.A)((0,Y.A)({},t),{},{toasts:a})}(e);(0,o.useEffect)(()=>{if(r)return;let e=Date.now(),n=t.map(t=>{if(t.duration===1/0)return;let r=(t.duration||0)+t.pauseDuration-(e-t.createdAt);if(!(r<0))return setTimeout(()=>gr.dismiss(t.id),r);t.visible&&gr.dismiss(t.id)});return()=>{n.forEach(e=>e&&clearTimeout(e))}},[t,r]);let n=(0,o.useCallback)(()=>{r&&mr({type:6,time:Date.now()})},[r]),a=(0,o.useCallback)((e,r)=>{let{reverseOrder:n=!1,gutter:a=8,defaultPosition:s}=r||{},o=t.filter(t=>(t.position||s)===(e.position||s)&&t.height),i=o.findIndex(t=>t.id===e.id),l=o.filter((e,t)=>t<i&&e.visible).length;return o.filter(e=>e.visible).slice(...n?[l+1]:[0,l]).reduce((e,t)=>e+(t.height||0)+a,0)},[t]);return(0,o.useEffect)(()=>{t.forEach(e=>{if(e.dismissed)!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(br.has(e))return;let r=setTimeout(()=>{br.delete(e),mr({type:4,toastId:e})},t);br.set(e,r)}(e.id,e.removeDelay);else{let t=br.get(e.id);t&&(clearTimeout(t),br.delete(e.id))}})},[t]),{toasts:t,handlers:{updateHeight:vr,startPause:xr,endPause:n,calculateOffset:a}}},wr=qt(Ht||(Ht=Pt(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]))),jr=qt(Gt||(Gt=Pt(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),Nr=qt(Kt||(Kt=Pt(["\nfrom {\n  transform: scale(0) rotate(90deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n\topacity: 1;\n}"]))),Sr=Vt("div")(Jt||(Jt=Pt(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"])),e=>e.primary||"#ff4b4b",wr,jr,e=>e.secondary||"#fff",Nr),kr=qt(Yt||(Yt=Pt(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),Ar=Vt("div")(Xt||(Xt=Pt(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"])),e=>e.secondary||"#e0e0e0",e=>e.primary||"#616161",kr),Cr=qt(Qt||(Qt=Pt(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n\topacity: 1;\n}"]))),Er=qt(Zt||(Zt=Pt(["\n0% {\n\theight: 0;\n\twidth: 0;\n\topacity: 0;\n}\n40% {\n  height: 0;\n\twidth: 6px;\n\topacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]))),Pr=Vt("div")($t||($t=Pt(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"])),e=>e.primary||"#61d345",Cr,Er,e=>e.secondary||"#fff"),_r=Vt("div")(er||(er=Pt(["\n  position: absolute;\n"]))),Ir=Vt("div")(tr||(tr=Pt(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]))),Tr=qt(rr||(rr=Pt(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),Lr=Vt("div")(nr||(nr=Pt(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"])),Tr),Dr=e=>{let{toast:t}=e,{icon:r,type:n,iconTheme:a}=t;return void 0!==r?"string"==typeof r?o.createElement(Lr,null,r):r:"blank"===n?null:o.createElement(Ir,null,o.createElement(Ar,(0,Y.A)({},a)),"loading"!==n&&o.createElement(_r,null,"error"===n?o.createElement(Sr,(0,Y.A)({},a)):o.createElement(Pr,(0,Y.A)({},a))))},Mr=e=>"\n0% {transform: translate3d(0,".concat(-200*e,"%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n"),Or=e=>"\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,".concat(-150*e,"%,-1px) scale(.6); opacity:0;}\n"),Rr=Vt("div")(ar||(ar=Pt(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]))),Fr=Vt("div")(sr||(sr=Pt(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"]))),Ur=o.memo(e=>{let{toast:t,position:r,style:n,children:a}=e,s=t.height?((e,t)=>{let r=e.includes("top")?1:-1,[n,a]=cr()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[Mr(r),Or(r)];return{animation:t?"".concat(qt(n)," 0.35s cubic-bezier(.21,1.02,.73,1) forwards"):"".concat(qt(a)," 0.4s forwards cubic-bezier(.06,.71,.55,1)")}})(t.position||r||"top-center",t.visible):{opacity:0},i=o.createElement(Dr,{toast:t}),l=o.createElement(Fr,(0,Y.A)({},t.ariaProps),ir(t.message,t));return o.createElement(Rr,{className:t.className,style:(0,Y.A)((0,Y.A)((0,Y.A)({},s),n),t.style)},"function"==typeof a?a({icon:i,message:l}):o.createElement(o.Fragment,null,i,l))});!function(e,t,r,n){Mt.p=t,Bt=e,zt=r,Wt=n}(o.createElement);var Br=e=>{let{id:t,className:r,style:n,onHeightUpdate:a,children:s}=e,i=o.useCallback(e=>{if(e){let r=()=>{let r=e.getBoundingClientRect().height;a(t,r)};r(),new MutationObserver(r).observe(e,{subtree:!0,childList:!0,characterData:!0})}},[t,a]);return o.createElement("div",{ref:i,className:r,style:n},s)},zr=Ut(or||(or=Pt(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"]))),Wr=e=>{let{reverseOrder:t,position:r="top-center",toastOptions:n,gutter:a,children:s,containerStyle:i,containerClassName:l}=e,{toasts:c,handlers:d}=yr(n);return o.createElement("div",{id:"_rht_toaster",style:(0,Y.A)({position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none"},i),className:l,onMouseEnter:d.startPause,onMouseLeave:d.endPause},c.map(e=>{let n=e.position||r,i=((e,t)=>{let r=e.includes("top"),n=r?{top:0}:{bottom:0},a=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return(0,Y.A)((0,Y.A)({left:0,right:0,display:"flex",position:"absolute",transition:cr()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:"translateY(".concat(t*(r?1:-1),"px)")},n),a)})(n,d.calculateOffset(e,{reverseOrder:t,gutter:a,defaultPosition:r}));return o.createElement(Br,{id:e.id,key:e.id,onHeightUpdate:d.updateHeight,className:e.visible?zr:"",style:i},"custom"===e.type?ir(e.message,e):s?s(e):o.createElement(Ur,{toast:e,position:n}))}))},qr=gr;const Vr=e=>{var t,r;return e?e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):null!==(t=e.user_metadata)&&void 0!==t&&t.first_name&&null!==(r=e.user_metadata)&&void 0!==r&&r.last_name?"".concat(e.user_metadata.first_name," ").concat(e.user_metadata.last_name):e.name?e.name:e.email?e.email:"Unknown User":"Unknown User"},Hr=e=>{if(!e)return"U";const t=(e=>{var t;return e?e.firstName?e.firstName:null!==(t=e.user_metadata)&&void 0!==t&&t.first_name?e.user_metadata.first_name:e.name?e.name.split(" ")[0]:e.email?e.email.split("@")[0]:"Unknown":"Unknown"})(e),r=(e=>{var t;if(!e)return"User";if(e.lastName)return e.lastName;if(null!==(t=e.user_metadata)&&void 0!==t&&t.last_name)return e.user_metadata.last_name;if(e.name){const t=e.name.split(" ");return t.length>1?t.slice(1).join(" "):""}return"User"})(e);return t&&r?"".concat(t.charAt(0)).concat(r.charAt(0)).toUpperCase():t?t.charAt(0).toUpperCase():e.email?e.email.charAt(0).toUpperCase():"U"},Gr=()=>(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"})]}),Kr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),Jr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),Yr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),Xr=()=>(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Qr=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),Zr=e=>{let{className:t="w-6 h-6"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},$r=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),en=e=>{let{className:t="h-5 w-5 text-purple-500"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})},tn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})},rn=e=>{let{className:t="w-6 h-6"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})},nn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),an=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193l-3.722.267c-.34.024-.65.18-.882.477a1.125 1.125 0 01-1.587 0c-.232-.297-.542-.453-.882-.477l-3.722-.267A2.25 2.25 0 015.25 15v-4.286c0-.97.616-1.813 1.5-2.097m1.625 3.511l.228.228c.327.327.754.529 1.208.529h.286c.454 0 .881-.202 1.208-.529l.228-.228m1.375 2.134l.228-.228c.327-.327.754-.529 1.208-.529h.286c.454 0 .881.202 1.208-.529l.228-.228m-6.25-2.134l.228.228c.327.327.754.529 1.208.529h.286c.454 0 .881-.202 1.208-.529l.228-.228m-6.25-2.134l.228.228c.327.327.754.529 1.208.529h.286c.454 0 .881-.202 1.208-.529l.228-.228M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),sn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 019 9v.375M10.125 2.25c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9.003M18.002 12a6.002 6.002 0 11-12 0 6.002 6.002 0 0112 0zm-8.25 1.5l2.25-2.25 4.5 4.5"})}),on=e=>{let{className:t="w-6 h-6"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},ln=e=>{let{className:t="w-6 h-6"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"})})},cn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),dn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})}),un=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})}),hn=()=>(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})}),mn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 15.75l7.5-7.5 7.5 7.5"})})},pn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})})},fn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})},gn=e=>{let{className:t="w-4 h-4"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})},vn=e=>{let{className:t="w-4 h-4"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12"})})},xn=e=>{let{className:t="w-4 h-4"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z"})})},bn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})})},yn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})},wn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})},jn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"})})},Nn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"})})},Sn=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25s-7.5-4.108-7.5-11.25a7.5 7.5 0 1115 0z"})]})};var kn=r(759);function An(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var Cn=r(816);const En="SET_ITEMS",Pn="TOGGLE_EXPANDED",_n="TOGGLE_COMPLETED",In="ADD_COMMENT",Tn="UPDATE_COMMENT_TEXT",Ln="SET_SHOW_COMMENT_INPUT",Dn="SET_COMMENT_INPUTS",Mn="REMOVE_ITEM",On={items:[],expandedItems:new Set,completedItems:new Set,comments:{},newCommentText:{},showCommentInput:{},commentInputs:{}};function Rn(e,t){switch(t.type){case En:{const r=Array.isArray(t.payload)?t.payload:[],n=Array.isArray(e.items)?e.items:[];if(n.length===r.length){let t=!0;for(let e=0;e<n.length;e++){const a=n[e],s=r[e];if((null===a||void 0===a?void 0:a.id)!==(null===s||void 0===s?void 0:s.id)||(null===a||void 0===a?void 0:a.timestamp)!==(null===s||void 0===s?void 0:s.timestamp)){t=!1;break}}if(t)return e}return(0,Y.A)((0,Y.A)({},e),{},{items:r})}case Pn:const r=new Set(e.expandedItems);return r.has(t.payload)?r.delete(t.payload):r.add(t.payload),(0,Y.A)((0,Y.A)({},e),{},{expandedItems:r});case _n:const n=new Set(e.completedItems);return n.has(t.payload)?n.delete(t.payload):n.add(t.payload),(0,Y.A)((0,Y.A)({},e),{},{completedItems:n});case In:const{itemId:a,comment:s}=t.payload;return(0,Y.A)((0,Y.A)({},e),{},{comments:(0,Y.A)((0,Y.A)({},e.comments),{},{[a]:[...e.comments[a]||[],s]}),newCommentText:(0,Y.A)((0,Y.A)({},e.newCommentText),{},{[a]:""}),commentInputs:(0,Y.A)((0,Y.A)({},e.commentInputs),{},{[a]:""})});case Tn:return(0,Y.A)((0,Y.A)({},e),{},{newCommentText:(0,Y.A)((0,Y.A)({},e.newCommentText),{},{[t.payload.itemId]:t.payload.text})});case Ln:return(0,Y.A)((0,Y.A)({},e),{},{showCommentInput:(0,Y.A)((0,Y.A)({},e.showCommentInput),{},{[t.payload.itemId]:t.payload.show})});case Dn:return(0,Y.A)((0,Y.A)({},e),{},{commentInputs:(0,Y.A)((0,Y.A)({},e.commentInputs),{},{[t.payload.itemId]:t.payload.text})});case Mn:{const r=t.payload,n=(e.items||[]).filter(e=>e.id!==r),a=new Set(e.expandedItems);a.delete(r);const s=new Set(e.completedItems);s.delete(r);const o=e.comments,{[r]:i}=o,l=An(o,[r].map(Cn.A)),c=e.commentInputs,{[r]:d}=c,u=An(c,[r].map(Cn.A)),h=e.showCommentInput,{[r]:m}=h,p=An(h,[r].map(Cn.A)),f=e.newCommentText,{[r]:g}=f,v=An(f,[r].map(Cn.A));return(0,Y.A)((0,Y.A)({},e),{},{items:n,expandedItems:a,completedItems:s,comments:l,commentInputs:u,showCommentInput:p,newCommentText:v})}default:return e}}const Fn=(0,o.createContext)();function Un(e){let{children:t}=e;const[r,n]=(0,o.useReducer)(Rn,On),a=(0,o.useMemo)(()=>({setItems:e=>n({type:En,payload:e}),toggleExpanded:e=>n({type:Pn,payload:e}),toggleCompleted:e=>n({type:_n,payload:e}),addComment:(e,t)=>n({type:In,payload:{itemId:e,comment:t}}),updateCommentText:(e,t)=>n({type:Tn,payload:{itemId:e,text:t}}),setShowCommentInput:(e,t)=>n({type:Ln,payload:{itemId:e,show:t}}),setCommentInputs:(e,t)=>n({type:Dn,payload:{itemId:e,text:t}}),removeItem:e=>n({type:Mn,payload:e})}),[n]);return(0,kt.jsx)(Fn.Provider,{value:{state:r,actions:a},children:t})}function Bn(){const e=(0,o.useContext)(Fn);if(!e)throw new Error("useActivity must be used within an ActivityProvider");return e}const zn={LEAD:{name:"Lead",weight:10},PROSPECT:{name:"Prospect",weight:15},APPROVED:{name:"Approved",weight:15},EXECUTION:{name:"Execution",weight:40},SECOND_SUPPLEMENT:{name:"2nd Supplement",weight:10},COMPLETION:{name:"Completion",weight:10}};const Wn=class{static calculateProjectProgress(e){if(!e)return this.getDefaultProgressData();const t=e.currentWorkflowItem;if(!t)return this.getDefaultProgressData();const r=Number(t.totalLineItems)||this.estimateTotalLineItems(),n=Array.isArray(t.completedItems)?t.completedItems.length:0,a=r>0?Math.round(n/r*100):0;if(t.isComplete)return{overall:100,phaseBreakdown:this.getCompletedPhaseBreakdown(),currentPhase:"COMPLETION",currentPhaseDisplay:"Completion",currentSection:null,currentLineItem:null,totalPhases:Object.keys(zn).length,completedPhases:Object.keys(zn).length,hasPhaseOverride:!1,completedLineItems:n,totalLineItems:r};const s=t.phase||"LEAD",o=Object.keys(zn),i=o.indexOf(s);return{overall:a,phaseBreakdown:{},currentPhase:s,currentPhaseDisplay:t.phaseDisplay||this.formatPhase(s),currentSection:t.section,currentLineItem:t.lineItem,totalPhases:o.length,completedPhases:Math.max(0,i),hasPhaseOverride:!1,completedLineItems:n,totalLineItems:r,skippedItemsCount:0}}static calculateProgressWithSkippedItems(e,t,r,n,a,s){const o=Object.keys(zn),i=o.indexOf(t);let l=[...e],c=0;if(s&&i>0){for(let e=0;e<i;e++){const t=o[e],r=s[t];if(r&&r.sections){const e=Object.values(r.sections);for(let r=0;r<e.length;r++){const n=e[r];if(n.lineItems){const e=Object.values(n.lineItems);for(let r=0;r<e.length;r++){const a=e[r];l.some(e=>e.lineItemId===a.id||e.id===a.id)||(l.push({id:a.id,lineItemId:a.id,phaseId:t,sectionId:n.id,name:a.name,isSkipped:!0,completedAt:(new Date).toISOString()}),c++)}}}}}if(r&&s[t]){const e=s[t],a=Object.values(e.sections||{}),o=a.findIndex(e=>e.name===r||e.id===r);if(o>0)for(let r=0;r<o;r++){const e=a[r];if(e.lineItems){const r=Object.values(e.lineItems);for(let n=0;n<r.length;n++){const a=r[n];l.some(e=>e.lineItemId===a.id||e.id===a.id)||(l.push({id:a.id,lineItemId:a.id,phaseId:t,sectionId:e.id,name:a.name,isSkipped:!0,completedAt:(new Date).toISOString()}),c++)}}}if(n&&o>=0){const e=a[o];if(e&&e.lineItems){const r=Object.values(e.lineItems),a=r.findIndex(e=>e.name===n||e.id===n);if(a>0)for(let n=0;n<a;n++){const a=r[n];l.some(e=>e.lineItemId===a.id||e.id===a.id)||(l.push({id:a.id,lineItemId:a.id,phaseId:t,sectionId:e.id,name:a.name,isSkipped:!0,completedAt:(new Date).toISOString()}),c++)}}}}}return{overallProgress:a>0?Math.round(l.length/a*100):0,adjustedCompletedItems:l,totalLineItems:a,skippedItemsCount:c}}static estimateTotalLineItems(){return 25}static calculatePhaseBreakdownFromLineItems(e,t,r,n){const a={},s=Object.keys(zn),o={},i={};if(e.forEach(e=>{e.phaseId&&(o[e.phaseId]=(o[e.phaseId]||0)+1)}),n)s.forEach(e=>{let t=0;const r=n[e];r&&r.sections&&Object.values(r.sections).forEach(e=>{e.lineItems&&(t+=Object.keys(e.lineItems).length)}),i[e]=t});else{const e=Math.ceil(this.estimateTotalLineItems()/s.length);s.forEach(t=>{i[t]=e})}return s.forEach((e,t)=>{const n=o[e]||0,s=i[e]||1;let l=0;t<r?l=100:t===r&&(l=Math.min(Math.round(n/s*100),100)),a[e]={name:zn[e].name,progress:l,weight:zn[e].weight,isCompleted:100===l,isCurrent:t===r,isPending:t>r,completedItems:n,totalItems:s}}),a}static calculatePhaseBreakdown(e,t){const r={};return Object.keys(zn).forEach((e,n)=>{let a=0;n<t?a=100:n===t&&(a=50),r[e]={name:zn[e].name,progress:a,weight:zn[e].weight,isCompleted:100===a,isCurrent:n===t,isPending:n>t}}),r}static getCompletedPhaseBreakdown(){const e={};return Object.keys(zn).forEach(t=>{e[t]={name:zn[t].name,progress:100,weight:zn[t].weight,isCompleted:!0,isCurrent:!1,isPending:!1}}),e}static getDefaultProgressData(){return{overall:0,phaseBreakdown:{},currentPhase:"LEAD",currentPhaseDisplay:"Lead",currentSection:"Not Started",currentLineItem:"No active task",totalPhases:Object.keys(zn).length,completedPhases:0,hasPhaseOverride:!1}}static formatPhase(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase().replace("_"," "):"Lead"}static getPhaseColor(e){return{LEAD:"#EAB308",PROSPECT:"#F97316",APPROVED:"#10B981",EXECUTION:"#D946EF",SECOND_SUPPLEMENT:"#8B5CF6",COMPLETION:"#0EA5E9"}[this.normalizePhase(e)]||"#EAB308"}static getPhaseInitials(e){return{LEAD:"L",PROSPECT:"P",APPROVED:"A",EXECUTION:"E",SECOND_SUPPLEMENT:"S",COMPLETION:"C"}[this.normalizePhase(e)]||"L"}static getContrastTextColor(e){const t=e.replace("#","").toUpperCase();return"EAB308"===t||"F97316"===t?"#111827":"white"}static getPhaseButtonProps(e){const t=this.normalizePhase(e),r=this.getPhaseName(t),n=this.getPhaseColor(t),a=this.getPhaseInitials(t);let s=this.getContrastTextColor(n);const o=(()=>{switch(t){case"LEAD":case"APPROVED":default:return"text-black";case"PROSPECT":case"EXECUTION":case"SECOND_SUPPLEMENT":case"COMPLETION":return"text-white"}})();return{initials:a,bgColor:{"#EAB308":"bg-yellow-500","#F97316":"bg-orange-600","#10B981":"bg-emerald-500","#D946EF":"bg-fuchsia-500","#8B5CF6":"bg-violet-500","#0EA5E9":"bg-sky-500"}[n]||"bg-yellow-500",textColor:o,fullName:r,hexColor:n,phase:t,contrastTextColor:s}}static getNextPhase(e){const t=Object.keys(zn),r=t.indexOf(e);return r>=0&&r<t.length-1?t[r+1]:null}static isInFinalPhase(e){const t=Object.keys(zn);return e===t[t.length-1]}static getWorkflowStatus(e){if(!e||!e.currentWorkflowItem)return{status:"Not Started",phase:"LEAD",progress:0,isComplete:!1};const t=e.currentWorkflowItem;if(t.isComplete)return{status:"Complete",phase:"COMPLETION",progress:100,isComplete:!0};const r=this.calculateProjectProgress(e);return{status:"In Progress",phase:t.phase||"LEAD",progress:r.overall,isComplete:!1,currentSection:t.section,currentTask:t.lineItem}}static getAllPhases(){return Object.keys(zn).map(e=>({id:e,key:e,name:zn[e].name,weight:zn[e].weight,color:this.getPhaseColor(e),initial:this.getPhaseInitials(e)}))}static getProjectPhase(e){return e?e.currentWorkflowItem&&e.currentWorkflowItem.phase?e.currentWorkflowItem.phase:e.phase?e.phase:"LEAD":"LEAD"}static getPhaseName(e){var t;if(!e)return"Lead";const r=this.normalizePhase(e);return(null===(t=zn[r])||void 0===t?void 0:t.name)||this.formatPhase(e)}static normalizePhase(e){if(!e)return"LEAD";return{LEAD:"LEAD",PROSPECT:"PROSPECT",APPROVED:"APPROVED",EXECUTION:"EXECUTION",EXECUTE:"EXECUTION",SECOND_SUPPLEMENT:"SECOND_SUPPLEMENT","2ND_SUPPLEMENT":"SECOND_SUPPLEMENT",SUPPLEMENT:"SECOND_SUPPLEMENT",COMPLETION:"COMPLETION",COMPLETE:"COMPLETION"}[e.toUpperCase().replace(/\s*PHASE$/i,"").replace("PHASE-","").replace("PHASE","").replace(/-INSURANCE-1ST SUPPLEMENT/i,"").replace("2ND SUPPLEMENT","SECOND_SUPPLEMENT").replace("2ND SUPP","SECOND_SUPPLEMENT").replace("EXECUTE","EXECUTION").trim()]||"LEAD"}static notifyPhaseChange(e,t,r){t!==r&&(console.log("\ud83d\udd04 Phase change for project ".concat(e.projectNumber,": ").concat(t," \u2192 ").concat(r)),"undefined"!==typeof window&&window.dispatchEvent(new CustomEvent("workflowPhaseChange",{detail:{project:e,oldPhase:t,newPhase:r}})))}static calculateTradeBreakdown(e,t,r,n){if(!e)return[];if(e.workflowTrackers&&e.workflowTrackers.length>0)return this.calculateRealMultipleWorkflowBreakdown(e.workflowTrackers);if(e.currentWorkflowItem){const n=r>0?Math.round(t.length/r*100):0;return[{name:e.projectType||e.type||"Roofing",laborProgress:n,materialsDelivered:this.estimateMaterialsDelivered(e,n),completedItems:t.length,totalItems:r,isMainTrade:!0}]}const a=this.getProjectTypes(e);if(1===a.length){const n=r>0?Math.round(t.length/r*100):0;return[{name:a[0],laborProgress:n,materialsDelivered:this.estimateMaterialsDelivered(e,n),completedItems:t.length,totalItems:r,isMainTrade:!0}]}return this.calculateMultipleTradeBreakdown(a,t,r,n,e)}static calculateRealMultipleWorkflowBreakdown(e){const t=[];return e.forEach((e,r)=>{const n=this.getWorkflowTypeDisplayName(e.workflowType),a=e.completedItems||[],s=e.totalLineItems||this.estimateTotalLineItems(),o=s>0?Math.round(a.length/s*100):0;t.push({name:e.tradeName||n,laborProgress:o,materialsDelivered:this.estimateMaterialsDelivered({workflowType:e.workflowType},o),completedItems:a.length,totalItems:s,isMainTrade:e.isMainWorkflow||0===r,workflowType:e.workflowType,trackerId:e.id})}),t}static getWorkflowTypeDisplayName(e){return{ROOFING:"Roofing",GUTTERS:"Gutters",INTERIOR_PAINT:"Interior Paint",WATER_LEAK:"Water Leak",MOLD:"Mold",DECKS:"Decks",REPAIR_EXTERIOR:"Repair - Exterior",REPAIR_INTERIOR:"Repair - Interior",WINDOWS:"Windows",SIDING:"Siding",FENCE:"Fence",KITCHEN_REMODEL:"Kitchen Remodel",BATHROOM_RENOVATION:"Bathroom Renovation",FLOORING:"Flooring",PAINTING:"Painting",ELECTRICAL_WORK:"Electrical Work",PLUMBING:"Plumbing",HVAC:"HVAC",LANDSCAPING:"Landscaping",OTHER:"Other",GENERAL:"General"}[e]||e}static getProjectTypes(e){const t=[];return e.projectType?t.push(e.projectType):e.type&&t.push(e.type),e.trades&&Array.isArray(e.trades)&&e.trades.forEach(e=>{e.name&&!t.includes(e.name)&&t.push(e.name)}),0===t.length&&t.push("General"),t}static calculateMultipleTradeBreakdown(e,t,r,n,a){const s=[],o=Math.ceil(r/e.length);e.forEach((e,n)=>{const i=n*o,l=Math.min((n+1)*o,r)-i;let c=0;if(t&&t.length>0){const e=l/r;c=Math.round(t.length*e),c=Math.min(c,l)}const d=l>0?Math.round(c/l*100):0;s.push({name:e,laborProgress:d,materialsDelivered:this.estimateMaterialsDelivered(a,d),completedItems:c,totalItems:l,isMainTrade:0===n})});const i=s.reduce((e,t)=>e+t.completedItems,0),l=t?t.length:0;if(i!==l&&s.length>0){const e=l-i;s[0].completedItems=Math.max(0,s[0].completedItems+e),s[0].laborProgress=s[0].totalItems>0?Math.round(s[0].completedItems/s[0].totalItems*100):0}return s}static estimateMaterialsDelivered(e,t){return e.materialsDeliveryStart||void 0!==e.materialsDelivered?e.materialsDelivered||Boolean(e.materialsDeliveryStart):t>=20}static calculateProgress(e){return console.warn("WorkflowProgressService.calculateProgress is deprecated. Use calculateProjectProgress instead."),this.calculateProjectProgress(e)}};var qn,Vn,Hn,Gn,Kn,Jn,Yn,Xn,Qn,Zn,$n,ea,ta,ra,na,aa,sa=(qn=new WeakMap,Vn=new WeakMap,Hn=new WeakMap,Gn=new WeakMap,Kn=new WeakMap,Jn=new WeakMap,Yn=new WeakMap,Xn=new WeakMap,Qn=new WeakMap,Zn=new WeakMap,$n=new WeakMap,ea=new WeakMap,ta=new WeakMap,ra=new WeakMap,na=new WeakMap,aa=new WeakSet,class extends Te{constructor(e,t){super(),Ne(this,aa),Q(this,qn,void 0),Q(this,Vn,void 0),Q(this,Hn,void 0),Q(this,Gn,void 0),Q(this,Kn,void 0),Q(this,Jn,void 0),Q(this,Yn,void 0),Q(this,Xn,void 0),Q(this,Qn,void 0),Q(this,Zn,void 0),Q(this,$n,void 0),Q(this,ea,void 0),Q(this,ta,void 0),Q(this,ra,void 0),Q(this,na,new Set),this.options=t,ee(qn,this,e),ee(Xn,this,null),ee(Yn,this,Me()),this.options.experimental_prefetchInRender||$(Yn,this).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&($(Vn,this).addObserver(this),fa($(Vn,this),this.options)?Z(aa,this,oa).call(this):this.updateResult(),Z(aa,this,da).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ga($(Vn,this),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ga($(Vn,this),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Z(aa,this,ua).call(this),Z(aa,this,ha).call(this),$(Vn,this).removeObserver(this)}setOptions(e){const t=this.options,r=$(Vn,this);if(this.options=$(qn,this).defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!==typeof this.options.enabled&&"function"!==typeof this.options.enabled&&"boolean"!==typeof oe(this.options.enabled,$(Vn,this)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Z(aa,this,ma).call(this),$(Vn,this).setOptions(this.options),t._defaulted&&!me(this.options,t)&&$(qn,this).getQueryCache().notify({type:"observerOptionsUpdated",query:$(Vn,this),observer:this});const n=this.hasListeners();n&&va($(Vn,this),r,this.options,t)&&Z(aa,this,oa).call(this),this.updateResult(),!n||$(Vn,this)===r&&oe(this.options.enabled,$(Vn,this))===oe(t.enabled,$(Vn,this))&&se(this.options.staleTime,$(Vn,this))===se(t.staleTime,$(Vn,this))||Z(aa,this,ia).call(this);const a=Z(aa,this,la).call(this);!n||$(Vn,this)===r&&oe(this.options.enabled,$(Vn,this))===oe(t.enabled,$(Vn,this))&&a===$(ra,this)||Z(aa,this,ca).call(this,a)}getOptimisticResult(e){const t=$(qn,this).getQueryCache().build($(qn,this),e),r=this.createResult(t,e);return function(e,t){if(!me(e.getCurrentResult(),t))return!0;return!1}(this,r)&&(ee(Gn,this,r),ee(Jn,this,this.options),ee(Kn,this,$(Vn,this).state)),r}getCurrentResult(){return $(Gn,this)}trackResult(e,t){return new Proxy(e,{get:(e,r)=>(this.trackProp(r),null===t||void 0===t||t(r),Reflect.get(e,r))})}trackProp(e){$(na,this).add(e)}getCurrentQuery(){return $(Vn,this)}refetch(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(e),e));return this.fetch((0,Y.A)({},t))}fetchOptimistic(e){const t=$(qn,this).defaultQueryOptions(e),r=$(qn,this).getQueryCache().build($(qn,this),t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){var t;return Z(aa,this,oa).call(this,(0,Y.A)((0,Y.A)({},e),{},{cancelRefetch:null===(t=e.cancelRefetch)||void 0===t||t})).then(()=>(this.updateResult(),$(Gn,this)))}createResult(e,t){const r=$(Vn,this),n=this.options,a=$(Gn,this),s=$(Kn,this),o=$(Jn,this),i=e!==r?e.state:$(Hn,this),{state:l}=e;let c,d=(0,Y.A)({},l),u=!1;if(t._optimisticResults){const a=this.hasListeners(),s=!a&&fa(e,t),o=a&&va(e,r,t,n);(s||o)&&(d=(0,Y.A)((0,Y.A)({},d),et(l.data,e.options))),"isRestoring"===t._optimisticResults&&(d.fetchStatus="idle")}let{error:h,errorUpdatedAt:m,status:p}=d;c=d.data;let f=!1;if(void 0!==t.placeholderData&&void 0===c&&"pending"===p){let e;var g;if(null!==a&&void 0!==a&&a.isPlaceholderData&&t.placeholderData===(null===o||void 0===o?void 0:o.placeholderData))e=a.data,f=!0;else e="function"===typeof t.placeholderData?t.placeholderData(null===(g=$($n,this))||void 0===g?void 0:g.state.data,$($n,this)):t.placeholderData;void 0!==e&&(p="success",c=ve(null===a||void 0===a?void 0:a.data,e,t),u=!0)}if(t.select&&void 0!==c&&!f)if(a&&c===(null===s||void 0===s?void 0:s.data)&&t.select===$(Qn,this))c=$(Zn,this);else try{ee(Qn,this,t.select),c=t.select(c),c=ve(null===a||void 0===a?void 0:a.data,c,t),ee(Zn,this,c),ee(Xn,this,null)}catch(N){ee(Xn,this,N)}$(Xn,this)&&(h=$(Xn,this),c=$(Zn,this),m=Date.now(),p="error");const v="fetching"===d.fetchStatus,x="pending"===p,b="error"===p,y=x&&v,w=void 0!==c,j={status:p,fetchStatus:d.fetchStatus,isPending:x,isSuccess:"success"===p,isError:b,isInitialLoading:y,isLoading:y,data:c,dataUpdatedAt:d.dataUpdatedAt,error:h,errorUpdatedAt:m,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>i.dataUpdateCount||d.errorUpdateCount>i.errorUpdateCount,isFetching:v,isRefetching:v&&!x,isLoadingError:b&&!w,isPaused:"paused"===d.fetchStatus,isPlaceholderData:u,isRefetchError:b&&w,isStale:xa(e,t),refetch:this.refetch,promise:$(Yn,this),isEnabled:!1!==oe(t.enabled,e)};if(this.options.experimental_prefetchInRender){const t=e=>{"error"===j.status?e.reject(j.error):void 0!==j.data&&e.resolve(j.data)},n=()=>{const e=ee(Yn,this,j.promise=Me());t(e)},a=$(Yn,this);switch(a.status){case"pending":e.queryHash===r.queryHash&&t(a);break;case"fulfilled":"error"!==j.status&&j.data===a.value||n();break;case"rejected":"error"===j.status&&j.error===a.reason||n()}}return j}updateResult(){const e=$(Gn,this),t=this.createResult($(Vn,this),this.options);if(ee(Kn,this,$(Vn,this).state),ee(Jn,this,this.options),void 0!==$(Kn,this).data&&ee($n,this,$(Vn,this)),me(t,e))return;ee(Gn,this,t);Z(aa,this,pa).call(this,{listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,r="function"===typeof t?t():t;if("all"===r||!r&&!$(na,this).size)return!0;const n=new Set(null!==r&&void 0!==r?r:$(na,this));return this.options.throwOnError&&n.add("error"),Object.keys($(Gn,this)).some(t=>{const r=t;return $(Gn,this)[r]!==e[r]&&n.has(r)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Z(aa,this,da).call(this)}});function oa(e){Z(aa,this,ma).call(this);let t=$(Vn,this).fetch(this.options,e);return null!==e&&void 0!==e&&e.throwOnError||(t=t.catch(re)),t}function ia(){Z(aa,this,ua).call(this);const e=se(this.options.staleTime,$(Vn,this));if(te||$(Gn,this).isStale||!ne(e))return;const t=ae($(Gn,this).dataUpdatedAt,e);ee(ea,this,setTimeout(()=>{$(Gn,this).isStale||this.updateResult()},t+1))}function la(){var e;return null!==(e="function"===typeof this.options.refetchInterval?this.options.refetchInterval($(Vn,this)):this.options.refetchInterval)&&void 0!==e&&e}function ca(e){Z(aa,this,ha).call(this),ee(ra,this,e),!te&&!1!==oe(this.options.enabled,$(Vn,this))&&ne($(ra,this))&&0!==$(ra,this)&&ee(ta,this,setInterval(()=>{(this.options.refetchIntervalInBackground||Le.isFocused())&&Z(aa,this,oa).call(this)},$(ra,this)))}function da(){Z(aa,this,ia).call(this),Z(aa,this,ca).call(this,Z(aa,this,la).call(this))}function ua(){$(ea,this)&&(clearTimeout($(ea,this)),ee(ea,this,void 0))}function ha(){$(ta,this)&&(clearInterval($(ta,this)),ee(ta,this,void 0))}function ma(){const e=$(qn,this).getQueryCache().build($(qn,this),this.options);if(e===$(Vn,this))return;const t=$(Vn,this);ee(Vn,this,e),ee(Hn,this,e.state),this.hasListeners()&&(null===t||void 0===t||t.removeObserver(this),e.addObserver(this))}function pa(e){Ie.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e($(Gn,this))}),$(qn,this).getQueryCache().notify({query:$(Vn,this),type:"observerResultsUpdated"})})}function fa(e,t){return function(e,t){return!1!==oe(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||void 0!==e.state.data&&ga(e,t,t.refetchOnMount)}function ga(e,t,r){if(!1!==oe(t.enabled,e)&&"static"!==se(t.staleTime,e)){const n="function"===typeof r?r(e):r;return"always"===n||!1!==n&&xa(e,t)}return!1}function va(e,t,r,n){return(e!==t||!1===oe(n.enabled,e))&&(!r.suspense||"error"!==e.state.status)&&xa(e,r)}function xa(e,t){return!1!==oe(t.enabled,e)&&e.isStaleByTime(se(t.staleTime,e))}function ba(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var ya,wa,ja,Na,Sa,ka=o.createContext(ba()),Aa=o.createContext(!1),Ca=(Aa.Provider,(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()}));function Ea(e,t,r){var n,a,s,i;const l=o.useContext(Aa),c=o.useContext(ka),d=Ct(r),u=d.defaultQueryOptions(e);null===(n=d.getDefaultOptions().queries)||void 0===n||null===(a=n._experimental_beforeQuery)||void 0===a||a.call(n,u),u._optimisticResults=l?"isRestoring":"optimistic",(e=>{if(e.suspense){const t=e=>"static"===e?e:Math.max(null!==e&&void 0!==e?e:1e3,1e3),r=e.staleTime;e.staleTime="function"===typeof r?function(){return t(r(...arguments))}:t(r),"number"===typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,1e3))}})(u),((e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))})(u,c),(e=>{o.useEffect(()=>{e.clearReset()},[e])})(c);const h=!d.getQueryCache().get(u.queryHash),[m]=o.useState(()=>new t(d,u)),p=m.getOptimisticResult(u),f=!l&&!1!==e.subscribed;if(o.useSyncExternalStore(o.useCallback(e=>{const t=f?m.subscribe(Ie.batchCalls(e)):re;return m.updateResult(),t},[m,f]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),o.useEffect(()=>{m.setOptions(u)},[u,m]),((e,t)=>(null===e||void 0===e?void 0:e.suspense)&&t.isPending)(u,p))throw Ca(u,m,c);if((e=>{let{result:t,errorResetBoundary:r,throwOnError:n,query:a,suspense:s}=e;return t.isError&&!r.isReset()&&!t.isFetching&&a&&(s&&void 0===t.data||je(n,[t.error,a]))})({result:p,errorResetBoundary:c,throwOnError:u.throwOnError,query:d.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw p.error;if(null===(s=d.getDefaultOptions().queries)||void 0===s||null===(i=s._experimental_afterQuery)||void 0===i||i.call(s,u,p),u.experimental_prefetchInRender&&!te&&((e,t)=>e.isLoading&&e.isFetching&&!t)(p,l)){var g;const e=h?Ca(u,m,c):null===(g=d.getQueryCache().get(u.queryHash))||void 0===g?void 0:g.promise;null===e||void 0===e||e.catch(re).finally(()=>{m.updateResult()})}return u.notifyOnChangeProps?p:m.trackResult(p)}function Pa(e,t){return Ea(e,sa,t)}var _a=(ya=new WeakMap,wa=new WeakMap,ja=new WeakMap,Na=new WeakMap,Sa=new WeakSet,class extends Te{constructor(e,t){super(),Ne(this,Sa),Q(this,ya,void 0),Q(this,wa,void 0),Q(this,ja,void 0),Q(this,Na,void 0),ee(ya,this,e),this.setOptions(t),this.bindMethods(),Z(Sa,this,Ia).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var t;const r=this.options;this.options=$(ya,this).defaultMutationOptions(e),me(this.options,r)||$(ya,this).getMutationCache().notify({type:"observerOptionsUpdated",mutation:$(ja,this),observer:this}),null!==r&&void 0!==r&&r.mutationKey&&this.options.mutationKey&&de(r.mutationKey)!==de(this.options.mutationKey)?this.reset():"pending"===(null===(t=$(ja,this))||void 0===t?void 0:t.state.status)&&$(ja,this).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(null===(e=$(ja,this))||void 0===e||e.removeObserver(this))}onMutationUpdate(e){Z(Sa,this,Ia).call(this),Z(Sa,this,Ta).call(this,e)}getCurrentResult(){return $(wa,this)}reset(){var e;null===(e=$(ja,this))||void 0===e||e.removeObserver(this),ee(ja,this,void 0),Z(Sa,this,Ia).call(this),Z(Sa,this,Ta).call(this)}mutate(e,t){var r;return ee(Na,this,t),null===(r=$(ja,this))||void 0===r||r.removeObserver(this),ee(ja,this,$(ya,this).getMutationCache().build($(ya,this),this.options)),$(ja,this).addObserver(this),$(ja,this).execute(e)}});function Ia(){var e,t;const r=null!==(e=null===(t=$(ja,this))||void 0===t?void 0:t.state)&&void 0!==e?e:{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0};ee(wa,this,(0,Y.A)((0,Y.A)({},r),{},{isPending:"pending"===r.status,isSuccess:"success"===r.status,isError:"error"===r.status,isIdle:"idle"===r.status,mutate:this.mutate,reset:this.reset}))}function Ta(e){Ie.batch(()=>{if($(Na,this)&&this.hasListeners()){const c=$(wa,this).variables,d=$(wa,this).context;var t,r,n,a;if("success"===(null===e||void 0===e?void 0:e.type))null===(t=(r=$(Na,this)).onSuccess)||void 0===t||t.call(r,e.data,c,d),null===(n=(a=$(Na,this)).onSettled)||void 0===n||n.call(a,e.data,null,c,d);else if("error"===(null===e||void 0===e?void 0:e.type)){var s,o,i,l;null===(s=(o=$(Na,this)).onError)||void 0===s||s.call(o,e.error,c,d),null===(i=(l=$(Na,this)).onSettled)||void 0===i||i.call(l,void 0,e.error,c,d)}}this.listeners.forEach(e=>{e($(wa,this))})})}function La(e,t){const r=Ct(t),[n]=o.useState(()=>new _a(r,e));o.useEffect(()=>{n.setOptions(e)},[n,e]);const a=o.useSyncExternalStore(o.useCallback(e=>n.subscribe(Ie.batchCalls(e)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),s=o.useCallback((e,t)=>{n.mutate(e,t).catch(re)},[n]);if(a.error&&je(n.options.throwOnError,[a.error]))throw a.error;return(0,Y.A)((0,Y.A)({},a),{},{mutate:s,mutateAsync:a.mutate})}var Da=r(4505);var Ma=r(7877);const Oa=e=>{let{document:t,isOpen:r,onClose:n}=e;const[a,s]=(0,o.useState)(!0),[i,l]=(0,o.useState)(null),[d,u]=(0,o.useState)(null),[h,m]=(0,o.useState)(null);(0,o.useEffect)(()=>(r&&t&&p(),()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d)}),[r,t]);const p=async()=>{s(!0),l(null);try{var e;console.log("\ud83d\udcc4 Loading document:",t),console.log("\ud83d\udcc4 Document keys:",Object.keys(t||{})),console.log("\ud83d\udcc4 Full document object:",JSON.stringify(t,null,2));const n=null===(e=(t.fileName||t.title||t.name||"").split(".").pop())||void 0===e?void 0:e.toLowerCase(),a=t.mimeType||t.contentType||"";let o="unknown";if(["pdf"].includes(n)||a.includes("pdf")?o="pdf":["jpg","jpeg","png","gif","webp","svg"].includes(n)||a.startsWith("image/")?o="image":["doc","docx"].includes(n)||a.includes("word")||a.includes("document")?o="word":["xls","xlsx"].includes(n)||a.includes("excel")||a.includes("spreadsheet")?o="excel":(["txt","md"].includes(n)||a.includes("text/plain"))&&(o="text"),m(o),t.assetId||t.id){const e=t.assetId||t.id;console.log("\ud83d\udd11 Fetching document using assetId:",e);try{const t=await Ma.assetsService.getViewUrl(e);if(console.log("\u2705 Got presigned view URL from server:",t),null!==t&&void 0!==t&&t.url)return console.log("\u2705 Using presigned URL:",t.url),u(t.url),void s(!1);console.warn("\u26a0\ufe0f No presigned URL returned, trying fallback...")}catch(r){console.error("\u274c Failed to get presigned URL:",r),console.warn("\u26a0\ufe0f Trying direct URL fallback...")}}const i=t.url||t.fileUrl||t.signedUrl||t.streamUrl;if(i&&i.trim()){let e=i;if(i.startsWith("spaces://")){const t=i.replace("spaces://","").split("/"),r=t[0],n=t.slice(1).join("/");e="https://".concat(r,".nyc3.digitaloceanspaces.com/").concat(n),console.log("\ud83d\udd04 Converted spaces:// to HTTPS:",i,"->",e)}else if(!i.startsWith("http://")&&!i.startsWith("https://")&&!i.startsWith("blob:")){const t=window.location.origin;e=i.startsWith("/")?"".concat(t).concat(i):"".concat(t,"/").concat(i)}return console.log("\u2705 Using direct document URL:",e),u(e),void s(!1)}throw new Error("Unable to load document. No valid URL or asset ID found.")}catch(r){console.error("Error loading document:",r),l(r.message||"Failed to load document"),s(!1)}};if(!r)return null;if("undefined"===typeof window||!window.document||!window.document.body)return null;const f=(0,kt.jsx)("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center bg-black/70",onClick:e=>{e.target===e.currentTarget&&n()},style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:(0,kt.jsxs)("div",{className:"relative w-[90vw] h-[90vh] max-w-[1600px] bg-white rounded-xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 bg-[#F8FAFC] text-white border-b border-slate-600 shadow-lg",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center border border-white/20",children:(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold",children:(null===t||void 0===t?void 0:t.title)||(null===t||void 0===t?void 0:t.fileName)||(null===t||void 0===t?void 0:t.name)||"Document Viewer"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[(null===t||void 0===t?void 0:t.fileSize)&&(0,kt.jsxs)("span",{className:"text-sm text-slate-300",children:[(t.fileSize/1024).toFixed(1)," KB"]}),h&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-md text-xs font-semibold bg-white text-white uppercase tracking-wider border border-white/20",children:h})]})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("button",{onClick:()=>{d&&window.open(d,"_blank","noopener,noreferrer")},className:"inline-flex items-center gap-2 px-4 py-2 bg-white text-white text-sm font-medium rounded-lg hover:bg-white transition-all duration-200 border border-white/20",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Open in New Tab"]}),(0,kt.jsx)("button",{onClick:n,className:"p-2 hover:bg-white rounded-lg transition-all duration-200 group",children:(0,kt.jsx)("svg",{className:"w-6 h-6 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,kt.jsxs)("div",{className:"h-[calc(100%-5rem)] overflow-hidden bg-[#F8FAFC]",children:[a&&(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,kt.jsxs)("div",{className:"relative mb-6",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-slate-200 border-t-blue-600"}),(0,kt.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]}),(0,kt.jsx)("p",{className:"text-gray-700 text-lg font-medium",children:"Loading document..."}),(0,kt.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"Please wait while we prepare your file"})]}),i&&(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,kt.jsx)("div",{className:"w-20 h-20 mb-6 bg-red-100 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,kt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-3",children:"Failed to Load Document"}),(0,kt.jsx)("p",{className:"text-gray-600 mb-6 max-w-md text-center",children:i}),(0,kt.jsx)("button",{onClick:n,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:"Close"})]}),!a&&!i&&d&&(0,kt.jsxs)(kt.Fragment,{children:["pdf"===h&&(0,kt.jsxs)("div",{className:"w-full h-full relative bg-white",children:[(0,kt.jsx)("iframe",{src:d,className:"w-full h-full border-0",title:(null===t||void 0===t?void 0:t.title)||"PDF Document",onLoad:()=>s(!1)}),(0,kt.jsxs)("div",{className:"absolute top-4 right-4 flex gap-2",children:[(0,kt.jsxs)("button",{onClick:()=>{const e=t.querySelector("iframe");e&&e.contentWindow.print()},className:"px-4 py-2.5 bg-white text-gray-700 text-sm font-medium rounded-lg hover:bg-white transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 border border-gray-200",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print"]}),(0,kt.jsxs)("a",{href:d,download:(null===t||void 0===t?void 0:t.fileName)||(null===t||void 0===t?void 0:t.title)||"document.pdf",className:"px-4 py-2.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 transform hover:-translate-y-0.5",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]})]}),"image"===h&&(0,kt.jsx)("div",{className:"flex items-center justify-center h-full p-8 bg-gray-100",children:(0,kt.jsxs)("div",{className:"relative max-w-full max-h-full",children:[(0,kt.jsx)("img",{src:d,alt:(null===t||void 0===t?void 0:t.title)||"Document",className:"max-w-full max-h-full object-contain rounded-lg shadow-lg",onLoad:()=>s(!1)}),(0,kt.jsx)("div",{className:"absolute top-4 right-4 flex gap-2",children:(0,kt.jsxs)("button",{onClick:()=>{const e=t.querySelector("img");if(e){const r=t.createElement("a");r.href=e.src,r.download=(null===t||void 0===t?void 0:t.fileName)||(null===t||void 0===t?void 0:t.title)||"image",r.click()}},className:"px-3 py-2 bg-white bg-opacity-90 text-gray-700 text-sm font-medium rounded-lg hover:bg-opacity-100 transition-colors shadow-lg flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})})]})}),"text"===h&&(0,kt.jsx)("div",{className:"h-full overflow-auto bg-white",children:(0,kt.jsx)("div",{className:"p-8",children:(0,kt.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,kt.jsx)("pre",{className:"whitespace-pre-wrap font-mono text-sm text-gray-800 bg-gray-50 p-6 rounded-lg border",children:"Loading text content..."})})})}),["word","excel","unknown"].includes(h)&&(0,kt.jsx)("div",{className:"flex flex-col items-center justify-center h-full p-8 bg-[#F8FAFC]",children:(0,kt.jsxs)("div",{className:"text-center max-w-md",children:[(0,kt.jsx)("div",{className:"w-24 h-24 mb-6 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto",children:(0,kt.jsx)("svg",{className:"w-12 h-12 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),(0,kt.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mb-3",children:(null===t||void 0===t?void 0:t.title)||(null===t||void 0===t?void 0:t.fileName)||"Document"}),(0,kt.jsx)("p",{className:"text-gray-600 mb-8 text-lg leading-relaxed",children:"This file type cannot be previewed in the browser. Download it to view the content."}),(0,kt.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,kt.jsxs)("a",{href:d,download:(null===t||void 0===t?void 0:t.fileName)||(null===t||void 0===t?void 0:t.title)||"document",className:"px-8 py-4 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center justify-center gap-3 text-lg font-semibold shadow-lg",children:[(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download File"]}),(0,kt.jsxs)("button",{onClick:()=>window.open(d,"_blank","noopener,noreferrer"),className:"px-8 py-4 border-2 border-blue-600 text-blue-600 rounded-xl hover:bg-blue-50 transition-colors flex items-center justify-center gap-3 text-lg font-semibold",children:[(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Open in New Tab"]})]})]})})]})]})]})});return c.createPortal(f,window.document.body)},Ra=e=>{var t,r,n,a,s,i,l,c,d,u,h,m,p,f,g,v,x,b,y,w,j;let{activity:N,onProjectSelect:S,projects:k,colorMode:A,onQuickReply:C,isExpanded:E,onToggleExpansion:P,useRealData:_=!1,sourceSection:I="Project Messages",onDelete:T=null,isDeleting:L=!1}=e;const[D,M]=(0,o.useState)(!1),O=void 0!==E?E:D,[R,F]=(0,o.useState)(null),[U,B]=(0,o.useState)(!1),[z,W]=(0,o.useState)(!1),[q,V]=(0,o.useState)(""),H=(0,o.useRef)(null),G=null===k||void 0===k?void 0:k.find(e=>e&&e.id===N.projectId),{data:K,isLoading:J,error:X}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{page:r=1,limit:n=20,includeReplies:a=!0,messageType:s,author:o,search:i}=t;return Pa({queryKey:["projectMessages",e,{page:r,limit:n,includeReplies:a,messageType:s,author:o,search:i}],queryFn:async()=>{const t=new URLSearchParams({page:r.toString(),limit:n.toString(),includeReplies:a.toString()});return s&&t.append("messageType",s),o&&t.append("author",o),i&&t.append("search",i),(await Da.default.get("/project-messages/".concat(e,"?").concat(t))).data},enabled:!!e,staleTime:3e4,refetchOnWindowFocus:!1})}(N.projectId,{limit:10,includeReplies:!0}),Q=(()=>{const e=Ct();return La({mutationFn:async e=>{let{projectId:t,content:r,subject:n,priority:a="MEDIUM",parentMessageId:s}=e;return(await Da.default.post("/project-messages/".concat(t),{content:r,subject:n,priority:a,parentMessageId:s})).data},onSuccess:(t,r)=>{e.invalidateQueries(["projectMessages",r.projectId]),e.invalidateQueries(["activities"])}})})(),Z=((()=>{const e=Ct();La({mutationFn:async e=>(await Da.default.patch("/project-messages/".concat(e,"/read"))).data,onSuccess:()=>{e.invalidateQueries(["projectMessages"])}})})(),e=>{const t=new Date(e);return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})+", "+t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),$=(0,o.useMemo)(()=>{var e;if(_&&(null===K||void 0===K||null===(e=K.data)||void 0===e?void 0:e.length)>0){const e=K.data.flatMap(e=>{var t;return[{id:e.id,user:e.author?"".concat(e.author.firstName," ").concat(e.author.lastName):e.authorName||"Unknown User",comment:e.content,timestamp:e.createdAt,recipients:e.recipients||[]},...(null===(t=e.replies)||void 0===t?void 0:t.map(e=>({id:e.id,user:e.author?"".concat(e.author.firstName," ").concat(e.author.lastName):e.authorName||"Unknown User",comment:e.content,timestamp:e.createdAt,recipients:e.recipients||[]})))||[]]});return e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))}return(()=>{const e=["Sarah Owner","Mike Rodriguez","Jennifer Williams","David Chen"],t=["Project is progressing well. Materials arrived on schedule.","Customer has approved the color selection.","Inspection completed successfully. Moving to next phase.","Weather delays expected for tomorrow. Adjusting timeline.","Quality check passed. Ready for final review.","Customer meeting scheduled for Friday at 2 PM.","All permits have been approved and filed.","Updated project timeline shared with team."],r=[],n=Math.floor(5*Math.random())+2;for(let a=0;a<n;a++){const n=e[Math.floor(Math.random()*e.length)],s=t[Math.floor(Math.random()*t.length)],o=Math.floor(7*Math.random()),i=Math.floor(24*Math.random()),l=new Date(Date.now()-24*o*60*60*1e3-60*i*60*1e3);r.push({id:"msg_".concat(a),user:n,comment:s,timestamp:l.toISOString()})}return r.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))})()},[N.id,_,K]),ee=$[0],te=(null===G||void 0===G?void 0:G.projectNumber)||N.projectNumber||"12345",re=(null===G||void 0===G||null===(t=G.customer)||void 0===t?void 0:t.primaryName)||(null===G||void 0===G||null===(r=G.client)||void 0===r?void 0:r.name)||(null===G||void 0===G?void 0:G.clientName)||(null===G||void 0===G?void 0:G.projectName)||N.projectName||"Primary Customer",ne=N.subject||"Project Update";console.log("ProjectMessagesCard Debug:",{projectId:N.projectId,project:G,activity:N,projectNumber:te,primaryCustomer:re,subject:ne});const ae=async e=>{if(e.preventDefault(),q.trim())try{_&&N.projectId?await Q.mutateAsync({projectId:N.projectId,content:q.trim(),subject:"Re: ".concat(ne),priority:"MEDIUM"}):C&&C({projectId:N.projectId,projectNumber:te,primaryCustomer:re,subject:ne,message:q.trim(),replyToActivity:N}),V(""),W(!1)}catch(t){console.error("Failed to send quick reply:",t)}},se=()=>{V(""),W(!1)},oe=Wn.getProjectPhase(G,N),[ie,le]=(0,o.useState)(!1),ce=(0,o.useRef)(null),de=(0,o.useRef)(null);return(0,o.useEffect)(()=>{const e=e=>{ie&&de.current&&!de.current.contains(e.target)&&ce.current&&!ce.current.contains(e.target)&&le(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ie]),(0,kt.jsxs)("div",{className:"".concat(A?"bg-[#1e293b] hover:bg-[#232b4d] border-gray-600":"bg-white hover:bg-gray-50 border-gray-200"," rounded-[12px] shadow-sm border transition-all duration-200 hover:shadow-md cursor-pointer"),onClick:e=>{console.log("\ud83d\uddb1\ufe0f Container clicked, target:",e.target),console.log("\ud83d\uddb1\ufe0f Is button?",e.target.closest('button[type="button"]')),console.log("\ud83d\uddb1\ufe0f Is SVG?",e.target.closest("svg")),console.log("\ud83d\uddb1\ufe0f Is delete action?",e.target.closest('[data-action="delete"]')),console.log("\ud83d\uddb1\ufe0f Is reply action?",e.target.closest('[data-action="reply"]')),e.target.closest('button[type="button"]')||e.target.closest("svg")||e.target.closest('[data-action="delete"]')||e.target.closest('[data-action="reply"]')?console.log("\ud83d\uddb1\ufe0f Clicked on action button, not expanding"):(console.log("\ud83d\uddb1\ufe0f Expanding message"),P?P(N.id):M(!D))},children:[(0,kt.jsxs)("div",{className:"flex items-start gap-1.5 p-1.5",children:[(()=>{const e=(e=>{try{return Wn.getPhaseButtonProps(e||"LEAD")}catch(t){return console.warn("Phase data unavailable for phase:",e,t),{initials:"N",bgColor:"bg-gray-400",textColor:"text-white"}}})(oe);return(0,kt.jsx)("div",{className:"w-5 h-5 ".concat(e.bgColor," ").concat(e.textColor," rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start"),children:e.initials||"N"})})(),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"flex items-center overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-center min-w-0 flex-1",children:[(0,kt.jsx)("button",{className:"text-[9px] font-bold transition-colors hover:underline flex-shrink-0 ".concat(A?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),style:{width:"46px"},onClick:e=>{e.stopPropagation(),console.log("Project Number Clicked:",{project:G,activity:N,projectNumber:te});let t=G;!t&&k&&N.projectId&&(t=k.find(e=>e.id===N.projectId||e.id===parseInt(N.projectId))),t||(t={id:N.projectId,projectNumber:te,projectName:re,customer:{primaryName:re}}),S?(console.log("Navigating to project:",t),S(t,"Project Profile",null,I)):console.error("onProjectSelect is not available")},children:te}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsx)("button",{ref:ce,className:"text-[9px] font-semibold transition-colors hover:underline truncate ".concat(A?"text-gray-300 hover:text-gray-200":"text-gray-700 hover:text-gray-800"),style:{maxWidth:"80px"},onClick:e=>{e.stopPropagation(),le(!ie)},children:re}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),le(!ie)},className:"transform transition-transform duration-200 ".concat(ie?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,kt.jsx)("div",{style:{position:"absolute",left:"140px",width:"200px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap ".concat(A?"text-gray-400":"text-gray-600"),style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1"},children:["Subject: ",ne]})})]})}),(0,kt.jsx)("div",{className:"flex items-baseline gap-0 mt-0 overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-baseline gap-0",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",style:{width:"100px",marginLeft:"9px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap ".concat(A?"text-gray-400":"text-gray-600"),children:["From: ",ee.user]})}),(0,kt.jsx)("div",{style:{position:"absolute",left:"141px",width:"200px"},children:(0,kt.jsx)("span",{className:"text-[9px] font-medium whitespace-nowrap ".concat(A?"text-gray-400":"text-gray-600"),style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1"},children:(()=>{const e=(null===ee||void 0===ee?void 0:ee.recipients)||[];if(0===e.length)return"To: Team";if(1===e.length){const t=e[0],r=t.user?"".concat(t.user.firstName," ").concat(t.user.lastName).trim():"Team Member";return"To: ".concat(r)}if(2===e.length){const t=e.map(e=>e.user?"".concat(e.user.firstName," ").concat(e.user.lastName).trim():"Team Member");return"To: ".concat(t.join(", "))}{const t=e[0].user?"".concat(e[0].user.firstName," ").concat(e[0].user.lastName).trim():"Team Member";return"To: ".concat(t," +").concat(e.length-1," others")}})()})})]})})]}),(0,kt.jsxs)("div",{className:"flex flex-col justify-between items-end",style:{width:"80px",minHeight:"32px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"8px"},children:[N.hasTask&&(0,kt.jsx)("span",{className:"text-[8px] font-bold text-red-500",children:"Task"}),(0,kt.jsx)("div",{style:{width:"36px"}}),(0,kt.jsx)("div",{className:"w-1.5 h-1.5 rounded-full ".concat(A?"bg-blue-400":"bg-blue-500")}),(0,kt.jsx)("span",{className:"text-[9px] font-medium ".concat(A?"text-gray-400":"text-gray-600"),children:$.length})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"8px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",onClick:e=>e.stopPropagation(),children:[console.log("\ud83d\udd0d Checking delete button render:",{onDelete:typeof T,onDeleteFunction:T}),"function"===typeof T&&(0,kt.jsx)("button",{type:"button","data-action":"delete",style:{zIndex:10,position:"relative"},onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("\ud83d\uddd1\ufe0f Delete button clicked for message:",N.id),console.log("\ud83d\uddd1\ufe0f onDelete function:",typeof T,T),console.log("\ud83d\uddd1\ufe0f isDeleting:",L),L||"function"!==typeof T?console.log("\ud83d\uddd1\ufe0f Not calling onDelete - isDeleting:",L,"onDelete type:",typeof T):(console.log("\ud83d\uddd1\ufe0f Calling onDelete function"),T())},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onMouseUp:e=>{e.preventDefault(),e.stopPropagation()},disabled:L,className:"p-2 rounded transition-colors flex-shrink-0 border ".concat(L?"text-gray-400 cursor-not-allowed border-gray-300":A?"text-gray-400 hover:text-red-400 hover:bg-red-900/20 border-gray-600 hover:border-red-400":"text-gray-400 hover:text-red-600 hover:bg-red-50 border-gray-300 hover:border-red-400"),title:"Delete message",children:L?(0,kt.jsxs)("svg",{className:"w-2.5 h-2.5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8",strokeWidth:"4",strokeLinecap:"round"})]}):(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2h-4a2 2 0 00-2 2m6 0H9"})})}),(0,kt.jsx)("button",{type:"button","data-action":"reply",onClick:e=>{e.stopPropagation(),!O&&P&&P(),W(!z),z||setTimeout(()=>{H.current&&H.current.focus()},100)},className:"p-1 rounded transition-colors ".concat(z?A?"bg-[var(--color-primary-blueprint-blue)] text-white":"bg-blue-500 text-white":A?"bg-gray-700 text-gray-300 hover:bg-[var(--color-primary-blueprint-blue)] hover:text-white":"bg-gray-100 text-gray-600 hover:bg-blue-500 hover:text-white"),title:"Quick Reply",children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})})]}),(0,kt.jsx)("span",{className:"text-[8px] whitespace-nowrap ".concat("text-gray-500"),children:Z(ee.timestamp)})]})]})]}),ie&&(0,kt.jsx)("div",{className:"relative",children:(0,kt.jsxs)("div",{ref:de,className:"absolute top-full left-0 z-50 mt-1 w-80 rounded-lg shadow-lg border ".concat(A?"bg-slate-800/95 border-slate-600/50 shadow-black/20":"bg-white border-gray-200/50 shadow-gray-900/10"),style:{animation:"fadeIn 0.15s ease-out"},children:[(0,kt.jsx)("div",{className:"px-4 py-3 border-b ".concat(A?"border-slate-600/50":"border-gray-200/50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold ".concat(A?"text-white":"text-gray-900"),children:"Customer Information"}),(0,kt.jsx)("button",{onClick:()=>le(!1),className:"p-1 rounded-full transition-colors ".concat(A?"hover:bg-slate-700 text-slate-400 hover:text-slate-200":"hover:bg-gray-100 text-gray-400 hover:text-gray-600"),children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,kt.jsxs)("div",{className:"p-4 space-y-4",children:[(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide ".concat(A?"text-slate-300":"text-gray-600"),children:"Primary Contact"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(A?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(A?"text-white":"text-gray-900"," truncate"),children:(null===G||void 0===G||null===(n=G.customer)||void 0===n?void 0:n.primaryName)||(null===G||void 0===G||null===(a=G.client)||void 0===a?void 0:a.name)||(null===G||void 0===G?void 0:G.clientName)||re})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(A?"bg-green-500/20 text-green-400":"bg-green-100 text-green-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("a",{href:"tel:".concat(((null===G||void 0===G||null===(s=G.customer)||void 0===s?void 0:s.primaryPhone)||(null===G||void 0===G||null===(i=G.client)||void 0===i?void 0:i.phone)||(null===G||void 0===G?void 0:G.clientPhone)||"(555) 123-4567").replace(/[^\d+]/g,"")),className:"text-sm hover:underline transition-colors ".concat(A?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:(null===G||void 0===G||null===(l=G.customer)||void 0===l?void 0:l.primaryPhone)||(null===G||void 0===G||null===(c=G.client)||void 0===c?void 0:c.phone)||(null===G||void 0===G?void 0:G.clientPhone)||"(555) 123-4567"})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(A?"bg-purple-500/20 text-purple-400":"bg-purple-100 text-purple-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("a",{href:"mailto:".concat((null===G||void 0===G||null===(d=G.customer)||void 0===d?void 0:d.primaryEmail)||(null===G||void 0===G||null===(u=G.client)||void 0===u?void 0:u.email)||(null===G||void 0===G?void 0:G.clientEmail)||"customer@email.com"),className:"text-sm hover:underline transition-colors truncate ".concat(A?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:(null===G||void 0===G||null===(h=G.customer)||void 0===h?void 0:h.primaryEmail)||(null===G||void 0===G||null===(m=G.client)||void 0===m?void 0:m.email)||(null===G||void 0===G?void 0:G.clientEmail)||"customer@email.com"})})]})]})]}),((null===G||void 0===G||null===(p=G.customer)||void 0===p?void 0:p.secondaryName)||(null===G||void 0===G||null===(f=G.customer)||void 0===f?void 0:f.secondaryPhone)||(null===G||void 0===G||null===(g=G.customer)||void 0===g?void 0:g.secondaryEmail))&&(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide ".concat(A?"text-slate-300":"text-gray-600"),children:"Secondary Contact"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(null===G||void 0===G||null===(v=G.customer)||void 0===v?void 0:v.secondaryName)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(A?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(A?"text-white":"text-gray-900"," truncate"),children:G.customer.secondaryName})})]}),(null===G||void 0===G||null===(x=G.customer)||void 0===x?void 0:x.secondaryPhone)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(A?"bg-green-500/20 text-green-400":"bg-green-100 text-green-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("a",{href:"tel:".concat(G.customer.secondaryPhone.replace(/[^\d+]/g,"")),className:"text-sm hover:underline transition-colors ".concat(A?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:G.customer.secondaryPhone})})]}),(null===G||void 0===G||null===(b=G.customer)||void 0===b?void 0:b.secondaryEmail)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full ".concat(A?"bg-purple-500/20 text-purple-400":"bg-purple-100 text-purple-600"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("a",{href:"mailto:".concat(G.customer.secondaryEmail),className:"text-sm hover:underline transition-colors truncate ".concat(A?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:G.customer.secondaryEmail})})]})]})]}),((null===G||void 0===G?void 0:G.address)||(null===G||void 0===G||null===(y=G.customer)||void 0===y?void 0:y.address)||(null===G||void 0===G||null===(w=G.client)||void 0===w?void 0:w.address))&&(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide ".concat(A?"text-slate-300":"text-gray-600"),children:"Project Address"}),(0,kt.jsxs)("div",{className:"flex items-start gap-2",children:[(0,kt.jsx)("div",{className:"p-1.5 rounded-full mt-0.5 ".concat(A?"bg-orange-500/20 text-orange-400":"bg-orange-100 text-orange-600"),children:(0,kt.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,kt.jsx)("div",{className:"flex-1 min-w-0",children:(0,kt.jsx)("div",{className:"text-sm leading-relaxed ".concat(A?"text-slate-300":"text-gray-700"),children:((e,t)=>{const r=(null===G||void 0===G?void 0:G.address)||(null===G||void 0===G||null===(e=G.customer)||void 0===e?void 0:e.address)||(null===G||void 0===G||null===(t=G.client)||void 0===t?void 0:t.address)||"Address not available",n=r.split(",");var a;return n.length>=2?(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium",children:null===(a=n[0])||void 0===a?void 0:a.trim()}),(0,kt.jsx)("div",{className:"text-xs opacity-75",children:n.slice(1).join(",").trim()})]}):r})()})})]})]})]})]})}),z&&(0,kt.jsx)("div",{className:"px-4 py-3 border-t ".concat(A?"bg-[#1e293b] border-gray-600":"bg-blue-50 border-blue-200"),children:(0,kt.jsxs)("form",{onSubmit:ae,className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),(0,kt.jsxs)("span",{className:"text-sm font-semibold ".concat(A?"text-white":"text-gray-800"),children:["Quick Reply to ",re]})]}),(0,kt.jsx)("button",{type:"button",onClick:se,className:"p-1 rounded-full hover:bg-gray-200 ".concat(A?"hover:bg-gray-700 text-gray-400":"text-gray-500"),children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"text-xs p-2 rounded ".concat(A?"bg-[#232b4d] text-gray-300":"bg-white text-gray-600"),children:[(0,kt.jsx)("span",{className:"font-medium",children:"Project:"})," ",te," | ",(0,kt.jsx)("span",{className:"font-medium",children:"Subject:"})," ",ne]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("textarea",{ref:H,value:q,onChange:e=>V(e.target.value),placeholder:"Type your quick reply...",className:"flex-1 p-2 border rounded-lg text-sm resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(A?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500"),rows:"2",onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&ae(e)}}),(0,kt.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,kt.jsx)("button",{type:"submit",disabled:!q.trim(),className:"px-3 py-1 rounded-lg text-sm font-medium transition-colors ".concat(q.trim()?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Send"}),(0,kt.jsx)("button",{type:"button",onClick:se,className:"px-3 py-1 rounded-lg text-sm font-medium transition-colors ".concat(A?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Cancel"})]})]}),(0,kt.jsx)("div",{className:"text-xs ".concat(A?"text-gray-400":"text-gray-500"),children:"\xf0\u0178\u2019\xa1 Tip: Press Ctrl+Enter (Cmd+Enter on Mac) to send quickly"})]})}),Array.isArray(null===N||void 0===N||null===(j=N.metadata)||void 0===j?void 0:j.attachments)&&N.metadata.attachments.length>0&&(0,kt.jsx)("div",{className:"px-3 pb-3",children:(0,kt.jsx)("div",{className:"flex flex-col gap-1.5",children:N.metadata.attachments.map((e,t)=>{const r="Activity Feed"===I,n=r?e.originalName||e.title||e.fileName||"Attachment":e.title||e.fileName||e.originalName||"Attachment",a=(e.extension||e.fileType||n.split(".").pop()||"").toString().toLowerCase(),s=["jpg","jpeg","png","gif","webp","svg"].includes(a);return(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-3 border border-gray-200 rounded-lg bg-white px-3 py-2 text-xs shadow-sm hover:shadow transition-shadow",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r?s&&(e.url||e.fileUrl||e.signedUrl)?(0,kt.jsx)("div",{className:"h-8 w-8 rounded-md overflow-hidden border border-gray-200 bg-gray-100 flex-shrink-0",children:(0,kt.jsx)("img",{src:e.url||e.fileUrl||e.signedUrl,alt:n,className:"h-full w-full object-cover"})}):(0,kt.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-md bg-gray-100 text-gray-600 border border-gray-200 flex-shrink-0",children:(0,kt.jsx)("span",{className:"text-[10px] font-semibold uppercase",children:a?a.slice(0,4):"DOC"})}):(0,kt.jsx)("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center flex-shrink-0",children:(0,kt.jsx)("svg",{className:"w-3 h-3 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,kt.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,kt.jsx)("div",{className:"font-medium text-gray-900 truncate",children:n}),!r&&(0,kt.jsx)("div",{className:"text-gray-500 text-xs",children:a.toUpperCase()})]})]}),(0,kt.jsxs)("button",{type:"button",onClick:t=>{t.stopPropagation(),t.preventDefault();const r=[e.fileUrl,e.url,e.signedUrl].find(e=>e&&e.trim()&&"/"!==e&&e.length>1),n=(0,Y.A)((0,Y.A)((0,Y.A)({},e),r?{url:r,fileUrl:r}:{}),{},{fileName:e.originalName||e.fileName||e.title||e.name||"Document",title:e.title||e.originalName||e.fileName||e.name||"Document",fileSize:e.fileSize||e.size,mimeType:e.mimeType||e.contentType,assetId:e.assetId,id:e.assetId||("ASSET"===e.type?e.id:void 0)});console.log("\ud83d\udd35 View button clicked, opening modal with:",n),F(n),B(!0)},className:"inline-flex items-center gap-1 rounded border border-gray-300 px-2 py-1 text-[10px] font-medium text-gray-600 hover:bg-gray-100",children:[(0,kt.jsxs)("svg",{className:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})]},t)})})}),O&&(0,kt.jsx)("div",{className:"px-3 py-3 border-t ".concat(A?"bg-[#1e293b] border-gray-600":"bg-white border-gray-200"),style:A?{}:{backgroundColor:"white"},children:(0,kt.jsx)("div",{className:"space-y-3",children:(0,kt.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-3 ".concat(A?"scrollbar-dark":"scrollbar-light"),children:$.map((e,t)=>(0,kt.jsxs)("div",{className:"".concat(A?"bg-[#374151]":"bg-white"," rounded-lg border ").concat(A?"border-gray-600":"border-gray-200"," p-3 shadow-sm"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white font-bold text-xs shadow-sm ".concat((e.user,"bg-[#F8FAFC]")),children:e.user.split(" ").map(e=>e[0]).join("").substring(0,2)}),(0,kt.jsx)("span",{className:"text-sm font-semibold ".concat(A?"text-gray-200":"text-gray-800"),children:e.user})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-xs ".concat(A?"text-gray-400":"text-gray-500"),children:Z(e.timestamp)}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),!O&&P&&P(),W(!0),V("@".concat(e.user,": ")),setTimeout(()=>{H.current&&H.current.focus()},100)},className:"p-1.5 rounded-full transition-colors ".concat(A?"bg-gray-700 text-gray-300 hover:bg-[var(--color-primary-blueprint-blue)] hover:text-white":"bg-gray-100 text-gray-600 hover:bg-blue-500 hover:text-white"),title:"Reply to ".concat(e.user),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})})]})]}),(0,kt.jsx)("div",{className:"text-sm leading-relaxed ".concat(A?"text-gray-100":"text-gray-800"),children:e.comment})]},e.id))})})}),(0,kt.jsx)(Oa,{isOpen:U,document:R,onClose:()=>{B(!1),F(null)}})]})},Fa=["title","titleId"];function Ua(e,t){let{title:r,titleId:n}=e,a=An(e,Fa);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const Ba=o.forwardRef(Ua),za=e=>{let{value:t,onChange:r,placeholder:n="Type your comment here...",availableUsers:a=[],className:s="",rows:i=2,onKeyPress:l=null}=e;const[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)({top:0,left:0}),[f,g]=(0,o.useState)(0),v=(0,o.useRef)(null),x=(0,o.useRef)(null),b=a.filter(e=>{var t,r,n;return(null===(t=e.firstName)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||(null===(r=e.lastName)||void 0===r?void 0:r.toLowerCase().includes(u.toLowerCase()))||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(u.toLowerCase()))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(u.toLowerCase())}),y=e=>{const n=v.current;if(!n)return;const a=n.selectionStart,s=t.substring(0,a),o=t.substring(a),i=s.lastIndexOf("@"),l=s.substring(0,i),c="@".concat(e.firstName," ").concat(e.lastName);r({target:{value:l+c+o}});const u=l.length+c.length;setTimeout(()=>{n.setSelectionRange(u,u),n.focus()},0),d(!1)};return(0,o.useEffect)(()=>{const e=e=>{x.current&&!x.current.contains(e.target)&&v.current&&!v.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,o.useEffect)(()=>{if(x.current&&c){const e=x.current.children[f];e&&e.scrollIntoView({block:"nearest"})}},[f,c]),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("textarea",{ref:v,value:t,onChange:e=>{const t=e.target.value;r(e);const n=e.target.selectionStart,a=t.substring(0,n),s=a.match(/@(\w*)$/);if(s){const e=s[1];h(e),d(!0),g(0);const t=v.current;if(t){t.getBoundingClientRect();const e=window.getComputedStyle(t),r=parseInt(e.lineHeight)||20,n=a.split("\n").length;p({top:n*r+25,left:0})}}else d(!1)},onKeyDown:e=>{c?"ArrowDown"===e.key?(e.preventDefault(),g(e=>e<b.length-1?e+1:0)):"ArrowUp"===e.key?(e.preventDefault(),g(e=>e>0?e-1:b.length-1)):"Enter"===e.key?(e.preventDefault(),b[f]&&y(b[f])):"Escape"===e.key&&d(!1):l&&l(e)},placeholder:n,className:"w-full px-2 py-1 text-[10px] border border-gray-200 rounded resize-none focus:outline-none focus:border-blue-400 ".concat(s),rows:i}),c&&b.length>0&&(0,kt.jsx)("div",{ref:x,className:"absolute z-50 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto",style:{top:"".concat(m.top,"px"),left:"".concat(m.left,"px"),minWidth:"200px"},children:b.map((e,t)=>(0,kt.jsxs)("div",{onClick:()=>y(e),className:"flex items-center gap-2 px-3 py-2 cursor-pointer hover:bg-gray-50 ".concat(t===f?"bg-blue-50 border-l-2 border-blue-500":""),children:[(0,kt.jsx)("div",{className:"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center",children:(0,kt.jsx)(Ba,{className:"w-4 h-4 text-gray-500"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"text-sm font-medium text-gray-900 truncate",children:[e.firstName," ",e.lastName]}),e.email&&(0,kt.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.email})]})]},e.id))}),c&&0===b.length&&u&&(0,kt.jsx)("div",{className:"absolute z-50 bg-white border border-gray-200 rounded-lg shadow-lg p-3",style:{top:"".concat(m.top,"px"),left:"".concat(m.left,"px"),minWidth:"200px"},children:(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:"No users found"})})]})},Wa=e=>{var t,r,n;let{item:a,projects:s,colorMode:o,onProjectSelect:i,availableUsers:l=[],currentUser:c=null,onDelete:d=null,isDeleting:u=!1}=e;const{state:h,actions:m}=Bn();console.log("TaskItem Debug:",{id:a.id,assignedTo:a.assignedTo,recipient:a.recipient,author:a.author,attendees:a.attendees,assignedToAll:a.assignedToAll,assigneeId:a.assigneeId});const p=h.completedItems.has(a.id),f=h.expandedItems.has(a.id),g=null===s||void 0===s?void 0:s.find(e=>e&&e.id===a.projectId),v=(null===g||void 0===g?void 0:g.projectNumber)||a.projectNumber||"12345",x=(null===g||void 0===g||null===(t=g.customer)||void 0===t?void 0:t.primaryName)||(null===g||void 0===g||null===(r=g.client)||void 0===r?void 0:r.name)||(null===g||void 0===g?void 0:g.clientName)||(null===g||void 0===g?void 0:g.projectName)||a.projectName||"Primary Customer",b=a.subject||"Task",y=()=>{m.toggleExpanded(a.id)},w=()=>{const e=h.commentInputs[a.id];if(null!==e&&void 0!==e&&e.trim()){const t={id:Date.now(),text:e.trim(),user:Vr(c),timestamp:(new Date).toISOString()};m.addComment(a.id,t),m.setShowCommentInput(a.id,!1)}};return(0,kt.jsxs)("div",{className:"bg-white hover:bg-gray-50 border-gray-200 rounded-[12px] shadow-sm border transition-all duration-200 hover:shadow-md cursor-pointer ".concat(p?"opacity-75":""),children:[(0,kt.jsxs)("div",{className:"flex items-start gap-1.5 p-1",onClick:y,children:[(()=>{if(a.projectId&&g){const e=Wn.getProjectPhase(g),t=Wn.getPhaseInitials(e),r=Wn.getPhaseColor(e);return(0,kt.jsx)("div",{className:"w-5 h-5 text-white rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start",style:{backgroundColor:r},children:t})}return(0,kt.jsx)("div",{className:"w-5 h-5 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start",children:"T"})})(),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"flex items-baseline overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-center min-w-0 flex-1",children:[a.projectId&&g?(0,kt.jsx)("button",{className:"text-[9px] font-bold transition-colors hover:underline flex-shrink-0 text-blue-600 hover:text-blue-800",style:{width:"46px",marginLeft:"0px"},onClick:e=>{e.stopPropagation(),i&&i(g,"Project Profile",null,"Messages, Tasks, & Reminders")},children:v}):(0,kt.jsx)("span",{className:"text-[9px] font-bold text-gray-600",style:{width:"46px",marginLeft:"7px"},children:"General"}),a.projectId&&g&&(0,kt.jsx)("div",{className:"flex items-center gap-1",children:(0,kt.jsx)("span",{className:"text-[9px] font-semibold transition-colors truncate text-gray-700 hover:text-gray-800",style:{maxWidth:"80px"},children:x})}),(0,kt.jsx)("div",{style:{position:"absolute",left:"141px",width:"160px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium text-gray-600 truncate",style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:["Subject: ",b]})})]})}),(0,kt.jsx)("div",{className:"flex items-baseline gap-0 -mt-0.5 overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-baseline gap-0",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",style:{width:"100px",marginLeft:"8px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap text-gray-600",children:["From: ",a.author]})}),(0,kt.jsx)("div",{style:{position:"absolute",left:"141px",width:"160px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium text-gray-600 truncate",style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:["To: ",a.assignedTo&&a.assignedTo.trim()?a.assignedTo:a.recipient&&a.recipient.trim()?a.recipient:a.author&&a.author.trim()?a.author:"Unassigned"]})})]})})]}),(0,kt.jsxs)("div",{className:"flex flex-col justify-between items-end",style:{width:"80px",minHeight:"32px",marginRight:"15px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"5px"},children:[(0,kt.jsx)("span",{className:"text-[8px] font-bold text-orange-500",children:"Task"}),(0,kt.jsx)("input",{type:"checkbox",checked:p,onChange:async e=>{e.stopPropagation(),m.toggleCompleted(a.id);try{const e=String(a.id||"").replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");await Da.calendarService.delete(e),console.log("\u2705 Task ".concat(e," completed and removed")),m.removeItem(a.id)}catch(t){console.error("Failed to update task status:",t),m.toggleCompleted(a.id)}},onClick:e=>e.stopPropagation(),className:"w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-1 flex-shrink-0"}),"function"===typeof d&&(0,kt.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),u||d()},disabled:u,className:"p-1 rounded transition-colors flex-shrink-0 ".concat(u?"text-gray-400 cursor-not-allowed":"text-gray-400 hover:text-red-600 hover:bg-red-50"),title:"Delete task",children:u?(0,kt.jsxs)("svg",{className:"w-2.5 h-2.5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8",strokeWidth:"4",strokeLinecap:"round"})]}):(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2h-4a2 2 0 00-2 2m6 0H9"})})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"1px"},children:[(0,kt.jsx)("span",{className:"text-[8px] whitespace-nowrap text-gray-500",children:new Date(a.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric"})+", "+new Date(a.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),(0,kt.jsx)("button",{onClick:y,className:"p-1 rounded transition-colors transform duration-200 hover:bg-gray-100 ".concat(f?"rotate-180":""," text-gray-600"),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),f&&(0,kt.jsx)("div",{className:"px-3 py-3 border-t bg-gray-50 border-gray-200",children:(0,kt.jsxs)("div",{className:"space-y-3",children:[a.content&&(0,kt.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed bg-white p-3 rounded-lg border border-gray-200 shadow-sm",children:a.content}),(0,kt.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold text-gray-700",children:"Comments"}),(0,kt.jsx)("button",{onClick:()=>{m.setShowCommentInput(a.id,!h.showCommentInput[a.id])},className:"text-[9px] text-blue-600 hover:text-blue-700 font-medium",children:h.showCommentInput[a.id]?"Cancel":"Add Comment"})]}),h.comments[a.id]&&h.comments[a.id].length>0&&(0,kt.jsx)("div",{className:"space-y-2 mb-2 max-h-48 overflow-y-auto",children:h.comments[a.id].map(e=>(0,kt.jsx)("div",{className:"bg-gray-50 p-2 rounded border border-gray-100",children:(0,kt.jsxs)("div",{className:"flex items-start justify-between",children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("p",{className:"text-[10px] font-semibold text-gray-700",children:["Comment by: ",e.user]}),(0,kt.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.text})]}),(0,kt.jsx)("span",{className:"text-[9px] text-gray-400 ml-2",children:new Date(e.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]})},e.id))}),h.showCommentInput[a.id]&&(0,kt.jsxs)("div",{className:"mt-2 border-t border-gray-200 pt-2",children:[(0,kt.jsx)(za,{value:h.commentInputs[a.id]||"",onChange:e=>{m.setCommentInputs(a.id,e.target.value)},placeholder:"Type your comment here... Use @ to mention users",availableUsers:l,className:"w-full",rows:2,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())}}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1 mt-1",children:[(0,kt.jsx)("button",{onClick:()=>{m.setShowCommentInput(a.id,!1),m.setCommentInputs(a.id,"")},className:"px-2 py-1 text-[9px] text-gray-600 hover:text-gray-700 font-medium",children:"Cancel"}),(0,kt.jsx)("button",{onClick:w,disabled:!(null!==(n=h.commentInputs[a.id])&&void 0!==n&&n.trim()),className:"px-2 py-1 text-[9px] bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:"Post Comment"})]})]})]}),(0,kt.jsx)("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-200",children:a.projectId&&g&&(0,kt.jsxs)("button",{onClick:()=>{i&&i(g,"Project Profile",null,"Activity Feed")},className:"px-3 py-1.5 text-xs font-medium text-blue-600 border border-blue-600 rounded hover:bg-blue-50 transition-colors flex items-center gap-1",children:[(0,kt.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View Project"]})})]})})]})},qa=e=>{var t,r,n;let{item:a,projects:s,colorMode:o,onProjectSelect:i,availableUsers:l=[],currentUser:c=null,onDelete:d=null,isDeleting:u=!1}=e;const{state:h,actions:m}=Bn(),p=h.completedItems.has(a.id),f=h.expandedItems.has(a.id),g=null===s||void 0===s?void 0:s.find(e=>e&&e.id===a.projectId),v=(null===g||void 0===g?void 0:g.projectNumber)||a.projectNumber||"12345",x=(null===g||void 0===g||null===(t=g.customer)||void 0===t?void 0:t.primaryName)||(null===g||void 0===g||null===(r=g.client)||void 0===r?void 0:r.name)||(null===g||void 0===g?void 0:g.clientName)||(null===g||void 0===g?void 0:g.projectName)||a.projectName||"Primary Customer",b=a.subject||a.title||"Reminder",y=l.find(e=>String(e.id)===String(a.authorId))||{firstName:"System",lastName:"Admin"},w=a.attendeeNames&&Array.isArray(a.attendeeNames)&&a.attendeeNames.length>0?a.attendeeNames.map(e=>({firstName:e.split(" ")[0]||e,lastName:e.split(" ").slice(1).join(" ")||"",isAll:!1})):Array.isArray(a.recipients)?a.recipients.map(e=>"all"===e?{firstName:"All",lastName:"Users",isAll:!0}:l.find(t=>String(t.id)===String(e))).filter(Boolean):[],j=()=>{m.toggleExpanded(a.id)};return(0,kt.jsxs)("div",{className:"bg-white hover:bg-gray-50 border-gray-200 rounded-[12px] shadow-sm border transition-all duration-200 hover:shadow-md cursor-pointer",children:[(0,kt.jsxs)("div",{className:"flex items-start gap-1.5 p-1",onClick:j,children:[(()=>{if(a.projectId&&g){const e=Wn.getProjectPhase(g),t=Wn.getPhaseInitials(e),r=Wn.getPhaseColor(e);return(0,kt.jsx)("div",{className:"w-5 h-5 text-white rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start",style:{backgroundColor:r},children:t})}return(0,kt.jsx)("div",{className:"w-5 h-5 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold text-[9px] shadow-sm flex-shrink-0 self-start",children:"R"})})(),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"flex items-baseline overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-center min-w-0 flex-1",children:[a.projectId&&g?(0,kt.jsx)("button",{className:"text-[9px] font-bold text-blue-600 hover:text-blue-700 hover:underline flex-shrink-0",style:{width:"46px",marginLeft:"2px"},onClick:e=>{e.stopPropagation(),i&&i(g,"Project Profile",null,"Messages, Tasks, & Reminders")},children:v?"#".concat(String(v).padStart(5,"0")):"#00000"}):(0,kt.jsx)("span",{className:"text-[9px] font-bold text-gray-600",style:{width:"46px",marginLeft:"10px"},children:"General"}),(0,kt.jsxs)("div",{className:"flex items-center min-w-0 mx-1.5",children:[a.projectId&&g&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{className:"text-[9px] font-bold text-gray-700 truncate flex-shrink-0",style:{maxWidth:"120px"},children:x}),(0,kt.jsx)("span",{className:"mx-1.5 text-[9px] text-gray-400 flex-shrink-0",children:"|"})]}),(0,kt.jsx)("div",{style:{position:"absolute",left:"140px",width:"160px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium text-gray-600 truncate",style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:["Subject: ",b]})})]})]})}),(0,kt.jsx)("div",{className:"flex items-baseline gap-0 -mt-0.5 overflow-hidden relative",children:(0,kt.jsxs)("div",{className:"flex items-baseline gap-0",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",style:{width:"100px",marginLeft:"11px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap text-gray-600",children:["From: ",y.firstName," ",y.lastName]})}),(0,kt.jsx)("div",{style:{position:"absolute",left:"141px",width:"200px"},children:(0,kt.jsxs)("span",{className:"text-[9px] font-medium whitespace-nowrap text-gray-600",style:{display:"inline-block",verticalAlign:"baseline",lineHeight:"1"},children:["To: ",w.length>0?w[0].isAll?"All Users":"".concat(w[0].firstName," ").concat(w[0].lastName):"No recipients",w.length>1&&!w[0].isAll&&(0,kt.jsxs)("span",{className:"text-[7px] bg-orange-100 text-orange-700 px-1 py-0.5 rounded-full font-medium ml-1",children:["+",w.length-1]})]})})]})})]}),(0,kt.jsxs)("div",{className:"flex flex-col justify-between items-end",style:{width:"80px",minHeight:"32px",marginRight:"20px"},children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"1px"},children:[(0,kt.jsx)("span",{className:"text-[8px] font-bold text-gray-900",children:"Reminder"}),(0,kt.jsx)("input",{type:"checkbox",checked:p,onChange:async e=>{e.stopPropagation(),m.toggleCompleted(a.id);try{let e=String(a.id||"");for(console.log("\ud83d\udd0d Original reminder ID:",e);/^(task_|cal_|activity_|reminder_|msg_)/.test(e);)e=e.replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");console.log("\ud83d\udd0d Extracted real ID:",e),a.alertId?(await Da.workflowAlertsService.completeStep(a.alertId,a.projectId,a.lineItemId||"",""),console.log("\u2705 Reminder alert ".concat(a.alertId," marked as completed"))):(await Da.calendarService.delete(e),console.log("\u2705 Reminder ".concat(e," completed and removed")),m.removeItem(a.id))}catch(t){console.error("Failed to update reminder status:",t),m.toggleCompleted(a.id)}},onClick:e=>e.stopPropagation(),className:"w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-1 flex-shrink-0"}),"function"===typeof d&&(0,kt.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),u||d()},disabled:u,className:"p-1 rounded transition-colors flex-shrink-0 ".concat(u?"text-gray-400 cursor-not-allowed":"text-gray-400 hover:text-red-600 hover:bg-red-50"),title:"Delete reminder",children:u?(0,kt.jsxs)("svg",{className:"w-2.5 h-2.5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8",strokeWidth:"4",strokeLinecap:"round"})]}):(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2h-4a2 2 0 00-2 2m6 0H9"})})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",style:{marginRight:"2px"},children:[(0,kt.jsx)("span",{className:"text-[8px] whitespace-nowrap text-gray-500",children:new Date(a.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric"})+", "+new Date(a.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),(0,kt.jsx)("button",{onClick:j,className:"p-1 rounded transition-colors transform duration-200 hover:bg-gray-100 ".concat(f?"rotate-180":""," text-gray-600"),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),f&&(0,kt.jsxs)("div",{className:"px-3 pb-3 pt-1 border-t border-gray-100",children:[a.content&&(0,kt.jsx)("div",{className:"mb-3",children:(0,kt.jsx)("p",{className:"text-xs text-gray-700 leading-relaxed whitespace-pre-wrap",children:a.content})}),(0,kt.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("h4",{className:"text-[10px] font-semibold text-gray-700",children:"Comments"}),(0,kt.jsx)("button",{onClick:()=>{m.setShowCommentInput(a.id,!h.showCommentInput[a.id])},className:"text-[9px] text-blue-600 hover:text-blue-700 font-medium",children:h.showCommentInput[a.id]?"Cancel":"Add Comment"})]}),h.comments[a.id]&&h.comments[a.id].length>0&&(0,kt.jsx)("div",{className:"space-y-2 mb-2 max-h-32 overflow-y-auto",children:h.comments[a.id].map((e,t)=>(0,kt.jsxs)("div",{className:"bg-gray-50 rounded p-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,kt.jsxs)("span",{className:"text-[9px] font-semibold text-gray-700",children:["Comment by: ",e.userName||"Unknown User"]}),(0,kt.jsxs)("span",{className:"text-[8px] text-gray-500",children:["\u2022 ",new Date(e.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]})]}),(0,kt.jsx)("p",{className:"text-[10px] text-gray-600",children:e.content})]},t))}),h.showCommentInput[a.id]&&(0,kt.jsxs)("div",{className:"mt-2",children:[(0,kt.jsx)(za,{value:h.commentInputs[a.id]||"",onChange:e=>{m.setCommentInputs(a.id,e.target.value)},placeholder:"Type your comment here... Use @ to mention users",availableUsers:l,className:"w-full",rows:2}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1 mt-1",children:[(0,kt.jsx)("button",{onClick:()=>{m.setShowCommentInput(a.id,!1),m.setCommentInputs(a.id,"")},className:"px-2 py-1 text-[9px] text-gray-600 hover:text-gray-700 font-medium",children:"Cancel"}),(0,kt.jsx)("button",{onClick:()=>{const e=h.commentInputs[a.id];if(null!==e&&void 0!==e&&e.trim()){const t={id:Date.now(),content:e.trim(),userName:Vr(c),createdAt:(new Date).toISOString()};m.addComment(a.id,t)}},disabled:!(null!==(n=h.commentInputs[a.id])&&void 0!==n&&n.trim()),className:"px-2 py-1 text-[9px] bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:"Post Comment"})]})]})]}),i&&a.projectId&&g&&(0,kt.jsx)("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100",children:(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),i&&i(g,"Project Profile",null,"Messages, Tasks, & Reminders")},className:"text-[8px] font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 px-2 py-1 rounded transition-colors",children:"View Project"})})]})]})},Va=e=>{let{activityFeedItems:t,projects:r,colorMode:n,activityProjectFilter:a,activityTypeFilter:s,setActivityProjectFilter:i,setActivityTypeFilter:l,handleProjectSelectWithScroll:c,availableUsers:d=[],currentUser:u=null,sourceSection:h="Activity Feed"}=e;const{state:m,actions:p}=Bn(),[f,g]=(0,o.useState)(!0),[v,x]=(0,o.useState)(null),[b,y]=(0,o.useState)(!1),[w,j]=(0,o.useState)(new Set),N=(0,o.useMemo)(()=>{if(!Array.isArray(t)||0===t.length)return"len:0";try{return"len:"+t.length+"|"+t.map(e=>"".concat(e.id,":").concat(e.timestamp||"")).join("|")}catch(e){return"len:"+t.length}},[t]),S=(0,o.useRef)(null);(0,o.useEffect)(()=>{N!==S.current&&(p.setItems(Array.isArray(t)?t:[]),S.current=N)},[N,t,p]);const k=(0,o.useRef)(new Set);(0,o.useEffect)(()=>{const e=m.items||[];if(e.length>0){let t=!1;e.forEach(e=>{k.current.has(e.id)||(m.expandedItems.has(e.id)||(p.toggleExpanded(e.id),t=!0),k.current.add(e.id))})}},[m.items,p]);const A=async e=>{if(null===e||void 0===e||!e.id)return;const t="message"===e.type?"message":"task"===e.type?"task":"reminder"===e.type?"reminder":"item";if(window.confirm("Delete this ".concat(t,"? This action cannot be undone."))){j(t=>{const r=new Set(t);return r.add(e.id),r});try{let r=String(e.id||"");if(r=r.replace(/^(task_|cal_|activity_|reminder_|msg_|feedback_)/,""),console.log("\ud83d\uddd1\ufe0f Delete attempt:",{originalId:e.id,realId:r,type:e.type}),"message"===e.type)await Da.projectMessagesService.delete(r);else if("task"===e.type)await Da.tasksService.delete(r);else{if("reminder"!==e.type)throw new Error("Unsupported activity type: ".concat(e.type));await Da.calendarService.delete(r)}p.removeItem(e.id),qr.success("".concat(t.charAt(0).toUpperCase()+t.slice(1)," deleted."))}catch(a){var r,n;console.error("Failed to delete activity item:",a);const e=(null===a||void 0===a||null===(r=a.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||(null===a||void 0===a?void 0:a.message)||"Failed to delete item.";qr.error(e)}finally{j(t=>{const r=new Set(t);return r.delete(e.id),r})}}};return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"w-full flex flex-col","data-section":"activity-feed",children:(0,kt.jsxs)("div",{className:"bg-white border border-gray-200/50 shadow-soft rounded-2xl p-6 relative overflow-visible flex-1 min-h-[800px]",children:[(0,kt.jsx)("div",{className:"mb-3",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold bg-[#F8FAFC] bg-clip-text text-transparent mb-1",children:"Activity Feed"}),(0,kt.jsxs)("div",{className:"text-xs text-gray-500",children:[t.length," items total"]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{new Set((m.items||[]).map(e=>e.id)).forEach(e=>{m.expandedItems.has(e)||p.toggleExpanded(e)})},className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat((()=>{const e=(m.items||[]).length;return m.expandedItems.size<e&&e>0?"bg-brand-500 text-white border-brand-500 shadow-brand-glow":"bg-white text-brand-600 border-gray-200 hover:bg-white hover:border-brand-300 hover:shadow-soft"})()),title:"Expand all activity details",disabled:(()=>{const e=(m.items||[]).length;return 0===e||m.expandedItems.size===e})(),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),(0,kt.jsx)("button",{onClick:()=>{new Set((m.items||[]).map(e=>e.id)).forEach(e=>{m.expandedItems.has(e)&&p.toggleExpanded(e)})},className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat(m.expandedItems.size>0?"bg-orange-500 text-white border-orange-500 shadow-accent-glow":"bg-white text-orange-600 border-gray-200 hover:bg-white hover:border-orange-300 hover:shadow-soft"),title:"Collapse all activity details",disabled:0===m.expandedItems.size,children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})]})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,kt.jsxs)("select",{value:a,onChange:e=>i(e.target.value),className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-white transition-all duration-300 min-w-[120px]",children:[(0,kt.jsx)("option",{value:"",children:"All Projects"}),(r||[]).map(e=>{var t;return(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.name]},e.id)})]}),(0,kt.jsxs)("select",{value:s||"",onChange:e=>l(e.target.value),className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-white transition-all duration-300 min-w-[100px]",children:[(0,kt.jsx)("option",{value:"",children:"All Types"}),(0,kt.jsx)("option",{value:"message",children:"Messages"}),(0,kt.jsx)("option",{value:"task",children:"Tasks"}),(0,kt.jsx)("option",{value:"reminder",children:"Reminders"}),(0,kt.jsx)("option",{value:"feedback",children:"Feedback"})]})]}),f&&(0,kt.jsx)("div",{className:"space-y-3 flex-1 overflow-y-auto custom-scrollbar",children:(()=>{const e=(m.items||[]).filter(e=>{const t=!a||String(e.projectId)===String(a),r=!s||e.type===s;return t&&r}).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));return 0===e.length?(0,kt.jsx)("div",{className:"text-gray-400 text-center py-8 text-sm",children:"No activity yet."}):e.map(e=>{const t=(e=>{switch(e){case"message":return{stripe:"bg-blue-500",container:"bg-blue-100 border-blue-200"};case"task":return{stripe:"bg-emerald-500",container:"bg-emerald-100 border-emerald-200"};case"reminder":return{stripe:"bg-orange-500",container:"bg-orange-100 border-orange-200"};case"feedback":return{stripe:"bg-[#EF946C]",container:"bg-[#FDF2E9] border-[#EF946C]/30"};default:return{stripe:"bg-gray-300",container:"bg-gray-50/40 border-gray-100"}}})(e.type),a=w.has(e.id);return"message"===e.type?(0,kt.jsxs)("div",{className:"relative rounded-xl border ".concat(t.container," overflow-hidden shadow-md"),children:[(0,kt.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(t.stripe)}),(0,kt.jsx)(Ra,{activity:e,onProjectSelect:c,projects:r||[],colorMode:n,useRealData:!0,onQuickReply:()=>{},isExpanded:m.expandedItems.has(e.id)||0===m.expandedItems.size&&(m.items||[]).length>0,onToggleExpansion:()=>p.toggleExpanded(e.id),sourceSection:"Activity Feed",onDelete:()=>A(e),isDeleting:a})]},e.id):"task"===e.type?(0,kt.jsxs)("div",{className:"relative rounded-xl border ".concat(t.container," overflow-hidden shadow-md"),children:[(0,kt.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(t.stripe)}),(0,kt.jsx)(Wa,{item:e,projects:r||[],colorMode:n,onProjectSelect:c,availableUsers:d,currentUser:u,onDelete:()=>A(e),isDeleting:a})]},e.id):"reminder"===e.type?(0,kt.jsxs)("div",{className:"relative rounded-xl border ".concat(t.container," overflow-hidden shadow-md"),children:[(0,kt.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(t.stripe)}),(0,kt.jsx)(qa,{item:e,projects:r||[],colorMode:n,onProjectSelect:c,availableUsers:d,currentUser:u,onDelete:()=>A(e),isDeleting:a})]},e.id):(e.type,null)})})()})]})}),(0,kt.jsx)(Oa,{document:v,isOpen:b,onClose:()=>{y(!1),x(null)}})]})},Ha=e=>{let{activeCommTab:t,activityFeedItems:r,projects:n,colorMode:a,expandedMessages:s,messagesProjectFilter:i,messagesUserFilter:l,handleToggleMessage:c,handleProjectSelectWithScroll:d,handleQuickReply:u}=e;const{actions:h}=Bn(),[m,p]=(0,o.useState)(new Set);if("messages"!==t)return null;return(0,kt.jsx)(kt.Fragment,{children:(()=>{const e=r.filter(e=>"message"===e.type).filter(e=>!i||String(e.projectId)===String(i)).filter(e=>{if(!l)return!0;const t=String(l),r=Array.isArray(e.recipients)&&(e.recipients.includes("all")||e.recipients.some(e=>String(e)===t)),n=e.authorId&&String(e.authorId)===t;return r||n});return 0===e.length?(0,kt.jsxs)("div",{className:"text-gray-400 text-center py-8 text-sm",children:[(0,kt.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,kt.jsx)("p",{className:"font-medium",children:"No messages found"}),(0,kt.jsx)("p",{className:"text-xs mt-1",children:"Messages you send or receive will appear here"})]}):e.map(e=>(0,kt.jsx)(Ra,{activity:(0,Y.A)((0,Y.A)({},e),{},{id:e.id,projectId:e.projectId,projectName:e.projectName,subject:e.subject,description:e.description||e.content,user:e.user,timestamp:e.timestamp,type:e.type,priority:e.priority,recipients:e.recipients}),onProjectSelect:d,projects:n,colorMode:a,useRealData:!0,onQuickReply:u,isExpanded:s.has(e.id),onToggleExpansion:c,sourceSection:"Messages, Tasks, & Reminders",onDelete:()=>(async e=>{if(null===e||void 0===e||!e.id)return;if(window.confirm("Delete this message? This action cannot be undone.")){p(t=>{const r=new Set(t);return r.add(e.id),r});try{const t=String(e.id||"").replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");await Da.projectMessagesService.delete(t),h.removeItem(e.id),qr.success("Message deleted successfully.")}catch(n){var t,r;console.error("Failed to delete message:",n);const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||(null===n||void 0===n?void 0:n.message)||"Failed to delete message.";qr.error(e)}finally{p(t=>{const r=new Set(t);return r.delete(e.id),r})}}})(e),isDeleting:m.has(e.id)},e.id))})()})},Ga=e=>{let{activeCommTab:t,activityFeedItems:r,projects:n,colorMode:a,tasksProjectFilter:s,tasksUserFilter:i,showCompletedTasks:l,setShowCompletedTasks:c,handleProjectSelectWithScroll:d,availableUsers:u=[],currentUser:h=null}=e;const{state:m,actions:p}=Bn(),[f,g]=(0,o.useState)(new Set);if("tasks"!==t)return null;return(0,kt.jsx)(kt.Fragment,{children:(()=>{const e=m.items.filter(e=>"task"===e.type).filter(e=>!s||String(e.projectId)===String(s)).filter(e=>{if(!i)return!0;const t=String(i),r=Array.isArray(e.attendees)&&e.attendees.some(e=>String(e)===t),n=e.authorId&&String(e.authorId)===t;return r||n}),t=e.filter(e=>{const t=m.completedItems.has(e.id);return l?t:!t}),r=e.filter(e=>m.completedItems.has(e.id)).length,o=e.length-r;return(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3 text-xs text-gray-600",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsxs)("span",{children:[o," active"]}),(0,kt.jsxs)("span",{children:[r," completed"]})]}),(0,kt.jsx)("button",{onClick:()=>c(!l),className:"text-blue-600 hover:text-blue-700 font-medium",children:l?"\u2190 Show Active Tasks":"Show Completed Tasks \u2192"})]}),0===t.length?(0,kt.jsxs)("div",{className:"text-center py-16",children:[(0,kt.jsx)("div",{className:"w-20 h-20 mx-auto mb-6 bg-[#F8FAFC] rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-10 h-10 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:l?"No completed tasks":"No active tasks"}),(0,kt.jsx)("p",{className:"text-gray-500",children:l?"Completed tasks will appear here":"Tasks assigned to you will appear here"})]}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,kt.jsx)(Wa,{item:e,projects:n||[],colorMode:a,onProjectSelect:d,availableUsers:u,currentUser:h,onDelete:()=>(async e=>{if(null===e||void 0===e||!e.id)return;if(window.confirm("Delete this task? This action cannot be undone.")){g(t=>{const r=new Set(t);return r.add(e.id),r});try{const t=String(e.id||"").replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");await Da.tasksService.delete(t),p.removeItem(e.id),qr.success("Task deleted successfully.")}catch(n){var t,r;console.error("Failed to delete task:",n);const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||(null===n||void 0===n?void 0:n.message)||"Failed to delete task.";qr.error(e)}finally{g(t=>{const r=new Set(t);return r.delete(e.id),r})}}})(e),isDeleting:f.has(e.id)},e.id))})})]})})()})},Ka=e=>{let{activeCommTab:t,activityFeedItems:r,projects:n,colorMode:a,remindersProjectFilter:s,remindersUserFilter:i,availableUsers:l,handleProjectSelectWithScroll:c,currentUser:d=null}=e;const{state:u,actions:h}=Bn(),[m,p]=(0,o.useState)(new Set);if("reminders"!==t)return null;return(0,kt.jsx)(kt.Fragment,{children:(()=>{const e=u.items.filter(e=>"reminder"===e.type).filter(e=>!s||String(e.projectId)===String(s)).filter(e=>{if(!i)return!0;const t=String(i),r=Array.isArray(e.recipients)&&(e.recipients.includes("all")||e.recipients.some(e=>String(e)===t)),n=e.authorId&&String(e.authorId)===t;return r||n}).filter(e=>!u.completedItems.has(e.id));return 0===e.length?(0,kt.jsxs)("div",{className:"text-center py-16",children:[(0,kt.jsx)("div",{className:"w-20 h-20 mx-auto mb-6 bg-[#F8FAFC] rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-10 h-10 text-amber-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No reminders found"}),(0,kt.jsx)("p",{className:"text-gray-500",children:"Reminders you create or receive will appear here"})]}):(0,kt.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,kt.jsx)(qa,{item:e,projects:n||[],colorMode:a,onProjectSelect:c,availableUsers:l,currentUser:d,onDelete:()=>(async e=>{if(null===e||void 0===e||!e.id)return;if(window.confirm("Delete this reminder? This action cannot be undone.")){p(t=>{const r=new Set(t);return r.add(e.id),r});try{const t=String(e.id||"").replace(/^(task_|cal_|activity_|reminder_|msg_)/,"");await Da.calendarService.delete(t),h.removeItem(e.id),qr.success("Reminder deleted successfully.")}catch(n){var t,r;console.error("Failed to delete reminder:",n);const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||(null===n||void 0===n?void 0:n.message)||"Failed to delete reminder.";qr.error(e)}finally{p(t=>{const r=new Set(t);return r.delete(e.id),r})}}})(e),isDeleting:m.has(e.id)},e.id))})})()})},Ja=e=>{if(!e)return"N/A";const t={ROOFING:"Roofing",GUTTERS:"Gutters",INTERIOR_PAINT:"Interior Paint",WATER_LEAK:"Water Leak",MOLD:"Mold",DECKS:"Decks",REPAIR_EXTERIOR:"Repair - Exterior",REPAIR_INTERIOR:"Repair - Interior",WINDOWS:"Windows",SIDING:"Siding",FENCE:"Fence",KITCHEN_REMODEL:"Kitchen Remodel",BATHROOM_RENOVATION:"Bathroom Renovation",FLOORING:"Flooring",PAINTING:"Painting",ELECTRICAL_WORK:"Electrical Work",PLUMBING:"Plumbing",HVAC:"HVAC",LANDSCAPING:"Landscaping",OTHER:"Other",ROOF_REPLACEMENT:"Roof Replacement",SIDING_INSTALLATION:"Siding Installation",WINDOW_REPLACEMENT:"Window Replacement",DECK_CONSTRUCTION:"Deck Construction"};if(t[e])return t[e];const r=String(e).toLowerCase().replace(/_/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase());return r},Ya=e=>e?"bg-gray-50 text-gray-700 border-gray-300 shadow-sm":"bg-gray-50 text-gray-600 border-gray-200",Xa=e=>e?"bg-gray-700/50 text-gray-200 border-gray-600 shadow-sm":"bg-gray-700 text-gray-300 border-gray-600",Qa=e=>{var t,r;let{projects:n=[],colorMode:a=!1,onProjectSelect:s,workflowAlerts:i=[],alertsLoading:l=!1,availableUsers:c=[],currentUser:d=null,handleProjectSelectWithScroll:u}=e;Array.isArray(i)&&i.length;const[h,m]=(0,o.useState)(new Set),[p,f]=(0,o.useState)(new Set),[g,v]=(0,o.useState)(new Set),[x,b]=(0,o.useState)("all"),[y,w]=(0,o.useState)("all"),[j,N]=(0,o.useState)({}),[S,k]=(0,o.useState)({}),[A,C]=(0,o.useState)(!1),[E,P]=(0,o.useState)(null),[_,I]=(0,o.useState)(""),[T,L]=(0,o.useState)(!1),[D,M]=(0,o.useState)({itemName:"",responsibleRole:"OFFICE",description:"",estimatedMinutes:30,alertDays:1,addToAllWorkflows:!1}),[O,R]=(0,o.useState)(null),[F,U]=(0,o.useState)(!1),B=(0,o.useRef)({}),z=(0,o.useRef)({}),W=e=>({PM:"PM",FIELD:"FIELD",OFFICE:"OFFICE",ADMIN:"ADMIN"}[e]||"OFFICE"),q=()=>(()=>{let e=[...i&&i.length>0?i:[]];return"all"!==x&&(e=e.filter(e=>{var t;if("general"===x)return!e.projectId&&!e.project;const r=(null===(t=e.project)||void 0===t?void 0:t._id)||e.projectId;return r===x||r===parseInt(x)})),"all"!==y&&(e=e.filter(e=>{var t,r;const n=(null===(t=e.metadata)||void 0===t?void 0:t.responsibleRole)||(null===(r=e.actionData)||void 0===r?void 0:r.responsibleRole)||"OFFICE";return W(String(n))===y})),e})();return(0,kt.jsxs)("div",{className:"w-full","data-section":"project-workflow-tasks",children:[(0,kt.jsxs)("div",{className:"bg-white border border-gray-200/50 shadow-soft rounded-2xl p-6 relative overflow-visible",children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold bg-[#F8FAFC] bg-clip-text text-transparent mb-1",children:"Project Workflow Line Items"}),h.size>0&&(0,kt.jsxs)("p",{className:"text-sm text-gray-600 font-medium",children:[h.size," of ",q().length," alert",1!==q().length?"s":""," expanded"]})]})}),(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-3 mt-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Filter by:"}),(0,kt.jsxs)("select",{value:x,onChange:e=>b(e.target.value),className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-white transition-all duration-300 min-w-[120px]",children:[(0,kt.jsx)("option",{value:"all",children:"All Projects"}),(0,kt.jsx)("option",{value:"general",children:"General"}),(n||[]).map(e=>{var t;return(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.name]},e.id)})]}),(0,kt.jsxs)("select",{value:y,onChange:e=>w(e.target.value),className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-white transition-all duration-300 min-w-[100px]",children:[(0,kt.jsx)("option",{value:"all",children:"All Roles"}),(0,kt.jsx)("option",{value:"PM",children:"Project Manager"}),(0,kt.jsx)("option",{value:"FIELD",children:"Field Director"}),(0,kt.jsx)("option",{value:"OFFICE",children:"Office Staff"}),(0,kt.jsx)("option",{value:"ADMIN",children:"Administration"})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{console.log("\ud83d\udd04 Force refreshing alerts...")},className:"px-2 py-1 text-xs font-medium bg-blue-500 text-white rounded-md hover:bg-[var(--color-primary-blueprint-blue)] transition-colors",title:"Refresh alerts",children:"\ud83d\udd04"}),(0,kt.jsx)("button",{onClick:()=>{const e=new Set(q().map(e=>e._id||e.id));m(e)},className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat(h.size===q().length&&q().length>0?"bg-brand-500 text-white border-brand-500 shadow-brand-glow":"bg-white text-brand-600 border-gray-200 hover:bg-white hover:border-brand-300 hover:shadow-soft"),title:"Expand all alert details",disabled:0===q().length||h.size===q().length,children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),(0,kt.jsx)("button",{onClick:()=>{m(new Set)},className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat(0===h.size||0===q().length?"bg-orange-500 text-white border-orange-500 shadow-accent-glow":"bg-white text-orange-600 border-gray-200 hover:bg-white hover:border-orange-300 hover:shadow-soft"),title:"Collapse all alert details",disabled:0===q().length||0===h.size,children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})]})]}),(0,kt.jsx)("div",{className:"border-t mb-3 mt-0 ".concat(a?"border-gray-600":"border-gray-200")}),(0,kt.jsxs)("div",{className:"space-y-2 mt-3 max-h-[480px] overflow-y-auto pr-1 custom-scrollbar",children:[0===q().length&&(0,kt.jsx)("div",{className:"text-gray-400 text-center py-3 text-sm",children:l?"Loading alerts...":"No alerts found."}),q().length>0&&q().map(e=>{var t,r,o,i,l,c,x,b;const y=e._id||e.id,w=e.actionData||e.metadata||{},A=w.phase||"UNKNOWN",E=w.priority||"medium",_=w.projectId,I=null===n||void 0===n?void 0:n.find(e=>String(e.id)===String(_)||String(e._id)===String(_)),T=(w.stepName||e.title,h.has(y)),L=w.section||w.sectionName||"Unknown Section",D=(e=>{if(!e)return"Unknown Line Item";const t=[e.lineItem,e.stepName,e.stepLabel,e.title,e.message,e.name],r=e.actionData||e.metadata||{},n=[r.stepName,r.lineItemName,r.lineItem,r.currentLineItemName,r.stepLabel,r.lineItemLabel,r.name,r.label,r.title,r.cleanTaskName],a=e.metadata||{},s=[...t,...n,...[a.lineItem,a.cleanTaskName,a.stepName,a.lineItemName,a.name,a.label]];for(const o of s)if(null!==o&&void 0!==o)if("object"!==typeof o){if("string"===typeof o&&o.trim())return o.trim();if("number"===typeof o)return String(o)}else{if(o.name)return String(o.name);if(o.label)return String(o.label)}return e.stepId?String(e.stepId):e.lineItemId?String(e.lineItemId):"(unknown line item)"})(e),M=w.stepId||w.lineItemId||e.stepId||e.lineItemId||"alert-".concat(y);try{D&&"(unknown line item)"!==D||!window||!window.console||console.debug("\u26a0\ufe0f Workflow Alert missing lineItemName, actionData:",w,"alert:",e)}catch(Pr){}(e=>{var t;const r=e.responsibleRole||(null===(t=e.metadata)||void 0===t?void 0:t.responsibleRole)||"OFFICE";W(String(r))})(e);const O=e.projectType||(null===(t=e.relatedProject)||void 0===t?void 0:t.projectType)||w.projectType||(null===I||void 0===I?void 0:I.projectType),R=e=>Wn.getPhaseButtonProps(e||"LEAD");return(0,kt.jsxs)("div",{className:"".concat(a?"bg-[#1e293b] hover:bg-[#232b4d]":"bg-white hover:bg-[#F8F9FA]"," rounded-[12px] shadow-sm border transition-all duration-200 cursor-pointer"),children:[(0,kt.jsx)("div",{className:"flex flex-col gap-0 px-1.5 py-1 hover:bg-opacity-80 transition-colors cursor-pointer",onClick:()=>(e=>{const t=new Set(h);t.has(e)?t.delete(e):t.add(e),m(t)})(y),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,kt.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,kt.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center ".concat(R(A).textColor," font-bold text-[9px] shadow-sm"),style:{backgroundColor:"PROSPECT"===A?"#F97316":R(A).hexColor},children:R(A).initials}),"high"===E&&(0,kt.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-red-500 rounded-full border border-white shadow-sm"})]}),(0,kt.jsxs)("div",{className:"flex items-center text-[9px] flex-1",children:[(0,kt.jsx)("button",{className:"font-bold flex-shrink-0 hover:underline ".concat(a?"text-blue-300 hover:text-blue-200":"text-blue-700 hover:text-blue-900"),style:{width:"50px",textAlign:"left"},onClick:e=>{if(e.stopPropagation(),I&&s){const e=(0,Y.A)((0,Y.A)({},I),{},{scrollToProjectId:String(I.id),navigationSource:"Project Workflow Line Items",returnToSection:"project-workflow-tasks"});console.log("\ud83c\udfaf PROJECT NUMBER CLICK: Navigating from Project Workflow Line Items to Profile"),u(e,"Profile",null,"Project Workflow Line Items")}},title:"Go to project #".concat((null===I||void 0===I?void 0:I.projectNumber)||w.projectNumber||"N/A"),children:(null===I||void 0===I?void 0:I.projectNumber)||w.projectNumber||"12345"}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0 relative",style:{width:"100px",marginLeft:"0px"},children:[(0,kt.jsx)("button",{ref:e=>B.current[y]=e,className:"text-[9px] font-semibold cursor-pointer hover:underline ".concat(a?"text-gray-300 hover:text-gray-200":"text-gray-700 hover:text-gray-800"),title:(null===I||void 0===I||null===(r=I.customer)||void 0===r?void 0:r.name)||(null===I||void 0===I?void 0:I.clientName)||w.projectName||"Primary Customer",onClick:e=>{e.stopPropagation();const t=new Set(p);t.has(y)?t.delete(y):t.add(y),f(t)},children:(null===I||void 0===I||null===(o=I.customer)||void 0===o?void 0:o.name)||(null===I||void 0===I?void 0:I.clientName)||(null===I||void 0===I?void 0:I.name)||"Customer"}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation();const t=new Set(p);t.has(y)?t.delete(y):t.add(y),f(t)},className:"transform transition-transform duration-200 ".concat(p.has(y)?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),p.has(y)&&((null===I||void 0===I?void 0:I.customer)||(null===I||void 0===I?void 0:I.client))&&(0,kt.jsx)("div",{className:"absolute left-0 top-full mt-1 z-50 bg-white border border-gray-300 rounded-lg shadow-xl p-2.5 min-w-[180px] text-[10px] space-y-1",children:(()=>{const e=(null===I||void 0===I?void 0:I.customer)||(null===I||void 0===I?void 0:I.client);return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900 border-b border-gray-200 pb-1 mb-1",children:e.primaryName||e.name||(null===I||void 0===I?void 0:I.clientName)||"Customer"}),e.primaryPhone&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udcde"}),(0,kt.jsx)("span",{className:"text-gray-700",children:e.primaryPhone})]}),e.primaryEmail&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udce7"}),(0,kt.jsx)("span",{className:"text-gray-700 break-all",children:e.primaryEmail})]}),e.primaryAddress&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udccd"}),(0,kt.jsx)("span",{className:"text-gray-700",children:e.primaryAddress})]}),!e.primaryPhone&&!e.primaryEmail&&!e.primaryAddress&&(0,kt.jsx)("div",{className:"text-gray-500 italic text-[9px]",children:"No contact details"})]})})()})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",style:{marginLeft:"8px"},children:[(0,kt.jsx)("span",{className:"font-medium ".concat(a?"text-gray-400":"text-gray-500"),children:"PM:"}),(0,kt.jsx)("button",{ref:e=>z.current[y]=e,className:"text-[8px] font-semibold cursor-pointer hover:underline truncate max-w-[60px] ".concat(a?"text-gray-300 hover:text-gray-200":"text-gray-700 hover:text-gray-800"),title:(null===I||void 0===I||null===(i=I.projectManager)||void 0===i?void 0:i.name)||(null===I||void 0===I||null===(l=I.projectManager)||void 0===l?void 0:l.firstName)+" "+(null===I||void 0===I||null===(c=I.projectManager)||void 0===c?void 0:c.lastName)||"Mike Field",onClick:e=>{e.stopPropagation();const t=new Set(g);t.has(y)?t.delete(y):t.add(y),v(t)},children:(null===I||void 0===I||null===(x=I.projectManager)||void 0===x?void 0:x.firstName)||(null===I||void 0===I||null===(b=I.projectManager)||void 0===b?void 0:b.name)||"Mike"}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation();const t=new Set(g);t.has(y)?t.delete(y):t.add(y),v(t)},className:"transform transition-transform duration-200 ".concat(g.has(y)?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[O&&(0,kt.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] font-medium border max-w-[140px] whitespace-nowrap truncate ".concat(a?Xa(O):Ya(O)),title:"Project Type: ".concat(Ja(O)),children:Ja(O)}),(0,kt.jsx)("div",{className:"transform transition-transform duration-200 ".concat(T?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),(0,kt.jsxs)("div",{className:"flex items-center text-[9px]",style:{marginTop:"-2px",marginLeft:"32px"},children:[(0,kt.jsxs)("div",{className:"flex items-center",style:{width:"150px"},children:[(0,kt.jsx)("span",{className:"font-medium ".concat(a?"text-gray-400":"text-gray-500"),style:{marginLeft:"4px"},children:"Section:"}),(0,kt.jsx)("span",{className:"font-semibold truncate ".concat(a?"text-white":"text-gray-800"),style:{marginLeft:"4px"},children:L||"Unknown Section"})]}),(0,kt.jsxs)("div",{className:"flex items-center flex-shrink-0 ml-2",children:[(0,kt.jsx)("span",{className:"font-medium ".concat(a?"text-gray-400":"text-gray-500"),style:{marginLeft:"8px"},children:"Line Item:"}),(0,kt.jsx)("span",{className:"font-semibold cursor-pointer hover:underline max-w-[120px] truncate ".concat(a?"text-white hover:text-gray-200":"text-gray-800 hover:text-gray-900"),style:{marginLeft:"4px"},id:"lineitem-".concat(M),"data-lineitem-id":M,"data-alert-id":y,title:D||"Unknown Line Item",onClick:async t=>{if(t.stopPropagation(),I&&s){console.log("\ud83c\udfaf ALERTS CLICK: Starting alert line item navigation");try{const t=await Da.default.get("/workflow-data/project-position/".concat(I.id));if(t.data){const r=t.data;if(r.success&&r.data){const t=r.data,n=async()=>{try{const e=await Da.default.get("/workflow-data/full-structure");if(e.data){const r=e.data;if(r.success&&r.data){const e=r.data.find(e=>e.id===t.currentPhase);if(e){const r=e.items.find(e=>e.id===t.currentSection);if(r){const e=r.subtasks.findIndex(e=>"object"===typeof e?e.id===t.currentLineItem||e.label===t.currentLineItemName:e===t.currentLineItemName);return e>=0?e:0}}}}}catch(e){console.warn("Could not determine subtask index:",e)}return 0},a=await n(),s=w.stepId||w.lineItemId||"".concat(t.currentPhase,"-").concat(t.currentSection,"-").concat(a),o=w.sectionId||t.currentSection,i=(0,Y.A)((0,Y.A)({},I),{},{highlightStep:D,highlightLineItem:D,targetPhase:A,targetSection:L,targetLineItem:D,scrollToCurrentLineItem:!0,alertPhase:A,navigationTarget:{nonce:Date.now(),phase:A,section:L,lineItem:D,stepName:D,alertId:y,lineItemId:w.stepId||w.lineItemId||e.stepId,workflowId:w.workflowId||e.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(s),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:o,expandPhase:!0,expandSection:!0,autoOpen:!0}});i.navigationSource="Project Workflow Tasks",i.returnToSection="project-workflow-tasks",i.highlightTarget={lineItemId:s,sectionId:o,phaseId:t.currentPhase,autoOpen:!0,scrollAndHighlight:!0},u(i,"Project Workflow",null,"Project Workflow Line Items",s,o)}}}catch(r){console.error("\ud83c\udfaf ALERTS CLICK: Error getting project position:",r)}}},children:D})]})]}),T&&(0,kt.jsxs)("div",{className:"px-2 py-2 border-t ".concat(a?"bg-[#232b4d] border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{const t=e._id||e.id;k(e=>(0,Y.A)((0,Y.A)({},e),{},{["".concat(t,"-complete")]:!0}));try{var r,n,a;const s=(null===(r=e.relatedProject)||void 0===r?void 0:r._id)||e.projectId||(null===(n=e.project)||void 0===n?void 0:n._id),o=e.lineItemId||(null===(a=e.metadata)||void 0===a?void 0:a.lineItemId)||e.stepId||e.id,i=await Da.default.post("/workflows/complete-item",{projectId:s,lineItemId:o,notes:"Completed via dashboard alert by ".concat((null===d||void 0===d?void 0:d.firstName)||"User"," ").concat((null===d||void 0===d?void 0:d.lastName)||""),alertId:t});i.status>=200&&i.status<300&&console.log("\u2705 Alert completed successfully")}catch(s){console.error("\u274c Failed to complete alert:",s)}finally{k(e=>(0,Y.A)((0,Y.A)({},e),{},{["".concat(t,"-complete")]:!1}))}})(e)},disabled:S["".concat(y,"-complete")],className:"flex-1 px-2 py-1 text-[9px] font-semibold rounded border transition-all duration-200 ".concat(S["".concat(y,"-complete")]?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-[#F8FAFC] text-white border-green-500 hover:from-green-600 hover:to-green-700 hover:border-green-600 shadow-sm hover:shadow-md"),children:S["".concat(y,"-complete")]?(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-1 h-3 w-3 text-green-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Completing..."]}):(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Complete"]})}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{P(e),C(!0)})(e)},disabled:S["".concat(y,"-assign")],className:"flex-1 px-2 py-1 text-[9px] font-semibold rounded border transition-all duration-200 ".concat(S["".concat(y,"-assign")]?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-[#F8FAFC] text-white border-brand-500 hover:from-blue-600 hover:to-blue-700 hover:border-blue-600 shadow-sm hover:shadow-md"),children:(0,kt.jsxs)("span",{className:"flex items-center justify-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Assign to User"]})})]}),(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("label",{className:"block text-[9px] font-medium mb-1 ".concat(a?"text-gray-300":"text-gray-700"),children:"Add Note:"}),(0,kt.jsx)("textarea",{placeholder:"Enter a note for this alert...",rows:2,value:j[y]||"",className:"w-full p-2 text-[9px] border rounded resize-none transition-colors ".concat(a?"bg-[#1e293b] border-gray-600 text-white placeholder-gray-400 focus:border-brand-500 focus:ring-1 focus:ring-blue-500":"bg-white border-gray-300 text-gray-800 placeholder-gray-500 focus:border-brand-500 focus:ring-1 focus:ring-blue-500"),onChange:e=>{N(t=>(0,Y.A)((0,Y.A)({},t),{},{[y]:e.target.value}))}})]})]})]},y)})]})]}),A&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,kt.jsxs)("div",{className:"bg-white rounded-[20px] p-6 w-96 max-w-md ".concat(a?"bg-[#1e293b] border border-[#3b82f6]/30":"bg-white"),children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold mb-4 ".concat(a?"text-white":"text-gray-800"),children:"Assign Alert"}),E&&(0,kt.jsxs)("div",{className:"mb-4 p-3 rounded border ".concat(a?"bg-[#232b4d] border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsxs)("p",{className:"text-sm font-medium ".concat(a?"text-gray-200":"text-gray-700"),children:["Alert: ",E.title||"Unknown Alert"]}),(0,kt.jsxs)("p",{className:"text-xs mt-1 ".concat(a?"text-gray-400":"text-gray-500"),children:["Project: ",(null===(t=E.metadata)||void 0===t?void 0:t.projectName)||(null===(r=E.relatedProject)||void 0===r?void 0:r.projectName)||"Unknown Project"]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(a?"text-gray-300":"text-gray-700"),children:"Assign to User:"}),(0,kt.jsxs)("select",{value:_,onChange:e=>I(e.target.value),className:"w-full p-3 border rounded-lg text-sm transition-colors ".concat(a?"bg-[#1e293b] border-gray-600 text-white focus:border-brand-500 focus:ring-1 focus:ring-blue-500":"bg-white border-gray-300 text-gray-800 focus:border-brand-500 focus:ring-1 focus:ring-blue-500"),children:[(0,kt.jsx)("option",{value:"",children:"Select a user..."}),c.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName||""," ",e.lastName?"":"(".concat(e.email,")")]},e.id))]})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{C(!1),P(null),I("")},className:"px-4 py-2 rounded text-sm font-medium transition-colors ".concat(a?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{const e=E._id||E.id;k(t=>(0,Y.A)((0,Y.A)({},t),{},{["".concat(e,"-assign")]:!0}));try{(await Da.default.patch("/alerts/".concat(e,"/assign"),{assignedTo:_})).data.success&&(console.log("\u2705 Alert assigned successfully"),C(!1),P(null),I(""))}catch(t){console.error("\u274c Failed to assign alert:",t)}finally{k(t=>(0,Y.A)((0,Y.A)({},t),{},{["".concat(e,"-assign")]:!1}))}},disabled:!_||S["".concat((null===E||void 0===E?void 0:E.id)||(null===E||void 0===E?void 0:E._id),"-assign")],className:"px-4 py-2 rounded text-sm font-medium transition-colors ".concat(_&&!S["".concat((null===E||void 0===E?void 0:E.id)||(null===E||void 0===E?void 0:E._id),"-assign")]?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-400 text-white cursor-not-allowed"),children:S["".concat((null===E||void 0===E?void 0:E.id)||(null===E||void 0===E?void 0:E._id),"-assign")]?(0,kt.jsxs)("span",{className:"flex items-center",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Assigning..."]}):"Assign"})]})]})})]})},Za=e=>{let{activeCommTab:t,setActiveCommTab:r,expandedMessages:n,activityFeedItems:a}=e;return(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold bg-[#F8FAFC] bg-clip-text text-transparent mb-1",children:"Messages, Tasks, & Reminders"}),n.size>0&&(0,kt.jsxs)("p",{className:"text-sm text-gray-600 font-medium",children:[n.size," of ","messages"===t?a.filter(e=>"message"===e.type).length:"tasks"===t?a.filter(e=>"task"===e.type).length:"reminders"===t?a.filter(e=>"reminder"===e.type).length:0," ",t,(()=>{const e="messages"===t?a.filter(e=>"message"===e.type).length:"tasks"===t?a.filter(e=>"task"===e.type).length:a.filter(e=>"reminder"===e.type).length;return 1!==e?"s":""})()," expanded"]})]})}),(0,kt.jsx)("div",{className:"relative mt-4 mb-6",children:(0,kt.jsxs)("div",{className:"flex bg-gray-100 rounded-xl p-1 shadow-inner",children:[(0,kt.jsx)("button",{onClick:()=>r("messages"),className:"flex-1 px-4 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 ".concat("messages"===t?"bg-white text-blue-600 shadow-md transform scale-[1.02]":"text-gray-600 hover:text-gray-800 hover:bg-gray-50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Messages"]})}),(0,kt.jsx)("button",{onClick:()=>r("tasks"),className:"flex-1 px-4 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 ".concat("tasks"===t?"bg-white text-blue-600 shadow-md transform scale-[1.02]":"text-gray-600 hover:text-gray-800 hover:bg-gray-50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),"Tasks"]})}),(0,kt.jsx)("button",{onClick:()=>r("reminders"),className:"flex-1 px-4 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 ".concat("reminders"===t?"bg-white text-blue-600 shadow-md transform scale-[1.02]":"text-gray-600 hover:text-gray-800 hover:bg-gray-50"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Reminders"]})})]})})]})},$a=e=>{let{activeCommTab:t,projects:r,availableUsers:n,messagesProjectFilter:a,messagesUserFilter:s,tasksProjectFilter:o,tasksUserFilter:i,remindersProjectFilter:l,remindersUserFilter:c,setMessagesProjectFilter:d,setMessagesUserFilter:u,setTasksProjectFilter:h,setTasksUserFilter:m,setRemindersProjectFilter:p,setRemindersUserFilter:f,activityFeedItems:g,expandedMessages:v,handleExpandAllMessages:x,handleCollapseAllMessages:b}=e;return(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-3 mt-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Filter by:"}),(0,kt.jsxs)("select",{value:"messages"===t?a||"":"tasks"===t?o||"":l||"",onChange:e=>{"messages"===t?d(e.target.value):"tasks"===t?h(e.target.value):p(e.target.value)},className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white text-gray-900 hover:border-gray-300 transition-all duration-300 min-w-[120px]",style:{color:"#111827"},children:[(0,kt.jsx)("option",{value:"",style:{color:"#111827",backgroundColor:"#ffffff"},children:"All Projects"}),(r||[]).map(e=>{var t;return(0,kt.jsxs)("option",{value:e.id,style:{color:"#111827",backgroundColor:"#ffffff"},children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.name]},e.id)})]}),(0,kt.jsxs)("select",{value:"messages"===t?s||"":"tasks"===t?i||"":c||"",onChange:e=>{"messages"===t?u(e.target.value):"tasks"===t?m(e.target.value):f(e.target.value)},className:"text-xs font-medium px-2 py-1 rounded-lg border border-gray-200 bg-white text-gray-900 hover:border-gray-300 transition-all duration-300 min-w-[100px]",style:{color:"#111827"},children:[(0,kt.jsx)("option",{value:"",style:{color:"#111827",backgroundColor:"#ffffff"},children:"All Users"}),n.map(e=>(0,kt.jsxs)("option",{value:e.id,style:{color:"#111827",backgroundColor:"#ffffff"},children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:x,className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat((()=>{const e="messages"===t?g.filter(e=>"message"===e.type).length:"tasks"===t?g.filter(e=>"task"===e.type).length:g.filter(e=>"reminder"===e.type).length;return v.size===e&&e>0?"bg-brand-500 text-white border-brand-500 shadow-brand-glow":"bg-white text-brand-600 border-gray-200 hover:bg-white hover:border-brand-300 hover:shadow-soft"})()),title:"Expand all alert details",disabled:(()=>{const e="messages"===t?g.filter(e=>"message"===e.type).length:"tasks"===t?g.filter(e=>"task"===e.type).length:g.filter(e=>"reminder"===e.type).length;return 0===e||v.size===e})(),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),(0,kt.jsx)("button",{onClick:b,className:"px-1.5 py-1.5 text-xs font-medium rounded-md border transition-all duration-300 ".concat((()=>{"messages"===t?g.filter(e=>"message"===e.type).length:"tasks"===t?g.filter(e=>"task"===e.type).length:g.filter(e=>"reminder"===e.type).length;const e="messages"===t?g.filter(e=>"message"===e.type&&v.has(e.id)).length:"tasks"===t?g.filter(e=>"task"===e.type&&v.has(e.id)).length:g.filter(e=>"reminder"===e.type&&v.has(e.id)).length;return 0===e?"bg-orange-500 text-white border-orange-500 shadow-accent-glow":"bg-white text-orange-600 border-gray-200 hover:bg-white hover:border-orange-300 hover:shadow-soft"})()),title:"Collapse all alert details",disabled:(()=>{"messages"===t?g.filter(e=>"message"===e.type).length:"tasks"===t?g.filter(e=>"task"===e.type).length:g.filter(e=>"reminder"===e.type).length;const e="messages"===t?g.filter(e=>"message"===e.type&&v.has(e.id)).length:"tasks"===t?g.filter(e=>"task"===e.type&&v.has(e.id)).length:g.filter(e=>"reminder"===e.type&&v.has(e.id)).length;return 0===e})(),children:(0,kt.jsx)("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})]})},es=["Send inspection_report_v2.pdf to the homeowner with a quick status update.","Create a task for Sarah to order shingles for project 10023 by Friday and attach the takeoff.","Set a reminder for the install crew tomorrow at 8am to upload day-one photos.","Ask Bubbles to summarize punchlist_notes.pdf and share the highlights with the production manager."];function ts(e){let{visible:t,onClose:r=()=>{},colorMode:n=!1}=e;if((0,o.useEffect)(()=>{if(!t)return;const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[t]),!t)return null;const a=(0,kt.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{background:"rgba(2,6,23,0.58)",zIndex:2147483647},role:"dialog","aria-modal":"true",onClick:e=>{e.target===e.currentTarget&&r()},children:(0,kt.jsxs)("div",{className:"max-w-4xl w-[96%] max-h-[84vh] overflow-hidden rounded-2xl shadow-2xl relative ".concat(n?"bg-slate-900 text-slate-100":"bg-white text-gray-900"),style:{zIndex:2147483648},children:[(0,kt.jsx)("button",{onClick:r,"aria-label":"Close quick start",className:"absolute top-3 right-3 z-20 w-8 h-8 flex items-center justify-center rounded-lg transition-all ".concat(n?"bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-slate-200":"bg-gray-100 text-gray-500 hover:bg-gray-200 hover:text-gray-700"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,kt.jsxs)("div",{className:"flex flex-col gap-3 p-6 pt-12 md:pt-6 pr-3 md:pr-14 overflow-y-auto max-h-[calc(84vh-2rem)]",children:[(0,kt.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3",children:[(0,kt.jsxs)("div",{className:"max-w-2xl",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold",children:"Bubbles Assistant Playbook"}),(0,kt.jsx)("p",{className:"mt-1 text-sm leading-relaxed ".concat(n?"text-slate-300":"text-gray-600"),children:"Speak naturally. Give Bubbles the goal, who should get it, and which documents to attach. These quick plays keep projects moving without leaving your desk or jobsite."})]}),(0,kt.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,kt.jsx)("a",{href:"/bubbles-quickstart.html",target:"_blank",rel:"noreferrer",className:"flex-shrink-0 px-3 py-1.5 rounded-lg text-sm font-medium border text-center ".concat(n?"border-slate-600 text-slate-100 hover:bg-slate-800/60":"border-gray-300 text-gray-700 hover:bg-gray-100"," transition"),children:"Printable guide"}),(0,kt.jsx)("a",{href:"/bubbles-advanced-features-playbook.html",target:"_blank",rel:"noreferrer",className:"flex-shrink-0 px-3 py-1.5 rounded-lg text-sm font-medium text-center ".concat("bg-[#F8FAFC] text-white hover:from-blue-500 hover:to-purple-500"," transition shadow-md"),children:"\ud83d\ude80 Advanced Features"})]})]}),(0,kt.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"rounded-2xl border ".concat(n?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-gray-50"," p-4 shadow-sm"),children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500",children:"Prompts that work"}),(0,kt.jsx)("ul",{className:"mt-2 space-y-1.5 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:es.map((e,t)=>(0,kt.jsxs)("li",{className:"flex gap-2",children:[(0,kt.jsx)("span",{className:"flex-shrink-0 mt-[3px] w-4 h-4 rounded-full text-[10px] font-semibold flex items-center justify-center ".concat(n?"bg-slate-800 text-blue-300":"bg-blue-50 text-blue-600"),children:t+1}),(0,kt.jsx)("span",{className:"leading-snug",children:e})]},t))})]}),(0,kt.jsxs)("div",{className:"rounded-2xl border ".concat(n?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-white"," p-4 shadow-sm"),children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-emerald-500",children:"Attachments made easy"}),(0,kt.jsxs)("ul",{className:"mt-2 space-y-1.5 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:[(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Browse documents:"}),' Click the "Documents" button in the header to see all available documents from Documents & Resources.']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Quick insert:"})," Click any document name in the browser to automatically insert it into your message."]}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Exact names win:"}),' "Attach measurement_notes.pdf."']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Not sure?"}),' Use the document browser or ask "What documents are on project 10045?" then tell Bubbles which one to send.']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Bundle files:"}),' "Send the permit.pdf ',(0,kt.jsx)("em",{children:"and"}),' latest_photos.zip to accounting."']})]})]}),(0,kt.jsxs)("div",{className:"rounded-2xl border-2 ".concat(n?"border-purple-600 bg-purple-900/10":"border-purple-300 bg-purple-50"," p-4 shadow-sm"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-purple-600",children:"\u2728 NEW: Advanced Features"}),(0,kt.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full ".concat(n?"bg-purple-700 text-purple-200":"bg-purple-200 text-purple-700"),children:"Phase 3 & 4"})]}),(0,kt.jsxs)("ul",{className:"mt-2 space-y-1.5 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:[(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Multi-document:"}),' Send multiple files at once \u2014 "Send both report.pdf and photos.zip"']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Proactive alerts:"}),' Ask "What needs my attention?" for overdue tasks and deadlines']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Portfolio analytics:"}),' "What\'s the portfolio status?" or "Where are the bottlenecks?"']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"Enhanced detection:"})," Bubbles understands natural language better \u2014 speak normally!"]})]}),(0,kt.jsx)("a",{href:"/bubbles-advanced-features-playbook.html",target:"_blank",rel:"noreferrer",className:"mt-3 inline-block w-full text-center px-3 py-1.5 rounded-lg text-xs font-semibold transition ".concat(n?"bg-purple-700 text-white hover:bg-purple-600":"bg-purple-600 text-white hover:bg-purple-700"),children:"View Complete Guide \u2192"})]})]}),(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"rounded-2xl border ".concat(n?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-white"," p-4 shadow-sm"),children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-orange-500",children:"Voice: natural names first"}),(0,kt.jsxs)("div",{className:"mt-2 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:[(0,kt.jsxs)("p",{className:"leading-snug",children:[(0,kt.jsx)("strong",{children:"Speak it normally:"}),' "Attach the roofing doc forty-eight thirty-eight F F one PDF." Bubbles handles underscores and dashes automatically.']}),(0,kt.jsxs)("p",{className:"leading-snug mt-2",children:[(0,kt.jsx)("strong",{children:"Add detail if needed:"}),' Mention the project, uploader, or "the warranty PDF from today" so it matches the right file.']}),(0,kt.jsxs)("p",{className:"leading-snug mt-2",children:[(0,kt.jsx)("strong",{children:"Fallback:"}),' Only spell it out ("roofing underscore doc\u2026") if Bubbles asks for clarification.']})]})]}),(0,kt.jsxs)("div",{className:"rounded-2xl border ".concat(n?"border-slate-700 bg-slate-900/60":"border-gray-200 bg-white"," p-4 shadow-sm"),children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-purple-500",children:"Reliable workflow"}),(0,kt.jsxs)("ul",{className:"mt-2 space-y-1.5 text-sm ".concat(n?"text-slate-200":"text-gray-700"),children:[(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"1. State the job:"}),' "Send a status update to Maria about today\'s roof progress."']}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"2. Add project & people:"})," Include project number or names so Bubbles routes it correctly."]}),(0,kt.jsxs)("li",{children:[(0,kt.jsx)("strong",{children:"3. Approve the recap:"}),' Bubbles repeats the plan. Say "Looks good" or make tweaks.']})]})]})]})]})]})]})});return(0,c.createPortal)(a,document.body)}const rs=new class{async completeLineItem(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{console.log("\ud83d\udcdd Completing line item ".concat(t," for project ").concat(e));const a=await Da.default.post("/workflows/complete-item",{projectId:e,lineItemId:t,notes:r,alertId:n});return console.log("\u2705 Line item completed successfully"),a.data}catch(a){throw console.error("\u274c Error completing line item:",a),a}}async getCurrentPosition(e){try{return(await Da.default.get("/workflows/position/".concat(e))).data}catch(t){throw console.error("\u274c Error getting current position:",t),t}}async getWorkflowStatus(e){try{return(await Da.default.get("/workflows/status/".concat(e))).data}catch(t){throw console.error("\u274c Error getting workflow status:",t),t}}async getWorkflowData(e){try{return(await Da.default.get("/workflows/data/".concat(e))).data}catch(t){throw console.error("\u274c Error getting workflow data:",t),t}}async updateStep(e,t,r){try{console.log('\ud83d\udd0d WORKFLOW SERVICE: updateStep called with stepId: "'.concat(t,'" (length: ').concat(null===t||void 0===t?void 0:t.length,"), completed: ").concat(r));const n="string"===typeof t&&t.length>20&&!t.includes("DB_");if(console.log("\ud83d\udd0d WORKFLOW SERVICE: isDbId detection: ".concat(n)),r&&n)return console.log("\u2705 WORKFLOW SERVICE: Calling completeLineItem for UUID stepId: ".concat(t)),await this.completeLineItem(e,t,"Completed via checkbox",null);return(await Da.default.put("/workflows/project/".concat(e,"/workflow/").concat(encodeURIComponent(t)),{completed:r})).data}catch(n){throw console.error("\u274c Error updating step:",n),n}}async getWorkflow(e){try{return(await Da.default.get("/workflows/project/".concat(e))).data}catch(t){throw console.error("\u274c Error getting workflow:",t),t}}subscribeToWorkflowUpdates(e,t){return window.socket?(window.socket.emit("join","project_".concat(e)),window.socket.on("workflow_updated",r=>{r.projectId===e&&(console.log("\ud83d\udce1 Received workflow update:",r),t(r))}),window.socket.on("alerts_refresh",()=>{console.log("\ud83d\udce8 Alerts refresh requested"),window.refreshAlerts&&window.refreshAlerts()}),()=>{window.socket.off("workflow_updated"),window.socket.off("alerts_refresh")}):()=>{}}},ns=rs,as={projects:["projects"],project:e=>["projects",e],projectStats:["projects","stats"],tasks:["tasks"],task:e=>["tasks",e],tasksByProject:e=>["tasks","project",e],tasksByUser:e=>["tasks","user",e],customers:["customers"],customer:e=>["customers",e],activities:["activities"],recentActivities:e=>["activities","recent",e],activitiesByProject:e=>["activities","project",e],notifications:["notifications"],unreadNotificationsCount:["notifications","unread-count"],documents:["documents"],documentsByProject:e=>["documents","project",e],calendarEvents:["calendar","events"],workflowAlerts:["workflow-alerts"],workflowAlertsByUser:e=>["workflow-alerts","user",e],workflowAlertsByProject:e=>["workflow-alerts","project",e],workflowAlertsSummary:["workflow-alerts","summary"],workflow:e=>["workflow","project",e],projectMessages:(e,t)=>["project-messages",e,t],projectMessageThread:e=>["project-messages","thread",e],feedback:["feedback"],feedbackByType:e=>["feedback","type",e],feedbackByUser:e=>["feedback","user",e],search:function(e){return["search",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"general",e]},currentUser:["auth","current-user"],teamMembers:["users","team-members"],rolesUsers:["roles","users"]},ss=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Pa({queryKey:[...as.projects,e],queryFn:()=>Da.projectsService.getAll(e),select:e=>{if(e&&e.success&&e.data)return{data:e.data,total:e.total,page:e.page,limit:e.limit,totalPages:e.totalPages};const t=(null===e||void 0===e?void 0:e.data)||e||[];return{data:Array.isArray(t)?t:[],total:Array.isArray(t)?t.length:0,page:1,limit:Array.isArray(t)?t.length:0,totalPages:1}},staleTime:0,retry:!1,refetchOnWindowFocus:!0})},os=e=>{let{colorMode:t,timing:r,onTimingChange:n,showFollowUp:a=!1,followUpTiming:s,onFollowUpTimingChange:i,label:l="Timing"}=e;const[c,d]=(0,o.useState)(!1),u=(e,t)=>{const a=(0,Y.A)((0,Y.A)({},r),{},{[e]:parseInt(t)||0});n(a)},h=(e,t)=>{const r=(0,Y.A)((0,Y.A)({},s),{},{[e]:parseInt(t)||0});i(r)},m=e=>{const t=[];return e.days>0&&t.push("".concat(e.days," day").concat(1!==e.days?"s":"")),e.hours>0&&t.push("".concat(e.hours," hour").concat(1!==e.hours?"s":"")),e.minutes>0&&t.push("".concat(e.minutes," minute").concat(1!==e.minutes?"s":"")),t.length>0?t.join(", "):"No timing set"};return(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"border rounded p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold ".concat(t?"text-white":"text-gray-800"),children:l}),(0,kt.jsx)("button",{type:"button",onClick:()=>d(!c),className:"text-xs px-2 py-1 rounded transition-colors ".concat(t?"text-blue-400 hover:bg-blue-900":"text-blue-600 hover:bg-blue-50"),children:c?"Hide Details":"Show Details"})]}),c?(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:r.days,onChange:e=>u("days",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:r.hours,onChange:e=>u("hours",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:r.minutes,onChange:e=>u("minutes",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]}):(0,kt.jsx)("div",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:m(r)})]}),a&&(0,kt.jsxs)("div",{className:"border rounded p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold ".concat(t?"text-white":"text-gray-800"),children:"Follow-up Timing (Optional)"}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",checked:s.enabled,onChange:e=>i((0,Y.A)((0,Y.A)({},s),{},{enabled:e.target.checked})),className:"mr-2"}),(0,kt.jsx)("span",{className:"text-xs ".concat(t?"text-gray-300":"text-gray-600"),children:"Override default follow-up timing"})]})]}),s.enabled&&(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:s.days,onChange:e=>h("days",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:s.hours,onChange:e=>h("hours",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:s.minutes,onChange:e=>h("minutes",e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]}),s.enabled&&(0,kt.jsx)("div",{className:"mt-2",children:(0,kt.jsxs)("div",{className:"text-xs ".concat(t?"text-gray-300":"text-gray-600"),children:["Follow-up will be sent: ",m(s)," after creation"]})})]})]})},is=e=>{let{activeCommTab:t,colorMode:n,showMessageDropdown:a,setShowMessageDropdown:s,projects:i,availableUsers:l,usersLoading:c=!1,subjects:d,currentUser:u,newMessageProject:h,setNewMessageProject:m,newMessageSubject:p,setNewMessageSubject:f,newMessageCustomSubject:g,setNewMessageCustomSubject:v,newMessageText:x,setNewMessageText:b,newMessageRecipients:y,setNewMessageRecipients:w,quickTaskSubject:j,setQuickTaskSubject:N,quickTaskDescription:S,setQuickTaskDescription:k,quickTaskDue:A,setQuickTaskDue:C,quickTaskAssignAll:E,setQuickTaskAssignAll:P,quickTaskAssigneeId:_,setQuickTaskAssigneeId:I,tasksProjectFilter:T,setTasksProjectFilter:L,reminderTitle:D,setReminderTitle:M,reminderDescription:O,setReminderDescription:R,reminderWhen:F,setReminderWhen:U,reminderAllUsers:B,setReminderAllUsers:z,reminderUserIds:W,setReminderUserIds:q,remindersProjectFilter:V,setRemindersProjectFilter:H,setMessagesData:G,setFeed:K,uiProjects:J,taskTiming:Y,setTaskTiming:X,taskFollowUpTiming:Q,setTaskFollowUpTiming:Z,reminderTiming:$,setReminderTiming:ee,reminderFollowUpTiming:te,setReminderFollowUpTiming:re}=e;const ne=Ct(),ae=Array.isArray(l)?l:[],[se,oe]=(0,o.useState)(!1),[ie,le]=(0,o.useState)(!1);return(0,kt.jsxs)("div",{className:"mb-3",children:[(0,kt.jsxs)("button",{onClick:()=>s(!a),className:"w-full px-2 py-1.5 text-xs font-medium border rounded-lg transition-all duration-300 flex items-center justify-between ".concat(a?"border-brand-400 bg-brand-50 text-brand-700 shadow-soft":"border-gray-200 bg-white text-gray-700 hover:bg-white hover:border-brand-400 hover:text-brand-600"),children:[(0,kt.jsx)("span",{children:"messages"===t?"+ Add Message":"tasks"===t?"+ Add Task":"+ Add Reminder"}),(0,kt.jsx)("svg",{className:"w-3 h-3 transition-transform ".concat(a?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&"messages"===t&&(0,kt.jsx)("div",{className:"p-2 border-t ".concat(n?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=p;if(h&&t&&x.trim()&&y.length>0){var n,a;const e=i.find(e=>e.id===parseInt(h)),o=async()=>{try{let n=Array.isArray(y)?[...y]:[];if(n.includes("all"))try{const e=await Promise.resolve().then(r.bind(r,4505)).then(e=>e.rolesService.getUsers());n=e&&e.success&&Array.isArray(e.data)?e.data.map(e=>String(e.id)):Array.isArray(ae)&&ae.length>0?ae.map(e=>String(e.id)):[]}catch(e){n=Array.isArray(ae)?ae.map(e=>String(e.id)):[]}const a=await Da.projectMessagesService.create(h,{content:x,subject:t,priority:"MEDIUM",recipients:n});a.success?(console.log("Message saved to database:",a.data),ne.invalidateQueries({queryKey:["project-messages"]})):console.error("Failed to save message to database:",a.message)}catch(n){console.error("Error saving message:",n)}};o();const l={id:"msg_".concat(Date.now()),projectId:parseInt(h),projectName:(null===e||void 0===e?void 0:e.projectName)||(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e||null===(n=e.customer)||void 0===n?void 0:n.primaryName)||(null===e||void 0===e||null===(a=e.client)||void 0===a?void 0:a.name)||(null===e||void 0===e?void 0:e.address)||"Unknown Project",projectNumber:(null===e||void 0===e?void 0:e.projectNumber)||Math.floor(9e4*Math.random())+1e4,subject:t,description:x,user:"You",timestamp:(new Date).toISOString(),type:"message",priority:"medium",recipients:y};G(e=>[l,...e]),K(e=>[l,...e]),s(!1),m(""),f(""),v(""),b(""),w([])}},className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Project ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{value:h,onChange:e=>m(e.target.value),required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Select Project"}),(i||[]).map(e=>{var t,r;return(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",e.projectName||e.name||(null===(t=e.customer)||void 0===t?void 0:t.primaryName)||(null===(r=e.client)||void 0===r?void 0:r.name)||e.address]},e.id)})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["To ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("div",{className:"flex justify-end -mt-3 mb-1",children:(0,kt.jsx)("button",{title:"Quick phrases",onClick:()=>oe(!0),className:"text-xs px-2 py-1 rounded bg-gray-100",children:"Quick Phrases"})}),h&&(()=>{const e=i.find(e=>e.id===parseInt(h)),t=(null===e||void 0===e?void 0:e.customer)||(null===e||void 0===e?void 0:e.client);return t?(0,kt.jsxs)("div",{className:"mb-2 relative",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsxs)("span",{className:"text-xs font-semibold ".concat(n?"text-gray-300":"text-gray-700"),children:["\ud83d\udccb ",t.primaryName||t.name||"Customer"]}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),le(!ie)},className:"transform transition-transform duration-200 ".concat(ie?"rotate-180":""),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),ie&&(0,kt.jsxs)("div",{className:"absolute left-0 top-full mt-1 z-50 bg-white border border-gray-300 rounded-lg shadow-xl p-2.5 min-w-[180px] text-[10px] space-y-1",children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900 border-b border-gray-200 pb-1 mb-1",children:t.primaryName||t.name||"Customer"}),t.primaryPhone&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udcde"}),(0,kt.jsx)("span",{className:"text-gray-700",children:t.primaryPhone})]}),t.primaryEmail&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udce7"}),(0,kt.jsx)("span",{className:"text-gray-700 break-all",children:t.primaryEmail})]}),t.primaryAddress&&(0,kt.jsxs)("div",{className:"flex items-start gap-1",children:[(0,kt.jsx)("span",{children:"\ud83d\udccd"}),(0,kt.jsx)("span",{className:"text-gray-700",children:t.primaryAddress})]}),!t.primaryPhone&&!t.primaryEmail&&!t.primaryAddress&&(0,kt.jsx)("div",{className:"text-gray-500 italic text-[9px]",children:"No contact details"})]})]}):null})(),(0,kt.jsxs)("select",{value:Array.isArray(y)?y:[],onChange:e=>{const t=Array.from(e.target.selectedOptions,e=>e.value);w(t)},multiple:!0,required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),style:{minHeight:"40px"},children:[(0,kt.jsx)("option",{value:"all",style:{fontWeight:"bold"},children:"All Users"}),c?(0,kt.jsx)("option",{value:"",disabled:!0,children:"Loading users..."}):0===ae.length?(0,kt.jsx)("option",{value:"",disabled:!0,children:"No users found"}):ae.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName||""," ",e.lastName?"":"(".concat(e.email||"",")")]},e.id))]}),(0,kt.jsx)("p",{className:"text-[10px] mt-1 ".concat(n?"text-gray-400":"text-gray-500"),children:"Hold Ctrl/Cmd to select multiple recipients"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Subject ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"text",placeholder:"Enter subject line...",value:p,onChange:e=>f(e.target.value),required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Message ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("textarea",{value:x,onChange:e=>b(e.target.value),placeholder:"Enter your message here...",required:!0,rows:2,className:"w-full px-2 py-1 border rounded text-xs resize-none ".concat(n?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1.5 pt-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{s(!1),m(""),f(""),v(""),b(""),w([])},className:"px-3 py-1.5 text-xs font-medium rounded border transition-colors ".concat(n?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!h||!("CUSTOM_SUBJECT"===p?g:p)||!x.trim()||0===y.length,className:"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(h&&("CUSTOM_SUBJECT"===p?g:p)&&x.trim()&&y.length>0?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Send Message"})]})]})}),(0,kt.jsx)(ts,{visible:se,onClose:()=>oe(!1),colorMode:n}),a&&"tasks"===t&&(0,kt.jsx)("div",{className:"p-2 border-t ".concat(n?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("form",{onSubmit:async e=>{var t;if(e.preventDefault(),!A)return void qr.error("Due date is required");const r=(null===u||void 0===u||null===(t=u.user)||void 0===t?void 0:t.id)||(null===u||void 0===u?void 0:u.id);if(r)try{var n,a,s;const e=new Date(A),t=24*Y.days*60*60*1e3+60*Y.hours*60*1e3+60*Y.minutes*1e3,o=t>0?t:6e4,c=new Date(e.getTime()+o),d={title:j.trim()||"Untitled Task",description:S||"",startTime:A,endTime:c.toISOString().slice(0,16),eventType:"DEADLINE",organizerId:r,projectId:T||void 0,attendees:E?l.map(e=>({userId:e.id})):_?[{userId:_}]:[],timing:Y,followUpTiming:Q.enabled?Q:null};console.log("Creating task with payload:",d);const h=await Da.calendarService.create(d),m=(null===h||void 0===h||null===(n=h.data)||void 0===n||null===(a=n.event)||void 0===a?void 0:a.id)||(null===h||void 0===h||null===(s=h.data)||void 0===s?void 0:s.id);ne.invalidateQueries({queryKey:as.calendarEvents}),console.log("\ud83d\udd0d Task creation debug:",{quickTaskAssignAll:E,quickTaskAssigneeId:_,availableUsersCount:l.length});let p="Unassigned";if(E)p="All Users";else if(_&&_.trim()){console.log("\ud83d\udd0d Looking for user with ID:",_),console.log("\ud83d\udd0d Available users:",l.map(e=>({id:e.id,name:e.name||"".concat(e.firstName," ").concat(e.lastName)})));const e=l.find(e=>String(e.id)===String(_));console.log("\ud83d\udd0d Found user:",e),p=e?e.name&&e.name.trim()?e.name:e.firstName&&e.firstName.trim()&&e.lastName&&e.lastName.trim()?"".concat(e.firstName," ").concat(e.lastName):e.firstName&&e.firstName.trim()?e.firstName:e.email&&e.email.trim()?e.email:"Unassigned":"Unassigned"}console.log("\ud83d\udd0d Final assignedToDisplay:",p);const f=E?l.map(e=>e.id):_?[_]:[];K(e=>[{id:m||"cal_".concat(Date.now()),type:"task",authorId:r,author:null!==u&&void 0!==u&&u.user?"".concat(u.user.firstName," ").concat(u.user.lastName):u?"".concat(u.firstName," ").concat(u.lastName):"You",assignedTo:p,assigneeId:_||null,assignedToAll:E||!1,attendees:f,projectId:T||null,projectName:(i.find(e=>String(e.id)===String(T))||{}).projectName||null,subject:j.trim()||"Untitled Task",content:S||"",timestamp:A},...e]),qr.success("Task created successfully"),N(""),k(""),C(""),P(!1),I(""),L("")}catch(o){console.error("Failed to create task:",o),qr.error("Failed to create task")}else qr.error("User not found. Please refresh and try again.")},className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Project"}),(0,kt.jsxs)("select",{value:T||"",onChange:e=>L(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"General (No Project)"}),(J||[]).map(e=>{var t;return(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.name]},e.id)})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Subject"}),(0,kt.jsx)("input",{value:j,onChange:e=>N(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),placeholder:"Task subject (optional)"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Task Due Date ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"datetime-local",value:A,onChange:e=>C(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Assign To"}),(0,kt.jsxs)("select",{value:_,onChange:e=>{I(e.target.value),P(!1)},className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Unassigned"}),c?(0,kt.jsx)("option",{value:"",disabled:!0,children:"Loading users..."}):0===ae.length?(0,kt.jsx)("option",{value:"",disabled:!0,children:"No users found"}):ae.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName||""," ",e.lastName?"":"(".concat(e.email||"",")")]},e.id))]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Description"}),(0,kt.jsx)("textarea",{value:S,onChange:e=>k(e.target.value),rows:2,className:"w-full px-2 py-1 border rounded text-xs resize-none ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]}),(0,kt.jsx)(os,{colorMode:n,timing:Y,onTimingChange:X,showFollowUp:!0,followUpTiming:Q,onFollowUpTimingChange:Z,label:"Start Task"}),(0,kt.jsx)("div",{className:"flex items-center",children:(0,kt.jsxs)("label",{className:"text-xs font-medium ".concat(n?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("input",{type:"checkbox",className:"mr-1",checked:E,onChange:e=>{P(e.target.checked),e.target.checked&&I("")}})," Send to all users"]})}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1.5 pt-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{s(!1),N(""),k(""),C(""),P(!1),I(""),L("")},className:"px-3 py-1.5 text-xs font-medium rounded border transition-colors ".concat(n?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!A,className:"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(A?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Create Task"})]})]})}),a&&"reminders"===t&&(0,kt.jsx)("div",{className:"p-2 border-t ".concat(n?"bg-[#1e293b] border-gray-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("form",{onSubmit:async e=>{var t;if(e.preventDefault(),!D.trim()||!F)return void qr.error("Title and date/time are required");const r=(null===u||void 0===u||null===(t=u.user)||void 0===t?void 0:t.id)||(null===u||void 0===u?void 0:u.id);if(r)try{var n,a,s;const e=new Date(F),t=24*$.days*60*60*1e3+60*$.hours*60*1e3+60*$.minutes*1e3,o=t>0?t:6e4,c=new Date(e.getTime()+o),d={title:D.trim(),description:O||"",startTime:F,endTime:c.toISOString().slice(0,16),eventType:"REMINDER",organizerId:r,projectId:V||void 0,attendees:B?l.map(e=>({userId:e.id})):W.length?W.map(e=>({userId:e})):[],timing:$,followUpTiming:te.enabled?te:null};console.log("Creating reminder with payload:",d);const h=await Da.calendarService.create(d),m=(null===h||void 0===h||null===(n=h.data)||void 0===n||null===(a=n.event)||void 0===a?void 0:a.id)||(null===h||void 0===h||null===(s=h.data)||void 0===s?void 0:s.id);ne.invalidateQueries({queryKey:as.calendarEvents});const p=B?l.map(e=>e.id):W.length?W:[];K(e=>[{id:m||"cal_".concat(Date.now()),type:"reminder",authorId:r,author:null!==u&&void 0!==u&&u.user?"".concat(u.user.firstName," ").concat(u.user.lastName):u?"".concat(u.firstName," ").concat(u.lastName):"You",recipients:p,projectId:V||null,projectName:(i.find(e=>String(e.id)===String(V))||{}).projectName||null,subject:D.trim(),content:O||"",timestamp:F},...e]),qr.success("Reminder created successfully"),M(""),R(""),U(""),z(!1),q([])}catch(o){console.error("Failed to create reminder:",o),qr.error("Failed to create reminder")}else qr.error("User not found. Please refresh and try again.")},className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["Title ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{value:D,onChange:e=>M(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),placeholder:"Reminder title"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:["When ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"datetime-local",value:F,onChange:e=>U(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Description"}),(0,kt.jsx)("textarea",{value:O,onChange:e=>R(e.target.value),rows:2,className:"w-full px-2 py-1 border rounded text-xs resize-none ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]}),(0,kt.jsx)(os,{colorMode:n,timing:$,onTimingChange:ee,showFollowUp:!0,followUpTiming:te,onFollowUpTimingChange:re,label:"Start Reminder"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(n?"text-gray-300":"text-gray-700"),children:"Recipients"}),(0,kt.jsx)("select",{multiple:!0,value:W,onChange:e=>q(Array.from(e.target.selectedOptions,e=>e.value)),className:"w-full px-2 py-1 border rounded text-xs ".concat(n?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"),style:{minHeight:"40px",color:n?"#ffffff":"#111827"},children:c?(0,kt.jsx)("option",{value:"",disabled:!0,style:{color:"#111827",backgroundColor:"#ffffff"},children:"Loading users..."}):0===ae.length?(0,kt.jsx)("option",{value:"",disabled:!0,style:{color:"#111827",backgroundColor:"#ffffff"},children:"No users found"}):ae.map(e=>(0,kt.jsxs)("option",{value:e.id,style:{color:"#111827",backgroundColor:"#ffffff"},children:[e.firstName," ",e.lastName||""," ",e.lastName?"":"(".concat(e.email||"",")")]},e.id))}),(0,kt.jsx)("p",{className:"text-[10px] mt-1 ".concat(n?"text-gray-400":"text-gray-500"),children:"Hold Ctrl/Cmd to select multiple recipients"})]}),(0,kt.jsx)("div",{className:"flex items-end",children:(0,kt.jsxs)("label",{className:"text-xs font-medium ".concat(n?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("input",{type:"checkbox",className:"mr-1",checked:B,onChange:e=>{z(e.target.checked),e.target.checked&&q([])}})," Send to all users"]})})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1.5 pt-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{s(!1),M(""),R(""),U(""),z(!1),q([])},className:"px-3 py-1.5 text-xs font-medium rounded border transition-colors ".concat(n?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!D.trim()||!F,className:"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(D.trim()&&F?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Create Reminder"})]})]})})]})},ls=e=>{let{open:t,onClose:r,project:n,colorMode:a,getProjectProgress:s,expandedTrades:i,toggleTrades:l,expandedAdditionalTrades:c,toggleAdditionalTrades:d}=e;const u=(0,o.useRef)(null),h=s(n);return(0,kt.jsxs)("div",{ref:u,className:"fixed z-50 top-0 right-0 h-full w-96 ".concat(a?"bg-slate-800 text-white":"bg-white text-gray-900"," shadow-2xl border-l ").concat(a?"border-slate-600":"border-gray-200"," transform transition-transform duration-300 ease-out"),style:{transform:t?"translateX(0)":"translateX(100%)"},"data-section":"project-progress-panel",children:[(0,kt.jsx)("div",{className:"px-6 py-4 border-b ".concat(a?"border-slate-600":"border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold",children:"Project Progress"}),(0,kt.jsxs)("p",{className:"text-sm ".concat(a?"text-gray-300":"text-gray-600"," mt-1"),children:[null===n||void 0===n?void 0:n.name," (",(0,kt.jsxs)("span",{className:"".concat(a?"text-blue-300":"text-blue-600"),children:["#",String((null===n||void 0===n?void 0:n.projectNumber)||"").padStart(5,"0")]}),")"]})]}),(0,kt.jsx)("button",{onClick:r,className:"p-2 rounded-lg hover:bg-opacity-10 transition-colors ".concat(a?"hover:bg-white":"hover:bg-gray-100"),"aria-label":"Close Progress Panel",children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,kt.jsxs)("div",{className:"p-6 space-y-6 overflow-y-auto h-full",children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Overall Progress"}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:"Complete project status"})]}),(0,kt.jsxs)("div",{className:"text-right",children:[(0,kt.jsxs)("span",{className:"text-2xl font-bold ".concat(100===h?"text-green-600":"text-blue-600"),children:[Math.round(h||0),"%"]}),(0,kt.jsx)("div",{className:"text-xs ".concat(100===h?"text-green-500":"text-blue-500"),children:100===h?"Complete":"In Progress"})]})]}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("div",{className:"w-full h-3 rounded-full overflow-hidden shadow-inner ".concat(a?"bg-slate-700":"bg-gray-200"),children:(0,kt.jsx)("div",{className:"h-full rounded-full transition-all duration-700 ease-out ".concat("bg-[#F8FAFC]"),style:{width:"".concat(Math.min(h||0,100),"%")},children:h>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})}),h>0&&(0,kt.jsx)("div",{className:"absolute top-1/2 transform -translate-y-1/2 w-3 h-3 rounded-full border-2 shadow-lg transition-all duration-700 ".concat(100===h?"bg-green-500 border-green-300":"bg-blue-500 border-blue-300"),style:{left:"calc(".concat(Math.min(h||0,100),"% - 6px)")}})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Phase Breakdown"}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:"Materials and labor progress"})]}),(0,kt.jsxs)("button",{onClick:()=>l(n.id),className:"flex items-center gap-1 text-xs font-medium hover:opacity-80 transition-opacity px-2 py-1 rounded ".concat(a?"text-gray-300 hover:bg-slate-700":"text-gray-600 hover:bg-gray-100"),children:[(0,kt.jsxs)("span",{children:[i.has(n.id)?"Hide":"Show"," Details"]}),(0,kt.jsx)("svg",{className:"w-3 h-3 transition-transform duration-200 ".concat(i.has(n.id)?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(0,kt.jsxs)("div",{className:"group",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:"Materials"})]}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:[s(n),"%"]})]}),(0,kt.jsx)("div",{className:"".concat(a?"bg-slate-700":"bg-gray-200"," w-full h-2 rounded-full overflow-hidden shadow-inner"),children:(0,kt.jsx)("div",{className:"h-full rounded-full bg-[#F8FAFC] transition-all duration-500 ease-out",style:{width:"".concat(s(n),"%")},children:s(n)>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})})]}),(0,kt.jsxs)("div",{className:"group",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Labor"})]}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-orange-600 dark:text-orange-400",children:[s(n),"%"]})]}),(0,kt.jsx)("div",{className:"".concat(a?"bg-slate-700":"bg-gray-200"," w-full h-2 rounded-full overflow-hidden shadow-inner"),children:(0,kt.jsx)("div",{className:"h-full rounded-full bg-[#F8FAFC] transition-all duration-500 ease-out",style:{width:"".concat(s(n),"%")},children:s(n)>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})})]})]}),i.has(n.id)&&(0,kt.jsxs)("div",{className:"space-y-3 pt-2 border-t border-gray-200/50",children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,kt.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Trade Progress"}),(0,kt.jsxs)("button",{onClick:()=>d(n.id),className:"flex items-center gap-1 text-xs font-medium hover:opacity-80 transition-opacity ".concat(a?"text-gray-300":"text-gray-600"),children:[(0,kt.jsx)("span",{children:c.has(n.id)?"Less":"More"}),(0,kt.jsx)("svg",{className:"w-3 h-3 transition-transform ".concat(c.has(n.id)?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(0,kt.jsx)("div",{className:"space-y-2",children:[{name:"Roofing",progress:s(n)},{name:"Siding",progress:s(n)},...c.has(n.id)?[{name:"Windows",progress:s(n)},{name:"Gutters",progress:s(n)}]:[]].map(e=>(0,kt.jsxs)("div",{className:"group",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,kt.jsx)("span",{className:"text-xs font-medium group-hover:text-blue-500 transition-colors",children:e.name}),(0,kt.jsxs)("span",{className:"text-xs font-bold text-gray-600 dark:text-gray-300",children:[e.progress,"%"]})]}),(0,kt.jsx)("div",{className:"".concat(a?"bg-slate-600":"bg-gray-200"," w-full h-1.5 bg-gray-200 rounded-full overflow-hidden"),children:(0,kt.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-500 ".concat("Roofing"===e.name?"bg-purple-500":"Siding"===e.name?"bg-pink-500":"Windows"===e.name?"bg-yellow-500":"Gutters"===e.name?"bg-red-500":"bg-blue-500"),style:{width:"".concat(e.progress,"%")}})})]},e.name))})]})]})]})};class cs{static getProjectWorkflowState(e){if(!e)return this.getDefaultState();const t="".concat(e.id,"_").concat(e.updatedAt||Date.now());if(this.cache.has(t))return this.cache.get(t);const r=this.calculateWorkflowState(e);return this.cache.set(t,r),r}static calculateWorkflowState(e){const t=e.currentWorkflowItem;let r="LEAD",n="Lead";t?(r=t.phase||"LEAD",n=t.phaseDisplay||this.formatPhaseDisplay(r)):e.phase&&(r=this.normalizePhaseKey(e.phase),n=this.formatPhaseDisplay(r));const a=Wn.calculateProjectProgress(e),s=this.getCurrentSection(e),o=this.getCurrentLineItem(e),i=this.getPhaseConfig(r);return{projectId:e.id,currentPhase:r,currentPhaseDisplay:this.formatPhaseDisplay(r),currentSection:s,currentSectionDisplay:this.formatSectionDisplay(s),currentLineItem:o,currentLineItemDisplay:this.formatLineItemDisplay(o),overallProgress:a.overall||0,phaseProgress:a.phaseBreakdown||{},hasPhaseOverride:a.hasPhaseOverride||!1,skippedPhases:a.skippedPhases||[],nextSteps:[],phaseConfig:i,phaseColor:i.color,phaseInitial:i.initial,phaseName:i.name,workflow:e.workflow,lastUpdated:(new Date).toISOString(),cacheKey:"".concat(e.id,"_").concat(e.updatedAt||Date.now())}}static getCurrentSection(e){return e&&e.currentWorkflowItem&&e.currentWorkflowItem.section||null}static getCurrentLineItem(e){return e&&e.currentWorkflowItem?{id:e.currentWorkflowItem.lineItemId,name:e.currentWorkflowItem.lineItem,section:e.currentWorkflowItem.section,phase:e.currentWorkflowItem.phase}:null}static getPhaseConfig(e){const t=Wn.getPhaseColor(e);return{id:e,name:Wn.getPhaseName(e),color:t.hex,bgClass:t.bg,textClass:t.text,initial:this.getPhaseInitial(e)}}static normalizePhaseKey(e){if(!e)return"LEAD";return{LEAD:"LEAD",PROSPECT:"PROSPECT",APPROVED:"APPROVED",EXECUTION:"EXECUTION",EXECUTE:"EXECUTION",SECOND_SUPP:"SECOND_SUPP","2ND_SUPP":"SECOND_SUPP",SUPPLEMENT:"SECOND_SUPP",COMPLETION:"COMPLETION",COMPLETE:"COMPLETION"}[e.toUpperCase().replace(/\s*PHASE$/i,"").replace("PHASE-","").replace("PHASE","").replace(/-INSURANCE-1ST SUPPLEMENT/i,"").replace("2ND SUPPLEMENT","SECOND_SUPP").replace("2ND SUPP","SECOND_SUPP").replace("EXECUTE","EXECUTION").trim()]||"LEAD"}static getPhaseInitial(e){return{LEAD:"L",PROSPECT:"P",APPROVED:"A",EXECUTION:"E",SECOND_SUPP:"S","2ND_SUPP":"S",COMPLETION:"C"}[e]||"L"}static formatPhaseDisplay(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"Lead"}static formatSectionDisplay(e){return e?e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Not Started"}static formatLineItemDisplay(e){return e?e.name||e.stepName||"Unknown Task":"No active task"}static getDefaultState(){return{projectId:null,currentPhase:"LEAD",currentPhaseDisplay:"Lead",currentSection:null,currentSectionDisplay:"Not Started",currentLineItem:null,currentLineItemDisplay:"No active task",overallProgress:0,phaseProgress:{},nextSteps:[],phaseConfig:this.getPhaseConfig("LEAD"),phaseColor:"#94A3B8",phaseInitial:"L",phaseName:"Lead",workflow:null,lastUpdated:(new Date).toISOString(),cacheKey:"default"}}static updateWorkflowState(e,t){const r=[];for(const a of this.cache.keys())a.startsWith("".concat(e,"_"))&&r.push(a);r.forEach(e=>this.cache.delete(e));const n=this.getProjectWorkflowState(t);return this.notifyListeners(e,n),n}static addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}static notifyListeners(e,t){this.listeners.forEach(r=>{try{r(e,t)}catch(n){console.error("Error notifying workflow listener:",n)}})}static clearCache(){this.cache.clear()}}cs.cache=new Map,cs.listeners=new Set;const ds=cs,us=["title","titleId"];function hs(e,t){let{title:r,titleId:n}=e,a=An(e,us);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const ms=o.forwardRef(hs),ps=["title","titleId"];function fs(e,t){let{title:r,titleId:n}=e,a=An(e,ps);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const gs=o.forwardRef(fs),vs=e=>{let{projects:t=[],PROJECT_PHASES:r=[],colorMode:n=!1,onProjectSelect:a,selectedPhase:s,setSelectedPhase:i,sortConfig:l,handleProjectSort:c,projectsLoading:d=!1,projectsError:u=null,refetchProjects:h,expandedPhases:m=new Set,teamMembers:p=[]}=e;Array.isArray(p)&&p.reduce((e,t)=>{try{if(null==t)return e;const r=null!=t.id?String(t.id):null;r&&(e[r]=t),t.email&&(e[String(t.email).toLowerCase()]=t),t.username&&(e[String(t.username).toLowerCase()]=t)}catch(Pr){}return e},{});const[f,g]=(0,o.useState)(new Set),v=e=>Wn.getProjectPhase(e),x=e=>{var t;return(null===(t=Wn.calculateProjectProgress(e))||void 0===t?void 0:t.overall)||0},b=s?"all"===s?t:t.filter(e=>String(v(e)).toUpperCase()===String(s).toUpperCase()):[];return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200/50 shadow-soft rounded-2xl p-4","data-section":"project-phases",children:[(0,kt.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,kt.jsx)("div",{children:(0,kt.jsx)("h2",{className:"text-xl font-bold bg-[#F8FAFC] bg-clip-text text-transparent mb-1",children:"Current Projects by Phase"})})}),(0,kt.jsx)("div",{className:"mb-3",children:(0,kt.jsxs)("div",{className:"w-full flex items-center gap-3",children:[(0,kt.jsxs)("button",{onClick:()=>i("all"===s?null:"all"),className:"h-12 px-4 text-sm font-semibold rounded-xl transition-all duration-300 border-2 flex items-center justify-center gap-2 hover:shadow-medium flex-shrink-0 ".concat("all"===s?"border-blue-600 bg-blue-50 shadow-medium text-blue-800":"border-gray-200 bg-white text-gray-700 hover:bg-white hover:border-gray-300 hover:shadow-soft"),style:{minWidth:72},children:[(0,kt.jsx)("div",{className:"h-5 w-5 bg-blue-600 flex-shrink-0 shadow-sm flex items-center justify-center text-white text-sm font-bold transform rotate-45",children:(0,kt.jsx)("span",{className:"transform -rotate-45",children:Array.isArray(t)?t.length:0})}),(0,kt.jsx)("span",{className:"text-xs font-semibold",children:"All"})]}),(0,kt.jsx)("div",{className:"flex-1 grid grid-cols-6 gap-3",children:r.map(e=>{const r=Array.isArray(t)?t.filter(t=>String(v(t)).toUpperCase()===String(e.id).toUpperCase()).length:0;return(0,kt.jsxs)("button",{onClick:()=>i(s===e.id?null:e.id),className:"min-h-14 py-2 px-4 text-base font-semibold rounded-2xl transition-all duration-300 border-2 flex items-center justify-center gap-3 hover:shadow-medium ".concat(s===e.id?"border-blue-500 bg-blue-50 shadow-medium text-blue-900":"border-gray-200 bg-white text-gray-800 hover:bg-white hover:border-gray-300 hover:shadow-soft"),children:[(0,kt.jsx)("div",{className:"h-8 w-8 flex-shrink-0 shadow-sm flex items-center justify-center text-sm font-bold transform rotate-45 ".concat((e=>{switch(e){case"LEAD":case"APPROVED":default:return"text-black";case"PROSPECT":case"EXECUTION":case"SECOND_SUPPLEMENT":case"COMPLETION":return"text-white"}})(e.id)),style:{backgroundColor:e.color},title:"".concat(e.name," projects"),children:(0,kt.jsx)("span",{className:"transform -rotate-45",children:r})}),(0,kt.jsx)("span",{className:"text-base font-semibold leading-tight text-center whitespace-normal break-words",children:e.name})]},e.id)})})]})}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"w-full text-sm min-w-full",children:[0===b.length?null:(0,kt.jsx)("thead",{children:(0,kt.jsxs)("tr",{className:"border-b ".concat(n?"border-gray-600":"border-gray-200"),children:[(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:"Phase"}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:(0,kt.jsxs)("button",{onClick:()=>c&&c("projectNumber"),className:"flex items-center gap-1 hover:underline ".concat(n?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800"),children:["Project #","projectNumber"===(null===l||void 0===l?void 0:l.key)&&(0,kt.jsx)("span",{className:"text-xs",children:"asc"===l.direction?"\u2191":"\u2193"})]})}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:(0,kt.jsxs)("button",{onClick:()=>c&&c("primaryContact"),className:"flex items-center gap-1 hover:underline ".concat(n?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800"),children:["Primary Contact","primaryContact"===(null===l||void 0===l?void 0:l.key)&&(0,kt.jsx)("span",{className:"text-xs",children:"asc"===l.direction?"\u2191":"\u2193"})]})}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:(0,kt.jsxs)("button",{onClick:()=>c&&c("projectType"),className:"flex items-center gap-1 hover:underline ".concat(n?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800"),children:["Project Type","projectType"===(null===l||void 0===l?void 0:l.key)&&(0,kt.jsx)("span",{className:"text-xs",children:"asc"===l.direction?"\u2191":"\u2193"})]})}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:(0,kt.jsxs)("button",{onClick:()=>c&&c("progress"),className:"flex items-center gap-1 hover:underline ".concat(n?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800"),children:["Progress","progress"===(null===l||void 0===l?void 0:l.key)&&(0,kt.jsx)("span",{className:"text-xs",children:"asc"===l.direction?"\u2191":"\u2193"})]})}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:"Messages"}),(0,kt.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium whitespace-nowrap ".concat(n?"text-gray-300":"text-gray-600"),children:"Workflow"})]})}),(0,kt.jsx)("tbody",{children:(()=>{if(d)return(0,kt.jsx)("tr",{children:(0,kt.jsx)("td",{colSpan:"7",className:"text-center py-8",children:(0,kt.jsx)("div",{className:"text-brand-600",children:"Loading projects..."})})});if(u&&(!t||0===t.length))return(0,kt.jsx)("tr",{children:(0,kt.jsxs)("td",{colSpan:"7",className:"text-center py-8",children:[(0,kt.jsxs)("div",{className:"text-red-600 mb-4",children:[(0,kt.jsx)("div",{className:"font-semibold",children:"Error loading projects:"}),(0,kt.jsx)("div",{className:"text-sm",children:String((null===u||void 0===u?void 0:u.message)||u||"Unknown error")}),(0,kt.jsx)("div",{className:"text-xs mt-2 text-gray-500",children:"This often happens after navigating back from Project Workflow. Try refreshing the data."})]}),(0,kt.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,kt.jsx)("button",{onClick:async()=>{try{await(null===h||void 0===h?void 0:h())}catch(Pr){}},className:"px-4 py-2 bg-brand-500 text-white rounded hover:bg-[var(--color-primary-blueprint-blue)] transition-colors",disabled:d,children:d?"Retrying...":"Retry"}),(0,kt.jsx)("button",{onClick:()=>{window.location.reload()},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Refresh Page"})]})]})});if(!t||0===t.length)return(0,kt.jsx)("tr",{children:(0,kt.jsx)("td",{colSpan:"7",className:"text-center py-8",children:(0,kt.jsx)("div",{className:"text-gray-600",children:"No projects found"})})});const e=(()=>{let e=b;if(null===l||void 0===l||!l.key)return e;const t="asc"===l.direction?1:-1;return[...e].sort((e,r)=>{var n,a,s,o;let i,c;switch(l.key){case"projectNumber":i=e.projectNumber||e.id,c=r.projectNumber||r.id;break;case"primaryContact":i=(null===(n=e.client)||void 0===n?void 0:n.name)||e.clientName||(null===(a=e.customer)||void 0===a?void 0:a.primaryName)||"",c=(null===(s=r.client)||void 0===s?void 0:s.name)||r.clientName||(null===(o=r.customer)||void 0===o?void 0:o.primaryName)||"";break;case"projectManager":i="object"===typeof e.projectManager&&null!==e.projectManager?e.projectManager.name||"".concat(e.projectManager.firstName||""," ").concat(e.projectManager.lastName||"").trim()||"":e.projectManager||"",c="object"===typeof r.projectManager&&null!==r.projectManager?r.projectManager.name||"".concat(r.projectManager.firstName||""," ").concat(r.projectManager.lastName||"").trim()||"":r.projectManager||"";break;case"projectType":i=e.projectType||"N/A",c=r.projectType||"N/A";break;case"phase":i=v(e)||"",c=v(r)||"";break;case"progress":i=x(e)||0,c=x(r)||0;break;default:i="",c=""}return"string"===typeof i&&(i=i.toLowerCase(),c=c.toLowerCase()),i<c?-1*t:i>c?1*t:0})})();if(!s)return null;if(0===b.length&&s&&!d){var i;const e="all"===s?"All Projects":(null===(i=r.find(e=>e.id===s))||void 0===i?void 0:i.name)||s;return(0,kt.jsx)("tr",{children:(0,kt.jsx)("td",{colSpan:"8",className:"text-center py-12",children:(0,kt.jsxs)("div",{className:"".concat(n?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)("div",{className:"text-4xl mb-3",children:"\ud83d\udccb"}),(0,kt.jsxs)("div",{className:"font-medium text-sm mb-1",children:["No projects in ",e]}),(0,kt.jsx)("div",{className:"text-xs",children:"Projects will appear here when they are in this phase"})]})})})}return e.map(e=>{var t,s,i,l,c,d;const u=v(e),h=r.find(e=>e.id===u)||r[0],p=(e.projectManager||e.pm||e.projectManagerId||e.projectManagerName||e.pmName,(null===(t=e.client)||void 0===t?void 0:t.name)||e.clientName||(null===(s=e.customer)||void 0===s?void 0:s.primaryName)||""),b=e.projectType||"N/A";return(0,kt.jsxs)(o.Fragment,{children:[(0,kt.jsxs)("tr",{"data-project-id":e.id,className:"border-b ".concat(n?"border-gray-600":"border-gray-200"," hover:bg-gray-50 transition-colors duration-300"),children:[(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",style:{backgroundColor:null===h||void 0===h?void 0:h.color,color:Wn.getContrastTextColor((null===h||void 0===h?void 0:h.color)||"#000")},title:"Phase: ".concat(null===h||void 0===h?void 0:h.name),children:null===h||void 0===h?void 0:h.initial})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("button",{onClick:()=>{const t=(0,Y.A)((0,Y.A)({},e),{},{dashboardState:{selectedPhase:null===h||void 0===h?void 0:h.id,expandedPhases:Array.from(m||[]),scrollToProject:e,projectSourceSection:"Project Phases"}});a&&a(t,"Profile",null,"Project Phases")},className:"text-sm font-bold hover:underline cursor-pointer transition-colors text-blue-600 hover:text-blue-800",children:String(e.projectNumber||e.id).padStart(5,"0")})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap max-w-32",children:e.customer||e.client?(0,kt.jsxs)("details",{className:"inline-block",children:[(0,kt.jsxs)("summary",{className:"cursor-pointer text-sm font-semibold text-gray-700 flex items-center gap-1 hover:text-gray-900",children:[(0,kt.jsx)("span",{className:"truncate",children:p}),(0,kt.jsx)("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),(0,kt.jsx)("div",{className:"mt-1 border rounded ".concat(n?"border-gray-600 bg-[#232b4d]":"border-gray-300 bg-white"," p-2 text-xs space-y-1 shadow-lg min-w-[200px]"),children:(()=>{const t=e.customer||e.client;return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"font-semibold border-b pb-1 mb-1 ".concat(n?"text-gray-200 border-gray-600":"text-gray-900 border-gray-200"),children:t.primaryName||t.name||p}),t.primaryPhone&&(0,kt.jsxs)("div",{className:n?"text-gray-300":"text-gray-700",children:[(0,kt.jsx)("strong",{children:"\ud83d\udcde Phone:"})," ",t.primaryPhone]}),t.primaryEmail&&(0,kt.jsxs)("div",{className:n?"text-gray-300":"text-gray-700",children:[(0,kt.jsx)("strong",{children:"\ud83d\udce7 Email:"})," ",t.primaryEmail]}),t.primaryAddress&&(0,kt.jsxs)("div",{className:n?"text-gray-300":"text-gray-700",children:[(0,kt.jsx)("strong",{children:"\ud83d\udccd Address:"})," ",t.primaryAddress]}),!t.primaryPhone&&!t.primaryEmail&&!t.primaryAddress&&(0,kt.jsx)("div",{className:"text-gray-500 italic",children:"No contact details available"})]})})()})]}):(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-700 truncate",children:p})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-md text-[10px] font-medium border ".concat(n?Xa(b):Ya(b)),children:Ja(b)})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2 min-w-[160px]",children:[(0,kt.jsx)("button",{onClick:()=>(e=>{const t=new Set(f);t.has(e)?t.delete(e):t.add(e),g(t)})(e.id),className:"p-1.5 hover:bg-blue-50 rounded-lg transition-all",title:"View phase breakdown",children:f.has(e.id)?(0,kt.jsx)(ms,{className:"h-4 w-4 text-blue-600"}):(0,kt.jsx)(gs,{className:"h-4 w-4 text-gray-500"})}),(0,kt.jsx)("div",{className:"flex-1",children:(0,kt.jsx)("div",{className:"flex items-center gap-2",children:(0,kt.jsxs)("div",{className:"flex-1 h-8 bg-[#F8FAFC] rounded-lg overflow-hidden relative border border-gray-300 shadow-sm",children:[(0,kt.jsx)("div",{className:"h-full transition-all duration-700 ease-out relative",style:{width:"".concat(x(e),"%"),background:"linear-gradient(90deg, \n                                      #3b82f6 0%, \n                                      #2563eb ".concat(Math.min(.5*x(e),50),"%, \n                                      #1d4ed8 100%)")},children:(0,kt.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/10 to-transparent"})}),(0,kt.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,kt.jsxs)("span",{className:"text-xs font-bold text-gray-800 drop-shadow-sm px-2",children:[x(e),"%"]})})]})})})]})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("button",{onClick:()=>{const t=(0,Y.A)((0,Y.A)({},e),{},{dashboardState:{selectedPhase:null===h||void 0===h?void 0:h.id,expandedPhases:Array.from(m||[]),scrollToProject:e,projectSourceSection:"Project Phases"}});a&&a(t,"Messages",null,"Project Phases")},className:"inline-flex items-center justify-center w-16 h-6 border border-brand-500 text-black rounded-md hover:bg-brand-50 transition-colors text-[10px] font-semibold",children:"Messages"})}),(0,kt.jsx)("td",{className:"py-2 px-2 whitespace-nowrap",children:(0,kt.jsx)("button",{onClick:async()=>{if(a)try{const t=await Da.default.get("/workflow-data/project-position/".concat(e.id));if(t.data){const r=t.data;if(r.success&&r.data){const t=r.data,n=t.currentLineItemId||t.currentLineItem,s=t.currentSectionId||t.currentSection;console.log("\ud83d\udd0d WORKFLOW_NAV: position:",t),console.log("\ud83d\udd0d WORKFLOW_NAV: targetLineItemId:",n),console.log("\ud83d\udd0d WORKFLOW_NAV: targetSectionId:",s);const o=(0,Y.A)((0,Y.A)({},e),{},{dashboardState:{selectedPhase:null===h||void 0===h?void 0:h.id,expandedPhases:Array.from(m||[]),scrollToProject:e}});a(o,"Project Workflow",null,"Project Phases",n,s)}else a(e,"Project Workflow",null,"Project Phases")}else a(e,"Project Workflow",null,"Project Phases")}catch(t){console.error("\u274c WORKFLOW_NAV: Error getting position:",t),a(e,"Project Workflow",null,"Project Phases")}},className:"inline-flex items-center justify-center w-16 h-6 border border-brand-500 text-black rounded-md hover:bg-brand-50 transition-colors text-[10px] font-semibold",children:"Workflow"})})]}),f.has(e.id)&&(0,kt.jsx)("tr",{className:"bg-blue-50/50",children:(0,kt.jsx)("td",{colSpan:"8",className:"py-4 px-6",children:(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),"Current Workflow Status"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[(0,kt.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Current Section"}),(0,kt.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:(null===(i=e.currentWorkflowItem)||void 0===i?void 0:i.section)||"Not Started"})]}),(0,kt.jsxs)("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[(0,kt.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Active Task"}),(0,kt.jsx)("div",{className:"text-sm font-semibold text-gray-900 truncate",children:(null===(l=e.currentWorkflowItem)||void 0===l?void 0:l.lineItem)||"No active task"})]}),(0,kt.jsxs)("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[(0,kt.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Completed Tasks"}),(0,kt.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:[(null===(c=e.currentWorkflowItem)||void 0===c||null===(d=c.completedItems)||void 0===d?void 0:d.length)||0," tasks"]})]})]})]}),e.additionalTrades&&e.additionalTrades.length>0&&(0,kt.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,kt.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-purple-600 rounded-full"}),"Additional Trades (",e.additionalTrades.length,")"]}),(0,kt.jsx)("div",{className:"grid grid-cols-2 gap-3",children:e.additionalTrades.map((e,t)=>{var r;return(0,kt.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-white rounded-lg border border-gray-200",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:(0,kt.jsx)("span",{className:"text-xs font-bold text-purple-700",children:(null===(r=e.name)||void 0===r?void 0:r.charAt(0))||"?"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("p",{className:"text-xs font-semibold text-gray-900 truncate",children:e.name||"Unknown Trade"}),e.status&&(0,kt.jsx)("p",{className:"text-[10px] text-gray-500",children:e.status})]}),void 0!==e.progress&&(0,kt.jsx)("div",{className:"flex-shrink-0 w-12 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full bg-purple-600 transition-all",style:{width:"".concat(e.progress||0,"%")}})})]},t)})})]})]})})})]},e.id)})})()})]})})})]})},xs=[{id:1,projectName:"Johnson Residence Roof Replacement",projectNumber:"PRJ-001",startDate:"2025-09-15",endDate:"2025-10-30",status:"active",budget:12500,expenses:8750,responsibleTeam:"Team Alpha",priority:"High",clientName:"Robert Johnson",clientEmail:"robert.johnson@email.com",projectManager:"Sarah Owner",phase:"execution"},{id:2,projectName:"Smith Commercial Roof Repair",projectNumber:"PRJ-002",startDate:"2025-09-01",endDate:"2025-11-15",status:"active",budget:35e3,expenses:15200,responsibleTeam:"Team Beta",priority:"Medium",clientName:"Smith Corporation",clientEmail:"contact@smithcorp.com",projectManager:"Mike Foreman",phase:"prospect"},{id:3,projectName:"Williams Garage Roof Installation",projectNumber:"PRJ-003",startDate:"2025-08-20",endDate:"2025-09-25",status:"completed",budget:8500,expenses:7200,responsibleTeam:"Team Gamma",priority:"Low",clientName:"Jennifer Williams",clientEmail:"jenn.williams@email.com",projectManager:"Sarah Owner",phase:"completion"},{id:4,projectName:"Davis Apartment Complex Roofing",projectNumber:"PRJ-004",startDate:"2025-10-05",endDate:"2025-12-20",status:"planning",budget:45e3,expenses:0,responsibleTeam:"Team Delta",priority:"High",clientName:"Davis Properties LLC",clientEmail:"info@davisproperties.com",projectManager:"Tom Supervisor",phase:"lead"},{id:5,projectName:"Miller Office Building Roof Maintenance",projectNumber:"PRJ-005",startDate:"2025-09-10",endDate:"2025-10-10",status:"active",budget:18500,expenses:9800,responsibleTeam:"Team Epsilon",priority:"Medium",clientName:"Miller & Associates",clientEmail:"miller@business.com",projectManager:"Lisa Manager",phase:"approved"}],bs=[{id:"message_1",projectId:1,projectName:"Johnson Residence Roof Replacement",type:"project_update",subject:"Material Delivery Update",description:"Shingles delivered and ready for installation tomorrow",user:"Mike Foreman",timestamp:"2025-09-24T10:30:00Z",priority:"medium"},{id:"message_2",projectId:2,projectName:"Smith Commercial Roof Repair",type:"customer_communication",subject:"Client Meeting Notes",description:"Discussed additional waterproofing requirements for the east wing",user:"Sarah Owner",timestamp:"2025-09-23T14:15:00Z",priority:"high"},{id:"message_3",projectId:1,projectName:"Johnson Residence Roof Replacement",type:"schedule_change",subject:"Schedule Adjustment",description:"Installation delayed by one day due to weather forecast",user:"Tom Supervisor",timestamp:"2025-09-23T09:45:00Z",priority:"medium"},{id:"message_4",projectId:3,projectName:"Williams Garage Roof Installation",type:"project_update",subject:"Project Completion",description:"Final inspection passed. Project officially completed",user:"Lisa Manager",timestamp:"2025-09-22T16:20:00Z",priority:"low"},{id:"message_5",projectId:4,projectName:"Davis Apartment Complex Roofing",type:"documentation",subject:"Permit Status",description:"Building permits approved and on file",user:"Robert Johnson",timestamp:"2025-09-22T11:30:00Z",priority:"high"},{id:"message_6",projectId:5,projectName:"Miller Office Building Roof Maintenance",type:"quality_check",subject:"Safety Inspection Results",description:"All safety protocols met. Work can proceed as scheduled",user:"Mike Foreman",timestamp:"2025-09-21T13:45:00Z",priority:"medium"},{id:"message_7",projectId:2,projectName:"Smith Commercial Roof Repair",type:"budget_discussion",subject:"Budget Approval",description:"Client approved additional materials budget",user:"Sarah Owner",timestamp:"2025-09-21T10:15:00Z",priority:"high"},{id:"message_8",projectId:1,projectName:"Johnson Residence Roof Replacement",type:"crew_assignment",subject:"Crew Schedule Update",description:"Added two additional roofers to the team for faster completion",user:"Tom Supervisor",timestamp:"2025-09-20T08:30:00Z",priority:"medium"},{id:"message_9",projectId:2,projectName:"Smith Commercial Roof Repair",type:"site_inspection",subject:"Site Inspection Scheduled",description:"City inspector scheduled for Friday 10:00 AM",user:"Mike Foreman",timestamp:"2025-09-20T15:00:00Z",priority:"medium"},{id:"message_10",projectId:4,projectName:"Davis Apartment Complex Roofing",type:"material_delivery",subject:"Materials Delayed",description:"Supplier reported a 24-hour delay due to logistics",user:"Lisa Manager",timestamp:"2025-09-19T09:20:00Z",priority:"high"}],ys=["className","width","height"],ws=["className","width","height"],js=e=>{let{className:t="",width:r,height:n}=e,a=An(e,ys);return(0,kt.jsx)("div",(0,Y.A)({className:"animate-pulse bg-gray-200 rounded ".concat(t),style:{width:r,height:n}},a))},Ns=e=>{let{className:t="",width:r,height:n}=e,a=An(e,ws);return(0,kt.jsx)("div",(0,Y.A)({className:"animate-pulse bg-slate-700 rounded ".concat(t),style:{width:r,height:n}},a))},Ss=e=>{let{colorMode:t=!1}=e;const r=t?Ns:js;return(0,kt.jsxs)("div",{className:"".concat(t?"bg-slate-800 border-slate-600":"bg-white border-gray-200"," border rounded-lg shadow-sm p-4 space-y-4"),children:[(0,kt.jsx)("div",{className:"flex items-center justify-between",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)(r,{className:"w-6 h-6 rounded-full"}),(0,kt.jsx)(r,{className:"h-5 w-20"}),(0,kt.jsx)(r,{className:"h-4 w-16"}),(0,kt.jsx)(r,{className:"h-4 w-12"})]})}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)(r,{className:"h-4 w-32"}),(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)(r,{className:"h-3 w-24"}),(0,kt.jsx)(r,{className:"h-3 w-32"})]}),(0,kt.jsx)(r,{className:"h-3 w-48"})]}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)(r,{className:"h-3 w-16"}),(0,kt.jsx)(r,{className:"h-3 w-8"})]}),(0,kt.jsx)(r,{className:"h-3 w-full"})]}),(0,kt.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3].map(e=>(0,kt.jsxs)("div",{className:"p-2 rounded border ".concat(t?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)(r,{className:"h-3 w-16 mb-2"}),(0,kt.jsx)(r,{className:"h-2 w-20 mb-1"}),(0,kt.jsx)(r,{className:"h-2 w-24"})]},e))}),(0,kt.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,5,6].map(e=>(0,kt.jsx)(r,{className:"h-12 w-full"},e))})]})},ks=e=>{let{message:t="Something went wrong",onRetry:r,colorMode:n=!1}=e;return(0,kt.jsxs)("div",{className:"".concat(n?"bg-slate-800 border-slate-600":"bg-white border-gray-200"," border rounded-lg p-8 text-center"),children:[(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsx)("svg",{className:"w-12 h-12 text-red-400 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(n?"text-white":"text-gray-900"," mb-2"),children:"Oops! Something went wrong"}),(0,kt.jsx)("p",{className:"".concat(n?"text-gray-300":"text-gray-600"," mb-4"),children:t}),r&&(0,kt.jsx)("button",{onClick:r,className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]})},As=Object.create(null);As.open="0",As.close="1",As.ping="2",As.pong="3",As.message="4",As.upgrade="5",As.noop="6";const Cs=Object.create(null);Object.keys(As).forEach(e=>{Cs[As[e]]=e});const Es={type:"error",data:"parser error"},Ps="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),_s="function"===typeof ArrayBuffer,Is=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Ts=(e,t,r)=>{let{type:n,data:a}=e;return Ps&&a instanceof Blob?t?r(a):Ls(a,r):_s&&(a instanceof ArrayBuffer||Is(a))?t?r(a):Ls(new Blob([a]),r):r(As[n]+(a||""))},Ls=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function Ds(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Ms;const Os="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Rs="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let ZI=0;ZI<64;ZI++)Rs[Os.charCodeAt(ZI)]=ZI;const Fs="function"===typeof ArrayBuffer,Us=(e,t)=>{if("string"!==typeof e)return{type:"message",data:zs(e,t)};const r=e.charAt(0);if("b"===r)return{type:"message",data:Bs(e.substring(1),t)};return Cs[r]?e.length>1?{type:Cs[r],data:e.substring(1)}:{type:Cs[r]}:Es},Bs=(e,t)=>{if(Fs){const r=(e=>{let t,r,n,a,s,o=.75*e.length,i=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const c=new ArrayBuffer(o),d=new Uint8Array(c);for(t=0;t<i;t+=4)r=Rs[e.charCodeAt(t)],n=Rs[e.charCodeAt(t+1)],a=Rs[e.charCodeAt(t+2)],s=Rs[e.charCodeAt(t+3)],d[l++]=r<<2|n>>4,d[l++]=(15&n)<<4|a>>2,d[l++]=(3&a)<<6|63&s;return c})(e);return zs(r,t)}return{base64:!0,data:e}},zs=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Ws=String.fromCharCode(30);function qs(){return new TransformStream({transform(e,t){!function(e,t){Ps&&e.data instanceof Blob?e.data.arrayBuffer().then(Ds).then(t):_s&&(e.data instanceof ArrayBuffer||Is(e.data))?t(Ds(e.data)):Ts(e,!1,e=>{Ms||(Ms=new TextEncoder),t(Ms.encode(e))})}(e,r=>{const n=r.length;let a;if(n<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,n);else if(n<65536){a=new Uint8Array(3);const e=new DataView(a.buffer);e.setUint8(0,126),e.setUint16(1,n)}else{a=new Uint8Array(9);const e=new DataView(a.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(n))}e.data&&"string"!==typeof e.data&&(a[0]|=128),t.enqueue(a),t.enqueue(r)})}})}let Vs;function Hs(e){return e.reduce((e,t)=>e+t.length,0)}function Gs(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let n=0;for(let a=0;a<t;a++)r[a]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function Ks(e){if(e)return function(e){for(var t in Ks.prototype)e[t]=Ks.prototype[t];return e}(e)}Ks.prototype.on=Ks.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Ks.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},Ks.prototype.off=Ks.prototype.removeListener=Ks.prototype.removeAllListeners=Ks.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<n.length;a++)if((r=n[a])===t||r.fn===t){n.splice(a,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},Ks.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var a=(r=r.slice(0)).length;n<a;++n)r[n].apply(this,t)}return this},Ks.prototype.emitReserved=Ks.prototype.emit,Ks.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Ks.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Js="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Ys="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function Xs(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}const Qs=Ys.setTimeout,Zs=Ys.clearTimeout;function $s(e,t){t.useNativeTimers?(e.setTimeoutFn=Qs.bind(Ys),e.clearTimeoutFn=Zs.bind(Ys)):(e.setTimeoutFn=Ys.setTimeout.bind(Ys),e.clearTimeoutFn=Ys.clearTimeout.bind(Ys))}function eo(e){return"string"===typeof e?function(e){let t=0,r=0;for(let n=0,a=e.length;n<a;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(e):Math.ceil(1.33*(e.byteLength||e.size))}function to(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class ro extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class no extends Ks{constructor(e){super(),this.writable=!1,$s(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new ro(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Us(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}class ao extends no{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(Ws),n=[];for(let a=0;a<r.length;a++){const e=Us(r[a],t);if(n.push(e),"error"===e.type)break}return n})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let a=0;e.forEach((e,s)=>{Ts(e,!1,e=>{n[s]=e,++a===r&&t(n.join(Ws))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=to()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let so=!1;try{so="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(XI){}const oo=so;function io(){}class lo extends ao{constructor(e){if(super(e),"undefined"!==typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class co extends Ks{constructor(e,t,r){super(),this.createRequest=e,$s(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=void 0!==r.data?r.data:null,this._create()}_create(){var e;const t=Xs(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(_t){}if("POST"===this._method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(_t){}try{r.setRequestHeader("Accept","*/*")}catch(_t){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var e;3===r.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(r.getResponseHeader("set-cookie"))),4===r.readyState&&(200===r.status||1223===r.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"===typeof r.status?r.status:0)},0))},r.send(this._data)}catch(_t){return void this.setTimeoutFn(()=>{this._onError(_t)},0)}"undefined"!==typeof document&&(this._index=co.requestsCount++,co.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if("undefined"!==typeof this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=io,e)try{this._xhr.abort()}catch(_t){}"undefined"!==typeof document&&delete co.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(co.requestsCount=0,co.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",uo);else if("function"===typeof addEventListener){addEventListener("onpagehide"in Ys?"pagehide":"unload",uo,!1)}function uo(){for(let e in co.requests)co.requests.hasOwnProperty(e)&&co.requests[e].abort()}const ho=function(){const e=mo({xdomain:!1});return e&&null!==e.responseType}();function mo(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||oo))return new XMLHttpRequest}catch(_t){}if(!t)try{return new(Ys[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(_t){}}const po="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class fo extends no{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=po?{}:Xs(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(XI){return this.emitReserved("error",XI)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;Ts(r,this.supportsBinary,e=>{try{this.doWrite(r,e)}catch(_t){}n&&Js(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){"undefined"!==typeof this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=to()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const go=Ys.WebSocket||Ys.MozWebSocket;const vo={websocket:class extends fo{createSocket(e,t,r){return po?new go(e,t,r):t?new go(e,t):new go(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends no{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(XI){return this.emitReserved("error",XI)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){Vs||(Vs=new TextDecoder);const r=[];let n=0,a=-1,s=!1;return new TransformStream({transform(o,i){for(r.push(o);;){if(0===n){if(Hs(r)<1)break;const e=Gs(r,1);s=128===(128&e[0]),a=127&e[0],n=a<126?3:126===a?1:2}else if(1===n){if(Hs(r)<2)break;const e=Gs(r,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(Hs(r)<8)break;const e=Gs(r,8),t=new DataView(e.buffer,e.byteOffset,e.length),s=t.getUint32(0);if(s>Math.pow(2,21)-1){i.enqueue(Es);break}a=s*Math.pow(2,32)+t.getUint32(4),n=3}else{if(Hs(r)<a)break;const e=Gs(r,a);i.enqueue(Us(s?e:Vs.decode(e),t)),n=0}if(0===a||a>e){i.enqueue(Es);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),n=qs();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const a=()=>{r.read().then(e=>{let{done:t,value:r}=e;t||(this.onPacket(r),a())}).catch(e=>{})};a();const s={type:"open"};this.query.sid&&(s.data='{"sid":"'.concat(this.query.sid,'"}')),this._writer.write(s).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;this._writer.write(r).then(()=>{n&&Js(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends lo{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=ho&&!t}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd},this.opts),new co(mo,this.uri(),e)}}},xo=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,bo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function yo(e){if(e.length>8e3)throw"URI too long";const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let a=xo.exec(e||""),s={},o=14;for(;o--;)s[bo[o]]=a[o]||"";return-1!=r&&-1!=n&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,s.path),s.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(r[t]=n)}),r}(0,s.query),s}const wo="function"===typeof addEventListener&&"function"===typeof removeEventListener,jo=[];wo&&addEventListener("offline",()=>{jo.forEach(e=>e())},!1);class No extends Ks{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"===typeof e&&(t=e,e=null),e){const r=yo(e);t.hostname=r.host,t.secure="https"===r.protocol||"wss"===r.protocol,t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=yo(t.host).host);$s(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let n=0,a=r.length;n<a;n++){let e=r[n].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),wo&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},jo.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&No.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",No.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=eo(r)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Js(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,n){if("function"===typeof t&&(n=t,t=void 0),"function"===typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const a={type:e,data:t,options:r};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(No.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),wo&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=jo.indexOf(this._offlineEventListener);-1!==e&&jo.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}No.protocol=4;class So extends No{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;No.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;No.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{r||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function a(){r||(r=!0,c(),t.close(),t=null)}const s=e=>{const r=new Error("probe error: "+e);r.transport=t.name,a(),this.emitReserved("upgradeError",r)};function o(){s("transport closed")}function i(){s("socket closed")}function l(e){t&&e.name!==t.name&&a()}const c=()=>{t.removeListener("open",n),t.removeListener("error",s),t.removeListener("close",o),this.off("close",i),this.off("upgrading",l)};t.once("open",n),t.once("error",s),t.once("close",o),this.once("close",i),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}class ko extends So{constructor(e){const t="object"===typeof e?e:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(!t.transports||t.transports&&"string"===typeof t.transports[0])&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(e=>vo[e]).filter(e=>!!e)),super(e,t)}}const Ao="function"===typeof ArrayBuffer,Co=Object.prototype.toString,Eo="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Co.call(Blob),Po="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Co.call(File);function _o(e){return Ao&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||Eo&&e instanceof Blob||Po&&e instanceof File}function Io(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(Io(e[t]))return!0;return!1}if(_o(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return Io(e.toJSON(),!0);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&Io(e[r]))return!0;return!1}function To(e){const t=[],r=e.data,n=e;return n.data=Lo(r,t),n.attachments=t.length,{packet:n,buffers:t}}function Lo(e,t){if(!e)return e;if(_o(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=Lo(e[n],t);return r}if("object"===typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=Lo(e[n],t));return r}return e}function Do(e,t){return e.data=Mo(e.data,t),delete e.attachments,e}function Mo(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=Mo(e[r],t);else if("object"===typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=Mo(e[r],t));return e}const Oo=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ro=5;var Fo;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Fo||(Fo={}));class Uo{constructor(e){this.replacer=e}encode(e){return e.type!==Fo.EVENT&&e.type!==Fo.ACK||!Io(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Fo.EVENT?Fo.BINARY_EVENT:Fo.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Fo.BINARY_EVENT&&e.type!==Fo.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=To(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}function Bo(e){return"[object Object]"===Object.prototype.toString.call(e)}class zo extends Ks{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Fo.BINARY_EVENT;r||t.type===Fo.BINARY_ACK?(t.type=r?Fo.EVENT:Fo.ACK,this.reconstructor=new Wo(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!_o(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===Fo[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Fo.BINARY_EVENT||r.type===Fo.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const a=e.substring(n,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(a)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!zo.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(_t){return!1}}static isPayloadValid(e,t){switch(e){case Fo.CONNECT:return Bo(t);case Fo.DISCONNECT:return void 0===t;case Fo.CONNECT_ERROR:return"string"===typeof t||Bo(t);case Fo.EVENT:case Fo.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===Oo.indexOf(t[0]));case Fo.ACK:case Fo.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Wo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Do(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function qo(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const Vo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ho extends Ks{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[qo(e,"open",this.onopen.bind(this)),qo(e,"packet",this.onpacket.bind(this)),qo(e,"error",this.onerror.bind(this)),qo(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){var t,r,n;if(Vo.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];if(s.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const i={type:Fo.EVENT,data:s,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"===typeof s[s.length-1]){const e=this.ids++,t=s.pop();this._registerAckCallback(e,t),i.id=e}const l=null===(r=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===r?void 0:r.writable,c=this.connected&&!(null===(n=this.io.engine)||void 0===n?void 0:n._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,t){var r,n=this;const a=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===a)return void(this.acks[e]=t);const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},a),o=function(){n.io.clearTimeoutFn(s);for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];t.apply(n,r)};o.withError=!0,this.acks[e]=o}emitWithAck(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return new Promise((t,n)=>{const a=(e,r)=>e?n(e):t(r);a.withError=!0,r.push(a),this.emit(e,...r)})}_addToQueue(e){var t=this;let r;"function"===typeof e[e.length-1]&&(r=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(function(e){if(n!==t._queue[0])return;if(null!==e)n.tryCount>t._opts.retries&&(t._queue.shift(),r&&r(e));else if(t._queue.shift(),r){for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];r(null,...s)}return n.pending=!1,t._drainQueue()}),this._queue.push(n),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Fo.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Fo.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Fo.EVENT:case Fo.BINARY_EVENT:this.onevent(e);break;case Fo.ACK:case Fo.BINARY_ACK:this.onack(e);break;case Fo.DISCONNECT:this.ondisconnect();break;case Fo.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(){if(!r){r=!0;for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];t.packet({type:Fo.ACK,id:e,data:a})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Fo.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Go(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Go.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Go.prototype.reset=function(){this.attempts=0},Go.prototype.setMin=function(e){this.ms=e},Go.prototype.setMax=function(e){this.max=e},Go.prototype.setJitter=function(e){this.jitter=e};class Ko extends Ks{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"===typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,$s(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Go({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const a=t.parser||n;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ko(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=qo(t,"open",function(){r.onopen(),e&&e()}),a=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},s=qo(t,"error",a);if(!1!==this._timeout){const e=this._timeout,r=this.setTimeoutFn(()=>{n(),a(new Error("timeout")),t.close()},e);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}return this.subs.push(n),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(qo(e,"ping",this.onping.bind(this)),qo(e,"data",this.ondata.bind(this)),qo(e,"error",this.onerror.bind(this)),qo(e,"close",this.onclose.bind(this)),qo(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(_t){this.onclose("parse error",_t)}}ondecoded(e){Js(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Ho(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t){if(this.nsps[r].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),null===(r=this.engine)||void 0===r||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Jo={};function Yo(e,t){"object"===typeof e&&(t=e,e=void 0);const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=e;r=r||"undefined"!==typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof r?r.protocol+"//"+e:"https://"+e),n=yo(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+t,n.href=n.protocol+"://"+a+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=r.source,a=r.id,s=r.path,o=Jo[a]&&s in Jo[a].nsps;let i;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?i=new Ko(n,t):(Jo[a]||(Jo[a]=new Ko(n,t)),i=Jo[a]),r.query&&!t.query&&(t.query=r.queryKey),i.socket(r.path,t)}Object.assign(Yo,{Manager:Ko,Socket:Ho,io:Yo,connect:Yo});const Xo=new class{constructor(){this.socket=null,this.isConnected=!1,this.eventHandlers=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.serverUrl="undefined"!==typeof window&&window.location&&"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname?"".concat(window.location.protocol,"//").concat(window.location.host):{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_SOCKET_URL||"http://localhost:5000"}connect(){this.socket&&this.disconnect();let e=localStorage.getItem("authToken")||localStorage.getItem("token");return e||(e="demo-david-chen-token-"+Date.now(),localStorage.setItem("authToken",e),localStorage.setItem("token",e)),this.socket=Yo(this.serverUrl,{auth:{token:e},transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4}),this.setupEventHandlers(),this.setupReconnectionHandlers(),this}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1)}setupEventHandlers(){this.socket.on("connect",()=>{console.log("\ud83d\udd0c Connected to Kenstruction server"),this.isConnected=!0,this.reconnectAttempts=0,this.emit("connected")}),this.socket.on("disconnect",e=>{console.log("\ud83d\udd0c Disconnected from server:",e),this.isConnected=!1,this.emit("disconnected",e)}),this.socket.on("error",e=>{console.error("\u274c Socket error:",e),this.emit("error",e)}),this.socket.on("newMessage",e=>this.emit("message",e)),this.socket.on("newNotification",e=>this.emit("notification",e)),this.socket.on("newDirectMessage",e=>this.emit("newDirectMessage",e)),this.socket.on("projectUpdated",e=>this.emit("projectUpdate",e)),this.socket.on("progressUpdated",e=>this.emit("progressUpdate",e)),this.socket.on("statusUpdated",e=>this.emit("statusUpdate",e)),this.socket.on("taskUpdated",e=>this.emit("taskUpdate",e)),this.socket.on("documentUpdated",e=>this.emit("documentUpdate",e)),this.socket.on("newActivity",e=>this.emit("activity",e)),this.socket.on("userStatusChanged",e=>this.emit("userStatus",e)),this.socket.on("userTyping",e=>this.emit("typing",e)),this.socket.on("userJoinedProject",e=>this.emit("userJoined",e)),this.socket.on("userLeftProject",e=>this.emit("userLeft",e)),this.socket.on("workflow_updated",e=>{console.log("\ud83d\udd04 Workflow updated:",e),this.emit("workflowUpdate",e),this.emit("alertsChanged",{projectId:e.projectId,type:"workflow"})}),this.socket.on("alerts_refresh",e=>{console.log("\ud83d\udd04 Alerts refresh requested:",e),this.emit("alertsChanged",e)}),this.socket.on("new_alert",e=>{console.log("\ud83d\udea8 New alert received:",e),this.emit("newAlert",e),"undefined"!==typeof window&&"Notification"in window&&"granted"===Notification.permission&&new Notification(e.title||"New Alert",{body:e.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:"alert-".concat(e.id),requireInteraction:"HIGH"===e.priority})}),this.socket.on("alert_completed",e=>{console.log("\u2705 Alert completed:",e),this.emit("alertCompleted",e),this.emit("alertsChanged",{type:"completion"})})}setupReconnectionHandlers(){let e=1e3,t=null;this.socket.on("reconnect",t=>{console.log("\ud83d\udd04 Reconnected after ".concat(t," attempts")),e=1e3,this.emit("reconnected",t),this.rejoinRooms()}),this.socket.on("reconnect_attempt",e=>{console.log("\ud83d\udd04 Reconnection attempt ".concat(e)),this.reconnectAttempts=e,this.emit("reconnectAttempt",e)}),this.socket.on("reconnect_failed",()=>{console.error("\u274c Failed to reconnect to server"),this.emit("reconnectFailed"),this.reconnectAttempts<this.maxReconnectAttempts&&(t=setTimeout(()=>{console.log("\ud83d\udd04 Manual reconnection attempt after ".concat(e,"ms")),this.socket.connect(),e=Math.min(2*e,3e4)},e))}),this.socket.on("disconnect",r=>{console.log("\ud83d\udd0c Disconnected:",r),this.isConnected=!1,"io server disconnect"===r?(console.log("\ud83d\udd04 Server initiated disconnect, reconnecting..."),this.socket.connect()):"transport close"!==r&&"transport error"!==r||!t&&this.reconnectAttempts<this.maxReconnectAttempts&&(t=setTimeout(()=>{console.log("\ud83d\udd04 Reconnecting after network issue (backoff: ".concat(e,"ms)")),this.socket.connect(),e=Math.min(2*e,3e4),t=null},e))})}rejoinRooms(){this.currentProjectId&&(this.joinProject(this.currentProjectId),console.log("\ud83d\udc65 Rejoined project ".concat(this.currentProjectId))),this.currentConversationId&&(this.joinConversation(this.currentConversationId),console.log("\ud83d\udcac Rejoined conversation ".concat(this.currentConversationId)))}joinProject(e){this.isConnected?(this.currentProjectId=e,this.socket.emit("join_project",e),console.log("\ud83d\udc65 Joined project ".concat(e))):console.warn("\u26a0\ufe0f Not connected to server")}leaveProject(e){this.isConnected?(this.currentProjectId===e&&(this.currentProjectId=null),this.socket.emit("leave_project",e),console.log("\ud83d\udc4b Left project ".concat(e))):console.warn("\u26a0\ufe0f Not connected to server")}joinConversation(e){this.isConnected?(this.currentConversationId=e,this.socket.emit("join_conversation",e),console.log("\ud83d\udcac Joined conversation ".concat(e))):console.warn("\u26a0\ufe0f Not connected to server")}leaveConversation(e){this.isConnected?(this.currentConversationId===e&&(this.currentConversationId=null),this.socket.emit("leave_conversation",e),console.log("\ud83d\udcac Left conversation ".concat(e))):console.warn("\u26a0\ufe0f Not connected to server")}sendMessage(e){return this.isConnected?new Promise((t,r)=>{this.socket.emit("sendMessage",e),this.socket.once("messageSent",e=>{e.success?t(e):r(new Error("Failed to send message"))}),setTimeout(()=>{r(new Error("Message send timeout"))},5e3)}):(console.warn("\u26a0\ufe0f Not connected to server"),Promise.reject(new Error("Not connected to server")))}sendNotification(e){return this.isConnected?new Promise((t,r)=>{this.socket.emit("notification",e),this.socket.once("notificationSent",e=>{e.success?t(e):r(new Error("Failed to send notification"))}),setTimeout(()=>{r(new Error("Notification send timeout"))},5e3)}):(console.warn("\u26a0\ufe0f Not connected to server"),Promise.reject(new Error("Not connected to server")))}sendProjectUpdate(e){return this.isConnected?new Promise((t,r)=>{this.socket.emit("projectUpdate",e),this.socket.once("projectUpdateSent",e=>{e.success?t(e):r(new Error("Failed to send project update"))}),setTimeout(()=>{r(new Error("Project update send timeout"))},5e3)}):(console.warn("\u26a0\ufe0f Not connected to server"),Promise.reject(new Error("Not connected to server")))}sendTaskUpdate(e){this.isConnected?this.socket.emit("task_update",e):console.warn("\u26a0\ufe0f Not connected to server")}sendActivityUpdate(e){this.isConnected?this.socket.emit("activity_update",e):console.warn("\u26a0\ufe0f Not connected to server")}sendDocumentUpdate(e){this.isConnected?this.socket.emit("document_update",e):console.warn("\u26a0\ufe0f Not connected to server")}updateUserStatus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isConnected?this.socket.emit("user_status_update",{status:e,projectId:t}):console.warn("\u26a0\ufe0f Not connected to server")}startTyping(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isConnected?this.socket.emit("typing_start",{conversationId:e,projectId:t}):console.warn("\u26a0\ufe0f Not connected to server")}stopTyping(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isConnected?this.socket.emit("typing_stop",{conversationId:e,projectId:t}):console.warn("\u26a0\ufe0f Not connected to server")}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}off(e,t){if(this.eventHandlers.has(e)){const r=this.eventHandlers.get(e),n=r.indexOf(t);n>-1&&r.splice(n,1)}}emit(e,t){this.eventHandlers.has(e)&&this.eventHandlers.get(e).forEach(r=>{try{r(t)}catch(n){console.error("Error in event handler for ".concat(e,":"),n)}})}getConnectionStatus(){return{isConnected:this.isConnected,reconnectAttempts:this.reconnectAttempts,maxReconnectAttempts:this.maxReconnectAttempts}}},Qo=Xo,Zo=()=>{const[e,t]=(0,o.useState)(!1),[r,n]=(0,o.useState)(0);return(0,o.useEffect)(()=>{if(Da.authService.isAuthenticated())return Qo.connect(),Qo.on("connected",()=>t(!0)),Qo.on("disconnected",()=>t(!1)),Qo.on("reconnectAttempt",e=>n(e)),Qo.on("reconnected",()=>n(0)),()=>{Qo.disconnect()}},[]),{socketService:Qo,isConnected:e,reconnectAttempts:r}},$o=["Input Customer Information","Complete Questions to Ask Checklist","Input Lead Property Information","Assign A Project Manager","Schedule Initial Inspection","Site Inspection","Write Estimate","Insurance Process","Agreement Preparation","Agreement Signing","Administrative Setup","Pre-Job Actions","Prepare for Production","Installation","Quality Check","Multiple Trades","Subcontractor Work","Update Customer","Create Supp in Xactimate","Follow-Up Calls","Review Approved Supp","Customer Update","Financial Processing","Project Closeout"],ei=[...$o,"General Update","Project Status","Material Delivery","Safety Meeting","Quality Inspection","Client Communication","Permit Update","Weather Alert","Equipment Issue","Crew Assignment","Budget Update","Schedule Change","Inspection Report","Documentation","Emergency Alert","Training Update","Maintenance Required","Vendor Communication","Insurance Update","Warranty Information"],ti=(0,o.createContext)(),ri=()=>{const e=(0,o.useContext)(ti);if(!e)throw new Error("useSubjects must be used within a SubjectsProvider");return e},ni=e=>{let{children:t}=e;const[r,n]=(0,o.useState)([]);(0,o.useEffect)(()=>{const e=localStorage.getItem("customSubjects");if(e)try{n(JSON.parse(e))}catch(t){n([...ei])}else n([...ei])},[]);const a=e=>{n(e),localStorage.setItem("customSubjects",JSON.stringify(e))},s={subjects:r,addSubject:e=>{if(e.trim()&&!r.includes(e.trim())){const t=[...r,e.trim()];return a(t),!0}return!1},editSubject:(e,t)=>{if(t.trim()&&!r.includes(t.trim())){const n=[...r];return n[e]=t.trim(),a(n),!0}return!1},deleteSubject:e=>{const t=r.filter((t,r)=>r!==e);a(t)},resetToDefaults:()=>{a([...ei])},updateSubjects:a};return(0,kt.jsx)(ti.Provider,{value:s,children:t})},ai=e=>{if(!e||0===e.length)return[];const t=[],r=new Date,n=[{type:"project_update",subject:"Project Status Update",templates:["Project status updated","Progress milestone reached","Phase transition completed"]},{type:"material_delivery",subject:"Material Delivery",templates:["Materials delivered on site","Delivery scheduled","Materials inspection completed"]},{type:"site_inspection",subject:"Site Inspection",templates:["Site inspection completed","Inspection scheduled","Quality check performed"]},{type:"customer_communication",subject:"Customer Communication",templates:["Customer meeting held","Client approval received","Follow-up call completed"]},{type:"documentation",subject:"Project Documentation",templates:["Documents updated","Photos uploaded","Report generated"]},{type:"crew_assignment",subject:"Team Assignment",templates:["Crew assigned","Team schedule updated","Labor coordination completed"]},{type:"quality_check",subject:"Quality Review",templates:["Quality inspection passed","Work standards verified","Final review completed"]},{type:"permit_update",subject:"Permit Status",templates:["Permits approved","Regulatory compliance verified","License requirements met"]},{type:"schedule_change",subject:"Schedule Update",templates:["Timeline adjusted","Meeting rescheduled","Milestone date changed"]},{type:"budget_discussion",subject:"Budget Review",templates:["Budget approved","Cost estimate updated","Payment processed"]}];return e.forEach((e,a)=>{const s=Math.floor(3*Math.random())+2;for(let o=0;o<s;o++){const a=n[Math.floor(Math.random()*n.length)],s=a.templates[Math.floor(Math.random()*a.templates.length)],i=Math.floor(7*Math.random()),l=Math.floor(24*Math.random()),c=new Date(r.getTime()-24*i*60*60*1e3-60*l*60*1e3);t.push({id:"message_".concat(e.id,"_").concat(o),projectId:e.id,projectName:e.name,projectNumber:e.projectNumber,type:a.type,subject:a.subject,description:s,user:"Unknown User",timestamp:c.toISOString(),priority:["low","medium","high"][Math.floor(3*Math.random())],metadata:{projectPhase:Wn.getProjectPhase(e)||"LEAD",projectValue:e.budget||e.estimateValue,assignedTo:e.assignedTo||"Sarah Owner"}})}}),t},si=Wn.getAllPhases(),oi=e=>Wn.calculateProjectProgress(e).overall||0,ii=e=>{let{tasks:t,activities:r,onProjectSelect:n,onAddActivity:a,colorMode:s,dashboardState:i}=e;console.log("\ud83d\udd0d DASHBOARD: Component rendering...");const l=Ct(),{data:c,isLoading:d,error:u,refetch:h}=ss({limit:100}),m=Array.isArray(c)?c:(null===c||void 0===c?void 0:c.data)||[],p=m&&m.length>0?m:xs;console.log("\ud83d\udd0d DASHBOARD DEBUG: projectsData:",c),console.log("\ud83d\udd0d DASHBOARD DEBUG: projectsData.data:",null===c||void 0===c?void 0:c.data),console.log("\ud83d\udd0d DASHBOARD DEBUG: projectsData.success:",null===c||void 0===c?void 0:c.success),console.log("\ud83d\udd0d DASHBOARD DEBUG: projects array:",m),console.log("\ud83d\udd0d DASHBOARD DEBUG: projects length:",null===m||void 0===m?void 0:m.length);const[f,g]=(0,o.useState)(null),v=f||m;(0,o.useEffect)(()=>{let e=!1;return(async()=>{if(Array.isArray(m)&&0!==m.length)try{const t=await Promise.all(m.map(async e=>{const t=Wn.getProjectPhase(e);if(t&&"LEAD"!==t)return e;try{const t=(await Da.default.get("/workflow-data/project-position/".concat(e.id))).data;if(null!==t&&void 0!==t&&t.success&&t.data){var r,n,a,s,o,i,l,c;const d=t.data;return(0,Y.A)((0,Y.A)({},e),{},{currentWorkflowItem:(0,Y.A)((0,Y.A)({},e.currentWorkflowItem||{}),{},{phase:d.phaseType||(null===(r=e.currentWorkflowItem)||void 0===r?void 0:r.phase)||e.phase||"LEAD",phaseDisplay:d.phaseName||(null===(n=e.currentWorkflowItem)||void 0===n?void 0:n.phaseDisplay)||null,section:d.sectionDisplayName||(null===(a=e.currentWorkflowItem)||void 0===a?void 0:a.section)||null,lineItem:d.currentLineItemName||(null===(s=e.currentWorkflowItem)||void 0===s?void 0:s.lineItem)||null,lineItemId:d.currentLineItem||(null===(o=e.currentWorkflowItem)||void 0===o?void 0:o.lineItemId)||null,sectionId:d.currentSectionId||(null===(i=e.currentWorkflowItem)||void 0===i?void 0:i.sectionId)||null,phaseId:d.currentPhase||(null===(l=e.currentWorkflowItem)||void 0===l?void 0:l.phaseId)||null,isComplete:!1,totalLineItems:(null===(c=e.currentWorkflowItem)||void 0===c?void 0:c.totalLineItems)||Wn.estimateTotalLineItems()})})}}catch(Pr){}return e}));e||g(t)}catch(Pr){e||g(null)}else e||g(null)})(),()=>{e=!0}},[m]);const{subjects:x}=ri(),{data:b,isLoading:y}=Pa({queryKey:as.currentUser,queryFn:()=>Da.authService.getCurrentUser(),select:e=>(null===e||void 0===e?void 0:e.data)||e,staleTime:6e5,retry:!1,initialData:()=>{try{const e=localStorage.getItem("user")||localStorage.getItem("currentUser");if(e)return{data:JSON.parse(e)}}catch(e){console.error("Error parsing stored user:",e)}}}),[w,j]=(0,o.useState)([]),[N,S]=(0,o.useState)(!1),[k,A]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=!1;return(async()=>{S(!0),A(null);try{const t=localStorage.getItem("authToken")||localStorage.getItem("token")||sessionStorage.getItem("authToken")||sessionStorage.getItem("token"),r={"Content-Type":"application/json"};t&&(r.Authorization="Bearer ".concat(t));const n=await fetch("".concat(Da.API_BASE_URL,"/roles/users"),{method:"GET",headers:r});if(!n.ok)throw new Error("Failed to load users: ".concat(n.status));const a=await n.json(),s=(Array.isArray(null===a||void 0===a?void 0:a.data)?a.data:[]).map(e=>{var t,r,n,a,s,o,i,l;return{id:e.id||e.userId||e._id||e.uuid||null,firstName:e.firstName||(null===(t=e.name)||void 0===t?void 0:t.first)||(null===(r=e.fullName)||void 0===r||null===(n=r.split)||void 0===n||null===(a=n.call(r," "))||void 0===a?void 0:a[0])||"",lastName:e.lastName||(null===(s=e.name)||void 0===s?void 0:s.last)||(null===(o=e.fullName)||void 0===o||null===(i=o.split)||void 0===i||null===(l=i.call(o," "))||void 0===l?void 0:l.slice(1).join(" "))||"",email:e.email||e.primaryEmail||"",phone:e.phone||e.primaryPhone||"",role:e.role||e.userRole||e.assignedRole||"",avatarUrl:e.avatarUrl||e.avatar||e.photoUrl||"",raw:e}}).filter(e=>e.id);e||j(s)}catch(t){e||(console.error("Failed to fetch assignable users from roles endpoint:",t),A(t),j([]))}finally{e||S(!1)}})(),()=>{e=!0}},[]);const C=(0,o.useMemo)(()=>Array.isArray(w)?w:[],[w]),[E,P]=(0,o.useState)([]),[_,I]=(0,o.useState)(!0);console.log("\ud83d\udd0d DASHBOARD: Projects loading state:",d),console.log("\ud83d\udd0d DASHBOARD: Projects error:",u),console.log("\ud83d\udd0d DASHBOARD: Projects data:",c),console.log("\ud83d\udd0d DASHBOARD: Projects array length:",m.length),u&&console.error("\ud83d\udea8 PROJECTS ERROR DETAILS:",{error:u,projectsData:c,loading:d});const T=(0,o.useRef)(null);(0,o.useEffect)(()=>{i&&i!==T.current&&(console.log("\ud83d\udd0d DASHBOARD: Dashboard state received, triggering data refresh if needed"),T.current=i,u&&"function"===typeof h&&(console.log("\ud83d\udd04 DASHBOARD: Attempting to refetch projects due to navigation state restoration"),setTimeout(()=>{h()},500)))},[i,u]),(0,o.useEffect)(()=>{try{const e=null===i||void 0===i?void 0:i.workflowRestore;if(!e)return;const{targetLineItemId:t,targetSectionId:r,project:n}=e||{};if(!t||!n)return;setTimeout(()=>{const e=document.querySelector('[data-section="project-workflow-tasks"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"});const r=document.getElementById("lineitem-".concat(t))||document.querySelector('[data-lineitem-id="'.concat(t,'"]'));if(r){r.scrollIntoView({behavior:"smooth",block:"center"});const e=r.style.boxShadow;r.style.boxShadow="0 0 10px rgba(59,130,246,0.6)",setTimeout(()=>{r.style.boxShadow=e||""},2500)}},120)}catch(XI){console.warn("Workflow restore failed:",XI)}},[i]),(0,o.useEffect)(()=>{try{const e=null===i||void 0===i?void 0:i.workflowRestore;if(!e)return;const{targetLineItemId:t}=e||{};if(!t)return;const r=setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("dashboard:clearWorkflowRestore"))}catch(_t){}},800);return()=>clearTimeout(r)}catch(Pr){}},[i]);const[L,D]=(0,o.useState)(""),[M,O]=(0,o.useState)(""),[R,F]=(0,o.useState)(""),[U,B]=(0,o.useState)(!1),[z,W]=(0,o.useState)([]),[q,V]=(0,o.useState)("low"),[H,G]=(0,o.useState)("messages"),[K,J]=(0,o.useState)(!1),[X,Q]=(0,o.useState)(""),[Z,$]=(0,o.useState)(""),[ee,te]=(0,o.useState)(""),[re,ne]=(0,o.useState)(""),[ae,se]=(0,o.useState)(""),[oe,ie]=(0,o.useState)(""),[le,ce]=(0,o.useState)(!0),[de,ue]=(0,o.useState)(!0),[he,me]=(0,o.useState)(!0),[pe,fe]=(0,o.useState)(!0),[ge,ve]=(0,o.useState)(!0),[xe,be]=(0,o.useState)(!0),[ye,we]=(0,o.useState)(""),[je,Ne]=(0,o.useState)(""),[Se,ke]=(0,o.useState)(""),[Ae,Ce]=(0,o.useState)(!1),[Ee,Pe]=(0,o.useState)(""),[_e,Ie]=(0,o.useState)({days:0,hours:0,minutes:0}),[Te,Le]=(0,o.useState)({enabled:!1,days:0,hours:0,minutes:0}),[De,Me]=(0,o.useState)({days:0,hours:0,minutes:0}),[Oe,Re]=(0,o.useState)({enabled:!1,days:0,hours:0,minutes:0}),[Fe,Ue]=(0,o.useState)(new Set),[Be,ze]=(0,o.useState)(()=>{const e=localStorage.getItem("taskComments");return e?JSON.parse(e):{}}),[We,qe]=(0,o.useState)({}),[Ve,He]=(0,o.useState)({}),[Ge,Ke]=(0,o.useState)({}),[Je,Ye]=(0,o.useState)({}),[Xe,Qe]=(0,o.useState)({}),Ze=e=>{Ue(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},$e=async e=>{const t=We[e];if(null===t||void 0===t||!t.trim())return;const r={id:"comment_".concat(Date.now()),text:t.trim(),user:b?"".concat(b.firstName," ").concat(b.lastName):"Unknown User",userId:null===b||void 0===b?void 0:b.id,timestamp:(new Date).toISOString()};try{(await fetch("/api/tasks/comments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({taskId:e,comment:t.trim(),userId:null===b||void 0===b?void 0:b.id})})).ok?(ze(t=>{const n=(0,Y.A)((0,Y.A)({},t),{},{[e]:[...t[e]||[],r]});return localStorage.setItem("taskComments",JSON.stringify(n)),n}),qr.success("Comment added")):qr.error("Failed to save comment")}catch(n){console.error("Error saving comment:",n),qr.error("Failed to save comment"),ze(t=>{const n=(0,Y.A)((0,Y.A)({},t),{},{[e]:[...t[e]||[],r]});return localStorage.setItem("taskComments",JSON.stringify(n)),n})}qe(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:""}))},[et,tt]=(0,o.useState)(""),[rt,nt]=(0,o.useState)(""),[at,st]=(0,o.useState)(""),[ot,it]=(0,o.useState)(!1),[lt,ct]=(0,o.useState)([]),[dt,ut]=(0,o.useState)(!1),[ht,mt]=(0,o.useState)(""),[pt,ft]=(0,o.useState)(""),[gt,vt]=(0,o.useState)(""),[xt,bt]=(0,o.useState)(""),[yt,wt]=(0,o.useState)([]),[jt,Nt]=(0,o.useState)(""),[St,At]=(0,o.useState)(""),[Et,Pt]=(0,o.useState)(""),[It,Tt]=(0,o.useState)([]),{data:Lt,isLoading:Dt}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Pa({queryKey:[...as.workflowAlerts,e],queryFn:()=>Da.workflowAlertsService.getAll(e),select:e=>(null===e||void 0===e?void 0:e.data)||e||[],staleTime:0,cacheTime:0,retry:!1,refetchOnWindowFocus:!0})}({limit:200}),Mt=Array.isArray(Lt)?Lt:(null===Lt||void 0===Lt?void 0:Lt.data)||[],{data:Ot=[],isLoading:Rt}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return Pa({queryKey:as.recentActivities(e),queryFn:()=>Da.activitiesService.getRecent(e),select:e=>(null===e||void 0===e?void 0:e.data)||e||[],staleTime:3e4})}(50),{data:Ft=[],isLoading:Ut}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Pa({queryKey:[...as.tasks,e],queryFn:()=>Da.tasksService.getAll(e),select:e=>(null===e||void 0===e?void 0:e.data)||e||[]})}({page:1,limit:20}),{data:Bt=[],isLoading:zt}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Pa({queryKey:[...as.calendarEvents,e],queryFn:()=>Da.calendarService.getAll(e),select:e=>{var t,r,n;const a=e=>Array.isArray(e)?e:null;return a(null===e||void 0===e?void 0:e.data)||a(null===e||void 0===e?void 0:e.items)||a(null===e||void 0===e?void 0:e.results)||a(null===e||void 0===e?void 0:e.events)||a(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.items)||a(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.results)||a(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.events)||a(e)||[]}})}({limit:20});console.log("\ud83d\udd0d DASHBOARD: About to call useFeedback hook");const{data:Wt=[],isLoading:qt,error:Vt}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Pa({queryKey:[...as.feedback,e],queryFn:()=>Da.feedbackService.getFeedback(e),select:e=>{var t,r;console.log("\ud83d\udd0d FEEDBACK HOOK: Raw data:",e),console.log("\ud83d\udd0d FEEDBACK HOOK: Raw data.data:",null===e||void 0===e?void 0:e.data),console.log("\ud83d\udd0d FEEDBACK HOOK: Raw data.data.data:",null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data);const n=Array.isArray(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.data)?e.data.data:Array.isArray(null===e||void 0===e?void 0:e.data)?e.data:Array.isArray(e)?e:[];return console.log("\ud83d\udd0d FEEDBACK HOOK: Selected data:",n),console.log("\ud83d\udd0d FEEDBACK HOOK: Selected data type:",typeof n),console.log("\ud83d\udd0d FEEDBACK HOOK: Selected data length:",Array.isArray(n)?n.length:"not array"),n},staleTime:0,retry:!1,refetchOnWindowFocus:!0})}({limit:20});console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: realFeedback:",Wt),console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: feedbackLoading:",qt),console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: feedbackError:",Vt),console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: realFeedback type:",typeof Wt),console.log("\ud83d\udd0d DASHBOARD FEEDBACK DEBUG: realFeedback length:",Array.isArray(Wt)?Wt.length:"not array");const[Ht,Gt]=(0,o.useState)(!1);(0,o.useEffect)(()=>{Ut||zt||!b||(async()=>{Ht||(console.log("\ud83d\udcdd Mock data conversion is disabled to prevent orphan reminders"),Gt(!0))})()},[Ft,Bt,Ut,zt,Ht,b,p,l]);const Kt=Ot||[],Jt=Ft||[],Yt=Bt||[],Xt=(0,o.useMemo)(()=>{try{const e=Array.isArray(It)?[...It]:[],t=new Set,r=(e,r)=>{const n=String(r||"").replace(/^(activity_|task_|reminder_)/,"");t.add("".concat(e,":").concat(n))};e.forEach(e=>r(e.type||"message",e.id)),(Array.isArray(Kt)?Kt:[]).forEach(n=>{const a=["message","task","reminder"].includes(n.type)?n.type:"message",s="".concat(a,":").concat(n.id);t.has(s)||(e.push({id:"activity_".concat(n.id),type:a||"message",subject:n.subject||n.title||"Activity Update",description:n.description||n.content,user:n.user||n.userName||"Unknown User",timestamp:n.createdAt||n.timestamp,projectId:n.projectId,projectName:n.projectName,priority:n.priority||"medium",metadata:n.metadata||null}),r(a,n.id))}),(Array.isArray(Jt)?Jt:[]).forEach(n=>{const a="task:".concat(n.id);var s;t.has(a)||(e.push({id:"task_".concat(n.id),type:"task",subject:n.title||n.subject||"Task",description:n.description||n.content,user:n.assignedToUser?"".concat(n.assignedToUser.firstName," ").concat(n.assignedToUser.lastName):n.assignedTo||"Unassigned",timestamp:n.createdAt||n.timestamp||n.dueDate||(new Date).toISOString(),projectId:n.projectId,projectName:(null===(s=n.project)||void 0===s?void 0:s.name)||n.projectName,priority:n.priority||"medium",status:n.status,dueDate:n.dueDate,author:n.author||"System",assignedTo:n.assignedTo||(n.assignedToUser?"".concat(n.assignedToUser.firstName," ").concat(n.assignedToUser.lastName):void 0)}),r("task",n.id))});const n=null===b||void 0===b?void 0:b.id;if((Array.isArray(Yt)?Yt:[]).filter(e=>{if(!n)return!1;const t=e.organizerId===n||e.createdBy===n||e.authorId===n,r=Array.isArray(e.attendees)?e.attendees.map(e=>{var t;return e.userId||(null===(t=e.user)||void 0===t?void 0:t.id)||e}).filter(Boolean):[],a=r.some(e=>String(e)===String(n));return t||a}).forEach(n=>{const a="reminder:".concat(n.id);if(!t.has(a)){var s;const t=Array.isArray(n.attendees)?n.attendees.map(e=>e.user?"".concat(e.user.firstName||""," ").concat(e.user.lastName||"").trim():null).filter(Boolean):[];e.push({id:"reminder_".concat(n.id),type:"reminder",subject:n.title||n.subject||"Reminder",description:n.description||n.content,user:n.createdByUser?"".concat(n.createdByUser.firstName," ").concat(n.createdByUser.lastName):n.organizer?"".concat(n.organizer.firstName||""," ").concat(n.organizer.lastName||"").trim():"Unknown User",timestamp:n.createdAt||n.timestamp||n.when||n.startDate||(new Date).toISOString(),projectId:n.projectId,projectName:(null===(s=n.project)||void 0===s?void 0:s.name)||n.projectName,priority:n.priority||"medium",when:n.startDate||n.when,authorId:n.createdBy||n.organizerId||n.authorId||(null===b||void 0===b?void 0:b.id)||null,recipients:Array.isArray(n.attendees)?n.attendees.map(e=>{var t;return e.userId||(null===(t=e.user)||void 0===t?void 0:t.id)||e}).filter(Boolean):[],attendeeNames:t.length>0?t:["You"]}),r("reminder",n.id)}}),console.log("\ud83d\udd0d FEEDBACK DEBUG: Feedback items excluded from activity feed as requested"),0===e.length){const e=ai(v||[]);return Array.isArray(e)?e:[]}const a=e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));return console.log("\ud83d\udd0d ACTIVITY FEED DEBUG: Final items count:",a.length),console.log("\ud83d\udd0d ACTIVITY FEED DEBUG: Items by type:",a.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{})),a}catch(e){console.error("Error building activity feed:",e);const t=ai(v||[]);return Array.isArray(t)?t:[]}},[It,Ot,Ft,Bt,v,b]),Qt=Xt&&Xt.length>0?Xt:bs,Zt=(0,o.useMemo)(()=>{let e=Xt;return Et&&(e=e.filter(e=>e.type===Et)),jt&&(e=e.filter(e=>String(e.projectId)===String(jt))),e},[Xt,Et,jt]),$t=function(e){n&&n(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Profile",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Dashboard",arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)},[er,tr]=(0,o.useState)(""),[rr,nr]=((0,o.useMemo)(()=>{const e={};return(si||[]).forEach(t=>{e[t.id]=[]}),(v||[]).forEach(t=>{const r=Wn.getProjectPhase(t)||"LEAD";e[r]||(e[r]=[]),e[r].push(t)}),e},[v]),(0,o.useState)(1)),[ar,sr]=(0,o.useState)({key:null,direction:"asc"}),[or,ir]=(0,o.useState)({key:"timestamp",direction:"desc"}),[lr,cr]=(0,o.useState)(new Set),[dr,ur]=(0,o.useState)(null),[hr,mr]=(0,o.useState)(new Set),[pr,fr]=(0,o.useState)(!1),[gr,vr]=(0,o.useState)(new Set),[xr,br]=(0,o.useState)(new Set),[yr,wr]=(0,o.useState)(new Set);console.log("\ud83d\udd0d DASHBOARD: currentUser from hook:",b),console.log("\ud83d\udd0d DASHBOARD: assignableUsers length:",null===w||void 0===w?void 0:w.length),console.log("\ud83d\udd0d DASHBOARD: usersForUi length:",null===C||void 0===C?void 0:C.length),console.log("\ud83d\udd0d DASHBOARD: subjects from context:",x);const jr=e=>{const t=new Set(hr);if(t.has(e))t.delete(e);else{t.add(e);const r=Xt.find(t=>t.id===e);r&&"reminder"===r.type?Ve[e]&&0!==Ve[e].length||(async e=>{if(!Xe["reminder_".concat(e)]){Qe(t=>(0,Y.A)((0,Y.A)({},t),{},{["reminder_".concat(e)]:!0}));try{const t=await Da.default.get("/calendar-events/".concat(e,"/comments"));t.data.success&&t.data.data&&He(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t.data.data.map(e=>({id:e.id,content:e.content,userName:e.user?"".concat(e.user.firstName," ").concat(e.user.lastName):"Unknown User",userId:e.userId,createdAt:e.createdAt}))}))}catch(t){console.error("Error fetching reminder comments:",t)}finally{Qe(t=>(0,Y.A)((0,Y.A)({},t),{},{["reminder_".concat(e)]:!1}))}}})(e):Be[e]&&0!==Be[e].length||(async e=>{if(!Xe[e]){Qe(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!0}));try{const t=await Da.default.get("/tasks/".concat(e,"/comments"));if(t.data){const r=t.data;r.success&&r.data&&ze(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:r.data.map(e=>({id:e.id,text:e.content||e.text,user:e.user?"".concat(e.user.firstName," ").concat(e.user.lastName):"Unknown User",userId:e.userId,timestamp:e.createdAt||e.timestamp}))}))}}catch(t){console.error("Error fetching comments:",t)}finally{Qe(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!1}))}}})(e)}mr(t);const r=Zt.length,n=t.size;fr(n===r)},Nr=e=>{const t=new Set(gr);if(t.has(e)){t.delete(e);const r=new Set(xr);r.delete(e),br(r);const n=new Set(yr);n.delete(e),wr(n)}else t.add(e);vr(t)},Sr=e=>{const t=new Set(xr);if(t.has(e)){t.delete(e);const r=new Set(yr);r.delete(e),wr(r)}else t.add(e);br(t)},kr=e=>{const t=new Set(yr);t.has(e)?t.delete(e):t.add(e),wr(t)};(0,o.useEffect)(()=>{nr(1)},[M]),(0,o.useEffect)(()=>{const e=e=>{"Escape"===e.key&&gr.size>0&&vr(new Set)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[gr.size]);return(0,kt.jsx)(Un,{children:(0,kt.jsxs)("div",{className:"min-h-screen bg-gray-100 text-gray-900",children:[(0,kt.jsx)(vs,{projects:v||p,PROJECT_PHASES:si,colorMode:s,onProjectSelect:$t,selectedPhase:dr,setSelectedPhase:ur,sortConfig:ar,handleProjectSort:e=>{sr({key:e,direction:ar.key===e&&"asc"===ar.direction?"desc":"asc"})},projectsLoading:d,projectsError:u,refetchProjects:h,expandedPhases:lr,teamMembers:C}),(0,kt.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-start overflow-visible",children:[(0,kt.jsxs)("div",{className:"w-full lg:flex-1 flex flex-col gap-6","data-section":"project-messages",children:[(0,kt.jsxs)("div",{className:"bg-white border border-gray-200/50 shadow-soft rounded-2xl p-6 relative overflow-visible",children:[(0,kt.jsx)(Za,{activeCommTab:H,setActiveCommTab:G,expandedMessages:hr,activityFeedItems:Xt}),(0,kt.jsx)($a,{activeCommTab:H,projects:p,availableUsers:C,messagesProjectFilter:Z,messagesUserFilter:X,tasksProjectFilter:re,tasksUserFilter:ee,remindersProjectFilter:oe,remindersUserFilter:ae,setMessagesProjectFilter:$,setMessagesUserFilter:Q,setTasksProjectFilter:ne,setTasksUserFilter:te,setRemindersProjectFilter:ie,setRemindersUserFilter:se,activityFeedItems:Xt,expandedMessages:hr,handleExpandAllMessages:()=>{let e=[];"messages"===H?e=Xt.filter(e=>"message"===e.type):"tasks"===H?e=Xt.filter(e=>"task"===e.type):"reminders"===H&&(e=Xt.filter(e=>"reminder"===e.type));const t=new Set(e.map(e=>e.id));mr(t),fr(!0)},handleCollapseAllMessages:()=>{mr(new Set),fr(!1)}}),(0,kt.jsx)(is,{activeCommTab:H,colorMode:s,showMessageDropdown:dt,setShowMessageDropdown:ut,projects:p,availableUsers:C,usersLoading:N,subjects:x,currentUser:b,newMessageProject:ht,setNewMessageProject:mt,newMessageSubject:pt,setNewMessageSubject:ft,newMessageCustomSubject:gt,setNewMessageCustomSubject:vt,newMessageText:xt,setNewMessageText:bt,newMessageRecipients:yt,setNewMessageRecipients:wt,quickTaskSubject:ye,setQuickTaskSubject:we,quickTaskDescription:je,setQuickTaskDescription:Ne,quickTaskDue:Se,setQuickTaskDue:ke,quickTaskAssignAll:Ae,setQuickTaskAssignAll:Ce,quickTaskAssigneeId:Ee,setQuickTaskAssigneeId:Pe,tasksProjectFilter:re,setTasksProjectFilter:ne,reminderTitle:et,setReminderTitle:tt,reminderDescription:rt,setReminderDescription:nt,reminderWhen:at,setReminderWhen:st,reminderAllUsers:ot,setReminderAllUsers:it,reminderUserIds:lt,setReminderUserIds:ct,remindersProjectFilter:oe,setRemindersProjectFilter:ie,setMessagesData:P,setFeed:Tt,uiProjects:v,taskTiming:_e,setTaskTiming:Ie,taskFollowUpTiming:Te,setTaskFollowUpTiming:Le,reminderTiming:De,setReminderTiming:Me,reminderFollowUpTiming:Oe,setReminderFollowUpTiming:Re}),(0,kt.jsxs)("div",{className:"space-y-2 mt-3 max-h-[480px] overflow-y-auto pr-1 custom-scrollbar",children:[(0,kt.jsx)(Ha,{activeCommTab:H,activityFeedItems:Qt,projects:p,colorMode:s,expandedMessages:hr,messagesProjectFilter:Z,messagesUserFilter:X,handleToggleMessage:jr,handleProjectSelectWithScroll:$t,handleQuickReply:async(e,t)=>{try{null!==Da.projectMessagesService&&void 0!==Da.projectMessagesService&&Da.projectMessagesService.sendQuickReply?(await Da.projectMessagesService.sendQuickReply(e,t),qr.success("Reply sent")):(console.log("Quick reply:",{messageId:e,text:t}),qr.success("Reply posted"))}catch(XI){console.error("Failed to send quick reply:",XI),qr.error("Failed to send reply")}}}),(0,kt.jsx)(Ga,{activeCommTab:H,activityFeedItems:Jt,projects:p,colorMode:s,expandedMessages:hr,completedTasks:Fe,tasksProjectFilter:re,tasksUserFilter:ee,showCompletedTasks:K,setShowCompletedTasks:J,handleToggleMessage:jr,handleTaskToggle:Ze,handleProjectSelectWithScroll:$t,availableUsers:C,currentUser:b,taskComments:Be,newCommentText:We,setNewCommentText:qe,handleAddComment:$e}),(0,kt.jsx)(Ka,{activeCommTab:H,activityFeedItems:Yt,projects:p,colorMode:s,expandedMessages:hr,completedTasks:Fe,remindersProjectFilter:oe,remindersUserFilter:ae,availableUsers:C,currentUser:b,handleToggleMessage:jr,handleTaskToggle:Ze,handleProjectSelectWithScroll:$t,reminderComments:Ve,showCommentInput:Ge,setShowCommentInput:Ke,commentInputs:Je,setCommentInputs:Ye,handleAddReminderComment:async e=>{var t;const r=null===(t=Je[e])||void 0===t?void 0:t.trim();if(!r)return;const n={content:r,userName:b.firstName?"".concat(b.firstName," ").concat(b.lastName):"You",userId:b.id,createdAt:(new Date).toISOString()};try{(await Da.default.post("/calendar-events/".concat(e,"/comments"),{content:r})).data.success?(He(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:[...t[e]||[],n]})),Ye(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:""})),Ke(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!1})),qr.success("Comment added to reminder")):qr.error("Failed to add comment")}catch(a){console.error("Error adding reminder comment:",a),qr.error("Failed to add comment")}}})]})]}),(0,kt.jsx)("div",{className:"w-full lg:flex-1",children:(0,kt.jsx)(Qa,{projects:p,colorMode:s,onProjectSelect:n,workflowAlerts:Mt,alertsLoading:Dt,availableUsers:C,currentUser:b,handleProjectSelectWithScroll:$t})})]}),(0,kt.jsx)("div",{className:"w-full",children:(0,kt.jsx)(Va,{activityFeedItems:Xt,projects:p,colorMode:s,expandedMessages:hr,completedTasks:Fe,activityProjectFilter:jt,activityTypeFilter:Et,setActivityProjectFilter:Nt,setActivityTypeFilter:Pt,handleToggleMessage:jr,handleTaskToggle:Ze,handleProjectSelectWithScroll:$t,availableUsers:C,currentUser:b,taskComments:Be,newCommentText:We,setNewCommentText:qe,handleAddComment:$e,sourceSection:"Activity Feed"})})]}),Array.from(gr).map(e=>{const t=null===m||void 0===m?void 0:m.find(t=>t.id===e);if(!t)return null;oi(t);return(0,kt.jsxs)(kt.Fragment,{children:[gr.has(e)&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>Nr(e)}),(0,kt.jsx)(ls,{open:gr.has(e),onClose:()=>Nr(e),project:t,colorMode:s,getProjectProgress:oi,expandedTrades:xr,toggleTrades:Sr,expandedAdditionalTrades:yr,toggleAdditionalTrades:kr})]})})]})})},li=e=>{let{isOpen:t,onClose:r,title:n,children:a,colorMode:s}=e;return t?(0,kt.jsx)("div",{className:"fixed inset-0 bg-blue-900/30 z-[99999] flex justify-center items-center p-4 overflow-y-auto",children:(0,kt.jsxs)("div",{className:"".concat(s?"bg-slate-800":"bg-white"," rounded-lg shadow-xl w-full max-w-lg max-h-full overflow-hidden my-4"),children:[(0,kt.jsxs)("div",{className:"p-2 lg:p-3 border-b flex justify-between items-center sticky top-0 ".concat(s?"bg-slate-800 border-slate-600":"bg-white border-gray-200"," z-10"),children:[(0,kt.jsx)("h3",{className:"text-sm lg:text-base font-bold truncate flex-1 mr-2 ".concat(s?"text-white":"text-gray-900"),children:n}),(0,kt.jsx)("button",{onClick:r,className:"".concat(s?"text-gray-400 hover:text-gray-200":"text-gray-400 hover:text-gray-600"," flex-shrink-0"),children:(0,kt.jsx)(Zr,{className:"w-4 h-4 lg:w-5 lg:h-5"})})]}),(0,kt.jsx)("div",{className:"p-2 lg:p-3 overflow-y-auto max-h-[calc(100vh-150px)]",children:a})]})}):null},ci=e=>{let{value:t,onChange:r,onPlaceSelect:n,placeholder:a="Enter address",className:s="",disabled:i=!1,required:l=!1,name:c="address",id:d=null}=e;const u=(0,o.useRef)(null),[h,m]=(0,o.useState)(!1),[p,f]=(0,o.useState)(null),[g,v]=(0,o.useState)([]),[x,b]=(0,o.useState)(!1),[y,w]=(0,o.useState)(-1);(0,o.useEffect)(()=>{j()},[]);const j=()=>{const e="AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0";console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Starting Google Maps API load"),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: API Key exists:",!0),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: API Key value:",e?"".concat(e.substring(0,10),"..."):"undefined"),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: All env vars:",Object.keys({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}).filter(e=>e.includes("GOOGLE"))),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Using Places API (New) REST endpoints"),m(!0),N()},N=()=>{if(console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Initializing Places API (New) REST endpoints"),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: inputRef.current exists:",!!u.current),u.current)try{console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Places API (New) REST endpoints ready")}catch(XI){console.error("Error initializing Places API (New):",XI),f("Failed to initialize address autocomplete")}else console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Input ref not available")},S=async e=>{const t="AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0";try{console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Fetching suggestions from Google Places API (New)"),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: API Key present:",!0);const r=await fetch("https://places.googleapis.com/v1/places:autocomplete",{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":t,"X-Goog-FieldMask":"suggestions.placePrediction.placeId,suggestions.placePrediction.text,suggestions.placePrediction.structuredFormat,suggestions.placePrediction.structuredFormat.mainText,suggestions.placePrediction.structuredFormat.secondaryText"},body:JSON.stringify({input:e,includedRegionCodes:["US"],languageCode:"en",regionCode:"US"})});if(r.ok){const e=await r.json();if(console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Google Places API response:",e),e.suggestions&&e.suggestions.length>0){const t=e.suggestions.map(e=>{var t,r,n,a,s,o,i,l,c,d;return console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Raw suggestion:",e),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: placePrediction:",e.placePrediction),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: text field:",null===(t=e.placePrediction)||void 0===t?void 0:t.text),{place_id:null===(r=e.placePrediction)||void 0===r?void 0:r.placeId,description:"string"===typeof(null===(n=e.placePrediction)||void 0===n?void 0:n.text)?e.placePrediction.text:(null===(a=e.placePrediction)||void 0===a||null===(s=a.text)||void 0===s?void 0:s.text)||"",structured_formatting:{main_text:"string"===typeof(null===(o=e.placePrediction)||void 0===o?void 0:o.text)?e.placePrediction.text:(null===(i=e.placePrediction)||void 0===i||null===(l=i.text)||void 0===l?void 0:l.text)||"",secondary_text:(null===(c=e.placePrediction)||void 0===c||null===(d=c.structuredFormat)||void 0===d?void 0:d.secondaryText)||""}}});v(t),b(!0),w(-1)}else v([]),b(!1)}else{const e=await r.text();console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Google Places API error:",r.status,r.statusText),console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Error response:",e),v([]),b(!1)}}catch(p){console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Places API (New) fetch error:",p),v([]),b(!1)}},k=e=>{const t=e.description;r({target:{name:c,value:t}}),b(!1),v([]),e.place_id&&A(e.place_id)},A=async e=>{try{console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Fetching place details from Google Places API (New)");const t=await fetch("https://places.googleapis.com/v1/places/".concat(e),{method:"GET",headers:{"X-Goog-Api-Key":"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0","X-Goog-FieldMask":"formattedAddress,location,addressComponents,id,types"}});if(t.ok){const e=await t.json();console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Place details response:",e),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Address components:",e.addressComponents),e.addressComponents&&(console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: All address components:",e.addressComponents),e.addressComponents.forEach((e,t)=>{console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Component ".concat(t,":"),e)}));const r={};e.addressComponents&&e.addressComponents.forEach(e=>{e.types&&e.types.forEach(t=>{"postal_code"===t?r.postal_code=e.longText:"locality"===t?r.locality=e.longText:"administrative_area_level_1"===t?r.administrative_area_level_1=e.longText:"country"===t?r.country=e.longText:"street_number"===t?r.street_number=e.longText:"route"===t&&(r.route=e.longText)})}),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Parsed components:",r),console.log("\ud83d\udd0d GOOGLE MAPS DEBUG: Postal code found:",r.postal_code),n&&n({formattedAddress:e.formattedAddress,geometry:{location:e.location},addressComponents:r,placeId:e.id,name:e.name,types:e.types})}else{const e=await t.text();console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Place details error:",t.status,t.statusText),console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Error response:",e)}}catch(p){console.error("\ud83d\udd0d GOOGLE MAPS DEBUG: Place details fetch error:",p)}};return(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("input",{ref:u,type:"text",name:c,id:d||c,value:t,onChange:e=>{const t=e.target.value;r(e),f(null),t.length>2?S(t):(v([]),b(!1))},onKeyDown:e=>{if(x&&0!==g.length)switch(e.key){case"ArrowDown":e.preventDefault(),w(e=>e<g.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),w(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),y>=0&&y<g.length&&k(g[y]);break;case"Escape":b(!1),w(-1)}},onBlur:()=>{setTimeout(()=>{b(!1),w(-1)},200)},placeholder:a,disabled:i,required:l,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ".concat(p?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"," ").concat(s),autoComplete:"off"}),x&&g.length>0&&(0,kt.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:g.map((e,t)=>{var r,n;return(0,kt.jsx)("div",{className:"px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ".concat(t===y?"bg-blue-50 text-blue-700":"hover:bg-gray-50"),onClick:()=>k(e),children:(0,kt.jsxs)("div",{className:"flex items-start gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4 mt-0.5 text-gray-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:"string"===typeof(null===(r=e.structured_formatting)||void 0===r?void 0:r.main_text)?e.structured_formatting.main_text:e.description||""}),(null===(n=e.structured_formatting)||void 0===n?void 0:n.secondary_text)&&"string"===typeof e.structured_formatting.secondary_text&&(0,kt.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.structured_formatting.secondary_text})]})]})},e.place_id)})}),!h&&!p&&(0,kt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,kt.jsx)("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),p&&(0,kt.jsxs)("div",{className:"mt-1 text-xs text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),p]}),h&&(0,kt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]})},di=["title","titleId"];function ui(e,t){let{title:r,titleId:n}=e,a=An(e,di);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const hi=o.forwardRef(ui),mi=()=>{const[e,t]=(0,o.useState)([]),r=(0,o.useRef)(null),n="nav_history";(0,o.useEffect)(()=>{try{const e=sessionStorage.getItem(n);if(e){const r=JSON.parse(e);Array.isArray(r)&&t(r)}}catch(e){console.warn("Failed to load navigation history:",e),sessionStorage.removeItem(n)}},[]),(0,o.useEffect)(()=>{try{sessionStorage.setItem(n,JSON.stringify(e))}catch(t){console.warn("Failed to save navigation history:",t)}},[e]);const a=(0,o.useCallback)(()=>{const e={x:window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,y:window.scrollY||window.pageYOffset||document.documentElement.scrollTop},t={};document.querySelectorAll("input, select, textarea").forEach(e=>{if(e.name||e.id){const r=e.name||e.id;"checkbox"===e.type||"radio"===e.type?t[r]=e.checked:t[r]=e.value}});const r=[];return document.querySelectorAll('[data-selected="true"], .selected, .active').forEach(e=>{(e.dataset.projectId||e.dataset.itemId||e.id)&&r.push({selector:e.dataset.projectId?'[data-project-id="'.concat(e.dataset.projectId,'"]'):e.dataset.itemId?'[data-item-id="'.concat(e.dataset.itemId,'"]'):"#".concat(e.id),type:"active"})}),{scrollPosition:e,formData:t,activeElements:r,timestamp:Date.now()}},[]),s=(0,o.useCallback)(e=>{e&&(e.scrollPosition&&(setTimeout(()=>{window.scrollTo({left:e.scrollPosition.x,top:e.scrollPosition.y,behavior:"auto"})},50),setTimeout(()=>{window.scrollTo({left:e.scrollPosition.x,top:e.scrollPosition.y,behavior:"smooth"})},200)),e.formData&&Object.entries(e.formData).forEach(e=>{let[t,r]=e;const n=document.querySelector('[name="'.concat(t,'"], #').concat(t));n&&("checkbox"===n.type||"radio"===n.type?n.checked=r:n.value=r,n.dispatchEvent(new Event("change",{bubbles:!0})))}),e.activeElements&&setTimeout(()=>{e.activeElements.forEach(e=>{let{selector:t,type:r}=e;const n=document.querySelector(t);n&&"active"===r&&(n.classList.add("selected","active"),n.dataset.selected="true")})},100))},[]),i=(0,o.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=a(),i={id:Date.now().toString(),pageName:e,pageData:n,pageState:(0,Y.A)((0,Y.A)({},o),s),timestamp:Date.now(),url:window.location.href,pathname:window.location.pathname,search:window.location.search};t(e=>[...e,i].slice(-50)),r.current=i},[a]),l=(0,o.useCallback)(()=>{if(0===e.length)return window.history.back(),null;t(e=>e.slice(0,-1));const n=e[e.length-2]||e[e.length-1];return n?(r.current=n,setTimeout(()=>{s(n.pageState)},100),{pageName:n.pageName,pageData:n.pageData,pageState:n.pageState}):null},[e,s]),c=(0,o.useCallback)(()=>{if(e.length<2)return null;const t=e[e.length-2];return{pageName:t.pageName,pageData:t.pageData,pageState:t.pageState}},[e]),d=(0,o.useCallback)(()=>e.length>1,[e]),u=(0,o.useCallback)(()=>{t([]),r.current=null;try{sessionStorage.removeItem(n)}catch(e){console.warn("Failed to clear navigation history:",e)}},[]),h=(0,o.useCallback)(e=>{if(r.current){const n=(0,Y.A)((0,Y.A)((0,Y.A)({},r.current.pageState),e),{},{timestamp:Date.now()});r.current.pageState=n,t(e=>{const t=[...e];return t.length>0&&(t[t.length-1].pageState=n),t})}},[]),m=(0,o.useCallback)(()=>r.current,[]),p=(0,o.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=a(),i={id:Date.now().toString(),pageName:e,pageData:n,pageState:(0,Y.A)((0,Y.A)({},o),s),timestamp:Date.now(),url:window.location.href,pathname:window.location.pathname,search:window.location.search};t(e=>{const t=[...e];return t.length>0?t[t.length-1]=i:t.push(i),t}),r.current=i},[a]),f=(0,o.useCallback)(()=>e.map(e=>({id:e.id,pageName:e.pageName,timestamp:e.timestamp,url:e.url})),[e]);return{pushNavigation:i,goBack:l,getPrevious:c,canGoBack:d,clearHistory:u,updateCurrentPageState:h,getCurrentPage:m,replaceNavigation:p,capturePageState:a,restorePageState:s,getBreadcrumbs:f,history:e,historyLength:e.length}},pi=(0,o.createContext)(),fi="SET_CONTEXT",gi="CLEAR_CONTEXT",vi="UPDATE_SCROLL_POSITION",xi="SET_FILTERS",bi="SET_EXPANDED_STATE",yi="PUSH_NAVIGATION",wi="POP_NAVIGATION",ji={navigationStack:[],currentContext:null,scrollPositions:{},expandedStates:{},filters:{}};function Ni(e,t){switch(t.type){case yi:return(0,Y.A)((0,Y.A)({},e),{},{navigationStack:[...e.navigationStack,t.payload],currentContext:t.payload});case wi:const r=[...e.navigationStack];return r.pop(),(0,Y.A)((0,Y.A)({},e),{},{navigationStack:r,currentContext:r[r.length-1]||null});case fi:return(0,Y.A)((0,Y.A)({},e),{},{currentContext:(0,Y.A)((0,Y.A)({},e.currentContext),t.payload)});case gi:return(0,Y.A)((0,Y.A)({},e),{},{navigationStack:[],currentContext:null});case vi:return(0,Y.A)((0,Y.A)({},e),{},{scrollPositions:(0,Y.A)((0,Y.A)({},e.scrollPositions),{},{[t.payload.contextId]:t.payload.position})});case xi:return(0,Y.A)((0,Y.A)({},e),{},{filters:(0,Y.A)((0,Y.A)({},e.filters),{},{[t.payload.contextId]:t.payload.filters})});case bi:return(0,Y.A)((0,Y.A)({},e),{},{expandedStates:(0,Y.A)((0,Y.A)({},e.expandedStates),{},{[t.payload.contextId]:t.payload.state})});default:return e}}function Si(e){let{children:t}=e;const[r,n]=(0,o.useReducer)(Ni,ji),a=F(),s=mi(),i=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=Date.now(),n=JSON.stringify(t);return"".concat(e,"_").concat(r,"_").concat(btoa(n).slice(0,10))},[]),l=(0,o.useCallback)(e=>{const t=i(e.section,e),r=(0,Y.A)((0,Y.A)({},e),{},{contextId:t,timestamp:Date.now()});return n({type:yi,payload:r}),t},[i]),c=(0,o.useCallback)((e,t)=>{if(r.currentContext){const e=window.scrollY;n({type:vi,payload:{contextId:r.currentContext.contextId,position:e}})}const o=l(t);return s.pushNavigation(t.section||"Unknown Page",{contextId:o,contextData:t,path:e},{contextNavigation:!0,originalContextId:o}),a(e),o},[r.currentContext,l,a,s]),d=(0,o.useCallback)(()=>{if(s.canGoBack()){var e;const t=s.goBack();if(null!==t&&void 0!==t&&null!==(e=t.pageData)&&void 0!==e&&e.contextNavigation){const e=t.pageData.contextData;if(null!==e&&void 0!==e&&e.returnPath)return void a(e.returnPath)}return}if(0===r.navigationStack.length)return void a(-1);n({type:wi});const t=r.navigationStack[r.navigationStack.length-2];t?(a(t.returnPath),setTimeout(()=>{const e=r.scrollPositions[t.contextId];void 0!==e&&window.scrollTo(0,e)},100)):a("/dashboard")},[r.navigationStack,r.scrollPositions,a,s]),u=(0,o.useCallback)(e=>{r.currentContext&&n({type:vi,payload:{contextId:r.currentContext.contextId,position:e||window.scrollY}})},[r.currentContext]),h=(0,o.useCallback)(e=>{r.currentContext&&n({type:xi,payload:{contextId:r.currentContext.contextId,filters:e}})},[r.currentContext]),m=(0,o.useCallback)(e=>r.filters[e]||{},[r.filters]),p=(0,o.useCallback)(e=>{r.currentContext&&n({type:bi,payload:{contextId:r.currentContext.contextId,state:e}})},[r.currentContext]),f=(0,o.useCallback)(e=>r.expandedStates[e]||{},[r.expandedStates]),g=(0,o.useCallback)(()=>{n({type:gi})},[]),v=(0,o.useCallback)(()=>r.navigationStack.length<2?null:r.navigationStack[r.navigationStack.length-2],[r.navigationStack]),x=(0,o.useCallback)(()=>r.navigationStack.length>0||s.canGoBack(),[r.navigationStack,s]),b={currentContext:r.currentContext,navigationStack:r.navigationStack,scrollPositions:r.scrollPositions,expandedStates:r.expandedStates,filters:r.filters,navigateWithContext:c,navigateBack:d,pushNavigationContext:l,clearNavigationContext:g,updateScrollPosition:u,saveFilters:h,getSavedFilters:m,saveExpandedState:p,getSavedExpandedState:f,getPreviousContext:v,canNavigateBack:x,createContextId:i,historyManager:s,navigationHistory:s.history,canGoBackInHistory:s.canGoBack,clearNavigationHistory:s.clearHistory,getBreadcrumbs:s.getBreadcrumbs};return(0,kt.jsx)(pi.Provider,{value:b,children:t})}function ki(){const e=(0,o.useContext)(pi);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}const Ai=["className","colorMode","showNavigationInfo","navigationContext"],Ci=["className","colorMode"],Ei=["className","colorMode"],Pi=["className","showLabel","colorMode"],_i=["position","colorMode"],Ii=["colorMode"],Ti=["showBreadcrumbs","colorMode"],Li=(0,o.memo)(e=>{let{className:t="",variant:r="default",showLabel:n=!0,customLabel:a=null,onClick:s=null,disabled:o=!1,colorMode:i=!1,size:l="medium",preservePosition:c=!0}=e;const{navigateBack:d,canNavigateBack:u,currentContext:h,getPreviousContext:m}=ki(),{goBack:p,getPrevious:f,canGoBack:g,restorePageState:v,capturePageState:x}=mi(),b=o||!s&&!u()&&!g(),y=(()=>{if(a)return a;if(!n)return null;const e=f();if(null!==e&&void 0!==e&&e.pageName&&c)return"Back to ".concat(e.pageName);const t=m();if(!t)return"Back to Dashboard";switch(t.section){case"Current Projects by Phase":return t.selectedPhase?"Back to ".concat(t.selectedPhase," Projects"):"Back to Projects by Phase";case"My Project Messages":return"message"===t.type&&t.selectedData?"Back to Messages":"Back to Project Messages";case"Current Alerts":return"alert"===t.type&&t.selectedData?"Back to Alerts":"Back to Current Alerts";case"Current Project Access":return"project-cube"===t.type&&t.selectedData,"Back to Project Access";default:return"Back"}})();return(0,kt.jsxs)("button",{type:"button",onClick:()=>{if(s)return c&&x(),void s();if(c&&g()){if(p())return}u()?d():window.history.back()},disabled:b,className:"".concat((()=>{const e="inline-flex items-center transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 ".concat((()=>{switch(l){case"small":return"px-2 py-1 text-xs";case"large":return"px-5 py-3 text-base";default:return"px-3 py-2 text-sm"}})());switch(r){case"primary":return"".concat(e," ").concat(i?"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white focus:ring-blue-500 disabled:bg-slate-600":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white focus:ring-blue-500 disabled:bg-gray-300"," rounded-lg disabled:cursor-not-allowed");case"secondary":return"".concat(e," ").concat(i?"bg-slate-600 hover:bg-slate-700 text-white focus:ring-slate-500 disabled:bg-slate-800 disabled:text-slate-500":"bg-gray-200 hover:bg-gray-300 text-gray-700 focus:ring-gray-500 disabled:bg-gray-100 disabled:text-gray-400"," rounded-lg disabled:cursor-not-allowed");case"ghost":return"".concat(e," ").concat(i?"text-slate-300 hover:text-white hover:bg-slate-700 focus:ring-slate-500 disabled:text-slate-600":"text-gray-600 hover:text-gray-800 hover:bg-gray-100 focus:ring-gray-500 disabled:text-gray-400"," rounded disabled:cursor-not-allowed");case"minimal":return"".concat(e," ").concat(i?"text-blue-400 hover:text-blue-300 focus:ring-blue-500 disabled:text-slate-600":"text-blue-600 hover:text-blue-800 focus:ring-blue-500 disabled:text-gray-400"," disabled:cursor-not-allowed");default:return"".concat(e," ").concat(i?"bg-slate-700 border border-slate-600 text-slate-200 hover:bg-slate-600 hover:border-slate-500 focus:ring-blue-500 disabled:bg-slate-800 disabled:border-slate-700 disabled:text-slate-500":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400 focus:ring-blue-500 disabled:bg-gray-50 disabled:border-gray-200 disabled:text-gray-400"," rounded-md disabled:cursor-not-allowed")}})()," ").concat(t),title:y||"Go back","aria-label":y||"Go back",children:[(0,kt.jsx)(hi,{className:"".concat((()=>{switch(l){case"small":return"h-3 w-3";case"large":return"h-6 w-6";default:return"h-4 w-4"}})()," ").concat(y?"mr-2":""),"aria-hidden":"true"}),y&&(0,kt.jsx)("span",{className:"font-medium",children:y})]})}),Di=(0,o.memo)(e=>{let{className:t="",colorMode:r=!1,showNavigationInfo:n=!1,navigationContext:a=null}=e,s=An(e,Ai);return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"block sm:hidden",children:(0,kt.jsx)(Li,(0,Y.A)((0,Y.A)({},s),{},{size:"small",showLabel:!1,colorMode:r,className:"".concat(t||"")}))}),(0,kt.jsx)("div",{className:"hidden sm:block lg:hidden",children:(0,kt.jsx)(Li,(0,Y.A)((0,Y.A)({},s),{},{size:"medium",showLabel:!0,customLabel:"Back",colorMode:r,className:"".concat(t||"")}))}),(0,kt.jsx)("div",{className:"hidden lg:block",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(Li,(0,Y.A)((0,Y.A)({},s),{},{size:"medium",showLabel:!0,colorMode:r,className:"".concat(t||"")})),n&&a&&(0,kt.jsx)("div",{className:"text-xs ".concat(r?"text-slate-400":"text-gray-500"),children:a.canGoBack?(0,kt.jsxs)("span",{children:["\u2190 Back to ",a.previousPage]}):(0,kt.jsx)("span",{children:"\u2190 Back to Dashboard"})})]})})]})}),Mi=(0,o.memo)(e=>{let{className:t="",colorMode:r=!1}=e,n=An(e,Ci);return(0,kt.jsx)(Li,(0,Y.A)({variant:"ghost",size:"medium",colorMode:r,className:"mr-4 ".concat(t)},n))}),Oi=(0,o.memo)(e=>{let{className:t="",colorMode:r=!1}=e,n=An(e,Ei);return(0,kt.jsx)(Li,(0,Y.A)({variant:"secondary",size:"medium",colorMode:r,className:"mb-4 ".concat(t)},n))}),Ri=(0,o.memo)(e=>{let{className:t="",showLabel:r=!1,colorMode:n=!1}=e,a=An(e,Pi);return(0,kt.jsx)(Li,(0,Y.A)({variant:"minimal",size:"small",showLabel:r,colorMode:n,className:t},a))}),Fi=(0,o.memo)(e=>{let{position:t="top-left",colorMode:r=!1}=e,n=An(e,_i);return(0,kt.jsx)("div",{className:"fixed ".concat({"top-left":"top-4 left-4","top-right":"top-4 right-4","bottom-left":"bottom-4 left-4","bottom-right":"bottom-4 right-4"}[t]," z-50"),children:(0,kt.jsx)(Li,(0,Y.A)((0,Y.A)({},n),{},{variant:"primary",size:"medium",colorMode:r,className:"shadow-lg ".concat(n.className||"")}))})}),Ui=(0,o.memo)(e=>{let{colorMode:t=!1}=e,r=An(e,Ii);return(0,kt.jsx)(Li,(0,Y.A)((0,Y.A)({},r),{},{size:"small",showLabel:!1,variant:"ghost",colorMode:t,className:"rounded-full ".concat(r.className||"")}))}),Bi=(0,o.memo)(e=>{let{className:t="",colorMode:r=!1}=e;const{currentContext:n}=ki();if(!n)return null;return(0,kt.jsx)(Li,{variant:(()=>{switch(n.type){case"project":return"primary";case"message":return"secondary";case"alert":return"ghost";default:return"default"}})(),colorMode:r,className:t})}),zi=(0,o.memo)(e=>{let{showBreadcrumbs:t=!1,colorMode:r=!1}=e,n=An(e,Ti);const{getBreadcrumbs:a}=mi(),s=a();return(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(Li,(0,Y.A)({colorMode:r},n)),t&&s.length>1&&(0,kt.jsx)("div",{className:"hidden md:flex items-center gap-1 text-sm ".concat(r?"text-slate-400":"text-gray-500"),children:s.slice(-3).map((e,t,n)=>(0,kt.jsxs)(o.Fragment,{children:[t>0&&(0,kt.jsx)("span",{children:"/"}),(0,kt.jsx)("span",{className:t===n.length-1?r?"font-medium text-slate-300":"font-medium text-gray-700":"",children:e.pageName})]},e.id))})]})});Li.displayName="BackButton",Di.displayName="ResponsiveBackButton",Mi.displayName="HeaderBackButton",Oi.displayName="CardBackButton",Ri.displayName="MinimalBackButton",Fi.displayName="FloatingBackButton",Ui.displayName="CompactBackButton",Bi.displayName="ContextAwareBackButton",zi.displayName="BreadcrumbBackButton";const Wi={projectNumber:"",projectName:"",customerName:"",jobType:"",tradeTypes:[],projectManager:"",fieldDirector:"",salesRep:"",qualityInspector:"",adminAssistant:"",status:"Pending",budget:"",startDate:"",endDate:"",customer:"",address:"",priority:"Low",description:"",contacts:[{name:"",phone:"",email:"",isPrimary:!1},{name:"",phone:"",email:"",isPrimary:!1},{name:"",phone:"",email:"",isPrimary:!1}]},qi=e=>{var t,r,n,a;let{project:s,isSelected:o,onSelect:i,onProjectSelect:l,getPhaseForProject:c,getPhaseColorForProject:d,getProjectProgress:u,colorMode:h,isExpanded:m,onToggleExpansion:p,isPast:f=!1}=e;const g=c(null===s||void 0===s?void 0:s.id),v=Wn.getPhaseName(g),x=Wn.getPhaseColor(g);return(0,kt.jsxs)("div",{className:"border rounded-xl transition-all duration-300 hover:shadow-lg cursor-pointer ".concat(o?"border-blue-500 shadow-blue-100 bg-blue-50/50":"border-gray-200 hover:border-gray-300 bg-white"," ").concat(f?"opacity-75":""),children:[(0,kt.jsxs)("div",{className:"p-4",onClick:i,children:[(0,kt.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("h3",{className:"font-semibold text-gray-900 truncate",children:["#",s.projectNumber||"N/A"," - ",s.name||s.projectName||"Untitled Project"]}),(0,kt.jsx)("p",{className:"text-sm text-gray-600 truncate",children:(null===(t=s.customer)||void 0===t?void 0:t.primaryName)||"Unknown Customer"}),(null===(r=s.customer)||void 0===r?void 0:r.address)&&(0,kt.jsx)("p",{className:"text-xs text-gray-500 truncate mt-1",children:s.customer.address})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(x.bg," ").concat(x.text),children:v}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),p()},className:"p-1 hover:bg-gray-100 rounded",children:m?(0,kt.jsx)(mn,{className:"w-4 h-4"}):(0,kt.jsx)(tn,{className:"w-4 h-4"})})]})]}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Progress:"}),(0,kt.jsxs)("span",{className:"font-medium",children:[u(s),"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full bg-[#F8FAFC] rounded-full transition-all duration-300",style:{width:"".concat(u(s),"%")}})})]})]}),m&&(0,kt.jsxs)("div",{className:"px-4 pb-4 border-t border-gray-100 pt-3",children:[(0,kt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Project Manager:"}),(0,kt.jsx)("span",{className:"ml-2 text-gray-900",children:s.projectManager?"".concat(s.projectManager.firstName," ").concat(s.projectManager.lastName):"Not Assigned"})]}),(null===(n=s.customer)||void 0===n?void 0:n.primaryPhone)&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Phone:"}),(0,kt.jsx)("a",{href:"tel:".concat(s.customer.primaryPhone.replace(/[^\d+]/g,"")),className:"ml-2 text-blue-600 hover:underline",children:s.customer.primaryPhone})]}),(null===(a=s.customer)||void 0===a?void 0:a.primaryEmail)&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Email:"}),(0,kt.jsx)("a",{href:"mailto:".concat(s.customer.primaryEmail),className:"ml-2 text-blue-600 hover:underline",children:s.customer.primaryEmail})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[(0,kt.jsxs)("button",{onClick:async()=>{try{const e=null===s||void 0===s?void 0:s.currentWorkflowItem,t=ds.getCurrentLineItem(s),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||ds.getCurrentSection(s),n=c(s.id),a=await fetch("/api/workflow-data/project-position/".concat(s.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});let o=(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0"),i="string"===typeof r?r.toLowerCase().replace(/\s+/g,"-"):r||"",d=null;if(a.ok){const e=await a.json();if(e.success&&e.data){const r=e.data;o=(null===t||void 0===t?void 0:t.id)||r.currentLineItemId||o,i=r.currentSectionId||i,d=r.workflowId||null}}const u=(0,Y.A)((0,Y.A)({},s),{},{navigationSource:s.navigationSource||"Project Profile",returnToSection:s.returnToSection||"project-profile",highlightStep:(null===t||void 0===t?void 0:t.name)||"Line Item",highlightLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",targetPhase:n,targetSection:r,targetLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",stepName:(null===t||void 0===t?void 0:t.name)||"Line Item",lineItemId:o,workflowId:d,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(o),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:i,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});l(u,"Project Workflow",null,"Project Profile",o,i)}catch(_t){l(s,"Project Workflow",null,"Project Profile")}},className:"flex flex-col items-center gap-1 p-2 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all duration-200 text-xs",children:[(0,kt.jsx)("span",{children:"\ud83d\uddc2\ufe0f"}),"Workflow"]}),(0,kt.jsxs)("button",{onClick:()=>l(s,"Messages",null,"Project Profile"),className:"flex flex-col items-center gap-1 p-2 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all duration-200 text-xs",children:[(0,kt.jsx)("span",{children:"\ud83d\udcac"}),"Messages"]})]})]})]})},Vi=e=>{var t,r,n,a,s,i,l,c,d,u,h,m,p,f,g,v,x,b,y,w,j;let{onProjectSelect:N,onProjectActionSelect:S,onCreateProject:k,projects:A,colorMode:C,projectSourceSection:E,onNavigateBack:P,scrollToProject:_}=e;const{pushNavigation:I}=mi(),[T,L]=(0,o.useState)(null),[D,M]=(0,o.useState)(!1),[O,R]=(0,o.useState)(Wi),[F,U]=(0,o.useState)(""),[B,z]=(0,o.useState)({}),[W,q]=(0,o.useState)(0),[V,H]=(0,o.useState)(0),[G,K]=(0,o.useState)(""),[J,X]=(0,o.useState)("projectNumber"),[Q,Z]=(0,o.useState)("desc"),$=(()=>{const e=Ct();return La({mutationFn:e=>Da.projectsService.create(e),onSuccess:t=>{e.invalidateQueries({queryKey:as.projects}),e.invalidateQueries({queryKey:as.projectStats}),e.invalidateQueries({queryKey:as.workflowAlerts}),null!==t&&void 0!==t&&t.data&&e.setQueryData(as.project(t.data.id),t)},onError:e=>{console.error("Failed to create project:",e)}})})(),{data:ee,isLoading:te,error:re}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Pa({queryKey:[...as.customers,e],queryFn:()=>Da.customersService.getAll(e),select:e=>(null===e||void 0===e?void 0:e.data)||e||[]})}({limit:100}),{data:ne,isLoading:ae,error:se,refetch:oe}=ss({limit:100,retry:3,retryDelay:1e3,refetchOnWindowFocus:!0}),[ie,le]=(0,o.useState)([]),[ce,de]=(0,o.useState)({}),[ue,he]=(0,o.useState)(!0),[me,pe]=(0,o.useState)({}),[fe,ge]=(0,o.useState)(!0),[ve,xe]=(0,o.useState)(!1),[be,ye]=(0,o.useState)(null),[we,je]=(0,o.useState)(!1),{workflowStates:Ne,getWorkflowState:Se,getPhaseForProject:ke,getPhaseColorForProject:Ae,getPhaseInitialForProject:Ce,getProgressForProject:Ee}=(e=>{const[t,r]=(0,o.useState)(()=>{if(!e||!Array.isArray(e))return{};const t={};return e.forEach(e=>{e&&e.id&&(t[e.id]=ds.getProjectWorkflowState(e))}),t});return(0,o.useEffect)(()=>{if(!e||!Array.isArray(e))return;const t={};e.forEach(e=>{e&&e.id&&(t[e.id]=ds.getProjectWorkflowState(e))}),r(t)},[e]),(0,o.useEffect)(()=>ds.addListener((e,t)=>{r(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))}),[]),{workflowStates:t,getWorkflowState:e=>t[e],getPhaseForProject:e=>{var r;return(null===(r=t[e])||void 0===r?void 0:r.currentPhase)||"LEAD"},getPhaseColorForProject:e=>{var r;return(null===(r=t[e])||void 0===r?void 0:r.phaseColor)||"#94A3B8"},getPhaseInitialForProject:e=>{var r;return(null===(r=t[e])||void 0===r?void 0:r.phaseInitial)||"L"},getProgressForProject:e=>{var r;return(null===(r=t[e])||void 0===r?void 0:r.overallProgress)||0}}})(ne),Pe=Array.isArray(null===ne||void 0===ne?void 0:ne.data)?ne.data:Array.isArray(ne)?ne:[],_e=Array.isArray(ee)?ee:[];(0,o.useEffect)(()=>{I("Project Profile",{projectSourceSection:E,scrollToProject:_})},[I,E]),(0,o.useEffect)(()=>{!T&&Pe.length>0&&L(Pe[0])},[Pe,T]),(0,o.useEffect)(()=>{(async()=>{try{var e;const t=await Da.usersService.getTeamMembers(),r=Array.isArray(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.teamMembers)?t.data.teamMembers:Array.isArray(null===t||void 0===t?void 0:t.data)?t.data:Array.isArray(t)?t:[];le(r);const n={};r.forEach(e=>{e.role&&e.role.permissions&&e.role.permissions.includes("project_manager")&&(n.projectManager||(n.projectManager=e.id)),e.role&&"Field Director"===e.role.name&&!n.fieldDirector&&(n.fieldDirector=e.id),e.role&&"Sales Rep"===e.role.name&&!n.salesRep&&(n.salesRep=e.id)}),de(n)}catch(F){console.error("Error fetching users:",F),le([])}finally{he(!1)}})()},[]),(0,o.useEffect)(()=>{let e=!0;return(async()=>{try{ge(!0);const t=await fetch("/api/lead-sources");if(!t.ok)throw new Error("Failed to load lead sources");const r=await t.json(),n=Array.isArray(null===r||void 0===r?void 0:r.data)?r.data:Array.isArray(r)?r:[],a={};n.forEach(e=>{e&&e.id&&(a[e.id]=e)}),e&&pe(a)}catch(_t){console.error("Error loading lead sources:",_t),e&&pe({})}finally{e&&ge(!1)}})(),()=>{e=!1}},[]);const{currentProjects:Ie,pastProjects:Te}=(()=>{const e=(()=>{let e=[...Pe];if(G.trim()){const t=G.toLowerCase();e=e.filter(e=>{var r,n;return(e.projectName||e.name||"").toLowerCase().includes(t)||(e.projectNumber||"").toString().toLowerCase().includes(t)||((null===(r=e.customer)||void 0===r?void 0:r.primaryName)||"").toLowerCase().includes(t)||((null===(n=e.customer)||void 0===n?void 0:n.address)||"").toLowerCase().includes(t)})}return e.sort((e,t)=>{var r,n;let a,s;switch(J){case"projectNumber":a=Number(e.projectNumber||0),s=Number(t.projectNumber||0);break;case"startDate":a=new Date(e.startDate||0),s=new Date(t.startDate||0);break;case"customer":a=((null===(r=e.customer)||void 0===r?void 0:r.primaryName)||"").toLowerCase(),s=((null===(n=t.customer)||void 0===n?void 0:n.primaryName)||"").toLowerCase();break;default:a=(e.projectName||e.name||"").toLowerCase(),s=(t.projectName||t.name||"").toLowerCase()}if("string"===typeof a){const e=a.localeCompare(s);return"asc"===Q?e:-e}if(a instanceof Date){const e=a-s;return"asc"===Q?e:-e}{const e=(a||0)-(s||0);return"asc"===Q?e:-e}}),e})();return{currentProjects:e.filter(e=>{const t=ke(e.id);return"completion"!==t&&"archived"!==t}),pastProjects:e.filter(e=>{const t=ke(e.id);return"completion"===t||"archived"===t})}})(),Le=(e,t)=>{const r=6*t,n=r+6;return e.slice(r,n)},De=e=>Math.ceil(e.length/6),Me=e=>{const t=Wn.calculateProjectProgress(e).overall||0;return Math.min(100,Math.max(0,Math.round(t)))},Oe=e=>{const{name:t,value:r}=e.target;R(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:r}))},Re=(e,t,r)=>{const n=[...O.contacts];n[e]=(0,Y.A)((0,Y.A)({},n[e]),{},{[t]:r}),"isPrimary"===t&&r&&n.forEach((t,r)=>{r!==e&&(t.isPrimary=!1)}),R(e=>(0,Y.A)((0,Y.A)({},e),{},{contacts:n}))},Fe=(0,o.useRef)(null),[Ue,Be]=(0,o.useState)({entries:[]}),ze=e=>{const t=Array.from(e||[]).map(e=>({file:e,name:e.name,size:e.size,progress:0,status:"pending",error:null,description:"",tagsString:""}));Be({entries:t})},We=(e,t)=>{Be(r=>{const n=Array.isArray(r.entries)?[...r.entries]:[];return n[e]?(n[e]=(0,Y.A)((0,Y.A)({},n[e]),t),{entries:n}):r})},qe=async e=>{try{var t,r,n,a,s,o,i,l,c,d;const b=await(async()=>{let e=(await Ma.assetsService.listFolders({parentId:null,sortBy:"title",sortOrder:"asc",limit:1e3})).find(e=>"Projects"===(e.folderName||e.title));var t;return e||(e=await Ma.assetsService.createFolder({name:"Projects",parentId:null}),"function"===typeof(null===(t=window)||void 0===t?void 0:t.dispatchEvent)&&window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:null}}))),e})();if(console.log("Projects root:",b),console.log("Root folder details:",{id:null===b||void 0===b?void 0:b.id,name:(null===b||void 0===b?void 0:b.title)||(null===b||void 0===b?void 0:b.folderName),type:null===b||void 0===b?void 0:b.type}),!b||!b.id)throw new Error("Failed to get or create Projects root folder");const y=await Ma.assetsService.listFolders({parentId:b.id,sortBy:"title",sortOrder:"asc",limit:1e3});console.log("Children folders:",y);const w=(null===(t=e.customer)||void 0===t?void 0:t.primaryName)||(null===(r=e.customer)||void 0===r?void 0:r.firstName)+" "+(null===(n=e.customer)||void 0===n?void 0:n.lastName)||e.customerName||"Unknown",j="".concat(e.projectNumber," - ").concat(w);let N=y.find(e=>(e.folderName||e.title)===j);var u,h;if(!N&&e.projectNumber)console.log("\ud83d\udd0d Searching for existing project folder by project number:",e.projectNumber),N=y.find(t=>{var r;return(null===(r=t.metadata)||void 0===r?void 0:r.projectNumber)===e.projectNumber}),console.log("\ud83d\udd0d Found existing project folder by number:",!!N,(null===(u=N)||void 0===u?void 0:u.title)||(null===(h=N)||void 0===h?void 0:h.folderName));if(!N){var m,p,f,g,v,x;console.log("Creating project folder:",j);const t={projectId:e.id,projectNumber:e.projectNumber,customerName:w,address:e.projectName||e.name||"",isProjectFolder:!0};N=await Ma.assetsService.createFolder({name:j,parentId:b.id,metadata:t}),console.log("\u2705 Created project folder:",N),console.log("\ud83d\udcc1 Project folder details:",{id:null===(m=N)||void 0===m?void 0:m.id,name:(null===(p=N)||void 0===p?void 0:p.title)||(null===(f=N)||void 0===f?void 0:f.folderName),parentId:null===(g=N)||void 0===g?void 0:g.parentId,metadata:null===(v=N)||void 0===v?void 0:v.metadata}),"function"===typeof(null===(x=window)||void 0===x?void 0:x.dispatchEvent)&&window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:b.id}}))}return console.log("\ud83d\udcc1 Using project folder:",{id:null===(a=N)||void 0===a?void 0:a.id,name:(null===(s=N)||void 0===s?void 0:s.title)||(null===(o=N)||void 0===o?void 0:o.folderName),projectNumber:null===(i=N)||void 0===i||null===(l=i.metadata)||void 0===l?void 0:l.projectNumber,projectId:null===(c=N)||void 0===c||null===(d=c.metadata)||void 0===d?void 0:d.projectId}),N}catch(F){throw console.error("Error in ensureProjectFolder:",F),F}},Ve=e=>{z(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!t[e]}))};return ae?(0,kt.jsx)("div",{className:"p-6",children:(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[...Array(6)].map((e,t)=>(0,kt.jsx)(Ss,{},t))})}):se?(0,kt.jsx)(ks,{message:"Failed to load projects",onRetry:oe}):(0,kt.jsxs)("div",{className:"min-h-screen ".concat("bg-[#F8FAFC]"),children:[(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[P&&(0,kt.jsx)(Di,{onClick:P,colorMode:C,className:"mr-2"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-3xl font-bold bg-[#F8FAFC] bg-clip-text text-transparent mb-2",children:"Project Profile"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Comprehensive project management and customer information"})]})]}),(0,kt.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(C?"text-white":"text-gray-900"," mb-3"),children:"Documents"}),(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(C?"bg-slate-700/50":"bg-gray-50"," border ").concat(C?"border-slate-600":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("p",{className:"text-sm ".concat(C?"text-gray-300":"text-gray-700"),children:"Upload files to this project's Documents folder. Files will be saved under the Projects root so they appear in Documents & Resources."}),(0,kt.jsx)("div",{className:"mt-3",children:(0,kt.jsxs)("div",{onDrop:e=>(e=>{var t;e.preventDefault();const r=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;r&&r.length&&ze(r)})(e),onDragOver:e=>e.preventDefault(),className:"w-full p-4 border-2 border-dashed rounded-lg text-center cursor-pointer ".concat(C?"border-slate-600 bg-slate-800/40":"border-gray-200 bg-white"),children:[(0,kt.jsx)("input",{ref:Fe,type:"file",multiple:!0,className:"hidden",onChange:e=>ze(e.target.files)}),(0,kt.jsxs)("div",{className:"text-sm text-gray-500",children:["Drag & drop files here, or ",(0,kt.jsx)("button",{onClick:()=>{var e;return null===(e=Fe.current)||void 0===e?void 0:e.click()},className:"text-blue-600 underline",children:"browse"})]})]})})]}),(0,kt.jsx)("div",{className:"w-full md:w-auto flex flex-col gap-2",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>(async()=>{try{var e;if(!T||!T.id)return void qr.error("No project selected");const t=Ue.entries||[];if(0===t.length)return void qr("No files selected");Be(e=>({entries:e.entries.map(e=>(0,Y.A)((0,Y.A)({},e),{},{status:"uploading",progress:0,error:null}))})),qr.loading("Uploading files..."),console.log("Ensuring project folder for project:",T),console.log("Project details:",{id:T.id,projectNumber:T.projectNumber,name:T.projectName||T.name});const r=await qe(T);if(console.log("Project folder result:",r),console.log("Project folder ID for upload:",null===r||void 0===r?void 0:r.id),!r||!r.id)throw new Error("Failed to create or access project folder");for(let e=0;e<t.length;e++){const n=t[e];if("success"!==n.status){We(e,{status:"uploading",progress:0,error:null});try{const t=(n.tagsString||"").split(",").map(e=>e.trim()).filter(Boolean),a=t=>{if(!t||!t.lengthComputable)return;const r=Math.round(t.loaded/t.total*100);We(e,{progress:r})};console.log("\ud83d\udce4 Uploading file to project folder:",{fileName:n.name,projectFolderId:null===r||void 0===r?void 0:r.id,projectFolderName:(null===r||void 0===r?void 0:r.title)||(null===r||void 0===r?void 0:r.folderName),parentId:(null===r||void 0===r?void 0:r.id)||null});const s={files:[n.file],parentId:(null===r||void 0===r?void 0:r.id)||null,description:n.description||"",tags:t,onUploadProgress:a};console.log("\ud83d\udce4 Upload parameters:",s),await Ma.assetsService.uploadFiles(s),console.log("\u2705 File uploaded successfully to project folder"),We(e,{progress:100,status:"success"})}catch(XI){console.error("Upload failed for file",n.name,XI),We(e,{status:"error",error:(null===XI||void 0===XI?void 0:XI.message)||"Upload failed"})}}}console.log("\ud83d\udd04 Dispatching fm:refresh event for project folder:",null===r||void 0===r?void 0:r.id),"function"===typeof(null===(e=window)||void 0===e?void 0:e.dispatchEvent)&&(window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:(null===r||void 0===r?void 0:r.id)||null}})),window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:null}}))),qr.dismiss();const n=(Ue.entries||[]).some(e=>"error"===e.status);n?qr.error("Some files failed to upload"):qr.success("Files uploaded and organized in project folder")}catch(XI){console.error("Upload flow failed",XI),qr.dismiss(),qr.error("Upload failed: ".concat((null===XI||void 0===XI?void 0:XI.message)||"Unknown error occurred")),Be(e=>({entries:e.entries.map(e=>(0,Y.A)((0,Y.A)({},e),{},{status:"pending",progress:0,error:null}))}))}})(),className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg",children:"Upload Selected"}),(0,kt.jsx)("button",{onClick:()=>{if(T)try{const e={projectId:T.id,project:T};window.dispatchEvent(new CustomEvent("app:openProjectDocuments",{detail:e}))}catch(_t){console.error("Failed to open project documents",_t)}},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg",children:"Open project documents"})]})})]}),Ue.entries&&Ue.entries.length>0&&(0,kt.jsxs)("div",{className:"mt-3 text-sm text-gray-600",children:[(0,kt.jsx)("div",{className:"font-medium",children:"Selected files:"}),(0,kt.jsx)("ul",{className:"mt-2 space-y-2",children:Ue.entries.map((e,t)=>(0,kt.jsxs)("li",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("div",{className:"truncate font-medium",children:e.name}),(0,kt.jsxs)("div",{className:"text-xs text-gray-500",children:[Math.round((e.size||0)/1024)," KB"]})]}),(0,kt.jsx)("div",{className:"w-full bg-gray-200 h-2 rounded mt-2 overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full ".concat("error"===e.status?"bg-red-500":"success"===e.status?"bg-green-500":"bg-blue-500"),style:{width:"".concat(e.progress||0,"%")}})}),(0,kt.jsxs)("div",{className:"mt-1 text-xs",children:["pending"===e.status&&(0,kt.jsx)("span",{className:"text-gray-500",children:"Pending"}),"uploading"===e.status&&(0,kt.jsxs)("span",{className:"text-blue-600",children:["Uploading \u2014 ",e.progress,"%"]}),"success"===e.status&&(0,kt.jsx)("span",{className:"text-green-600",children:"Uploaded"}),"error"===e.status&&(0,kt.jsxs)("span",{className:"text-red-600",children:["Error: ",e.error]})]}),(0,kt.jsxs)("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[(0,kt.jsx)("input",{type:"text",placeholder:"Description (optional)",value:e.description||"",onChange:e=>We(t,{description:e.target.value}),className:"px-2 py-1 border rounded text-sm w-full",disabled:"uploading"===e.status}),(0,kt.jsx)("input",{type:"text",placeholder:"Tags (comma separated)",value:e.tagsString||"",onChange:e=>We(t,{tagsString:e.target.value}),className:"px-2 py-1 border rounded text-sm w-full",disabled:"uploading"===e.status})]})]}),(0,kt.jsx)("div",{children:"uploading"!==e.status&&(0,kt.jsx)("button",{onClick:()=>Be(e=>({entries:e.entries.filter((e,r)=>r!==t)})),className:"text-xs text-red-600 hover:underline",children:"Remove"})})]},t))})]})]})]}),(0,kt.jsxs)("button",{onClick:()=>{R((0,Y.A)((0,Y.A)({},Wi),ce)),M(!0)},className:"flex items-center gap-3 px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300 bg-[#F8FAFC] text-white shadow-soft hover:shadow-medium hover:-translate-y-0.5",children:[(0,kt.jsx)("span",{className:"text-lg",children:"+"}),(0,kt.jsx)("span",{children:"Add New Project"})]})]}),T&&(0,kt.jsxs)("div",{className:"".concat(C?"bg-slate-800/90":"bg-white"," border ").concat(C?"border-slate-600/50":"border-gray-200/50"," shadow-soft rounded-2xl p-6 mb-6"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-2xl font-bold ".concat(C?"text-white":"text-gray-900"," mb-2"),children:T.projectName||T.name||"Project Details"}),(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ".concat(C?Xa(T.projectType):Ya(T.projectType)),children:Ja(T.projectType)}),(0,kt.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(Ae?"".concat(null===(t=Ae(T.id))||void 0===t?void 0:t.bg," ").concat(null===(r=Ae(T.id))||void 0===r?void 0:r.text):"bg-gray-100 text-gray-800"),children:Wn.getPhaseName(ke(T.id))||"Lead"})]})]}),(0,kt.jsxs)("div",{className:"text-right",children:[(0,kt.jsxs)("div",{className:"text-3xl font-bold ".concat(C?"text-white":"text-gray-900"),children:[Me(T),"%"]}),(0,kt.jsx)("div",{className:"text-sm ".concat(C?"text-gray-300":"text-gray-600"),children:"Complete"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(C?"text-white":"text-gray-900"," border-b ").concat(C?"border-slate-600":"border-gray-200"," pb-2"),children:"Customer Contact Info"}),(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(C?"bg-slate-700/50":"bg-gray-50"),children:[(0,kt.jsx)("h4",{className:"text-sm font-medium ".concat(C?"text-gray-300":"text-gray-600"," mb-3"),children:"Primary Customer"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("div",{className:"font-semibold ".concat(C?"text-white":"text-gray-900"),children:(null===(n=T.customer)||void 0===n?void 0:n.primaryName)||"Not Set"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udcde"}),(0,kt.jsx)("a",{href:"tel:".concat(((null===(a=T.customer)||void 0===a?void 0:a.primaryPhone)||"").replace(/[^\d+]/g,"")),className:"text-sm ".concat(C?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:(null===(s=T.customer)||void 0===s?void 0:s.primaryPhone)||"Not Set"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\u2709\ufe0f"}),(0,kt.jsx)("a",{href:"mailto:".concat((null===(i=T.customer)||void 0===i?void 0:i.primaryEmail)||""),className:"text-sm ".concat(C?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:(null===(l=T.customer)||void 0===l?void 0:l.primaryEmail)||"Not Set"})]})]})]}),((null===(c=T.customer)||void 0===c?void 0:c.secondaryName)||(null===(d=T.customer)||void 0===d?void 0:d.secondaryPhone)||(null===(u=T.customer)||void 0===u?void 0:u.secondaryEmail))&&(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(C?"bg-slate-700/50":"bg-gray-50"),children:[(0,kt.jsx)("h4",{className:"text-sm font-medium ".concat(C?"text-gray-300":"text-gray-600"," mb-3"),children:"Secondary Customer"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(null===(h=T.customer)||void 0===h?void 0:h.secondaryName)&&(0,kt.jsx)("div",{className:"font-semibold ".concat(C?"text-white":"text-gray-900"),children:T.customer.secondaryName}),(null===(m=T.customer)||void 0===m?void 0:m.secondaryPhone)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udcde"}),(0,kt.jsx)("a",{href:"tel:".concat(T.customer.secondaryPhone.replace(/[^\d+]/g,"")),className:"text-sm ".concat(C?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:T.customer.secondaryPhone})]}),(null===(p=T.customer)||void 0===p?void 0:p.secondaryEmail)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\u2709\ufe0f"}),(0,kt.jsx)("a",{href:"mailto:".concat(T.customer.secondaryEmail),className:"text-sm ".concat(C?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:T.customer.secondaryEmail})]})]})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(C?"text-white":"text-gray-900"," border-b ").concat(C?"border-slate-600":"border-gray-200"," pb-2"),children:"Project Info"}),(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(C?"bg-slate-700/50":"bg-gray-50"," space-y-3"),children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(C?"text-gray-300":"text-gray-600"," mb-1"),children:"Project Number"}),(0,kt.jsxs)("button",{onClick:()=>N(T,"Project Profile",null,"Project Profile"),className:"text-lg font-bold ".concat(C?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:["#",T.projectNumber||"Not Set"]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(C?"text-gray-300":"text-gray-600"," mb-1"),children:"Lead Source"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-md ".concat(C?"bg-slate-700/40":"bg-white"," border ").concat(C?"border-slate-600":"border-gray-100"),children:[(0,kt.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-md bg-[#F8FAFC] text-blue-700 font-semibold",children:"\ud83d\udd0e"}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("div",{className:"".concat(C?"text-white font-semibold":"text-gray-900 font-semibold"),children:(()=>{const e=T.leadSourceId||T.leadSource||T.lead_source;if(ve)return"";const t=e?me[e]:null;return t?t.name||t.label||t.title:fe?"Loading\u2026":"Not Set"})()}),(0,kt.jsx)("div",{className:"text-xs ".concat(C?"text-gray-300":"text-gray-500"),children:(()=>{const e=T.leadSourceId||T.leadSource||T.lead_source,t=e?me[e]:null;return t&&t.description?t.description:""})()})]})]}),(0,kt.jsx)("div",{className:"mt-2 flex items-center gap-2",children:ve?(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("select",{value:be||"",onChange:e=>ye(e.target.value||null),className:"px-3 py-1 text-sm rounded-md border",children:[(0,kt.jsx)("option",{value:"",children:"-- Select Lead Source --"}),Object.values(me).map(e=>(0,kt.jsx)("option",{value:e.id,children:e.name||e.label||e.title},e.id))]}),(0,kt.jsx)("button",{onClick:async()=>{if(T&&T.id){je(!0);try{const e={leadSourceId:be||null},t=await Da.projectsService.update(T.id,e),r=(null===t||void 0===t?void 0:t.data)||t;L(r?e=>(0,Y.A)((0,Y.A)({},e),r):e=>(0,Y.A)((0,Y.A)({},e),{},{leadSourceId:be})),qr.success("Lead Source updated"),xe(!1)}catch(XI){console.error("Error updating lead source:",XI),qr.error("Failed to update Lead Source")}finally{je(!1)}}},disabled:we,className:"px-3 py-1 text-xs rounded-md bg-brand-500 text-white hover:bg-brand-600 disabled:opacity-60",children:we?"Saving\u2026":"Save"}),(0,kt.jsx)("button",{onClick:()=>xe(!1),className:"px-3 py-1 text-xs rounded-md border border-gray-200 hover:bg-gray-50",children:"Cancel"})]}):(0,kt.jsx)("button",{onClick:()=>{const e=T.leadSourceId||T.leadSource||T.lead_source||null;ye(e),xe(!0)},className:"px-3 py-1 text-xs rounded-md border border-gray-200 hover:bg-gray-50",children:"Edit"})})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(C?"text-gray-300":"text-gray-600"," mb-1"),children:"Primary Customer"}),(0,kt.jsx)("div",{className:"".concat(C?"text-white":"text-gray-900"," font-semibold"),children:(null===(f=T.customer)||void 0===f?void 0:f.primaryName)||(null===(g=T.customer)||void 0===g?void 0:g.name)||"Not Set"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(C?"text-gray-300":"text-gray-600"," mb-1"),children:"Project Manager"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsx)("div",{className:"font-semibold ".concat(C?"text-white":"text-gray-900"),children:null!==(v=T.projectManager)&&void 0!==v&&v.firstName&&null!==(x=T.projectManager)&&void 0!==x&&x.lastName?"".concat(T.projectManager.firstName," ").concat(T.projectManager.lastName):(null===(b=T.projectManager)||void 0===b?void 0:b.name)||"Not Assigned"}),(null===(y=T.projectManager)||void 0===y?void 0:y.phone)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udcde"}),(0,kt.jsx)("a",{href:"tel:".concat(T.projectManager.phone.replace(/[^\d+]/g,"")),className:"text-sm ".concat(C?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:T.projectManager.phone})]}),(null===(w=T.projectManager)||void 0===w?void 0:w.email)&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-blue-500",children:"\u2709\ufe0f"}),(0,kt.jsx)("a",{href:"mailto:".concat(T.projectManager.email),className:"text-sm ".concat(C?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:T.projectManager.email})]})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(C?"text-gray-300":"text-gray-600"," mb-1"),children:"Project Type"}),(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ".concat(C?Xa(T.projectType):Ya(T.projectType)),children:Ja(T.projectType)})]}),(0,kt.jsxs)("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-2 text-sm",children:[(0,kt.jsx)("span",{className:"".concat(C?"text-gray-300":"text-gray-600"," font-medium"),children:"Phase:"}),(0,kt.jsx)("span",{className:"".concat(C?"text-white":"text-gray-900"),children:Wn.getPhaseName(ke(T.id))||"Lead"}),(0,kt.jsx)("span",{className:"".concat(C?"text-gray-500":"text-gray-300"),children:"|"}),(0,kt.jsx)("span",{className:"".concat(C?"text-gray-300":"text-gray-600"," font-medium"),children:"Section:"}),(0,kt.jsx)("span",{className:"".concat(C?"text-white":"text-gray-900"),children:(()=>{const e=null===T||void 0===T?void 0:T.currentWorkflowItem;return null!==e&&void 0!==e&&e.sectionDisplayName?e.sectionDisplayName:null!==e&&void 0!==e&&e.sectionName?e.sectionName:null!==e&&void 0!==e&&e.section?e.section:"Not Available"})()}),(0,kt.jsx)("span",{className:"".concat(C?"text-gray-500":"text-gray-300"),children:"|"}),(0,kt.jsx)("span",{className:"".concat(C?"text-gray-300":"text-gray-600"," font-medium"),children:"Line Item:"}),(0,kt.jsx)("button",{onClick:async()=>{const e=null===T||void 0===T?void 0:T.currentWorkflowItem,t=ds.getCurrentLineItem(T),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||ds.getCurrentSection(T),n=ke(T.id);if(t&&T){console.log("\ud83c\udfaf PROJECT PROFILE: Navigating to line item:",t.name),console.log("\ud83c\udfaf PROJECT PROFILE: Section:",r),console.log("\ud83c\udfaf PROJECT PROFILE: Phase:",n);try{const a=await fetch("/api/workflow-data/project-position/".concat(T.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(a.ok){const s=await a.json();if(s.success&&s.data){const a=s.data,o=t.id||a.currentLineItemId||"".concat(n,"-").concat(r,"-0"),i=a.currentSectionId||(null===e||void 0===e?void 0:e.sectionId)||("string"===typeof r?r.toLowerCase().replace(/\s+/g,"-"):r)||"";console.log("\ud83c\udfaf PROJECT PROFILE: Target IDs:",{targetLineItemId:o,targetSectionId:i});const l=(0,Y.A)((0,Y.A)({},T),{},{navigationSource:T.navigationSource||"Project Profile",returnToSection:T.returnToSection||"project-profile",highlightStep:t.name,highlightLineItem:t.name,targetPhase:n,targetSection:r,targetLineItem:t.name,scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:t.name,stepName:t.name,lineItemId:o,workflowId:a.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(o),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:i,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});N(l,"Project Workflow",null,"Project Profile",o,i)}}else{const e=t.id||"".concat(n,"-").concat(r,"-0"),a="string"===typeof r?r:r||"",s=(0,Y.A)((0,Y.A)({},T),{},{navigationSource:T.navigationSource||"Project Profile",returnToSection:T.returnToSection||"project-profile",highlightStep:t.name,highlightLineItem:t.name,targetPhase:n,targetSection:r,targetLineItem:t.name,scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:t.name,stepName:t.name,lineItemId:e,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(e),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:a,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});N(s,"Project Workflow",null,"Project Profile",e,a)}}catch(F){console.error("\ud83c\udfaf PROJECT PROFILE: Error navigating to workflow step:",F);const a=(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0"),s="string"===typeof r?r:r||"",o=(0,Y.A)((0,Y.A)({},T),{},{navigationSource:T.navigationSource||"Project Profile",returnToSection:T.returnToSection||"project-profile",highlightStep:(null===t||void 0===t?void 0:t.name)||"Line Item",highlightLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",targetPhase:n,targetSection:r,targetLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",stepName:(null===t||void 0===t?void 0:t.name)||"Line Item",lineItemId:a,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(a),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:s,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});N(o,"Project Workflow",null,"Project Profile",a,s)}}else N(T,"Project Workflow",null,"Project Profile")},className:"text-sm ".concat(C?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"," hover:underline"),children:(null===(j=ds.getCurrentLineItem(T))||void 0===j?void 0:j.name)||"View Workflow"}),(0,kt.jsx)("span",{className:"".concat(C?"text-gray-500":"text-gray-300"),children:"\u2022"}),(0,kt.jsx)("span",{className:"font-mono cursor-pointer hover:underline ".concat(C?"text-blue-300 hover:text-blue-200":"text-blue-600 hover:text-blue-800"),title:"Line Item ID: ".concat((()=>{const e=null===T||void 0===T?void 0:T.currentWorkflowItem,t=ds.getCurrentLineItem(T),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||ds.getCurrentSection(T),n=ke(T.id);return(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0")})()),onClick:async()=>{const e=null===T||void 0===T?void 0:T.currentWorkflowItem,t=ds.getCurrentLineItem(T),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||ds.getCurrentSection(T),n=ke(T.id);try{const e=await fetch("/api/workflow-data/project-position/".concat(T.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});let a=(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0"),s="string"===typeof r?r.toLowerCase().replace(/\s+/g,"-"):r||"",o=null;if(e.ok){const r=await e.json();if(r.success&&r.data){const e=r.data;a=(null===t||void 0===t?void 0:t.id)||e.currentLineItemId||a,s=e.currentSectionId||s,o=e.workflowId||null}}const i=(0,Y.A)((0,Y.A)({},T),{},{navigationSource:T.navigationSource||"Project Profile",returnToSection:T.returnToSection||"project-profile",highlightStep:(null===t||void 0===t?void 0:t.name)||"Line Item",highlightLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",targetPhase:n,targetSection:r,targetLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",stepName:(null===t||void 0===t?void 0:t.name)||"Line Item",lineItemId:a,workflowId:o,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(a),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:s,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});N(i,"Project Workflow",null,"Project Profile",a,s)}catch(F){console.error("\ud83c\udfaf PROJECT PROFILE: Error navigating via Line Item ID:",F);const a=(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0"),s="string"===typeof r?r:r||"",o=(0,Y.A)((0,Y.A)({},T),{},{navigationSource:T.navigationSource||"Project Profile",returnToSection:T.returnToSection||"project-profile",highlightStep:(null===t||void 0===t?void 0:t.name)||"Line Item",highlightLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",targetPhase:n,targetSection:r,targetLineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:n,section:r,lineItem:(null===t||void 0===t?void 0:t.name)||"Line Item",stepName:(null===t||void 0===t?void 0:t.name)||"Line Item",lineItemId:a,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(a),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:s,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});N(o,"Project Workflow",null,"Project Profile",a,s)}},children:(()=>{const e=null===T||void 0===T?void 0:T.currentWorkflowItem,t=ds.getCurrentLineItem(T),r=(null===e||void 0===e?void 0:e.sectionId)||(null===e||void 0===e?void 0:e.section)||ds.getCurrentSection(T),n=ke(T.id);return(null===t||void 0===t?void 0:t.id)||"".concat(n,"-").concat(r,"-0")})()})]})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(C?"text-white":"text-gray-900"," border-b ").concat(C?"border-slate-600":"border-gray-200"," pb-2"),children:"Progress & Management"}),(0,kt.jsxs)("div",{className:"p-4 rounded-lg ".concat(C?"bg-slate-700/50":"bg-gray-50"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsx)("span",{className:"text-sm font-medium ".concat(C?"text-gray-300":"text-gray-600"),children:"Progress"}),(0,kt.jsxs)("span",{className:"text-lg font-bold ".concat(C?"text-white":"text-gray-900"),children:[Me(T),"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-3 rounded-full overflow-hidden shadow-inner ".concat(C?"bg-slate-600":"bg-gray-200"),children:(0,kt.jsx)("div",{className:"h-full rounded-full transition-all duration-500 ease-out ".concat((Me(T),"bg-[#F8FAFC]")),style:{width:"".concat(Me(T),"%")},children:Me(T)>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})})]})]})]})]})]}),(0,kt.jsxs)("div",{className:"px-6 pb-6",children:[(0,kt.jsx)("div",{className:"bg-white border border-gray-200/50 shadow-soft rounded-2xl p-4 mb-6",children:(0,kt.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[(0,kt.jsx)("input",{type:"text",placeholder:"Search projects...",value:G,onChange:e=>K(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsxs)("select",{value:J,onChange:e=>X(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"projectNumber",children:"Project Number"}),(0,kt.jsx)("option",{value:"name",children:"Project Name"}),(0,kt.jsx)("option",{value:"customer",children:"Customer"}),(0,kt.jsx)("option",{value:"phase",children:"Phase"}),(0,kt.jsx)("option",{value:"progress",children:"Progress"}),(0,kt.jsx)("option",{value:"startDate",children:"Start Date"})]}),(0,kt.jsxs)("button",{onClick:()=>Z("asc"===Q?"desc":"asc"),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-transparent flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm",children:"asc"===Q?"\u2191":"\u2193"}),(0,kt.jsx)("span",{className:"text-sm",children:"asc"===Q?"A-Z":"Z-A"})]})]}),(0,kt.jsxs)("div",{className:"text-sm text-gray-600",children:[Ie.length," current, ",Te.length," past projects"]})]})}),(0,kt.jsxs)("div",{className:"bg-white border border-gray-200/50 shadow-soft rounded-2xl p-6 mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Current Projects"}),De(Ie)>1&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>q(e=>Math.max(0,e-1)),disabled:0===W,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,kt.jsx)(nn,{className:"w-4 h-4"})}),(0,kt.jsxs)("span",{className:"text-sm text-gray-600",children:[W+1," of ",De(Ie)]}),(0,kt.jsx)("button",{onClick:()=>q(e=>Math.min(De(Ie)-1,e+1)),disabled:W>=De(Ie)-1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,kt.jsx)(fn,{className:"w-4 h-4"})})]})]}),0===Le(Ie,W).length?(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"text-gray-400 text-5xl mb-4",children:"\ud83d\udccb"}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Current Projects"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Start by creating your first project."})]}):(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:Le(Ie,W).map(e=>(0,kt.jsx)(qi,{project:e,isSelected:(null===T||void 0===T?void 0:T.id)===e.id,onSelect:()=>L(e),onProjectSelect:N,getPhaseForProject:ke,getPhaseColorForProject:Ae,getProjectProgress:Me,colorMode:C,isExpanded:B[e.id],onToggleExpansion:()=>Ve(e.id)},e.id))})]}),(0,kt.jsxs)("div",{className:"bg-white border border-gray-200/50 shadow-soft rounded-2xl p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Past Projects"}),De(Te)>1&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>H(e=>Math.max(0,e-1)),disabled:0===V,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,kt.jsx)(nn,{className:"w-4 h-4"})}),(0,kt.jsxs)("span",{className:"text-sm text-gray-600",children:[V+1," of ",De(Te)]}),(0,kt.jsx)("button",{onClick:()=>H(e=>Math.min(De(Te)-1,e+1)),disabled:V>=De(Te)-1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,kt.jsx)(fn,{className:"w-4 h-4"})})]})]}),0===Le(Te,V).length?(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"text-gray-400 text-5xl mb-4",children:"\u2705"}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Past Projects"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Completed projects will appear here."})]}):(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:Le(Te,V).map(e=>(0,kt.jsx)(qi,{project:e,isSelected:(null===T||void 0===T?void 0:T.id)===e.id,onSelect:()=>L(e),onProjectSelect:N,getPhaseForProject:ke,getPhaseColorForProject:Ae,getProjectProgress:Me,colorMode:C,isExpanded:B[e.id],onToggleExpansion:()=>Ve(e.id),isPast:!0},e.id))})]})]}),(0,kt.jsx)(li,{isOpen:D,onClose:()=>{M(!1),R(Wi),U("")},children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(C?"text-white":"text-gray-800"," mb-4"),children:"Add New Project"}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),U(""),O.projectNumber&&O.projectName&&O.customerName)try{const e=e=>{if(!e)return null;const t=e.replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):11===t.length&&"1"===t[0]?"+1 (".concat(t.slice(1,4),") ").concat(t.slice(4,7),"-").concat(t.slice(7)):e},r=O.contacts.find(e=>e.isPrimary)||O.contacts[0]||{},n=O.contacts.find(e=>!e.isPrimary&&e.name)||{},a={primaryName:O.customerName,primaryEmail:(null===r||void 0===r?void 0:r.email)||null,primaryPhone:e(null===r||void 0===r?void 0:r.phone)||null,secondaryName:(null===n||void 0===n?void 0:n.name)||null,secondaryEmail:(null===n||void 0===n?void 0:n.email)||null,secondaryPhone:e(null===n||void 0===n?void 0:n.phone)||null,primaryContact:"PRIMARY",address:"".concat(O.customerName," Project"),notes:"Project created from Add Project form",contacts:O.contacts.filter(e=>e.name&&e.name.trim()).map(t=>({name:t.name.trim(),phone:e(t.phone)||null,email:t.email||null,isPrimary:t.isPrimary||!1}))};let s=null;const o=_e.find(e=>e.primaryName===O.customerName||e.name===O.customerName);if(o)s=o.id;else{var t;const e=await Da.customersService.create(a);if(s=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.id)||(null===e||void 0===e?void 0:e.id),!s)throw new Error("Customer ID not received from server")}const i=e=>e||"ROOFING",l={projectName:O.projectName,projectType:i(O.jobType),customerId:s,status:"PENDING",budget:O.budget?parseFloat(O.budget):1e3,startDate:O.startDate?new Date(O.startDate).toISOString():(new Date).toISOString(),endDate:O.endDate?new Date(O.endDate).toISOString():new Date(Date.now()+7776e6).toISOString(),priority:(O.priority||"Medium").toUpperCase(),description:O.description||"Project #".concat(O.projectNumber),projectManagerId:O.projectManager||null,additionalTrades:(O.tradeTypes||[]).filter(e=>e!==i(O.jobType)),tradeTypes:O.tradeTypes||[]},c=await $.mutateAsync(l);M(!1),R(Wi),k&&k(c.data||c),oe(),console.log("Project created successfully:",c.data||c)}catch(XI){console.error("Error creating project:",XI),U(XI.message||"Failed to create project")}else U("Project Number, Project Name, and Customer Name are required")},className:"space-y-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Project Number *"}),(0,kt.jsx)("input",{type:"text",name:"projectNumber",value:O.projectNumber,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-2"),children:"Trade Types (Select multiple)"}),(0,kt.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{value:"ROOFING",label:"Roofing"},{value:"GUTTERS",label:"Gutters"},{value:"INTERIOR_PAINT",label:"Interior Paint"}].map(e=>(0,kt.jsxs)("label",{className:"flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all ".concat((O.tradeTypes||[]).includes(e.value)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[(0,kt.jsx)("input",{type:"checkbox",checked:(O.tradeTypes||[]).includes(e.value),onChange:()=>{return t=e.value,void R(e=>(0,Y.A)((0,Y.A)({},e),{},{tradeTypes:(e.tradeTypes||[]).includes(t)?(e.tradeTypes||[]).filter(e=>e!==t):[...e.tradeTypes||[],t]}));var t},className:"mr-3 h-4 w-4 text-blue-600"}),(0,kt.jsx)("span",{className:"font-medium",children:e.label})]},e.value))}),(O.tradeTypes||[]).length>0&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-blue-600",children:["Selected: ",(O.tradeTypes||[]).join(", ")]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Project Name *"}),(0,kt.jsx)("input",{type:"text",name:"projectName",value:O.projectName,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Customer Name *"}),(0,kt.jsx)("input",{type:"text",name:"customerName",value:O.customerName,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Job Type"}),(0,kt.jsxs)("select",{name:"jobType",value:O.jobType,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Job Type"}),(0,kt.jsx)("option",{value:"ROOFING",children:"Roofing"}),(0,kt.jsx)("option",{value:"GUTTERS",children:"Gutters"}),(0,kt.jsx)("option",{value:"INTERIOR_PAINT",children:"Interior Paint"}),(0,kt.jsx)("option",{value:"WATER_LEAK",children:"Water Leak"}),(0,kt.jsx)("option",{value:"MOLD",children:"Mold"}),(0,kt.jsx)("option",{value:"DECKS",children:"Decks"}),(0,kt.jsx)("option",{value:"REPAIR_EXTERIOR",children:"Repair - Exterior"}),(0,kt.jsx)("option",{value:"REPAIR_INTERIOR",children:"Repair - Interior"}),(0,kt.jsx)("option",{value:"WINDOWS",children:"Windows"}),(0,kt.jsx)("option",{value:"SIDING",children:"Siding"}),(0,kt.jsx)("option",{value:"FENCE",children:"Fence"}),(0,kt.jsx)("option",{value:"KITCHEN_REMODEL",children:"Kitchen Remodel"}),(0,kt.jsx)("option",{value:"BATHROOM_RENOVATION",children:"Bathroom Renovation"}),(0,kt.jsx)("option",{value:"FLOORING",children:"Flooring"}),(0,kt.jsx)("option",{value:"PAINTING",children:"Painting"}),(0,kt.jsx)("option",{value:"ELECTRICAL_WORK",children:"Electrical Work"}),(0,kt.jsx)("option",{value:"PLUMBING",children:"Plumbing"}),(0,kt.jsx)("option",{value:"HVAC",children:"HVAC"}),(0,kt.jsx)("option",{value:"LANDSCAPING",children:"Landscaping"}),(0,kt.jsx)("option",{value:"OTHER",children:"Other"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Project Address"}),(0,kt.jsx)(ci,{name:"address",value:O.address,onChange:Oe,placeholder:"Project address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Budget"}),(0,kt.jsx)("input",{type:"number",name:"budget",value:O.budget,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",min:"0",step:"0.01"})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Start Date"}),(0,kt.jsx)("input",{type:"date",name:"startDate",value:O.startDate,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"End Date"}),(0,kt.jsx)("input",{type:"date",name:"endDate",value:O.endDate,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Priority"}),(0,kt.jsxs)("select",{name:"priority",value:O.priority,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"Low",children:"Low"}),(0,kt.jsx)("option",{value:"Medium",children:"Medium"}),(0,kt.jsx)("option",{value:"High",children:"High"}),(0,kt.jsx)("option",{value:"Critical",children:"Critical"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Description"}),(0,kt.jsx)("textarea",{name:"description",value:O.description,onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",placeholder:"Project description..."})]}),!ue&&(0,kt.jsxs)("div",{className:"border-t pt-6 ".concat(C?"border-slate-600":"border-gray-200"),children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold mb-4 ".concat(C?"text-white":"text-gray-800"),children:"Project Roles"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Project Manager"}),(0,kt.jsxs)("select",{name:"projectManager",value:O.projectManager||"",onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Project Manager"}),ie.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Field Director"}),(0,kt.jsxs)("select",{name:"fieldDirector",value:O.fieldDirector||"",onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Field Director"}),ie.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Sales Representative"}),(0,kt.jsxs)("select",{name:"salesRep",value:O.salesRep||"",onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Sales Rep"}),ie.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Quality Inspector"}),(0,kt.jsxs)("select",{name:"qualityInspector",value:O.qualityInspector||"",onChange:Oe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Quality Inspector"}),ie.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]})]})]}),(0,kt.jsxs)("div",{className:"border-t pt-6 ".concat(C?"border-slate-600":"border-gray-200"),children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold mb-4 ".concat(C?"text-white":"text-gray-800"),children:"Customer Contacts"}),O.contacts.map((e,t)=>(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 border border-gray-200 rounded-lg",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Contact Name"}),(0,kt.jsx)("input",{type:"text",value:e.name,onChange:e=>Re(t,"name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Contact name"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Phone"}),(0,kt.jsx)("input",{type:"tel",value:e.phone,onChange:e=>Re(t,"phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"(555) 123-4567"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium ".concat(C?"text-gray-300":"text-gray-700"," mb-1"),children:"Email"}),(0,kt.jsx)("input",{type:"email",value:e.email,onChange:e=>Re(t,"email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@email.com"})]}),(0,kt.jsx)("div",{className:"flex items-end",children:(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",checked:e.isPrimary,onChange:e=>Re(t,"isPrimary",e.target.checked),className:"mr-2"}),(0,kt.jsx)("span",{className:"text-sm ".concat(C?"text-gray-300":"text-gray-700"),children:"Primary Contact"})]})})]},t))]}),F&&(0,kt.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,kt.jsx)("p",{className:"text-sm text-red-600",children:F})}),(0,kt.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{M(!1),R(Wi),U("")},className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-200",children:"Cancel"}),(0,kt.jsxs)("button",{type:"submit",disabled:$.isLoading,className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-all duration-200 flex items-center gap-2",children:[$.isLoading&&(0,kt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),$.isLoading?"Creating...":"Create Project"]})]})]})]})})]})},Hi=e=>{if(!e)return"(555) 555-5555";const t=e.replace(/\D/g,"");return e.match(/^\(\d{3}\) \d{3}-\d{4}$/)?e:10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):11===t.length&&t.startsWith("1")?"(".concat(t.slice(1,4),") ").concat(t.slice(4,7),"-").concat(t.slice(7)):"(555) 555-5555"};var Gi=r(9722);const Ki=(()=>{if("undefined"!==typeof window){const e=window.location.host;if(console.log("\ud83d\udd0d DOCUMENT SERVICE API CONFIG: Current host:",e),!e.includes("localhost")&&!e.includes("127.0.0.1")){const t="".concat(window.location.protocol,"//").concat(e,"/api");return console.log("\ud83d\udd0d DOCUMENT SERVICE API CONFIG: Using production API:",t),t}}return{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL?(console.log("\ud83d\udd0d DOCUMENT SERVICE API CONFIG: Using env var API:",{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL),{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL):(console.log("\ud83d\udd0d DOCUMENT SERVICE API CONFIG: Using localhost fallback"),"http://localhost:5000/api")})(),Ji=Gi.A.create({baseURL:Ki,headers:{"Content-Type":"application/json"}});Ji.interceptors.request.use(e=>{const t=localStorage.getItem("authToken")||localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),Ji.interceptors.response.use(e=>e,e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)});const Yi={getDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await Ji.get("/documents-enhanced",{params:e})).data},getDocument:async e=>(await Ji.get("/documents-enhanced/".concat(e))).data,uploadDocument:async e=>(await Ji.post("/documents-enhanced",e,{headers:{"Content-Type":"multipart/form-data"}})).data,updateDocument:async(e,t)=>(await Ji.put("/documents-enhanced/".concat(e),t)).data,deleteDocument:async e=>(await Ji.delete("/documents-enhanced/".concat(e))).data,downloadDocument:async e=>(await Ji.post("/documents-enhanced/".concat(e,"/download"))).data,download:async e=>await Ji.get("/documents-enhanced/".concat(e,"/download"),{responseType:"blob"}),toggleFavorite:async e=>(await Ji.post("/documents-enhanced/".concat(e,"/favorite"))).data,getCategories:async()=>(await Ji.get("/documents-enhanced/categories")).data,getDocumentVersions:async e=>(await Ji.get("/documents-enhanced/".concat(e,"/versions"))).data,addComment:async(e,t)=>(await Ji.post("/documents-enhanced/".concat(e,"/comments"),t)).data,getComments:async e=>(await Ji.get("/documents-enhanced/".concat(e,"/comments"))).data,updateComment:async(e,t,r)=>(await Ji.put("/documents-enhanced/".concat(e,"/comments/").concat(t),r)).data,deleteComment:async(e,t)=>(await Ji.delete("/documents-enhanced/".concat(e,"/comments/").concat(t))).data,getDocumentAccess:async e=>(await Ji.get("/documents-enhanced/".concat(e,"/access"))).data,updateDocumentAccess:async(e,t)=>(await Ji.put("/documents-enhanced/".concat(e,"/access"),t)).data,searchDocuments:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await Ji.get("/documents-enhanced/search",{params:(0,Y.A)({q:e},t)})).data},getFavoriteDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await Ji.get("/documents-enhanced/favorites",{params:e})).data},getRecentDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return(await Ji.get("/documents-enhanced/recent",{params:{limit:e}})).data},getDocumentStats:async()=>(await Ji.get("/documents-enhanced/stats")).data,bulkDownload:async e=>(await Ji.post("/documents-enhanced/bulk-download",{documentIds:e})).data,bulkDelete:async e=>(await Ji.post("/documents-enhanced/bulk-delete",{documentIds:e})).data,bulkUpdate:async(e,t)=>(await Ji.post("/documents-enhanced/bulk-update",{documentIds:e,updateData:t})).data,getTemplates:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(await Ji.get("/documents-enhanced/templates",{params:e?{category:e}:{}})).data},createFromTemplate:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await Ji.post("/documents-enhanced/templates/".concat(e,"/create"),t)).data},shareDocument:async(e,t)=>(await Ji.post("/documents-enhanced/".concat(e,"/share"),t)).data,getSharedDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await Ji.get("/documents-enhanced/shared",{params:e})).data},revokeShare:async(e,t)=>(await Ji.delete("/documents-enhanced/".concat(e,"/share/").concat(t))).data,getDocumentAnalytics:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"30d";return(await Ji.get("/documents-enhanced/".concat(e,"/analytics"),{params:{period:t}})).data},getPopularDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await Ji.get("/documents-enhanced/popular",{params:e})).data},createNewVersion:async(e,t)=>(await Ji.post("/documents-enhanced/".concat(e,"/versions"),t,{headers:{"Content-Type":"multipart/form-data"}})).data,restoreVersion:async(e,t)=>(await Ji.post("/documents-enhanced/".concat(e,"/versions/").concat(t,"/restore"))).data,archiveDocument:async e=>(await Ji.post("/documents-enhanced/".concat(e,"/archive"))).data,restoreDocument:async e=>(await Ji.post("/documents-enhanced/".concat(e,"/restore"))).data,getArchivedDocuments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await Ji.get("/documents-enhanced/archived",{params:e})).data}},Xi=e=>{let{isOpen:t,onClose:r,address:n}=e;const a=(0,o.useRef)(null),s=(0,o.useRef)(null);return(0,o.useEffect)(()=>{if(!t||!n||!a.current)return;const e=()=>{if(!window.google||!window.google.maps)return void console.error("Google Maps not loaded");(new window.google.maps.Geocoder).geocode({address:n},(e,t)=>{if("OK"===t&&e[0]){const t=e[0].geometry.location;s.current=new window.google.maps.Map(a.current,{center:t,zoom:17,mapTypeId:"satellite",mapTypeControl:!0,mapTypeControlOptions:{style:window.google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:window.google.maps.ControlPosition.TOP_CENTER,mapTypeIds:["roadmap","satellite","hybrid"]},streetViewControl:!0,fullscreenControl:!0,zoomControl:!0}),new window.google.maps.Marker({map:s.current,position:t,title:n,animation:window.google.maps.Animation.DROP});const r=new window.google.maps.InfoWindow({content:'<div style="padding: 8px;"><strong>Project Location</strong><br/>'.concat(n,"</div>")}),o=new window.google.maps.Marker({map:s.current,position:t});o.addListener("click",()=>{r.open(s.current,o)})}else console.error("Geocoding failed:",t)})};return(async()=>{try{const t="AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0";if(window.google&&window.google.maps)return void e();const r=document.createElement("script");r.src="https://maps.googleapis.com/maps/api/js?key=".concat(t,"&libraries=places"),r.async=!0,r.defer=!0,r.onload=e,document.head.appendChild(r)}catch(t){console.error("Error loading Google Maps:",t)}})(),()=>{s.current&&(s.current=null)}},[t,n]),t?(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[99999] p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-fade-in",children:[(0,kt.jsx)("div",{className:"bg-[#F8FAFC] text-white px-6 py-4 flex-shrink-0 rounded-t-2xl",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold",children:"Project Location"}),(0,kt.jsx)("p",{className:"text-blue-100 mt-1 text-sm",children:n})]}),(0,kt.jsx)("button",{onClick:r,className:"p-2 rounded-lg hover:bg-white transition-colors",children:(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,kt.jsx)("div",{className:"flex-1 p-4",children:(0,kt.jsx)("div",{ref:a,className:"w-full h-full rounded-xl border-2 border-gray-200",style:{minHeight:"500px"}})}),(0,kt.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex-shrink-0 rounded-b-2xl",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("a",{href:"https://www.google.com/maps/search/?api=1&query=".concat(encodeURIComponent(n)),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm font-medium hover:underline",children:"Open in Google Maps \u2192"}),(0,kt.jsx)("button",{onClick:r,className:"px-5 py-2.5 text-gray-700 bg-white border-2 border-gray-300 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all duration-200",children:"Close"})]})})]})}):null},Qi=["title","titleId"];function Zi(e,t){let{title:r,titleId:n}=e,a=An(e,Qi);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const $i=o.forwardRef(Zi),el=e=>{var t,n,a;let{project:s,colorMode:i,onProjectSelect:l,onBack:c}=e;const[d,u]=(0,o.useState)(!1),[h]=(0,o.useState)("overview"),[m,p]=((0,o.useRef)({}),(0,o.useState)({})),[f,g]=(0,o.useState)(!1),[v,x]=(0,o.useState)(null),[b,y]=(0,o.useState)(!1),[w,j]=(0,o.useState)(!1),[N,S]=(0,o.useState)(!1),[k,A]=(0,o.useState)({address:"",addressComponents:{},customerName:"",customerPhone:"",customerEmail:"",secondaryName:"",secondaryPhone:"",secondaryEmail:"",pmName:"",pmPhone:"",pmEmail:"",pmId:"",doublePull:!1,petNames:""}),[C,E]=(0,o.useState)(!1),[P,_]=(0,o.useState)([]),[I,T]=(0,o.useState)(!1),[L,D]=(0,o.useState)([]),[M,O]=(0,o.useState)(!1),[R,F]=(0,o.useState)(!1),[U,B]=(0,o.useState)(null),[z,W]=(0,o.useState)({name:"",relation:"",customRelation:""}),[q,V]=(0,o.useState)({name:"",relation:"",customRelation:""}),[H,G]=(0,o.useState)([]),[K,J]=(0,o.useState)(!1),[X,Q]=(0,o.useState)(!1),[Z,$]=(0,o.useState)(null),[ee,te]=(0,o.useState)({name:"",type:"",customType:"",hasYardAccess:!1}),[re,ne]=(0,o.useState)({name:"",type:"",customType:"",hasYardAccess:!1}),ae=(0,o.useRef)(null),se=(0,o.useRef)(null),oe=(0,o.useRef)(null),ie=(0,o.useRef)(null);(0,o.useEffect)(()=>{R&&ae.current&&ae.current.focus()},[R]),(0,o.useEffect)(()=>{U&&se.current&&setTimeout(()=>{se.current&&se.current.focus()},10)},[U]),(0,o.useEffect)(()=>{X&&oe.current&&oe.current.focus()},[X]),(0,o.useEffect)(()=>{Z&&ie.current&&setTimeout(()=>{ie.current&&ie.current.focus()},10)},[Z]);const le=["Spouse","Grandma","Grandpa","Child","Significant Other"],ce=(0,o.useCallback)(async()=>{var e;if(null!==s&&void 0!==s&&null!==(e=s.customer)&&void 0!==e&&e.id){O(!0);try{const e=await Da.customersService.getFamilyMembers(s.customer.id);null!==e&&void 0!==e&&e.success&&Array.isArray(e.data)?D(e.data):D([])}catch(t){console.error("Error loading family members:",t),D([])}finally{O(!1)}}},[null===s||void 0===s||null===(t=s.customer)||void 0===t?void 0:t.id]),de=(0,o.useCallback)(async()=>{if(null!==s&&void 0!==s&&s.id){J(!0);try{const e=await Da.projectsService.getPets(s.id);null!==e&&void 0!==e&&e.success&&Array.isArray(e.data)?G(e.data):G([])}catch(e){console.error("Error loading pets:",e),G([])}finally{J(!1)}}},[null===s||void 0===s?void 0:s.id]);(0,o.useEffect)(()=>{(async()=>{T(!0);try{var e;const{usersService:t}=await Promise.resolve().then(r.bind(r,4505)),n=await t.getTeamMembers(),a=Array.isArray(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.teamMembers)?n.data.teamMembers:[];a.length>0?_(a):_([{id:1,firstName:"Mike",lastName:"Field",role:"Project Manager",email:"mike.field@company.com"},{id:2,firstName:"Sarah",lastName:"Johnson",role:"Office Manager",email:"sarah.johnson@company.com"},{id:3,firstName:"John",lastName:"Smith",role:"Field Director",email:"john.smith@company.com"},{id:4,firstName:"Emily",lastName:"Davis",role:"Administration",email:"emily.davis@company.com"},{id:5,firstName:"Robert",lastName:"Wilson",role:"Roof Supervisor",email:"robert.wilson@company.com"},{id:6,firstName:"Lisa",lastName:"Anderson",role:"Customer Service",email:"lisa.anderson@company.com"},{id:7,firstName:"David",lastName:"Martinez",role:"Estimator",email:"david.martinez@company.com"},{id:8,firstName:"Jennifer",lastName:"Brown",role:"Accounting",email:"jennifer.brown@company.com"}])}catch(t){console.error("Error loading users:",t),_([{id:1,firstName:"Mike",lastName:"Field",role:"Project Manager",email:"mike.field@company.com"},{id:2,firstName:"Sarah",lastName:"Johnson",role:"Office Manager",email:"sarah.johnson@company.com"},{id:3,firstName:"John",lastName:"Smith",role:"Field Director",email:"john.smith@company.com"},{id:4,firstName:"Emily",lastName:"Davis",role:"Administration",email:"emily.davis@company.com"},{id:5,firstName:"Robert",lastName:"Wilson",role:"Roof Supervisor",email:"robert.wilson@company.com"},{id:6,firstName:"Lisa",lastName:"Anderson",role:"Customer Service",email:"lisa.anderson@company.com"},{id:7,firstName:"David",lastName:"Martinez",role:"Estimator",email:"david.martinez@company.com"},{id:8,firstName:"Jennifer",lastName:"Brown",role:"Accounting",email:"jennifer.brown@company.com"}])}finally{T(!1)}})(),R||U||ce(),X||Z||de()},[null===s||void 0===s?void 0:s.id,null===s||void 0===s||null===(n=s.customer)||void 0===n?void 0:n.id,R,U,X,Z,ce,de]);const ue=["Dog","Cat"];(0,o.useEffect)(()=>{var e,t,r,n,a,o,i,l,c,d,u,h,m,p;s&&A({address:(null===(e=s.customer)||void 0===e?void 0:e.address)||"",customerName:(null===(t=s.customer)||void 0===t?void 0:t.primaryName)||(null===(r=s.customer)||void 0===r?void 0:r.name)||"",customerPhone:(null===(n=s.customer)||void 0===n?void 0:n.primaryPhone)||"",customerEmail:(null===(a=s.customer)||void 0===a?void 0:a.primaryEmail)||"",secondaryName:(null===(o=s.customer)||void 0===o?void 0:o.secondaryName)||"",secondaryPhone:(null===(i=s.customer)||void 0===i?void 0:i.secondaryPhone)||"",secondaryEmail:(null===(l=s.customer)||void 0===l?void 0:l.secondaryEmail)||"",pmName:null!==(c=s.projectManager)&&void 0!==c&&c.firstName&&null!==(d=s.projectManager)&&void 0!==d&&d.lastName?"".concat(s.projectManager.firstName," ").concat(s.projectManager.lastName).trim():(null===(u=s.projectManager)||void 0===u?void 0:u.name)||"",pmPhone:(null===(h=s.projectManager)||void 0===h?void 0:h.phone)||s.pmPhone||"",pmEmail:(null===(m=s.projectManager)||void 0===m?void 0:m.email)||s.pmEmail||"",pmId:(null===(p=s.projectManager)||void 0===p?void 0:p.id)||s.projectManagerId||"",doublePull:s.doublePull||!1})},[s]);const he=()=>{A(e=>{var t;return(0,Y.A)((0,Y.A)({},e),{},{address:s.address||(null===(t=s.customer)||void 0===t?void 0:t.address)||"",addressComponents:{}})}),j(!0)},me=e=>{console.log("\ud83d\udd0d ADDRESS DEBUG: Place selected in ProjectProfileTab:",e),console.log("\ud83d\udd0d ADDRESS DEBUG: Address components:",e.addressComponents),A(t=>(0,Y.A)((0,Y.A)({},t),{},{address:e.formattedAddress,addressComponents:e.addressComponents||{}}))},pe=()=>{S(!0)},fe=()=>{var e,t,r,n,a,o,i,l,c,d,u,h,m,p;(j(!1),S(!1),s)&&A({address:(null===(e=s.customer)||void 0===e?void 0:e.address)||"",customerName:(null===(t=s.customer)||void 0===t?void 0:t.primaryName)||(null===(r=s.customer)||void 0===r?void 0:r.name)||"",customerPhone:(null===(n=s.customer)||void 0===n?void 0:n.primaryPhone)||"",customerEmail:(null===(a=s.customer)||void 0===a?void 0:a.primaryEmail)||"",secondaryName:(null===(o=s.customer)||void 0===o?void 0:o.secondaryName)||"",secondaryPhone:(null===(i=s.customer)||void 0===i?void 0:i.secondaryPhone)||"",secondaryEmail:(null===(l=s.customer)||void 0===l?void 0:l.secondaryEmail)||"",pmName:null!==(c=s.projectManager)&&void 0!==c&&c.firstName&&null!==(d=s.projectManager)&&void 0!==d&&d.lastName?"".concat(s.projectManager.firstName," ").concat(s.projectManager.lastName).trim():(null===(u=s.projectManager)||void 0===u?void 0:u.name)||"",pmPhone:(null===(h=s.projectManager)||void 0===h?void 0:h.phone)||s.pmPhone||"",pmEmail:(null===(m=s.projectManager)||void 0===m?void 0:m.email)||s.pmEmail||"",pmId:(null===(p=s.projectManager)||void 0===p?void 0:p.id)||s.projectManagerId||"",doublePull:s.doublePull||!1,petNames:s.petNames||""})},ge=async()=>{E(!0);try{var e;if(null!==(e=s.customer)&&void 0!==e&&e.id){const e={primaryName:k.customerName,primaryPhone:k.customerPhone,primaryEmail:k.customerEmail,secondaryName:k.secondaryName,secondaryPhone:k.secondaryPhone,secondaryEmail:k.secondaryEmail,address:k.address};Object.keys(e).forEach(t=>{""!==e[t]&&null!==e[t]||delete e[t]});const t=await Da.customersService.update(s.customer.id,e);if(null===t||void 0===t||!t.success)throw new Error((null===t||void 0===t?void 0:t.message)||"Customer update failed")}const t={projectManagerId:k.pmId||null,pmPhone:k.pmPhone||null,pmEmail:k.pmEmail||null,doublePull:k.doublePull||!1,petNames:k.petNames||null};Object.keys(t).forEach(e=>{""!==t[e]&&null!==t[e]||delete t[e]});const r=await Da.projectsService.update(s.id,t);if(null===r||void 0===r||!r.success)throw new Error((null===r||void 0===r?void 0:r.message)||"Project update failed");j(!1),S(!1),qr.success("Project information updated successfully!"),s.onUpdate&&s.onUpdate()}catch(n){var t,r;console.error("Error updating project:",n);const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||(null===n||void 0===n?void 0:n.message)||"Failed to update project information. Please try again.";qr.error(e)}finally{E(!1)}};if(!s)return(0,kt.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"text-6xl mb-4",children:"\xf0\u0178\u201c\u2039"}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Project Selected"}),(0,kt.jsx)("p",{className:"text-gray-500",children:"Please select a project to view its profile information."})]})});const ve=()=>{var e,t,r;return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-3 mb-4",children:[(0,kt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,kt.jsx)("span",{className:"text-sm font-bold text-blue-700",children:String(s.projectNumber||s.id||"")}),(0,kt.jsx)("h1",{className:"text-base font-semibold text-gray-900 truncate",children:(null===(e=s.customer)||void 0===e?void 0:e.primaryName)||(null===(t=s.customer)||void 0===t?void 0:t.name)||"Customer Name"})]}),s.projectType&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold border ".concat(Ya(s.projectType)),children:Ja(s.projectType)})]}),(0,kt.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-xs text-gray-700 truncate",children:[(0,kt.jsx)(Sn,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),w?(0,kt.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,kt.jsx)(ci,{name:"address",value:k.address,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{address:e.target.value})),onPlaceSelect:me,className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Project address",autoFocus:!0}),k.addressComponents&&"object"===typeof k.addressComponents&&Object.keys(k.addressComponents).length>0&&(0,kt.jsxs)("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs",children:[(0,kt.jsxs)("div",{className:"text-blue-800 font-semibold mb-1 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),"Address Details"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[k.addressComponents.street_number&&k.addressComponents.route&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Street: "}),(0,kt.jsxs)("span",{className:"text-gray-800",children:[k.addressComponents.street_number," ",k.addressComponents.route]})]}),k.addressComponents.locality&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"City: "}),(0,kt.jsx)("span",{className:"text-gray-800",children:k.addressComponents.locality})]}),k.addressComponents.administrative_area_level_1&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"State: "}),(0,kt.jsx)("span",{className:"text-gray-800",children:k.addressComponents.administrative_area_level_1})]}),k.addressComponents.postal_code&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"ZIP: "}),(0,kt.jsx)("span",{className:"font-semibold text-blue-700",children:k.addressComponents.postal_code}),(0,kt.jsx)("span",{className:"font-semibold text-blue-700",children:k.addressComponents.postal_code})]})]})]}),(0,kt.jsx)("button",{onClick:async()=>{try{var e;null!==(e=s.customer)&&void 0!==e&&e.id?await Da.customersService.update(s.customer.id,{address:k.address}):await Da.projectsService.update(s.id,{address:k.address}),j(!1),qr.success("Address updated successfully!")}catch(t){console.error("Error updating address:",t),qr.error("Failed to update address")}},className:"px-2 py-1 text-[11px] bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700",children:"Save"}),(0,kt.jsx)("button",{onClick:()=>{j(!1),A(e=>{var t;return(0,Y.A)((0,Y.A)({},e),{},{address:(null===(t=s.customer)||void 0===t?void 0:t.address)||s.address||""})})},className:"px-2 py-1 text-[11px] bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancel"})]}):(0,kt.jsxs)("div",{className:"flex items-center gap-2 min-w-0 w-full",children:[(0,kt.jsx)("button",{onClick:()=>{var e;(s.address||(null===(e=s.customer)||void 0===e?void 0:e.address)||"").trim()&&u(!0)},className:"truncate text-blue-600 hover:text-blue-800 hover:underline cursor-pointer text-left",title:"Click to view map",children:(s.address||(null===(r=s.customer)||void 0===r?void 0:r.address)||"Address not provided").trim()}),(0,kt.jsx)("button",{onClick:he,className:"px-2 py-0.5 text-[11px] font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded",children:"Edit"})]})]})]})},xe=()=>{var e;return(0,kt.jsx)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 mb-6 shadow-soft",children:(0,kt.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Phase"}),(0,kt.jsxs)("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded-lg text-sm font-semibold text-blue-800",children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full bg-[var(--color-primary-blueprint-blue)]"}),Wn.getPhaseName((null===(e=s.currentWorkflowItem)||void 0===e?void 0:e.phase)||Wn.getProjectPhase(s))]})]}),(0,kt.jsx)("div",{className:"hidden sm:block w-px h-6 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Section"}),(0,kt.jsxs)("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-sm font-semibold text-gray-800",children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-600"}),(()=>{const e=s.currentWorkflowItem;return null!==e&&void 0!==e&&e.sectionDisplayName?e.sectionDisplayName:null!==e&&void 0!==e&&e.sectionName?e.sectionName:null!==e&&void 0!==e&&e.section?e.section:"Not Available"})()]})]}),(0,kt.jsx)("div",{className:"hidden sm:block w-px h-6 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Line Item"}),(0,kt.jsxs)("button",{onClick:async()=>{if(!l)return console.error("\xf0\u0178\u017d\xaf LINE ITEM CLICKED! onProjectSelect is not available"),void qr.error("Navigation failed: onProjectSelect not available");try{console.log("\xf0\u0178\u017d\xaf PROJECT PROFILE TAB: Line item clicked for project:",s.id);const t=null===s||void 0===s?void 0:s.currentWorkflowItem,r=ds.getCurrentLineItem(s),n=(null===t||void 0===t?void 0:t.sectionId)||(null===t||void 0===t?void 0:t.section)||ds.getCurrentSection(s),a=(null===t||void 0===t?void 0:t.phase)||Wn.getProjectPhase(s)||"LEAD";let o=(null===r||void 0===r?void 0:r.id)||"".concat(a,"-").concat(n,"-0"),i="string"===typeof n?n.toLowerCase().replace(/\s+/g,"-"):n||"";try{const e=await fetch("/api/workflow-data/project-position/".concat(s.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(e.ok){const t=await e.json();if(t.success&&t.data){const e=t.data;e.currentLineItemId&&(o=e.currentLineItemId),e.currentSectionId&&(i=e.currentSectionId)}}}catch(e){console.warn("\xf0\u0178\u017d\xaf PROJECT PROFILE TAB: Could not fetch position data, using fallback:",e)}const c=(0,Y.A)((0,Y.A)({},s),{},{navigationSource:"Project Profile Tab",returnToSection:"project-profile",highlightStep:(null===r||void 0===r?void 0:r.name)||"Line Item",highlightLineItem:(null===r||void 0===r?void 0:r.name)||"Line Item",targetPhase:a,targetSection:n,targetLineItem:(null===r||void 0===r?void 0:r.name)||"Line Item",scrollToCurrentLineItem:!0,navigationTarget:{phase:a,section:n,lineItem:(null===r||void 0===r?void 0:r.name)||"Line Item",stepName:(null===r||void 0===r?void 0:r.name)||"Line Item",lineItemId:o,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(o),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:i,expandPhase:!0,expandSection:!0,autoOpen:!0,scrollAndHighlight:!0,nonce:Date.now()}});l(c,"Project Workflow",null,"Project Profile",o,i)}catch(t){console.error("\xf0\u0178\u017d\xaf PROJECT PROFILE TAB: Error navigating to workflow:",t);const e=(0,Y.A)((0,Y.A)({},s),{},{navigationSource:"Project Profile Tab (Fallback)",returnToSection:"project-profile"});l(e,"Project Workflow",null,"Project Profile")}},className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm",children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"}),(()=>{const e=s.currentWorkflowItem;return null!==e&&void 0!==e&&e.lineItemDisplayName?e.lineItemDisplayName:null!==e&&void 0!==e&&e.lineItemName?e.lineItemName:null!==e&&void 0!==e&&e.lineItem?e.lineItem:"View Workflow"})()]})]})]})})},be=()=>{var e,t,r,n,a,o,i,c,d;return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-soft",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(dn,{className:"w-4 h-4 text-blue-600"}),(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Customer Information"})]}),!N&&(0,kt.jsx)("button",{onClick:pe,className:"px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded",children:"Edit"})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs",children:[(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900",children:"Primary"}),(0,kt.jsx)("div",{className:"text-gray-800",children:(null===(e=s.customer)||void 0===e?void 0:e.primaryName)||(null===(t=s.customer)||void 0===t?void 0:t.name)||"Not Available"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(jn,{className:"w-3 h-3 text-green-600"}),(0,kt.jsx)("a",{href:"tel:".concat(((null===(r=s.customer)||void 0===r?void 0:r.primaryPhone)||"").replace(/[^\d+]/g,"")),className:"text-gray-700 hover:text-blue-600",children:null!==(n=s.customer)&&void 0!==n&&n.primaryPhone?Hi(s.customer.primaryPhone):"Not Available"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(Nn,{className:"w-3 h-3 text-blue-600"}),(0,kt.jsx)("a",{href:"mailto:".concat((null===(a=s.customer)||void 0===a?void 0:a.primaryEmail)||""),className:"text-gray-700 hover:text-blue-600",children:(null===(o=s.customer)||void 0===o?void 0:o.primaryEmail)||"Not Available"})]})]}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900",children:"Secondary"}),(0,kt.jsx)("div",{className:"text-gray-800",children:(null===(i=s.customer)||void 0===i?void 0:i.secondaryName)||"Not Provided"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(jn,{className:"w-3 h-3 text-green-600"}),null!==(c=s.customer)&&void 0!==c&&c.secondaryPhone?(0,kt.jsx)("a",{href:"tel:".concat(s.customer.secondaryPhone.replace(/[^\d+]/g,"")),className:"text-gray-700 hover:text-blue-600",children:Hi(s.customer.secondaryPhone)}):(0,kt.jsx)("span",{className:"text-gray-500",children:"Not Provided"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(Nn,{className:"w-3 h-3 text-blue-600"}),null!==(d=s.customer)&&void 0!==d&&d.secondaryEmail?(0,kt.jsx)("a",{href:"mailto:".concat(s.customer.secondaryEmail),className:"text-gray-700 hover:text-blue-600",children:s.customer.secondaryEmail}):(0,kt.jsx)("span",{className:"text-gray-500",children:"Not Provided"})]})]}),(0,kt.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("input",{type:"checkbox",id:"doublePull",checked:k.doublePull,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{doublePull:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer"}),(0,kt.jsx)("label",{htmlFor:"doublePull",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Double Pull House (requires two ladders)"})]})}),k.doublePull!==(s.doublePull||!1)&&(0,kt.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,kt.jsx)("button",{onClick:async()=>{try{const e={doublePull:k.doublePull};if(await Da.projectsService.update(s.id,e),qr.success("Project details updated successfully!"),l&&s){const t=(0,Y.A)((0,Y.A)({},s),e);l(t,"Project Profile",null,"Project Profile")}}catch(e){console.error("Error updating project details:",e),qr.error("Failed to update project details")}},className:"px-3 py-1.5 text-xs bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 font-medium",children:"Save Changes"}),(0,kt.jsx)("button",{onClick:()=>{A(e=>(0,Y.A)((0,Y.A)({},e),{},{doublePull:s.doublePull||!1}))},className:"px-3 py-1.5 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-medium",children:"Cancel"})]})]})]}),(0,kt.jsx)(Se,{})]})},ye=()=>{const e=()=>{B(null),V({name:"",relation:"",customRelation:""})};return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-soft mt-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)(bn,{className:"w-4 h-4 text-blue-600"}),(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Family Members"})]}),!R&&(0,kt.jsxs)("button",{onClick:()=>F(!0),className:"px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded flex items-center gap-1",children:[(0,kt.jsx)(gn,{className:"w-3 h-3"}),"Add"]})]}),R&&(0,kt.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-2",children:[(0,kt.jsx)("input",{ref:ae,type:"text",placeholder:"Name",value:z.name,onChange:e=>{const t=e.target.value;W(e=>(0,Y.A)((0,Y.A)({},e),{},{name:t}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),(0,kt.jsxs)("div",{className:"flex gap-1",children:[(0,kt.jsxs)("select",{value:z.relation,onChange:e=>{const t=e.target.value;t&&le.includes(t),W(e=>(0,Y.A)((0,Y.A)({},e),{},{relation:t}))},className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Relation"}),le.map(e=>(0,kt.jsx)("option",{value:e,children:e},e)),(0,kt.jsx)("option",{value:"Other",children:"Other"})]}),"Other"===z.relation&&(0,kt.jsx)("input",{type:"text",placeholder:"Enter relation",value:z.customRelation||"",onChange:e=>W(t=>(0,Y.A)((0,Y.A)({},t),{},{customRelation:e.target.value,relation:e.target.value})),className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("button",{onClick:async()=>{var e;if(z.name.trim()&&z.relation.trim())if(null!==s&&void 0!==s&&null!==(e=s.customer)&&void 0!==e&&e.id)try{const e=await Da.customersService.createFamilyMember(s.customer.id,{name:z.name.trim(),relation:z.relation.trim()});if(null===e||void 0===e||!e.success)throw new Error((null===e||void 0===e?void 0:e.message)||"Failed to add family member");qr.success("Family member added successfully"),W({name:"",relation:"",customRelation:""}),F(!1),ce()}catch(t){console.error("Error adding family member:",t),qr.error(t.message||"Failed to add family member")}else qr.error("Customer information not available");else qr.error("Please enter both name and relation")},className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 font-medium",children:"Save"}),(0,kt.jsx)("button",{onClick:()=>{F(!1),W({name:"",relation:"",customRelation:""})},className:"px-3 py-1 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-medium",children:"Cancel"})]})]}),M?(0,kt.jsx)("div",{className:"text-xs text-gray-500 py-2",children:"Loading..."}):0===L.length?(0,kt.jsx)("div",{className:"text-xs text-gray-500 py-2 italic",children:"No family members added yet"}):(0,kt.jsx)("div",{className:"space-y-2",children:L.map(t=>(0,kt.jsx)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:U===t.id?(0,kt.jsxs)("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsx)("input",{ref:se,type:"text",value:q.name,onChange:e=>{const t=e.target.value;V(e=>(0,Y.A)((0,Y.A)({},e),{},{name:t}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),(0,kt.jsxs)("div",{className:"flex gap-1",children:[(0,kt.jsxs)("select",{value:q.relation,onChange:e=>{const t=e.target.value;V("Other"===t?e=>(0,Y.A)((0,Y.A)({},e),{},{relation:"Other",customRelation:e.customRelation||""}):e=>(0,Y.A)((0,Y.A)({},e),{},{relation:t,customRelation:""}))},className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Relation"}),le.map(e=>(0,kt.jsx)("option",{value:e,children:e},e)),(0,kt.jsx)("option",{value:"Other",children:"Other"})]}),"Other"===q.relation&&(0,kt.jsx)("input",{type:"text",placeholder:"Enter relation",value:q.customRelation||"",onChange:e=>V(t=>(0,Y.A)((0,Y.A)({},t),{},{customRelation:e.target.value,relation:e.target.value})),className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]}),(0,kt.jsxs)("div",{className:"flex gap-2 md:col-span-2",children:[(0,kt.jsx)("button",{onClick:()=>(async e=>{var t;if(q.name.trim()&&q.relation.trim())if(null!==s&&void 0!==s&&null!==(t=s.customer)&&void 0!==t&&t.id)try{const t=await Da.customersService.updateFamilyMember(s.customer.id,e,{name:q.name.trim(),relation:q.relation.trim()});if(null===t||void 0===t||!t.success)throw new Error((null===t||void 0===t?void 0:t.message)||"Failed to update family member");qr.success("Family member updated successfully"),B(null),V({name:"",relation:"",customRelation:""}),ce()}catch(r){console.error("Error updating family member:",r),qr.error(r.message||"Failed to update family member")}else qr.error("Customer information not available");else qr.error("Please enter both name and relation")})(t.id),className:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 font-medium",children:"Save"}),(0,kt.jsx)("button",{onClick:e,className:"px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-medium",children:"Cancel"})]})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-900",children:t.name}),(0,kt.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",t.relation,")"]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>(e=>{B(e.id);const t=!le.includes(e.relation);V({name:e.name,relation:t?"Other":e.relation,customRelation:t?e.relation:""})})(t),className:"p-1 text-gray-600 hover:text-blue-600",title:"Edit",children:(0,kt.jsx)(yn,{className:"w-3 h-3"})}),(0,kt.jsx)("button",{onClick:()=>(async e=>{var t;if(window.confirm("Are you sure you want to delete this family member?"))if(null!==s&&void 0!==s&&null!==(t=s.customer)&&void 0!==t&&t.id)try{const t=await Da.customersService.deleteFamilyMember(s.customer.id,e);if(null===t||void 0===t||!t.success)throw new Error((null===t||void 0===t?void 0:t.message)||"Failed to delete family member");qr.success("Family member deleted successfully"),ce()}catch(r){console.error("Error deleting family member:",r),qr.error(r.message||"Failed to delete family member")}else qr.error("Customer information not available")})(t.id),className:"p-1 text-gray-600 hover:text-red-600",title:"Delete",children:(0,kt.jsx)(Zr,{className:"w-3 h-3"})})]})]})},t.id))})]})},we=()=>{const e=()=>{$(null),ne({name:"",type:"",customType:"",hasYardAccess:!1})};return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-soft mt-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Pets"})]}),!X&&(0,kt.jsxs)("button",{onClick:()=>Q(!0),className:"px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded flex items-center gap-1",children:[(0,kt.jsx)(gn,{className:"w-3 h-3"}),"Add"]})]}),X&&(0,kt.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-2",children:[(0,kt.jsx)("input",{ref:oe,type:"text",placeholder:"Pet Name",value:ee.name,onChange:e=>{const t=e.target.value;te(e=>(0,Y.A)((0,Y.A)({},e),{},{name:t}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),(0,kt.jsxs)("div",{className:"flex gap-1",children:[(0,kt.jsxs)("select",{value:ee.type,onChange:e=>{const t=e.target.value;te("Other"===t?e=>(0,Y.A)((0,Y.A)({},e),{},{type:"Other",customType:e.customType||""}):e=>(0,Y.A)((0,Y.A)({},e),{},{type:t,customType:""}))},className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Type"}),ue.map(e=>(0,kt.jsx)("option",{value:e,children:e},e)),(0,kt.jsx)("option",{value:"Other",children:"Other"})]}),"Other"===ee.type&&(0,kt.jsx)("input",{type:"text",placeholder:"Enter pet type",value:ee.customType||"",onChange:e=>te(t=>(0,Y.A)((0,Y.A)({},t),{},{customType:e.target.value,type:e.target.value})),className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]})]}),(0,kt.jsx)("div",{className:"mb-2",children:(0,kt.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:ee.hasYardAccess,onChange:e=>te(t=>(0,Y.A)((0,Y.A)({},t),{},{hasYardAccess:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer"}),(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Has access to yard"})]})}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("button",{onClick:async()=>{if(ee.name.trim()&&ee.type.trim())if(null!==s&&void 0!==s&&s.id)try{const e=await Da.projectsService.createPet(s.id,{name:ee.name.trim(),type:ee.type.trim(),hasYardAccess:ee.hasYardAccess||!1});if(null===e||void 0===e||!e.success)throw new Error((null===e||void 0===e?void 0:e.message)||"Failed to add pet");qr.success("Pet added successfully"),te({name:"",type:"",customType:"",hasYardAccess:!1}),Q(!1),de()}catch(e){console.error("Error adding pet:",e),qr.error(e.message||"Failed to add pet")}else qr.error("Project information not available");else qr.error("Please enter both pet name and type")},className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 font-medium",children:"Save"}),(0,kt.jsx)("button",{onClick:()=>{Q(!1),te({name:"",type:"",customType:"",hasYardAccess:!1})},className:"px-3 py-1 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-medium",children:"Cancel"})]})]}),K?(0,kt.jsx)("div",{className:"text-xs text-gray-500 py-2",children:"Loading..."}):0===H.length?(0,kt.jsx)("div",{className:"text-xs text-gray-500 py-2 italic",children:"No pets added yet"}):(0,kt.jsx)("div",{className:"space-y-2",children:H.map(t=>(0,kt.jsx)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:Z===t.id?(0,kt.jsxs)("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsx)("input",{ref:ie,type:"text",value:re.name,onChange:e=>{const t=e.target.value;ne(e=>(0,Y.A)((0,Y.A)({},e),{},{name:t}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),(0,kt.jsxs)("div",{className:"flex gap-1",children:[(0,kt.jsxs)("select",{value:re.type,onChange:e=>{const t=e.target.value;ne("Other"===t?e=>(0,Y.A)((0,Y.A)({},e),{},{type:"Other",customType:e.customType||""}):e=>(0,Y.A)((0,Y.A)({},e),{},{type:t,customType:""}))},className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,kt.jsx)("option",{value:"",children:"Select Type"}),ue.map(e=>(0,kt.jsx)("option",{value:e,children:e},e)),(0,kt.jsx)("option",{value:"Other",children:"Other"})]}),"Other"===re.type&&(0,kt.jsx)("input",{type:"text",placeholder:"Enter pet type",value:re.customType||"",onChange:e=>ne(t=>(0,Y.A)((0,Y.A)({},t),{},{customType:e.target.value,type:e.target.value})),className:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]}),(0,kt.jsx)("div",{className:"md:col-span-2",children:(0,kt.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:re.hasYardAccess,onChange:e=>ne(t=>(0,Y.A)((0,Y.A)({},t),{},{hasYardAccess:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer"}),(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Has access to yard"})]})}),(0,kt.jsxs)("div",{className:"flex gap-2 md:col-span-2",children:[(0,kt.jsx)("button",{onClick:()=>(async e=>{if(re.name.trim()&&re.type.trim())if(null!==s&&void 0!==s&&s.id)try{const t=await Da.projectsService.updatePet(s.id,e,{name:re.name.trim(),type:re.type.trim(),hasYardAccess:re.hasYardAccess||!1});if(null===t||void 0===t||!t.success)throw new Error((null===t||void 0===t?void 0:t.message)||"Failed to update pet");qr.success("Pet updated successfully"),$(null),ne({name:"",type:"",customType:"",hasYardAccess:!1}),de()}catch(t){console.error("Error updating pet:",t),qr.error(t.message||"Failed to update pet")}else qr.error("Project information not available");else qr.error("Please enter both pet name and type")})(t.id),className:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 font-medium",children:"Save"}),(0,kt.jsx)("button",{onClick:e,className:"px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-medium",children:"Cancel"})]})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"flex-1",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-900",children:t.name}),(0,kt.jsxs)("span",{className:"text-xs text-gray-500",children:["(",t.type,")"]}),t.hasYardAccess&&(0,kt.jsx)("span",{className:"text-xs text-green-600 font-medium",children:"\u2022 Yard Access"})]})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>(e=>{$(e.id);const t=!ue.includes(e.type);ne({name:e.name,type:t?"Other":e.type,customType:t?e.type:"",hasYardAccess:e.hasYardAccess||!1})})(t),className:"p-1 text-gray-600 hover:text-blue-600",title:"Edit",children:(0,kt.jsx)(yn,{className:"w-3 h-3"})}),(0,kt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this pet?"))if(null!==s&&void 0!==s&&s.id)try{const t=await Da.projectsService.deletePet(s.id,e);if(null===t||void 0===t||!t.success)throw new Error((null===t||void 0===t?void 0:t.message)||"Failed to delete pet");qr.success("Pet deleted successfully"),de()}catch(t){console.error("Error deleting pet:",t),qr.error(t.message||"Failed to delete pet")}else qr.error("Project information not available")})(t.id),className:"p-1 text-gray-600 hover:text-red-600",title:"Delete",children:(0,kt.jsx)(Zr,{className:"w-3 h-3"})})]})]})},t.id))})]})},je=()=>{var e,t,r,n,a,o,i,l;const c=null!==(d=s)&&void 0!==d&&d.trades&&d.trades.length>0?d.trades:[{name:(null===d||void 0===d?void 0:d.projectType)||(null===d||void 0===d?void 0:d.type)||"General",laborProgress:(null===d||void 0===d?void 0:d.progress)||0,materialsDelivered:(null===d||void 0===d?void 0:d.materialsDelivered)||!1}];var d;const u=Math.round(c.reduce((e,t)=>e+(t.laborProgress||0),0)/(c.length||1)),h=Math.round(c.filter(e=>e.materialsDelivered).length/c.length*100);return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-soft",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-10 h-10 bg-[#F8FAFC] rounded-full flex items-center justify-center",children:(0,kt.jsx)(en,{className:"w-5 h-5 text-white"})}),(0,kt.jsx)("div",{children:(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-900 leading-5",children:"Project Progress"})})]}),(0,kt.jsxs)("div",{className:"text-right text-xs text-gray-700 w-56 overflow-hidden",children:[(0,kt.jsx)("div",{className:"font-semibold truncate",title:null!==(e=s.projectManager)&&void 0!==e&&e.firstName&&null!==(t=s.projectManager)&&void 0!==t&&t.lastName?"".concat(s.projectManager.firstName," ").concat(s.projectManager.lastName):(null===(r=s.projectManager)||void 0===r?void 0:r.name)||"PM: Not Assigned",children:null!==(n=s.projectManager)&&void 0!==n&&n.firstName&&null!==(a=s.projectManager)&&void 0!==a&&a.lastName?"".concat(s.projectManager.firstName," ").concat(s.projectManager.lastName):(null===(o=s.projectManager)||void 0===o?void 0:o.name)||"PM: Not Assigned"}),(null===(i=s.projectManager)||void 0===i?void 0:i.email)&&(0,kt.jsx)("div",{className:"truncate",title:s.projectManager.email,children:s.projectManager.email}),(null===(l=s.projectManager)||void 0===l?void 0:l.phone)&&(0,kt.jsx)("div",{className:"truncate",title:s.projectManager.phone,children:Hi(s.projectManager.phone)})]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Overall Progress"}),(0,kt.jsxs)("span",{className:"text-xs font-bold text-gray-900",children:[u,"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-2.5 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full rounded-full transition-all duration-500 ease-out ".concat("bg-[#F8FAFC]"),style:{width:"".concat(u,"%")},children:u>15&&(0,kt.jsx)("div",{className:"h-full w-full bg-gradient-to-t from-white/20 to-transparent rounded-full"})})})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Materials Delivered"}),(0,kt.jsxs)("span",{className:"text-xs font-bold text-gray-900",children:[h,"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full bg-[#F8FAFC] rounded-full transition-all duration-500",style:{width:"".concat(h,"%")}})})]}),(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Trade Breakdown"}),(0,kt.jsx)("button",{onClick:()=>g(!f),className:"inline-flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:f?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"Hide Details"}),(0,kt.jsx)(mn,{className:"w-4 h-4"})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"Show Details"}),(0,kt.jsx)(tn,{className:"w-4 h-4"})]})})]}),f&&(0,kt.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pt-3 border-t border-gray-200",children:c.map((e,t)=>{const r=["from-purple-500 to-purple-600","from-pink-500 to-pink-600","from-yellow-500 to-yellow-600","from-teal-500 to-teal-600","from-red-500 to-red-600","from-indigo-500 to-indigo-600","from-cyan-500 to-cyan-600","from-amber-500 to-amber-600","from-lime-500 to-lime-600","from-fuchsia-500 to-fuchsia-600"],n=r[t%r.length];return(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-800 truncate",children:e.name}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[e.laborProgress,"%"]})]}),(0,kt.jsx)("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full bg-gradient-to-r ".concat(n," rounded-full transition-all duration-500"),style:{width:"".concat(e.laborProgress,"%")}})})]},t)})})]})]})},Ne=()=>{const[e,t]=(0,o.useState)([]),[n,a]=(0,o.useState)(!1),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)([]),[m,p]=(0,o.useState)({}),[f,g]=(0,o.useState)(!1),v=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=!1;return(async()=>{if(null!==s&&void 0!==s&&s.id)try{var r;a(!0),l("");const n=await Da.documentsService.getByProject(s.id);if(e)return;t(Array.isArray(null===n||void 0===n||null===(r=n.data)||void 0===r?void 0:r.documents)?n.data.documents:[])}catch(_t){e||l(_t.message||"Failed to load documents")}finally{e||a(!1)}})(),()=>{e=!0}},[null===s||void 0===s?void 0:s.id]);const w=e=>{const t=parseInt(e,10)||0;if(t<1024)return"".concat(t," B");const r=t/1024;if(r<1024)return"".concat(Math.round(r)," KB");return"".concat((r/1024).toFixed(1)," MB")},j="minmax(240px,1fr) 140px 90px 120px 160px";return(0,kt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-soft mt-4",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Documents"}),(0,kt.jsxs)("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-lg hover:bg-blue-700 transition shadow-sm",children:[(0,kt.jsx)($i,{className:"w-4 h-4"}),"Upload"]})]}),i&&(0,kt.jsx)("div",{className:"text-xs text-red-600 mb-2",children:i}),n?(0,kt.jsx)("div",{className:"text-xs text-gray-600",children:"Loading\xe2\u20ac\xa6"}):0===e.length?(0,kt.jsx)("div",{className:"text-xs text-gray-500",children:"No documents yet"}):(0,kt.jsxs)("div",{className:"overflow-x-auto",children:[(0,kt.jsxs)("div",{className:"min-w-[780px] grid gap-2 items-center px-2 py-1 border-b text-[11px] text-gray-500",style:{gridTemplateColumns:j},children:[(0,kt.jsx)("div",{children:"Name"}),(0,kt.jsx)("div",{children:"Type"}),(0,kt.jsx)("div",{children:"Size"}),(0,kt.jsx)("div",{children:"Uploaded"}),(0,kt.jsx)("div",{className:"text-right pr-1",children:"Actions"})]}),e.map(e=>(0,kt.jsxs)("div",{className:"min-w-[780px] grid gap-2 items-center px-2 py-2 border-b text-xs",style:{gridTemplateColumns:j},children:[(0,kt.jsx)("div",{className:"font-medium text-blue-700 whitespace-nowrap overflow-hidden text-ellipsis",title:e.originalName||e.fileName,children:e.originalName||e.fileName}),(0,kt.jsx)("div",{className:"text-gray-700 truncate",title:e.mimeType||e.fileType,children:e.mimeType||e.fileType}),(0,kt.jsx)("div",{className:"text-gray-700",children:w(e.fileSize)}),(0,kt.jsx)("div",{className:"text-gray-700",children:new Date(e.createdAt||e.updatedAt||Date.now()).toLocaleDateString()}),(0,kt.jsxs)("div",{className:"text-right space-x-3",children:[(0,kt.jsx)("button",{onClick:async t=>{t.preventDefault();try{const t=(await Da.documentsService.download(e.id)).data,r=window.URL.createObjectURL(t),n=(0,Y.A)((0,Y.A)({},e),{},{url:r,fileName:e.fileName||e.name||"Document"});x(n),y(!0),setTimeout(()=>{b||window.URL.revokeObjectURL(r)},6e4)}catch(r){console.error("Preview failed:",r),qr.error("Failed to preview document")}},className:"text-blue-600 hover:underline cursor-pointer",children:"Preview"}),(0,kt.jsx)("button",{onClick:async t=>{t.preventDefault();try{const t=(await Da.documentsService.download(e.id)).data,r=window.URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=e.originalName||e.fileName||"document",document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)}catch(r){console.error("Download failed:",r),qr.error("Failed to download document")}},className:"text-blue-600 hover:underline cursor-pointer",children:"Download"})]})]},e.id))]}),c&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 max-w-md w-full",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Upload Documents"}),(0,kt.jsx)("button",{onClick:()=>{d(!1),h([]),p({})},className:"text-gray-400 hover:text-gray-600",children:(0,kt.jsx)(Zr,{className:"w-5 h-5"})})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-700",children:"Select Files"}),(0,kt.jsxs)("div",{onClick:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-gray-400 transition",children:[(0,kt.jsx)($i,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),(0,kt.jsx)("p",{className:"text-sm text-gray-600",children:"Click to select files"}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PDF, DOC, XLS, images, and more"})]}),(0,kt.jsx)("input",{ref:v,type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);h(t);const r={};t.forEach((e,t)=>{r[t]=e.name}),p(r)},className:"hidden"}),u.length>0&&(0,kt.jsx)("div",{className:"mt-4 space-y-3 max-h-60 overflow-y-auto pr-1",children:u.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("span",{className:"text-xs text-gray-500 font-medium",children:["Original: ",e.name]}),(0,kt.jsxs)("span",{className:"text-xs text-gray-400",children:[(e.size/1048576).toFixed(1)," MB"]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"File Name"}),(0,kt.jsx)("input",{type:"text",value:m[t]||"",onChange:e=>p(r=>(0,Y.A)((0,Y.A)({},r),{},{[t]:e.target.value})),className:"w-full text-sm border border-gray-300 rounded px-2 py-1.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",placeholder:"Enter file name"})]})]},t))})]}),(0,kt.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,kt.jsx)("button",{onClick:()=>{d(!1),h([]),p({})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(0!==u.length&&null!==s&&void 0!==s&&s.id){g(!0);try{var e,n,a,o,i,l,c;const{assetsService:g}=await Promise.resolve().then(r.bind(r,7877));let b=(await g.listFolders({parentId:null,sortBy:"title",sortOrder:"asc",limit:1e3})).find(e=>"Projects"===(e.folderName||e.title));var f;if(!b)b=await g.createFolder({name:"Projects",parentId:null}),"function"===typeof(null===(f=window)||void 0===f?void 0:f.dispatchEvent)&&window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:null}}));if(!b||!b.id)throw new Error("Failed to get or create Projects root folder");const y=await g.listFolders({parentId:b.id,sortBy:"title",sortOrder:"asc",limit:1e3}),w=(null===(e=s.customer)||void 0===e?void 0:e.primaryName)||(null===(n=s.customer)||void 0===n?void 0:n.firstName)+" "+(null===(a=s.customer)||void 0===a?void 0:a.lastName)||s.customerName||"Unknown",j="".concat(s.projectNumber," - ").concat(w);let N=null;if(s.projectNumber&&(N=y.find(e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t.projectNumber)===s.projectNumber}),console.log("\ud83d\udd0d Searching for project folder by project number:",s.projectNumber,"Found:",!!N),N&&console.log("\ud83d\udcc1 Found project folder by number:",N.title||N.folderName)),N||(N=y.find(e=>(e.folderName||e.title)===j),console.log("\ud83d\udd0d Searching for project folder by name:",j,"Found:",!!N)),!N){const e={projectId:s.id,projectNumber:s.projectNumber,customerName:w,address:s.projectName||s.name||"",isProjectFolder:!0};N=await g.createFolder({name:j,parentId:b.id,metadata:e})}console.log("\ud83d\udcc1 Using project folder for assets:",null===(o=N)||void 0===o?void 0:o.id,null===(i=N)||void 0===i?void 0:i.title);for(let e=0;e<u.length;e++){var v;const t=u[e],r=m[e]||t.name,n=new File([t],r,{type:t.type}),a=new FormData;a.append("file",n),a.append("projectId",s.id),a.append("description","Uploaded from Project Profile"),a.append("fileType","OTHER"),a.append("isPublic","false"),await Yi.uploadDocument(a),await g.uploadFiles({files:[n],parentId:(null===(v=N)||void 0===v?void 0:v.id)||null,description:"Uploaded from Project Profile",tags:[]})}var x;if("function"===typeof(null===(l=window)||void 0===l?void 0:l.dispatchEvent))window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:(null===(x=N)||void 0===x?void 0:x.id)||null}})),window.dispatchEvent(new CustomEvent("fm:refresh",{detail:{parentId:null}}));qr.success("Documents uploaded and organized in project folder!"),d(!1),h([]),p({});const S=await Da.documentsService.getByProject(s.id);t(Array.isArray(null===S||void 0===S||null===(c=S.data)||void 0===c?void 0:c.documents)?S.data.documents:[])}catch(b){console.error("Upload failed:",b),qr.error("Upload failed: ".concat(b.message))}finally{g(!1)}}},disabled:0===u.length||f,className:"flex-1 px-4 py-2 rounded-lg font-medium transition ".concat(0===u.length||f?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:f?"Uploading...":"Upload ".concat(u.length>0?"(".concat(u.length,")"):"")})]})]})]})})]})},Se=()=>N?(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Edit Contact Information"}),(0,kt.jsx)("button",{onClick:fe,className:"text-gray-400 hover:text-gray-600",children:(0,kt.jsx)(Zr,{className:"w-6 h-6"})})]}),(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold text-blue-700 border-b border-blue-200 pb-2",children:"Primary Customer"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsx)("input",{type:"text",value:k.customerName,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{customerName:e.target.value})),placeholder:"Customer Name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"tel",value:k.customerPhone,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{customerPhone:e.target.value})),placeholder:"Phone Number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"email",value:k.customerEmail,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{customerEmail:e.target.value})),placeholder:"Email Address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold text-purple-700 border-b border-purple-200 pb-2",children:"Project Manager"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsxs)("select",{value:k.pmId,onChange:e=>{const t=P.find(t=>t.id.toString()===e.target.value);A(r=>(0,Y.A)((0,Y.A)({},r),{},{pmId:e.target.value,pmName:t?"".concat(t.firstName," ").concat(t.lastName):"",pmEmail:(null===t||void 0===t?void 0:t.email)||"",pmPhone:(null===t||void 0===t?void 0:t.phone)||""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:I,children:[(0,kt.jsx)("option",{value:"",children:I?"\xe2\x8f\xb3 Loading users...":"\xf0\u0178\u2018\xa4 Select Project Manager"}),P.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),(0,kt.jsx)("input",{type:"tel",value:k.pmPhone,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{pmPhone:e.target.value})),placeholder:"Phone Number (Optional)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"email",value:k.pmEmail,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{pmEmail:e.target.value})),placeholder:"Email Address (Optional)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold text-gray-600 border-b border-gray-200 pb-2",children:"Secondary Contact (Optional)"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsx)("input",{type:"text",value:k.secondaryName,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{secondaryName:e.target.value})),placeholder:"Secondary Contact Name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"tel",value:k.secondaryPhone,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{secondaryPhone:e.target.value})),placeholder:"Phone Number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,kt.jsx)("input",{type:"email",value:k.secondaryEmail,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{secondaryEmail:e.target.value})),placeholder:"Email Address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold text-orange-700 border-b border-orange-200 pb-2",children:"Project Details"}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("input",{type:"checkbox",id:"editDoublePull",checked:k.doublePull,onChange:e=>A(t=>(0,Y.A)((0,Y.A)({},t),{},{doublePull:e.target.checked})),className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,kt.jsx)("label",{htmlFor:"editDoublePull",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Double Pull House (requires two ladders to access roof)"})]})})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 mt-8 pt-6 border-t border-gray-200",children:[(0,kt.jsx)("button",{onClick:ge,disabled:C,className:"flex-1 px-4 py-3 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 font-medium transition-colors",children:C?"Saving...":"Save Changes"}),(0,kt.jsx)("button",{onClick:fe,disabled:C,className:"flex-1 px-4 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 disabled:opacity-50 font-medium transition-colors",children:"Cancel"})]})]})}):null,ke=()=>{var e;const t=(null===(e=s.teamMembers)||void 0===e?void 0:e.filter(e=>"SUBCONTRACTOR"===e.role))||[];return 0===t.length?null:(0,kt.jsxs)("div",{className:"rounded-lg shadow-sm border p-4 ".concat(i?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,kt.jsx)("span",{className:"text-lg",children:"\ud83d\udd28"}),(0,kt.jsxs)("h3",{className:"text-sm font-semibold ".concat(i?"text-orange-300":"text-orange-700"),children:["Subcontractors (",t.length,")"]})]}),(0,kt.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>{var r,n,a,s,o,l,c;return(0,kt.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded ".concat(i?"bg-orange-900/20":"bg-orange-50"),children:[(0,kt.jsxs)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold ".concat(i?"bg-orange-700 text-orange-100":"bg-orange-200 text-orange-800"),children:[null===(r=e.user)||void 0===r||null===(n=r.firstName)||void 0===n?void 0:n[0],null===(a=e.user)||void 0===a||null===(s=a.lastName)||void 0===s?void 0:s[0]]}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"text-sm font-medium truncate ".concat(i?"text-gray-200":"text-gray-900"),children:[null===(o=e.user)||void 0===o?void 0:o.firstName," ",null===(l=e.user)||void 0===l?void 0:l.lastName]}),(null===(c=e.user)||void 0===c?void 0:c.email)&&(0,kt.jsx)("div",{className:"text-xs truncate ".concat(i?"text-gray-400":"text-gray-600"),children:e.user.email})]})]},e.id||t)})})]})};return(0,kt.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,kt.jsx)("div",{className:"mb-4",children:c&&(0,kt.jsx)(Di,{onClick:c,colorMode:i,className:"mb-2"})}),(0,kt.jsx)(ve,{}),(0,kt.jsx)(xe,{}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,kt.jsx)(be,{}),(0,kt.jsx)(ye,{}),(0,kt.jsx)(we,{}),(0,kt.jsx)(Ne,{})]}),(0,kt.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,kt.jsx)(je,{}),(0,kt.jsx)(ke,{})]})]}),(0,kt.jsx)(Oa,{document:v,isOpen:b,onClose:()=>{y(!1),x(null)}}),(0,kt.jsx)(Xi,{isOpen:d,onClose:()=>u(!1),address:s.address||(null===(a=s.customer)||void 0===a?void 0:a.address)||""})]})},tl="WORKFLOW_CHECKBOX_",rl="BACKUP_CHECKBOX_",nl="EMERGENCY_CHECKBOX_",al=(e,t)=>{const r=Array.from(t),n=Date.now(),a=JSON.stringify({items:r,timestamp:n,version:"v3"});try{return localStorage.setItem("".concat(tl).concat(e),a),localStorage.setItem("".concat(tl).concat(e,"_v2"),JSON.stringify(r)),sessionStorage.setItem("".concat(tl).concat(e),a),sessionStorage.setItem("".concat(rl).concat(e),JSON.stringify(r)),localStorage.setItem("".concat(nl).concat(e,"_").concat(n),a),window.caches&&setTimeout(()=>{try{window.caches.open("workflow-cache").then(t=>{const r=new Blob([a],{type:"application/json"});URL.createObjectURL(r);t.put("/workflow/".concat(e),new Response(r))})}catch(_t){}},0),console.log("Checkbox state saved: ".concat(r.length," items across multiple layers")),!0}catch(s){return console.error("Checkbox state save failed:",s),!1}},sl=e=>{try{const t=localStorage.getItem("".concat(tl).concat(e));if(t){const e=JSON.parse(t);if(e.items&&Array.isArray(e.items))return console.log("Loaded from primary storage: ".concat(e.items.length," items")),new Set(e.items)}const r=localStorage.getItem("".concat(tl).concat(e,"_v2"));if(r){const e=JSON.parse(r);if(Array.isArray(e))return console.log("Loaded from primary V2: ".concat(e.length," items")),new Set(e)}const n=sessionStorage.getItem("".concat(tl).concat(e));if(n){const e=JSON.parse(n);if(e.items&&Array.isArray(e.items))return console.log("Loaded from session storage: ".concat(e.items.length," items")),new Set(e.items)}const a=sessionStorage.getItem("".concat(rl).concat(e));if(a){const e=JSON.parse(a);if(Array.isArray(e))return console.log("Loaded from backup: ".concat(e.length," items")),new Set(e)}const s=Object.keys(localStorage).filter(t=>t.startsWith("".concat(nl).concat(e,"_"))).sort().reverse();if(s.length>0){const e=localStorage.getItem(s[0]),t=JSON.parse(e);if(t.items&&Array.isArray(t.items))return console.log("Loaded from emergency backup: ".concat(t.items.length," items")),new Set(t.items)}}catch(t){console.error("Checkbox state load failed:",t)}return console.log("No checkbox data found, returning empty set"),new Set},ol=e=>{var t,r,n,a;let{project:s,onUpdate:i,onPhaseCompletionChange:l,targetLineItemId:c,targetSectionId:d,selectionNonce:u,onBack:h,colorMode:m,projectSourceSection:p,onProjectSelect:f}=e;const g=(null===s||void 0===s?void 0:s._id)||(null===s||void 0===s?void 0:s.id);console.log("\ud83d\udccd PROJECT CHECKLIST PAGE - Navigation params received:"),console.log("   targetLineItemId:",c),console.log("   targetSectionId:",d),console.log("   projectId:",g),console.log("   project.navigationSource:",null===s||void 0===s?void 0:s.navigationSource),console.log("   project.highlightTarget:",null===s||void 0===s?void 0:s.highlightTarget),console.log("   project.navigationTarget:",null===s||void 0===s?void 0:s.navigationTarget),console.log("   project.returnToSection:",null===s||void 0===s?void 0:s.returnToSection),o.useEffect(()=>{const e=document.createElement("style");return e.textContent="\n      @keyframes pulse {\n        0%, 100% { transform: scale(1); opacity: 1; }\n        50% { transform: scale(1.02); opacity: 0.9; }\n      }\n      .workflow-line-item { transition: all 0.3s ease; }\n    ",document.head.appendChild(e),()=>document.head.removeChild(e)},[]);const[v,x]=(0,o.useState)(()=>sl(g)),[b,y]=(0,o.useState)(()=>sl(g)),[w,j]=(0,o.useState)(()=>sl(g)),[N,S]=(0,o.useState)(0),[k,A]=(0,o.useState)(null),[C,E]=(0,o.useState)({}),[P,_]=(0,o.useState)({}),[I,T]=(0,o.useState)({}),[L,D]=(0,o.useState)(null),[M,O]=(0,o.useState)(null),[R,F]=(0,o.useState)(!0),[U,B]=(0,o.useState)(null),[z,W]=(0,o.useState)(null),[q,V]=(0,o.useState)(0),[H,G]=(0,o.useState)([]),K=new URLSearchParams("undefined"!==typeof window?window.location.search:"").get("highlight_item"),[J,X]=(0,o.useState)(c||K),[Q,Z]=(0,o.useState)(d),[$,ee]=(0,o.useState)((null===s||void 0===s||null===(t=s.navigationTarget)||void 0===t?void 0:t.nonce)||null);(0,o.useEffect)(()=>{(c||d)&&(X(c||J),Z(d||Q),ee(Date.now()))},[c,d]);const[te,re]=(0,o.useState)(!1),[ne,ae]=(0,o.useState)({sectionName:"",displayName:"",description:""}),[se,oe]=(0,o.useState)(null),[ie,le]=(0,o.useState)(!1),[ce,de]=(0,o.useState)(!1),[ue,he]=(0,o.useState)({itemName:"",responsibleRole:"OFFICE",description:"",estimatedMinutes:30,alertDays:1,addToAllWorkflows:!1}),[me,pe]=(0,o.useState)(null),[fe,ge]=(0,o.useState)(!1),ve=e=>{const t=v.has(e),r=b.has(e),n=w.has(e),a=t||r||n;return"LEAD-input-customer-info-0"===e&&console.log("\ud83d\udd0d CHECKING ".concat(e,": immediate=").concat(t,", persistent=").concat(r,", backup=").concat(n,", result=").concat(a)),a};(0,o.useEffect)(()=>{(async()=>{if(g){console.log("Loading workflow data for project: ".concat(g)),F(!0),B(null);try{const e=(await Da.default.get("/workflow-data/project-workflows/".concat(g))).data;if(!e.success)throw new Error("Failed to load workflow structure");{D(e.data);const t=e.data.map((e,t)=>({id:e.workflowType,name:e.tradeName,isMainWorkflow:e.isMainWorkflow,completedCount:e.completedCount,totalCount:e.totalCount,progress:e.totalCount>0?Math.round(e.completedCount/e.totalCount*100):0}));G(t),console.log("Loaded ".concat(e.data.length," workflows from database")),e.data.forEach(e=>{console.log("  - ".concat(e.workflowType,": ").concat(e.completedCount,"/").concat(e.totalCount," completed"))}),console.log("Full workflow data:",e.data)}const t=e.data.find(e=>e.isMainWorkflow);if(t){const r={projectId:g,currentPhase:t.currentPhase,currentSection:t.currentSection,currentLineItem:t.currentLineItem,trackerId:t.trackerId};O(r),console.log("Loaded main workflow position:",r);let n=!1;if(c||d||K||(null===s||void 0===s?void 0:s.highlightTarget)||(null===s||void 0===s?void 0:s.navigationTarget)){if(console.log("\ud83c\udfaf ENHANCED NAVIGATION: Processing navigation target from",(null===s||void 0===s?void 0:s.navigationSource)||"unknown"),null!==s&&void 0!==s&&s.highlightTarget){const e=s.highlightTarget;console.log("\ud83c\udfaf ENHANCED NAVIGATION: Using highlightTarget:",e),e.phaseId&&e.sectionId&&(A(e.phaseId),E(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.sectionId]:!0})),n=!0)}else if(null!==s&&void 0!==s&&s.navigationTarget){const e=s.navigationTarget;if(console.log("\ud83c\udfaf ENHANCED NAVIGATION: Using navigationTarget:",e),e.phase&&e.section){const r=((null===t||void 0===t?void 0:t.phases)||[]).find(t=>t.id===e.phase||t.label===e.phase||t.name===e.phase);if(r){const t=(r.items||[]).find(t=>t.id===e.section||t.displayName===e.section||t.label===e.section);t&&(console.log("\ud83c\udfaf ENHANCED NAVIGATION: Expanding phase/section from navigationTarget"),A(r.id),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:!0})),n=!0)}}}if(!n){const r=c||K;if(r&&t){const e=t.phases||[],a=new Set(e.map(e=>e.id)),s=r.split("-");if(s.length>=3&&a.has(s[0])){const e=s[0],t=s.slice(1,-1).join("-");console.log("\ud83c\udfaf NAVIGATION: Expanding by composite id: phase=".concat(e,", section=").concat(t)),A(e),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:!0})),n=!0}else e:for(const t of e)for(const e of t.items||[]){const a=(e.subtasks||[]).some(e=>"object"===typeof e&&e.id===r);if(a){console.log("\ud83c\udfaf NAVIGATION: Expanding by DB id: phase=".concat(t.id,", section=").concat(e.id)),A(t.id),E(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:!0})),n=!0;break e}}}if(!n&&d){const t=(e.data||[]).find(e=>e.items.some(e=>e.id===d));t&&(console.log("\ud83c\udfaf NAVIGATION: Expanding by targetSectionId: phase=".concat(t.id,", section=").concat(d)),A(t.id),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[d]:!0})),n=!0)}}if(!n&&null!==t&&void 0!==t&&t.currentPhase&&null!==t&&void 0!==t&&t.currentSection&&(console.log("\ud83c\udfaf NAVIGATION: Default expand to current position: phase=".concat(t.currentPhase,", section=").concat(t.currentSection)),A(t.currentPhase),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.currentSection]:!0})),n=!0),!n&&Array.isArray(e.data)&&e.data.length>0){const t=e.data[0],r=t.items&&t.items.length>0?t.items[0]:null;t&&r&&(console.log("\ud83c\udfaf NAVIGATION: Fallback expand to first phase/section: phase=".concat(t.id,", section=").concat(r.id)),A(t.id),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[r.id]:!0})))}setTimeout(()=>{let e=null,r="";if(null!==s&&void 0!==s&&s.highlightTarget&&s.highlightTarget.scrollAndHighlight){const t=s.highlightTarget;console.log("\ud83c\udfaf ENHANCED SCROLL: Attempting to scroll to highlightTarget:",t.lineItemId),e=document.getElementById("lineitem-".concat(t.lineItemId)),e||(e=document.getElementById("lineitem-checkbox-".concat(t.lineItemId)),e&&(e=e.closest(".workflow-line-item"))),e&&(r="Enhanced navigation from ".concat(s.navigationSource,": ").concat(t.lineItemId))}else if(null!==s&&void 0!==s&&s.navigationTarget&&s.navigationTarget.autoOpen){const t=s.navigationTarget,n=t.targetElementId||"lineitem-".concat(t.lineItemId);console.log("\ud83c\udfaf ENHANCED SCROLL: Attempting to scroll to navigationTarget:",n),e=document.getElementById(n),!e&&t.lineItemId&&(e=document.getElementById("lineitem-".concat(t.lineItemId))),!e&&t.lineItemId&&(e=document.getElementById("lineitem-checkbox-".concat(t.lineItemId)),e&&(e=e.closest(".workflow-line-item"))),e&&(r="Enhanced navigation from ".concat(s.navigationSource,": ").concat(t.lineItemId||n))}else{const t=c||K;t&&(e=document.getElementById("lineitem-".concat(t)),r="target line item: ".concat(t),e||(e=document.getElementById("lineitem-checkbox-".concat(t)),e&&(e=e.closest(".workflow-line-item"),r="target line item (via checkbox): ".concat(t))))}if(!e&&d&&(e=document.getElementById("item-".concat(d)),r="target section: ".concat(d)),!e&&null!==t&&void 0!==t&&t.currentSection&&(e=document.getElementById("item-".concat(t.currentSection)),r="current section: ".concat(t.currentSection)),e){var n,a,o,i;console.log("\ud83c\udfaf HIGHLIGHTING:",r),e.scrollIntoView({behavior:"smooth",block:"center"});const t=(null===s||void 0===s?void 0:s.highlightTarget)||(null===s||void 0===s?void 0:s.navigationTarget),l=t?(null===(n=s.highlightTarget)||void 0===n?void 0:n.highlightColor)||(null===(a=s.navigationTarget)||void 0===a?void 0:a.highlightColor)||"#0066CC":"#F59E0B",d=t?(null===(o=s.highlightTarget)||void 0===o?void 0:o.highlightDuration)||(null===(i=s.navigationTarget)||void 0===i?void 0:i.highlightDuration)||5e3:8e3;if(c||t)console.log("\ud83c\udfaf ENHANCED HIGHLIGHTING: Applying enhanced highlight from",null===s||void 0===s?void 0:s.navigationSource),"#0066CC"===l?(e.style.backgroundColor="#EFF6FF",e.style.border="3px solid #0066CC",e.style.boxShadow="0 0 20px rgba(0, 102, 204, 0.5)"):(e.style.backgroundColor="#FEF3C7",e.style.border="3px solid #F59E0B",e.style.boxShadow="0 0 20px rgba(245, 158, 11, 0.5)"),e.style.transition="all 0.3s ease",e.style.animation="pulse 1.5s ease-in-out 3",setTimeout(()=>{e.style.backgroundColor="",e.style.border="",e.style.boxShadow="",e.style.animation=""},d);else{const t=["ring-4","ring-blue-500","ring-opacity-75"];e.classList.add(...t),setTimeout(()=>{e.classList.remove(...t)},5e3)}console.log("\u2705 Auto-navigated and highlighted: ".concat(r))}else console.log("\u26a0\ufe0f Could not find element to highlight:",r)},1e3)}}else console.log("\u26a0\ufe0f No project position found for: ".concat(g))}catch(e){console.error("\u274c Error loading workflow data:",e),B(e.message)}finally{F(!1)}}})()},[g]),(0,o.useEffect)(()=>{if(!g)return;console.log("Initializing workflow for project: ".concat(g)),console.log("Initial states:",{immediate:v.size,persistent:b.size,backup:w.size});const e=sl(g);x(e),y(e),j(e),S(1)},[g]),(0,o.useEffect)(()=>{const e=e=>{const{projectId:t,lineItemId:r,stepName:n,source:a}=e.detail;if(t===g&&(console.log("\ud83d\udd14 ProjectChecklistPage: Received workflowStepCompleted event for project ".concat(t),{lineItemId:r,stepName:n,source:a}),r)){const e=[r,"DB_".concat(r),"".concat(r,"-0"),"DB_".concat(r,"-0")];let t=null;for(const n of e)if(n.includes("DB_")||n===r){t=n;break}if(t){console.log("\ud83d\udd04 ProjectChecklistPage: Marking line item ".concat(t," as checked from ").concat(a));const e=new Set(v),r=new Set(b),n=new Set(w);e.add(t),r.add(t),n.add(t),x(e),y(r),j(n),al(g,r),S(e=>e+1),console.log("\u2705 ProjectChecklistPage: Successfully marked ".concat(t," as completed"))}else console.warn("\u26a0\ufe0f ProjectChecklistPage: Could not determine step ID format for line item ".concat(r))}};return window.addEventListener("workflowStepCompleted",e),()=>{window.removeEventListener("workflowStepCompleted",e)}},[g,v,b,w]);const xe=null===L||void 0===L?void 0:L[q],be=(null===xe||void 0===xe?void 0:xe.phases)||[];return(0,o.useEffect)(()=>{if(!xe||!c&&!d&&(null===s||void 0===s||!s.navigationTarget))return;(async()=>{try{var e,t,r;let n=!1;const a=be||[];if(c)e:for(const e of a)for(const t of e.items||[]){const r=(t.subtasks||[]).some(e=>"object"===typeof e&&(e.id===c||e.id===String(c)));if(r){A(e.id),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:!0})),n=!0;break e}}if(!n&&d){const e=a.find(e=>(e.items||[]).some(e=>e.id===d));e&&(A(e.id),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[d]:!0})),n=!0)}if(!n&&null!==s&&void 0!==s&&null!==(e=s.navigationTarget)&&void 0!==e&&e.phase&&null!==s&&void 0!==s&&null!==(t=s.navigationTarget)&&void 0!==t&&t.section){const e=a.find(e=>e.id===s.navigationTarget.phase||e.label===s.navigationTarget.phase||e.name===s.navigationTarget.phase);if(e){const t=(e.items||[]).find(e=>e.id===s.navigationTarget.section||e.displayName===s.navigationTarget.section||e.label===s.navigationTarget.section);t&&(A(e.id),E(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:!0})),n=!0)}}setTimeout(()=>{var e,t,r;let n=null;const a=c||(null===s||void 0===s||null===(e=s.navigationTarget)||void 0===e?void 0:e.lineItemId)||(null===s||void 0===s||null===(t=s.highlightTarget)||void 0===t?void 0:t.lineItemId);var o;a&&(n=document.getElementById("lineitem-".concat(a))||(null===(o=document.getElementById("lineitem-checkbox-".concat(a)))||void 0===o?void 0:o.closest(".workflow-line-item"))||null);if(!n&&(d||null!==s&&void 0!==s&&null!==(r=s.navigationTarget)&&void 0!==r&&r.targetSectionId)){const e=d||s.navigationTarget.targetSectionId;n=document.getElementById("item-".concat(e))}if(n){var i,l,u,h;n.scrollIntoView({behavior:"smooth",block:"center"});"#0066CC"===((null===s||void 0===s?void 0:s.highlightTarget)||(null===s||void 0===s?void 0:s.navigationTarget)?(null===(i=s.highlightTarget)||void 0===i?void 0:i.highlightColor)||(null===(l=s.navigationTarget)||void 0===l?void 0:l.highlightColor)||"#0066CC":"#F59E0B")?(n.style.backgroundColor="#EFF6FF",n.style.border="3px solid #0066CC",n.style.boxShadow="0 0 20px rgba(0, 102, 204, 0.5)"):(n.style.backgroundColor="#FEF3C7",n.style.border="3px solid #F59E0B",n.style.boxShadow="0 0 20px rgba(245, 158, 11, 0.5)"),n.style.transition="all 0.3s ease",n.style.animation="pulse 1.5s ease-in-out 3",setTimeout(()=>{n.style.backgroundColor="",n.style.border="",n.style.boxShadow="",n.style.animation=""},(null===(u=s.highlightTarget)||void 0===u?void 0:u.highlightDuration)||(null===(h=s.navigationTarget)||void 0===h?void 0:h.highlightDuration)||5e3)}},500),null!==s&&void 0!==s&&null!==(r=s.navigationTarget)&&void 0!==r&&r.nonce&&ee(s.navigationTarget.nonce)}catch(_t){console.error("Navigation re-run failed",_t)}})()},[c,d,null===s||void 0===s||null===(r=s.navigationTarget)||void 0===r?void 0:r.phase,null===s||void 0===s||null===(n=s.navigationTarget)||void 0===n?void 0:n.section,null===s||void 0===s||null===(a=s.navigationTarget)||void 0===a?void 0:a.lineItemId,$,u,be]),s?R?(0,kt.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,kt.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,kt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,kt.jsx)("div",{className:"text-gray-600",children:"Loading workflow from database..."})]})})})}):U?(0,kt.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,kt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,kt.jsx)("div",{className:"text-red-600 font-semibold mb-2",children:"Failed to Load Workflow"}),(0,kt.jsx)("div",{className:"text-red-500 text-sm",children:U})]})}):L&&0!==L.length?(0,kt.jsxs)("div",{className:"max-w-4xl mx-auto p-0 space-y-0",children:[h&&(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsxs)("button",{onClick:h,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to ","Project Workflow Line Items"===p?"Dashboard":p||"Dashboard"]})}),H.length>1&&(0,kt.jsx)("div",{className:"bg-white border-b border-gray-200 mb-6",children:(0,kt.jsx)("div",{className:"flex space-x-1 overflow-x-auto",children:H.map((e,t)=>(0,kt.jsx)("button",{onClick:()=>V(t),className:"flex-shrink-0 px-4 py-3 text-sm font-medium border-b-2 transition-colors duration-200 ".concat(t===q?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("span",{children:e.name}),e.isMainWorkflow&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Main"}),(0,kt.jsxs)("span",{className:"text-xs text-gray-400",children:[e.completedCount,"/",e.totalCount]}),(0,kt.jsx)("div",{className:"w-12 bg-gray-200 rounded-full h-1.5",children:(0,kt.jsx)("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300",style:{width:"".concat(e.progress,"%")}})})]})},e.id))})}),(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsx)("div",{className:"flex items-center justify-between",children:(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:[(null===xe||void 0===xe?void 0:xe.tradeName)||"Workflow"," Checklist",(null===xe||void 0===xe?void 0:xe.isMainWorkflow)&&(0,kt.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Main Workflow"})]}),(0,kt.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[(null===xe||void 0===xe?void 0:xe.completedCount)||0," of ",(null===xe||void 0===xe?void 0:xe.totalCount)||0," items completed (",(null===xe||void 0===xe?void 0:xe.totalCount)>0?Math.round(xe.completedCount/xe.totalCount*100):0,"%)"]})]})})}),(0,kt.jsx)("div",{className:"space-y-4",children:be.map(e=>{var t,r,n,a;return console.log("Rendering phase: ".concat(e.id," with ").concat(e.items.length," items")),(0,kt.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,kt.jsx)("button",{onClick:()=>{return t=e.id,A("ALL"===k?t:k===t?null:t),void E({});var t},className:"w-full px-6 py-4 text-left font-semibold bg-white hover:bg-gray-50 transition-colors duration-200 border-b border-gray-100 ".concat(e.items.length>0&&e.items.every(t=>t.subtasks.every((r,n)=>{const a="DB_".concat(e.id,"-").concat(t.id,"-").concat(n);return ve(a)}))?"line-through decoration-2":""),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-4 h-4 rounded-full ".concat((a=e.id,Wn.getPhaseButtonProps(a).bgColor||"bg-gray-500")," flex-shrink-0")}),(0,kt.jsx)("span",{className:"text-gray-900",children:e.label})]}),(0,kt.jsx)(tn,{className:"w-5 h-5 transform transition-transform duration-200 text-gray-600 ".concat(k===e.id||"ALL"===k?"rotate-180":"")})]})}),k===e.id&&(0,kt.jsxs)("div",{className:"p-6 space-y-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>_(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:t[e.id]?void 0:{name:"",saving:!1}})),className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-md text-white bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700",children:"+ Add Section"}),P[e.id]&&(0,kt.jsxs)("form",{onSubmit:async t=>{var r;t.preventDefault();const n=null===(r=P[e.id].name)||void 0===r?void 0:r.trim();if(n){_(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:(0,Y.A)((0,Y.A)({},t[e.id]),{},{saving:!0})}));try{var a;const t={phaseId:e.id,sectionName:n,displayName:n};if(null!==(a=(await Da.default.post("/workflows/sections",t)).data)&&void 0!==a&&a.success){const t=await Da.default.get("/workflow-data/project-workflows/".concat(g));t.data.success&&D(t.data.data),_(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:void 0}))}}catch(XI){var s,o;alert((null===XI||void 0===XI||null===(s=XI.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||"Failed to add section"),_(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:(0,Y.A)((0,Y.A)({},t[e.id]),{},{saving:!1})}))}}},className:"flex items-center gap-2",children:[(0,kt.jsx)("input",{autoFocus:!0,type:"text",value:(null===(t=P[e.id])||void 0===t?void 0:t.name)||"",onChange:t=>_(r=>(0,Y.A)((0,Y.A)({},r),{},{[e.id]:(0,Y.A)((0,Y.A)({},r[e.id]),{},{name:t.target.value})})),className:"px-2 py-1 border border-gray-300 rounded-md text-sm",placeholder:"Section name"}),(0,kt.jsx)("button",{type:"submit",disabled:null===(r=P[e.id])||void 0===r?void 0:r.saving,className:"px-2 py-1 text-xs text-white bg-[var(--color-success-green)] rounded-md disabled:opacity-50",children:null!==(n=P[e.id])&&void 0!==n&&n.saving?"Saving...":"Save"})]})]}),0===e.items.length?(0,kt.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,kt.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udccb"}),(0,kt.jsx)("div",{className:"text-lg font-medium",children:"No items in this phase yet"}),(0,kt.jsx)("div",{className:"text-sm",children:"This phase will be populated with workflow items as needed."})]}):e.items.map(t=>{var r,n,a,s,o;const l=M&&M.currentSection===t.id;return(0,kt.jsxs)("div",{id:"item-".concat(t.id),className:"border rounded-lg overflow-hidden ".concat(l?"border-blue-500 bg-blue-50/50":""),children:[(0,kt.jsx)("button",{onClick:()=>{return e=t.id,void E(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!t[e]}));var e},className:"w-full px-4 py-3 text-left font-medium transition-colors duration-200 ".concat(l?"bg-blue-100 hover:bg-blue-150 text-blue-900":"bg-gray-50 hover:bg-gray-100 text-gray-800"," ").concat(t.subtasks.every((r,n)=>{const a="DB_".concat(e.id,"-").concat(t.id,"-").concat(n);return ve(a)})?"line-through decoration-2":""),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between group",children:[(0,kt.jsxs)("span",{className:"flex items-center gap-2",children:[l&&(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udc48"}),t.label]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:async e=>{if(e.stopPropagation(),window.confirm("Delete this section?"))try{var r;let n;try{n=await Da.default.delete("/workflows/sections/".concat(t.id))}catch(e){n=await Da.default.post("/workflows/sections/".concat(t.id,"/delete"))}if(null!==(r=n.data)&&void 0!==r&&r.success){const e=await Da.default.get("/workflow-data/project-workflows/".concat(g));e.data.success&&D(e.data.data)}}catch(XI){var n,a;alert((null===XI||void 0===XI||null===(n=XI.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message)||"Failed to delete section")}},className:"p-1 rounded text-gray-400 hover:text-red-600 hover:bg-red-50 opacity-0 group-hover:opacity-100 transition",title:"Delete section","aria-label":"Delete section",children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"w-4 h-4",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-7 4v6m4-6v6M7 7l1 13a2 2 0 002 2h4a2 2 0 002-2l1-13"})})}),(0,kt.jsx)(tn,{className:"w-4 h-4 transform transition-transform duration-200 ".concat(C[t.id]?"rotate-180":"")})]})]})}),C[t.id]&&(0,kt.jsxs)("div",{className:"p-4 ".concat(l?"bg-blue-50/30":"bg-white"),children:[(0,kt.jsx)("div",{className:"space-y-3",children:t.subtasks.map((r,n)=>{const a="object"===typeof r?r.id:null,s="object"===typeof r?r.label:r,o=a||"DB_".concat(e.id,"-").concat(t.id,"-").concat(n),l=ve(o),c=M&&M.currentSection===t.id&&(M.currentLineItem===a||M.currentLineItemName===s),d=a||"".concat(e.id,"-").concat(t.id,"-").concat(n),u=J&&J===d;return(0,kt.jsxs)("div",{id:"lineitem-".concat(d),className:"workflow-line-item group flex items-start space-x-3 ".concat(c?"p-2 bg-blue-100 border border-blue-300 rounded-lg ring-2 ring-blue-400 ring-opacity-50":u?"p-2 bg-yellow-100 border border-yellow-300 rounded-lg ring-2 ring-yellow-400 ring-opacity-75":""),children:[(0,kt.jsxs)("div",{className:"relative flex-shrink-0 mt-1",children:[(0,kt.jsx)("input",{type:"checkbox",id:"lineitem-checkbox-".concat(o),checked:l,onChange:()=>{console.log("Checkbox onChange: ".concat(o,", Database ID: ").concat(a)),(e=>{console.log("Checkbox clicked: ".concat(e));const t=v.has(e)||b.has(e),r=!t;console.log("Toggle: ".concat(e," from ").concat(t," to ").concat(r)),(t=>{const r=new Set(v),n=new Set(b),a=new Set(w);t?(r.add(e),n.add(e),a.add(e)):(r.delete(e),n.delete(e),a.delete(e)),x(r),y(n),j(a),S(e=>e+1),al(g,n),console.log("All states updated: ".concat(t?"CHECKED":"UNCHECKED"," - ").concat(Array.from(n).length," items"))})(r),setTimeout(()=>{try{ns.updateStep(g,e,r).then(()=>{console.log("Server sync success: ".concat(e)),i&&"function"===typeof i&&(console.log("\ud83d\udd04 Triggering project data refresh after workflow completion"),i())}).catch(t=>{console.error("Server sync failed: ".concat(e),t)})}catch(t){console.error("Server call failed: ".concat(e),t)}},10)})(a||o,e.id,t.id)},onClick:e=>{console.log("Checkbox onClick: ".concat(o)),e.stopPropagation()},className:"h-4 w-4 rounded border-2 text-blue-600 focus:ring-2 focus:ring-blue-500 transition-all duration-200 checked:bg-[var(--color-primary-blueprint-blue)] checked:border-blue-600 ".concat(c?"border-blue-500":"border-gray-300")}),l&&(0,kt.jsx)("svg",{className:"absolute inset-0 w-4 h-4 text-white pointer-events-none",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),(0,kt.jsxs)("label",{htmlFor:"lineitem-checkbox-".concat(o),className:"flex-1 text-sm cursor-pointer select-none transition-all duration-200 ".concat(c?"font-semibold text-blue-800":u?"font-semibold text-yellow-800":l?"text-gray-500 line-through decoration-2":"text-gray-800 hover:text-blue-600"),children:[c&&(0,kt.jsx)("span",{className:"text-blue-500",children:"\ud83d\udc48 "}),u&&(0,kt.jsx)("span",{className:"text-yellow-500",children:"\u2b50 "}),s]}),a&&(0,kt.jsx)("button",{onClick:async e=>{if(e.stopPropagation(),window.confirm("Delete this line item?"))try{var t;let r;try{r=await Da.default.delete("/workflows/line-items/".concat(a))}catch(e){r=await Da.default.post("/workflows/line-items/".concat(a,"/delete"))}if(null!==(t=r.data)&&void 0!==t&&t.success){const e=await Da.default.get("/workflow-data/project-workflows/".concat(g));e.data.success&&D(e.data.data)}}catch(XI){var r,n;alert((null===XI||void 0===XI||null===(r=XI.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||"Failed to delete line item")}},className:"p-1 rounded text-gray-400 hover:text-red-600 hover:bg-red-50 opacity-0 group-hover:opacity-100 transition ml-2",title:"Delete line item","aria-label":"Delete line item",children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"w-4 h-4",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-7 4v6m4-6v6M7 7l1 13a2 2 0 002 2h4a2 2 0 002-2l1-13"})})})]},n)})}),(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("button",{onClick:()=>T(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:e[t.id]?void 0:{name:"",role:"OFFICE",saving:!1}})),className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-md text-white bg-[var(--color-success-green)] hover:bg-green-700",children:"+ Add Line Item"}),I[t.id]&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("form",{onSubmit:async e=>{var r;e.preventDefault();const n=null===(r=I[t.id].name)||void 0===r?void 0:r.trim();if(n){T(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:(0,Y.A)((0,Y.A)({},e[t.id]),{},{saving:!0})}));try{var a,s;const e={sectionId:t.id,itemName:n,responsibleRole:(I[t.id].role,"PROJECT_MANAGER"),addToAllWorkflows:(null===(a=I[t.id])||void 0===a?void 0:a.addToAllWorkflows)||!1};if(null!==(s=(await Da.default.post("/workflows/line-items",e)).data)&&void 0!==s&&s.success){const e=await Da.default.get("/workflow-data/project-workflows/".concat(g));e.data.success&&D(e.data.data),T(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:void 0}))}}catch(XI){var o,i;alert((null===XI||void 0===XI||null===(o=XI.response)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.message)||"Failed to add line item"),T(e=>(0,Y.A)((0,Y.A)({},e),{},{[t.id]:(0,Y.A)((0,Y.A)({},e[t.id]),{},{saving:!1})}))}}},className:"flex items-center gap-2 mt-2",children:[(0,kt.jsx)("input",{autoFocus:!0,type:"text",value:(null===(r=I[t.id])||void 0===r?void 0:r.name)||"",onChange:e=>T(r=>(0,Y.A)((0,Y.A)({},r),{},{[t.id]:(0,Y.A)((0,Y.A)({},r[t.id]),{},{name:e.target.value})})),className:"px-2 py-1 border border-gray-300 rounded-md text-sm",placeholder:"Line item name"}),(0,kt.jsxs)("select",{value:(null===(n=I[t.id])||void 0===n?void 0:n.role)||"OFFICE",onChange:e=>T(r=>(0,Y.A)((0,Y.A)({},r),{},{[t.id]:(0,Y.A)((0,Y.A)({},r[t.id]),{},{role:e.target.value})})),className:"px-2 py-1 border border-gray-300 rounded-md text-sm",children:[(0,kt.jsx)("option",{value:"OFFICE",children:"Office"}),(0,kt.jsx)("option",{value:"ADMINISTRATION",children:"Administration"}),(0,kt.jsx)("option",{value:"PROJECT_MANAGER",children:"Project Manager"}),(0,kt.jsx)("option",{value:"FIELD_DIRECTOR",children:"Field Director"}),(0,kt.jsx)("option",{value:"ROOF_SUPERVISOR",children:"Roof Supervisor"}),(0,kt.jsx)("option",{value:"OFFICE_STAFF",children:"Office Staff"})]}),(0,kt.jsx)("button",{type:"submit",disabled:null===(a=I[t.id])||void 0===a?void 0:a.saving,className:"px-2 py-1 text-xs text-white bg-[var(--color-success-green)] rounded-md disabled:opacity-50",children:null!==(s=I[t.id])&&void 0!==s&&s.saving?"Saving...":"Save"})]}),(0,kt.jsx)("div",{className:"mt-2",children:(0,kt.jsxs)("label",{className:"flex items-center text-xs",children:[(0,kt.jsx)("input",{type:"checkbox",checked:(null===(o=I[t.id])||void 0===o?void 0:o.addToAllWorkflows)||!1,onChange:e=>T(r=>(0,Y.A)((0,Y.A)({},r),{},{[t.id]:(0,Y.A)((0,Y.A)({},r[t.id]),{},{addToAllWorkflows:e.target.checked})})),className:"mr-1 h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,kt.jsx)("span",{className:"text-xs text-gray-600",children:"Add to all workflows permanently"})]})})]})]})]})]},t.id)})]})]},e.id)})}),!1,te&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,kt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Section"}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),se)if(ne.sectionName.trim()){le(!0);try{const e={phaseId:se.id,sectionName:ne.sectionName.trim(),displayName:ne.displayName.trim()||ne.sectionName.trim(),description:ne.description.trim()?ne.description.trim():void 0};console.log("\ud83d\udd0d CREATE SECTION: Sending request data:",e);const t=await Da.default.post("/workflows/sections",e);if(t.data.success){const e=await Da.default.get("/workflow-data/project-workflows/".concat(g));e.data.success&&D(e.data.data),ae({sectionName:"",displayName:"",description:""}),oe(null),re(!1),console.log("\u2705 Section created successfully:",t.data.data)}}catch(t){console.error("\u274c Error creating section:",t),alert("Failed to create section. Please try again.")}finally{le(!1)}}else alert("Please enter a section name.");else alert("Please select a phase for the section.")},children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phase"}),(0,kt.jsxs)("select",{value:(null===se||void 0===se?void 0:se.id)||"",onChange:e=>{const t=be.find(t=>t.id===e.target.value);oe(t)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,kt.jsx)("option",{value:"",children:"Select a phase"}),be.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.label},e.id))]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section Name *"}),(0,kt.jsx)("input",{type:"text",value:ne.sectionName,onChange:e=>ae((0,Y.A)((0,Y.A)({},ne),{},{sectionName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter section name",required:!0})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name"}),(0,kt.jsx)("input",{type:"text",value:ne.displayName,onChange:e=>ae((0,Y.A)((0,Y.A)({},ne),{},{displayName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter display name (optional)"})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,kt.jsx)("textarea",{value:ne.description,onChange:e=>ae((0,Y.A)((0,Y.A)({},ne),{},{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter description (optional)",rows:"3"})]}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{re(!1),ae({sectionName:"",displayName:"",description:""}),oe(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:ie||!se||!ne.sectionName.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-[var(--color-primary-blueprint-blue)] rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:ie?"Creating...":"Create Section"})]})]})]})})}),ce&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,kt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Line Item"}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),me)if(ue.itemName.trim()){ge(!0);try{const e={sectionId:me.id,itemName:ue.itemName.trim(),responsibleRole:(ue.responsibleRole,"PROJECT_MANAGER"),description:ue.description.trim()?ue.description.trim():void 0,estimatedMinutes:parseInt(ue.estimatedMinutes)||30,alertDays:parseInt(ue.alertDays)||1,addToAllWorkflows:ue.addToAllWorkflows};console.log("\ud83d\udd0d CREATE LINE ITEM: Sending request data:",e);const t=await Da.default.post("/workflows/line-items",e);if(t.data.success){const e=await Da.default.get("/workflow-data/project-workflows/".concat(g));e.data.success&&D(e.data.data),he({itemName:"",responsibleRole:"WORKER",description:"",estimatedMinutes:30,alertDays:1,addToAllWorkflows:!1}),pe(null),de(!1),console.log("\u2705 Line item created successfully:",t.data.data)}}catch(s){var t,r,n,a;console.error("\u274c Error creating line item:",s);const e=null===s||void 0===s||null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message,o=null===s||void 0===s||null===(n=s.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.errors;if(o&&Array.isArray(o)){const t=o[0];alert((null===t||void 0===t?void 0:t.msg)||(null===t||void 0===t?void 0:t.message)||e||"Failed to create line item.")}else alert(e||"Failed to create line item. Please try again.")}finally{ge(!1)}}else alert("Please enter an item name.");else alert("Please select a section for the line item.")},children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section"}),(0,kt.jsxs)("select",{value:(null===me||void 0===me?void 0:me.id)||"",onChange:e=>{let t=null;for(const r of be){const n=r.items.find(t=>t.id===e.target.value);if(n){t=n;break}}pe(t)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,kt.jsx)("option",{value:"",children:"Select a section"}),be.map(e=>(0,kt.jsx)("optgroup",{label:e.label,children:e.items.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.label},e.id))},e.id))]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Name *"}),(0,kt.jsx)("input",{type:"text",value:ue.itemName,onChange:e=>he((0,Y.A)((0,Y.A)({},ue),{},{itemName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter item name",required:!0})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Responsible Role *"}),(0,kt.jsxs)("select",{value:ue.responsibleRole,onChange:e=>he((0,Y.A)((0,Y.A)({},ue),{},{responsibleRole:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,kt.jsx)("option",{value:"OFFICE",children:"Office"}),(0,kt.jsx)("option",{value:"ADMINISTRATION",children:"Administration"}),(0,kt.jsx)("option",{value:"PROJECT_MANAGER",children:"Project Manager"}),(0,kt.jsx)("option",{value:"FIELD_DIRECTOR",children:"Field Director"}),(0,kt.jsx)("option",{value:"ROOF_SUPERVISOR",children:"Roof Supervisor"}),(0,kt.jsx)("option",{value:"OFFICE_STAFF",children:"Office Staff"})]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,kt.jsx)("textarea",{value:ue.description,onChange:e=>he((0,Y.A)((0,Y.A)({},ue),{},{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter description (optional)",rows:"3"})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Minutes"}),(0,kt.jsx)("input",{type:"number",value:ue.estimatedMinutes,onChange:e=>he((0,Y.A)((0,Y.A)({},ue),{},{estimatedMinutes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"30",min:"1"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alert Days"}),(0,kt.jsx)("input",{type:"number",value:ue.alertDays,onChange:e=>he((0,Y.A)((0,Y.A)({},ue),{},{alertDays:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1",min:"1"})]})]}),(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",checked:ue.addToAllWorkflows,onChange:e=>he(t=>(0,Y.A)((0,Y.A)({},t),{},{addToAllWorkflows:e.target.checked})),className:"mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Add this line item to every workflow permanently"})]}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"When checked, this line item will be added to all existing and future workflows of the same type"})]}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{de(!1),he({itemName:"",responsibleRole:"WORKER",description:"",estimatedMinutes:30,alertDays:1,addToAllWorkflows:!1}),pe(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:fe||!me||!ue.itemName.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-[var(--color-success-green)] rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:fe?"Creating...":"Create Line Item"})]})]})]})})})]}):(0,kt.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,kt.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,kt.jsx)("div",{className:"text-yellow-600 font-semibold",children:"No Workflow Data Found"}),(0,kt.jsx)("div",{className:"text-yellow-500 text-sm mt-1",children:"Unable to load workflow structure from database."})]})}):(0,kt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,kt.jsx)("div",{className:"text-gray-500",children:"No project selected"})})},il=e=>{let{colorMode:t,onProjectSelect:r,navigate:n}=e;const[a,s]=(0,o.useState)({key:"archivedAt",direction:"desc"}),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)("all"),[u,h]=(0,o.useState)("all"),[m]=(0,o.useState)(!0),[p,f]=(0,o.useState)([]),[g,v]=(0,o.useState)(!1),[x,b]=(0,o.useState)("");(0,o.useEffect)(()=>{y()},[]);const y=async()=>{try{v(!0),b("");const e=await Da.projectsService.getArchived({limit:100});f(e.data||[])}catch(XI){var e,t;b((null===(e=XI.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to load archived projects")}finally{v(!1)}},w=(0,o.useMemo)(()=>{let e=p;return i&&(e=e.filter(e=>{var t,r,n,a;return(null===(t=e.projectName)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null===(r=e.customer)||void 0===r||null===(n=r.name)||void 0===n?void 0:n.toLowerCase().includes(i.toLowerCase()))||(null===(a=e.address)||void 0===a?void 0:a.toLowerCase().includes(i.toLowerCase()))})),"all"!==c&&(e=e.filter(e=>new Date(e.archivedAt||e.endDate).getFullYear().toString()===c)),"all"!==u&&(e=e.filter(e=>e.projectType===u)),e.sort((e,t)=>{var r,n,s,o;let i,l;switch(a.key){case"projectName":i=(e.projectName||"").toLowerCase(),l=(t.projectName||"").toLowerCase();break;case"customer":i=((null===(r=e.customer)||void 0===r?void 0:r.name)||"").toLowerCase(),l=((null===(n=t.customer)||void 0===n?void 0:n.name)||"").toLowerCase();break;case"projectType":i=(e.projectType||"").toLowerCase(),l=(t.projectType||"").toLowerCase();break;case"budget":i=e.budget||0,l=t.budget||0;break;case"endDate":i=new Date(e.endDate),l=new Date(t.endDate);break;case"archivedAt":i=new Date(e.archivedAt||e.endDate),l=new Date(t.archivedAt||t.endDate);break;case"projectManager":i=((null===(s=e.projectManager)||void 0===s?void 0:s.firstName)||"").toLowerCase(),l=((null===(o=t.projectManager)||void 0===o?void 0:o.firstName)||"").toLowerCase();break;default:return 0}return i<l?"asc"===a.direction?-1:1:i>l?"asc"===a.direction?1:-1:0}),e},[p,i,c,u,a]),j=(0,o.useMemo)(()=>[...new Set((p||[]).map(e=>new Date(e.archivedAt||e.endDate).getFullYear().toString()))].sort((e,t)=>t-e),[p]),N=(0,o.useMemo)(()=>[...new Set((p||[]).map(e=>e.projectType))].filter(Boolean),[p]),S=e=>{let{children:t,sortKey:r,className:n=""}=e;return(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ".concat(n),onClick:()=>{return e=r,void s(t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"}));var e},children:(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[t,a.key===r&&(0,kt.jsx)("span",{className:"text-blue-600",children:"asc"===a.direction?"\u2191":"\u2193"})]})})};return g?(0,kt.jsx)("div",{className:"animate-fade-in w-full max-w-full",children:(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:"Loading archived projects..."})]})}):(0,kt.jsxs)("div",{className:"animate-fade-in w-full max-w-full",children:[(0,kt.jsxs)("div",{className:"mb-6 flex items-start justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h1",{className:"text-lg font-bold ".concat(t?"text-white":"text-gray-800"),children:["Archived Projects (",p.length,")"]}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:"Projects that have been archived and moved out of active management"})]}),(0,kt.jsxs)("button",{onClick:()=>n&&n("Email History"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border transition-all duration-200 ".concat(t?"bg-[#1e293b] border-[#3b82f6]/30 text-white hover:bg-[#232b4d] hover:border-[#3b82f6]/50":"bg-white border-gray-300 text-gray-800 hover:bg-gray-50 hover:border-blue-500"),children:[(0,kt.jsx)(Nn,{className:"w-5 h-5"}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:"Email History"})]})]}),x&&(0,kt.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:x}),(0,kt.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat(t?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Search Projects"}),(0,kt.jsx)("input",{type:"text",value:i,onChange:e=>l(e.target.value),placeholder:"Search by name, client, or address...",className:"w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(t?"bg-[#232b4d] border-[#3b82f6]/30 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Archive Year"}),(0,kt.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(t?"bg-[#232b4d] border-[#3b82f6]/30 text-white":"bg-white border-gray-300 text-gray-900"),children:[(0,kt.jsx)("option",{value:"all",children:"All Years"}),j.map(e=>(0,kt.jsx)("option",{value:e,children:e},e))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Project Type"}),(0,kt.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(t?"bg-[#232b4d] border-[#3b82f6]/30 text-white":"bg-white border-gray-300 text-gray-900"),children:[(0,kt.jsx)("option",{value:"all",children:"All Types"}),N.map(e=>(0,kt.jsx)("option",{value:e,children:e},e))]})]}),(0,kt.jsx)("div",{className:"flex items-end",children:(0,kt.jsxs)("div",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:[w.length," of ",p.length," projects"]})})]})}),(0,kt.jsx)("div",{className:"shadow-[0_2px_8px_rgba(0,0,0,0.1)] rounded-[8px] overflow-hidden ".concat(t?"bg-[#232b4d]/80":"bg-white"),children:m&&(0,kt.jsx)("div",{className:"overflow-x-auto",children:w.length>0?(0,kt.jsxs)("table",{className:"w-full divide-y divide-gray-200 dark:divide-gray-700",role:"table",children:[(0,kt.jsx)("thead",{className:"".concat(t?"bg-[#1e293b]":"bg-gray-50"),children:(0,kt.jsxs)("tr",{role:"row",children:[(0,kt.jsx)(S,{sortKey:"projectName",className:t?"text-gray-200":"text-gray-700",children:"Project Name"}),(0,kt.jsx)(S,{sortKey:"customer",className:t?"text-gray-200":"text-gray-700",children:"Customer"}),(0,kt.jsx)(S,{sortKey:"projectType",className:t?"text-gray-200":"text-gray-700",children:"Type"}),(0,kt.jsx)(S,{sortKey:"budget",className:t?"text-gray-200":"text-gray-700",children:"Budget"}),(0,kt.jsx)(S,{sortKey:"archivedAt",className:t?"text-gray-200":"text-gray-700",children:"Archived Date"}),(0,kt.jsx)(S,{sortKey:"projectManager",className:t?"text-gray-200":"text-gray-700",children:"Project Manager"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase tracking-wider ".concat(t?"text-gray-200":"text-gray-700"),children:"Actions"})]})}),(0,kt.jsx)("tbody",{className:"divide-y ".concat(t?"bg-[#1e293b] divide-[#3b82f6]/40":"bg-white divide-gray-200"),children:w.map((e,n)=>{var a,s,o,i,l,c;const d=(e=>{const t=new Date(e.archivedAt),r=new Date;return Math.floor((r-t)/864e5)<=30?{text:"Recently Archived",color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"}:{text:"Archived",color:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}})(e);return(0,kt.jsxs)("tr",{className:"\n                                                    ".concat(n%2===0?t?"bg-[#1e293b]":"bg-white":t?"bg-[#232b4d]":"bg-gray-50","\n                                                    hover:bg-blue-50 dark:hover:bg-gray-700 hover:shadow-sm transition-all duration-200 cursor-pointer\n                                                "),role:"row",onClick:()=>r&&r(e,"Project Workflow",null,"Archived Projects"),children:[(0,kt.jsx)("td",{className:"px-3 py-3 text-sm font-semibold ".concat(t?"text-white":"text-gray-900"),role:"cell",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r ".concat((e.projectType,"bg-[#F8FAFC]")," rounded-lg flex items-center justify-center text-white font-bold text-xs"),children:(null===(a=e.projectType)||void 0===a||null===(s=a.charAt(0))||void 0===s?void 0:s.toUpperCase())||"P"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"truncate max-w-48",title:e.projectName,children:e.projectName}),(0,kt.jsx)("div",{className:"text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:e.address})]})]})}),(0,kt.jsxs)("td",{className:"px-3 py-3 text-sm ".concat(t?"text-white":"text-gray-900"),role:"cell",children:[(0,kt.jsx)("div",{className:"font-medium",children:(null===(o=e.customer)||void 0===o?void 0:o.name)||"Unknown"}),(0,kt.jsx)("div",{className:"text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:(null===(i=e.customer)||void 0===i?void 0:i.email)||"No email"})]}),(0,kt.jsx)("td",{className:"px-3 py-3",role:"cell",children:(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-50 text-gray-700 border border-gray-300 shadow-sm",children:e.projectType||"Unknown"})}),(0,kt.jsx)("td",{className:"px-3 py-3 text-sm font-semibold ".concat(t?"text-white":"text-gray-900"),role:"cell",children:(h=e.budget||0,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(h))}),(0,kt.jsx)("td",{className:"px-3 py-3",role:"cell",children:(0,kt.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,kt.jsx)("div",{className:"text-sm ".concat(t?"text-white":"text-gray-900"),children:(u=e.archivedAt,new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))}),(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ".concat(d.color),children:d.text})]})}),(0,kt.jsx)("td",{className:"px-3 py-3 text-sm ".concat(t?"text-white":"text-gray-900"),role:"cell",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-xs",children:(null===(l=e.projectManager)||void 0===l||null===(c=l.firstName)||void 0===c?void 0:c.charAt(0))||"P"}),(0,kt.jsx)("span",{className:"font-medium",children:e.projectManager?"".concat(e.projectManager.firstName," ").concat(e.projectManager.lastName):"Unknown"})]})}),(0,kt.jsx)("td",{className:"px-3 py-3",role:"cell",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),r&&r(e,"Project Workflow",null,"Archived Projects")},className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded transition-all duration-200 ".concat(t?"text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 border border-blue-400/30 hover:border-blue-400/50":"text-blue-600 hover:text-blue-700 hover:bg-blue-50 border border-blue-200 hover:border-blue-300"),children:"View"}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{try{await Da.projectsService.archive(e._id||e.id),console.log("\u2705 Project unarchived successfully"),y()}catch(XI){var t,r;console.error("\u274c Error unarchiving project:",XI),b((null===(t=XI.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"Failed to unarchive project")}})(e)},className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded transition-all duration-200 ".concat(t?"text-green-400 hover:text-green-300 hover:bg-green-900/20 border border-green-400/30 hover:border-green-400/50":"text-green-600 hover:text-green-700 hover:bg-green-50 border border-green-200 hover:border-green-300"),children:"Unarchive"})]})})]},e._id||e.id);var u,h})})]}):(0,kt.jsxs)("div",{className:"p-8 text-center",children:[(0,kt.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udce6"}),(0,kt.jsx)("h3",{className:"text-lg font-semibold mb-2 ".concat(t?"text-white":"text-gray-900"),children:"No Archived Projects Found"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:i||"all"!==c||"all"!==u?"Try adjusting your search criteria or filters.":"No projects have been archived yet. Archive projects from the main projects page to see them here."})]})})})]})},ll=e=>{var t,r,n,a,s,i,l,d,u,h,m,p;let{projects:f=[],selectedProject:g,onProjectSelect:v,onProjectNavigate:x,colorMode:b=!1,placeholder:y="Select Project"}=e;const[w,j]=(0,o.useState)(!1),[N,S]=(0,o.useState)(null),[k,A]=(0,o.useState)(""),C=(0,o.useRef)(null),[E,P]=(0,o.useState)(null),[_,I]=(0,o.useState)(null),T=e=>{console.log("\ud83d\udd0d EnhancedProjectDropdown: handleProjectSelect called with:",e),console.log("\ud83d\udd0d EnhancedProjectDropdown: Current selectedProject:",g),console.log("\ud83d\udd0d EnhancedProjectDropdown: About to call onProjectSelect"),v(e),console.log("\ud83d\udd0d EnhancedProjectDropdown: onProjectSelect called, closing dropdown"),j(!1),A("")},L=(e,t)=>{x&&x(e,t)};(0,o.useEffect)(()=>{const e=()=>{if(!C.current)return;const e=C.current.getBoundingClientRect(),t={position:"fixed",top:e.bottom+8,left:e.left,width:e.width,zIndex:3e4};P(t),I((0,Y.A)({},t))};if(w||g&&N===g.id)return e(),window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e,!0)}},[w,N,g]);const D={LEAD:{name:"Lead",color:"#EAB308",initial:"L"},PROSPECT:{name:"Prospect",color:"#F97316",initial:"P"},APPROVED:{name:"Approved",color:"#10B981",initial:"A"},EXECUTION:{name:"Execution",color:"#D946EF",initial:"E"},SECOND_SUPPLEMENT:{name:"2nd Supplement",color:"#8B5CF6",initial:"S"},COMPLETION:{name:"Completion",color:"#0EA5E9",initial:"C"}},M=e=>{const t=(e=>e?e.currentWorkflowItem&&e.currentWorkflowItem.phase?e.currentWorkflowItem.phase:e.phase?e.phase:"LEAD":"LEAD")(e);return D[t]||D.LEAD},O=e=>"F59E0B"===e.replace("#","").toUpperCase()?"#111827":"white",R=e=>{const t="w-4 h-4 cursor-pointer hover:scale-110 transition-transform duration-200";switch(e){case"workflow":return(0,kt.jsx)("svg",{className:"".concat(t," text-blue-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})});case"alerts":return(0,kt.jsx)("svg",{className:"".concat(t," text-red-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"messages":return(0,kt.jsx)("svg",{className:"".concat(t," text-green-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})});default:return null}},F=f.filter(e=>"archived"!==e.status).filter(e=>{var t;const r=(k||"").toLowerCase().trim();if(!r)return!0;const n=String(e.projectNumber||e.id||"").padStart(5,"0").toLowerCase(),a=(e.customerName||(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName||e.projectName||e.name||"").toLowerCase();return n.includes(r.replace("#",""))||a.includes(r)}).slice(0,200);return(0,kt.jsxs)("div",{className:"relative w-full",style:{zIndex:200,position:"sticky",top:0},children:[(0,kt.jsxs)("button",{onClick:()=>j(!w),className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:border-blue-500 transition-colors relative z-30 w-full",ref:C,children:[(0,kt.jsx)("span",{className:"text-sm font-medium",children:g?(0,kt.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",style:{backgroundColor:M(g).color,color:O(M(g).color)},title:"Phase: ".concat(M(g).name),children:M(g).initial}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:["#",String(g.projectNumber||g.id).padStart(5,"0")]}),(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-900 truncate flex-1",children:g.projectName||g.name}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),L(g,"Project Workflow")},title:"Go to Project Workflow",className:"p-1 hover:bg-blue-100 rounded",children:R("workflow")}),(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),L(g,"Alerts")},title:"Go to Project Alerts",className:"p-1 hover:bg-red-100 rounded",children:R("alerts")}),(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),L(g,"Messages")},title:"Go to Project Profile",className:"p-1 hover:bg-green-100 rounded",children:R("messages")})]}),(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),T(null)},title:"Clear project selection",className:"p-1 rounded hover:bg-red-100 cursor-pointer text-red-600",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,kt.jsxs)("div",{onClick:e=>{var t;e.stopPropagation(),t=g.id,S(N===t?null:t)},title:N===g.id?"Hide project details (Address, Contact, PM)":"Show project details (Address, Contact, PM)",className:"p-1 rounded hover:bg-gray-100 flex items-center gap-1 cursor-pointer",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 transition-transform",style:{transform:N===g.id?"rotate(180deg)":"rotate(0deg)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:"Details"})]})]}):(0,kt.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm bg-gray-400 text-white",title:"General Chat - No Project Context",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,kt.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"No Project Selected"}),(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:"Chat about general topics"})]})]})}),(0,kt.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform",style:{transform:w?"rotate(180deg)":"rotate(0deg)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",title:w?"Close project list":"Open project list to search and select",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g&&N===g.id&&_&&c.createPortal((0,kt.jsxs)("div",{style:_,className:"px-4 py-3 bg-[#F8FAFC] border border-gray-200 rounded-lg shadow-lg",children:[(0,kt.jsxs)("div",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide mb-2 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Project Information"]}),(0,kt.jsx)("div",{className:"mb-2",children:(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsxs)("svg",{className:"w-3 h-3 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,kt.jsx)("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide w-16",children:"Address:"}),(0,kt.jsx)("span",{className:"text-sm text-gray-800 ml-2",children:g.address||(null===(t=g.customer)||void 0===t?void 0:t.address)||"No address available"})]})}),(0,kt.jsx)("div",{className:"mb-2",children:(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,kt.jsx)("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide w-16",children:"Contact:"}),(0,kt.jsxs)("span",{className:"text-sm text-gray-800 ml-2",children:[(null===(r=g.customer)||void 0===r?void 0:r.primaryName)||(null===(n=g.client)||void 0===n?void 0:n.name)||"No name"," |",(null===(a=g.customer)||void 0===a?void 0:a.primaryPhone)||(null===(s=g.client)||void 0===s?void 0:s.phone)||" No phone"," |",(null===(i=g.customer)||void 0===i?void 0:i.primaryEmail)||(null===(l=g.client)||void 0===l?void 0:l.email)||" No email"]})]})}),(0,kt.jsx)("div",{children:(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("svg",{className:"w-3 h-3 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,kt.jsx)("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide w-16",children:"PM:"}),(0,kt.jsxs)("span",{className:"text-sm text-gray-800 ml-2",children:[(null===(d=g.projectManager)||void 0===d?void 0:d.name)||(null!==(u=g.projectManager)&&void 0!==u&&u.firstName&&null!==(h=g.projectManager)&&void 0!==h&&h.lastName?"".concat(g.projectManager.firstName," ").concat(g.projectManager.lastName):"No PM assigned")," |",(null===(m=g.projectManager)||void 0===m?void 0:m.phone)||" No phone"," |",(null===(p=g.projectManager)||void 0===p?void 0:p.email)||" No email"]})]})})]}),document.body),w&&E&&c.createPortal((0,kt.jsxs)("div",{style:E,className:"bg-white border border-gray-300 rounded-lg shadow-lg max-h-[60vh] overflow-y-auto",children:[(0,kt.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,kt.jsx)("input",{type:"text",placeholder:"Search by project number (#12345) or customer name...",value:k,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})}),(0,kt.jsxs)("div",{className:"py-1",children:[(0,kt.jsxs)("div",{onClick:()=>T(null),className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-200 bg-gray-50",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm bg-blue-500 text-white",title:"General Chat - No Project Context",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,kt.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"No Project Selected"}),(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:"Chat about general topics, company info, or workflows"})]})]}),0===F.length?(0,kt.jsx)("div",{className:"px-4 py-2 text-gray-500 text-sm",children:"No projects found"}):F.map(e=>{var t;return(0,kt.jsxs)("div",{onClick:()=>T(e),className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",style:{backgroundColor:M(e).color,color:O(M(e).color)},title:"Phase: ".concat(M(e).name),children:M(e).initial}),(0,kt.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:["#",String(e.projectNumber||e.id).padStart(5,"0")]}),(0,kt.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-gray-900 truncate",children:e.projectName||e.name}),(0,kt.jsx)("span",{className:"text-xs text-gray-500 truncate",children:e.customerName||(null===(t=e.customer)||void 0===t?void 0:t.name)||e.clientName})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,kt.jsx)("div",{onClick:t=>{t.stopPropagation(),L(e,"Project Workflow")},title:"Go to Project Workflow",className:"p-1 hover:bg-blue-100 rounded",children:R("workflow")}),(0,kt.jsx)("div",{onClick:t=>{t.stopPropagation(),L(e,"Alerts")},title:"Go to Project Alerts",className:"p-1 hover:bg-red-100 rounded",children:R("alerts")}),(0,kt.jsx)("div",{onClick:t=>{t.stopPropagation(),L(e,"Messages")},title:"Go to Project Profile",className:"p-1 hover:bg-green-100 rounded",children:R("messages")})]})]},e.id)})]})]}),document.body)]})};function cl(e){let{projectId:t=null,onTranscriptSelect:r,onClose:n}=e;const[a,s]=(0,o.useState)(!1),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)([]),[u,h]=(0,o.useState)(0),[m,p]=(0,o.useState)(!1),[f,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=!1;return async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s(!0),l("");try{var a,o;const s=new URLSearchParams;t&&s.set("projectId",t),s.set("limit","25"),s.set("offset",String(r));const i="".concat(Da.API_BASE_URL,"/voice-transcripts").concat(s.toString()?"?".concat(s.toString()):""),l=sessionStorage.getItem("authToken")||localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345",u=await fetch(i,{headers:(0,Y.A)({Accept:"application/json"},l?{Authorization:"Bearer ".concat(l)}:{})});if(!u.ok){const e=401===u.status?"Login required to view transcripts.":"Failed to load transcript history";throw new Error(e)}const m=await u.json(),f=(null===m||void 0===m||null===(a=m.data)||void 0===a?void 0:a.transcripts)||[],g=(null===m||void 0===m||null===(o=m.data)||void 0===o?void 0:o.pagination)||{hasMore:!1},v=f.map(e=>{var t,r,n;const a=e.callDate?new Date(e.callDate):e.createdAt?new Date(e.createdAt):new Date,s=(null===(t=e.project)||void 0===t?void 0:t.projectName)||(null===(r=e.project)||void 0===r?void 0:r.name)||"",o=s?"".concat(s," \u2014 ").concat(a.toLocaleString()):"Call \u2014 ".concat(a.toLocaleString());return{id:e.id,title:o,date:a.toISOString(),preview:e.executiveSummary||Array.isArray(e.fullTranscript)&&(null===(n=e.fullTranscript[0])||void 0===n?void 0:n.message)||"",raw:e}});let x=n?[...c,...v]:v;if(0===x.length)try{const e=localStorage.getItem("voiceTranscripts");if(e){const t=JSON.parse(e);Array.isArray(t)&&t.length>0&&(x=t.map(e=>({id:e.id||e.sessionId||"local_".concat(e.date||Date.now()),title:e.title||"Call \u2014 ".concat(new Date(e.date||Date.now()).toLocaleString()),date:e.date||(new Date).toISOString(),preview:e.preview||"",raw:e.raw||e})))}}catch(Pr){}x.sort((e,t)=>new Date(t.date)-new Date(e.date)),e||(d(x),h(r+v.length),p(Boolean(g.hasMore)))}catch(_t){try{let r=[];const n=localStorage.getItem("voiceTranscripts");if(n){const e=JSON.parse(n);Array.isArray(e)&&e.length>0&&(r=e.map(e=>({id:e.id||e.sessionId||"local_".concat(e.date||Date.now()),title:e.title||"Call \u2014 ".concat(new Date(e.date||Date.now()).toLocaleString()),date:e.date||(new Date).toISOString(),preview:e.preview||"",raw:e.raw||e})))}e||(r.length>0?(d(r),l(""),p(!1)):l((null===_t||void 0===_t?void 0:_t.message)||"Failed to load transcript history"))}catch(Pr){e||l((null===_t||void 0===_t?void 0:_t.message)||"Failed to load transcript history")}}finally{e||s(!1)}}(0,!1),()=>{e=!0}},[t]);const v=c.reduce((e,t)=>{const r=(e=>{const t=new Date,r=new Date(e),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(n);a.setDate(n.getDate()-1);const s=new Date(n);return s.setDate(n.getDate()-6),r>=n?"Today":r>=a&&r<n?"Yesterday":r>=s?"Last 7 Days":r.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})})(t.date);return e[r]||(e[r]=[]),e[r].push(t),e},{}),x=Object.entries(v).map(e=>{let[t,r]=e;return{label:t,arr:r.sort((e,t)=>new Date(t.date)-new Date(e.date)),newest:Math.max(...r.map(e=>new Date(e.date).getTime()))}}).sort((e,t)=>t.newest-e.newest);return(0,kt.jsxs)("div",{className:"fixed inset-0 z-[999999] flex items-center justify-center px-4",children:[(0,kt.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:n}),(0,kt.jsxs)("div",{className:"relative z-[999999] w-full max-w-lg rounded-xl shadow-2xl border bg-white",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold",children:"Transcript History"}),(0,kt.jsx)("div",{className:"text-xs text-gray-500",children:t?"Project: ".concat(t):"All Projects"})]}),(0,kt.jsx)("button",{onClick:n,className:"p-2 rounded hover:bg-gray-100",title:"Close",children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:[a&&(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:"Loading\u2026"}),i&&(0,kt.jsx)("div",{className:"text-sm text-red-600",children:i}),!a&&!i&&0===c.length&&(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:"No transcripts found."}),!a&&!i&&c.length>0&&(0,kt.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-[11px] font-semibold text-gray-500 uppercase tracking-wider mb-2",children:e.label}),(0,kt.jsx)("div",{className:"space-y-2",children:e.arr.map(e=>(0,kt.jsxs)("button",{onClick:()=>r&&r(e.raw||e),className:"w-full text-left p-3 rounded-lg border hover:bg-gray-50",children:[(0,kt.jsx)("div",{className:"text-sm font-medium",children:e.title}),(0,kt.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleString()}),e.preview&&(0,kt.jsx)("div",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:e.preview})]},e.id))})]},e.label))})]}),(0,kt.jsxs)("div",{className:"px-4 py-3 border-t flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"text-xs text-gray-500",children:[c.length," loaded"]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[m&&(0,kt.jsx)("button",{onClick:async()=>{if(!f&&m){g(!0);try{const n=new URLSearchParams;t&&n.set("projectId",t),n.set("limit","25"),n.set("offset",String(u));const a="".concat(Da.API_BASE_URL,"/voice-transcripts").concat(n.toString()?"?".concat(n.toString()):""),s=sessionStorage.getItem("authToken")||localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345",o=await fetch(a,{headers:(0,Y.A)({Accept:"application/json"},s?{Authorization:"Bearer ".concat(s)}:{})});if(o.ok){var e,r;const t=await o.json(),n=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.transcripts)||[],a=(null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r.pagination)||{hasMore:!1},s=n.map(e=>{var t,r,n;const a=e.callDate?new Date(e.callDate):e.createdAt?new Date(e.createdAt):new Date,s=(null===(t=e.project)||void 0===t?void 0:t.projectName)||(null===(r=e.project)||void 0===r?void 0:r.name)||"",o=s?"".concat(s," \u2014 ").concat(a.toLocaleString()):"Call \u2014 ".concat(a.toLocaleString());return{id:e.id,title:o,date:a.toISOString(),preview:e.executiveSummary||Array.isArray(e.fullTranscript)&&(null===(n=e.fullTranscript[0])||void 0===n?void 0:n.message)||"",raw:e}}),i=[...c,...s].sort((e,t)=>new Date(t.date)-new Date(e.date));d(i),h(u+s.length),p(Boolean(a.hasMore))}}catch(Pr){}finally{g(!1)}}},disabled:f,className:"px-3 py-1.5 rounded-md border text-sm ".concat(f?"opacity-60 cursor-not-allowed":"hover:bg-gray-50"),children:f?"Loading\u2026":"Load more"}),(0,kt.jsx)("button",{onClick:n,className:"px-3 py-1.5 rounded-md border text-sm hover:bg-gray-50",children:"Close"})]})]})]})]})}const dl=(0,o.createContext)(),ul=e=>{let{children:t}=e;const[r,n]=(0,o.useState)(null),[a,s]=(0,o.useState)(!1),[i,l]=(0,o.useState)(!0),c=(0,o.useCallback)(async()=>{try{const e=localStorage.getItem("authToken");if(!e)return l(!1),n(null),void s(!1);const t=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){const e=await t.json();n(e.user),s(!0)}else localStorage.removeItem("authToken"),localStorage.removeItem("user"),n(null),s(!1)}catch(e){console.error("Auth check failed:",e),n(null),s(!1)}finally{l(!1)}},[]),d=(0,o.useCallback)(()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("user"),n(null),s(!1)},[]);(0,o.useEffect)(()=>{c()},[c]),(0,o.useEffect)(()=>{const e=e=>{var t;console.warn("\ud83d\udd10 Session expired event received:",null===(t=e.detail)||void 0===t?void 0:t.message),d()};return window.addEventListener("auth:sessionExpired",e),()=>{window.removeEventListener("auth:sessionExpired",e)}},[d]);const u={user:r,isAuthenticated:a,isLoading:i,logout:d,updateUser:e=>{n(t=>(0,Y.A)((0,Y.A)({},t),e))},checkAuthStatus:c};return(0,kt.jsx)(dl.Provider,{value:u,children:t})};r(1298);var hl=r(2284),ml=Uint8Array,pl=Uint16Array,fl=Int32Array,gl=new ml([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vl=new ml([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xl=new ml([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bl=function(e,t){for(var r=new pl(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var a=new fl(r[30]);for(n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)a[s]=s-r[n]<<5|n;return{b:r,r:a}},yl=bl(gl,2),wl=yl.b,jl=yl.r;wl[28]=258,jl[258]=28;for(var Nl=bl(vl,0),Sl=(Nl.b,Nl.r),kl=new pl(32768),Al=0;Al<32768;++Al){var Cl=(43690&Al)>>1|(21845&Al)<<1;Cl=(61680&(Cl=(52428&Cl)>>2|(13107&Cl)<<2))>>4|(3855&Cl)<<4,kl[Al]=((65280&Cl)>>8|(255&Cl)<<8)>>1}var El=function(e,t,r){for(var n=e.length,a=0,s=new pl(t);a<n;++a)e[a]&&++s[e[a]-1];var o,i=new pl(t);for(a=1;a<t;++a)i[a]=i[a-1]+s[a-1]<<1;if(r){o=new pl(1<<t);var l=15-t;for(a=0;a<n;++a)if(e[a])for(var c=a<<4|e[a],d=t-e[a],u=i[e[a]-1]++<<d,h=u|(1<<d)-1;u<=h;++u)o[kl[u]>>l]=c}else for(o=new pl(n),a=0;a<n;++a)e[a]&&(o[a]=kl[i[e[a]-1]++]>>15-e[a]);return o},Pl=new ml(288);for(Al=0;Al<144;++Al)Pl[Al]=8;for(Al=144;Al<256;++Al)Pl[Al]=9;for(Al=256;Al<280;++Al)Pl[Al]=7;for(Al=280;Al<288;++Al)Pl[Al]=8;var _l=new ml(32);for(Al=0;Al<32;++Al)_l[Al]=5;var Il=El(Pl,9,0),Tl=El(_l,5,0),Ll=function(e){return(e+7)/8|0},Dl=function(e,t,r){return(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length),new ml(e.subarray(t,r))},Ml=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},Ol=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},Rl=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,s=r.slice();if(!a)return{t:Vl,l:0};if(1==a){var o=new ml(r[0].s+1);return o[r[0].s]=1,{t:o,l:1}}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var i=r[0],l=r[1],c=0,d=1,u=2;for(r[0]={s:-1,f:i.f+l.f,l:i,r:l};d!=a-1;)i=r[r[c].f<r[u].f?c++:u++],l=r[c!=d&&r[c].f<r[u].f?c++:u++],r[d++]={s:-1,f:i.f+l.f,l:i,r:l};var h=s[0].s;for(n=1;n<a;++n)s[n].s>h&&(h=s[n].s);var m=new pl(h+1),p=Fl(r[d-1],m,0);if(p>t){n=0;var f=0,g=p-t,v=1<<g;for(s.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});n<a;++n){var x=s[n].s;if(!(m[x]>t))break;f+=v-(1<<p-m[x]),m[x]=t}for(f>>=g;f>0;){var b=s[n].s;m[b]<t?f-=1<<t-m[b]++-1:++n}for(;n>=0&&f;--n){var y=s[n].s;m[y]==t&&(--m[y],++f)}p=t}return{t:new ml(m),l:p}},Fl=function(e,t,r){return-1==e.s?Math.max(Fl(e.l,t,r+1),Fl(e.r,t,r+1)):t[e.s]=r},Ul=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new pl(++t),n=0,a=e[0],s=1,o=function(e){r[n++]=e},i=1;i<=t;++i)if(e[i]==a&&i!=t)++s;else{if(!a&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(a),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(a);s=1,a=e[i]}return{c:r.subarray(0,n),n:t}},Bl=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},zl=function(e,t,r){var n=r.length,a=Ll(t+2);e[a]=255&n,e[a+1]=n>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var s=0;s<n;++s)e[a+s+4]=r[s];return 8*(a+4+n)},Wl=function(e,t,r,n,a,s,o,i,l,c,d){Ml(t,d++,r),++a[256];for(var u=Rl(a,15),h=u.t,m=u.l,p=Rl(s,15),f=p.t,g=p.l,v=Ul(h),x=v.c,b=v.n,y=Ul(f),w=y.c,j=y.n,N=new pl(19),S=0;S<x.length;++S)++N[31&x[S]];for(S=0;S<w.length;++S)++N[31&w[S]];for(var k=Rl(N,7),A=k.t,C=k.l,E=19;E>4&&!A[xl[E-1]];--E);var P,_,I,T,L=c+5<<3,D=Bl(a,Pl)+Bl(s,_l)+o,M=Bl(a,h)+Bl(s,f)+o+14+3*E+Bl(N,A)+2*N[16]+3*N[17]+7*N[18];if(l>=0&&L<=D&&L<=M)return zl(t,d,e.subarray(l,l+c));if(Ml(t,d,1+(M<D)),d+=2,M<D){P=El(h,m,0),_=h,I=El(f,g,0),T=f;var O=El(A,C,0);Ml(t,d,b-257),Ml(t,d+5,j-1),Ml(t,d+10,E-4),d+=14;for(S=0;S<E;++S)Ml(t,d+3*S,A[xl[S]]);d+=3*E;for(var R=[x,w],F=0;F<2;++F){var U=R[F];for(S=0;S<U.length;++S){var B=31&U[S];Ml(t,d,O[B]),d+=A[B],B>15&&(Ml(t,d,U[S]>>5&127),d+=U[S]>>12)}}}else P=Il,_=Pl,I=Tl,T=_l;for(S=0;S<i;++S){var z=n[S];if(z>255){Ol(t,d,P[(B=z>>18&31)+257]),d+=_[B+257],B>7&&(Ml(t,d,z>>23&31),d+=gl[B]);var W=31&z;Ol(t,d,I[W]),d+=T[W],W>3&&(Ol(t,d,z>>5&8191),d+=vl[W])}else Ol(t,d,P[z]),d+=_[z]}return Ol(t,d,P[256]),d+_[256]},ql=new fl([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Vl=new ml(0),Hl=function(e,t,r,n,a,s){var o=s.z||e.length,i=new ml(n+o+5*(1+Math.ceil(o/7e3))+a),l=i.subarray(n,i.length-a),c=s.l,d=7&(s.r||0);if(t){d&&(l[0]=s.r>>3);for(var u=ql[t-1],h=u>>13,m=8191&u,p=(1<<r)-1,f=s.p||new pl(32768),g=s.h||new pl(p+1),v=Math.ceil(r/3),x=2*v,b=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<x)&p},y=new fl(25e3),w=new pl(288),j=new pl(32),N=0,S=0,k=s.i||0,A=0,C=s.w||0,E=0;k+2<o;++k){var P=b(k),_=32767&k,I=g[P];if(f[_]=I,g[P]=_,C<=k){var T=o-k;if((N>7e3||A>24576)&&(T>423||!c)){d=Wl(e,l,0,y,w,j,S,A,E,k-E,d),A=N=S=0,E=k;for(var L=0;L<286;++L)w[L]=0;for(L=0;L<30;++L)j[L]=0}var D=2,M=0,O=m,R=_-I&32767;if(T>2&&P==b(k-R))for(var F=Math.min(h,T)-1,U=Math.min(32767,k),B=Math.min(258,T);R<=U&&--O&&_!=I;){if(e[k+D]==e[k+D-R]){for(var z=0;z<B&&e[k+z]==e[k+z-R];++z);if(z>D){if(D=z,M=R,z>F)break;var W=Math.min(R,z-2),q=0;for(L=0;L<W;++L){var V=k-R+L&32767,H=V-f[V]&32767;H>q&&(q=H,I=V)}}}R+=(_=I)-(I=f[_])&32767}if(M){y[A++]=268435456|jl[D]<<18|Sl[M];var G=31&jl[D],K=31&Sl[M];S+=gl[G]+vl[K],++w[257+G],++j[K],C=k+D,++N}else y[A++]=e[k],++w[e[k]]}}for(k=Math.max(k,C);k<o;++k)y[A++]=e[k],++w[e[k]];d=Wl(e,l,c,y,w,j,S,A,E,k-E,d),c||(s.r=7&d|l[d/8|0]<<3,d-=7,s.h=g,s.p=f,s.i=k,s.w=C)}else{for(k=s.w||0;k<o+c;k+=65535){var J=k+65535;J>=o&&(l[d/8|0]=c,J=o),d=zl(l,d+1,e.subarray(k,J))}s.i=o}return Dl(i,0,n+Ll(d)+a)},Gl=function(){var e=1,t=0;return{p:function(r){for(var n=e,a=t,s=0|r.length,o=0;o!=s;){for(var i=Math.min(o+2655,s);o<i;++o)a+=n+=r[o];n=(65535&n)+15*(n>>16),a=(65535&a)+15*(a>>16)}e=n,t=a},d:function(){return(255&(e%=65521))<<24|(65280&e)<<8|(255&(t%=65521))<<8|t>>8}}},Kl=function(e,t,r,n,a){if(!a&&(a={l:1},t.dictionary)){var s=t.dictionary.subarray(-32768),o=new ml(s.length+e.length);o.set(s),o.set(e,s.length),e=o,a.w=s.length}return Hl(e,null==t.level?6:t.level,null==t.mem?a.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,r,n,a)},Jl=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},Yl=function(e,t){var r=t.level,n=0==r?0:r<6?1:9==r?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var a=Gl();a.p(t.dictionary),Jl(e,2,a.d())}};function Xl(e,t){t||(t={});var r=Gl();r.p(e);var n=Kl(e,t,t.dictionary?6:2,4);return Yl(n,t),Jl(n,n.length-4,r.d()),n}var Ql="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ql.decode(Vl,{stream:!0})}catch(_t){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function Zl(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function $l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,s,o,i=[],l=!0,c=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=s.call(r)).done)&&(i.push(n.value),i.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Zl(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Zl(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ec=r(4467);function tc(e){return new TextDecoder(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8").decode(e)}const rc=new TextEncoder;const nc=(()=>{const e=new Uint8Array(4);return!((new Uint32Array(e.buffer)[0]=1)&e[0])})(),ac={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class sc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8192,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,ec.A)(this,"buffer",void 0),(0,ec.A)(this,"byteLength",void 0),(0,ec.A)(this,"byteOffset",void 0),(0,ec.A)(this,"length",void 0),(0,ec.A)(this,"offset",void 0),(0,ec.A)(this,"lastWrittenByte",void 0),(0,ec.A)(this,"littleEndian",void 0),(0,ec.A)(this,"_data",void 0),(0,ec.A)(this,"_mark",void 0),(0,ec.A)(this,"_marks",void 0);let r=!1;"number"===typeof e?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);const n=t.offset?t.offset>>>0:0,a=e.byteLength-n;let s=n;(ArrayBuffer.isView(e)||e instanceof sc)&&(e.byteLength!==e.buffer.byteLength&&(s=e.byteOffset+n),e=e.buffer),this.lastWrittenByte=r?a:0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,a),this._mark=0,this._marks=[]}available(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+=e,this}back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.available(e)){const t=2*(this.offset+e),r=new Uint8Array(t);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=t,this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.readArray(e,"uint8")}readArray(e,t){const r=ac[t].BYTES_PER_ELEMENT*e,n=this.byteOffset+this.offset,a=this.buffer.slice(n,n+r);if(this.littleEndian===nc&&"uint8"!==t&&"int8"!==t){const e=new Uint8Array(this.buffer.slice(n,n+r));e.reverse();const a=new ac[t](e.buffer);return this.offset+=r,a.reverse(),a}const s=new ac[t](a);return this.offset+=r,s}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";for(let r=0;r<e;r++)t+=this.readChar();return t}readUtf8(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return tc(this.readBytes(e))}decodeText(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";return tc(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(function(e){return rc.encode(e)}(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function oc(e){let t=e.length;for(;--t>=0;)e[t]=0}const ic=256,lc=286,cc=30,dc=15,uc=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),hc=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),mc=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),pc=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fc=new Array(576);oc(fc);const gc=new Array(60);oc(gc);const vc=new Array(512);oc(vc);const xc=new Array(256);oc(xc);const bc=new Array(29);oc(bc);const yc=new Array(cc);function wc(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let jc,Nc,Sc;function kc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}oc(yc);const Ac=e=>e<256?vc[e]:vc[256+(e>>>7)],Cc=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ec=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,Cc(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Pc=(e,t,r)=>{Ec(e,r[2*t],r[2*t+1])},_c=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},Ic=(e,t,r)=>{const n=new Array(16);let a,s,o=0;for(a=1;a<=dc;a++)o=o+r[a-1]<<1,n[a]=o;for(s=0;s<=t;s++){let t=e[2*s+1];0!==t&&(e[2*s]=_c(n[t]++,t))}},Tc=e=>{let t;for(t=0;t<lc;t++)e.dyn_ltree[2*t]=0;for(t=0;t<cc;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Lc=e=>{e.bi_valid>8?Cc(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Dc=(e,t,r,n)=>{const a=2*t,s=2*r;return e[a]<e[s]||e[a]===e[s]&&n[t]<=n[r]},Mc=(e,t,r)=>{const n=e.heap[r];let a=r<<1;for(;a<=e.heap_len&&(a<e.heap_len&&Dc(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Dc(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n},Oc=(e,t,r)=>{let n,a,s,o,i=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+i++],n+=(255&e.pending_buf[e.sym_buf+i++])<<8,a=e.pending_buf[e.sym_buf+i++],0===n?Pc(e,a,t):(s=xc[a],Pc(e,s+ic+1,t),o=uc[s],0!==o&&(a-=bc[s],Ec(e,a,o)),n--,s=Ac(n),Pc(e,s,r),o=hc[s],0!==o&&(n-=yc[s],Ec(e,n,o)))}while(i<e.sym_next);Pc(e,256,t)},Rc=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,i,l,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)0!==r[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):r[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=n[2*l+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)Mc(e,r,o);l=s;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Mc(e,r,1),i=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=i,r[2*l]=r[2*o]+r[2*i],e.depth[l]=(e.depth[o]>=e.depth[i]?e.depth[o]:e.depth[i])+1,r[2*o+1]=r[2*i+1]=l,e.heap[1]=l++,Mc(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,i=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,u,h,m,p,f=0;for(h=0;h<=dc;h++)e.bl_count[h]=0;for(r[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],h=r[2*r[2*d+1]+1]+1,h>l&&(h=l,f++),r[2*d+1]=h,d>n||(e.bl_count[h]++,m=0,d>=i&&(m=o[d-i]),p=r[2*d],e.opt_len+=p*(h+m),s&&(e.static_len+=p*(a[2*d+1]+m)));if(0!==f){do{for(h=l-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(h=l;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--c],u>n||(r[2*u+1]!==h&&(e.opt_len+=(h-r[2*u+1])*r[2*u],r[2*u+1]=h),d--)}})(e,t),Ic(r,c,e.bl_count)},Fc=(e,t,r)=>{let n,a,s=-1,o=t[1],i=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)a=o,o=t[2*(n+1)+1],++i<l&&a===o||(i<c?e.bl_tree[2*a]+=i:0!==a?(a!==s&&e.bl_tree[2*a]++,e.bl_tree[32]++):i<=10?e.bl_tree[34]++:e.bl_tree[36]++,i=0,s=a,0===o?(l=138,c=3):a===o?(l=6,c=3):(l=7,c=4))},Uc=(e,t,r)=>{let n,a,s=-1,o=t[1],i=0,l=7,c=4;for(0===o&&(l=138,c=3),n=0;n<=r;n++)if(a=o,o=t[2*(n+1)+1],!(++i<l&&a===o)){if(i<c)do{Pc(e,a,e.bl_tree)}while(0!==--i);else 0!==a?(a!==s&&(Pc(e,a,e.bl_tree),i--),Pc(e,16,e.bl_tree),Ec(e,i-3,2)):i<=10?(Pc(e,17,e.bl_tree),Ec(e,i-3,3)):(Pc(e,18,e.bl_tree),Ec(e,i-11,7));i=0,s=a,0===o?(l=138,c=3):a===o?(l=6,c=3):(l=7,c=4)}};let Bc=!1;const zc=(e,t,r,n)=>{Ec(e,0+(n?1:0),3),Lc(e),Cc(e,r),Cc(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var Wc=e=>{Bc||((()=>{let e,t,r,n,a;const s=new Array(16);for(r=0,n=0;n<28;n++)for(bc[n]=r,e=0;e<1<<uc[n];e++)xc[r++]=n;for(xc[r-1]=n,a=0,n=0;n<16;n++)for(yc[n]=a,e=0;e<1<<hc[n];e++)vc[a++]=n;for(a>>=7;n<cc;n++)for(yc[n]=a<<7,e=0;e<1<<hc[n]-7;e++)vc[256+a++]=n;for(t=0;t<=dc;t++)s[t]=0;for(e=0;e<=143;)fc[2*e+1]=8,e++,s[8]++;for(;e<=255;)fc[2*e+1]=9,e++,s[9]++;for(;e<=279;)fc[2*e+1]=7,e++,s[7]++;for(;e<=287;)fc[2*e+1]=8,e++,s[8]++;for(Ic(fc,287,s),e=0;e<cc;e++)gc[2*e+1]=5,gc[2*e]=_c(e,5);jc=new wc(fc,uc,257,lc,dc),Nc=new wc(gc,hc,0,cc,dc),Sc=new wc(new Array(0),mc,0,19,7)})(),Bc=!0),e.l_desc=new kc(e.dyn_ltree,jc),e.d_desc=new kc(e.dyn_dtree,Nc),e.bl_desc=new kc(e.bl_tree,Sc),e.bi_buf=0,e.bi_valid=0,Tc(e)},qc=(e,t,r,n)=>{let a,s,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<ic;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Rc(e,e.l_desc),Rc(e,e.d_desc),o=(e=>{let t;for(Fc(e,e.dyn_ltree,e.l_desc.max_code),Fc(e,e.dyn_dtree,e.d_desc.max_code),Rc(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*pc[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=r+5,r+4<=a&&-1!==t?zc(e,t,r,n):4===e.strategy||s===a?(Ec(e,2+(n?1:0),3),Oc(e,fc,gc)):(Ec(e,4+(n?1:0),3),((e,t,r,n)=>{let a;for(Ec(e,t-257,5),Ec(e,r-1,5),Ec(e,n-4,4),a=0;a<n;a++)Ec(e,e.bl_tree[2*pc[a]+1],3);Uc(e,e.dyn_ltree,t-1),Uc(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Oc(e,e.dyn_ltree,e.dyn_dtree)),Tc(e),n&&Lc(e)},Vc=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(xc[r]+ic+1)]++,e.dyn_dtree[2*Ac(t)]++),e.sym_next===e.sym_end),Hc=e=>{Ec(e,2,3),Pc(e,256,fc),(e=>{16===e.bi_valid?(Cc(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},Gc={_tr_init:Wc,_tr_stored_block:zc,_tr_flush_block:qc,_tr_tally:Vc,_tr_align:Hc};var Kc=(e,t,r,n)=>{let a=65535&e,s=e>>>16&65535,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{a=a+t[n++]|0,s=s+a|0}while(--o);a%=65521,s%=65521}return a|s<<16};const Jc=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Yc=(e,t,r,n)=>{const a=Jc,s=n+r;e^=-1;for(let o=n;o<s;o++)e=e>>>8^a[255&(e^t[o])];return-1^e},Xc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Qc={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Zc,_tr_stored_block:$c,_tr_flush_block:ed,_tr_tally:td,_tr_align:rd}=Gc,{Z_NO_FLUSH:nd,Z_PARTIAL_FLUSH:ad,Z_FULL_FLUSH:sd,Z_FINISH:od,Z_BLOCK:id,Z_OK:ld,Z_STREAM_END:cd,Z_STREAM_ERROR:dd,Z_DATA_ERROR:ud,Z_BUF_ERROR:hd,Z_DEFAULT_COMPRESSION:md,Z_FILTERED:pd,Z_HUFFMAN_ONLY:fd,Z_RLE:gd,Z_FIXED:vd,Z_DEFAULT_STRATEGY:xd,Z_UNKNOWN:bd,Z_DEFLATED:yd}=Qc,wd=258,jd=262,Nd=42,Sd=113,kd=666,Ad=(e,t)=>(e.msg=Xc[t],t),Cd=e=>2*e-(e>4?9:0),Ed=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Pd=e=>{let t,r,n,a=e.w_size;t=e.hash_size,n=t;do{r=e.head[--n],e.head[n]=r>=a?r-a:0}while(--t);t=a,n=t;do{r=e.prev[--n],e.prev[n]=r>=a?r-a:0}while(--t)};let _d=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Id=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},Td=(e,t)=>{ed(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Id(e.strm)},Ld=(e,t)=>{e.pending_buf[e.pending++]=t},Dd=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Md=(e,t,r,n)=>{let a=e.avail_in;return a>n&&(a=n),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),r),1===e.state.wrap?e.adler=Kc(e.adler,t,a,r):2===e.state.wrap&&(e.adler=Yc(e.adler,t,a,r)),e.next_in+=a,e.total_in+=a,a)},Od=(e,t)=>{let r,n,a=e.max_chain_length,s=e.strstart,o=e.prev_length,i=e.nice_match;const l=e.strstart>e.w_size-jd?e.strstart-(e.w_size-jd):0,c=e.window,d=e.w_mask,u=e.prev,h=e.strstart+wd;let m=c[s+o-1],p=c[s+o];e.prev_length>=e.good_match&&(a>>=2),i>e.lookahead&&(i=e.lookahead);do{if(r=t,c[r+o]===p&&c[r+o-1]===m&&c[r]===c[s]&&c[++r]===c[s+1]){s+=2,r++;do{}while(c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&s<h);if(n=wd-(h-s),s=h-wd,n>o){if(e.match_start=t,o=n,n>=i)break;m=c[s+o-1],p=c[s+o]}}}while((t=u[t&d])>l&&0!==--a);return o<=e.lookahead?o:e.lookahead},Rd=e=>{const t=e.w_size;let r,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-jd)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Pd(e),n+=t),0===e.strm.avail_in)break;if(r=Md(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=_d(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=_d(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<jd&&0!==e.strm.avail_in)},Fd=(e,t)=>{let r,n,a,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,i=e.strm.avail_in;do{if(r=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>a&&(r=a),r<s&&(0===r&&t!==od||t===nd||r!==n+e.strm.avail_in))break;o=t===od&&r===n+e.strm.avail_in?1:0,$c(e,0,0,o),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Id(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(Md(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===o);return i-=e.strm.avail_in,i&&(i>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=i&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-i,e.strm.next_in),e.strstart),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==nd&&t!==od&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(Md(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,s=a>e.w_size?e.w_size:a,n=e.strstart-e.block_start,(n>=s||(n||t===od)&&t!==nd&&0===e.strm.avail_in&&n<=a)&&(r=n>a?a:n,o=t===od&&0===e.strm.avail_in&&r===n?1:0,$c(e,e.block_start,r,o),e.block_start+=r,Id(e.strm)),o?3:1)},Ud=(e,t)=>{let r,n;for(;;){if(e.lookahead<jd){if(Rd(e),e.lookahead<jd&&t===nd)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=_d(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-jd&&(e.match_length=Od(e,r)),e.match_length>=3)if(n=td(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=_d(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=_d(e,e.ins_h,e.window[e.strstart+1]);else n=td(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Td(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===od?(Td(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Td(e,!1),0===e.strm.avail_out)?1:2},Bd=(e,t)=>{let r,n,a;for(;;){if(e.lookahead<jd){if(Rd(e),e.lookahead<jd&&t===nd)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=_d(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-jd&&(e.match_length=Od(e,r),e.match_length<=5&&(e.strategy===pd||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,n=td(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=_d(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(Td(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=td(e,0,e.window[e.strstart-1]),n&&Td(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=td(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===od?(Td(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Td(e,!1),0===e.strm.avail_out)?1:2};function zd(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}const Wd=[new zd(0,0,0,0,Fd),new zd(4,4,8,4,Ud),new zd(4,5,16,8,Ud),new zd(4,6,32,32,Ud),new zd(4,4,16,16,Bd),new zd(8,16,32,32,Bd),new zd(8,16,128,128,Bd),new zd(8,32,128,256,Bd),new zd(32,128,258,1024,Bd),new zd(32,258,258,4096,Bd)];function qd(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=yd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ed(this.dyn_ltree),Ed(this.dyn_dtree),Ed(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ed(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ed(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Vd=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Nd&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Sd&&t.status!==kd?1:0},Hd=e=>{if(Vd(e))return Ad(e,dd);e.total_in=e.total_out=0,e.data_type=bd;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Nd:Sd,e.adler=2===t.wrap?0:1,t.last_flush=-2,Zc(t),ld},Gd=e=>{const t=Hd(e);return t===ld&&(e=>{e.window_size=2*e.w_size,Ed(e.head),e.max_lazy_match=Wd[e.level].max_lazy,e.good_match=Wd[e.level].good_length,e.nice_match=Wd[e.level].nice_length,e.max_chain_length=Wd[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},Kd=(e,t,r,n,a,s)=>{if(!e)return dd;let o=1;if(t===md&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>9||r!==yd||n<8||n>15||t<0||t>9||s<0||s>vd||8===n&&1!==o)return Ad(e,dd);8===n&&(n=9);const i=new qd;return e.state=i,i.strm=e,i.status=Nd,i.wrap=o,i.gzhead=null,i.w_bits=n,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=a+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<a+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.sym_buf=i.lit_bufsize,i.sym_end=3*(i.lit_bufsize-1),i.level=t,i.strategy=s,i.method=r,Gd(e)};var Jd=(e,t)=>{if(Vd(e)||t>id||t<0)return e?Ad(e,dd):dd;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===kd&&t!==od)return Ad(e,0===e.avail_out?hd:dd);const n=r.last_flush;if(r.last_flush=t,0!==r.pending){if(Id(e),0===e.avail_out)return r.last_flush=-1,ld}else if(0===e.avail_in&&Cd(t)<=Cd(n)&&t!==od)return Ad(e,hd);if(r.status===kd&&0!==e.avail_in)return Ad(e,hd);if(r.status===Nd&&0===r.wrap&&(r.status=Sd),r.status===Nd){let t=yd+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=fd||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=n<<6,0!==r.strstart&&(t|=32),t+=31-t%31,Dd(r,t),0!==r.strstart&&(Dd(r,e.adler>>>16),Dd(r,65535&e.adler)),e.adler=1,r.status=Sd,Id(e),0!==r.pending)return r.last_flush=-1,ld}if(57===r.status)if(e.adler=0,Ld(r,31),Ld(r,139),Ld(r,8),r.gzhead)Ld(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Ld(r,255&r.gzhead.time),Ld(r,r.gzhead.time>>8&255),Ld(r,r.gzhead.time>>16&255),Ld(r,r.gzhead.time>>24&255),Ld(r,9===r.level?2:r.strategy>=fd||r.level<2?4:0),Ld(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Ld(r,255&r.gzhead.extra.length),Ld(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Yc(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Ld(r,0),Ld(r,0),Ld(r,0),Ld(r,0),Ld(r,0),Ld(r,9===r.level?2:r.strategy>=fd||r.level<2?4:0),Ld(r,3),r.status=Sd,Id(e),0!==r.pending)return r.last_flush=-1,ld;if(69===r.status){if(r.gzhead.extra){let t=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let a=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+a),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=Yc(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=a,Id(e),0!==r.pending)return r.last_flush=-1,ld;t=0,n-=a}let a=new Uint8Array(r.gzhead.extra);r.pending_buf.set(a.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>t&&(e.adler=Yc(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=Yc(e.adler,r.pending_buf,r.pending-n,n)),Id(e),0!==r.pending)return r.last_flush=-1,ld;n=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Ld(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=Yc(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=Yc(e.adler,r.pending_buf,r.pending-n,n)),Id(e),0!==r.pending)return r.last_flush=-1,ld;n=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Ld(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=Yc(e.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Id(e),0!==r.pending))return r.last_flush=-1,ld;Ld(r,255&e.adler),Ld(r,e.adler>>8&255),e.adler=0}if(r.status=Sd,Id(e),0!==r.pending)return r.last_flush=-1,ld}if(0!==e.avail_in||0!==r.lookahead||t!==nd&&r.status!==kd){let n=0===r.level?Fd(r,t):r.strategy===fd?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(Rd(e),0===e.lookahead)){if(t===nd)return 1;break}if(e.match_length=0,r=td(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Td(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===od?(Td(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Td(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===gd?((e,t)=>{let r,n,a,s;const o=e.window;for(;;){if(e.lookahead<=wd){if(Rd(e),e.lookahead<=wd&&t===nd)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,n=o[a],n===o[++a]&&n===o[++a]&&n===o[++a])){s=e.strstart+wd;do{}while(n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&a<s);e.match_length=wd-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=td(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=td(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Td(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===od?(Td(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Td(e,!1),0===e.strm.avail_out)?1:2})(r,t):Wd[r.level].func(r,t);if(3!==n&&4!==n||(r.status=kd),1===n||3===n)return 0===e.avail_out&&(r.last_flush=-1),ld;if(2===n&&(t===ad?rd(r):t!==id&&($c(r,0,0,!1),t===sd&&(Ed(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Id(e),0===e.avail_out))return r.last_flush=-1,ld}return t!==od?ld:r.wrap<=0?cd:(2===r.wrap?(Ld(r,255&e.adler),Ld(r,e.adler>>8&255),Ld(r,e.adler>>16&255),Ld(r,e.adler>>24&255),Ld(r,255&e.total_in),Ld(r,e.total_in>>8&255),Ld(r,e.total_in>>16&255),Ld(r,e.total_in>>24&255)):(Dd(r,e.adler>>>16),Dd(r,65535&e.adler)),Id(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?ld:cd)},Yd=(e,t)=>{let r=t.length;if(Vd(e))return dd;const n=e.state,a=n.wrap;if(2===a||1===a&&n.status!==Nd||n.lookahead)return dd;if(1===a&&(e.adler=Kc(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===a&&(Ed(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(r-n.w_size,r),0),t=e,r=n.w_size}const s=e.avail_in,o=e.next_in,i=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Rd(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=_d(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,Rd(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=o,e.input=i,e.avail_in=s,n.wrap=a,ld},Xd={deflateInit:(e,t)=>Kd(e,t,yd,15,8,xd),deflateInit2:Kd,deflateReset:Gd,deflateResetKeep:Hd,deflateSetHeader:(e,t)=>Vd(e)||2!==e.state.wrap?dd:(e.state.gzhead=t,ld),deflate:Jd,deflateEnd:e=>{if(Vd(e))return dd;const t=e.state.status;return e.state=null,t===Sd?Ad(e,ud):ld},deflateSetDictionary:Yd,deflateInfo:"pako deflate (from Nodeca project)"};const Qd=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Zd=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!==typeof r)throw new TypeError(r+"must be non-object");for(const t in r)Qd(r,t)&&(e[t]=r[t])}}return e},$d=e=>{let t=0;for(let n=0,a=e.length;n<a;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,a=0,s=e.length;n<s;n++){let t=e[n];r.set(t,a),a+=t.length}return r};let eu=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(QI){eu=!1}const tu=new Uint8Array(256);for(let ZI=0;ZI<256;ZI++)tu[ZI]=ZI>=252?6:ZI>=248?5:ZI>=240?4:ZI>=224?3:ZI>=192?2:1;tu[254]=tu[254]=1;var ru=e=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,n,a,s,o=e.length,i=0;for(a=0;a<o;a++)r=e.charCodeAt(a),55296===(64512&r)&&a+1<o&&(n=e.charCodeAt(a+1),56320===(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),a++)),i+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(i),s=0,a=0;s<i;a++)r=e.charCodeAt(a),55296===(64512&r)&&a+1<o&&(n=e.charCodeAt(a+1),56320===(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),a++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|63&r):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|63&r):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|63&r);return t},nu=(e,t)=>{const r=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,a;const s=new Array(2*r);for(a=0,n=0;n<r;){let t=e[n++];if(t<128){s[a++]=t;continue}let o=tu[t];if(o>4)s[a++]=65533,n+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&n<r;)t=t<<6|63&e[n++],o--;o>1?s[a++]=65533:t<65536?s[a++]=t:(t-=65536,s[a++]=55296|t>>10&1023,s[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&eu)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r})(s,a)},au=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128===(192&e[r]);)r--;return r<0||0===r?t:r+tu[e[r]]>t?r:t};var su=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ou=Object.prototype.toString,{Z_NO_FLUSH:iu,Z_SYNC_FLUSH:lu,Z_FULL_FLUSH:cu,Z_FINISH:du,Z_OK:uu,Z_STREAM_END:hu,Z_DEFAULT_COMPRESSION:mu,Z_DEFAULT_STRATEGY:pu,Z_DEFLATED:fu}=Qc;function gu(e){this.options=Zd({level:mu,method:fu,chunkSize:16384,windowBits:15,memLevel:8,strategy:pu},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new su,this.strm.avail_out=0;let r=Xd.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==uu)throw new Error(Xc[r]);if(t.header&&Xd.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"===typeof t.dictionary?ru(t.dictionary):"[object ArrayBuffer]"===ou.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=Xd.deflateSetDictionary(this.strm,e),r!==uu)throw new Error(Xc[r]);this._dict_set=!0}}function vu(e,t){const r=new gu(t);if(r.push(e,!0),r.err)throw r.msg||Xc[r.err];return r.result}gu.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let a,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?du:iu,"string"===typeof e?r.input=ru(e):"[object ArrayBuffer]"===ou.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===lu||s===cu)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(a=Xd.deflate(r,s),a===hu)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=Xd.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===uu;if(0!==r.avail_out){if(s>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},gu.prototype.onData=function(e){this.chunks.push(e)},gu.prototype.onEnd=function(e){e===uu&&(this.result=$d(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var xu={Deflate:gu,deflate:vu,deflateRaw:function(e,t){return(t=t||{}).raw=!0,vu(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,vu(e,t)},constants:Qc};const bu=16209;var yu=function(e,t){let r,n,a,s,o,i,l,c,d,u,h,m,p,f,g,v,x,b,y,w,j,N,S,k;const A=e.state;r=e.next_in,S=e.input,n=r+(e.avail_in-5),a=e.next_out,k=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),i=A.dmax,l=A.wsize,c=A.whave,d=A.wnext,u=A.window,h=A.hold,m=A.bits,p=A.lencode,f=A.distcode,g=(1<<A.lenbits)-1,v=(1<<A.distbits)-1;e:do{m<15&&(h+=S[r++]<<m,m+=8,h+=S[r++]<<m,m+=8),x=p[h&g];t:for(;;){if(b=x>>>24,h>>>=b,m-=b,b=x>>>16&255,0===b)k[a++]=65535&x;else{if(!(16&b)){if(0===(64&b)){x=p[(65535&x)+(h&(1<<b)-1)];continue t}if(32&b){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=bu;break e}y=65535&x,b&=15,b&&(m<b&&(h+=S[r++]<<m,m+=8),y+=h&(1<<b)-1,h>>>=b,m-=b),m<15&&(h+=S[r++]<<m,m+=8,h+=S[r++]<<m,m+=8),x=f[h&v];r:for(;;){if(b=x>>>24,h>>>=b,m-=b,b=x>>>16&255,!(16&b)){if(0===(64&b)){x=f[(65535&x)+(h&(1<<b)-1)];continue r}e.msg="invalid distance code",A.mode=bu;break e}if(w=65535&x,b&=15,m<b&&(h+=S[r++]<<m,m+=8,m<b&&(h+=S[r++]<<m,m+=8)),w+=h&(1<<b)-1,w>i){e.msg="invalid distance too far back",A.mode=bu;break e}if(h>>>=b,m-=b,b=a-s,w>b){if(b=w-b,b>c&&A.sane){e.msg="invalid distance too far back",A.mode=bu;break e}if(j=0,N=u,0===d){if(j+=l-b,b<y){y-=b;do{k[a++]=u[j++]}while(--b);j=a-w,N=k}}else if(d<b){if(j+=l+d-b,b-=d,b<y){y-=b;do{k[a++]=u[j++]}while(--b);if(j=0,d<y){b=d,y-=b;do{k[a++]=u[j++]}while(--b);j=a-w,N=k}}}else if(j+=d-b,b<y){y-=b;do{k[a++]=u[j++]}while(--b);j=a-w,N=k}for(;y>2;)k[a++]=N[j++],k[a++]=N[j++],k[a++]=N[j++],y-=3;y&&(k[a++]=N[j++],y>1&&(k[a++]=N[j++]))}else{j=a-w;do{k[a++]=k[j++],k[a++]=k[j++],k[a++]=k[j++],y-=3}while(y>2);y&&(k[a++]=k[j++],y>1&&(k[a++]=k[j++]))}break}}break}}while(r<n&&a<o);y=m>>3,r-=y,m-=y<<3,h&=(1<<m)-1,e.next_in=r,e.next_out=a,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=a<o?o-a+257:257-(a-o),A.hold=h,A.bits=m};const wu=15,ju=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Nu=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Su=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ku=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Au=(e,t,r,n,a,s,o,i)=>{const l=i.bits;let c,d,u,h,m,p,f=0,g=0,v=0,x=0,b=0,y=0,w=0,j=0,N=0,S=0,k=null;const A=new Uint16Array(16),C=new Uint16Array(16);let E,P,_,I=null;for(f=0;f<=wu;f++)A[f]=0;for(g=0;g<n;g++)A[t[r+g]]++;for(b=l,x=wu;x>=1&&0===A[x];x--);if(b>x&&(b=x),0===x)return a[s++]=20971520,a[s++]=20971520,i.bits=1,0;for(v=1;v<x&&0===A[v];v++);for(b<v&&(b=v),j=1,f=1;f<=wu;f++)if(j<<=1,j-=A[f],j<0)return-1;if(j>0&&(0===e||1!==x))return-1;for(C[1]=0,f=1;f<wu;f++)C[f+1]=C[f]+A[f];for(g=0;g<n;g++)0!==t[r+g]&&(o[C[t[r+g]]++]=g);if(0===e?(k=I=o,p=20):1===e?(k=ju,I=Nu,p=257):(k=Su,I=ku,p=0),S=0,g=0,f=v,m=s,y=b,w=0,u=-1,N=1<<b,h=N-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){E=f-w,o[g]+1<p?(P=0,_=o[g]):o[g]>=p?(P=I[o[g]-p],_=k[o[g]-p]):(P=96,_=0),c=1<<f-w,d=1<<y,v=d;do{d-=c,a[m+(S>>w)+d]=E<<24|P<<16|_}while(0!==d);for(c=1<<f-1;S&c;)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,g++,0===--A[f]){if(f===x)break;f=t[r+o[g]]}if(f>b&&(S&h)!==u){for(0===w&&(w=b),m+=v,y=f-w,j=1<<y;y+w<x&&(j-=A[y+w],!(j<=0));)y++,j<<=1;if(N+=1<<y,1===e&&N>852||2===e&&N>592)return 1;u=S&h,a[u]=b<<24|y<<16|m-s}}return 0!==S&&(a[m+S]=f-w<<24|64<<16),i.bits=b,0};const{Z_FINISH:Cu,Z_BLOCK:Eu,Z_TREES:Pu,Z_OK:_u,Z_STREAM_END:Iu,Z_NEED_DICT:Tu,Z_STREAM_ERROR:Lu,Z_DATA_ERROR:Du,Z_MEM_ERROR:Mu,Z_BUF_ERROR:Ou,Z_DEFLATED:Ru}=Qc,Fu=16180,Uu=16190,Bu=16191,zu=16192,Wu=16194,qu=16199,Vu=16200,Hu=16206,Gu=16209,Ku=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ju(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Yu=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Fu||t.mode>16211?1:0},Xu=e=>{if(Yu(e))return Lu;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Fu,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,_u},Qu=e=>{if(Yu(e))return Lu;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Xu(e)},Zu=(e,t)=>{let r;if(Yu(e))return Lu;const n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Lu:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,Qu(e))},$u=(e,t)=>{if(!e)return Lu;const r=new Ju;e.state=r,r.strm=e,r.window=null,r.mode=Fu;const n=Zu(e,t);return n!==_u&&(e.state=null),n};let eh,th,rh=!0;const nh=e=>{if(rh){eh=new Int32Array(512),th=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Au(1,e.lens,0,288,eh,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Au(2,e.lens,0,32,th,0,e.work,{bits:5}),rh=!1}e.lencode=eh,e.lenbits=9,e.distcode=th,e.distbits=5},ah=(e,t,r,n)=>{let a;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(t.subarray(r-n,r-n+a),s.wnext),(n-=a)?(s.window.set(t.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0};var sh=(e,t)=>{let r,n,a,s,o,i,l,c,d,u,h,m,p,f,g,v,x,b,y,w,j,N,S=0;const k=new Uint8Array(4);let A,C;const E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Yu(e)||!e.output||!e.input&&0!==e.avail_in)return Lu;r=e.state,r.mode===Bu&&(r.mode=zu),o=e.next_out,a=e.output,l=e.avail_out,s=e.next_in,n=e.input,i=e.avail_in,c=r.hold,d=r.bits,u=i,h=l,N=_u;e:for(;;)switch(r.mode){case Fu:if(0===r.wrap){r.mode=zu;break}for(;d<16;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(2&r.wrap&&35615===c){0===r.wbits&&(r.wbits=15),r.check=0,k[0]=255&c,k[1]=c>>>8&255,r.check=Yc(r.check,k,2,0),c=0,d=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=Gu;break}if((15&c)!==Ru){e.msg="unknown compression method",r.mode=Gu;break}if(c>>>=4,d-=4,j=8+(15&c),0===r.wbits&&(r.wbits=j),j>15||j>r.wbits){e.msg="invalid window size",r.mode=Gu;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&c?16189:Bu,c=0,d=0;break;case 16181:for(;d<16;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(r.flags=c,(255&r.flags)!==Ru){e.msg="unknown compression method",r.mode=Gu;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=Gu;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&4&r.wrap&&(k[0]=255&c,k[1]=c>>>8&255,r.check=Yc(r.check,k,2,0)),c=0,d=0,r.mode=16182;case 16182:for(;d<32;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}r.head&&(r.head.time=c),512&r.flags&&4&r.wrap&&(k[0]=255&c,k[1]=c>>>8&255,k[2]=c>>>16&255,k[3]=c>>>24&255,r.check=Yc(r.check,k,4,0)),c=0,d=0,r.mode=16183;case 16183:for(;d<16;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&4&r.wrap&&(k[0]=255&c,k[1]=c>>>8&255,r.check=Yc(r.check,k,2,0)),c=0,d=0,r.mode=16184;case 16184:if(1024&r.flags){for(;d<16;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&4&r.wrap&&(k[0]=255&c,k[1]=c>>>8&255,r.check=Yc(r.check,k,2,0)),c=0,d=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(m=r.length,m>i&&(m=i),m&&(r.head&&(j=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+m),j)),512&r.flags&&4&r.wrap&&(r.check=Yc(r.check,n,m,s)),i-=m,s+=m,r.length-=m),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===i)break e;m=0;do{j=n[s+m++],r.head&&j&&r.length<65536&&(r.head.name+=String.fromCharCode(j))}while(j&&m<i);if(512&r.flags&&4&r.wrap&&(r.check=Yc(r.check,n,m,s)),i-=m,s+=m,j)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===i)break e;m=0;do{j=n[s+m++],r.head&&j&&r.length<65536&&(r.head.comment+=String.fromCharCode(j))}while(j&&m<i);if(512&r.flags&&4&r.wrap&&(r.check=Yc(r.check,n,m,s)),i-=m,s+=m,j)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;d<16;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(4&r.wrap&&c!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Gu;break}c=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Bu;break;case 16189:for(;d<32;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}e.adler=r.check=Ku(c),c=0,d=0,r.mode=Uu;case Uu:if(0===r.havedict)return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=i,r.hold=c,r.bits=d,Tu;e.adler=r.check=1,r.mode=Bu;case Bu:if(t===Eu||t===Pu)break e;case zu:if(r.last){c>>>=7&d,d-=7&d,r.mode=Hu;break}for(;d<3;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}switch(r.last=1&c,c>>>=1,d-=1,3&c){case 0:r.mode=16193;break;case 1:if(nh(r),r.mode=qu,t===Pu){c>>>=2,d-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Gu}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Gu;break}if(r.length=65535&c,c=0,d=0,r.mode=Wu,t===Pu)break e;case Wu:r.mode=16195;case 16195:if(m=r.length,m){if(m>i&&(m=i),m>l&&(m=l),0===m)break e;a.set(n.subarray(s,s+m),o),i-=m,s+=m,l-=m,o+=m,r.length-=m;break}r.mode=Bu;break;case 16196:for(;d<14;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(r.nlen=257+(31&c),c>>>=5,d-=5,r.ndist=1+(31&c),c>>>=5,d-=5,r.ncode=4+(15&c),c>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Gu;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;d<3;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}r.lens[E[r.have++]]=7&c,c>>>=3,d-=3}for(;r.have<19;)r.lens[E[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,A={bits:r.lenbits},N=Au(0,r.lens,0,19,r.lencode,0,r.work,A),r.lenbits=A.bits,N){e.msg="invalid code lengths set",r.mode=Gu;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;S=r.lencode[c&(1<<r.lenbits)-1],g=S>>>24,v=S>>>16&255,x=65535&S,!(g<=d);){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(x<16)c>>>=g,d-=g,r.lens[r.have++]=x;else{if(16===x){for(C=g+2;d<C;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(c>>>=g,d-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=Gu;break}j=r.lens[r.have-1],m=3+(3&c),c>>>=2,d-=2}else if(17===x){for(C=g+3;d<C;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}c>>>=g,d-=g,j=0,m=3+(7&c),c>>>=3,d-=3}else{for(C=g+7;d<C;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}c>>>=g,d-=g,j=0,m=11+(127&c),c>>>=7,d-=7}if(r.have+m>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Gu;break}for(;m--;)r.lens[r.have++]=j}}if(r.mode===Gu)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=Gu;break}if(r.lenbits=9,A={bits:r.lenbits},N=Au(1,r.lens,0,r.nlen,r.lencode,0,r.work,A),r.lenbits=A.bits,N){e.msg="invalid literal/lengths set",r.mode=Gu;break}if(r.distbits=6,r.distcode=r.distdyn,A={bits:r.distbits},N=Au(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,A),r.distbits=A.bits,N){e.msg="invalid distances set",r.mode=Gu;break}if(r.mode=qu,t===Pu)break e;case qu:r.mode=Vu;case Vu:if(i>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=i,r.hold=c,r.bits=d,yu(e,h),o=e.next_out,a=e.output,l=e.avail_out,s=e.next_in,n=e.input,i=e.avail_in,c=r.hold,d=r.bits,r.mode===Bu&&(r.back=-1);break}for(r.back=0;S=r.lencode[c&(1<<r.lenbits)-1],g=S>>>24,v=S>>>16&255,x=65535&S,!(g<=d);){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(v&&0===(240&v)){for(b=g,y=v,w=x;S=r.lencode[w+((c&(1<<b+y)-1)>>b)],g=S>>>24,v=S>>>16&255,x=65535&S,!(b+g<=d);){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}c>>>=b,d-=b,r.back+=b}if(c>>>=g,d-=g,r.back+=g,r.length=x,0===v){r.mode=16205;break}if(32&v){r.back=-1,r.mode=Bu;break}if(64&v){e.msg="invalid literal/length code",r.mode=Gu;break}r.extra=15&v,r.mode=16201;case 16201:if(r.extra){for(C=r.extra;d<C;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;S=r.distcode[c&(1<<r.distbits)-1],g=S>>>24,v=S>>>16&255,x=65535&S,!(g<=d);){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(0===(240&v)){for(b=g,y=v,w=x;S=r.distcode[w+((c&(1<<b+y)-1)>>b)],g=S>>>24,v=S>>>16&255,x=65535&S,!(b+g<=d);){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}c>>>=b,d-=b,r.back+=b}if(c>>>=g,d-=g,r.back+=g,64&v){e.msg="invalid distance code",r.mode=Gu;break}r.offset=x,r.extra=15&v,r.mode=16203;case 16203:if(r.extra){for(C=r.extra;d<C;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Gu;break}r.mode=16204;case 16204:if(0===l)break e;if(m=h-l,r.offset>m){if(m=r.offset-m,m>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Gu;break}m>r.wnext?(m-=r.wnext,p=r.wsize-m):p=r.wnext-m,m>r.length&&(m=r.length),f=r.window}else f=a,p=o-r.offset,m=r.length;m>l&&(m=l),l-=m,r.length-=m;do{a[o++]=f[p++]}while(--m);0===r.length&&(r.mode=Vu);break;case 16205:if(0===l)break e;a[o++]=r.length,l--,r.mode=Vu;break;case Hu:if(r.wrap){for(;d<32;){if(0===i)break e;i--,c|=n[s++]<<d,d+=8}if(h-=l,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=r.flags?Yc(r.check,a,h,o-h):Kc(r.check,a,h,o-h)),h=l,4&r.wrap&&(r.flags?c:Ku(c))!==r.check){e.msg="incorrect data check",r.mode=Gu;break}c=0,d=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;d<32;){if(0===i)break e;i--,c+=n[s++]<<d,d+=8}if(4&r.wrap&&c!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Gu;break}c=0,d=0}r.mode=16208;case 16208:N=Iu;break e;case Gu:N=Du;break e;case 16210:return Mu;default:return Lu}return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=i,r.hold=c,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<Gu&&(r.mode<Hu||t!==Cu))&&ah(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=r.flags?Yc(r.check,a,h,e.next_out-h):Kc(r.check,a,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Bu?128:0)+(r.mode===qu||r.mode===Wu?256:0),(0===u&&0===h||t===Cu)&&N===_u&&(N=Ou),N},oh={inflateReset:Qu,inflateReset2:Zu,inflateResetKeep:Xu,inflateInit:e=>$u(e,15),inflateInit2:$u,inflate:sh,inflateEnd:e=>{if(Yu(e))return Lu;let t=e.state;return t.window&&(t.window=null),e.state=null,_u},inflateGetHeader:(e,t)=>{if(Yu(e))return Lu;const r=e.state;return 0===(2&r.wrap)?Lu:(r.head=t,t.done=!1,_u)},inflateSetDictionary:(e,t)=>{const r=t.length;let n,a,s;return Yu(e)?Lu:(n=e.state,0!==n.wrap&&n.mode!==Uu?Lu:n.mode===Uu&&(a=1,a=Kc(a,t,r,0),a!==n.check)?Du:(s=ah(e,t,r,r),s?(n.mode=16210,Mu):(n.havedict=1,_u)))},inflateInfo:"pako inflate (from Nodeca project)"};var ih=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const lh=Object.prototype.toString,{Z_NO_FLUSH:ch,Z_FINISH:dh,Z_OK:uh,Z_STREAM_END:hh,Z_NEED_DICT:mh,Z_STREAM_ERROR:ph,Z_DATA_ERROR:fh,Z_MEM_ERROR:gh}=Qc;function vh(e){this.options=Zd({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new su,this.strm.avail_out=0;let r=oh.inflateInit2(this.strm,t.windowBits);if(r!==uh)throw new Error(Xc[r]);if(this.header=new ih,oh.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=ru(t.dictionary):"[object ArrayBuffer]"===lh.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=oh.inflateSetDictionary(this.strm,t.dictionary),r!==uh)))throw new Error(Xc[r])}function xh(e,t){const r=new vh(t);if(r.push(e),r.err)throw r.msg||Xc[r.err];return r.result}vh.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let s,o,i;if(this.ended)return!1;for(o=t===~~t?t:!0===t?dh:ch,"[object ArrayBuffer]"===lh.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=oh.inflate(r,o),s===mh&&a&&(s=oh.inflateSetDictionary(r,a),s===uh?s=oh.inflate(r,o):s===fh&&(s=mh));r.avail_in>0&&s===hh&&r.state.wrap>0&&0!==e[r.next_in];)oh.inflateReset(r),s=oh.inflate(r,o);switch(s){case ph:case fh:case mh:case gh:return this.onEnd(s),this.ended=!0,!1}if(i=r.avail_out,r.next_out&&(0===r.avail_out||s===hh))if("string"===this.options.to){let e=au(r.output,r.next_out),t=r.next_out-e,a=nu(r.output,e);r.next_out=t,r.avail_out=n-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(a)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(s!==uh||0!==i){if(s===hh)return s=oh.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},vh.prototype.onData=function(e){this.chunks.push(e)},vh.prototype.onEnd=function(e){e===uh&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=$d(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bh={Inflate:vh,inflate:xh,inflateRaw:function(e,t){return(t=t||{}).raw=!0,xh(e,t)},ungzip:xh,constants:Qc};const{Deflate:yh,deflate:wh,deflateRaw:jh,gzip:Nh}=xu,{Inflate:Sh,inflate:kh,inflateRaw:Ah,ungzip:Ch}=bh;var Eh=Sh,Ph=kh;const _h=[];for(let ZI=0;ZI<256;ZI++){let e=ZI;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;_h[ZI]=e}const Ih=4294967295;function Th(e,t){return(function(e,t,r){let n=e;for(let a=0;a<r;a++)n=_h[255&(n^t[a])]^n>>>8;return n}(Ih,e,t)^Ih)>>>0}function Lh(e,t,r){const n=e.readUint32(),a=Th(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(a!==n)throw new Error("CRC mismatch for chunk ".concat(r,". Expected ").concat(n,", found ").concat(a))}function Dh(e,t,r){for(let n=0;n<r;n++)t[n]=e[n]}function Mh(e,t,r,n){let a=0;for(;a<n;a++)t[a]=e[a];for(;a<r;a++)t[a]=e[a]+t[a-n]&255}function Oh(e,t,r,n){let a=0;if(0===r.length)for(;a<n;a++)t[a]=e[a];else for(;a<n;a++)t[a]=e[a]+r[a]&255}function Rh(e,t,r,n,a){let s=0;if(0===r.length){for(;s<a;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+(t[s-a]>>1)&255}else{for(;s<a;s++)t[s]=e[s]+(r[s]>>1)&255;for(;s<n;s++)t[s]=e[s]+(t[s-a]+r[s]>>1)&255}}function Fh(e,t,r,n,a){let s=0;if(0===r.length){for(;s<a;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+t[s-a]&255}else{for(;s<a;s++)t[s]=e[s]+r[s]&255;for(;s<n;s++)t[s]=e[s]+Uh(t[s-a],r[s],r[s-a])&255}}function Uh(e,t,r){const n=e+t-r,a=Math.abs(n-e),s=Math.abs(n-t),o=Math.abs(n-r);return a<=s&&a<=o?e:s<=o?t:r}function Bh(e,t,r,n,a,s){switch(e){case 0:Dh(t,r,a);break;case 1:Mh(t,r,a,s);break;case 2:Oh(t,r,n,a);break;case 3:Rh(t,r,n,a,s);break;case 4:Fh(t,r,n,a,s);break;default:throw new Error("Unsupported filter: ".concat(e))}}const zh=new Uint16Array([255]),Wh=255===new Uint8Array(zh.buffer)[0];function qh(e){return(255&e)<<8|e>>8&255}const Vh=new Uint16Array([255]),Hh=255===new Uint8Array(Vh.buffer)[0],Gh=new Uint8Array(0);function Kh(e){const{data:t,width:r,height:n,channels:a,depth:s}=e,o=Math.ceil(s/8)*a,i=Math.ceil(s/8*a*r),l=new Uint8Array(n*i);let c,d,u=Gh,h=0;for(let m=0;m<n;m++){switch(c=t.subarray(h+1,h+1+i),d=l.subarray(m*i,(m+1)*i),t[h]){case 0:Dh(c,d,i);break;case 1:Mh(c,d,i,o);break;case 2:Oh(c,d,u,i);break;case 3:Rh(c,d,u,i,o);break;case 4:Fh(c,d,u,i,o);break;default:throw new Error("Unsupported filter: ".concat(t[h]))}u=d,h+=i+1}if(16===s){const e=new Uint16Array(l.buffer);if(Hh)for(let t=0;t<e.length;t++)e[t]=Jh(e[t]);return e}return l}function Jh(e){return(255&e)<<8|e>>8&255}const Yh=Uint8Array.of(137,80,78,71,13,10,26,10);function Xh(e){if(!function(e){if(e.length<Yh.length)return!1;for(let t=0;t<Yh.length;t++)if(e[t]!==Yh[t])return!1;return!0}(e.readBytes(Yh.length)))throw new Error("wrong PNG signature")}const Qh="tEXt",Zh=new TextDecoder("latin1");function $h(e){if(tm(e),0===e.length||e.length>79)throw new Error("keyword length must be between 1 and 79")}const em=/^[\u0000-\u00FF]*$/;function tm(e){if(!em.test(e))throw new Error("invalid latin1 text")}function rm(e,t,r){const n=nm(t);e[n]=function(e,t){return Zh.decode(e.readBytes(t))}(t,r-n.length-1)}function nm(e){for(e.mark();0!==e.readByte(););const t=e.offset;e.reset();const r=Zh.decode(e.readBytes(t-e.offset-1));return e.skip(1),$h(r),r}const am=-1,sm=0,om=2,im=3,lm=4,cm=6,dm=-1,um=0,hm=-1,mm=0,pm=-1,fm=0,gm=1,vm=0,xm=1,bm=2,ym=0,wm=1;class jm extends sc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),(0,ec.A)(this,"_checkCrc",void 0),(0,ec.A)(this,"_inflator",void 0),(0,ec.A)(this,"_png",void 0),(0,ec.A)(this,"_apng",void 0),(0,ec.A)(this,"_end",void 0),(0,ec.A)(this,"_hasPalette",void 0),(0,ec.A)(this,"_palette",void 0),(0,ec.A)(this,"_hasTransparency",void 0),(0,ec.A)(this,"_transparency",void 0),(0,ec.A)(this,"_compressionMethod",void 0),(0,ec.A)(this,"_filterMethod",void 0),(0,ec.A)(this,"_interlaceMethod",void 0),(0,ec.A)(this,"_colorType",void 0),(0,ec.A)(this,"_isAnimated",void 0),(0,ec.A)(this,"_numberOfFrames",void 0),(0,ec.A)(this,"_numberOfPlays",void 0),(0,ec.A)(this,"_frames",void 0),(0,ec.A)(this,"_writingDataChunks",void 0);const{checkCrc:r=!1}=t;this._checkCrc=r,this._inflator=new Eh,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=dm,this._filterMethod=hm,this._interlaceMethod=pm,this._colorType=am,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(Xh(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(Xh(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const r=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case Qh:rm(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e)}if(this.offset-r!==e)throw new Error("Length mismatch while decoding chunk ".concat(t));this._checkCrc?Lh(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const r=this.offset;switch("fdAT"!==t&&"IDAT"!==t&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=r+e}if(this.offset-r!==e)throw new Error("Length mismatch while decoding chunk ".concat(t));this._checkCrc?Lh(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=function(e){if(1!==e&&2!==e&&4!==e&&8!==e&&16!==e)throw new Error("invalid bit depth: ".concat(e));return e}(this.readUint8());const t=this.readUint8();let r;switch(this._colorType=t,t){case sm:r=1;break;case om:r=3;break;case im:r=1;break;case lm:r=2;break;case cm:r=4;break;default:throw new Error("Unknown color type: ".concat(t))}if(this._png.channels=r,this._compressionMethod=this.readUint8(),this._compressionMethod!==um)throw new Error("Unsupported compression method: ".concat(this._compressionMethod));this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError("PLTE field length must be a multiple of 3. Got ".concat(e));const t=e/3;this._hasPalette=!0;const r=[];this._palette=r;for(let n=0;n<t;n++)r.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,r=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,r,t)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,r=this.offset+this.byteOffset;if(r+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,r,t)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(e)}decodetRNS(e){switch(this._colorType){case sm:case om:if(e%2!==0)throw new RangeError("tRNS chunk length must be a multiple of 2. Got ".concat(e));if(e/2>this._png.width*this._png.height)throw new Error("tRNS chunk contains more alpha values than there are pixels (".concat(e/2," vs ").concat(this._png.width*this._png.height,")"));this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break;case im:{if(e>this._palette.length)throw new Error("tRNS chunk contains more alpha values than there are palette colors (".concat(e," vs ").concat(this._palette.length,")"));let t=0;for(;t<e;t++){const e=this.readByte();this._palette[t].push(e)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw new Error("tRNS chunk is not supported for color type ".concat(this._colorType))}}decodeiCCP(e){const t=nm(this),r=this.readUint8();if(r!==um)throw new Error("Unsupported iCCP compression method: ".concat(r));const n=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:Ph(n)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),r=this.readByte();this._png.resolution={x:e,y:t,unit:r}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},r=this._frames.at(e);if(r){if(r.data=Kh({data:r.data,width:r.width,height:r.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===e||0===r.xOffset&&0===r.yOffset&&r.width===this._png.width&&r.height===this._png.height)t.data=r.data;else{const n=this._apng.frames.at(e-1);this.disposeFrame(r,n,t),this.addFrameDataToCanvas(t,r)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,r){switch(e.disposeOp){case vm:break;case xm:for(let t=0;t<this._png.height;t++)for(let n=0;n<this._png.width;n++){const a=(t*e.width+n)*this._png.channels;for(let e=0;e<this._png.channels;e++)r.data[a+e]=0}break;case bm:r.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const r=1<<this._png.depth,n=(e,r)=>({index:((e+t.yOffset)*this._png.width+t.xOffset+r)*this._png.channels,frameIndex:(e*t.width+r)*this._png.channels});switch(t.blendOp){case ym:for(let r=0;r<t.height;r++)for(let a=0;a<t.width;a++){const{index:s,frameIndex:o}=n(r,a);for(let r=0;r<this._png.channels;r++)e.data[s+r]=t.data[o+r]}break;case wm:for(let a=0;a<t.height;a++)for(let s=0;s<t.width;s++){const{index:o,frameIndex:i}=n(a,s);for(let n=0;n<this._png.channels;n++){const a=t.data[i+this._png.channels-1]/r,s=n%(this._png.channels-1)===0?1:t.data[i+n],l=Math.floor(a*s+(1-a)*e.data[o+n]);e.data[o+n]+=l}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var e;if(this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));const t=this._isAnimated?(null===(e=this._frames)||void 0===e?void 0:e.at(0)).data:this._inflator.result;if(this._filterMethod!==mm)throw new Error("Filter method ".concat(this._filterMethod," not supported"));if(this._interlaceMethod===fm)this._png.data=Kh({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else{if(this._interlaceMethod!==gm)throw new Error("Interlace method ".concat(this._interlaceMethod," not supported"));this._png.data=function(e){const{data:t,width:r,height:n,channels:a,depth:s}=e,o=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],i=Math.ceil(s/8)*a,l=new Uint8Array(n*r*i);let c=0;for(let d=0;d<7;d++){const e=o[d],a=Math.ceil((r-e.x)/e.xStep),s=Math.ceil((n-e.y)/e.yStep);if(a<=0||s<=0)continue;const u=a*i,h=new Uint8Array(u);for(let o=0;o<s;o++){const s=t[c++],d=t.subarray(c,c+u);c+=u;const m=new Uint8Array(u);Bh(s,d,m,h,u,i),h.set(m);for(let t=0;t<a;t++){const a=e.x+t*e.xStep,s=e.y+o*e.yStep;if(!(a>=r||s>=n))for(let e=0;e<i;e++)l[(s*r+a)*i+e]=m[t*i+e]}}}if(16===s){const e=new Uint16Array(l.buffer);if(Wh)for(let t=0;t<e.length;t++)e[t]=qh(e[t]);return e}return l}({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth})}this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:vm,blendOp:ym,data:e}),this._inflator=new Eh,this._writingDataChunks=!1}}var Nm;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"}(Nm||(Nm={}));var Sm=function(){return"undefined"!=typeof window?window:"undefined"!=typeof r.g?r.g:"undefined"!=typeof self?self:this}();function km(){Sm.console&&"function"==typeof Sm.console.log&&Sm.console.log.apply(Sm.console,arguments)}var Am={log:km,warn:function(e){Sm.console&&("function"==typeof Sm.console.warn?Sm.console.warn.apply(Sm.console,arguments):km.call(null,arguments))},error:function(e){Sm.console&&("function"==typeof Sm.console.error?Sm.console.error.apply(Sm.console,arguments):km(e))}};function Cm(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){_m(n.response,t,r)},n.onerror=function(){Am.error("could not download file")},n.send()}function Em(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(Dt){}return t.status>=200&&t.status<=299}function Pm(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(Dt){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var _m=Sm.saveAs||("object"!==("undefined"==typeof window?"undefined":(0,hl.A)(window))||window!==Sm?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=Sm.URL||Sm.webkitURL,a=document.createElement("a");t=t||e.name||"download",a.download=t,a.rel="noopener","string"==typeof e?(a.href=e,a.origin!==location.origin?Em(a.href)?Cm(e,t,r):Pm(a,a.target="_blank"):Pm(a)):(a.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(a.href)},4e4),setTimeout(function(){Pm(a)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download","string"==typeof e)if(Em(e))Cm(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){Pm(n)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!==(0,hl.A)(t)&&(Am.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return Cm(e,t,r);var a="application/octet-stream"===e.type,s=/constructor/i.test(Sm.HTMLElement)||Sm.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||a&&s)&&"object"===("undefined"==typeof FileReader?"undefined":(0,hl.A)(FileReader))){var i=new FileReader;i.onloadend=function(){var e=i.result;e=o?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},i.readAsDataURL(e)}else{var l=Sm.URL||Sm.webkitURL,c=l.createObjectURL(e);n?n.location=c:location.href=c,n=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});function Im(e){var t;e=e||"",this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],n=0;n<r.length;n++){var a=r[n].re,s=r[n].process,o=a.exec(e);o&&(t=s(o),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),r=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==r.length&&(r="0"+r),"#"+e+t+r}}var Tm=Sm.atob.bind(Sm),Lm=Sm.btoa.bind(Sm);function Dm(e,t){var r=e[0],n=e[1],a=e[2],s=e[3];r=Om(r,n,a,s,t[0],7,-680876936),s=Om(s,r,n,a,t[1],12,-389564586),a=Om(a,s,r,n,t[2],17,606105819),n=Om(n,a,s,r,t[3],22,-1044525330),r=Om(r,n,a,s,t[4],7,-176418897),s=Om(s,r,n,a,t[5],12,1200080426),a=Om(a,s,r,n,t[6],17,-1473231341),n=Om(n,a,s,r,t[7],22,-45705983),r=Om(r,n,a,s,t[8],7,1770035416),s=Om(s,r,n,a,t[9],12,-1958414417),a=Om(a,s,r,n,t[10],17,-42063),n=Om(n,a,s,r,t[11],22,-1990404162),r=Om(r,n,a,s,t[12],7,1804603682),s=Om(s,r,n,a,t[13],12,-40341101),a=Om(a,s,r,n,t[14],17,-1502002290),r=Rm(r,n=Om(n,a,s,r,t[15],22,1236535329),a,s,t[1],5,-165796510),s=Rm(s,r,n,a,t[6],9,-1069501632),a=Rm(a,s,r,n,t[11],14,643717713),n=Rm(n,a,s,r,t[0],20,-373897302),r=Rm(r,n,a,s,t[5],5,-701558691),s=Rm(s,r,n,a,t[10],9,38016083),a=Rm(a,s,r,n,t[15],14,-660478335),n=Rm(n,a,s,r,t[4],20,-405537848),r=Rm(r,n,a,s,t[9],5,568446438),s=Rm(s,r,n,a,t[14],9,-1019803690),a=Rm(a,s,r,n,t[3],14,-187363961),n=Rm(n,a,s,r,t[8],20,1163531501),r=Rm(r,n,a,s,t[13],5,-1444681467),s=Rm(s,r,n,a,t[2],9,-51403784),a=Rm(a,s,r,n,t[7],14,1735328473),r=Fm(r,n=Rm(n,a,s,r,t[12],20,-1926607734),a,s,t[5],4,-378558),s=Fm(s,r,n,a,t[8],11,-2022574463),a=Fm(a,s,r,n,t[11],16,1839030562),n=Fm(n,a,s,r,t[14],23,-35309556),r=Fm(r,n,a,s,t[1],4,-1530992060),s=Fm(s,r,n,a,t[4],11,1272893353),a=Fm(a,s,r,n,t[7],16,-155497632),n=Fm(n,a,s,r,t[10],23,-1094730640),r=Fm(r,n,a,s,t[13],4,681279174),s=Fm(s,r,n,a,t[0],11,-358537222),a=Fm(a,s,r,n,t[3],16,-722521979),n=Fm(n,a,s,r,t[6],23,76029189),r=Fm(r,n,a,s,t[9],4,-640364487),s=Fm(s,r,n,a,t[12],11,-421815835),a=Fm(a,s,r,n,t[15],16,530742520),r=Um(r,n=Fm(n,a,s,r,t[2],23,-995338651),a,s,t[0],6,-198630844),s=Um(s,r,n,a,t[7],10,1126891415),a=Um(a,s,r,n,t[14],15,-1416354905),n=Um(n,a,s,r,t[5],21,-57434055),r=Um(r,n,a,s,t[12],6,1700485571),s=Um(s,r,n,a,t[3],10,-1894986606),a=Um(a,s,r,n,t[10],15,-1051523),n=Um(n,a,s,r,t[1],21,-2054922799),r=Um(r,n,a,s,t[8],6,1873313359),s=Um(s,r,n,a,t[15],10,-30611744),a=Um(a,s,r,n,t[6],15,-1560198380),n=Um(n,a,s,r,t[13],21,1309151649),r=Um(r,n,a,s,t[4],6,-145523070),s=Um(s,r,n,a,t[11],10,-1120210379),a=Um(a,s,r,n,t[2],15,718787259),n=Um(n,a,s,r,t[9],21,-343485551),e[0]=Km(r,e[0]),e[1]=Km(n,e[1]),e[2]=Km(a,e[2]),e[3]=Km(s,e[3])}function Mm(e,t,r,n,a,s){return t=Km(Km(t,e),Km(n,s)),Km(t<<a|t>>>32-a,r)}function Om(e,t,r,n,a,s,o){return Mm(t&r|~t&n,e,t,a,s,o)}function Rm(e,t,r,n,a,s,o){return Mm(t&n|r&~n,e,t,a,s,o)}function Fm(e,t,r,n,a,s,o){return Mm(t^r^n,e,t,a,s,o)}function Um(e,t,r,n,a,s,o){return Mm(r^(t|~n),e,t,a,s,o)}function Bm(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)Dm(n,zm(e.substring(t-64,t)));e=e.substring(t-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(Dm(n,a),t=0;t<16;t++)a[t]=0;return a[14]=8*r,Dm(n,a),n}function zm(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}var Wm="0123456789abcdef".split("");function qm(e){for(var t="",r=0;r<4;r++)t+=Wm[e>>8*r+4&15]+Wm[e>>8*r&15];return t}function Vm(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function Hm(e){return Bm(e).map(Vm).join("")}var Gm="5d41402abc4b2a76b9719d911017c592"!=function(e){for(var t=0;t<e.length;t++)e[t]=qm(e[t]);return e.join("")}(Bm("hello"));function Km(e,t){if(Gm){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}function Jm(e,t){var r,n,a,s;if(e!==r){for(var o=(a=e,s=1+(256/e.length|0),new Array(s+1).join(a)),i=[],l=0;l<256;l++)i[l]=l;var c=0;for(l=0;l<256;l++){var d=i[l];c=(c+d+o.charCodeAt(l))%256,i[l]=i[c],i[c]=d}r=e,n=i}else i=n;var u=t.length,h=0,m=0,p="";for(l=0;l<u;l++)m=(m+(d=i[h=(h+1)%256]))%256,i[h]=i[m],i[m]=d,o=i[(i[h]+i[m])%256],p+=String.fromCharCode(t.charCodeAt(l)^o);return p}var Ym={print:4,modify:8,copy:16,"annot-forms":32};function Xm(e,t,r,n){this.v=1,this.r=2;var a=192;e.forEach(function(e){if(void 0!==Ym.perm)throw new Error("Invalid permission: "+e);a+=Ym[e]}),this.padding="(\xbfN^Nu\x8aAd\0NV\xff\xfa\x01\b..\0\xb6\xd0h>\x80/\f\xa9\xfedSiz";var s=(t+this.padding).substr(0,32),o=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,o),this.P=-(1+(255^a)),this.encryptionKey=Hm(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=Jm(this.encryptionKey,this.padding)}function Qm(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,n=0;n<r;n++){var a=e.charCodeAt(n);t+=a<33||35===a||37===a||40===a||41===a||47===a||60===a||62===a||91===a||93===a||123===a||125===a||a>126?"#"+("0"+a.toString(16)).slice(-2):e[n]}return t}function Zm(e){if("object"!==(0,hl.A)(e))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,r,n){if(n=n||!1,"string"!=typeof e||"function"!=typeof r||"boolean"!=typeof n)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var a=Math.random().toString(35);return t[e][a]=[r,!!n],a},this.unsubscribe=function(e){for(var r in t)if(t[r][e])return delete t[r][e],0===Object.keys(t[r]).length&&delete t[r],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),a=[];for(var s in t[r]){var o=t[r][s];try{o[0].apply(e,n)}catch(Ot){Sm.console&&Am.error("jsPDF PubSub Error",Ot.message,Ot)}o[1]&&a.push(s)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function $m(e){if(!(this instanceof $m))return new $m(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function ep(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function tp(e,t,r,n,a){if(!(this instanceof tp))return new tp(e,t,r,n,a);this.type="axial"===e?2:3,this.coords=t,this.colors=r,ep.call(this,n,a)}function rp(e,t,r,n,a){if(!(this instanceof rp))return new rp(e,t,r,n,a);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,ep.call(this,n,a)}function np(e){var t,r="string"==typeof arguments[0]?arguments[0]:"p",n=arguments[1],a=arguments[2],s=arguments[3],o=[],i=1,l=16,c="S",d=null;"object"===(0,hl.A)(e=e||{})&&(r=e.orientation,n=e.unit||n,a=e.format||a,s=e.compress||e.compressPdf||s,null!==(d=e.encryption||null)&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),i="number"==typeof e.userUnit?Math.abs(e.userUnit):1,void 0!==e.precision&&(t=e.precision),void 0!==e.floatPrecision&&(l=e.floatPrecision),c=e.defaultPathOperation||"S"),o=e.filters||(!0===s?["FlateEncode"]:o),n=n||"mm",r=(""+(r||"P")).toLowerCase();var u=e.putOnlyUsedFonts||!1,h={},m={internal:{},__private__:{}};m.__private__.PubSub=Zm;var p="1.3",f=m.__private__.getPdfVersion=function(){return p};m.__private__.setPdfVersion=function(e){p=e};var g={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};m.__private__.getPageFormats=function(){return g};var v=m.__private__.getPageFormat=function(e){return g[e]};a=a||"a4";var x="compat",b="advanced",y=x;function w(){this.saveGraphicsState(),Q(new Ie(he,0,0,-he,0,hr()*he).toString()+" cm"),this.setFontSize(this.getFontSize()/he),c="n",y=b}function j(){this.restoreGraphicsState(),c="S",y=x}var N=m.__private__.combineFontStyleAndFontWeight=function(e,t){if("bold"==e&&"normal"==t||"bold"==e&&400==t||"normal"==e&&"italic"==t||"bold"==e&&"italic"==t)throw new Error("Invalid Combination of fontweight and fontstyle");return t&&(e=400==t||"normal"===t?"italic"===e?"italic":"normal":700!=t&&"bold"!==t||"normal"!==e?(700==t?"bold":t)+""+e:"bold"),e};m.advancedAPI=function(e){var t=y===x;return t&&w.call(this),"function"!=typeof e||(e(this),t&&j.call(this)),this},m.compatAPI=function(e){var t=y===b;return t&&j.call(this),"function"!=typeof e||(e(this),t&&w.call(this)),this},m.isAdvancedAPI=function(){return y===b};var S,k=function(e){if(y!==b)throw new Error(e+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},A=m.roundToPrecision=m.__private__.roundToPrecision=function(e,r){var n=t||r;if(isNaN(e)||isNaN(n))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return e.toFixed(n).replace(/0+$/,"")};S=m.hpf=m.__private__.hpf="number"==typeof l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return A(e,l)}:"smart"===l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return A(e,e>-1&&e<1?16:5)}:function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return A(e,16)};var C=m.f2=m.__private__.f2=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f2");return A(e,2)},E=m.__private__.f3=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f3");return A(e,3)},P=m.scale=m.__private__.scale=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.scale");return y===x?e*he:y===b?e:void 0},_=function(e){return P(function(e){return y===x?hr()-e:y===b?e:void 0}(e))};m.__private__.setPrecision=m.setPrecision=function(e){"number"==typeof parseInt(e,10)&&(t=parseInt(e,10))};var I,T="00000000000000000000000000000000",L=m.__private__.getFileId=function(){return T},D=m.__private__.setFileId=function(e){return T=void 0!==e&&/^[a-fA-F0-9]{32}$/.test(e)?e.toUpperCase():T.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),null!==d&&(xt=new Xm(d.userPermissions,d.userPassword,d.ownerPassword,T)),T};m.setFileId=function(e){return D(e),this},m.getFileId=function(){return L()};var M=m.__private__.convertDateToPDFDate=function(e){var t=e.getTimezoneOffset(),r=t<0?"+":"-",n=Math.floor(Math.abs(t/60)),a=Math.abs(t%60),s=[r,B(n),"'",B(a),"'"].join("");return["D:",e.getFullYear(),B(e.getMonth()+1),B(e.getDate()),B(e.getHours()),B(e.getMinutes()),B(e.getSeconds()),s].join("")},O=m.__private__.convertPDFDateToDate=function(e){var t=parseInt(e.substr(2,4),10),r=parseInt(e.substr(6,2),10)-1,n=parseInt(e.substr(8,2),10),a=parseInt(e.substr(10,2),10),s=parseInt(e.substr(12,2),10),o=parseInt(e.substr(14,2),10);return new Date(t,r,n,a,s,o,0)},R=m.__private__.setCreationDate=function(e){var t;if(void 0===e&&(e=new Date),e instanceof Date)t=M(e);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(e))throw new Error("Invalid argument passed to jsPDF.setCreationDate");t=e}return I=t},F=m.__private__.getCreationDate=function(e){var t=I;return"jsDate"===e&&(t=O(I)),t};m.setCreationDate=function(e){return R(e),this},m.getCreationDate=function(e){return F(e)};var U,B=m.__private__.padd2=function(e){return("0"+parseInt(e)).slice(-2)},z=m.__private__.padd2Hex=function(e){return("00"+(e=e.toString())).substr(e.length)},W=0,q=[],V=[],H=0,G=[],K=[],J=!1,Y=V;m.__private__.setCustomOutputDestination=function(e){J=!0,Y=e};var X=function(e){J||(Y=e)};m.__private__.resetCustomOutputDestination=function(){J=!1,Y=V};var Q=m.__private__.out=function(e){return e=e.toString(),H+=e.length+1,Y.push(e),Y},Z=m.__private__.write=function(e){return Q(1===arguments.length?e.toString():Array.prototype.join.call(arguments," "))},$=m.__private__.getArrayBuffer=function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r);t--;)n[t]=e.charCodeAt(t);return r},ee=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];m.__private__.getStandardFonts=function(){return ee};var te=e.fontSize||16;m.__private__.setFontSize=m.setFontSize=function(e){return te=y===b?e/he:e,this};var re,ne=m.__private__.getFontSize=m.getFontSize=function(){return y===x?te:te*he},ae=e.R2L||!1;m.__private__.setR2L=m.setR2L=function(e){return ae=e,this},m.__private__.getR2L=m.getR2L=function(){return ae};var se,oe=m.__private__.setZoomMode=function(e){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(e))re=e;else if(isNaN(e)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(e))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+e+'" is not recognized.');re=e}else re=parseInt(e,10)};m.__private__.getZoomMode=function(){return re};var ie,le=m.__private__.setPageMode=function(e){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(e))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+e+'" is not recognized.');se=e};m.__private__.getPageMode=function(){return se};var ce=m.__private__.setLayoutMode=function(e){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(e))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+e+'" is not recognized.');ie=e};m.__private__.getLayoutMode=function(){return ie},m.__private__.setDisplayMode=m.setDisplayMode=function(e,t,r){return oe(e),ce(t),le(r),this};var de={title:"",subject:"",author:"",keywords:"",creator:""};m.__private__.getDocumentProperty=function(e){if(-1===Object.keys(de).indexOf(e))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return de[e]},m.__private__.getDocumentProperties=function(){return de},m.__private__.setDocumentProperties=m.setProperties=m.setDocumentProperties=function(e){for(var t in de)de.hasOwnProperty(t)&&e[t]&&(de[t]=e[t]);return this},m.__private__.setDocumentProperty=function(e,t){if(-1===Object.keys(de).indexOf(e))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return de[e]=t};var ue,he,me,pe,fe,ge={},ve={},xe=[],be={},ye={},we={},je={},Ne=null,Se=0,ke=[],Ae=new Zm(m),Ce=e.hotfixes||[],Ee={},Pe={},_e=[],Ie=function e(t,r,n,a,s,o){if(!(this instanceof e))return new e(t,r,n,a,s,o);isNaN(t)&&(t=1),isNaN(r)&&(r=0),isNaN(n)&&(n=0),isNaN(a)&&(a=1),isNaN(s)&&(s=0),isNaN(o)&&(o=0),this._matrix=[t,r,n,a,s,o]};Object.defineProperty(Ie.prototype,"sx",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Ie.prototype,"shy",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Ie.prototype,"shx",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Ie.prototype,"sy",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Ie.prototype,"tx",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Ie.prototype,"ty",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Ie.prototype,"a",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Ie.prototype,"b",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Ie.prototype,"c",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Ie.prototype,"d",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Ie.prototype,"e",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Ie.prototype,"f",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Ie.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ie.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ie.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ie.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Ie.prototype.join=function(e){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(S).join(e)},Ie.prototype.multiply=function(e){var t=e.sx*this.sx+e.shy*this.shx,r=e.sx*this.shy+e.shy*this.sy,n=e.shx*this.sx+e.sy*this.shx,a=e.shx*this.shy+e.sy*this.sy,s=e.tx*this.sx+e.ty*this.shx+this.tx,o=e.tx*this.shy+e.ty*this.sy+this.ty;return new Ie(t,r,n,a,s,o)},Ie.prototype.decompose=function(){var e=this.sx,t=this.shy,r=this.shx,n=this.sy,a=this.tx,s=this.ty,o=Math.sqrt(e*e+t*t),i=(e/=o)*r+(t/=o)*n;r-=e*i,n-=t*i;var l=Math.sqrt(r*r+n*n);return i/=l,e*(n/=l)<t*(r/=l)&&(e=-e,t=-t,i=-i,o=-o),{scale:new Ie(o,0,0,l,0,0),translate:new Ie(1,0,0,1,a,s),rotate:new Ie(e,t,-t,e,0,0),skew:new Ie(1,0,i,1,0,0)}},Ie.prototype.toString=function(e){return this.join(" ")},Ie.prototype.inversed=function(){var e=this.sx,t=this.shy,r=this.shx,n=this.sy,a=this.tx,s=this.ty,o=1/(e*n-t*r),i=n*o,l=-t*o,c=-r*o,d=e*o;return new Ie(i,l,c,d,-i*a-c*s,-l*a-d*s)},Ie.prototype.applyToPoint=function(e){var t=e.x*this.sx+e.y*this.shx+this.tx,r=e.x*this.shy+e.y*this.sy+this.ty;return new tr(t,r)},Ie.prototype.applyToRectangle=function(e){var t=this.applyToPoint(e),r=this.applyToPoint(new tr(e.x+e.w,e.y+e.h));return new rr(t.x,t.y,r.x-t.x,r.y-t.y)},Ie.prototype.clone=function(){var e=this.sx,t=this.shy,r=this.shx,n=this.sy,a=this.tx,s=this.ty;return new Ie(e,t,r,n,a,s)},m.Matrix=Ie;var Te=m.matrixMult=function(e,t){return t.multiply(e)},Le=new Ie(1,0,0,1,0,0);m.unitMatrix=m.identityMatrix=Le;var De=function(e,t){if(!ye[e]){var r=(t instanceof tp?"Sh":"P")+(Object.keys(be).length+1).toString(10);t.id=r,ye[e]=r,be[r]=t,Ae.publish("addPattern",t)}};m.ShadingPattern=tp,m.TilingPattern=rp,m.addShadingPattern=function(e,t){return k("addShadingPattern()"),De(e,t),this},m.beginTilingPattern=function(e){k("beginTilingPattern()"),ar(e.boundingBox[0],e.boundingBox[1],e.boundingBox[2]-e.boundingBox[0],e.boundingBox[3]-e.boundingBox[1],e.matrix)},m.endTilingPattern=function(e,t){k("endTilingPattern()"),t.stream=K[U].join("\n"),De(e,t),Ae.publish("endTilingPattern",t),_e.pop().restore()};var Me,Oe=m.__private__.newObject=function(){var e=Re();return Fe(e,!0),e},Re=m.__private__.newObjectDeferred=function(){return W++,q[W]=function(){return H},W},Fe=function(e,t){return t="boolean"==typeof t&&t,q[e]=H,t&&Q(e+" 0 obj"),e},Ue=m.__private__.newAdditionalObject=function(){var e={objId:Re(),content:""};return G.push(e),e},Be=Re(),ze=Re(),We=m.__private__.decodeColorString=function(e){var t=e.split(" ");if(2!==t.length||"g"!==t[1]&&"G"!==t[1])5!==t.length||"k"!==t[4]&&"K"!==t[4]||(t=[(1-t[0])*(1-t[3]),(1-t[1])*(1-t[3]),(1-t[2])*(1-t[3]),"r"]);else{var r=parseFloat(t[0]);t=[r,r,r,"r"]}for(var n="#",a=0;a<3;a++)n+=("0"+Math.floor(255*parseFloat(t[a])).toString(16)).slice(-2);return n},qe=m.__private__.encodeColorString=function(e){var t;"string"==typeof e&&(e={ch1:e});var r=e.ch1,n=e.ch2,a=e.ch3,s=e.ch4,o="draw"===e.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof r&&"#"!==r.charAt(0)){var i=new Im(r);if(i.ok)r=i.toHex();else if(!/^\d*\.?\d*$/.test(r))throw new Error('Invalid color "'+r+'" passed to jsPDF.encodeColorString.')}if("string"==typeof r&&/^#[0-9A-Fa-f]{3}$/.test(r)&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]),"string"==typeof r&&/^#[0-9A-Fa-f]{6}$/.test(r)){var l=parseInt(r.substr(1),16);r=l>>16&255,n=l>>8&255,a=255&l}if(void 0===n||void 0===s&&r===n&&n===a)t="string"==typeof r?r+" "+o[0]:2===e.precision?C(r/255)+" "+o[0]:E(r/255)+" "+o[0];else if(void 0===s||"object"===(0,hl.A)(s)){if(s&&!isNaN(s.a)&&0===s.a)return["1.","1.","1.",o[1]].join(" ");t="string"==typeof r?[r,n,a,o[1]].join(" "):2===e.precision?[C(r/255),C(n/255),C(a/255),o[1]].join(" "):[E(r/255),E(n/255),E(a/255),o[1]].join(" ")}else t="string"==typeof r?[r,n,a,s,o[2]].join(" "):2===e.precision?[C(r),C(n),C(a),C(s),o[2]].join(" "):[E(r),E(n),E(a),E(s),o[2]].join(" ");return t},Ve=m.__private__.getFilters=function(){return o},He=m.__private__.putStream=function(e){var t=(e=e||{}).data||"",r=e.filters||Ve(),n=e.alreadyAppliedFilters||[],a=e.addLength1||!1,s=t.length,o=e.objectId,i=function(e){return e};if(null!==d&&void 0===o)throw new Error("ObjectId must be passed to putStream for file encryption");null!==d&&(i=xt.encryptor(o,0));var l={};!0===r&&(r=["FlateEncode"]);var c=e.additionalKeyValues||[],u=(l=void 0!==np.API.processDataByFilters?np.API.processDataByFilters(t,r):{data:t,reverseChain:[]}).reverseChain+(Array.isArray(n)?n.join(" "):n.toString());if(0!==l.data.length&&(c.push({key:"Length",value:l.data.length}),!0===a&&c.push({key:"Length1",value:s})),0!=u.length)if(u.split("/").length-1==1)c.push({key:"Filter",value:u});else{c.push({key:"Filter",value:"["+u+"]"});for(var h=0;h<c.length;h+=1)if("DecodeParms"===c[h].key){for(var m=[],p=0;p<l.reverseChain.split("/").length-1;p+=1)m.push("null");m.push(c[h].value),c[h].value="["+m.join(" ")+"]"}}Q("<<");for(var f=0;f<c.length;f++)Q("/"+c[f].key+" "+c[f].value);Q(">>"),0!==l.data.length&&(Q("stream"),Q(i(l.data)),Q("endstream"))},Ge=m.__private__.putPage=function(e){var t=e.number,r=e.data,n=e.objId,a=e.contentsObjId;Fe(n,!0),Q("<</Type /Page"),Q("/Parent "+e.rootDictionaryObjId+" 0 R"),Q("/Resources "+e.resourceDictionaryObjId+" 0 R"),Q("/MediaBox ["+parseFloat(S(e.mediaBox.bottomLeftX))+" "+parseFloat(S(e.mediaBox.bottomLeftY))+" "+S(e.mediaBox.topRightX)+" "+S(e.mediaBox.topRightY)+"]"),null!==e.cropBox&&Q("/CropBox ["+S(e.cropBox.bottomLeftX)+" "+S(e.cropBox.bottomLeftY)+" "+S(e.cropBox.topRightX)+" "+S(e.cropBox.topRightY)+"]"),null!==e.bleedBox&&Q("/BleedBox ["+S(e.bleedBox.bottomLeftX)+" "+S(e.bleedBox.bottomLeftY)+" "+S(e.bleedBox.topRightX)+" "+S(e.bleedBox.topRightY)+"]"),null!==e.trimBox&&Q("/TrimBox ["+S(e.trimBox.bottomLeftX)+" "+S(e.trimBox.bottomLeftY)+" "+S(e.trimBox.topRightX)+" "+S(e.trimBox.topRightY)+"]"),null!==e.artBox&&Q("/ArtBox ["+S(e.artBox.bottomLeftX)+" "+S(e.artBox.bottomLeftY)+" "+S(e.artBox.topRightX)+" "+S(e.artBox.topRightY)+"]"),"number"==typeof e.userUnit&&1!==e.userUnit&&Q("/UserUnit "+e.userUnit),Ae.publish("putPage",{objId:n,pageContext:ke[t],pageNumber:t,page:r}),Q("/Contents "+a+" 0 R"),Q(">>"),Q("endobj");var s=r.join("\n");return y===b&&(s+="\nQ"),Fe(a,!0),He({data:s,filters:Ve(),objectId:a}),Q("endobj"),n},Ke=m.__private__.putPages=function(){var e,t,r=[];for(e=1;e<=Se;e++)ke[e].objId=Re(),ke[e].contentsObjId=Re();for(e=1;e<=Se;e++)r.push(Ge({number:e,data:K[e],objId:ke[e].objId,contentsObjId:ke[e].contentsObjId,mediaBox:ke[e].mediaBox,cropBox:ke[e].cropBox,bleedBox:ke[e].bleedBox,trimBox:ke[e].trimBox,artBox:ke[e].artBox,userUnit:ke[e].userUnit,rootDictionaryObjId:Be,resourceDictionaryObjId:ze}));Fe(Be,!0),Q("<</Type /Pages");var n="/Kids [";for(t=0;t<Se;t++)n+=r[t]+" 0 R ";Q(n+"]"),Q("/Count "+Se),Q(">>"),Q("endobj"),Ae.publish("postPutPages")},Je=function(e){Ae.publish("putFont",{font:e,out:Q,newObject:Oe,putStream:He}),!0!==e.isAlreadyPutted&&(e.objectNumber=Oe(),Q("<<"),Q("/Type /Font"),Q("/BaseFont /"+Qm(e.postScriptName)),Q("/Subtype /Type1"),"string"==typeof e.encoding&&Q("/Encoding /"+e.encoding),Q("/FirstChar 32"),Q("/LastChar 255"),Q(">>"),Q("endobj"))},Ye=function(e){e.objectNumber=Oe();var t=[];t.push({key:"Type",value:"/XObject"}),t.push({key:"Subtype",value:"/Form"}),t.push({key:"BBox",value:"["+[S(e.x),S(e.y),S(e.x+e.width),S(e.y+e.height)].join(" ")+"]"}),t.push({key:"Matrix",value:"["+e.matrix.toString()+"]"});var r=e.pages[1].join("\n");He({data:r,additionalKeyValues:t,objectId:e.objectNumber}),Q("endobj")},Xe=function(e,t){t||(t=21);var r=Oe(),n=function(e,t){var r,n=[],a=1/(t-1);for(r=0;r<1;r+=a)n.push(r);if(n.push(1),0!=e[0].offset){var s={offset:0,color:e[0].color};e.unshift(s)}if(1!=e[e.length-1].offset){var o={offset:1,color:e[e.length-1].color};e.push(o)}for(var i="",l=0,c=0;c<n.length;c++){for(r=n[c];r>e[l+1].offset;)l++;var d=e[l].offset,u=(r-d)/(e[l+1].offset-d),h=e[l].color,m=e[l+1].color;i+=z(Math.round((1-u)*h[0]+u*m[0]).toString(16))+z(Math.round((1-u)*h[1]+u*m[1]).toString(16))+z(Math.round((1-u)*h[2]+u*m[2]).toString(16))}return i.trim()}(e.colors,t),a=[];a.push({key:"FunctionType",value:"0"}),a.push({key:"Domain",value:"[0.0 1.0]"}),a.push({key:"Size",value:"["+t+"]"}),a.push({key:"BitsPerSample",value:"8"}),a.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),a.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),He({data:n,additionalKeyValues:a,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:r}),Q("endobj"),e.objectNumber=Oe(),Q("<< /ShadingType "+e.type),Q("/ColorSpace /DeviceRGB");var s="/Coords ["+S(parseFloat(e.coords[0]))+" "+S(parseFloat(e.coords[1]))+" ";2===e.type?s+=S(parseFloat(e.coords[2]))+" "+S(parseFloat(e.coords[3])):s+=S(parseFloat(e.coords[2]))+" "+S(parseFloat(e.coords[3]))+" "+S(parseFloat(e.coords[4]))+" "+S(parseFloat(e.coords[5])),Q(s+="]"),e.matrix&&Q("/Matrix ["+e.matrix.toString()+"]"),Q("/Function "+r+" 0 R"),Q("/Extend [true true]"),Q(">>"),Q("endobj")},Qe=function(e,t){var r=Re(),n=Oe();t.push({resourcesOid:r,objectOid:n}),e.objectNumber=n;var a=[];a.push({key:"Type",value:"/Pattern"}),a.push({key:"PatternType",value:"1"}),a.push({key:"PaintType",value:"1"}),a.push({key:"TilingType",value:"1"}),a.push({key:"BBox",value:"["+e.boundingBox.map(S).join(" ")+"]"}),a.push({key:"XStep",value:S(e.xStep)}),a.push({key:"YStep",value:S(e.yStep)}),a.push({key:"Resources",value:r+" 0 R"}),e.matrix&&a.push({key:"Matrix",value:"["+e.matrix.toString()+"]"}),He({data:e.stream,additionalKeyValues:a,objectId:e.objectNumber}),Q("endobj")},Ze=function(e){for(var t in e.objectNumber=Oe(),Q("<<"),e)switch(t){case"opacity":Q("/ca "+C(e[t]));break;case"stroke-opacity":Q("/CA "+C(e[t]))}Q(">>"),Q("endobj")},$e=function(e){Fe(e.resourcesOid,!0),Q("<<"),Q("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var e in Q("/Font <<"),ge)ge.hasOwnProperty(e)&&(!1===u||!0===u&&h.hasOwnProperty(e))&&Q("/"+e+" "+ge[e].objectNumber+" 0 R");Q(">>")}(),function(){if(Object.keys(be).length>0){for(var e in Q("/Shading <<"),be)be.hasOwnProperty(e)&&be[e]instanceof tp&&be[e].objectNumber>=0&&Q("/"+e+" "+be[e].objectNumber+" 0 R");Ae.publish("putShadingPatternDict"),Q(">>")}}(),function(e){if(Object.keys(be).length>0){for(var t in Q("/Pattern <<"),be)be.hasOwnProperty(t)&&be[t]instanceof m.TilingPattern&&be[t].objectNumber>=0&&be[t].objectNumber<e&&Q("/"+t+" "+be[t].objectNumber+" 0 R");Ae.publish("putTilingPatternDict"),Q(">>")}}(e.objectOid),function(){if(Object.keys(we).length>0){var e;for(e in Q("/ExtGState <<"),we)we.hasOwnProperty(e)&&we[e].objectNumber>=0&&Q("/"+e+" "+we[e].objectNumber+" 0 R");Ae.publish("putGStateDict"),Q(">>")}}(),function(){for(var e in Q("/XObject <<"),Ee)Ee.hasOwnProperty(e)&&Ee[e].objectNumber>=0&&Q("/"+e+" "+Ee[e].objectNumber+" 0 R");Ae.publish("putXobjectDict"),Q(">>")}(),Q(">>"),Q("endobj")},et=function(e){ve[e.fontName]=ve[e.fontName]||{},ve[e.fontName][e.fontStyle]=e.id},tt=function(e,t,r,n,a){var s={id:"F"+(Object.keys(ge).length+1).toString(10),postScriptName:e,fontName:t,fontStyle:r,encoding:n,isStandardFont:a||!1,metadata:{}};return Ae.publish("addFont",{font:s,instance:this}),ge[s.id]=s,et(s),s.id},rt=m.__private__.pdfEscape=m.pdfEscape=function(e,t){return function(e,t){var r,n,a,s,o,i,l,c,d;if(a=(t=t||{}).sourceEncoding||"Unicode",o=t.outputEncoding,(t.autoencode||o)&&ge[ue].metadata&&ge[ue].metadata[a]&&ge[ue].metadata[a].encoding&&(s=ge[ue].metadata[a].encoding,!o&&ge[ue].encoding&&(o=ge[ue].encoding),!o&&s.codePages&&(o=s.codePages[0]),"string"==typeof o&&(o=s[o]),o)){for(l=!1,i=[],r=0,n=e.length;r<n;r++)(c=o[e.charCodeAt(r)])?i.push(String.fromCharCode(c)):i.push(e[r]),i[r].charCodeAt(0)>>8&&(l=!0);e=i.join("")}for(r=e.length;void 0===l&&0!==r;)e.charCodeAt(r-1)>>8&&(l=!0),r--;if(!l)return e;for(i=t.noBOM?[]:[254,255],r=0,n=e.length;r<n;r++){if((d=(c=e.charCodeAt(r))>>8)>>8)throw new Error("Character at position "+r+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");i.push(d),i.push(c-(d<<8))}return String.fromCharCode.apply(void 0,i)}(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},nt=m.__private__.beginPage=function(e){K[++Se]=[],ke[Se]={objId:0,contentsObjId:0,userUnit:Number(i),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(e[0]),topRightY:Number(e[1])}},ot(Se),X(K[U])},at=function(e,t){var n,s,o;switch(r=t||r,"string"==typeof e&&(n=v(e.toLowerCase()),Array.isArray(n)&&(s=n[0],o=n[1])),Array.isArray(e)&&(s=e[0]*he,o=e[1]*he),isNaN(s)&&(s=a[0],o=a[1]),(s>14400||o>14400)&&(Am.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),s=Math.min(14400,s),o=Math.min(14400,o)),a=[s,o],r.substr(0,1)){case"l":o>s&&(a=[o,s]);break;case"p":s>o&&(a=[o,s])}nt(a),Ft(Ot),Q(Gt),0!==Zt&&Q(Zt+" J"),0!==$t&&Q($t+" j"),Ae.publish("addPage",{pageNumber:Se})},st=function(e){e>0&&e<=Se&&(K.splice(e,1),ke.splice(e,1),Se--,U>Se&&(U=Se),this.setPage(U))},ot=function(e){e>0&&e<=Se&&(U=e)},it=m.__private__.getNumberOfPages=m.getNumberOfPages=function(){return K.length-1},lt=function(e,t,r){var n,a=void 0;return r=r||{},e=void 0!==e?e:ge[ue].fontName,t=void 0!==t?t:ge[ue].fontStyle,n=e.toLowerCase(),void 0!==ve[n]&&void 0!==ve[n][t]?a=ve[n][t]:void 0!==ve[e]&&void 0!==ve[e][t]?a=ve[e][t]:!1===r.disableWarning&&Am.warn("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts."),a||r.noFallback||null==(a=ve.times[t])&&(a=ve.times.normal),a},ct=m.__private__.putInfo=function(){var e=Oe(),t=function(e){return e};for(var r in null!==d&&(t=xt.encryptor(e,0)),Q("<<"),Q("/Producer ("+rt(t("jsPDF "+np.version))+")"),de)de.hasOwnProperty(r)&&de[r]&&Q("/"+r.substr(0,1).toUpperCase()+r.substr(1)+" ("+rt(t(de[r]))+")");Q("/CreationDate ("+rt(t(I))+")"),Q(">>"),Q("endobj")},dt=m.__private__.putCatalog=function(e){var t=(e=e||{}).rootDictionaryObjId||Be;switch(Oe(),Q("<<"),Q("/Type /Catalog"),Q("/Pages "+t+" 0 R"),re||(re="fullwidth"),re){case"fullwidth":Q("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Q("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Q("/OpenAction [3 0 R /Fit]");break;case"original":Q("/OpenAction [3 0 R /XYZ null null 1]");break;default:var r=""+re;"%"===r.substr(r.length-1)&&(re=parseInt(re)/100),"number"==typeof re&&Q("/OpenAction [3 0 R /XYZ null null "+C(re)+"]")}switch(ie||(ie="continuous"),ie){case"continuous":Q("/PageLayout /OneColumn");break;case"single":Q("/PageLayout /SinglePage");break;case"two":case"twoleft":Q("/PageLayout /TwoColumnLeft");break;case"tworight":Q("/PageLayout /TwoColumnRight")}se&&Q("/PageMode /"+se),Ae.publish("putCatalog"),Q(">>"),Q("endobj")},ut=m.__private__.putTrailer=function(){Q("trailer"),Q("<<"),Q("/Size "+(W+1)),Q("/Root "+W+" 0 R"),Q("/Info "+(W-1)+" 0 R"),null!==d&&Q("/Encrypt "+xt.oid+" 0 R"),Q("/ID [ <"+T+"> <"+T+"> ]"),Q(">>")},ht=m.__private__.putHeader=function(){Q("%PDF-"+p),Q("%\xba\xdf\xac\xe0")},mt=m.__private__.putXRef=function(){var e="0000000000";Q("xref"),Q("0 "+(W+1)),Q("0000000000 65535 f ");for(var t=1;t<=W;t++)"function"==typeof q[t]?Q((e+q[t]()).slice(-10)+" 00000 n "):void 0!==q[t]?Q((e+q[t]).slice(-10)+" 00000 n "):Q("0000000000 00000 n ")},pt=m.__private__.buildDocument=function(){var e;W=0,H=0,V=[],q=[],G=[],Be=Re(),ze=Re(),X(V),Ae.publish("buildDocument"),ht(),Ke(),function(){Ae.publish("putAdditionalObjects");for(var e=0;e<G.length;e++){var t=G[e];Fe(t.objId,!0),Q(t.content),Q("endobj")}Ae.publish("postPutAdditionalObjects")}(),e=[],function(){for(var e in ge)ge.hasOwnProperty(e)&&(!1===u||!0===u&&h.hasOwnProperty(e))&&Je(ge[e])}(),function(){var e;for(e in we)we.hasOwnProperty(e)&&Ze(we[e])}(),function(){for(var e in Ee)Ee.hasOwnProperty(e)&&Ye(Ee[e])}(),function(e){var t;for(t in be)be.hasOwnProperty(t)&&(be[t]instanceof tp?Xe(be[t]):be[t]instanceof rp&&Qe(be[t],e))}(e),Ae.publish("putResources"),e.forEach($e),$e({resourcesOid:ze,objectOid:Number.MAX_SAFE_INTEGER}),Ae.publish("postPutResources"),null!==d&&(xt.oid=Oe(),Q("<<"),Q("/Filter /Standard"),Q("/V "+xt.v),Q("/R "+xt.r),Q("/U <"+xt.toHexString(xt.U)+">"),Q("/O <"+xt.toHexString(xt.O)+">"),Q("/P "+xt.P),Q(">>"),Q("endobj")),ct(),dt();var t=H;return mt(),ut(),Q("startxref"),Q(""+t),Q("%%EOF"),X(K[U]),V.join("\n")},ft=m.__private__.getBlob=function(e){return new Blob([$(e)],{type:"application/pdf"})},gt=m.output=m.__private__.output=(Me=function(e,t){switch("string"==typeof(t=t||{})?t={filename:t}:t.filename=t.filename||"generated.pdf",e){case void 0:return pt();case"save":m.save(t.filename);break;case"arraybuffer":return $(pt());case"blob":return ft(pt());case"bloburi":case"bloburl":if(void 0!==Sm.URL&&"function"==typeof Sm.URL.createObjectURL)return Sm.URL&&Sm.URL.createObjectURL(ft(pt()))||void 0;Am.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var r="",n=pt();try{r=Lm(n)}catch(d){r=Lm(unescape(encodeURIComponent(n)))}return"data:application/pdf;filename="+t.filename+";base64,"+r;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(Sm)){var a="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",s=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';t.pdfObjectUrl&&(a=t.pdfObjectUrl,s="");var o='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+a+'"'+s+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(t)+");<\/script></body></html>",i=Sm.open();return null!==i&&i.document.write(o),i}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(Sm)){var l='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(t.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+t.filename+'" width="500px" height="400px" /></body></html>',c=Sm.open();if(null!==c){c.document.write(l);var u=this;c.document.documentElement.querySelector("#pdfViewer").onload=function(){c.document.title=t.filename,c.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(u.output("bloburl"))}}return c}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(Sm))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var h='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",t)+'"></iframe></body></html>',p=Sm.open();if(null!==p&&(p.document.write(h),p.document.title=t.filename),p||"undefined"==typeof safari)return p;break;case"datauri":case"dataurl":return Sm.document.location.href=this.output("datauristring",t);default:return null}},Me.foo=function(){try{return Me.apply(this,arguments)}catch(t){var e=t.stack||"";~e.indexOf(" at ")&&(e=e.split(" at ")[1]);var r="Error in function "+e.split("\n")[0].split("<")[0]+": "+t.message;if(!Sm.console)throw new Error(r);Sm.console.error(r,t),Sm.alert&&alert(r)}},Me.foo.bar=Me,Me.foo),vt=function(e){return!0===Array.isArray(Ce)&&Ce.indexOf(e)>-1};switch(n){case"pt":he=1;break;case"mm":he=72/25.4;break;case"cm":he=72/2.54;break;case"in":he=72;break;case"px":he=1==vt("px_scaling")?.75:96/72;break;case"pc":case"em":he=12;break;case"ex":he=6;break;default:if("number"!=typeof n)throw new Error("Invalid unit: "+n);he=n}var xt=null;R(),D();var bt=m.__private__.getPageInfo=m.getPageInfo=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ke[e].objId,pageNumber:e,pageContext:ke[e]}},yt=m.__private__.getPageInfoByObjId=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var t in ke)if(ke[t].objId===e)break;return bt(t)},wt=m.__private__.getCurrentPageInfo=m.getCurrentPageInfo=function(){return{objId:ke[U].objId,pageNumber:U,pageContext:ke[U]}};m.addPage=function(){return at.apply(this,arguments),this},m.setPage=function(){return ot.apply(this,arguments),X.call(this,K[U]),this},m.insertPage=function(e){return this.addPage(),this.movePage(U,e),this},m.movePage=function(e,t){var r,n;if(e>t){r=K[e],n=ke[e];for(var a=e;a>t;a--)K[a]=K[a-1],ke[a]=ke[a-1];K[t]=r,ke[t]=n,this.setPage(t)}else if(e<t){r=K[e],n=ke[e];for(var s=e;s<t;s++)K[s]=K[s+1],ke[s]=ke[s+1];K[t]=r,ke[t]=n,this.setPage(t)}return this},m.deletePage=function(){return st.apply(this,arguments),this},m.__private__.text=m.text=function(e,t,r,n,a){var s,o,i,l,c,d,u,m,p,f=(n=n||{}).scope||this;if("number"==typeof e&&"number"==typeof t&&("string"==typeof r||Array.isArray(r))){var g=r;r=t,t=e,e=g}if(arguments[3]instanceof Ie==0?(i=arguments[4],l=arguments[5],"object"===(0,hl.A)(u=arguments[3])&&null!==u||("string"==typeof i&&(l=i,i=null),"string"==typeof u&&(l=u,u=null),"number"==typeof u&&(i=u,u=null),n={flags:u,angle:i,align:l})):(k("The transform parameter of text() with a Matrix value"),p=a),isNaN(t)||isNaN(r)||null==e)throw new Error("Invalid arguments passed to jsPDF.text");if(0===e.length)return f;var v,x="",w="number"==typeof n.lineHeightFactor?n.lineHeightFactor:Mt,j=f.internal.scaleFactor;function N(e){return e=e.split("\t").join(Array(n.TabLen||9).join(" ")),rt(e,u)}function A(e){for(var t,r=e.concat(),n=[],a=r.length;a--;)"string"==typeof(t=r.shift())?n.push(t):Array.isArray(e)&&(1===t.length||void 0===t[1]&&void 0===t[2])?n.push(t[0]):n.push([t[0],t[1],t[2]]);return n}function C(e,t){var r;if("string"==typeof e)r=t(e)[0];else if(Array.isArray(e)){for(var n,a,s=e.concat(),o=[],i=s.length;i--;)"string"==typeof(n=s.shift())?o.push(t(n)[0]):Array.isArray(n)&&"string"==typeof n[0]&&(a=t(n[0],n[1],n[2]),o.push([a[0],a[1],a[2]]));r=o}return r}var E=!1,_=!0;if("string"==typeof e)E=!0;else if(Array.isArray(e)){var I=e.concat();o=[];for(var T,L=I.length;L--;)("string"!=typeof(T=I.shift())||Array.isArray(T)&&"string"!=typeof T[0])&&(_=!1);E=_}if(!1===E)throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');"string"==typeof e&&(e=e.match(/[\r?\n]/)?e.split(/\r\n|\r|\n/g):[e]);var D=te/f.internal.scaleFactor,M=D*(w-1);switch(n.baseline){case"bottom":r-=M;break;case"top":r+=D-M;break;case"hanging":r+=D-2*M;break;case"middle":r+=D/2-M}if((d=n.maxWidth||0)>0&&("string"==typeof e?e=f.splitTextToSize(e,d):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(f.splitTextToSize(t,d))},[]))),s={text:e,x:t,y:r,options:n,mutex:{pdfEscape:rt,activeFontKey:ue,fonts:ge,activeFontSize:te}},Ae.publish("preProcessText",s),e=s.text,i=(n=s.options).angle,p instanceof Ie==0&&i&&"number"==typeof i){i*=Math.PI/180,0===n.rotationDirection&&(i=-i),y===b&&(i=-i);var O=Math.cos(i),R=Math.sin(i);p=new Ie(O,R,-R,O,0,0)}else i&&i instanceof Ie&&(p=i);y!==b||p||(p=Le),void 0!==(c=n.charSpace||Xt)&&(x+=S(P(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(m=n.horizontalScale)&&(x+=S(100*m)+" Tz\n"),n.lang;var F=-1,U=void 0!==n.renderingMode?n.renderingMode:n.stroke,B=f.internal.getCurrentPageInfo().pageContext;switch(U){case 0:case!1:case"fill":F=0;break;case 1:case!0:case"stroke":F=1;break;case 2:case"fillThenStroke":F=2;break;case 3:case"invisible":F=3;break;case 4:case"fillAndAddForClipping":F=4;break;case 5:case"strokeAndAddPathForClipping":F=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":F=6;break;case 7:case"addToPathForClipping":F=7}var z=void 0!==B.usedRenderingMode?B.usedRenderingMode:-1;-1!==F?x+=F+" Tr\n":-1!==z&&(x+="0 Tr\n"),-1!==F&&(B.usedRenderingMode=F),l=n.align||"left";var W,q=te*w,V=f.internal.pageSize.getWidth(),H=ge[ue];c=n.charSpace||Xt,d=n.maxWidth||0,u=Object.assign({autoencode:!0,noBOM:!0},n.flags);var G=[],K=function(e){return f.getStringUnitWidth(e,{font:H,charSpace:c,fontSize:te,doKerning:!1})*te/j};if("[object Array]"===Object.prototype.toString.call(e)){var J;o=A(e),"left"!==l&&(W=o.map(K));var Y,X=0;if("right"===l){t-=W[0],e=[],L=o.length;for(var Z=0;Z<L;Z++)0===Z?(Y=Wt(t),J=qt(r)):(Y=P(X-W[Z]),J=-q),e.push([o[Z],Y,J]),X=W[Z]}else if("center"===l){t-=W[0]/2,e=[],L=o.length;for(var $=0;$<L;$++)0===$?(Y=Wt(t),J=qt(r)):(Y=P((X-W[$])/2),J=-q),e.push([o[$],Y,J]),X=W[$]}else if("left"===l){e=[],L=o.length;for(var ee=0;ee<L;ee++)e.push(o[ee])}else if("justify"===l&&"Identity-H"===H.encoding){e=[],L=o.length,d=0!==d?d:V;for(var re=0,ne=0;ne<L;ne++)if(J=0===ne?qt(r):-q,Y=0===ne?Wt(t):re,ne<L-1){var se=P((d-W[ne])/(o[ne].split(" ").length-1)),oe=o[ne].split(" ");e.push([oe[0]+" ",Y,J]),re=0;for(var ie=1;ie<oe.length;ie++){var le=(K(oe[ie-1]+" "+oe[ie])-K(oe[ie]))*j+se;ie==oe.length-1?e.push([oe[ie],le,0]):e.push([oe[ie]+" ",le,0]),re-=le}}else e.push([o[ne],Y,J]);e.push(["",re,0])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(e=[],L=o.length,d=0!==d?d:V,ne=0;ne<L;ne++){J=0===ne?qt(r):-q,Y=0===ne?Wt(t):0;var ce=o[ne].split(" ").length-1,de=ce>0?(d-W[ne])/ce:0;ne<L-1?G.push(S(P(de))):G.push(0),e.push([o[ne],Y,J])}}}!0===("boolean"==typeof n.R2L?n.R2L:ae)&&(e=C(e,function(e,t,r){return[e.split("").reverse().join(""),t,r]})),s={text:e,x:t,y:r,options:n,mutex:{pdfEscape:rt,activeFontKey:ue,fonts:ge,activeFontSize:te}},Ae.publish("postProcessText",s),e=s.text,v=s.mutex.isHex||!1;var he=ge[ue].encoding;"WinAnsiEncoding"!==he&&"StandardEncoding"!==he||(e=C(e,function(e,t,r){return[N(e),t,r]})),o=A(e),e=[];for(var me,pe,fe,ve=Array.isArray(o[0])?1:0,xe="",be=function(e,t,r){var a="";return r instanceof Ie?(r="number"==typeof n.angle?Te(r,new Ie(1,0,0,1,e,t)):Te(new Ie(1,0,0,1,e,t),r),y===b&&(r=Te(new Ie(1,0,0,-1,0,0),r)),a=r.join(" ")+" Tm\n"):a=S(e)+" "+S(t)+" Td\n",a},ye=0;ye<o.length;ye++){switch(xe="",ve){case 1:fe=(v?"<":"(")+o[ye][0]+(v?">":")"),me=parseFloat(o[ye][1]),pe=parseFloat(o[ye][2]);break;case 0:fe=(v?"<":"(")+o[ye]+(v?">":")"),me=Wt(t),pe=qt(r)}void 0!==G&&void 0!==G[ye]&&(xe=G[ye]+" Tw\n"),0===ye?e.push(xe+be(me,pe,p)+fe):0===ve?e.push(xe+fe):1===ve&&e.push(xe+be(me,pe,p)+fe)}e=0===ve?e.join(" Tj\nT* "):e.join(" Tj\n"),e+=" Tj\n";var we="BT\n/";return we+=ue+" "+te+" Tf\n",we+=S(te*w)+" TL\n",we+=Jt+"\n",we+=x,we+=e,Q(we+="ET"),h[ue]=!0,f};var jt=m.__private__.clip=m.clip=function(e){return Q("evenodd"===e?"W*":"W"),this};m.clipEvenOdd=function(){return jt("evenodd")},m.__private__.discardPath=m.discardPath=function(){return Q("n"),this};var Nt=m.__private__.isValidStyle=function(e){var t=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(e)&&(t=!0),t};m.__private__.setDefaultPathOperation=m.setDefaultPathOperation=function(e){return Nt(e)&&(c=e),this};var St=m.__private__.getStyle=m.getStyle=function(e){var t=c;switch(e){case"D":case"S":t="S";break;case"F":t="f";break;case"FD":case"DF":t="B";break;case"f":case"f*":case"B":case"B*":t=e}return t},kt=m.close=function(){return Q("h"),this};m.stroke=function(){return Q("S"),this},m.fill=function(e){return At("f",e),this},m.fillEvenOdd=function(e){return At("f*",e),this},m.fillStroke=function(e){return At("B",e),this},m.fillStrokeEvenOdd=function(e){return At("B*",e),this};var At=function(e,t){"object"===(0,hl.A)(t)?Pt(t,e):Q(e)},Ct=function(e){null===e||y===b&&void 0===e||(e=St(e),Q(e))};function Et(e,t,r,n,a){var s=new rp(t||this.boundingBox,r||this.xStep,n||this.yStep,this.gState,a||this.matrix);s.stream=this.stream;var o=e+"$$"+this.cloneIndex+++"$$";return De(o,s),s}var Pt=function(e,t){var r=ye[e.key],n=be[r];if(n instanceof tp)Q("q"),Q(_t(t)),n.gState&&m.setGState(n.gState),Q(e.matrix.toString()+" cm"),Q("/"+r+" sh"),Q("Q");else if(n instanceof rp){var a=new Ie(1,0,0,-1,0,hr());e.matrix&&(a=a.multiply(e.matrix||Le),r=Et.call(n,e.key,e.boundingBox,e.xStep,e.yStep,a).id),Q("q"),Q("/Pattern cs"),Q("/"+r+" scn"),n.gState&&m.setGState(n.gState),Q(t),Q("Q")}},_t=function(e){switch(e){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},It=m.moveTo=function(e,t){return Q(S(P(e))+" "+S(_(t))+" m"),this},Tt=m.lineTo=function(e,t){return Q(S(P(e))+" "+S(_(t))+" l"),this},Lt=m.curveTo=function(e,t,r,n,a,s){return Q([S(P(e)),S(_(t)),S(P(r)),S(_(n)),S(P(a)),S(_(s)),"c"].join(" ")),this};m.__private__.line=m.line=function(e,t,r,n,a){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||!Nt(a))throw new Error("Invalid arguments passed to jsPDF.line");return y===x?this.lines([[r-e,n-t]],e,t,[1,1],a||"S"):this.lines([[r-e,n-t]],e,t,[1,1]).stroke()},m.__private__.lines=m.lines=function(e,t,r,n,a,s){var o,i,l,c,d,u,h,m,p,f,g,v;if("number"==typeof e&&(v=r,r=t,t=e,e=v),n=n||[1,1],s=s||!1,isNaN(t)||isNaN(r)||!Array.isArray(e)||!Array.isArray(n)||!Nt(a)||"boolean"!=typeof s)throw new Error("Invalid arguments passed to jsPDF.lines");for(It(t,r),o=n[0],i=n[1],c=e.length,f=t,g=r,l=0;l<c;l++)2===(d=e[l]).length?(f=d[0]*o+f,g=d[1]*i+g,Tt(f,g)):(u=d[0]*o+f,h=d[1]*i+g,m=d[2]*o+f,p=d[3]*i+g,f=d[4]*o+f,g=d[5]*i+g,Lt(u,h,m,p,f,g));return s&&kt(),Ct(a),this},m.path=function(e){for(var t=0;t<e.length;t++){var r=e[t],n=r.c;switch(r.op){case"m":It(n[0],n[1]);break;case"l":Tt(n[0],n[1]);break;case"c":Lt.apply(this,n);break;case"h":kt()}}return this},m.__private__.rect=m.rect=function(e,t,r,n,a){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||!Nt(a))throw new Error("Invalid arguments passed to jsPDF.rect");return y===x&&(n=-n),Q([S(P(e)),S(_(t)),S(P(r)),S(P(n)),"re"].join(" ")),Ct(a),this},m.__private__.triangle=m.triangle=function(e,t,r,n,a,s,o){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(a)||isNaN(s)||!Nt(o))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[r-e,n-t],[a-r,s-n],[e-a,t-s]],e,t,[1,1],o,!0),this},m.__private__.roundedRect=m.roundedRect=function(e,t,r,n,a,s,o){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(a)||isNaN(s)||!Nt(o))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var i=4/3*(Math.SQRT2-1);return a=Math.min(a,.5*r),s=Math.min(s,.5*n),this.lines([[r-2*a,0],[a*i,0,a,s-s*i,a,s],[0,n-2*s],[0,s*i,-a*i,s,-a,s],[2*a-r,0],[-a*i,0,-a,-s*i,-a,-s],[0,2*s-n],[0,-s*i,a*i,-s,a,-s]],e+a,t,[1,1],o,!0),this},m.__private__.ellipse=m.ellipse=function(e,t,r,n,a){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||!Nt(a))throw new Error("Invalid arguments passed to jsPDF.ellipse");var s=4/3*(Math.SQRT2-1)*r,o=4/3*(Math.SQRT2-1)*n;return It(e+r,t),Lt(e+r,t-o,e+s,t-n,e,t-n),Lt(e-s,t-n,e-r,t-o,e-r,t),Lt(e-r,t+o,e-s,t+n,e,t+n),Lt(e+s,t+n,e+r,t+o,e+r,t),Ct(a),this},m.__private__.circle=m.circle=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||!Nt(n))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(e,t,r,r,n)},m.setFont=function(e,t,r){return r&&(t=N(t,r)),ue=lt(e,t,{disableWarning:!1}),this};var Dt=m.__private__.getFont=m.getFont=function(){return ge[lt.apply(m,arguments)]};m.__private__.getFontList=m.getFontList=function(){var e,t,r={};for(e in ve)if(ve.hasOwnProperty(e))for(t in r[e]=[],ve[e])ve[e].hasOwnProperty(t)&&r[e].push(t);return r},m.addFont=function(e,t,r,n,a){var s=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==s.indexOf(arguments[3])?a=arguments[3]:arguments[3]&&-1==s.indexOf(arguments[3])&&(r=N(r,n)),tt.call(this,e,t,r,a=a||"Identity-H")};var Mt,Ot=e.lineWidth||.200025,Rt=m.__private__.getLineWidth=m.getLineWidth=function(){return Ot},Ft=m.__private__.setLineWidth=m.setLineWidth=function(e){return Ot=e,Q(S(P(e))+" w"),this};m.__private__.setLineDash=np.API.setLineDash=np.API.setLineDashPattern=function(e,t){if(e=e||[],t=t||0,isNaN(t)||!Array.isArray(e))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return e=e.map(function(e){return S(P(e))}).join(" "),t=S(P(t)),Q("["+e+"] "+t+" d"),this};var Ut=m.__private__.getLineHeight=m.getLineHeight=function(){return te*Mt};m.__private__.getLineHeight=m.getLineHeight=function(){return te*Mt};var Bt=m.__private__.setLineHeightFactor=m.setLineHeightFactor=function(e){return"number"==typeof(e=e||1.15)&&(Mt=e),this},zt=m.__private__.getLineHeightFactor=m.getLineHeightFactor=function(){return Mt};Bt(e.lineHeight);var Wt=m.__private__.getHorizontalCoordinate=function(e){return P(e)},qt=m.__private__.getVerticalCoordinate=function(e){return y===b?e:ke[U].mediaBox.topRightY-ke[U].mediaBox.bottomLeftY-P(e)},Vt=m.__private__.getHorizontalCoordinateString=m.getHorizontalCoordinateString=function(e){return S(Wt(e))},Ht=m.__private__.getVerticalCoordinateString=m.getVerticalCoordinateString=function(e){return S(qt(e))},Gt=e.strokeColor||"0 G";m.__private__.getStrokeColor=m.getDrawColor=function(){return We(Gt)},m.__private__.setStrokeColor=m.setDrawColor=function(e,t,r,n){return Gt=qe({ch1:e,ch2:t,ch3:r,ch4:n,pdfColorType:"draw",precision:2}),Q(Gt),this};var Kt=e.fillColor||"0 g";m.__private__.getFillColor=m.getFillColor=function(){return We(Kt)},m.__private__.setFillColor=m.setFillColor=function(e,t,r,n){return Kt=qe({ch1:e,ch2:t,ch3:r,ch4:n,pdfColorType:"fill",precision:2}),Q(Kt),this};var Jt=e.textColor||"0 g",Yt=m.__private__.getTextColor=m.getTextColor=function(){return We(Jt)};m.__private__.setTextColor=m.setTextColor=function(e,t,r,n){return Jt=qe({ch1:e,ch2:t,ch3:r,ch4:n,pdfColorType:"text",precision:3}),this};var Xt=e.charSpace,Qt=m.__private__.getCharSpace=m.getCharSpace=function(){return parseFloat(Xt||0)};m.__private__.setCharSpace=m.setCharSpace=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Xt=e,this};var Zt=0;m.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},m.__private__.setLineCap=m.setLineCap=function(e){var t=m.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Zt=t,Q(t+" J"),this};var $t=0;m.__private__.setLineJoin=m.setLineJoin=function(e){var t=m.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return $t=t,Q(t+" j"),this},m.__private__.setLineMiterLimit=m.__private__.setMiterLimit=m.setLineMiterLimit=m.setMiterLimit=function(e){if(e=e||0,isNaN(e))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Q(S(P(e))+" M"),this},m.GState=$m,m.setGState=function(e){(e="string"==typeof e?we[je[e]]:er(null,e)).equals(Ne)||(Q("/"+e.id+" gs"),Ne=e)};var er=function(e,t){if(!e||!je[e]){var r=!1;for(var n in we)if(we.hasOwnProperty(n)&&we[n].equals(t)){r=!0;break}if(r)t=we[n];else{var a="GS"+(Object.keys(we).length+1).toString(10);we[a]=t,t.id=a}return e&&(je[e]=t.id),Ae.publish("addGState",t),t}};m.addGState=function(e,t){return er(e,t),this},m.saveGraphicsState=function(){return Q("q"),xe.push({key:ue,size:te,color:Jt}),this},m.restoreGraphicsState=function(){Q("Q");var e=xe.pop();return ue=e.key,te=e.size,Jt=e.color,Ne=null,this},m.setCurrentTransformationMatrix=function(e){return Q(e.toString()+" cm"),this},m.comment=function(e){return Q("#"+e),this};var tr=function(e,t){var r=e||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return r},set:function(e){isNaN(e)||(r=parseFloat(e))}});var n=t||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return n},set:function(e){isNaN(e)||(n=parseFloat(e))}});var a="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return a},set:function(e){a=e.toString()}}),this},rr=function(e,t,r,n){tr.call(this,e,t),this.type="rect";var a=r||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return a},set:function(e){isNaN(e)||(a=parseFloat(e))}});var s=n||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return s},set:function(e){isNaN(e)||(s=parseFloat(e))}}),this},nr=function(){this.page=Se,this.currentPage=U,this.pages=K.slice(0),this.pagesContext=ke.slice(0),this.x=me,this.y=pe,this.matrix=fe,this.width=or(U),this.height=lr(U),this.outputDestination=Y,this.id="",this.objectNumber=-1};nr.prototype.restore=function(){Se=this.page,U=this.currentPage,ke=this.pagesContext,K=this.pages,me=this.x,pe=this.y,fe=this.matrix,ir(U,this.width),cr(U,this.height),Y=this.outputDestination};var ar=function(e,t,r,n,a){_e.push(new nr),Se=U=0,K=[],me=e,pe=t,fe=a,nt([r,n])};for(var sr in m.beginFormObject=function(e,t,r,n,a){return ar(e,t,r,n,a),this},m.endFormObject=function(e){return function(e){if(Pe[e])_e.pop().restore();else{var t=new nr,r="Xo"+(Object.keys(Ee).length+1).toString(10);t.id=r,Pe[e]=r,Ee[r]=t,Ae.publish("addFormObject",t),_e.pop().restore()}}(e),this},m.doFormObject=function(e,t){var r=Ee[Pe[e]];return Q("q"),Q(t.toString()+" cm"),Q("/"+r.id+" Do"),Q("Q"),this},m.getFormObject=function(e){var t=Ee[Pe[e]];return{x:t.x,y:t.y,width:t.width,height:t.height,matrix:t.matrix}},m.save=function(e,t){return e=e||"generated.pdf",(t=t||{}).returnPromise=t.returnPromise||!1,!1===t.returnPromise?(_m(ft(pt()),e),"function"==typeof _m.unload&&Sm.setTimeout&&setTimeout(_m.unload,911),this):new Promise(function(t,r){try{var a=_m(ft(pt()),e);"function"==typeof _m.unload&&Sm.setTimeout&&setTimeout(_m.unload,911),t(a)}catch(n){r(n.message)}})},np.API)np.API.hasOwnProperty(sr)&&("events"===sr&&np.API.events.length?function(e,t){var r,n,a;for(a=t.length-1;-1!==a;a--)r=t[a][0],n=t[a][1],e.subscribe.apply(e,[r].concat("function"==typeof n?[n]:n))}(Ae,np.API.events):m[sr]=np.API[sr]);function or(e){return ke[e].mediaBox.topRightX-ke[e].mediaBox.bottomLeftX}function ir(e,t){ke[e].mediaBox.topRightX=t+ke[e].mediaBox.bottomLeftX}function lr(e){return ke[e].mediaBox.topRightY-ke[e].mediaBox.bottomLeftY}function cr(e,t){ke[e].mediaBox.topRightY=t+ke[e].mediaBox.bottomLeftY}var dr=m.getPageWidth=function(e){return or(e=e||U)/he},ur=m.setPageWidth=function(e,t){ir(e,t*he)},hr=m.getPageHeight=function(e){return lr(e=e||U)/he},mr=m.setPageHeight=function(e,t){cr(e,t*he)};return m.internal={pdfEscape:rt,getStyle:St,getFont:Dt,getFontSize:ne,getCharSpace:Qt,getTextColor:Yt,getLineHeight:Ut,getLineHeightFactor:zt,getLineWidth:Rt,write:Z,getHorizontalCoordinate:Wt,getVerticalCoordinate:qt,getCoordinateString:Vt,getVerticalCoordinateString:Ht,collections:{},newObject:Oe,newAdditionalObject:Ue,newObjectDeferred:Re,newObjectDeferredBegin:Fe,getFilters:Ve,putStream:He,events:Ae,scaleFactor:he,pageSize:{getWidth:function(){return dr(U)},setWidth:function(e){ur(U,e)},getHeight:function(){return hr(U)},setHeight:function(e){mr(U,e)}},encryptionOptions:d,encryption:xt,getEncryptor:function(e){return null!==d?xt.encryptor(e,0):function(e){return e}},output:gt,getNumberOfPages:it,get pages(){return K},out:Q,f2:C,f3:E,getPageInfo:bt,getPageInfoByObjId:yt,getCurrentPageInfo:wt,getPDFVersion:f,Point:tr,Rectangle:rr,Matrix:Ie,hasHotfix:vt},Object.defineProperty(m.internal.pageSize,"width",{get:function(){return dr(U)},set:function(e){ur(U,e)},enumerable:!0,configurable:!0}),Object.defineProperty(m.internal.pageSize,"height",{get:function(){return hr(U)},set:function(e){mr(U,e)},enumerable:!0,configurable:!0}),function(e){for(var t=0,r=ee.length;t<r;t++){var n=tt.call(this,e[t][0],e[t][1],e[t][2],ee[t][3],!0);!1===u&&(h[n]=!0);var a=e[t][0].split("-");et({id:n,fontName:a[0],fontStyle:a[1]||""})}Ae.publish("addFonts",{fonts:ge,dictionary:ve})}.call(m,ee),ue="F1",at(a,r),Ae.publish("initialized"),m}Xm.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},Xm.prototype.toHexString=function(e){return e.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Xm.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},Xm.prototype.processOwnerPassword=function(e,t){return Jm(Hm(t).substr(0,5),e)},Xm.prototype.encryptor=function(e,t){var r=Hm(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(e){return Jm(r,e)}},$m.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||(0,hl.A)(e)!==(0,hl.A)(this))return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t))return!1;if(this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return 0===n},np.API={events:[]},np.version="3.0.4";var ap=np.API,sp=1,op=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ip=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},lp=function(e){return e.toFixed(2)},cp=function(e){return e.toFixed(5)};ap.__acroform__={};var dp=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},up=function(e){return e*sp},hp=function(e){var t=new Ep,r=Wp.internal.getHeight(e)||0,n=Wp.internal.getWidth(e)||0;return t.BBox=[0,0,Number(lp(n)),Number(lp(r))],t},mp=ap.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},pp=ap.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},fp=ap.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},gp=ap.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return fp(e,t-1)},vp=ap.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return mp(e,t-1)},xp=ap.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return pp(e,t-1)},bp=ap.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,a=e[0],s=e[1],o=e[2],i=e[3],l={};return l.lowerLeft_X=r(a)||0,l.lowerLeft_Y=n(s+i)||0,l.upperRight_X=r(a+o)||0,l.upperRight_Y=n(s)||0,[Number(lp(l.lowerLeft_X)),Number(lp(l.lowerLeft_Y)),Number(lp(l.upperRight_X)),Number(lp(l.upperRight_Y))]},yp=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=wp(e,r),a=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+a+" "+lp(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=hp(e);return s.scope=e.scope,s.stream=t.join("\n"),s}},wp=function(e,t){var r=0===e.fontSize?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},a=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" ");a=e.multiline?a.map(function(e){return e.split("\n")}):a.map(function(e){return[e]});var s=r,o=Wp.internal.getHeight(e)||0;o=o<0?-o:o;var i=Wp.internal.getWidth(e)||0;i=i<0?-i:i;var l=function(t,r,n){if(t+1<a.length){var s=r+" "+a[t+1][0];return jp(s,e,n).width<=i-4}return!1};s++;e:for(;s>0;){t="",s--;var c,d,u=jp("3",e,s).height,h=e.multiline?o-s:(o-u)/2,m=h+=2,p=0,f=0,g=0;if(s<=0){t="(...) Tj\n",t+="% Width of Text: "+jp(t,e,s=12).width+", FieldWidth:"+i+"\n";break}for(var v="",x=0,b=0;b<a.length;b++)if(a.hasOwnProperty(b)){var y=!1;if(1!==a[b].length&&g!==a[b].length-1){if((u+2)*(x+2)+2>o)continue e;v+=a[b][g],y=!0,f=b,b--}else{v=" "==(v+=a[b][g]+" ").substr(v.length-1)?v.substr(0,v.length-1):v;var w=parseInt(b),j=l(w,v,s),N=b>=a.length-1;if(j&&!N){v+=" ",g=0;continue}if(j||N){if(N)f=w;else if(e.multiline&&(u+2)*(x+2)+2>o)continue e}else{if(!e.multiline)continue e;if((u+2)*(x+2)+2>o)continue e;f=w}}for(var S="",k=p;k<=f;k++){var A=a[k];if(e.multiline){if(k===f){S+=A[g]+" ",g=(g+1)%A.length;continue}if(k===p){S+=A[A.length-1]+" ";continue}}S+=A[0]+" "}switch(S=" "==S.substr(S.length-1)?S.substr(0,S.length-1):S,d=jp(S,e,s).width,e.textAlign){case"right":c=i-d-2;break;case"center":c=(i-d)/2;break;default:c=2}t+=lp(c)+" "+lp(m)+" Td\n",t+="("+op(S)+") Tj\n",t+=-lp(c)+" 0 Td\n",m=-(s+2),d=0,p=y?f:f+1,x++,v=""}break}return n.text=t,n.fontSize=s,n},jp=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),a=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:a}},Np={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Sp=function(e,t){var r={type:"reference",object:e};void 0===t.internal.getPageInfo(e.page).pageContext.annotations.find(function(e){return e.type===r.type&&e.object===r.object})&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},kp=ap.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(e){return e};if(Array.isArray(e)){for(var a="[",s=0;s<e.length;s++)switch(0!==s&&(a+=" "),(0,hl.A)(e[s])){case"boolean":case"number":case"object":a+=e[s].toString();break;case"string":"/"!==e[s].substr(0,1)?(void 0!==t&&r&&(n=r.internal.getEncryptor(t)),a+="("+op(n(e[s].toString()))+")"):a+=e[s].toString()}return a+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Ap=function(e,t,r){var n=function(e){return e};return void 0!==t&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),"("+op(n(e))+")"},Cp=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Cp.prototype.toString=function(){return this.objId+" 0 R"},Cp.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},Cp.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"scope"!=e&&"objId"!=e&&"_"!=e.substring(0,1)});for(var r in t)if(!1===Object.getOwnPropertyDescriptor(this,t[r]).configurable){var n=t[r],a=this[n];a&&(Array.isArray(a)?e.push({key:n,value:kp(a,this.objId,this.scope)}):a instanceof Cp?(a.scope=this.scope,e.push({key:n,value:a.objId+" 0 R"})):"function"!=typeof a&&e.push({key:n,value:a}))}return e};var Ep=function(){Cp.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){e=t.trim()},get:function(){return e||null}})};dp(Ep,Cp);var Pp=function(){Cp.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+op(t(e))+")"}},set:function(t){e=t}})};dp(Pp,Cp);var _p=function e(){Cp.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(t,3))},set:function(e){!0===Boolean(e)?this.F=vp(t,3):this.F=xp(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute Ff supplied.');r=e}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==n.length)return n},set:function(e){n=void 0!==e?e:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(e){n[0]=e}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(e){n[1]=e}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(e){n[2]=e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(e){n[3]=e}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(e){switch(e){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=e;break;default:throw new Error('Invalid value "'+e+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof Fp)return;s="FieldObject"+e.FieldNum++}var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+op(t(s))+")"},set:function(e){s=e.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(e){s=e}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(e){o=e}});var i="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){i=e}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(e){l=e}});var c=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===c?50/sp:c},set:function(e){c=e}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(e){d=e}});var u="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!u||this instanceof Fp||this instanceof Bp))return Ap(u,this.objId,this.scope)},set:function(e){e=e.toString(),u=e}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof Mp==0?Ap(h,this.objId,this.scope):h},set:function(e){e=e.toString(),h=this instanceof Mp==0?"("===e.substr(0,1)?ip(e.substr(1,e.length-2)):ip(e):e}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Mp==1?ip(h.substr(1,h.length-1)):h},set:function(e){e=e.toString(),h=this instanceof Mp==1?"/"+e:e}});var m=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(m)return m},set:function(e){this.V=e}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof Mp==0?Ap(m,this.objId,this.scope):m},set:function(e){e=e.toString(),m=this instanceof Mp==0?"("===e.substr(0,1)?ip(e.substr(1,e.length-2)):ip(e):e}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Mp==1?ip(m.substr(1,m.length-1)):m},set:function(e){e=e.toString(),m=this instanceof Mp==1?"/"+e:e}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var p,f=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return f},set:function(e){e=Boolean(e),f=e}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(p)return p},set:function(e){p=e}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,1))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,1):this.Ff=xp(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,2))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,2):this.Ff=xp(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,3))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,3):this.Ff=xp(this.Ff,3)}});var g=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==g)return g},set:function(e){if(-1===[0,1,2].indexOf(e))throw new Error('Invalid value "'+e+'" for attribute Q supplied.');g=e}}),Object.defineProperty(this,"textAlign",{get:function(){var e;switch(g){case 0:default:e="left";break;case 1:e="center";break;case 2:e="right"}return e},configurable:!0,enumerable:!0,set:function(e){switch(e){case"right":case 2:g=2;break;case"center":case 1:g=1;break;default:g=0}}})};dp(_p,Cp);var Ip=function(){_p.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){e=t}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return kp(t,this.objId,this.scope)},set:function(e){var r,n;n=[],"string"==typeof(r=e)&&(n=function(e,t,r){r||(r=1);for(var n,a=[];n=t.exec(e);)a.push(n[r]);return a}(r,/\((.*?)\)/g)),t=n}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,r){for(r=r||!1,e=(e=e||"").toString();-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!1!==r););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,18))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,18):this.Ff=xp(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,19))},set:function(e){!0===this.combo&&(!0===Boolean(e)?this.Ff=vp(this.Ff,19):this.Ff=xp(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,20))},set:function(e){!0===Boolean(e)?(this.Ff=vp(this.Ff,20),t.sort()):this.Ff=xp(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,22))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,22):this.Ff=xp(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,23):this.Ff=xp(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,27))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,27):this.Ff=xp(this.Ff,27)}}),this.hasAppearanceStream=!1};dp(Ip,_p);var Tp=function(){Ip.call(this),this.fontName="helvetica",this.combo=!1};dp(Tp,Ip);var Lp=function(){Tp.call(this),this.combo=!0};dp(Lp,Tp);var Dp=function(){Lp.call(this),this.edit=!0};dp(Dp,Lp);var Mp=function(){_p.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,15))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,15):this.Ff=xp(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,16))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,16):this.Ff=xp(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,17))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,17):this.Ff=xp(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,26):this.Ff=xp(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(t).length){var r,n=[];for(r in n.push("<<"),t)n.push("/"+r+" ("+op(e(t[r]))+")");return n.push(">>"),n.join("\n")}},set:function(e){"object"===(0,hl.A)(e)&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){"string"==typeof e&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(t){e="/"+t}})};dp(Mp,_p);var Op=function(){Mp.call(this),this.pushButton=!0};dp(Op,Mp);var Rp=function(){Mp.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=void 0!==t?t:[]}})};dp(Rp,Mp);var Fp=function(){var e,t;_p.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(e){t=e}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};this.scope&&(e=this.scope.internal.getEncryptor(this.objId));var t,r=[];for(t in r.push("<<"),n)r.push("/"+t+" ("+op(e(n[t]))+")");return r.push(">>"),r.join("\n")},set:function(e){"object"===(0,hl.A)(e)&&(n=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(e){"string"==typeof e&&(n.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(e){r="/"+e}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Wp.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};dp(Fp,_p),Rp.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},Rp.prototype.createOption=function(e){var t=new Fp;return t.Parent=this,t.optionName=e,this.Kids.push(t),qp.call(this.scope,t),t};var Up=function(){Mp.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Wp.CheckBox.createAppearanceStream()};dp(Up,Mp);var Bp=function(){_p.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,13))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,13):this.Ff=xp(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,21))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,21):this.Ff=xp(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,23):this.Ff=xp(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,24))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,24):this.Ff=xp(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,25))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,25):this.Ff=xp(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,26):this.Ff=xp(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};dp(Bp,_p);var zp=function(){Bp.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(gp(this.Ff,14))},set:function(e){!0===Boolean(e)?this.Ff=vp(this.Ff,14):this.Ff=xp(this.Ff,14)}}),this.password=!0};dp(zp,Bp);var Wp={CheckBox:{createAppearanceStream:function(){return{N:{On:Wp.CheckBox.YesNormal},D:{On:Wp.CheckBox.YesPushDown,Off:Wp.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=hp(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,a=e.scope.__private__.encodeColorString(e.color),s=wp(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+lp(Wp.internal.getWidth(e))+" "+lp(Wp.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+lp(s.fontSize)+" Tf "+a),r.push("BT"),r.push(s.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join("\n"),t},YesNormal:function(e){var t=hp(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),a=[],s=Wp.internal.getHeight(e),o=Wp.internal.getWidth(e),i=wp(e,e.caption);return a.push("1 g"),a.push("0 0 "+lp(o)+" "+lp(s)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+lp(o-1)+" "+lp(s-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+r+" "+lp(i.fontSize)+" Tf "+n),a.push(i.text),a.push("ET"),a.push("Q"),t.stream=a.join("\n"),t},OffPushDown:function(e){var t=hp(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+lp(Wp.internal.getWidth(e))+" "+lp(Wp.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join("\n"),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:Wp.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=Wp.RadioButton.Circle.YesNormal,t.D[e]=Wp.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=hp(e);t.scope=e.scope;var r=[],n=Wp.internal.getWidth(e)<=Wp.internal.getHeight(e)?Wp.internal.getWidth(e)/4:Wp.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Wp.internal.Bezier_C,s=Number((n*a).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+cp(Wp.internal.getWidth(e)/2)+" "+cp(Wp.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join("\n"),t},YesPushDown:function(e){var t=hp(e);t.scope=e.scope;var r=[],n=Wp.internal.getWidth(e)<=Wp.internal.getHeight(e)?Wp.internal.getWidth(e)/4:Wp.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Number((2*n).toFixed(5)),s=Number((a*Wp.internal.Bezier_C).toFixed(5)),o=Number((n*Wp.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+cp(Wp.internal.getWidth(e)/2)+" "+cp(Wp.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+s+" "+s+" "+a+" 0 "+a+" c"),r.push("-"+s+" "+a+" -"+a+" "+s+" -"+a+" 0 c"),r.push("-"+a+" -"+s+" -"+s+" -"+a+" 0 -"+a+" c"),r.push(s+" -"+a+" "+a+" -"+s+" "+a+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+cp(Wp.internal.getWidth(e)/2)+" "+cp(Wp.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join("\n"),t},OffPushDown:function(e){var t=hp(e);t.scope=e.scope;var r=[],n=Wp.internal.getWidth(e)<=Wp.internal.getHeight(e)?Wp.internal.getWidth(e)/4:Wp.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Number((2*n).toFixed(5)),s=Number((a*Wp.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+cp(Wp.internal.getWidth(e)/2)+" "+cp(Wp.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+s+" "+s+" "+a+" 0 "+a+" c"),r.push("-"+s+" "+a+" -"+a+" "+s+" -"+a+" 0 c"),r.push("-"+a+" -"+s+" -"+s+" -"+a+" 0 -"+a+" c"),r.push(s+" -"+a+" "+a+" -"+s+" "+a+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join("\n"),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:Wp.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=Wp.RadioButton.Cross.YesNormal,t.D[e]=Wp.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=hp(e);t.scope=e.scope;var r=[],n=Wp.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+lp(Wp.internal.getWidth(e)-2)+" "+lp(Wp.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(lp(n.x1.x)+" "+lp(n.x1.y)+" m"),r.push(lp(n.x2.x)+" "+lp(n.x2.y)+" l"),r.push(lp(n.x4.x)+" "+lp(n.x4.y)+" m"),r.push(lp(n.x3.x)+" "+lp(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join("\n"),t},YesPushDown:function(e){var t=hp(e);t.scope=e.scope;var r=Wp.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+lp(Wp.internal.getWidth(e))+" "+lp(Wp.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+lp(Wp.internal.getWidth(e)-2)+" "+lp(Wp.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(lp(r.x1.x)+" "+lp(r.x1.y)+" m"),n.push(lp(r.x2.x)+" "+lp(r.x2.y)+" l"),n.push(lp(r.x4.x)+" "+lp(r.x4.y)+" m"),n.push(lp(r.x3.x)+" "+lp(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join("\n"),t},OffPushDown:function(e){var t=hp(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+lp(Wp.internal.getWidth(e))+" "+lp(Wp.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join("\n"),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};Wp.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=Wp.internal.getWidth(e),r=Wp.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},Wp.internal.getWidth=function(e){var t=0;return"object"===(0,hl.A)(e)&&(t=up(e.Rect[2])),t},Wp.internal.getHeight=function(e){var t=0;return"object"===(0,hl.A)(e)&&(t=up(e.Rect[3])),t};var qp=ap.addField=function(e){if(function(e,t){if(t.scope=e,void 0!==e.internal&&(void 0===e.internal.acroformPlugin||!1===e.internal.acroformPlugin.isInitialized)){if(_p.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(Np)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");sp=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new Pp,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){!function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0}(e)}),e.internal.events.subscribe("buildDocument",function(){!function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var t=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];n.objId=void 0,n.hasAnnotation&&Sp(n,e)}}(e)}),e.internal.events.subscribe("putCatalog",function(){!function(e){if(void 0===e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(e)}),e.internal.events.subscribe("postPutPages",function(t){!function(e,t){var r=!e;for(var n in e||(t.internal.newObjectDeferredBegin(t.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),t.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),e=e||t.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(e.hasOwnProperty(n)){var a=e[n],s=[],o=a.Rect;if(a.Rect&&(a.Rect=bp(a.Rect,t)),t.internal.newObjectDeferredBegin(a.objId,!0),a.DA=Wp.createDefaultAppearanceStream(a),"object"===(0,hl.A)(a)&&"function"==typeof a.getKeyValueListForStream&&(s=a.getKeyValueListForStream()),a.Rect=o,a.hasAppearanceStream&&!a.appearanceStreamContent){var i=yp(a);s.push({key:"AP",value:"<</N "+i+">>"}),t.internal.acroformPlugin.xForms.push(i)}if(a.appearanceStreamContent){var l="";for(var c in a.appearanceStreamContent)if(a.appearanceStreamContent.hasOwnProperty(c)){var d=a.appearanceStreamContent[c];if(l+="/"+c+" ",l+="<<",Object.keys(d).length>=1||Array.isArray(d)){for(var n in d)if(d.hasOwnProperty(n)){var u=d[n];"function"==typeof u&&(u=u.call(t,a)),l+="/"+n+" "+u+" ",t.internal.acroformPlugin.xForms.indexOf(u)>=0||t.internal.acroformPlugin.xForms.push(u)}}else"function"==typeof(u=d)&&(u=u.call(t,a)),l+="/"+n+" "+u,t.internal.acroformPlugin.xForms.indexOf(u)>=0||t.internal.acroformPlugin.xForms.push(u);l+=">>"}s.push({key:"AP",value:"<<\n"+l+">>"})}t.internal.putStream({additionalKeyValues:s,objectId:a.objId}),t.internal.out("endobj")}r&&function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=r,a=e[r];t.internal.newObjectDeferredBegin(a.objId,!0),"object"===(0,hl.A)(a)&&"function"==typeof a.putStream&&a.putStream(),delete e[n]}}(t.internal.acroformPlugin.xForms,t)}(t,e)}),e.internal.acroformPlugin.isInitialized=!0}}(this,e),!(e instanceof _p))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};ap.AcroFormChoiceField=Ip,ap.AcroFormListBox=Tp,ap.AcroFormComboBox=Lp,ap.AcroFormEditBox=Dp,ap.AcroFormButton=Mp,ap.AcroFormPushButton=Op,ap.AcroFormRadioButton=Rp,ap.AcroFormCheckBox=Up,ap.AcroFormTextField=Bp,ap.AcroFormPasswordField=zp,ap.AcroFormAppearance=Wp,ap.AcroForm={ChoiceField:Ip,ListBox:Tp,ComboBox:Lp,EditBox:Dp,Button:Mp,PushButton:Op,RadioButton:Rp,CheckBox:Up,TextField:Bp,PasswordField:zp,Appearance:Wp},np.AcroForm={ChoiceField:Ip,ListBox:Tp,ComboBox:Lp,EditBox:Dp,Button:Mp,PushButton:Op,RadioButton:Rp,CheckBox:Up,TextField:Bp,PasswordField:zp,Appearance:Wp};np.AcroForm;function Vp(e){return e.reduce(function(e,t,r){return e[t]=r,e},{})}!function(e){var t="addImage_";e.__addimage__={};var r="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=e.__addimage__.getImageFileTypeByImageData=function(e,t){var a,s,o,i,l,c=r;if("RGBA"===(t=t||r)||void 0!==e.data&&e.data instanceof Uint8ClampedArray&&"height"in e&&"width"in e)return"RGBA";if(j(e))for(l in n)for(o=n[l],a=0;a<o.length;a+=1){for(i=!0,s=0;s<o[a].length;s+=1)if(void 0!==o[a][s]&&o[a][s]!==e[s]){i=!1;break}if(!0===i){c=l;break}}else for(l in n)for(o=n[l],a=0;a<o.length;a+=1){for(i=!0,s=0;s<o[a].length;s+=1)if(void 0!==o[a][s]&&o[a][s]!==e.charCodeAt(s)){i=!1;break}if(!0===i){c=l;break}}return c===r&&t!==r&&(c=t),c},s=function e(t){for(var r=this.internal.write,n=this.internal.putStream,a=(0,this.internal.getFilters)();-1!==a.indexOf("FlateEncode");)a.splice(a.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var s=[];if(s.push({key:"Type",value:"/XObject"}),s.push({key:"Subtype",value:"/Image"}),s.push({key:"Width",value:t.width}),s.push({key:"Height",value:t.height}),t.colorSpace===v.INDEXED?s.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(s.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===v.DEVICE_CMYK&&s.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),s.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&s.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)&&t.transparency.length>0){for(var o="",i=0,l=t.transparency.length;i<l;i++)o+=t.transparency[i]+" "+t.transparency[i]+" ";s.push({key:"Mask",value:"["+o+"]"})}void 0!==t.sMask&&s.push({key:"SMask",value:t.objectId+1+" 0 R"});var c=void 0!==t.filter?["/"+t.filter]:void 0;if(n({data:t.data,additionalKeyValues:s,alreadyAppliedFilters:c,objectId:t.objectId}),r("endobj"),"sMask"in t&&void 0!==t.sMask){var d,u=null!==(d=t.sMaskBitsPerComponent)&&void 0!==d?d:t.bitsPerComponent,h={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:u,data:t.sMask};"filter"in t&&(h.decodeParameters="/Predictor ".concat(t.predictor," /Colors 1 /BitsPerComponent ").concat(u," /Columns ").concat(t.width),h.filter=t.filter),e.call(this,h)}if(t.colorSpace===v.INDEXED){var m=this.internal.newObject();n({data:S(new Uint8Array(t.palette)),objectId:m}),r("endobj")}},o=function(){var e=this.internal.collections[t+"images"];for(var r in e)s.call(this,e[r])},i=function(){var e,r=this.internal.collections[t+"images"],n=this.internal.write;for(var a in r)n("/I"+(e=r[a]).index,e.objectId,"0","R")},l=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",i))},c=function(){var e=this.internal.collections[t+"images"];return l.call(this),e},d=function(){return Object.keys(this.internal.collections[t+"images"]).length},u=function(t){return"function"==typeof e["process"+t.toUpperCase()]},h=function(e){return"object"===(0,hl.A)(e)&&1===e.nodeType},m=function(t,r){if("IMG"===t.nodeName&&t.hasAttribute("src")){var n=""+t.getAttribute("src");if(0===n.indexOf("data:image/"))return Tm(unescape(n).split("base64,").pop());var a=e.loadFile(n,!0);if(void 0!==a)return a}if("CANVAS"===t.nodeName){if(0===t.width||0===t.height)throw new Error("Given canvas must have data. Canvas width: "+t.width+", height: "+t.height);var s;switch(r){case"PNG":s="image/png";break;case"WEBP":s="image/webp";break;default:s="image/jpeg"}return Tm(t.toDataURL(s,1).split("base64,").pop())}},p=function(e){var r=this.internal.collections[t+"images"];if(r)for(var n in r)if(e===r[n].alias)return r[n]},f=function(e,t,r){return e||t||(e=-96,t=-96),e<0&&(e=-1*r.width*72/e/this.internal.scaleFactor),t<0&&(t=-1*r.height*72/t/this.internal.scaleFactor),0===e&&(e=t*r.width/r.height),0===t&&(t=e*r.height/r.width),[e,t]},g=function(e,t,r,n,a,s){var o=f.call(this,r,n,a),i=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,d=c.call(this);if(r=o[0],n=o[1],d[a.index]=a,s){s*=Math.PI/180;var u=Math.cos(s),h=Math.sin(s),m=function(e){return e.toFixed(4)},p=[m(u),m(h),m(-1*h),m(u),0,0,"cm"]}this.internal.write("q"),s?(this.internal.write([1,"0","0",1,i(e),l(t+n),"cm"].join(" ")),this.internal.write(p.join(" ")),this.internal.write([i(r),"0","0",i(n),"0","0","cm"].join(" "))):this.internal.write([i(r),"0","0",i(n),i(e),l(t+n),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+a.index+" Do"),this.internal.write("Q")},v=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var x=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},b=e.__addimage__.sHashCode=function(e){var t,r,n=0;if("string"==typeof e)for(r=e.length,t=0;t<r;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;else if(j(e))for(r=e.byteLength/2,t=0;t<r;t++)n=(n<<5)-n+e[t],n|=0;return n},y=e.__addimage__.validateStringAsBase64=function(e){(e=e||"").toString().trim();var t=!0;return 0===e.length&&(t=!1),e.length%4!=0&&(t=!1),!1===/^[A-Za-z0-9+/]+$/.test(e.substr(0,e.length-2))&&(t=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(e.substr(-2))&&(t=!1),t},w=e.__addimage__.extractImageFromDataUrl=function(e){if(null==e)return null;if(!(e=e.trim()).startsWith("data:"))return null;var t=e.indexOf(",");return t<0?null:e.substring(0,t).trim().endsWith("base64")?e.substring(t+1):null};e.__addimage__.isArrayBuffer=function(e){return e instanceof ArrayBuffer};var j=e.__addimage__.isArrayBufferView=function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array},N=e.__addimage__.binaryStringToUint8Array=function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r},S=e.__addimage__.arrayBufferToBinaryString=function(e){for(var t="",r=j(e)?e:new Uint8Array(e),n=0;n<r.length;n+=8192)t+=String.fromCharCode.apply(null,r.subarray(n,n+8192));return t};e.addImage=function(){var e,t,n,a,s,o,i,c,d;if("number"==typeof arguments[1]?(t=r,n=arguments[1],a=arguments[2],s=arguments[3],o=arguments[4],i=arguments[5],c=arguments[6],d=arguments[7]):(t=arguments[1],n=arguments[2],a=arguments[3],s=arguments[4],o=arguments[5],i=arguments[6],c=arguments[7],d=arguments[8]),"object"===(0,hl.A)(e=arguments[0])&&!h(e)&&"imageData"in e){var u=e;e=u.imageData,t=u.format||t||r,n=u.x||n||0,a=u.y||a||0,s=u.w||u.width||s,o=u.h||u.height||o,i=u.alias||i,c=u.compression||c,d=u.rotation||u.angle||d}var m=this.internal.getFilters();if(void 0===c&&-1!==m.indexOf("FlateEncode")&&(c="SLOW"),isNaN(n)||isNaN(a))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var p=k.call(this,e,t,i,c);return g.call(this,n,a,s,o,p,d),this};var k=function(t,n,s,o){var i,l,c;if("string"==typeof t&&a(t)===r){t=unescape(t);var f=A(t,!1);(""!==f||void 0!==(f=e.loadFile(t,!0)))&&(t=f)}if(h(t)&&(t=m(t,n)),n=a(t,n),!u(n))throw new Error("addImage does not support files of type '"+n+"', please ensure that a plugin for '"+n+"' support is added.");if((null==(c=s)||0===c.length)&&(s=function(e){return"string"==typeof e||j(e)?b(e):j(e.data)?b(e.data):null}(t)),(i=p.call(this,s))||(t instanceof Uint8Array||"RGBA"===n||(l=t,t=N(t)),i=this["process"+n.toUpperCase()](t,d.call(this),s,function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:x.NONE}(o),l)),!i)throw new Error("An unknown error occurred whilst processing the image.");return i},A=e.__addimage__.convertBase64ToBinaryString=function(e,t){t="boolean"!=typeof t||t;var r,n="";if("string"==typeof e){var s;r=null!==(s=w(e))&&void 0!==s?s:e;try{n=Tm(r)}catch(a){if(t)throw y(r)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+a.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return n};e.getImageProperties=function(t){var n,s,o="";if(h(t)&&(t=m(t)),"string"==typeof t&&a(t)===r&&(""===(o=A(t,!1))&&(o=e.loadFile(t)||""),t=o),s=a(t),!u(s))throw new Error("addImage does not support files of type '"+s+"', please ensure that a plugin for '"+s+"' support is added.");if(t instanceof Uint8Array||(t=N(t)),!(n=this["process"+s.toUpperCase()](t)))throw new Error("An unknown error occurred whilst processing the image");return n.fileType=s,n}}(np.API),function(e){var t=function(e){if(void 0!==e&&""!=e)return!0};np.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(e){for(var r,n,a,s=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,i=this.internal.getPageInfoByObjId(e.objId),l=e.pageContext.annotations,c=!1,d=0;d<l.length&&!c;d++)switch((r=l[d]).type){case"link":(t(r.options.url)||t(r.options.pageNumber))&&(c=!0);break;case"reference":case"text":case"freetext":c=!0}if(0!=c){this.internal.write("/Annots [");for(var u=0;u<l.length;u++){r=l[u];var h=this.internal.pdfEscape,m=this.internal.getEncryptor(e.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var p=this.internal.newAdditionalObject(),f=this.internal.newAdditionalObject(),g=this.internal.getEncryptor(p.objId),v=r.title||"Note";a="<</Type /Annot /Subtype /Text "+(n="/Rect ["+s(r.bounds.x)+" "+o(r.bounds.y+r.bounds.h)+" "+s(r.bounds.x+r.bounds.w)+" "+o(r.bounds.y)+"] ")+"/Contents ("+h(g(r.contents))+")",a+=" /Popup "+f.objId+" 0 R",a+=" /P "+i.objId+" 0 R",a+=" /T ("+h(g(v))+") >>",p.content=a;var x=p.objId+" 0 R";a="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+s(r.bounds.x+30)+" "+o(r.bounds.y+r.bounds.h)+" "+s(r.bounds.x+r.bounds.w+30)+" "+o(r.bounds.y)+"] ")+" /Parent "+x,r.open&&(a+=" /Open true"),a+=" >>",f.content=a,this.internal.write(p.objId,"0 R",f.objId,"0 R");break;case"freetext":n="/Rect ["+s(r.bounds.x)+" "+o(r.bounds.y)+" "+s(r.bounds.x+r.bounds.w)+" "+o(r.bounds.y+r.bounds.h)+"] ";var b=r.color||"#000000";a="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+h(m(r.contents))+")",a+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+b+")",a+=" /Border [0 0 0]",a+=" >>",this.internal.write(a);break;case"link":if(r.options.name){var y=this.annotations._nameMap[r.options.name];r.options.pageNumber=y.page,r.options.top=y.y}else r.options.top||(r.options.top=0);if(n="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",a="",r.options.url)a="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+h(m(r.options.url))+") >>";else if(r.options.pageNumber)switch(a="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":a+=" /Fit]";break;case"FitH":a+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,a+=" /FitV "+r.options.left+"]";break;default:var w=o(r.options.top);r.options.left=r.options.left||0,void 0===r.options.zoom&&(r.options.zoom=0),a+=" /XYZ "+r.options.left+" "+w+" "+r.options.zoom+"]"}""!=a&&(a+=" >>",this.internal.write(a))}}this.internal.write("]")}}]),e.createAnnotation=function(e){var t=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":t.pageContext.annotations.push(e)}},e.link=function(e,t,r,n,a){var s=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:o(e),y:i(t),w:o(e+r),h:i(t+n)},options:a,type:"link"})},e.textWithLink=function(e,t,r,n){var a,s,o=this.getTextWidth(e),i=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==n.maxWidth){s=n.maxWidth;var l=this.splitTextToSize(e,s).length;a=Math.ceil(i*l)}else s=o,a=i;return this.text(e,t,r,n),r+=.2*i,"center"===n.align&&(t-=o/2),"right"===n.align&&(t-=o),this.link(t,r-i,s,a,n),o},e.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor}}(np.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];e.__arabicParser__={};var s=e.__arabicParser__.isInArabicSubstitutionA=function(e){return void 0!==t[e.charCodeAt(0)]},o=e.__arabicParser__.isArabicLetter=function(e){return"string"==typeof e&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(e)},i=e.__arabicParser__.isArabicEndLetter=function(e){return o(e)&&s(e)&&t[e.charCodeAt(0)].length<=2},l=e.__arabicParser__.isArabicAlfLetter=function(e){return o(e)&&a.indexOf(e.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(e){return o(e)&&s(e)&&t[e.charCodeAt(0)].length>=1};var c=e.__arabicParser__.arabicLetterHasFinalForm=function(e){return o(e)&&s(e)&&t[e.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(e){return o(e)&&s(e)&&t[e.charCodeAt(0)].length>=3};var d=e.__arabicParser__.arabicLetterHasMedialForm=function(e){return o(e)&&s(e)&&4==t[e.charCodeAt(0)].length},u=e.__arabicParser__.resolveLigatures=function(e){var t=0,n=r,a="",s=0;for(t=0;t<e.length;t+=1)void 0!==n[e.charCodeAt(t)]?(s++,"number"==typeof(n=n[e.charCodeAt(t)])&&(a+=String.fromCharCode(n),n=r,s=0),t===e.length-1&&(n=r,a+=e.charAt(t-(s-1)),t-=s-1,s=0)):(n=r,a+=e.charAt(t-s),t-=s,s=0);return a};e.__arabicParser__.isArabicDiacritic=function(e){return void 0!==e&&void 0!==n[e.charCodeAt(0)]};var h=e.__arabicParser__.getCorrectForm=function(e,t,r){return o(e)?!1===s(e)?-1:!c(e)||!o(t)&&!o(r)||!o(r)&&i(t)||i(e)&&!o(t)||i(e)&&l(t)||i(e)&&i(t)?0:d(e)&&o(t)&&!i(t)&&o(r)&&c(r)?3:i(e)||!o(r)?1:2:-1},m=function(e){var r=0,n=0,a=0,s="",i="",l="",c=(e=e||"").split("\\s+"),d=[];for(r=0;r<c.length;r+=1){for(d.push(""),n=0;n<c[r].length;n+=1)s=c[r][n],i=c[r][n-1],l=c[r][n+1],o(s)?(a=h(s,i,l),d[r]+=-1!==a?String.fromCharCode(t[s.charCodeAt(0)][a]):s):d[r]+=s;d[r]=u(d[r])}return d.join(" ")},p=e.__arabicParser__.processArabic=e.processArabic=function(){var e,t="string"==typeof arguments[0]?arguments[0]:arguments[0].text,r=[];if(Array.isArray(t)){var n=0;for(r=[],n=0;n<t.length;n+=1)Array.isArray(t[n])?r.push([m(t[n][0]),t[n][1],t[n][2]]):r.push([m(t[n])]);e=r}else e=m(t);return"string"==typeof arguments[0]?e:(arguments[0].text=e,arguments[0])};e.events.push(["preProcessText",p])}(np.API),np.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform","javascript"===e.variant?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(t){e=t}});var t=150;Object.defineProperty(this,"width",{get:function(){return t},set:function(e){t=isNaN(e)||!1===Number.isInteger(e)||e<0?150:e,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=t+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(e){r=isNaN(e)||!1===Number.isInteger(e)||e<0?300:e,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var n=[];Object.defineProperty(this,"childNodes",{get:function(){return n},set:function(e){n=e}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(e){a=e}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,t){var r;if("2d"!==(e=e||"2d"))return null;for(r in t)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=t[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(np.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var e=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var t=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var r=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return r},set:function(e){r=e}});var n=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return n},set:function(e){n=e}});var a=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return a},set:function(e){a=e}});var s=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return s},set:function(e){s=e}});var o=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return o},set:function(e){o=e}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(e){return n.call(this),this.internal.__cell__.headerFunction="function"==typeof e?e:void 0,this},e.getTextDimensions=function(e,t){n.call(this);var r=(t=t||{}).fontSize||this.getFontSize(),a=t.font||this.getFont(),s=t.scaleFactor||this.internal.scaleFactor,o=0,i=0,l=0,c=this;if(!Array.isArray(e)&&"string"!=typeof e){if("number"!=typeof e)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");e=String(e)}var d=t.maxWidth;d>0?"string"==typeof e?e=this.splitTextToSize(e,d):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(c.splitTextToSize(t,d))},[])):e=Array.isArray(e)?e:[e];for(var u=0;u<e.length;u++)o<(l=this.getStringUnitWidth(e[u],{font:a})*r)&&(o=l);return 0!==o&&(i=e.length),{w:o/=s,h:Math.max((i*r*this.getLineHeightFactor()-r*(this.getLineHeightFactor()-1))/s,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var e=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(e.left,e.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=e.cell=function(){var e;e=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),n.call(this);var a=this.internal.__cell__.lastCell,o=this.internal.__cell__.padding,i=this.internal.__cell__.margins||t,l=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return void 0!==a.lineNumber&&(a.lineNumber===e.lineNumber?(e.x=(a.x||0)+(a.width||0),e.y=a.y||0):a.y+a.height+e.height+i.bottom>this.getPageHeight()?(this.cellAddPage(),e.y=i.top,c&&l&&(this.printHeaderRow(e.lineNumber,!0),e.y+=l[0].height)):e.y=a.y+a.height||e.y),void 0!==e.text[0]&&(this.rect(e.x,e.y,e.width,e.height,!0===r?"FD":void 0),"right"===e.align?this.text(e.text,e.x+e.width-o,e.y+o,{align:"right",baseline:"top"}):"center"===e.align?this.text(e.text,e.x+e.width/2,e.y+o,{align:"center",baseline:"top",maxWidth:e.width-o-o}):this.text(e.text,e.x+o,e.y+o,{align:"left",baseline:"top",maxWidth:e.width-o-o})),this.internal.__cell__.lastCell=e,this};e.table=function(e,r,l,c,d){if(n.call(this),!l)throw new Error("No data for PDF table.");var u,h,m,p,f=[],g=[],v=[],x={},b={},y=[],w=[],j=(d=d||{}).autoSize||!1,N=!1!==d.printHeaders,S=d.css&&void 0!==d.css["font-size"]?16*d.css["font-size"]:d.fontSize||12,k=d.margins||Object.assign({width:this.getPageWidth()},t),A="number"==typeof d.padding?d.padding:3,C=d.headerBackgroundColor||"#c8c8c8",E=d.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=N,this.internal.__cell__.margins=k,this.internal.__cell__.table_font_size=S,this.internal.__cell__.padding=A,this.internal.__cell__.headerBackgroundColor=C,this.internal.__cell__.headerTextColor=E,this.setFontSize(S),null==c)g=f=Object.keys(l[0]),v=f.map(function(){return"left"});else if(Array.isArray(c)&&"object"===(0,hl.A)(c[0]))for(f=c.map(function(e){return e.name}),g=c.map(function(e){return e.prompt||e.name||""}),v=c.map(function(e){return e.align||"left"}),u=0;u<c.length;u+=1)b[c[u].name]=.7499990551181103*c[u].width;else Array.isArray(c)&&"string"==typeof c[0]&&(g=f=c,v=f.map(function(){return"left"}));if(j||Array.isArray(c)&&"string"==typeof c[0])for(u=0;u<f.length;u+=1){for(x[p=f[u]]=l.map(function(e){return e[p]}),this.setFont(void 0,"bold"),y.push(this.getTextDimensions(g[u],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),h=x[p],this.setFont(void 0,"normal"),m=0;m<h.length;m+=1)y.push(this.getTextDimensions(h[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);b[p]=Math.max.apply(null,y)+A+A,y=[]}if(N){var P={};for(u=0;u<f.length;u+=1)P[f[u]]={},P[f[u]].text=g[u],P[f[u]].align=v[u];var _=i.call(this,P,b);w=f.map(function(t){return new s(e,r,b[t],_,P[t].text,void 0,P[t].align)}),this.setTableHeaderRow(w),this.printHeaderRow(1,!1)}var I=c.reduce(function(e,t){return e[t.name]=t.align,e},{});for(u=0;u<l.length;u+=1){"rowStart"in d&&d.rowStart instanceof Function&&d.rowStart({row:u,data:l[u]},this);var T=i.call(this,l[u],b);for(m=0;m<f.length;m+=1){var L=l[u][f[m]];"cellStart"in d&&d.cellStart instanceof Function&&d.cellStart({row:u,col:m,data:L},this),o.call(this,new s(e,r,b[f[m]],T,L,u+2,I[f[m]]))}}return this.internal.__cell__.table_x=e,this.internal.__cell__.table_y=r,this};var i=function(e,t){var r=this.internal.__cell__.padding,n=this.internal.__cell__.table_font_size,a=this.internal.scaleFactor;return Object.keys(e).map(function(n){var a=e[n];return this.splitTextToSize(a.hasOwnProperty("text")?a.text:a,t[n]-r-r)},this).map(function(e){return this.getLineHeightFactor()*e.length*n/a+r+r},this).reduce(function(e,t){return Math.max(e,t)},0)};e.setTableHeaderRow=function(e){n.call(this),this.internal.__cell__.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var a;if(r=!0,"function"==typeof this.internal.__cell__.headerFunction){var i=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(i[0],i[1],i[2],i[3],void 0,-1)}this.setFont(void 0,"bold");for(var l=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1){a=this.internal.__cell__.tableHeaderRow[c].clone(),t&&(a.y=this.internal.__cell__.margins.top||0,l.push(a)),a.lineNumber=e;var d=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,a),this.setTextColor(d)}l.length>0&&this.setTableHeaderRow(l),this.setFont(void 0,"normal"),r=!1}}(np.API);var Hp={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Gp=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Kp=Vp(Gp),Jp=[100,200,300,400,500,600,700,800,900],Yp=Vp(Jp);function Xp(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(e){return Hp[e=e||"normal"]?e:"normal"}(e.style),n=function(e){return e?"number"==typeof e?e>=100&&e<=900&&e%100==0?e:400:/^\d00$/.test(e)?parseInt(e):"bold"===e?700:400:400}(e.weight),a=function(e){return"number"==typeof Kp[e=e||"normal"]?e:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:a,src:e.src||[],ref:e.ref||{name:t,style:[a,r,n].join(" ")}}}function Qp(e,t,r,n){var a;for(a=r;a>=0&&a<t.length;a+=n)if(e[t[a]])return e[t[a]];for(a=r;a>=0&&a<t.length;a-=n)if(e[t[a]])return e[t[a]]}var Zp={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},$p={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function ef(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function tf(e){return e.trimLeft()}function rf(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function nf(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===t?null:[t[0],e.substring(t[0].length)]}var af,sf,of,lf,cf,df,uf,hf,mf=["times"];function pf(e,t,r,n,a){var s=4,o=vf;switch(a){case np.API.image_compression.FAST:s=1,o=gf;break;case np.API.image_compression.MEDIUM:s=6,o=xf;break;case np.API.image_compression.SLOW:s=9,o=bf}e=function(e,t,r,n){for(var a,s=e.length/t,o=new Uint8Array(e.length+s),i=[ff,gf,vf,xf,bf],l=0;l<s;l+=1){var c=l*t,d=e.subarray(c,c+t);if(n)o.set(n(d,r,a),c+l);else{for(var u=i.length,h=[],m=0;m<u;m+=1)h[m]=i[m](d,r,a);var p=wf(h.concat());o.set(h[p],c+l)}a=d}return o}(e,t,Math.ceil(r*n/8),o);var i=Xl(e,{level:s});return np.API.__addimage__.arrayBufferToBinaryString(i)}function ff(e){var t=Array.apply([],e);return t.unshift(0),t}function gf(e,t){var r=e.length,n=[];n[0]=1;for(var a=0;a<r;a+=1){var s=e[a-t]||0;n[a+1]=e[a]-s+256&255}return n}function vf(e,t,r){var n=e.length,a=[];a[0]=2;for(var s=0;s<n;s+=1){var o=r&&r[s]||0;a[s+1]=e[s]-o+256&255}return a}function xf(e,t,r){var n=e.length,a=[];a[0]=3;for(var s=0;s<n;s+=1){var o=e[s-t]||0,i=r&&r[s]||0;a[s+1]=e[s]+256-(o+i>>>1)&255}return a}function bf(e,t,r){var n=e.length,a=[];a[0]=4;for(var s=0;s<n;s+=1){var o=yf(e[s-t]||0,r&&r[s]||0,r&&r[s-t]||0);a[s+1]=e[s]-o+256&255}return a}function yf(e,t,r){if(e===t&&t===r)return e;var n=Math.abs(t-r),a=Math.abs(e-r),s=Math.abs(e+t-r-r);return n<=a&&n<=s?e:a<=s?t:r}function wf(e){var t=e.map(function(e){return e.reduce(function(e,t){return e+Math.abs(t)},0)});return t.indexOf(Math.min.apply(null,t))}function jf(e,t,r){var n=t*r,a=Math.floor(n/8),s=16-(n-8*a+r),o=(1<<r)-1;return Sf(e,a)>>s&o}function Nf(e,t,r,n){var a=r*n,s=Math.floor(a/8),o=16-(a-8*s+n),i=(1<<n)-1,l=(t&i)<<o;!function(e,t,r){if(t+1<e.byteLength)e.setUint16(t,r,!1);else{var n=r>>8&255;e.setUint8(t,n)}}(e,s,Sf(e,s)&~(i<<o)&65535|l)}function Sf(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function kf(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,a=e[t++],s=a>>7,o=1<<1+(7&a);e[t++],e[t++];var i=null,l=null;s&&(i=t,l=o,t+=3*o);var c=!0,d=[],u=0,h=null,m=0,p=null;for(this.width=r,this.height=n;c&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,p=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((C=e[t++])>=0))throw Error("Invalid block size");if(0===C)break;t+=C}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var f=e[t++];u=e[t++]|e[t++]<<8,h=e[t++],1&f||(h=null),m=f>>2&7,t++;break;case 254:for(;;){if(!((C=e[t++])>=0))throw Error("Invalid block size");if(0===C)break;t+=C}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var g=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,x=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,y=e[t++],w=y>>6&1,j=1<<1+(7&y),N=i,S=l,k=!1;y>>7&&(k=!0,N=t,S=j,t+=3*j);var A=t;for(t++;;){var C;if(!((C=e[t++])>=0))throw Error("Invalid block size");if(0===C)break;t+=C}d.push({x:g,y:v,width:x,height:b,has_local_palette:k,palette_offset:N,palette_size:S,data_offset:A,data_length:t-A,transparent_index:h,interlaced:!!w,delay:u,disposal:m});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return p},this.frameInfo=function(e){if(e<0||e>=d.length)throw new Error("Frame index out of range.");return d[e]},this.decodeAndBlitFrameBGRA=function(t,n){var a=this.frameInfo(t),s=a.width*a.height,o=new Uint8Array(s);Af(e,a.data_offset,o,s);var i=a.palette_offset,l=a.transparent_index;null===l&&(l=256);var c=a.width,d=r-c,u=c,h=4*(a.y*r+a.x),m=4*((a.y+a.height)*r+a.x),p=h,f=4*d;!0===a.interlaced&&(f+=4*r*7);for(var g=8,v=0,x=o.length;v<x;++v){var b=o[v];if(0===u&&(u=c,(p+=f)>=m&&(f=4*d+4*r*(g-1),p=h+(c+d)*(g<<1),g>>=1)),b===l)p+=4;else{var y=e[i+3*b],w=e[i+3*b+1],j=e[i+3*b+2];n[p++]=j,n[p++]=w,n[p++]=y,n[p++]=255}--u}},this.decodeAndBlitFrameRGBA=function(t,n){var a=this.frameInfo(t),s=a.width*a.height,o=new Uint8Array(s);Af(e,a.data_offset,o,s);var i=a.palette_offset,l=a.transparent_index;null===l&&(l=256);var c=a.width,d=r-c,u=c,h=4*(a.y*r+a.x),m=4*((a.y+a.height)*r+a.x),p=h,f=4*d;!0===a.interlaced&&(f+=4*r*7);for(var g=8,v=0,x=o.length;v<x;++v){var b=o[v];if(0===u&&(u=c,(p+=f)>=m&&(f=4*d+4*r*(g-1),p=h+(c+d)*(g<<1),g>>=1)),b===l)p+=4;else{var y=e[i+3*b],w=e[i+3*b+1],j=e[i+3*b+2];n[p++]=y,n[p++]=w,n[p++]=j,n[p++]=255}--u}}}function Af(e,t,r,n){for(var a=e[t++],s=1<<a,o=s+1,i=o+1,l=a+1,c=(1<<l)-1,d=0,u=0,h=0,m=e[t++],p=new Int32Array(4096),f=null;;){for(;d<16&&0!==m;)u|=e[t++]<<d,d+=8,1===m?m=e[t++]:--m;if(d<l)break;var g=u&c;if(u>>=l,d-=l,g!==s){if(g===o)break;for(var v=g<i?g:f,x=0,b=v;b>s;)b=p[b]>>8,++x;var y=b;if(h+x+(v!==g?1:0)>n)return void Am.log("Warning, gif stream longer than expected.");r[h++]=y;var w=h+=x;for(v!==g&&(r[h++]=y),b=v;x--;)b=p[b],r[--w]=255&b,b>>=8;null!==f&&i<4096&&(p[i++]=f<<8|y,i>=c+1&&l<12&&(++l,c=c<<1|1)),f=g}else i=o+1,c=(1<<(l=a+1))-1,f=null}return h!==n&&Am.log("Warning, gif stream shorter than expected."),r}function Cf(e){var t,r,n,a,s,o=Math.floor,i=new Array(64),l=new Array(64),c=new Array(64),d=new Array(64),u=new Array(65535),h=new Array(65535),m=new Array(64),p=new Array(64),f=[],g=0,v=7,x=new Array(64),b=new Array(64),y=new Array(64),w=new Array(256),j=new Array(2048),N=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],k=[0,1,2,3,4,5,6,7,8,9,10,11],A=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],C=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],E=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],P=[0,1,2,3,4,5,6,7,8,9,10,11],_=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],I=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function T(e,t){for(var r=0,n=0,a=new Array,s=1;s<=16;s++){for(var o=1;o<=e[s];o++)a[t[n]]=[],a[t[n]][0]=r,a[t[n]][1]=s,n++,r++;r*=2}return a}function L(e){for(var t=e[0],r=e[1]-1;r>=0;)t&1<<r&&(g|=1<<v),r--,--v<0&&(255==g?(D(255),D(0)):D(g),v=7,g=0)}function D(e){f.push(e)}function M(e){D(e>>8&255),D(255&e)}function O(e,t,r,n,a){for(var s,o=a[0],i=a[240],l=function(e,t){var r,n,a,s,o,i,l,c,d,u,h=0;for(d=0;d<8;++d){r=e[h],n=e[h+1],a=e[h+2],s=e[h+3],o=e[h+4],i=e[h+5],l=e[h+6];var p=r+(c=e[h+7]),f=r-c,g=n+l,v=n-l,x=a+i,b=a-i,y=s+o,w=s-o,j=p+y,N=p-y,S=g+x,k=g-x;e[h]=j+S,e[h+4]=j-S;var A=.707106781*(k+N);e[h+2]=N+A,e[h+6]=N-A;var C=.382683433*((j=w+b)-(k=v+f)),E=.5411961*j+C,P=1.306562965*k+C,_=.707106781*(S=b+v),I=f+_,T=f-_;e[h+5]=T+E,e[h+3]=T-E,e[h+1]=I+P,e[h+7]=I-P,h+=8}for(h=0,d=0;d<8;++d){r=e[h],n=e[h+8],a=e[h+16],s=e[h+24],o=e[h+32],i=e[h+40],l=e[h+48];var L=r+(c=e[h+56]),D=r-c,M=n+l,O=n-l,R=a+i,F=a-i,U=s+o,B=s-o,z=L+U,W=L-U,q=M+R,V=M-R;e[h]=z+q,e[h+32]=z-q;var H=.707106781*(V+W);e[h+16]=W+H,e[h+48]=W-H;var G=.382683433*((z=B+F)-(V=O+D)),K=.5411961*z+G,J=1.306562965*V+G,Y=.707106781*(q=F+O),X=D+Y,Q=D-Y;e[h+40]=Q+K,e[h+24]=Q-K,e[h+8]=X+J,e[h+56]=X-J,h++}for(d=0;d<64;++d)u=e[d]*t[d],m[d]=u>0?u+.5|0:u-.5|0;return m}(e,t),c=0;c<64;++c)p[N[c]]=l[c];var d=p[0]-r;r=p[0],0==d?L(n[0]):(L(n[h[s=32767+d]]),L(u[s]));for(var f=63;f>0&&0==p[f];)f--;if(0==f)return L(o),r;for(var g,v=1;v<=f;){for(var x=v;0==p[v]&&v<=f;)++v;var b=v-x;if(b>=16){g=b>>4;for(var y=1;y<=g;++y)L(i);b&=15}s=32767+p[v],L(a[(b<<4)+h[s]]),L(u[s]),v++}return 63!=f&&L(o),r}function R(e){e=Math.min(Math.max(e,1),100),s!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var n=o((t[r]*e+50)/100);n=Math.min(Math.max(n,1),255),i[N[r]]=n}for(var a=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],s=0;s<64;s++){var u=o((a[s]*e+50)/100);u=Math.min(Math.max(u,1),255),l[N[s]]=u}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],m=0,p=0;p<8;p++)for(var f=0;f<8;f++)c[m]=1/(i[N[m]]*h[p]*h[f]*8),d[m]=1/(l[N[m]]*h[p]*h[f]*8),m++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),s=e)}this.encode=function(e,s){s&&R(s),f=new Array,g=0,v=7,M(65496),M(65504),M(16),D(74),D(70),D(73),D(70),D(0),D(1),D(1),D(0),M(1),M(1),D(0),D(0),function(){M(65499),M(132),D(0);for(var e=0;e<64;e++)D(i[e]);D(1);for(var t=0;t<64;t++)D(l[t])}(),function(e,t){M(65472),M(17),D(8),M(t),M(e),D(3),D(1),D(17),D(0),D(2),D(17),D(1),D(3),D(17),D(1)}(e.width,e.height),function(){M(65476),M(418),D(0);for(var e=0;e<16;e++)D(S[e+1]);for(var t=0;t<=11;t++)D(k[t]);D(16);for(var r=0;r<16;r++)D(A[r+1]);for(var n=0;n<=161;n++)D(C[n]);D(1);for(var a=0;a<16;a++)D(E[a+1]);for(var s=0;s<=11;s++)D(P[s]);D(17);for(var o=0;o<16;o++)D(_[o+1]);for(var i=0;i<=161;i++)D(I[i])}(),M(65498),M(12),D(3),D(1),D(0),D(2),D(17),D(3),D(17),D(0),D(63),D(0);var o=0,u=0,h=0;g=0,v=7,this.encode.displayName="_encode_";for(var m,p,w,N,T,F,U,B,z,W=e.data,q=e.width,V=e.height,H=4*q,G=0;G<V;){for(m=0;m<H;){for(T=H*G+m,U=-1,B=0,z=0;z<64;z++)F=T+(B=z>>3)*H+(U=4*(7&z)),G+B>=V&&(F-=H*(G+1+B-V)),m+U>=H&&(F-=m+U-H+4),p=W[F++],w=W[F++],N=W[F++],x[z]=(j[p]+j[w+256|0]+j[N+512|0]>>16)-128,b[z]=(j[p+768|0]+j[w+1024|0]+j[N+1280|0]>>16)-128,y[z]=(j[p+1280|0]+j[w+1536|0]+j[N+1792|0]>>16)-128;o=O(x,c,o,t,n),u=O(b,d,u,r,a),h=O(y,d,h,r,a),m+=32}G+=8}if(v>=0){var K=[];K[1]=v+1,K[0]=(1<<v+1)-1,L(K)}return M(65497),new Uint8Array(f)},e=e||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)w[t]=e(t)}(),t=T(S,k),r=T(E,P),n=T(A,C),a=T(_,I),function(){for(var e=1,t=2,r=1;r<=15;r++){for(var n=e;n<t;n++)h[32767+n]=r,u[32767+n]=[],u[32767+n][1]=r,u[32767+n][0]=n;for(var a=-(t-1);a<=-e;a++)h[32767+a]=r,u[32767+a]=[],u[32767+a][1]=r,u[32767+a][0]=t-1+a;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)j[e]=19595*e,j[e+256|0]=38470*e,j[e+512|0]=7471*e+32768,j[e+768|0]=-11059*e,j[e+1024|0]=-21709*e,j[e+1280|0]=32768*e+8421375,j[e+1536|0]=-27439*e,j[e+1792|0]=-5329*e}(),R(e)}function Ef(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Pf(e){function t(e){if(!e)throw Error("assert :P")}function r(e,t,r){for(var n=0;4>n;n++)if(e[t+n]!=r.charCodeAt(n))return!0;return!1}function n(e,t,r,n,a){for(var s=0;s<a;s++)e[t+s]=r[n+s]}function a(e,t,r,n){for(var a=0;a<n;a++)e[t+a]=r}function s(e){return new Int32Array(e)}function o(e,t){for(var r=[],n=0;n<e;n++)r.push(new t);return r}function i(e,t){var r=[];return function e(r,n,a){for(var s=a[n],o=0;o<s&&(r.push(a.length>n+1?[]:new t),!(a.length<n+1));o++)e(r[o],n+1,a)}(r,0,e),r}var l=function(){var e=this;function l(e,t){for(var r=1<<t-1>>>0;e&r;)r>>>=1;return r?(e&r-1)+r:e}function c(e,r,n,a,s){t(!(a%n));do{e[r+(a-=n)]=s}while(0<a)}function d(e,r,n,a,o){if(t(2328>=o),512>=o)var i=s(512);else if(null==(i=s(o)))return 0;return function(e,r,n,a,o,i){var d,h,m=r,p=1<<n,f=s(16),g=s(16);for(t(0!=o),t(null!=a),t(null!=e),t(0<n),h=0;h<o;++h){if(15<a[h])return 0;++f[a[h]]}if(f[0]==o)return 0;for(g[1]=0,d=1;15>d;++d){if(f[d]>1<<d)return 0;g[d+1]=g[d]+f[d]}for(h=0;h<o;++h)d=a[h],0<a[h]&&(i[g[d]++]=h);if(1==g[15])return(a=new u).g=0,a.value=i[0],c(e,m,1,p,a),p;var v,x=-1,b=p-1,y=0,w=1,j=1,N=1<<n;for(h=0,d=1,o=2;d<=n;++d,o<<=1){if(w+=j<<=1,0>(j-=f[d]))return 0;for(;0<f[d];--f[d])(a=new u).g=d,a.value=i[h++],c(e,m+y,o,N,a),y=l(y,d)}for(d=n+1,o=2;15>=d;++d,o<<=1){if(w+=j<<=1,0>(j-=f[d]))return 0;for(;0<f[d];--f[d]){if(a=new u,(y&b)!=x){for(m+=N,v=1<<(x=d)-n;15>x&&!(0>=(v-=f[x]));)++x,v<<=1;p+=N=1<<(v=x-n),e[r+(x=y&b)].g=v+n,e[r+x].value=m-r-x}a.g=d-n,a.value=i[h++],c(e,m+(y>>n),o,N,a),y=l(y,d)}}return w!=2*g[15]-1?0:p}(e,r,n,a,o,i)}function u(){this.value=this.g=0}function h(){this.value=this.g=0}function m(){this.G=o(5,u),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Rr,h)}function p(e,r,n,a){t(null!=e),t(null!=r),t(2147483648>a),e.Ca=254,e.I=0,e.b=-8,e.Ka=0,e.oa=r,e.pa=n,e.Jd=r,e.Yc=n+a,e.Zc=4<=a?n+a-4+1:n,A(e)}function f(e,t){for(var r=0;0<t--;)r|=E(e,128)<<t;return r}function g(e,t){var r=f(e,t);return C(e)?-r:r}function v(e,r,n,a){var s,o=0;for(t(null!=e),t(null!=r),t(4294967288>a),e.Sb=a,e.Ra=0,e.u=0,e.h=0,4<a&&(a=4),s=0;s<a;++s)o+=r[n+s]<<8*s;e.Ra=o,e.bb=a,e.oa=r,e.pa=n}function x(e){for(;8<=e.u&&e.bb<e.Sb;)e.Ra>>>=8,e.Ra+=e.oa[e.pa+e.bb]<<Br-8>>>0,++e.bb,e.u-=8;N(e)&&(e.h=1,e.u=0)}function b(e,r){if(t(0<=r),!e.h&&r<=Ur){var n=j(e)&Fr[r];return e.u+=r,x(e),n}return e.h=1,e.u=0}function y(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function w(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function j(e){return e.Ra>>>(e.u&Br-1)>>>0}function N(e){return t(e.bb<=e.Sb),e.h||e.bb==e.Sb&&e.u>Br}function S(e,t){e.u=t,e.h=N(e)}function k(e){e.u>=zr&&(t(e.u>=zr),x(e))}function A(e){t(null!=e&&null!=e.oa),e.pa<e.Zc?(e.I=(e.oa[e.pa++]|e.I<<8)>>>0,e.b+=8):(t(null!=e&&null!=e.oa),e.pa<e.Yc?(e.b+=8,e.I=e.oa[e.pa++]|e.I<<8):e.Ka?e.b=0:(e.I<<=8,e.b+=8,e.Ka=1))}function C(e){return f(e,1)}function E(e,t){var r=e.Ca;0>e.b&&A(e);var n=e.b,a=r*t>>>8,s=(e.I>>>n>a)+0;for(s?(r-=a,e.I-=a+1<<n>>>0):r=a+1,n=r,a=0;256<=n;)a+=8,n>>=8;return n=7^a+Wr[n],e.b-=n,e.Ca=(r<<n)-1,s}function P(e,t,r){e[t+0]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function _(e,t){return e[t+0]|e[t+1]<<8}function I(e,t){return _(e,t)|e[t+2]<<16}function T(e,t){return _(e,t)|_(e,t+2)<<16}function L(e,r){var n=1<<r;return t(null!=e),t(0<r),e.X=s(n),null==e.X?0:(e.Mb=32-r,e.Xa=r,1)}function D(e,r){t(null!=e),t(null!=r),t(e.Xa==r.Xa),n(r.X,0,e.X,0,1<<r.Xa)}function M(){this.X=[],this.Xa=this.Mb=0}function O(e,r,n,a){t(null!=n),t(null!=a);var s=n[0],o=a[0];return 0==s&&(s=(e*o+r/2)/r),0==o&&(o=(r*s+e/2)/e),0>=s||0>=o?0:(n[0]=s,a[0]=o,1)}function R(e,t){return e+(1<<t)-1>>>t}function F(e,t){return((4278255360&e)+(4278255360&t)>>>0&4278255360)+((16711935&e)+(16711935&t)>>>0&16711935)>>>0}function U(t,r){e[r]=function(r,n,a,s,o,i,l){var c;for(c=0;c<o;++c){var d=e[t](i[l+c-1],a,s+c);i[l+c]=F(r[n+c],d)}}}function B(){this.ud=this.hd=this.jd=0}function z(e,t){return((4278124286&(e^t))>>>1)+(e&t)>>>0}function W(e){return 0<=e&&256>e?e:0>e?0:255<e?255:void 0}function q(e,t){return W(e+(e-t+.5>>1))}function V(e,t,r){return Math.abs(t-r)-Math.abs(e-r)}function H(e,t,r,n,a,s,o){for(n=s[o-1],r=0;r<a;++r)s[o+r]=n=F(e[t+r],n)}function G(e,t,r,n,a){var s;for(s=0;s<r;++s){var o=e[t+s],i=o>>8&255,l=16711935&(l=(l=16711935&o)+((i<<16)+i));n[a+s]=(4278255360&o)+l>>>0}}function K(e,t){t.jd=255&e,t.hd=e>>8&255,t.ud=e>>16&255}function J(e,t,r,n,a,s){var o;for(o=0;o<n;++o){var i=t[r+o],l=i>>>8,c=i,d=255&(d=(d=i>>>16)+((e.jd<<24>>24)*(l<<24>>24)>>>5));c=255&(c=(c+=(e.hd<<24>>24)*(l<<24>>24)>>>5)+((e.ud<<24>>24)*(d<<24>>24)>>>5)),a[s+o]=(4278255360&i)+(d<<16)+c}}function Y(t,r,n,a,s){e[r]=function(e,t,r,n,o,i,l,c,d){for(n=l;n<c;++n)for(l=0;l<d;++l)o[i++]=s(r[a(e[t++])])},e[t]=function(t,r,o,i,l,c,d){var u=8>>t.b,h=t.Ea,m=t.K[0],p=t.w;if(8>u)for(t=(1<<t.b)-1,p=(1<<u)-1;r<o;++r){var f,g=0;for(f=0;f<h;++f)f&t||(g=a(i[l++])),c[d++]=s(m[g&p]),g>>=u}else e["VP8LMapColor"+n](i,l,m,p,c,d,r,o,h)}}function X(e,t,r,n,a){for(r=t+r;t<r;){var s=e[t++];n[a++]=s>>16&255,n[a++]=s>>8&255,n[a++]=255&s}}function Q(e,t,r,n,a){for(r=t+r;t<r;){var s=e[t++];n[a++]=s>>16&255,n[a++]=s>>8&255,n[a++]=255&s,n[a++]=s>>24&255}}function Z(e,t,r,n,a){for(r=t+r;t<r;){var s=(o=e[t++])>>16&240|o>>12&15,o=240&o|o>>28&15;n[a++]=s,n[a++]=o}}function $(e,t,r,n,a){for(r=t+r;t<r;){var s=(o=e[t++])>>16&248|o>>13&7,o=o>>5&224|o>>3&31;n[a++]=s,n[a++]=o}}function ee(e,t,r,n,a){for(r=t+r;t<r;){var s=e[t++];n[a++]=255&s,n[a++]=s>>8&255,n[a++]=s>>16&255}}function te(e,t,r,a,s,o){if(0==o)for(r=t+r;t<r;)P(a,((o=e[t++])[0]>>24|o[1]>>8&65280|o[2]<<8&16711680|o[3]<<24)>>>0),s+=32;else n(a,s,e,t,r)}function re(t,r){e[r][0]=e[t+"0"],e[r][1]=e[t+"1"],e[r][2]=e[t+"2"],e[r][3]=e[t+"3"],e[r][4]=e[t+"4"],e[r][5]=e[t+"5"],e[r][6]=e[t+"6"],e[r][7]=e[t+"7"],e[r][8]=e[t+"8"],e[r][9]=e[t+"9"],e[r][10]=e[t+"10"],e[r][11]=e[t+"11"],e[r][12]=e[t+"12"],e[r][13]=e[t+"13"],e[r][14]=e[t+"0"],e[r][15]=e[t+"0"]}function ne(e){return e==Wn||e==qn||e==Vn||e==Hn}function ae(){this.eb=[],this.size=this.A=this.fb=0}function se(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function oe(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ae,this.f.kb=new se,this.sd=null}function ie(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function le(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ce(e){return alert("todo:WebPSamplerProcessPlane"),e.T}function de(e,t){var r=e.T,a=t.ba.f.RGBA,s=a.eb,o=a.fb+e.ka*a.A,i=ga[t.ba.S],l=e.y,c=e.O,d=e.f,u=e.N,h=e.ea,m=e.W,p=t.cc,f=t.dc,g=t.Mc,v=t.Nc,x=e.ka,b=e.ka+e.T,y=e.U,w=y+1>>1;for(0==x?i(l,c,null,null,d,u,h,m,d,u,h,m,s,o,null,null,y):(i(t.ec,t.fc,l,c,p,f,g,v,d,u,h,m,s,o-a.A,s,o,y),++r);x+2<b;x+=2)p=d,f=u,g=h,v=m,u+=e.Rc,m+=e.Rc,o+=2*a.A,i(l,(c+=2*e.fa)-e.fa,l,c,p,f,g,v,d,u,h,m,s,o-a.A,s,o,y);return c+=e.fa,e.j+b<e.o?(n(t.ec,t.fc,l,c,y),n(t.cc,t.dc,d,u,w),n(t.Mc,t.Nc,h,m,w),r--):1&b||i(l,c,null,null,d,u,h,m,d,u,h,m,s,o+a.A,null,null,y),r}function ue(e,r,n){var a=e.F,s=[e.J];if(null!=a){var o=e.U,i=r.ba.S,l=i==Un||i==Vn;r=r.ba.f.RGBA;var c=[0],d=e.ka;c[0]=e.T,e.Kb&&(0==d?--c[0]:(--d,s[0]-=e.width),e.j+e.ka+e.T==e.o&&(c[0]=e.o-e.j-d));var u=r.eb;d=r.fb+d*r.A,e=Sn(a,s[0],e.width,o,c,u,d+(l?0:3),r.A),t(n==c),e&&ne(i)&&jn(u,d,l,o,c,r.A)}return 0}function he(e){var t=e.ma,r=t.ba.S,n=11>r,a=r==On||r==Fn||r==Un||r==Bn||12==r||ne(r);if(t.memory=null,t.Ib=null,t.Jb=null,t.Nd=null,!Dr(t.Oa,e,a?11:12))return 0;if(a&&ne(r)&&vr(),e.da)alert("todo:use_scaling");else{if(n){if(t.Ib=ce,e.Kb){if(r=e.U+1>>1,t.memory=s(e.U+2*r),null==t.memory)return 0;t.ec=t.memory,t.fc=0,t.cc=t.ec,t.dc=t.fc+e.U,t.Mc=t.cc,t.Nc=t.dc+r,t.Ib=de,vr()}}else alert("todo:EmitYUV");a&&(t.Jb=ue,n&&fr())}if(n&&!_a){for(e=0;256>e;++e)Ia[e]=89858*(e-128)+ka>>Sa,Da[e]=-22014*(e-128)+ka,La[e]=-45773*(e-128),Ta[e]=113618*(e-128)+ka>>Sa;for(e=Aa;e<Ca;++e)t=76283*(e-16)+ka>>Sa,Ma[e-Aa]=He(t,255),Oa[e-Aa]=He(t+8>>4,15);_a=1}return 1}function me(e){var r=e.ma,n=e.U,a=e.T;return t(!(1&e.ka)),0>=n||0>=a?0:(n=r.Ib(e,r),null!=r.Jb&&r.Jb(e,r,n),r.Dc+=n,1)}function pe(e){e.ma.memory=null}function fe(e,t,r,n){return 47!=b(e,8)?0:(t[0]=b(e,14)+1,r[0]=b(e,14)+1,n[0]=b(e,1),0!=b(e,3)?0:!e.h)}function ge(e,t){if(4>e)return e+1;var r=e-2>>1;return(2+(1&e)<<r)+b(t,r)+1}function ve(e,t){return 120<t?t-120:1<=(r=((r=Qn[t-1])>>4)*e+(8-(15&r)))?r:1;var r}function xe(e,t,r){var n=j(r),a=e[t+=255&n].g-8;return 0<a&&(S(r,r.u+8),n=j(r),t+=e[t].value,t+=n&(1<<a)-1),S(r,r.u+e[t].g),e[t].value}function be(e,r,n){return n.g+=e.g,n.value+=e.value<<r>>>0,t(8>=n.g),e.g}function ye(e,r,n){var a=e.xc;return t((r=0==a?0:e.vc[e.md*(n>>a)+(r>>a)])<e.Wb),e.Ya[r]}function we(e,r,a,s){var o=e.ab,i=e.c*r,l=e.C;r=l+r;var c=a,d=s;for(s=e.Ta,a=e.Ua;0<o--;){var u=e.gc[o],h=l,m=r,p=c,f=d,g=(d=s,c=a,u.Ea);switch(t(h<m),t(m<=u.nc),u.hc){case 2:Hr(p,f,(m-h)*g,d,c);break;case 0:var v=h,x=m,b=d,y=c,w=(A=u).Ea;0==v&&(qr(p,f,null,null,1,b,y),H(p,f+1,0,0,w-1,b,y+1),f+=w,y+=w,++v);for(var j=1<<A.b,N=j-1,S=R(w,A.b),k=A.K,A=A.w+(v>>A.b)*S;v<x;){var C=k,E=A,P=1;for(Vr(p,f,b,y-w,1,b,y);P<w;){var _=(P&~N)+j;_>w&&(_=w),(0,Xr[C[E++]>>8&15])(p,f+ +P,b,y+P-w,_-P,b,y+P),P=_}f+=w,y+=w,++v&N||(A+=S)}m!=u.nc&&n(d,c-g,d,c+(m-h-1)*g,g);break;case 1:for(g=p,x=f,w=(p=u.Ea)-(y=p&~(b=(f=1<<u.b)-1)),v=R(p,u.b),j=u.K,u=u.w+(h>>u.b)*v;h<m;){for(N=j,S=u,k=new B,A=x+y,C=x+p;x<A;)K(N[S++],k),Qr(k,g,x,f,d,c),x+=f,c+=f;x<C&&(K(N[S++],k),Qr(k,g,x,w,d,c),x+=w,c+=w),++h&b||(u+=v)}break;case 3:if(p==d&&f==c&&0<u.b){for(x=d,p=g=c+(m-h)*g-(y=(m-h)*R(u.Ea,u.b)),f=d,b=c,v=[],y=(w=y)-1;0<=y;--y)v[y]=f[b+y];for(y=w-1;0<=y;--y)x[p+y]=v[y];Gr(u,h,m,d,g,d,c)}else Gr(u,h,m,p,f,d,c)}c=s,d=a}d!=a&&n(s,a,c,d,i)}function je(e,r){var n=e.V,a=e.Ba+e.c*e.C,s=r-e.C;if(t(r<=e.l.o),t(16>=s),0<s){var o=e.l,i=e.Ta,l=e.Ua,c=o.width;if(we(e,s,n,a),s=l=[l],t((n=e.C)<(a=r)),t(o.v<o.va),a>o.o&&(a=o.o),n<o.j){var d=o.j-n;n=o.j,s[0]+=d*c}if(n>=a?n=0:(s[0]+=4*o.v,o.ka=n-o.j,o.U=o.va-o.v,o.T=a-n,n=1),n){if(l=l[0],11>(n=e.ca).S){var u=n.f.RGBA,h=(a=n.S,s=o.U,o=o.T,d=u.eb,u.A),m=o;for(u=u.fb+e.Ma*u.A;0<m--;){var p=i,f=l,g=s,v=d,x=u;switch(a){case Mn:Zr(p,f,g,v,x);break;case On:$r(p,f,g,v,x);break;case Wn:$r(p,f,g,v,x),jn(v,x,0,g,1,0);break;case Rn:rn(p,f,g,v,x);break;case Fn:te(p,f,g,v,x,1);break;case qn:te(p,f,g,v,x,1),jn(v,x,0,g,1,0);break;case Un:te(p,f,g,v,x,0);break;case Vn:te(p,f,g,v,x,0),jn(v,x,1,g,1,0);break;case Bn:en(p,f,g,v,x);break;case Hn:en(p,f,g,v,x),Nn(v,x,g,1,0);break;case zn:tn(p,f,g,v,x);break;default:t(0)}l+=c,u+=h}e.Ma+=o}else alert("todo:EmitRescaledRowsYUVA");t(e.Ma<=n.height)}}e.C=r,t(e.C<=e.i)}function Ne(e){var t;if(0<e.ua)return 0;for(t=0;t<e.Wb;++t){var r=e.Ya[t].G,n=e.Ya[t].H;if(0<r[1][n[1]+0].g||0<r[2][n[2]+0].g||0<r[3][n[3]+0].g)return 0}return 1}function Se(e,r,n,a,s,o){if(0!=e.Z){var i=e.qd,l=e.rd;for(t(null!=fa[e.Z]);r<n;++r)fa[e.Z](i,l,a,s,a,s,o),i=a,l=s,s+=o;e.qd=i,e.rd=l}}function ke(e,r){var n=e.l.ma,a=0==n.Z||1==n.Z?e.l.j:e.C;if(a=e.C<a?a:e.C,t(r<=e.l.o),r>a){var s=e.l.width,o=n.ca,i=n.tb+s*a,l=e.V,c=e.Ba+e.c*a,d=e.gc;t(1==e.ab),t(3==d[0].hc),Jr(d[0],a,r,l,c,o,i),Se(n,a,r,o,i,s)}e.C=e.Ma=r}function Ae(e,r,n,a,s,o,i){var l=e.$/a,c=e.$%a,d=e.m,u=e.s,h=n+e.$,m=h;s=n+a*s;var p=n+a*o,f=280+u.ua,g=e.Pb?l:16777216,v=0<u.ua?u.Wa:null,x=u.wc,b=h<p?ye(u,c,l):null;t(e.C<o),t(p<=s);var y=!1;e:for(;;){for(;y||h<p;){var w=0;if(l>=g){var A=h-n;t((g=e).Pb),g.wd=g.m,g.xd=A,0<g.s.ua&&D(g.s.Wa,g.s.vb),g=l+$n}if(c&x||(b=ye(u,c,l)),t(null!=b),b.Qb&&(r[h]=b.qb,y=!0),!y)if(k(d),b.jc){w=d,A=r;var C=h,E=b.pd[j(w)&Rr-1];t(b.jc),256>E.g?(S(w,w.u+E.g),A[C]=E.value,w=0):(S(w,w.u+E.g-256),t(256<=E.value),w=E.value),0==w&&(y=!0)}else w=xe(b.G[0],b.H[0],d);if(d.h)break;if(y||256>w){if(!y)if(b.nd)r[h]=(b.qb|w<<8)>>>0;else{if(k(d),y=xe(b.G[1],b.H[1],d),k(d),A=xe(b.G[2],b.H[2],d),C=xe(b.G[3],b.H[3],d),d.h)break;r[h]=(C<<24|y<<16|w<<8|A)>>>0}if(y=!1,++h,++c>=a&&(c=0,++l,null!=i&&l<=o&&!(l%16)&&i(e,l),null!=v))for(;m<h;)w=r[m++],v.X[(506832829*w&4294967295)>>>v.Mb]=w}else if(280>w){if(w=ge(w-256,d),A=xe(b.G[4],b.H[4],d),k(d),A=ve(a,A=ge(A,d)),d.h)break;if(h-n<A||s-h<w)break e;for(C=0;C<w;++C)r[h+C]=r[h+C-A];for(h+=w,c+=w;c>=a;)c-=a,++l,null!=i&&l<=o&&!(l%16)&&i(e,l);if(t(h<=s),c&x&&(b=ye(u,c,l)),null!=v)for(;m<h;)w=r[m++],v.X[(506832829*w&4294967295)>>>v.Mb]=w}else{if(!(w<f))break e;for(y=w-280,t(null!=v);m<h;)w=r[m++],v.X[(506832829*w&4294967295)>>>v.Mb]=w;w=h,t(!(y>>>(A=v).Xa)),r[w]=A.X[y],y=!0}y||t(d.h==N(d))}if(e.Pb&&d.h&&h<s)t(e.m.h),e.a=5,e.m=e.wd,e.$=e.xd,0<e.s.ua&&D(e.s.vb,e.s.Wa);else{if(d.h)break e;null!=i&&i(e,l>o?o:l),e.a=0,e.$=h-n}return 1}return e.a=3,0}function Ce(e){t(null!=e),e.vc=null,e.yc=null,e.Ya=null;var r=e.Wa;null!=r&&(r.X=null),e.vb=null,t(null!=e)}function Ee(){var t=new sr;return null==t?null:(t.a=0,t.xb=pa,re("Predictor","VP8LPredictors"),re("Predictor","VP8LPredictors_C"),re("PredictorAdd","VP8LPredictorsAdd"),re("PredictorAdd","VP8LPredictorsAdd_C"),Hr=G,Qr=J,Zr=X,$r=Q,en=Z,tn=$,rn=ee,e.VP8LMapColor32b=Kr,e.VP8LMapColor8b=Yr,t)}function Pe(e,r,n,i,l){var c=1,h=[e],p=[r],f=i.m,g=i.s,v=null,x=0;e:for(;;){if(n)for(;c&&b(f,1);){var y=h,w=p,N=i,A=1,C=N.m,E=N.gc[N.ab],P=b(C,2);if(N.Oc&1<<P)c=0;else{switch(N.Oc|=1<<P,E.hc=P,E.Ea=y[0],E.nc=w[0],E.K=[null],++N.ab,t(4>=N.ab),P){case 0:case 1:E.b=b(C,3)+2,A=Pe(R(E.Ea,E.b),R(E.nc,E.b),0,N,E.K),E.K=E.K[0];break;case 3:var _,I=b(C,8)+1,T=16<I?0:4<I?1:2<I?2:3;if(y[0]=R(E.Ea,T),E.b=T,_=A=Pe(I,1,0,N,E.K)){var D,M=I,O=E,U=1<<(8>>O.b),B=s(U);if(null==B)_=0;else{var z=O.K[0],W=O.w;for(B[0]=O.K[0][0],D=1;D<1*M;++D)B[D]=F(z[W+D],B[D-1]);for(;D<4*U;++D)B[D]=0;O.K[0]=null,O.K[0]=B,_=1}}A=_;break;case 2:break;default:t(0)}c=A}}if(h=h[0],p=p[0],c&&b(f,1)&&!(c=1<=(x=b(f,4))&&11>=x)){i.a=3;break e}var q;if(q=c)t:{var V,H,G,K=i,J=h,Y=p,X=x,Q=n,Z=K.m,$=K.s,ee=[null],te=1,re=0,ne=Zn[X];r:for(;;){if(Q&&b(Z,1)){var ae=b(Z,3)+2,se=R(J,ae),oe=R(Y,ae),ie=se*oe;if(!Pe(se,oe,0,K,ee))break r;for(ee=ee[0],$.xc=ae,V=0;V<ie;++V){var le=ee[V]>>8&65535;ee[V]=le,le>=te&&(te=le+1)}}if(Z.h)break r;for(H=0;5>H;++H){var ce=Jn[H];!H&&0<X&&(ce+=1<<X),re<ce&&(re=ce)}var de=o(te*ne,u),ue=te,he=o(ue,m);if(null==he)var me=null;else t(65536>=ue),me=he;var pe=s(re);if(null==me||null==pe||null==de){K.a=1;break r}var fe=de;for(V=G=0;V<te;++V){var ge=me[V],ve=ge.G,xe=ge.H,ye=0,we=1,je=0;for(H=0;5>H;++H){ce=Jn[H],ve[H]=fe,xe[H]=G,!H&&0<X&&(ce+=1<<X);n:{var Ne,Se=ce,ke=K,Ee=pe,_e=fe,Ie=G,Te=0,Le=ke.m,De=b(Le,1);if(a(Ee,0,0,Se),De){var Me=b(Le,1)+1,Oe=b(Le,1),Re=b(Le,0==Oe?1:8);Ee[Re]=1,2==Me&&(Ee[Re=b(Le,8)]=1);var Fe=1}else{var Ue=s(19),Be=b(Le,4)+4;if(19<Be){ke.a=3;var ze=0;break n}for(Ne=0;Ne<Be;++Ne)Ue[Xn[Ne]]=b(Le,3);var We=void 0,qe=void 0,Ve=ke,He=Ue,Ge=Se,Ke=Ee,Je=0,Ye=Ve.m,Xe=8,Qe=o(128,u);a:for(;d(Qe,0,7,He,19);){if(b(Ye,1)){var Ze=2+2*b(Ye,3);if((We=2+b(Ye,Ze))>Ge)break a}else We=Ge;for(qe=0;qe<Ge&&We--;){k(Ye);var $e=Qe[0+(127&j(Ye))];S(Ye,Ye.u+$e.g);var et=$e.value;if(16>et)Ke[qe++]=et,0!=et&&(Xe=et);else{var tt=16==et,rt=et-16,nt=Kn[rt],at=b(Ye,Gn[rt])+nt;if(qe+at>Ge)break a;for(var st=tt?Xe:0;0<at--;)Ke[qe++]=st}}Je=1;break a}Je||(Ve.a=3),Fe=Je}(Fe=Fe&&!Le.h)&&(Te=d(_e,Ie,8,Ee,Se)),Fe&&0!=Te?ze=Te:(ke.a=3,ze=0)}if(0==ze)break r;if(we&&1==Yn[H]&&(we=0==fe[G].g),ye+=fe[G].g,G+=ze,3>=H){var ot,it=pe[0];for(ot=1;ot<ce;++ot)pe[ot]>it&&(it=pe[ot]);je+=it}}if(ge.nd=we,ge.Qb=0,we&&(ge.qb=(ve[3][xe[3]+0].value<<24|ve[1][xe[1]+0].value<<16|ve[2][xe[2]+0].value)>>>0,0==ye&&256>ve[0][xe[0]+0].value&&(ge.Qb=1,ge.qb+=ve[0][xe[0]+0].value<<8)),ge.jc=!ge.Qb&&6>je,ge.jc){var lt,ct=ge;for(lt=0;lt<Rr;++lt){var dt=lt,ut=ct.pd[dt],ht=ct.G[0][ct.H[0]+dt];256<=ht.value?(ut.g=ht.g+256,ut.value=ht.value):(ut.g=0,ut.value=0,dt>>=be(ht,8,ut),dt>>=be(ct.G[1][ct.H[1]+dt],16,ut),dt>>=be(ct.G[2][ct.H[2]+dt],0,ut),be(ct.G[3][ct.H[3]+dt],24,ut))}}}$.vc=ee,$.Wb=te,$.Ya=me,$.yc=de,q=1;break t}q=0}if(!(c=q)){i.a=3;break e}if(0<x){if(g.ua=1<<x,!L(g.Wa,x)){i.a=1,c=0;break e}}else g.ua=0;var mt=i,pt=h,ft=p,gt=mt.s,vt=gt.xc;if(mt.c=pt,mt.i=ft,gt.md=R(pt,vt),gt.wc=0==vt?-1:(1<<vt)-1,n){i.xb=ma;break e}if(null==(v=s(h*p))){i.a=1,c=0;break e}c=(c=Ae(i,v,0,h,p,p,null))&&!f.h;break e}return c?(null!=l?l[0]=v:(t(null==v),t(n)),i.$=0,n||Ce(g)):Ce(g),c}function _e(e,r){var n=e.c*e.i,a=n+r+16*r;return t(e.c<=r),e.V=s(a),null==e.V?(e.Ta=null,e.Ua=0,e.a=1,0):(e.Ta=e.V,e.Ua=e.Ba+n+r,1)}function Ie(e,r){var n=e.C,a=r-n,s=e.V,o=e.Ba+e.c*n;for(t(r<=e.l.o);0<a;){var i=16<a?16:a,l=e.l.ma,c=e.l.width,d=c*i,u=l.ca,h=l.tb+c*n,m=e.Ta,p=e.Ua;we(e,i,s,o),kn(m,p,u,h,d),Se(l,n,n+i,u,h,c),a-=i,s+=i*e.c,n+=i}t(n==r),e.C=e.Ma=r}function Te(){this.ub=this.yd=this.td=this.Rb=0}function Le(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function De(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Me(){this.Yb=function(){var e=[];return function e(t,r,n){for(var a=n[r],s=0;s<a&&(t.push(n.length>r+1?[]:0),!(n.length<r+1));s++)e(t[s],r+1,n)}(e,0,[3,11]),e}()}function Oe(){this.jb=s(3),this.Wc=i([4,8],Me),this.Xc=i([4,17],Me)}function Re(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function Fe(){this.ld=this.La=this.dd=this.tc=0}function Ue(){this.Na=this.la=0}function Be(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ze(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function We(){this.uc=this.M=this.Nb=0,this.wa=Array(new Fe),this.Y=0,this.ya=Array(new ze),this.aa=0,this.l=new Ge}function qe(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Ve(){this.cb=this.a=0,this.sc="",this.m=new y,this.Od=new Te,this.Kc=new Le,this.ed=new Re,this.Qa=new De,this.Ic=this.$c=this.Aa=0,this.D=new We,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,y),this.ia=0,this.pb=o(4,Be),this.Pa=new Oe,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new qe),this.Hd=0,this.rb=Array(new Ue),this.sb=0,this.wa=Array(new Fe),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ze),this.L=this.aa=0,this.gd=i([4,2],Fe),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function He(e,t){return 0>e?0:e>t?t:e}function Ge(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ke(){var e=new Ve;return null!=e&&(e.a=0,e.sc="OK",e.cb=0,e.Xb=0,ra||(ra=Qe)),e}function Je(e,t,r){return 0==e.a&&(e.a=t,e.sc=r,e.cb=0),0}function Ye(e,t,r){return 3<=r&&157==e[t+0]&&1==e[t+1]&&42==e[t+2]}function Xe(e,r){if(null==e)return 0;if(e.a=0,e.sc="OK",null==r)return Je(e,2,"null VP8Io passed to VP8GetHeaders()");var n=r.data,s=r.w,o=r.ha;if(4>o)return Je(e,7,"Truncated header.");var i=n[s+0]|n[s+1]<<8|n[s+2]<<16,l=e.Od;if(l.Rb=!(1&i),l.td=i>>1&7,l.yd=i>>4&1,l.ub=i>>5,3<l.td)return Je(e,3,"Incorrect keyframe parameters.");if(!l.yd)return Je(e,4,"Frame not displayable.");s+=3,o-=3;var c=e.Kc;if(l.Rb){if(7>o)return Je(e,7,"cannot parse picture header");if(!Ye(n,s,o))return Je(e,3,"Bad code word");c.c=16383&(n[s+4]<<8|n[s+3]),c.Td=n[s+4]>>6,c.i=16383&(n[s+6]<<8|n[s+5]),c.Ud=n[s+6]>>6,s+=7,o-=7,e.za=c.c+15>>4,e.Ub=c.i+15>>4,r.width=c.c,r.height=c.i,r.Da=0,r.j=0,r.v=0,r.va=r.width,r.o=r.height,r.da=0,r.ib=r.width,r.hb=r.height,r.U=r.width,r.T=r.height,a((i=e.Pa).jb,0,255,i.jb.length),t(null!=(i=e.Qa)),i.Cb=0,i.Bb=0,i.Fb=1,a(i.Zb,0,0,i.Zb.length),a(i.Lb,0,0,i.Lb)}if(l.ub>o)return Je(e,7,"bad partition length");p(i=e.m,n,s,l.ub),s+=l.ub,o-=l.ub,l.Rb&&(c.Ld=C(i),c.Kd=C(i)),c=e.Qa;var d,u=e.Pa;if(t(null!=i),t(null!=c),c.Cb=C(i),c.Cb){if(c.Bb=C(i),C(i)){for(c.Fb=C(i),d=0;4>d;++d)c.Zb[d]=C(i)?g(i,7):0;for(d=0;4>d;++d)c.Lb[d]=C(i)?g(i,6):0}if(c.Bb)for(d=0;3>d;++d)u.jb[d]=C(i)?f(i,8):255}else c.Bb=0;if(i.Ka)return Je(e,3,"cannot parse segment header");if((c=e.ed).zd=C(i),c.Tb=f(i,6),c.wb=f(i,3),c.Pc=C(i),c.Pc&&C(i)){for(u=0;4>u;++u)C(i)&&(c.vd[u]=g(i,6));for(u=0;4>u;++u)C(i)&&(c.od[u]=g(i,6))}if(e.L=0==c.Tb?0:c.zd?1:2,i.Ka)return Je(e,3,"cannot parse filter header");var h=o;if(o=d=s,s=d+h,c=h,e.Xb=(1<<f(e.m,2))-1,h<3*(u=e.Xb))n=7;else{for(d+=3*u,c-=3*u,h=0;h<u;++h){var m=n[o+0]|n[o+1]<<8|n[o+2]<<16;m>c&&(m=c),p(e.Jc[+h],n,d,m),d+=m,c-=m,o+=3}p(e.Jc[+u],n,d,c),n=d<s?0:5}if(0!=n)return Je(e,n,"cannot parse partitions");for(n=f(d=e.m,7),o=C(d)?g(d,4):0,s=C(d)?g(d,4):0,c=C(d)?g(d,4):0,u=C(d)?g(d,4):0,d=C(d)?g(d,4):0,h=e.Qa,m=0;4>m;++m){if(h.Cb){var v=h.Zb[m];h.Fb||(v+=n)}else{if(0<m){e.pb[m]=e.pb[0];continue}v=n}var x=e.pb[m];x.Sc[0]=ea[He(v+o,127)],x.Sc[1]=ta[He(v+0,127)],x.Eb[0]=2*ea[He(v+s,127)],x.Eb[1]=101581*ta[He(v+c,127)]>>16,8>x.Eb[1]&&(x.Eb[1]=8),x.Qc[0]=ea[He(v+u,117)],x.Qc[1]=ta[He(v+d,127)],x.lc=v+d}if(!l.Rb)return Je(e,4,"Not a key frame.");for(C(i),l=e.Pa,n=0;4>n;++n){for(o=0;8>o;++o)for(s=0;3>s;++s)for(c=0;11>c;++c)u=E(i,la[n][o][s][c])?f(i,8):oa[n][o][s][c],l.Wc[n][o].Yb[s][c]=u;for(o=0;17>o;++o)l.Xc[n][o]=l.Wc[n][ca[o]]}return e.kc=C(i),e.kc&&(e.Bd=f(i,8)),e.cb=1}function Qe(e,t,r,n,a,s,o){var i=t[a].Yb[r];for(r=0;16>a;++a){if(!E(e,i[r+0]))return a;for(;!E(e,i[r+1]);)if(i=t[++a].Yb[0],r=0,16==a)return 16;var l=t[a+1].Yb;if(E(e,i[r+2])){var c=e,d=0;if(E(c,(h=i)[(u=r)+3]))if(E(c,h[u+6])){for(i=0,u=2*(d=E(c,h[u+8]))+(h=E(c,h[u+9+d])),d=0,h=na[u];h[i];++i)d+=d+E(c,h[i]);d+=3+(8<<u)}else E(c,h[u+7])?(d=7+2*E(c,165),d+=E(c,145)):d=5+E(c,159);else d=E(c,h[u+4])?3+E(c,h[u+5]):2;i=l[2]}else d=1,i=l[1];l=o+aa[a],0>(c=e).b&&A(c);var u,h=c.b,m=(u=c.Ca>>1)-(c.I>>h)>>31;--c.b,c.Ca+=m,c.Ca|=1,c.I-=(u+1&m)<<h,s[l]=((d^m)-m)*n[(0<a)+0]}return 16}function Ze(e){var t=e.rb[e.sb-1];t.la=0,t.Na=0,a(e.zc,0,0,e.zc.length),e.ja=0}function $e(e,t,r,n,a){a=e[t+r+32*n]+(a>>3),e[t+r+32*n]=-256&a?0>a?0:255:a}function et(e,t,r,n,a,s){$e(e,t,0,r,n+a),$e(e,t,1,r,n+s),$e(e,t,2,r,n-s),$e(e,t,3,r,n-a)}function tt(e){return(20091*e>>16)+e}function rt(e,t,r,n){var a,o=0,i=s(16);for(a=0;4>a;++a){var l=e[t+0]+e[t+8],c=e[t+0]-e[t+8],d=(35468*e[t+4]>>16)-tt(e[t+12]),u=tt(e[t+4])+(35468*e[t+12]>>16);i[o+0]=l+u,i[o+1]=c+d,i[o+2]=c-d,i[o+3]=l-u,o+=4,t++}for(a=o=0;4>a;++a)l=(e=i[o+0]+4)+i[o+8],c=e-i[o+8],d=(35468*i[o+4]>>16)-tt(i[o+12]),$e(r,n,0,0,l+(u=tt(i[o+4])+(35468*i[o+12]>>16))),$e(r,n,1,0,c+d),$e(r,n,2,0,c-d),$e(r,n,3,0,l-u),o++,n+=32}function nt(e,t,r,n){var a=e[t+0]+4,s=35468*e[t+4]>>16,o=tt(e[t+4]),i=35468*e[t+1]>>16;et(r,n,0,a+o,e=tt(e[t+1]),i),et(r,n,1,a+s,e,i),et(r,n,2,a-s,e,i),et(r,n,3,a-o,e,i)}function at(e,t,r,n,a){rt(e,t,r,n),a&&rt(e,t+16,r,n+4)}function st(e,t,r,n){an(e,t+0,r,n,1),an(e,t+32,r,n+128,1)}function ot(e,t,r,n){var a;for(e=e[t+0]+4,a=0;4>a;++a)for(t=0;4>t;++t)$e(r,n,t,a,e)}function it(e,t,r,n){e[t+0]&&ln(e,t+0,r,n),e[t+16]&&ln(e,t+16,r,n+4),e[t+32]&&ln(e,t+32,r,n+128),e[t+48]&&ln(e,t+48,r,n+128+4)}function lt(e,t,r,n){var a,o=s(16);for(a=0;4>a;++a){var i=e[t+0+a]+e[t+12+a],l=e[t+4+a]+e[t+8+a],c=e[t+4+a]-e[t+8+a],d=e[t+0+a]-e[t+12+a];o[0+a]=i+l,o[8+a]=i-l,o[4+a]=d+c,o[12+a]=d-c}for(a=0;4>a;++a)i=(e=o[0+4*a]+3)+o[3+4*a],l=o[1+4*a]+o[2+4*a],c=o[1+4*a]-o[2+4*a],d=e-o[3+4*a],r[n+0]=i+l>>3,r[n+16]=d+c>>3,r[n+32]=i-l>>3,r[n+48]=d-c>>3,n+=64}function ct(e,t,r){var n,a=t-32,s=Ln,o=255-e[a-1];for(n=0;n<r;++n){var i,l=s,c=o+e[t-1];for(i=0;i<r;++i)e[t+i]=l[c+e[a+i]];t+=32}}function dt(e,t){ct(e,t,4)}function ut(e,t){ct(e,t,8)}function ht(e,t){ct(e,t,16)}function mt(e,t){var r;for(r=0;16>r;++r)n(e,t+32*r,e,t-32,16)}function pt(e,t){var r;for(r=16;0<r;--r)a(e,t,e[t-1],16),t+=32}function ft(e,t,r){var n;for(n=0;16>n;++n)a(t,r+32*n,e,16)}function gt(e,t){var r,n=16;for(r=0;16>r;++r)n+=e[t-1+32*r]+e[t+r-32];ft(n>>5,e,t)}function vt(e,t){var r,n=8;for(r=0;16>r;++r)n+=e[t-1+32*r];ft(n>>4,e,t)}function xt(e,t){var r,n=8;for(r=0;16>r;++r)n+=e[t+r-32];ft(n>>4,e,t)}function bt(e,t){ft(128,e,t)}function yt(e,t,r){return e+2*t+r+2>>2}function wt(e,t){var r,a=t-32;for(a=new Uint8Array([yt(e[a-1],e[a+0],e[a+1]),yt(e[a+0],e[a+1],e[a+2]),yt(e[a+1],e[a+2],e[a+3]),yt(e[a+2],e[a+3],e[a+4])]),r=0;4>r;++r)n(e,t+32*r,a,0,a.length)}function jt(e,t){var r=e[t-1],n=e[t-1+32],a=e[t-1+64],s=e[t-1+96];P(e,t+0,16843009*yt(e[t-1-32],r,n)),P(e,t+32,16843009*yt(r,n,a)),P(e,t+64,16843009*yt(n,a,s)),P(e,t+96,16843009*yt(a,s,s))}function Nt(e,t){var r,n=4;for(r=0;4>r;++r)n+=e[t+r-32]+e[t-1+32*r];for(n>>=3,r=0;4>r;++r)a(e,t+32*r,n,4)}function St(e,t){var r=e[t-1+0],n=e[t-1+32],a=e[t-1+64],s=e[t-1-32],o=e[t+0-32],i=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+96]=yt(n,a,e[t-1+96]),e[t+1+96]=e[t+0+64]=yt(r,n,a),e[t+2+96]=e[t+1+64]=e[t+0+32]=yt(s,r,n),e[t+3+96]=e[t+2+64]=e[t+1+32]=e[t+0+0]=yt(o,s,r),e[t+3+64]=e[t+2+32]=e[t+1+0]=yt(i,o,s),e[t+3+32]=e[t+2+0]=yt(l,i,o),e[t+3+0]=yt(c,l,i)}function kt(e,t){var r=e[t+1-32],n=e[t+2-32],a=e[t+3-32],s=e[t+4-32],o=e[t+5-32],i=e[t+6-32],l=e[t+7-32];e[t+0+0]=yt(e[t+0-32],r,n),e[t+1+0]=e[t+0+32]=yt(r,n,a),e[t+2+0]=e[t+1+32]=e[t+0+64]=yt(n,a,s),e[t+3+0]=e[t+2+32]=e[t+1+64]=e[t+0+96]=yt(a,s,o),e[t+3+32]=e[t+2+64]=e[t+1+96]=yt(s,o,i),e[t+3+64]=e[t+2+96]=yt(o,i,l),e[t+3+96]=yt(i,l,l)}function At(e,t){var r=e[t-1+0],n=e[t-1+32],a=e[t-1+64],s=e[t-1-32],o=e[t+0-32],i=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+0]=e[t+1+64]=s+o+1>>1,e[t+1+0]=e[t+2+64]=o+i+1>>1,e[t+2+0]=e[t+3+64]=i+l+1>>1,e[t+3+0]=l+c+1>>1,e[t+0+96]=yt(a,n,r),e[t+0+64]=yt(n,r,s),e[t+0+32]=e[t+1+96]=yt(r,s,o),e[t+1+32]=e[t+2+96]=yt(s,o,i),e[t+2+32]=e[t+3+96]=yt(o,i,l),e[t+3+32]=yt(i,l,c)}function Ct(e,t){var r=e[t+0-32],n=e[t+1-32],a=e[t+2-32],s=e[t+3-32],o=e[t+4-32],i=e[t+5-32],l=e[t+6-32],c=e[t+7-32];e[t+0+0]=r+n+1>>1,e[t+1+0]=e[t+0+64]=n+a+1>>1,e[t+2+0]=e[t+1+64]=a+s+1>>1,e[t+3+0]=e[t+2+64]=s+o+1>>1,e[t+0+32]=yt(r,n,a),e[t+1+32]=e[t+0+96]=yt(n,a,s),e[t+2+32]=e[t+1+96]=yt(a,s,o),e[t+3+32]=e[t+2+96]=yt(s,o,i),e[t+3+64]=yt(o,i,l),e[t+3+96]=yt(i,l,c)}function Et(e,t){var r=e[t-1+0],n=e[t-1+32],a=e[t-1+64],s=e[t-1+96];e[t+0+0]=r+n+1>>1,e[t+2+0]=e[t+0+32]=n+a+1>>1,e[t+2+32]=e[t+0+64]=a+s+1>>1,e[t+1+0]=yt(r,n,a),e[t+3+0]=e[t+1+32]=yt(n,a,s),e[t+3+32]=e[t+1+64]=yt(a,s,s),e[t+3+64]=e[t+2+64]=e[t+0+96]=e[t+1+96]=e[t+2+96]=e[t+3+96]=s}function Pt(e,t){var r=e[t-1+0],n=e[t-1+32],a=e[t-1+64],s=e[t-1+96],o=e[t-1-32],i=e[t+0-32],l=e[t+1-32],c=e[t+2-32];e[t+0+0]=e[t+2+32]=r+o+1>>1,e[t+0+32]=e[t+2+64]=n+r+1>>1,e[t+0+64]=e[t+2+96]=a+n+1>>1,e[t+0+96]=s+a+1>>1,e[t+3+0]=yt(i,l,c),e[t+2+0]=yt(o,i,l),e[t+1+0]=e[t+3+32]=yt(r,o,i),e[t+1+32]=e[t+3+64]=yt(n,r,o),e[t+1+64]=e[t+3+96]=yt(a,n,r),e[t+1+96]=yt(s,a,n)}function _t(e,t){var r;for(r=0;8>r;++r)n(e,t+32*r,e,t-32,8)}function It(e,t){var r;for(r=0;8>r;++r)a(e,t,e[t-1],8),t+=32}function Tt(e,t,r){var n;for(n=0;8>n;++n)a(t,r+32*n,e,8)}function Lt(e,t){var r,n=8;for(r=0;8>r;++r)n+=e[t+r-32]+e[t-1+32*r];Tt(n>>4,e,t)}function Dt(e,t){var r,n=4;for(r=0;8>r;++r)n+=e[t+r-32];Tt(n>>3,e,t)}function Mt(e,t){var r,n=4;for(r=0;8>r;++r)n+=e[t-1+32*r];Tt(n>>3,e,t)}function Ot(e,t){Tt(128,e,t)}function Rt(e,t,r){var n=e[t-r],a=e[t+0],s=3*(a-n)+In[1020+e[t-2*r]-e[t+r]],o=Tn[112+(s+4>>3)];e[t-r]=Ln[255+n+Tn[112+(s+3>>3)]],e[t+0]=Ln[255+a-o]}function Ft(e,t,r,n){var a=e[t+0],s=e[t+r];return Dn[255+e[t-2*r]-e[t-r]]>n||Dn[255+s-a]>n}function Ut(e,t,r,n){return 4*Dn[255+e[t-r]-e[t+0]]+Dn[255+e[t-2*r]-e[t+r]]<=n}function Bt(e,t,r,n,a){var s=e[t-3*r],o=e[t-2*r],i=e[t-r],l=e[t+0],c=e[t+r],d=e[t+2*r],u=e[t+3*r];return 4*Dn[255+i-l]+Dn[255+o-c]>n?0:Dn[255+e[t-4*r]-s]<=a&&Dn[255+s-o]<=a&&Dn[255+o-i]<=a&&Dn[255+u-d]<=a&&Dn[255+d-c]<=a&&Dn[255+c-l]<=a}function zt(e,t,r,n){var a=2*n+1;for(n=0;16>n;++n)Ut(e,t+n,r,a)&&Rt(e,t+n,r)}function Wt(e,t,r,n){var a=2*n+1;for(n=0;16>n;++n)Ut(e,t+n*r,1,a)&&Rt(e,t+n*r,1)}function qt(e,t,r,n){var a;for(a=3;0<a;--a)zt(e,t+=4*r,r,n)}function Vt(e,t,r,n){var a;for(a=3;0<a;--a)Wt(e,t+=4,r,n)}function Ht(e,t,r,n,a,s,o,i){for(s=2*s+1;0<a--;){if(Bt(e,t,r,s,o))if(Ft(e,t,r,i))Rt(e,t,r);else{var l=e,c=t,d=r,u=l[c-2*d],h=l[c-d],m=l[c+0],p=l[c+d],f=l[c+2*d],g=27*(x=In[1020+3*(m-h)+In[1020+u-p]])+63>>7,v=18*x+63>>7,x=9*x+63>>7;l[c-3*d]=Ln[255+l[c-3*d]+x],l[c-2*d]=Ln[255+u+v],l[c-d]=Ln[255+h+g],l[c+0]=Ln[255+m-g],l[c+d]=Ln[255+p-v],l[c+2*d]=Ln[255+f-x]}t+=n}}function Gt(e,t,r,n,a,s,o,i){for(s=2*s+1;0<a--;){if(Bt(e,t,r,s,o))if(Ft(e,t,r,i))Rt(e,t,r);else{var l=e,c=t,d=r,u=l[c-d],h=l[c+0],m=l[c+d],p=Tn[112+(4+(f=3*(h-u))>>3)],f=Tn[112+(f+3>>3)],g=p+1>>1;l[c-2*d]=Ln[255+l[c-2*d]+g],l[c-d]=Ln[255+u+f],l[c+0]=Ln[255+h-p],l[c+d]=Ln[255+m-g]}t+=n}}function Kt(e,t,r,n,a,s){Ht(e,t,r,1,16,n,a,s)}function Jt(e,t,r,n,a,s){Ht(e,t,1,r,16,n,a,s)}function Yt(e,t,r,n,a,s){var o;for(o=3;0<o;--o)Gt(e,t+=4*r,r,1,16,n,a,s)}function Xt(e,t,r,n,a,s){var o;for(o=3;0<o;--o)Gt(e,t+=4,1,r,16,n,a,s)}function Qt(e,t,r,n,a,s,o,i){Ht(e,t,a,1,8,s,o,i),Ht(r,n,a,1,8,s,o,i)}function Zt(e,t,r,n,a,s,o,i){Ht(e,t,1,a,8,s,o,i),Ht(r,n,1,a,8,s,o,i)}function $t(e,t,r,n,a,s,o,i){Gt(e,t+4*a,a,1,8,s,o,i),Gt(r,n+4*a,a,1,8,s,o,i)}function er(e,t,r,n,a,s,o,i){Gt(e,t+4,1,a,8,s,o,i),Gt(r,n+4,1,a,8,s,o,i)}function tr(){this.ba=new oe,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new le,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function rr(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function nr(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function ar(){this.ua=0,this.Wa=new M,this.vb=new M,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new m,this.yc=new u}function sr(){this.xb=this.a=0,this.l=new Ge,this.ca=new oe,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new w,this.Pb=0,this.wd=new w,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new ar,this.ab=0,this.gc=o(4,nr),this.Oc=0}function or(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ge,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ir(e,t,r,n,a,s,o){for(e=null==e?0:e[t+0],t=0;t<o;++t)a[s+t]=e+r[n+t]&255,e=a[s+t]}function lr(e,t,r,n,a,s,o){var i;if(null==e)ir(null,null,r,n,a,s,o);else for(i=0;i<o;++i)a[s+i]=e[t+i]+r[n+i]&255}function cr(e,t,r,n,a,s,o){if(null==e)ir(null,null,r,n,a,s,o);else{var i,l=e[t+0],c=l,d=l;for(i=0;i<o;++i)c=d+(l=e[t+i])-c,d=r[n+i]+(-256&c?0>c?0:255:c)&255,c=l,a[s+i]=d}}function dr(e,r,a,o){var i=r.width,l=r.o;if(t(null!=e&&null!=r),0>a||0>=o||a+o>l)return null;if(!e.Cc){if(null==e.ga){var c;if(e.ga=new or,(c=null==e.ga)||(c=r.width*r.o,t(0==e.Gb.length),e.Gb=s(c),e.Uc=0,null==e.Gb?c=0:(e.mb=e.Gb,e.nb=e.Uc,e.rc=null,c=1),c=!c),!c){c=e.ga;var d=e.Fa,u=e.P,h=e.qc,m=e.mb,p=e.nb,f=u+1,g=h-1,x=c.l;if(t(null!=d&&null!=m&&null!=r),fa[0]=null,fa[1]=ir,fa[2]=lr,fa[3]=cr,c.ca=m,c.tb=p,c.c=r.width,c.i=r.height,t(0<c.c&&0<c.i),1>=h)r=0;else if(c.$a=3&d[u+0],c.Z=d[u+0]>>2&3,c.Lc=d[u+0]>>4&3,u=d[u+0]>>6&3,0>c.$a||1<c.$a||4<=c.Z||1<c.Lc||u)r=0;else if(x.put=me,x.ac=he,x.bc=pe,x.ma=c,x.width=r.width,x.height=r.height,x.Da=r.Da,x.v=r.v,x.va=r.va,x.j=r.j,x.o=r.o,c.$a)e:{t(1==c.$a),r=Ee();t:for(;;){if(null==r){r=0;break e}if(t(null!=c),c.mc=r,r.c=c.c,r.i=c.i,r.l=c.l,r.l.ma=c,r.l.width=c.c,r.l.height=c.i,r.a=0,v(r.m,d,f,g),!Pe(c.c,c.i,1,r,null))break t;if(1==r.ab&&3==r.gc[0].hc&&Ne(r.s)?(c.ic=1,d=r.c*r.i,r.Ta=null,r.Ua=0,r.V=s(d),r.Ba=0,null==r.V?(r.a=1,r=0):r=1):(c.ic=0,r=_e(r,c.c)),!r)break t;r=1;break e}c.mc=null,r=0}else r=g>=c.c*c.i;c=!r}if(c)return null;1!=e.ga.Lc?e.Ga=0:o=l-a}t(null!=e.ga),t(a+o<=l);e:{if(r=(d=e.ga).c,l=d.l.o,0==d.$a){if(f=e.rc,g=e.Vc,x=e.Fa,u=e.P+1+a*r,h=e.mb,m=e.nb+a*r,t(u<=e.P+e.qc),0!=d.Z)for(t(null!=fa[d.Z]),c=0;c<o;++c)fa[d.Z](f,g,x,u,h,m,r),f=h,g=m,m+=r,u+=r;else for(c=0;c<o;++c)n(h,m,x,u,r),f=h,g=m,m+=r,u+=r;e.rc=f,e.Vc=g}else{if(t(null!=d.mc),r=a+o,t(null!=(c=d.mc)),t(r<=c.i),c.C>=r)r=1;else if(d.ic||fr(),d.ic){d=c.V,f=c.Ba,g=c.c;var b=c.i,y=(x=1,u=c.$/g,h=c.$%g,m=c.m,p=c.s,c.$),w=g*b,j=g*r,S=p.wc,A=y<j?ye(p,h,u):null;t(y<=w),t(r<=b),t(Ne(p));t:for(;;){for(;!m.h&&y<j;){if(h&S||(A=ye(p,h,u)),t(null!=A),k(m),256>(b=xe(A.G[0],A.H[0],m)))d[f+y]=b,++y,++h>=g&&(h=0,++u<=r&&!(u%16)&&ke(c,u));else{if(!(280>b)){x=0;break t}b=ge(b-256,m);var C,E=xe(A.G[4],A.H[4],m);if(k(m),!(y>=(E=ve(g,E=ge(E,m)))&&w-y>=b)){x=0;break t}for(C=0;C<b;++C)d[f+y+C]=d[f+y+C-E];for(y+=b,h+=b;h>=g;)h-=g,++u<=r&&!(u%16)&&ke(c,u);y<j&&h&S&&(A=ye(p,h,u))}t(m.h==N(m))}ke(c,u>r?r:u);break t}!x||m.h&&y<w?(x=0,c.a=m.h?5:3):c.$=y,r=x}else r=Ae(c,c.V,c.Ba,c.c,c.i,r,Ie);if(!r){o=0;break e}}a+o>=l&&(e.Cc=1),o=1}if(!o)return null;if(e.Cc&&(null!=(o=e.ga)&&(o.mc=null),e.ga=null,0<e.Ga))return alert("todo:WebPDequantizeLevels"),null}return e.nb+a*i}function ur(e,t,r,n,a,s){for(;0<a--;){var o,i=e,l=t+(r?1:0),c=e,d=t+(r?0:3);for(o=0;o<n;++o){var u=c[d+4*o];255!=u&&(u*=32897,i[l+4*o+0]=i[l+4*o+0]*u>>23,i[l+4*o+1]=i[l+4*o+1]*u>>23,i[l+4*o+2]=i[l+4*o+2]*u>>23)}t+=s}}function hr(e,t,r,n,a){for(;0<n--;){var s;for(s=0;s<r;++s){var o=e[t+2*s+0],i=15&(c=e[t+2*s+1]),l=4369*i,c=(240&c|c>>4)*l>>16;e[t+2*s+0]=(240&o|o>>4)*l>>16&240|(15&o|o<<4)*l>>16>>4&15,e[t+2*s+1]=240&c|i}t+=a}}function mr(e,t,r,n,a,s,o,i){var l,c,d=255;for(c=0;c<a;++c){for(l=0;l<n;++l){var u=e[t+l];s[o+4*l]=u,d&=u}t+=r,o+=i}return 255!=d}function pr(e,t,r,n,a){var s;for(s=0;s<a;++s)r[n+s]=e[t+s]>>8}function fr(){jn=ur,Nn=hr,Sn=mr,kn=pr}function gr(r,n,a){e[r]=function(e,r,s,o,i,l,c,d,u,h,m,p,f,g,v,x,b){var y,w=b-1>>1,j=i[l+0]|c[d+0]<<16,N=u[h+0]|m[p+0]<<16;t(null!=e);var S=3*j+N+131074>>2;for(n(e[r+0],255&S,S>>16,f,g),null!=s&&(S=3*N+j+131074>>2,n(s[o+0],255&S,S>>16,v,x)),y=1;y<=w;++y){var k=i[l+y]|c[d+y]<<16,A=u[h+y]|m[p+y]<<16,C=j+k+N+A+524296,E=C+2*(k+N)>>3;S=E+j>>1,j=(C=C+2*(j+A)>>3)+k>>1,n(e[r+2*y-1],255&S,S>>16,f,g+(2*y-1)*a),n(e[r+2*y-0],255&j,j>>16,f,g+(2*y-0)*a),null!=s&&(S=C+N>>1,j=E+A>>1,n(s[o+2*y-1],255&S,S>>16,v,x+(2*y-1)*a),n(s[o+2*y+0],255&j,j>>16,v,x+(2*y+0)*a)),j=k,N=A}1&b||(S=3*j+N+131074>>2,n(e[r+b-1],255&S,S>>16,f,g+(b-1)*a),null!=s&&(S=3*N+j+131074>>2,n(s[o+b-1],255&S,S>>16,v,x+(b-1)*a)))}}function vr(){ga[Mn]=va,ga[On]=ba,ga[Rn]=xa,ga[Fn]=ya,ga[Un]=wa,ga[Bn]=ja,ga[zn]=Na,ga[Wn]=ba,ga[qn]=ya,ga[Vn]=wa,ga[Hn]=ja}function xr(e){return e&~Pa?0>e?0:255:e>>Ea}function br(e,t){return xr((19077*e>>8)+(26149*t>>8)-14234)}function yr(e,t,r){return xr((19077*e>>8)-(6419*t>>8)-(13320*r>>8)+8708)}function wr(e,t){return xr((19077*e>>8)+(33050*t>>8)-17685)}function jr(e,t,r,n,a){n[a+0]=br(e,r),n[a+1]=yr(e,t,r),n[a+2]=wr(e,t)}function Nr(e,t,r,n,a){n[a+0]=wr(e,t),n[a+1]=yr(e,t,r),n[a+2]=br(e,r)}function Sr(e,t,r,n,a){var s=yr(e,t,r);t=s<<3&224|wr(e,t)>>3,n[a+0]=248&br(e,r)|s>>5,n[a+1]=t}function kr(e,t,r,n,a){var s=240&wr(e,t)|15;n[a+0]=240&br(e,r)|yr(e,t,r)>>4,n[a+1]=s}function Ar(e,t,r,n,a){n[a+0]=255,jr(e,t,r,n,a+1)}function Cr(e,t,r,n,a){Nr(e,t,r,n,a),n[a+3]=255}function Er(e,t,r,n,a){jr(e,t,r,n,a),n[a+3]=255}function Pr(t,r,n){e[t]=function(e,t,a,s,o,i,l,c,d){for(var u=c+(-2&d)*n;c!=u;)r(e[t+0],a[s+0],o[i+0],l,c),r(e[t+1],a[s+0],o[i+0],l,c+n),t+=2,++s,++i,c+=2*n;1&d&&r(e[t+0],a[s+0],o[i+0],l,c)}}function _r(e,t,r){return 0==r?0==e?0==t?6:5:0==t?4:0:r}function Ir(e,t,r,n,a){switch(e>>>30){case 3:an(t,r,n,a,0);break;case 2:sn(t,r,n,a);break;case 1:ln(t,r,n,a)}}function Tr(e,t){var r,s,o=t.M,i=t.Nb,l=e.oc,c=e.pc+40,d=e.oc,u=e.pc+584,h=e.oc,m=e.pc+600;for(r=0;16>r;++r)l[c+32*r-1]=129;for(r=0;8>r;++r)d[u+32*r-1]=129,h[m+32*r-1]=129;for(0<o?l[c-1-32]=d[u-1-32]=h[m-1-32]=129:(a(l,c-32-1,127,21),a(d,u-32-1,127,9),a(h,m-32-1,127,9)),s=0;s<e.za;++s){var p=t.ya[t.aa+s];if(0<s){for(r=-1;16>r;++r)n(l,c+32*r-4,l,c+32*r+12,4);for(r=-1;8>r;++r)n(d,u+32*r-4,d,u+32*r+4,4),n(h,m+32*r-4,h,m+32*r+4,4)}var f=e.Gd,g=e.Hd+s,v=p.ad,x=p.Hc;if(0<o&&(n(l,c-32,f[g].y,0,16),n(d,u-32,f[g].f,0,8),n(h,m-32,f[g].ea,0,8)),p.Za){var b=l,y=c-32+16;for(0<o&&(s>=e.za-1?a(b,y,f[g].y[15],4):n(b,y,f[g+1].y,0,4)),r=0;4>r;r++)b[y+128+r]=b[y+256+r]=b[y+384+r]=b[y+0+r];for(r=0;16>r;++r,x<<=2)b=l,y=c+Ra[r],ua[p.Ob[r]](b,y),Ir(x,v,16*+r,b,y)}else if(b=_r(s,o,p.Ob[0]),da[b](l,c),0!=x)for(r=0;16>r;++r,x<<=2)Ir(x,v,16*+r,l,c+Ra[r]);for(r=p.Gc,b=_r(s,o,p.Dd),ha[b](d,u),ha[b](h,m),x=v,b=d,y=u,255&(p=0|r)&&(170&p?on(x,256,b,y):cn(x,256,b,y)),p=h,x=m,255&(r>>=8)&&(170&r?on(v,320,p,x):cn(v,320,p,x)),o<e.Ub-1&&(n(f[g].y,0,l,c+480,16),n(f[g].f,0,d,u+224,8),n(f[g].ea,0,h,m+224,8)),r=8*i*e.B,f=e.sa,g=e.ta+16*s+16*i*e.R,v=e.qa,p=e.ra+8*s+r,x=e.Ha,b=e.Ia+8*s+r,r=0;16>r;++r)n(f,g+r*e.R,l,c+32*r,16);for(r=0;8>r;++r)n(v,p+r*e.B,d,u+32*r,8),n(x,b+r*e.B,h,m+32*r,8)}}function Lr(e,n,a,s,o,i,l,c,d){var u=[0],h=[0],m=0,p=null!=d?d.kd:0,f=null!=d?d:new rr;if(null==e||12>a)return 7;f.data=e,f.w=n,f.ha=a,n=[n],a=[a],f.gb=[f.gb];e:{var g=n,x=a,b=f.gb;if(t(null!=e),t(null!=x),t(null!=b),b[0]=0,12<=x[0]&&!r(e,g[0],"RIFF")){if(r(e,g[0]+8,"WEBP")){b=3;break e}var y=T(e,g[0]+4);if(12>y||4294967286<y){b=3;break e}if(p&&y>x[0]-8){b=7;break e}b[0]=y,g[0]+=12,x[0]-=12}b=0}if(0!=b)return b;for(y=0<f.gb[0],a=a[0];;){e:{var j=e;x=n,b=a;var N=u,S=h,k=g=[0];if((E=m=[m])[0]=0,8>b[0])b=7;else{if(!r(j,x[0],"VP8X")){if(10!=T(j,x[0]+4)){b=3;break e}if(18>b[0]){b=7;break e}var A=T(j,x[0]+8),C=1+I(j,x[0]+12);if(2147483648<=C*(j=1+I(j,x[0]+15))){b=3;break e}null!=k&&(k[0]=A),null!=N&&(N[0]=C),null!=S&&(S[0]=j),x[0]+=18,b[0]-=18,E[0]=1}b=0}}if(m=m[0],g=g[0],0!=b)return b;if(x=!!(2&g),!y&&m)return 3;if(null!=i&&(i[0]=!!(16&g)),null!=l&&(l[0]=x),null!=c&&(c[0]=0),l=u[0],g=h[0],m&&x&&null==d){b=0;break}if(4>a){b=7;break}if(y&&m||!y&&!m&&!r(e,n[0],"ALPH")){a=[a],f.na=[f.na],f.P=[f.P],f.Sa=[f.Sa];e:{A=e,b=n,y=a;var E=f.gb;N=f.na,S=f.P,k=f.Sa,C=22,t(null!=A),t(null!=y),j=b[0];var P=y[0];for(t(null!=N),t(null!=k),N[0]=null,S[0]=null,k[0]=0;;){if(b[0]=j,y[0]=P,8>P){b=7;break e}var _=T(A,j+4);if(4294967286<_){b=3;break e}var L=8+_+1&-2;if(C+=L,0<E&&C>E){b=3;break e}if(!r(A,j,"VP8 ")||!r(A,j,"VP8L")){b=0;break e}if(P[0]<L){b=7;break e}r(A,j,"ALPH")||(N[0]=A,S[0]=j+8,k[0]=_),j+=L,P-=L}}if(a=a[0],f.na=f.na[0],f.P=f.P[0],f.Sa=f.Sa[0],0!=b)break}a=[a],f.Ja=[f.Ja],f.xa=[f.xa];e:if(E=e,b=n,y=a,N=f.gb[0],S=f.Ja,k=f.xa,A=b[0],j=!r(E,A,"VP8 "),C=!r(E,A,"VP8L"),t(null!=E),t(null!=y),t(null!=S),t(null!=k),8>y[0])b=7;else{if(j||C){if(E=T(E,A+4),12<=N&&E>N-12){b=3;break e}if(p&&E>y[0]-8){b=7;break e}S[0]=E,b[0]+=8,y[0]-=8,k[0]=C}else k[0]=5<=y[0]&&47==E[A+0]&&!(E[A+4]>>5),S[0]=y[0];b=0}if(a=a[0],f.Ja=f.Ja[0],f.xa=f.xa[0],n=n[0],0!=b)break;if(4294967286<f.Ja)return 3;if(null==c||x||(c[0]=f.xa?2:1),l=[l],g=[g],f.xa){if(5>a){b=7;break}c=l,p=g,x=i,null==e||5>a?e=0:5<=a&&47==e[n+0]&&!(e[n+4]>>5)?(y=[0],E=[0],N=[0],v(S=new w,e,n,a),fe(S,y,E,N)?(null!=c&&(c[0]=y[0]),null!=p&&(p[0]=E[0]),null!=x&&(x[0]=N[0]),e=1):e=0):e=0}else{if(10>a){b=7;break}c=g,null==e||10>a||!Ye(e,n+3,a-3)?e=0:(p=e[n+0]|e[n+1]<<8|e[n+2]<<16,x=16383&(e[n+7]<<8|e[n+6]),e=16383&(e[n+9]<<8|e[n+8]),1&p||3<(p>>1&7)||!(p>>4&1)||p>>5>=f.Ja||!x||!e?e=0:(l&&(l[0]=x),c&&(c[0]=e),e=1))}if(!e)return 3;if(l=l[0],g=g[0],m&&(u[0]!=l||h[0]!=g))return 3;null!=d&&(d[0]=f,d.offset=n-d.w,t(4294967286>n-d.w),t(d.offset==d.ha-a));break}return 0==b||7==b&&m&&null==d?(null!=i&&(i[0]|=null!=f.na&&0<f.na.length),null!=s&&(s[0]=l),null!=o&&(o[0]=g),0):b}function Dr(e,t,r){var n=t.width,a=t.height,s=0,o=0,i=n,l=a;if(t.Da=null!=e&&0<e.Da,t.Da&&(i=e.cd,l=e.bd,s=e.v,o=e.j,11>r||(s&=-2,o&=-2),0>s||0>o||0>=i||0>=l||s+i>n||o+l>a))return 0;if(t.v=s,t.j=o,t.va=s+i,t.o=o+l,t.U=i,t.T=l,t.da=null!=e&&0<e.da,t.da){if(!O(i,l,r=[e.ib],s=[e.hb]))return 0;t.ib=r[0],t.hb=s[0]}return t.ob=null!=e&&e.ob,t.Kb=null==e||!e.Sd,t.da&&(t.ob=t.ib<3*n/4&&t.hb<3*a/4,t.Kb=0),1}function Mr(e){if(null==e)return 2;if(11>e.S){var t=e.f.RGBA;t.fb+=(e.height-1)*t.A,t.A=-t.A}else t=e.f.kb,e=e.height,t.O+=(e-1)*t.fa,t.fa=-t.fa,t.N+=(e-1>>1)*t.Ab,t.Ab=-t.Ab,t.W+=(e-1>>1)*t.Db,t.Db=-t.Db,null!=t.F&&(t.J+=(e-1)*t.lb,t.lb=-t.lb);return 0}function Or(e,t,r,n){if(null==n||0>=e||0>=t)return 2;if(null!=r){if(r.Da){var a=r.cd,o=r.bd,i=-2&r.v,l=-2&r.j;if(0>i||0>l||0>=a||0>=o||i+a>e||l+o>t)return 2;e=a,t=o}if(r.da){if(!O(e,t,a=[r.ib],o=[r.hb]))return 2;e=a[0],t=o[0]}}n.width=e,n.height=t;e:{var c=n.width,d=n.height;if(e=n.S,0>=c||0>=d||!(e>=Mn&&13>e))e=2;else{if(0>=n.Rd&&null==n.sd){i=o=a=t=0;var u=(l=c*Ba[e])*d;if(11>e||(o=(d+1)/2*(t=(c+1)/2),12==e&&(i=(a=c)*d)),null==(d=s(u+2*o+i))){e=1;break e}n.sd=d,11>e?((c=n.f.RGBA).eb=d,c.fb=0,c.A=l,c.size=u):((c=n.f.kb).y=d,c.O=0,c.fa=l,c.Fd=u,c.f=d,c.N=0+u,c.Ab=t,c.Cd=o,c.ea=d,c.W=0+u+o,c.Db=t,c.Ed=o,12==e&&(c.F=d,c.J=0+u+2*o),c.Tc=i,c.lb=a)}if(t=1,a=n.S,o=n.width,i=n.height,a>=Mn&&13>a)if(11>a)e=n.f.RGBA,t&=(l=Math.abs(e.A))*(i-1)+o<=e.size,t&=l>=o*Ba[a],t&=null!=e.eb;else{e=n.f.kb,l=(o+1)/2,u=(i+1)/2,c=Math.abs(e.fa),d=Math.abs(e.Ab);var h=Math.abs(e.Db),m=Math.abs(e.lb),p=m*(i-1)+o;t&=c*(i-1)+o<=e.Fd,t&=d*(u-1)+l<=e.Cd,t=(t&=h*(u-1)+l<=e.Ed)&c>=o&d>=l&h>=l,t&=null!=e.y,t&=null!=e.f,t&=null!=e.ea,12==a&&(t&=m>=o,t&=p<=e.Tc,t&=null!=e.F)}else t=0;e=t?0:2}}return 0!=e||null!=r&&r.fd&&(e=Mr(n)),e}var Rr=64,Fr=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Ur=24,Br=32,zr=8,Wr=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];U("Predictor0","PredictorAdd0"),e.Predictor0=function(){return 4278190080},e.Predictor1=function(e){return e},e.Predictor2=function(e,t,r){return t[r+0]},e.Predictor3=function(e,t,r){return t[r+1]},e.Predictor4=function(e,t,r){return t[r-1]},e.Predictor5=function(e,t,r){return z(z(e,t[r+1]),t[r+0])},e.Predictor6=function(e,t,r){return z(e,t[r-1])},e.Predictor7=function(e,t,r){return z(e,t[r+0])},e.Predictor8=function(e,t,r){return z(t[r-1],t[r+0])},e.Predictor9=function(e,t,r){return z(t[r+0],t[r+1])},e.Predictor10=function(e,t,r){return z(z(e,t[r-1]),z(t[r+0],t[r+1]))},e.Predictor11=function(e,t,r){var n=t[r+0];return 0>=V(n>>24&255,e>>24&255,(t=t[r-1])>>24&255)+V(n>>16&255,e>>16&255,t>>16&255)+V(n>>8&255,e>>8&255,t>>8&255)+V(255&n,255&e,255&t)?n:e},e.Predictor12=function(e,t,r){var n=t[r+0];return(W((e>>24&255)+(n>>24&255)-((t=t[r-1])>>24&255))<<24|W((e>>16&255)+(n>>16&255)-(t>>16&255))<<16|W((e>>8&255)+(n>>8&255)-(t>>8&255))<<8|W((255&e)+(255&n)-(255&t)))>>>0},e.Predictor13=function(e,t,r){var n=t[r-1];return(q((e=z(e,t[r+0]))>>24&255,n>>24&255)<<24|q(e>>16&255,n>>16&255)<<16|q(e>>8&255,n>>8&255)<<8|q(255&e,255&n))>>>0};var qr=e.PredictorAdd0;e.PredictorAdd1=H,U("Predictor2","PredictorAdd2"),U("Predictor3","PredictorAdd3"),U("Predictor4","PredictorAdd4"),U("Predictor5","PredictorAdd5"),U("Predictor6","PredictorAdd6"),U("Predictor7","PredictorAdd7"),U("Predictor8","PredictorAdd8"),U("Predictor9","PredictorAdd9"),U("Predictor10","PredictorAdd10"),U("Predictor11","PredictorAdd11"),U("Predictor12","PredictorAdd12"),U("Predictor13","PredictorAdd13");var Vr=e.PredictorAdd2;Y("ColorIndexInverseTransform","MapARGB","32b",function(e){return e>>8&255},function(e){return e}),Y("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(e){return e},function(e){return e>>8&255});var Hr,Gr=e.ColorIndexInverseTransform,Kr=e.MapARGB,Jr=e.VP8LColorIndexInverseTransformAlpha,Yr=e.MapAlpha,Xr=e.VP8LPredictorsAdd=[];Xr.length=16,(e.VP8LPredictors=[]).length=16,(e.VP8LPredictorsAdd_C=[]).length=16,(e.VP8LPredictors_C=[]).length=16;var Qr,Zr,$r,en,tn,rn,nn,an,sn,on,ln,cn,dn,un,hn,mn,pn,fn,gn,vn,xn,bn,yn,wn,jn,Nn,Sn,kn,An=s(511),Cn=s(2041),En=s(225),Pn=s(767),_n=0,In=Cn,Tn=En,Ln=Pn,Dn=An,Mn=0,On=1,Rn=2,Fn=3,Un=4,Bn=5,zn=6,Wn=7,qn=8,Vn=9,Hn=10,Gn=[2,3,7],Kn=[3,3,11],Jn=[280,256,256,256,40],Yn=[0,1,1,1,0],Xn=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Qn=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Zn=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],$n=8,ea=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ta=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ra=null,na=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],aa=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],sa=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],oa=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],ia=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],la=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],ca=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],da=[],ua=[],ha=[],ma=1,pa=2,fa=[],ga=[];gr("UpsampleRgbLinePair",jr,3),gr("UpsampleBgrLinePair",Nr,3),gr("UpsampleRgbaLinePair",Er,4),gr("UpsampleBgraLinePair",Cr,4),gr("UpsampleArgbLinePair",Ar,4),gr("UpsampleRgba4444LinePair",kr,2),gr("UpsampleRgb565LinePair",Sr,2);var va=e.UpsampleRgbLinePair,xa=e.UpsampleBgrLinePair,ba=e.UpsampleRgbaLinePair,ya=e.UpsampleBgraLinePair,wa=e.UpsampleArgbLinePair,ja=e.UpsampleRgba4444LinePair,Na=e.UpsampleRgb565LinePair,Sa=16,ka=1<<Sa-1,Aa=-227,Ca=482,Ea=6,Pa=(256<<Ea)-1,_a=0,Ia=s(256),Ta=s(256),La=s(256),Da=s(256),Ma=s(Ca-Aa),Oa=s(Ca-Aa);Pr("YuvToRgbRow",jr,3),Pr("YuvToBgrRow",Nr,3),Pr("YuvToRgbaRow",Er,4),Pr("YuvToBgraRow",Cr,4),Pr("YuvToArgbRow",Ar,4),Pr("YuvToRgba4444Row",kr,2),Pr("YuvToRgb565Row",Sr,2);var Ra=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Fa=[0,2,8],Ua=[8,7,6,4,4,2,2,2,1,1,1,1];this.WebPDecodeRGBA=function(e,r,i,l,c){var d=On,u=new tr,h=new oe;u.ba=h,h.S=d,h.width=[h.width],h.height=[h.height];var m=h.width,p=h.height,f=new ie;if(null==f||null==e)var g=2;else t(null!=f),g=Lr(e,r,i,f.width,f.height,f.Pd,f.Qd,f.format,null);if(0!=g?m=0:(null!=m&&(m[0]=f.width[0]),null!=p&&(p[0]=f.height[0]),m=1),m){h.width=h.width[0],h.height=h.height[0],null!=l&&(l[0]=h.width),null!=c&&(c[0]=h.height);e:{if(l=new Ge,(c=new rr).data=e,c.w=r,c.ha=i,c.kd=1,r=[0],t(null!=c),(0==(e=Lr(c.data,c.w,c.ha,null,null,null,r,null,c))||7==e)&&r[0]&&(e=4),0==(r=e)){if(t(null!=u),l.data=c.data,l.w=c.w+c.offset,l.ha=c.ha-c.offset,l.put=me,l.ac=he,l.bc=pe,l.ma=u,c.xa){if(null==(e=Ee())){u=1;break e}if(function(e,r){var n=[0],a=[0],s=[0];t:for(;;){if(null==e)return 0;if(null==r)return e.a=2,0;if(e.l=r,e.a=0,v(e.m,r.data,r.w,r.ha),!fe(e.m,n,a,s)){e.a=3;break t}if(e.xb=pa,r.width=n[0],r.height=a[0],!Pe(n[0],a[0],1,e,null))break t;return 1}return t(0!=e.a),0}(e,l)){if(l=0==(r=Or(l.width,l.height,u.Oa,u.ba))){t:{l=e;r:for(;;){if(null==l){l=0;break t}if(t(null!=l.s.yc),t(null!=l.s.Ya),t(0<l.s.Wb),t(null!=(i=l.l)),t(null!=(c=i.ma)),0!=l.xb){if(l.ca=c.ba,l.tb=c.tb,t(null!=l.ca),!Dr(c.Oa,i,Fn)){l.a=2;break r}if(!_e(l,i.width))break r;if(i.da)break r;if((i.da||ne(l.ca.S))&&fr(),11>l.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=l.ca.f.kb.F&&fr()),l.Pb&&0<l.s.ua&&null==l.s.vb.X&&!L(l.s.vb,l.s.Wa.Xa)){l.a=1;break r}l.xb=0}if(!Ae(l,l.V,l.Ba,l.c,l.i,i.o,je))break r;c.Dc=l.Ma,l=1;break t}t(0!=l.a),l=0}l=!l}l&&(r=e.a)}else r=e.a}else{if(null==(e=new Ke)){u=1;break e}if(e.Fa=c.na,e.P=c.P,e.qc=c.Sa,Xe(e,l)){if(0==(r=Or(l.width,l.height,u.Oa,u.ba))){if(e.Aa=0,i=u.Oa,t(null!=(c=e)),null!=i){if(0<(m=0>(m=i.Md)?0:100<m?255:255*m/100)){for(p=f=0;4>p;++p)12>(g=c.pb[p]).lc&&(g.ia=m*Ua[0>g.lc?0:g.lc]>>3),f|=g.ia;f&&(alert("todo:VP8InitRandom"),c.ia=1)}c.Ga=i.Id,100<c.Ga?c.Ga=100:0>c.Ga&&(c.Ga=0)}(function(e,r){if(null==e)return 0;if(null==r)return Je(e,2,"NULL VP8Io parameter in VP8Decode().");if(!e.cb&&!Xe(e,r))return 0;if(t(e.cb),null==r.ac||r.ac(r)){r.ob&&(e.L=0);var i=Fa[e.L];if(2==e.L?(e.yb=0,e.zb=0):(e.yb=r.v-i>>4,e.zb=r.j-i>>4,0>e.yb&&(e.yb=0),0>e.zb&&(e.zb=0)),e.Va=r.o+15+i>>4,e.Hb=r.va+15+i>>4,e.Hb>e.za&&(e.Hb=e.za),e.Va>e.Ub&&(e.Va=e.Ub),0<e.L){var l=e.ed;for(i=0;4>i;++i){var c;if(e.Qa.Cb){var d=e.Qa.Lb[i];e.Qa.Fb||(d+=l.Tb)}else d=l.Tb;for(c=0;1>=c;++c){var u=e.gd[i][c],h=d;if(l.Pc&&(h+=l.vd[0],c&&(h+=l.od[0])),0<(h=0>h?0:63<h?63:h)){var m=h;0<l.wb&&(m=4<l.wb?m>>2:m>>1)>9-l.wb&&(m=9-l.wb),1>m&&(m=1),u.dd=m,u.tc=2*h+m,u.ld=40<=h?2:15<=h?1:0}else u.tc=0;u.La=c}}}i=0}else Je(e,6,"Frame setup failed"),i=e.a;if(i=0==i){if(i){e.$c=0,0<e.Aa||(e.Ic=1);t:{i=e.Ic,l=4*(m=e.za);var p=32*m,f=m+1,g=0<e.L?m*(0<e.Aa?2:1):0,v=(2==e.Aa?2:1)*m;if((u=l+832+(c=3*(16*i+Fa[e.L])/2*p)+(d=null!=e.Fa&&0<e.Fa.length?e.Kc.c*e.Kc.i:0))!=u)i=0;else{if(u>e.Vb){if(e.Vb=0,e.Ec=s(u),e.Fc=0,null==e.Ec){i=Je(e,1,"no memory during frame initialization.");break t}e.Vb=u}u=e.Ec,h=e.Fc,e.Ac=u,e.Bc=h,h+=l,e.Gd=o(p,qe),e.Hd=0,e.rb=o(f+1,Ue),e.sb=1,e.wa=g?o(g,Fe):null,e.Y=0,e.D.Nb=0,e.D.wa=e.wa,e.D.Y=e.Y,0<e.Aa&&(e.D.Y+=m),t(!0),e.oc=u,e.pc=h,h+=832,e.ya=o(v,ze),e.aa=0,e.D.ya=e.ya,e.D.aa=e.aa,2==e.Aa&&(e.D.aa+=m),e.R=16*m,e.B=8*m,m=(p=Fa[e.L])*e.R,p=p/2*e.B,e.sa=u,e.ta=h+m,e.qa=e.sa,e.ra=e.ta+16*i*e.R+p,e.Ha=e.qa,e.Ia=e.ra+8*i*e.B+p,e.$c=0,h+=c,e.mb=d?u:null,e.nb=d?h:null,t(h+d<=e.Fc+e.Vb),Ze(e),a(e.Ac,e.Bc,0,l),i=1}}if(i){if(r.ka=0,r.y=e.sa,r.O=e.ta,r.f=e.qa,r.N=e.ra,r.ea=e.Ha,r.Vd=e.Ia,r.fa=e.R,r.Rc=e.B,r.F=null,r.J=0,!_n){for(i=-255;255>=i;++i)An[255+i]=0>i?-i:i;for(i=-1020;1020>=i;++i)Cn[1020+i]=-128>i?-128:127<i?127:i;for(i=-112;112>=i;++i)En[112+i]=-16>i?-16:15<i?15:i;for(i=-255;510>=i;++i)Pn[255+i]=0>i?0:255<i?255:i;_n=1}nn=lt,an=at,on=st,ln=ot,cn=it,sn=nt,dn=Kt,un=Jt,hn=Qt,mn=Zt,pn=Yt,fn=Xt,gn=$t,vn=er,xn=zt,bn=Wt,yn=qt,wn=Vt,ua[0]=Nt,ua[1]=dt,ua[2]=wt,ua[3]=jt,ua[4]=St,ua[5]=At,ua[6]=kt,ua[7]=Ct,ua[8]=Pt,ua[9]=Et,da[0]=gt,da[1]=ht,da[2]=mt,da[3]=pt,da[4]=vt,da[5]=xt,da[6]=bt,ha[0]=Lt,ha[1]=ut,ha[2]=_t,ha[3]=It,ha[4]=Mt,ha[5]=Dt,ha[6]=Ot,i=1}else i=0}i&&(i=function(e,r){for(e.M=0;e.M<e.Va;++e.M){var o,i=e.Jc[e.M&e.Xb],l=e.m,c=e;for(o=0;o<c.za;++o){var d=l,u=c,h=u.Ac,m=u.Bc+4*o,p=u.zc,f=u.ya[u.aa+o];if(u.Qa.Bb?f.$b=E(d,u.Pa.jb[0])?2+E(d,u.Pa.jb[2]):E(d,u.Pa.jb[1]):f.$b=0,u.kc&&(f.Ad=E(d,u.Bd)),f.Za=!E(d,145)+0,f.Za){var g=f.Ob,v=0;for(u=0;4>u;++u){var x,b=p[0+u];for(x=0;4>x;++x){b=ia[h[m+x]][b];for(var y=sa[E(d,b[0])];0<y;)y=sa[2*y+E(d,b[y])];b=-y,h[m+x]=b}n(g,v,h,m,4),v+=4,p[0+u]=b}}else b=E(d,156)?E(d,128)?1:3:E(d,163)?2:0,f.Ob[0]=b,a(h,m,b,4),a(p,0,b,4);f.Dd=E(d,142)?E(d,114)?E(d,183)?1:3:2:0}if(c.m.Ka)return Je(e,7,"Premature end-of-partition0 encountered.");for(;e.ja<e.za;++e.ja){if(c=i,d=(l=e).rb[l.sb-1],h=l.rb[l.sb+l.ja],o=l.ya[l.aa+l.ja],m=l.kc?o.Ad:0)d.la=h.la=0,o.Za||(d.Na=h.Na=0),o.Hc=0,o.Gc=0,o.ia=0;else{var w,j;if(d=h,h=c,m=l.Pa.Xc,p=l.ya[l.aa+l.ja],f=l.pb[p.$b],u=p.ad,g=0,v=l.rb[l.sb-1],b=x=0,a(u,g,0,384),p.Za)var N=0,S=m[3];else{y=s(16);var k=d.Na+v.Na;if(k=ra(h,m[1],k,f.Eb,0,y,0),d.Na=v.Na=(0<k)+0,1<k)nn(y,0,u,g);else{var A=y[0]+3>>3;for(y=0;256>y;y+=16)u[g+y]=A}N=1,S=m[0]}var C=15&d.la,P=15&v.la;for(y=0;4>y;++y){var _=1&P;for(A=j=0;4>A;++A)C=C>>1|(_=(k=ra(h,S,k=_+(1&C),f.Sc,N,u,g))>N)<<7,j=j<<2|(3<k?3:1<k?2:0!=u[g+0]),g+=16;C>>=4,P=P>>1|_<<7,x=(x<<8|j)>>>0}for(S=C,N=P>>4,w=0;4>w;w+=2){for(j=0,C=d.la>>4+w,P=v.la>>4+w,y=0;2>y;++y){for(_=1&P,A=0;2>A;++A)k=_+(1&C),C=C>>1|(_=0<(k=ra(h,m[2],k,f.Qc,0,u,g)))<<3,j=j<<2|(3<k?3:1<k?2:0!=u[g+0]),g+=16;C>>=2,P=P>>1|_<<5}b|=j<<4*w,S|=C<<4<<w,N|=(240&P)<<w}d.la=S,v.la=N,p.Hc=x,p.Gc=b,p.ia=43690&b?0:f.ia,m=!(x|b)}if(0<l.L&&(l.wa[l.Y+l.ja]=l.gd[o.$b][o.Za],l.wa[l.Y+l.ja].La|=!m),c.Ka)return Je(e,7,"Premature end-of-file encountered.")}if(Ze(e),l=r,c=1,o=(i=e).D,d=0<i.L&&i.M>=i.zb&&i.M<=i.Va,0==i.Aa)t:{if(o.M=i.M,o.uc=d,Tr(i,o),c=1,o=(j=i.D).Nb,d=(b=Fa[i.L])*i.R,h=b/2*i.B,y=16*o*i.R,A=8*o*i.B,m=i.sa,p=i.ta-d+y,f=i.qa,u=i.ra-h+A,g=i.Ha,v=i.Ia-h+A,P=0==(C=j.M),x=C>=i.Va-1,2==i.Aa&&Tr(i,j),j.uc)for(_=(k=i).D.M,t(k.D.uc),j=k.yb;j<k.Hb;++j){N=j,S=_;var I=(T=(z=k).D).Nb;w=z.R;var T=T.wa[T.Y+N],L=z.sa,D=z.ta+16*I*w+16*N,M=T.dd,O=T.tc;if(0!=O)if(t(3<=O),1==z.L)0<N&&bn(L,D,w,O+4),T.La&&wn(L,D,w,O),0<S&&xn(L,D,w,O+4),T.La&&yn(L,D,w,O);else{var R=z.B,F=z.qa,U=z.ra+8*I*R+8*N,B=z.Ha,z=z.Ia+8*I*R+8*N;I=T.ld,0<N&&(un(L,D,w,O+4,M,I),mn(F,U,B,z,R,O+4,M,I)),T.La&&(fn(L,D,w,O,M,I),vn(F,U,B,z,R,O,M,I)),0<S&&(dn(L,D,w,O+4,M,I),hn(F,U,B,z,R,O+4,M,I)),T.La&&(pn(L,D,w,O,M,I),gn(F,U,B,z,R,O,M,I))}}if(i.ia&&alert("todo:DitherRow"),null!=l.put){if(j=16*C,C=16*(C+1),P?(l.y=i.sa,l.O=i.ta+y,l.f=i.qa,l.N=i.ra+A,l.ea=i.Ha,l.W=i.Ia+A):(j-=b,l.y=m,l.O=p,l.f=f,l.N=u,l.ea=g,l.W=v),x||(C-=b),C>l.o&&(C=l.o),l.F=null,l.J=null,null!=i.Fa&&0<i.Fa.length&&j<C&&(l.J=dr(i,l,j,C-j),l.F=i.mb,null==l.F&&0==l.F.length)){c=Je(i,3,"Could not decode alpha data.");break t}j<l.j&&(b=l.j-j,j=l.j,t(!(1&b)),l.O+=i.R*b,l.N+=i.B*(b>>1),l.W+=i.B*(b>>1),null!=l.F&&(l.J+=l.width*b)),j<C&&(l.O+=l.v,l.N+=l.v>>1,l.W+=l.v>>1,null!=l.F&&(l.J+=l.v),l.ka=j-l.j,l.U=l.va-l.v,l.T=C-j,c=l.put(l))}o+1!=i.Ic||x||(n(i.sa,i.ta-d,m,p+16*i.R,d),n(i.qa,i.ra-h,f,u+8*i.B,h),n(i.Ha,i.Ia-h,g,v+8*i.B,h))}if(!c)return Je(e,6,"Output aborted.")}return 1}(e,r)),null!=r.bc&&r.bc(r),i&=1}return i?(e.cb=0,i):0})(e,l)||(r=e.a)}}else r=e.a}0==r&&null!=u.Oa&&u.Oa.fd&&(r=Mr(u.ba))}u=r}d=0!=u?null:11>d?h.f.RGBA.eb:h.f.kb.y}else d=null;return d};var Ba=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function c(e,t){for(var r="",n=0;n<4;n++)r+=String.fromCharCode(e[t++]);return r}function d(e,t){return e[t+0]|e[t+1]<<8}function u(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16)>>>0}function h(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}new l;var m=[0],p=[0],f=[],g=new l,v=e,x=function(e,t){var r={},n=0,a=!1,s=0,o=0;if(r.frames=[],!function(e,t){for(var r=0;r<4;r++)if(e[t+r]!="RIFF".charCodeAt(r))return!0;return!1}(e,t)){for(h(e,t+=4),t+=8;t<e.length;){var i=c(e,t),l=h(e,t+=4);t+=4;var m=l+(1&l);switch(i){case"VP8 ":case"VP8L":void 0===r.frames[n]&&(r.frames[n]={}),(g=r.frames[n]).src_off=a?o:t-8,g.src_size=s+l+8,n++,a&&(a=!1,s=0,o=0);break;case"VP8X":(g=r.header={}).feature_flags=e[t];var p=t+4;g.canvas_width=1+u(e,p),p+=3,g.canvas_height=1+u(e,p),p+=3;break;case"ALPH":a=!0,s=m+8,o=t-8;break;case"ANIM":(g=r.header).bgcolor=h(e,t),p=t+4,g.loop_count=d(e,p),p+=2;break;case"ANMF":var f,g;(g=r.frames[n]={}).offset_x=2*u(e,t),t+=3,g.offset_y=2*u(e,t),t+=3,g.width=1+u(e,t),t+=3,g.height=1+u(e,t),t+=3,g.duration=u(e,t),t+=3,f=e[t++],g.dispose=1&f,g.blend=f>>1&1}"ANMF"!=i&&(t+=m)}return r}}(v,0);x.response=v,x.rgbaoutput=!0,x.dataurl=!1;var b=x.header?x.header:null,y=x.frames?x.frames:null;if(b){b.loop_counter=b.loop_count,m=[b.canvas_height],p=[b.canvas_width];for(var w=0;w<y.length&&0!=y[w].blend;w++);}var j=y[0],N=g.WebPDecodeRGBA(v,j.src_off,j.src_size,p,m);j.rgba=N,j.imgwidth=p[0],j.imgheight=m[0];for(var S=0;S<p[0]*m[0]*4;S++)f[S]=N[S];return this.width=p,this.height=m,this.data=f,this}!function(e){var t,r,n,a,s,o,i,l,c,d=function(e){return e=e||{},this.isStrokeTransparent=e.isStrokeTransparent||!1,this.strokeOpacity=e.strokeOpacity||1,this.strokeStyle=e.strokeStyle||"#000000",this.fillStyle=e.fillStyle||"#000000",this.isFillTransparent=e.isFillTransparent||!1,this.fillOpacity=e.fillOpacity||1,this.font=e.font||"10px sans-serif",this.textBaseline=e.textBaseline||"alphabetic",this.textAlign=e.textAlign||"left",this.lineWidth=e.lineWidth||1,this.lineJoin=e.lineJoin||"miter",this.lineCap=e.lineCap||"butt",this.path=e.path||[],this.transform=void 0!==e.transform?e.transform.clone():new l,this.globalCompositeOperation=e.globalCompositeOperation||"normal",this.globalAlpha=e.globalAlpha||1,this.clip_path=e.clip_path||[],this.currentPoint=e.currentPoint||new o,this.miterLimit=e.miterLimit||10,this.lastPoint=e.lastPoint||new o,this.lineDashOffset=e.lineDashOffset||0,this.lineDash=e.lineDash||[],this.margin=e.margin||[0,0,0,0],this.prevPageLastElemOffset=e.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof e.ignoreClearRect||e.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new u(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,o=this.internal.Point,i=this.internal.Rectangle,l=this.internal.Matrix,c=new d}]);var u=function(e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var t=e;Object.defineProperty(this,"pdf",{get:function(){return t}});var r=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return r},set:function(e){r=Boolean(e)}});var n=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return n},set:function(e){n=Boolean(e)}});var a=0;Object.defineProperty(this,"posX",{get:function(){return a},set:function(e){isNaN(e)||(a=e)}});var s=0;Object.defineProperty(this,"posY",{get:function(){return s},set:function(e){isNaN(e)||(s=e)}}),Object.defineProperty(this,"margin",{get:function(){return c.margin},set:function(e){var t;"number"==typeof e?t=[e,e,e,e]:((t=new Array(4))[0]=e[0],t[1]=e.length>=2?e[1]:t[0],t[2]=e.length>=3?e[2]:t[0],t[3]=e.length>=4?e[3]:t[1]),c.margin=t}});var o=!1;Object.defineProperty(this,"autoPaging",{get:function(){return o},set:function(e){o=e}});var i=0;Object.defineProperty(this,"lastBreak",{get:function(){return i},set:function(e){i=e}});var l=[];Object.defineProperty(this,"pageBreaks",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(e){e instanceof d&&(c=e)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(e){c.path=e}});var u=[];Object.defineProperty(this,"ctxStack",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(e){var t;t=h(e),this.ctx.fillStyle=t.style,this.ctx.isFillTransparent=0===t.a,this.ctx.fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(e){var t=h(e);this.ctx.strokeStyle=t.style,this.ctx.isStrokeTransparent=0===t.a,this.ctx.strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(e){-1!==["butt","round","square"].indexOf(e)&&(this.ctx.lineCap=e,this.pdf.setLineCap(e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(e){isNaN(e)||(this.ctx.lineWidth=e,this.pdf.setLineWidth(e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(e){-1!==["bevel","round","miter"].indexOf(e)&&(this.ctx.lineJoin=e,this.pdf.setLineJoin(e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(e){isNaN(e)||(this.ctx.miterLimit=e,this.pdf.setMiterLimit(e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(e){this.ctx.textBaseline=e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(e){-1!==["right","end","center","left","start"].indexOf(e)&&(this.ctx.textAlign=e)}});var m=null,p=null,f=null;Object.defineProperty(this,"fontFaces",{get:function(){return f},set:function(e){m=null,p=null,f=e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(e){var t;if(this.ctx.font=e,null!==(t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(e))){var r=t[1];t[2];var n=t[3],a=t[4];t[5];var s=t[6],o=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(a)[2];a="px"===o?Math.floor(parseFloat(a)*this.pdf.internal.scaleFactor):"em"===o?Math.floor(parseFloat(a)*this.pdf.getFontSize()):Math.floor(parseFloat(a)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(a);var i=function(e){var t,r,n=[],a=e.trim();if(""===a)return mf;if(a in $p)return[$p[a]];for(;""!==a;){switch(r=null,t=(a=tf(a)).charAt(0)){case'"':case"'":r=rf(a.substring(1),t);break;default:r=nf(a)}if(null===r)return mf;if(n.push(r[0]),""!==(a=tf(r[1]))&&","!==a.charAt(0))return mf;a=a.replace(/^,/,"")}return n}(s);if(this.fontFaces){var l=function(e,t){var r=e.getFontList(),n=JSON.stringify(r);if(null===m||p!==n){var a=function(e){var t=[];return Object.keys(e).forEach(function(r){e[r].forEach(function(e){var n=null;switch(e){case"bold":n={family:r,weight:"bold"};break;case"italic":n={family:r,style:"italic"};break;case"bolditalic":n={family:r,weight:"bold",style:"italic"};break;case"":case"normal":n={family:r}}null!==n&&(n.ref={name:r,style:e},t.push(n))})}),t}(r);m=function(e){for(var t={},r=0;r<e.length;++r){var n=Xp(e[r]),a=n.family,s=n.stretch,o=n.style,i=n.weight;t[a]=t[a]||{},t[a][s]=t[a][s]||{},t[a][s][o]=t[a][s][o]||{},t[a][s][o][i]=n}return t}(a.concat(t)),p=n}return m}(this.pdf,this.fontFaces),c=i.map(function(e){return{family:e,stretch:"normal",weight:n,style:r}}),d=function(e,t,r){for(var n=(r=r||{}).defaultFontFamily||"times",a=Object.assign({},Zp,r.genericFontFamilies||{}),s=null,o=null,i=0;i<t.length;++i)if(a[(s=Xp(t[i])).family]&&(s.family=a[s.family]),e.hasOwnProperty(s.family)){o=e[s.family];break}if(!(o=o||e[n]))throw new Error("Could not find a font-family for the rule '"+ef(s)+"' and default family '"+n+"'.");if(o=function(e,t){if(t[e])return t[e];var r=Kp[e],n=r<=Kp.normal?-1:1,a=Qp(t,Gp,r,n);if(!a)throw new Error("Could not find a matching font-stretch value for "+e);return a}(s.stretch,o),o=function(e,t){if(t[e])return t[e];for(var r=Hp[e],n=0;n<r.length;++n)if(t[r[n]])return t[r[n]];throw new Error("Could not find a matching font-style for "+e)}(s.style,o),!(o=function(e,t){if(t[e])return t[e];if(400===e&&t[500])return t[500];if(500===e&&t[400])return t[400];var r=Yp[e],n=Qp(t,Jp,r,e<400?-1:1);if(!n)throw new Error("Could not find a matching font-weight for value "+e);return n}(s.weight,o)))throw new Error("Failed to resolve a font for the rule '"+ef(s)+"'.");return o}(l,c);this.pdf.setFont(d.ref.name,d.ref.style)}else{var u="";("bold"===n||parseInt(n,10)>=700||"bold"===r)&&(u="bold"),"italic"===r&&(u+="italic"),0===u.length&&(u="normal");for(var h="",f={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},g=0;g<i.length;g++){if(void 0!==this.pdf.internal.getFont(i[g],u,{noFallback:!0,disableWarning:!0})){h=i[g];break}if("bolditalic"===u&&void 0!==this.pdf.internal.getFont(i[g],"bold",{noFallback:!0,disableWarning:!0}))h=i[g],u="bold";else if(void 0!==this.pdf.internal.getFont(i[g],"normal",{noFallback:!0,disableWarning:!0})){h=i[g],u="normal";break}}if(""===h)for(var v=0;v<i.length;v++)if(f[i[v]]){h=f[i[v]];break}h=""===h?"Times":h,this.pdf.setFont(h,u)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(e){this.ctx.globalCompositeOperation=e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(e){this.ctx.globalAlpha=e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(e){this.ctx.lineDashOffset=e,R.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(e){this.ctx.lineDash=e,R.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(e){this.ctx.ignoreClearRect=Boolean(e)}})};u.prototype.setLineDash=function(e){this.lineDash=e},u.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},u.prototype.fill=function(){y.call(this,"fill",!1)},u.prototype.stroke=function(){y.call(this,"stroke",!1)},u.prototype.beginPath=function(){this.path=[{type:"begin"}]},u.prototype.moveTo=function(e,t){if(isNaN(e)||isNaN(t))throw Am.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var r=this.ctx.transform.applyToPoint(new o(e,t));this.path.push({type:"mt",x:r.x,y:r.y}),this.ctx.lastPoint=new o(e,t)},u.prototype.closePath=function(){var e=new o(0,0),t=0;for(t=this.path.length-1;-1!==t;t--)if("begin"===this.path[t].type&&"object"===(0,hl.A)(this.path[t+1])&&"number"==typeof this.path[t+1].x){e=new o(this.path[t+1].x,this.path[t+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(e.x,e.y)},u.prototype.lineTo=function(e,t){if(isNaN(e)||isNaN(t))throw Am.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var r=this.ctx.transform.applyToPoint(new o(e,t));this.path.push({type:"lt",x:r.x,y:r.y}),this.ctx.lastPoint=new o(r.x,r.y)},u.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),y.call(this,null,!0)},u.prototype.quadraticCurveTo=function(e,t,r,n){if(isNaN(r)||isNaN(n)||isNaN(e)||isNaN(t))throw Am.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var a=this.ctx.transform.applyToPoint(new o(r,n)),s=this.ctx.transform.applyToPoint(new o(e,t));this.path.push({type:"qct",x1:s.x,y1:s.y,x:a.x,y:a.y}),this.ctx.lastPoint=new o(a.x,a.y)},u.prototype.bezierCurveTo=function(e,t,r,n,a,s){if(isNaN(a)||isNaN(s)||isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw Am.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var i=this.ctx.transform.applyToPoint(new o(a,s)),l=this.ctx.transform.applyToPoint(new o(e,t)),c=this.ctx.transform.applyToPoint(new o(r,n));this.path.push({type:"bct",x1:l.x,y1:l.y,x2:c.x,y2:c.y,x:i.x,y:i.y}),this.ctx.lastPoint=new o(i.x,i.y)},u.prototype.arc=function(e,t,r,n,a,s){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(a))throw Am.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(s=Boolean(s),!this.ctx.transform.isIdentity){var i=this.ctx.transform.applyToPoint(new o(e,t));e=i.x,t=i.y;var l=this.ctx.transform.applyToPoint(new o(0,r)),c=this.ctx.transform.applyToPoint(new o(0,0));r=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2))}Math.abs(a-n)>=2*Math.PI&&(n=0,a=2*Math.PI),this.path.push({type:"arc",x:e,y:t,radius:r,startAngle:n,endAngle:a,counterclockwise:s})},u.prototype.arcTo=function(e,t,r,n,a){throw new Error("arcTo not implemented.")},u.prototype.rect=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw Am.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(e,t),this.lineTo(e+r,t),this.lineTo(e+r,t+n),this.lineTo(e,t+n),this.lineTo(e,t),this.lineTo(e+r,t),this.lineTo(e,t)},u.prototype.fillRect=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw Am.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!m.call(this)){var a={};"butt"!==this.lineCap&&(a.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(a.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(e,t,r,n),this.fill(),a.hasOwnProperty("lineCap")&&(this.lineCap=a.lineCap),a.hasOwnProperty("lineJoin")&&(this.lineJoin=a.lineJoin)}},u.prototype.strokeRect=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw Am.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");p.call(this)||(this.beginPath(),this.rect(e,t,r,n),this.stroke())},u.prototype.clearRect=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw Am.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(e,t,r,n))},u.prototype.save=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,r=0;r<this.pdf.internal.getNumberOfPages();r++)this.pdf.setPage(r+1),this.pdf.internal.out("q");if(this.pdf.setPage(t),e){this.ctx.fontSize=this.pdf.internal.getFontSize();var n=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=n}},u.prototype.restore=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,r=0;r<this.pdf.internal.getNumberOfPages();r++)this.pdf.setPage(r+1),this.pdf.internal.out("Q");this.pdf.setPage(t),e&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},u.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(e){var t,r,n,a;if(!0===e.isCanvasGradient&&(e=e.getColor()),!e)return{r:0,g:0,b:0,a:0,style:e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(e))t=0,r=0,n=0,a=0;else{var s=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e);if(null!==s)t=parseInt(s[1]),r=parseInt(s[2]),n=parseInt(s[3]),a=1;else if(null!==(s=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(e)))t=parseInt(s[1]),r=parseInt(s[2]),n=parseInt(s[3]),a=parseFloat(s[4]);else{if(a=1,"string"==typeof e&&"#"!==e.charAt(0)){var o=new Im(e);e=o.ok?o.toHex():"#000000"}4===e.length?(t=e.substring(1,2),t+=t,r=e.substring(2,3),r+=r,n=e.substring(3,4),n+=n):(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7)),t=parseInt(t,16),r=parseInt(r,16),n=parseInt(n,16)}}return{r:t,g:r,b:n,a:a,style:e}},m=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},p=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};u.prototype.fillText=function(e,t,r,n){if(isNaN(t)||isNaN(r)||"string"!=typeof e)throw Am.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(n=isNaN(n)?void 0:n,!m.call(this)){var a=D(this.ctx.transform.rotation),s=this.ctx.transform.scaleX;E.call(this,{text:e,x:t,y:r,scale:s,angle:a,align:this.textAlign,maxWidth:n})}},u.prototype.strokeText=function(e,t,r,n){if(isNaN(t)||isNaN(r)||"string"!=typeof e)throw Am.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!p.call(this)){n=isNaN(n)?void 0:n;var a=D(this.ctx.transform.rotation),s=this.ctx.transform.scaleX;E.call(this,{text:e,x:t,y:r,scale:s,renderingMode:"stroke",angle:a,align:this.textAlign,maxWidth:n})}},u.prototype.measureText=function(e){if("string"!=typeof e)throw Am.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var t=this.pdf,r=this.pdf.internal.scaleFactor,n=t.internal.getFontSize(),a=t.getStringUnitWidth(e)*n/t.internal.scaleFactor;return new function(e){var t=(e=e||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return t}}),this}({width:a*=Math.round(96*r/72*1e4)/1e4})},u.prototype.scale=function(e,t){if(isNaN(e)||isNaN(t))throw Am.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var r=new l(e,0,0,t,0,0);this.ctx.transform=this.ctx.transform.multiply(r)},u.prototype.rotate=function(e){if(isNaN(e))throw Am.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var t=new l(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0);this.ctx.transform=this.ctx.transform.multiply(t)},u.prototype.translate=function(e,t){if(isNaN(e)||isNaN(t))throw Am.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var r=new l(1,0,0,1,e,t);this.ctx.transform=this.ctx.transform.multiply(r)},u.prototype.transform=function(e,t,r,n,a,s){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(a)||isNaN(s))throw Am.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var o=new l(e,t,r,n,a,s);this.ctx.transform=this.ctx.transform.multiply(o)},u.prototype.setTransform=function(e,t,r,n,a,s){e=isNaN(e)?1:e,t=isNaN(t)?0:t,r=isNaN(r)?0:r,n=isNaN(n)?1:n,a=isNaN(a)?0:a,s=isNaN(s)?0:s,this.ctx.transform=new l(e,t,r,n,a,s)};var f=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};u.prototype.drawImage=function(e,t,r,n,a,s,o,c,d){var u=this.pdf.getImageProperties(e),h=1,m=1,p=1,v=1;void 0!==n&&void 0!==c&&(p=c/n,v=d/a,h=u.width/n*c/n,m=u.height/a*d/a),void 0===s&&(s=t,o=r,t=0,r=0),void 0!==n&&void 0===c&&(c=n,d=a),void 0===n&&void 0===c&&(c=u.width,d=u.height);var y=this.ctx.transform.decompose(),j=D(y.rotate.shx),N=new l,S=(N=(N=(N=N.multiply(y.translate)).multiply(y.skew)).multiply(y.scale)).applyToRectangle(new i(s-t*p,o-r*v,n*h,a*m));if(this.autoPaging){for(var k,A=g.call(this,S),C=[],E=0;E<A.length;E+=1)-1===C.indexOf(A[E])&&C.push(A[E]);b(C);for(var P=C[0],_=C[C.length-1],I=P;I<_+1;I++){this.pdf.setPage(I);var T=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],L=1===I?this.posY+this.margin[0]:this.margin[0],M=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],O=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],R=1===I?0:M+(I-2)*O;if(0!==this.ctx.clip_path.length){var F=this.path;k=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=x(k,this.posX+this.margin[3],-R+L+this.ctx.prevPageLastElemOffset),w.call(this,"fill",!0),this.path=F}var U=JSON.parse(JSON.stringify(S));U=x([U],this.posX+this.margin[3],-R+L+this.ctx.prevPageLastElemOffset)[0];var B=(I>P||I<_)&&f.call(this);B&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],T,O,null).clip().discardPath()),this.pdf.addImage(e,"JPEG",U.x,U.y,U.w,U.h,null,null,j),B&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(e,"JPEG",S.x,S.y,S.w,S.h,null,null,j)};var g=function(e,t,r){var n=[];t=t||this.pdf.internal.pageSize.width,r=r||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var a=this.posY+this.ctx.prevPageLastElemOffset;switch(e.type){default:case"mt":case"lt":n.push(Math.floor((e.y+a)/r)+1);break;case"arc":n.push(Math.floor((e.y+a-e.radius)/r)+1),n.push(Math.floor((e.y+a+e.radius)/r)+1);break;case"qct":var s=M(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x,e.y);n.push(Math.floor((s.y+a)/r)+1),n.push(Math.floor((s.y+s.h+a)/r)+1);break;case"bct":var o=O(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x2,e.y2,e.x,e.y);n.push(Math.floor((o.y+a)/r)+1),n.push(Math.floor((o.y+o.h+a)/r)+1);break;case"rect":n.push(Math.floor((e.y+a)/r)+1),n.push(Math.floor((e.y+e.h+a)/r)+1)}for(var i=0;i<n.length;i+=1)for(;this.pdf.internal.getNumberOfPages()<n[i];)v.call(this);return n},v=function(){var e=this.fillStyle,t=this.strokeStyle,r=this.font,n=this.lineCap,a=this.lineWidth,s=this.lineJoin;this.pdf.addPage(),this.fillStyle=e,this.strokeStyle=t,this.font=r,this.lineCap=n,this.lineWidth=a,this.lineJoin=s},x=function(e,t,r){for(var n=0;n<e.length;n++)switch(e[n].type){case"bct":e[n].x2+=t,e[n].y2+=r;case"qct":e[n].x1+=t,e[n].y1+=r;default:e[n].x+=t,e[n].y+=r}return e},b=function(e){return e.sort(function(e,t){return e-t})},y=function(e,t){var r=this.fillStyle,n=this.strokeStyle,a=this.lineCap,s=this.lineWidth,o=Math.abs(s*this.ctx.transform.scaleX),i=this.lineJoin;if(this.autoPaging){for(var l,c,d=JSON.parse(JSON.stringify(this.path)),u=JSON.parse(JSON.stringify(this.path)),h=[],m=0;m<u.length;m++)if(void 0!==u[m].x)for(var p=g.call(this,u[m]),y=0;y<p.length;y+=1)-1===h.indexOf(p[y])&&h.push(p[y]);for(var j=0;j<h.length;j++)for(;this.pdf.internal.getNumberOfPages()<h[j];)v.call(this);b(h);for(var N=h[0],S=h[h.length-1],k=N;k<S+1;k++){this.pdf.setPage(k),this.fillStyle=r,this.strokeStyle=n,this.lineCap=a,this.lineWidth=o,this.lineJoin=i;var A=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],C=1===k?this.posY+this.margin[0]:this.margin[0],E=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],P=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],_=1===k?0:E+(k-2)*P;if(0!==this.ctx.clip_path.length){var I=this.path;l=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=x(l,this.posX+this.margin[3],-_+C+this.ctx.prevPageLastElemOffset),w.call(this,e,!0),this.path=I}if(c=JSON.parse(JSON.stringify(d)),this.path=x(c,this.posX+this.margin[3],-_+C+this.ctx.prevPageLastElemOffset),!1===t||0===k){var T=(k>N||k<S)&&f.call(this);T&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],A,P,null).clip().discardPath()),w.call(this,e,t),T&&this.pdf.restoreGraphicsState()}this.lineWidth=s}this.path=d}else this.lineWidth=o,w.call(this,e,t),this.lineWidth=s},w=function(e,t){if(("stroke"!==e||t||!p.call(this))&&("stroke"===e||t||!m.call(this))){for(var r,n,a=[],s=this.path,o=0;o<s.length;o++){var i=s[o];switch(i.type){case"begin":a.push({begin:!0});break;case"close":a.push({close:!0});break;case"mt":a.push({start:i,deltas:[],abs:[]});break;case"lt":var l=a.length;if(s[o-1]&&!isNaN(s[o-1].x)&&(r=[i.x-s[o-1].x,i.y-s[o-1].y],l>0))for(;l>=0;l--)if(!0!==a[l-1].close&&!0!==a[l-1].begin){a[l-1].deltas.push(r),a[l-1].abs.push(i);break}break;case"bct":r=[i.x1-s[o-1].x,i.y1-s[o-1].y,i.x2-s[o-1].x,i.y2-s[o-1].y,i.x-s[o-1].x,i.y-s[o-1].y],a[a.length-1].deltas.push(r);break;case"qct":var c=s[o-1].x+2/3*(i.x1-s[o-1].x),d=s[o-1].y+2/3*(i.y1-s[o-1].y),u=i.x+2/3*(i.x1-i.x),h=i.y+2/3*(i.y1-i.y),f=i.x,g=i.y;r=[c-s[o-1].x,d-s[o-1].y,u-s[o-1].x,h-s[o-1].y,f-s[o-1].x,g-s[o-1].y],a[a.length-1].deltas.push(r);break;case"arc":a.push({deltas:[],abs:[],arc:!0}),Array.isArray(a[a.length-1].abs)&&a[a.length-1].abs.push(i)}}n=t?null:"stroke"===e?"stroke":"fill";for(var v=!1,x=0;x<a.length;x++)if(a[x].arc)for(var b=a[x].abs,y=0;y<b.length;y++){var w=b[y];"arc"===w.type?S.call(this,w.x,w.y,w.radius,w.startAngle,w.endAngle,w.counterclockwise,void 0,t,!v):P.call(this,w.x,w.y),v=!0}else if(!0===a[x].close)this.pdf.internal.out("h"),v=!1;else if(!0!==a[x].begin){var j=a[x].start.x,N=a[x].start.y;_.call(this,a[x].deltas,j,N),v=!0}n&&k.call(this,n),t&&A.call(this)}},j=function(e){var t=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,r=t*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return e-r;case"top":return e+t-r;case"hanging":return e+t-2*r;case"middle":return e+t/2-r;default:return e}},N=function(e){return e+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};u.prototype.createLinearGradient=function(){var e=function(){};return e.colorStops=[],e.addColorStop=function(e,t){this.colorStops.push([e,t])},e.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},e.isCanvasGradient=!0,e},u.prototype.createPattern=function(){return this.createLinearGradient()},u.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(e,t,r,n,a,s,o,i,l){for(var c=T.call(this,r,n,a,s),d=0;d<c.length;d++){var u=c[d];0===d&&(l?C.call(this,u.x1+e,u.y1+t):P.call(this,u.x1+e,u.y1+t)),I.call(this,e,t,u.x2,u.y2,u.x3,u.y3,u.x4,u.y4)}i?A.call(this):k.call(this,o)},k=function(e){switch(e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},A=function(){this.pdf.clip(),this.pdf.discardPath()},C=function(e,t){this.pdf.internal.out(r(e)+" "+n(t)+" m")},E=function(e){var t;switch(e.align){case"right":case"end":t="right";break;case"center":t="center";break;default:t="left"}var r,n,a,s=this.pdf.getTextDimensions(e.text),c=j.call(this,e.y),d=N.call(this,c)-s.h,u=this.ctx.transform.applyToPoint(new o(e.x,c));if(this.autoPaging){var h=this.ctx.transform.decompose(),m=new l;m=(m=(m=m.multiply(h.translate)).multiply(h.skew)).multiply(h.scale);for(var p=this.ctx.transform.applyToRectangle(new i(e.x,c,s.w,s.h)),v=m.applyToRectangle(new i(e.x,d,s.w,s.h)),y=g.call(this,v),S=[],k=0;k<y.length;k+=1)-1===S.indexOf(y[k])&&S.push(y[k]);b(S);for(var A=S[0],C=S[S.length-1],E=A;E<C+1;E++){this.pdf.setPage(E);var P=1===E?this.posY+this.margin[0]:this.margin[0],_=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],I=this.pdf.internal.pageSize.height-this.margin[2],T=I-this.margin[0],L=this.pdf.internal.pageSize.width-this.margin[1],D=L-this.margin[3],M=1===E?0:_+(E-2)*T;if(0!==this.ctx.clip_path.length){var O=this.path;r=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=x(r,this.posX+this.margin[3],-1*M+P),w.call(this,"fill",!0),this.path=O}var R=x([JSON.parse(JSON.stringify(v))],this.posX+this.margin[3],-M+P+this.ctx.prevPageLastElemOffset)[0];e.scale>=.01&&(n=this.pdf.internal.getFontSize(),this.pdf.setFontSize(n*e.scale),a=this.lineWidth,this.lineWidth=a*e.scale);var F="text"!==this.autoPaging;if(F||R.y+R.h<=I){if(F||R.y>=P&&R.x<=L){var U=F?e.text:this.pdf.splitTextToSize(e.text,e.maxWidth||L-R.x)[0],B=x([JSON.parse(JSON.stringify(p))],this.posX+this.margin[3],-M+P+this.ctx.prevPageLastElemOffset)[0],z=F&&(E>A||E<C)&&f.call(this);z&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],D,T,null).clip().discardPath()),this.pdf.text(U,B.x,B.y,{angle:e.angle,align:t,renderingMode:e.renderingMode}),z&&this.pdf.restoreGraphicsState()}}else R.y<I&&(this.ctx.prevPageLastElemOffset+=I-R.y);e.scale>=.01&&(this.pdf.setFontSize(n),this.lineWidth=a)}}else e.scale>=.01&&(n=this.pdf.internal.getFontSize(),this.pdf.setFontSize(n*e.scale),a=this.lineWidth,this.lineWidth=a*e.scale),this.pdf.text(e.text,u.x+this.posX,u.y+this.posY,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(n),this.lineWidth=a)},P=function(e,t,a,s){a=a||0,s=s||0,this.pdf.internal.out(r(e+a)+" "+n(t+s)+" l")},_=function(e,t,r){return this.pdf.lines(e,t,r,null,null)},I=function(e,r,n,o,i,l,c,d){this.pdf.internal.out([t(a(n+e)),t(s(o+r)),t(a(i+e)),t(s(l+r)),t(a(c+e)),t(s(d+r)),"c"].join(" "))},T=function(e,t,r,n){for(var a=2*Math.PI,s=Math.PI/2;t>r;)t-=a;var o=Math.abs(r-t);o<a&&n&&(o=a-o);for(var i=[],l=n?-1:1,c=t;o>1e-5;){var d=c+l*Math.min(o,s);i.push(L.call(this,e,c,d)),o-=Math.abs(d-c),c=d}return i},L=function(e,t,r){var n=(r-t)/2,a=e*Math.cos(n),s=e*Math.sin(n),o=a,i=-s,l=o*o+i*i,c=l+o*a+i*s,d=4/3*(Math.sqrt(2*l*c)-c)/(o*s-i*a),u=o-d*i,h=i+d*o,m=u,p=-h,f=n+t,g=Math.cos(f),v=Math.sin(f);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:u*g-h*v,y2:u*v+h*g,x3:m*g-p*v,y3:m*v+p*g,x4:e*Math.cos(r),y4:e*Math.sin(r)}},D=function(e){return 180*e/Math.PI},M=function(e,t,r,n,a,s){var o=e+.5*(r-e),l=t+.5*(n-t),c=a+.5*(r-a),d=s+.5*(n-s),u=Math.min(e,a,o,c),h=Math.max(e,a,o,c),m=Math.min(t,s,l,d),p=Math.max(t,s,l,d);return new i(u,m,h-u,p-m)},O=function(e,t,r,n,a,s,o,l){var c,d,u,h,m,p,f,g,v,x,b,y,w,j,N=r-e,S=n-t,k=a-r,A=s-n,C=o-a,E=l-s;for(d=0;d<41;d++)v=(f=(u=e+(c=d/40)*N)+c*((m=r+c*k)-u))+c*(m+c*(a+c*C-m)-f),x=(g=(h=t+c*S)+c*((p=n+c*A)-h))+c*(p+c*(s+c*E-p)-g),0==d?(b=v,y=x,w=v,j=x):(b=Math.min(b,v),y=Math.min(y,x),w=Math.max(w,v),j=Math.max(j,x));return new i(Math.round(b),Math.round(y),Math.round(w-b),Math.round(j-y))},R=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var e,t,r=(e=this.ctx.lineDash,t=this.ctx.lineDashOffset,JSON.stringify({lineDash:e,lineDashOffset:t}));this.prevLineDash!==r&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=r)}}}(np.API),function(e){var t=function(e){var t,r,n,a,s,o,i,l,c,d;for(/[^\x00-\xFF]/.test(e),r=[],n=0,a=(e+=t="\0\0\0\0".slice(e.length%4||4)).length;a>n;n+=4)0!==(s=(e.charCodeAt(n)<<24)+(e.charCodeAt(n+1)<<16)+(e.charCodeAt(n+2)<<8)+e.charCodeAt(n+3))?(o=(s=((s=((s=((s=(s-(d=s%85))/85)-(c=s%85))/85)-(l=s%85))/85)-(i=s%85))/85)%85,r.push(o+33,i+33,l+33,c+33,d+33)):r.push(122);return function(e,t){for(var r=t;r>0;r--)e.pop()}(r,t.length),String.fromCharCode.apply(String,r)+"~>"},r=function(e){var t,r,n,a,s,o=String,i="length",l=255,c="charCodeAt",d="slice",u="replace";for(e[d](-2),e=e[d](0,-2)[u](/\s/g,"")[u]("z","!!!!!"),n=[],a=0,s=(e+=t="uuuuu"[d](e[i]%5||5))[i];s>a;a+=5)r=52200625*(e[c](a)-33)+614125*(e[c](a+1)-33)+7225*(e[c](a+2)-33)+85*(e[c](a+3)-33)+(e[c](a+4)-33),n.push(l&r>>24,l&r>>16,l&r>>8,l&r);return function(e,t){for(var r=t;r>0;r--)e.pop()}(n,t[i]),o.fromCharCode.apply(o,n)},n=function(e){return e.split("").map(function(e){return("0"+e.charCodeAt().toString(16)).slice(-2)}).join("")+">"},a=function(e){var t=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(e=e.replace(/\s/g,"")).indexOf(">")&&(e=e.substr(0,e.indexOf(">"))),e.length%2&&(e+="0"),!1===t.test(e))return"";for(var r="",n=0;n<e.length;n+=2)r+=String.fromCharCode("0x"+(e[n]+e[n+1]));return r},s=function(e){for(var t=new Uint8Array(e.length),r=e.length;r--;)t[r]=e.charCodeAt(r);return(t=Xl(t)).reduce(function(e,t){return e+String.fromCharCode(t)},"")};e.processDataByFilters=function(e,o){var i=0,l=e||"",c=[];for("string"==typeof(o=o||[])&&(o=[o]),i=0;i<o.length;i+=1)switch(o[i]){case"ASCII85Decode":case"/ASCII85Decode":l=r(l),c.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":l=t(l),c.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":l=a(l),c.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":l=n(l),c.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":l=s(l),c.push("/FlateDecode");break;default:throw new Error('The filter: "'+o[i]+'" is not implemented')}return{data:l,reverseChain:c.reverse().join(" ")}}}(np.API),function(e){e.loadFile=function(e,t,r){return function(e,t,r){t=!1!==t,r="function"==typeof r?r:function(){};var n=void 0;try{n=function(e,t,r){var n=new XMLHttpRequest,a=0,s=function(e){var t=e.length,r=[],n=String.fromCharCode;for(a=0;a<t;a+=1)r.push(n(255&e.charCodeAt(a)));return r.join("")};if(n.open("GET",e,!t),n.overrideMimeType("text/plain; charset=x-user-defined"),!1===t&&(n.onload=function(){200===n.status?r(s(this.responseText)):r(void 0)}),n.send(null),t&&200===n.status)return s(n.responseText)}(e,t,r)}catch(Ft){}return n}(e,t,r)},e.loadImageFile=e.loadFile}(np.API),function(e){function t(){return(Sm.html2canvas?Promise.resolve(Sm.html2canvas):r.e(239).then(r.t.bind(r,5239,23))).catch(function(e){return Promise.reject(new Error("Could not load html2canvas: "+e))}).then(function(e){return e.default?e.default:e})}function n(){return(Sm.DOMPurify?Promise.resolve(Sm.DOMPurify):r.e(977).then(r.bind(r,7977))).catch(function(e){return Promise.reject(new Error("Could not load dompurify: "+e))}).then(function(e){return e.default?e.default:e})}var a=function(e){var t=(0,hl.A)(e);return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},s=function(e,t){var r=document.createElement(e);for(var n in t.className&&(r.className=t.className),t.innerHTML&&t.dompurify&&(r.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)r.style[n]=t.style[n];return r},o=function e(t,r){for(var n=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),a=t.firstChild;a;a=a.nextSibling)!0!==r&&1===a.nodeType&&"SCRIPT"===a.nodeName||n.appendChild(e(a,r));return 1===t.nodeType&&("CANVAS"===t.nodeName?(n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(n.value=t.value),n.addEventListener("load",function(){n.scrollTop=t.scrollTop,n.scrollLeft=t.scrollLeft},!0)),n},i=function e(t){var r=Object.assign(e.convert(Promise.resolve()),JSON.parse(JSON.stringify(e.template))),n=e.convert(Promise.resolve(),r);return(n=n.setProgress(1,e,1,[e])).set(t)};(i.prototype=Object.create(Promise.prototype)).constructor=i,i.convert=function(e,t){return e.__proto__=t||i.prototype,e},i.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},i.prototype.from=function(e,t){return this.then(function(){switch(t=t||function(e){switch(a(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(e),t){case"string":return this.then(n).then(function(t){return this.set({src:s("div",{innerHTML:e,dompurify:t})})});case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}})},i.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},i.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var e={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=o(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===t.tagName&&(e.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:e}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},i.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=Object.assign({},this.opt.html2canvas);return delete t.onrendered,e(this.prop.container,t)}).then(function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},i.prototype.toContext2d=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=this.opt.jsPDF,r=this.opt.fontFaces,n="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,a=Object.assign({async:!0,allowTaint:!0,scale:n,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete a.onrendered,t.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,t.context2d.posX=this.opt.x,t.context2d.posY=this.opt.y,t.context2d.margin=this.opt.margin,t.context2d.fontFaces=r,r)for(var s=0;s<r.length;++s){var o=r[s],i=o.src.find(function(e){return"truetype"===e.format});i&&t.addFont(i.url,o.ref.name,o.ref.style)}return a.windowHeight=a.windowHeight||0,a.windowHeight=0==a.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):a.windowHeight,t.context2d.save(!0),e(this.prop.container,a)}).then(function(e){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},i.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e})},i.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},i.prototype.output=function(e,t,r){return"img"===(r=r||"pdf").toLowerCase()||"image"===r.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},i.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(e,t)})},i.prototype.outputImg=function(e){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}})},i.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},i.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},i.prototype.set=function(e){if("object"!==a(e))return this;var t=Object.keys(e||{}).map(function(t){if(t in i.template.prop)return function(){this.prop[t]=e[t]};switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return function(){this.opt[t]=e[t]}}},this);return this.then(function(){return this.thenList(t)})},i.prototype.get=function(e,t){return this.then(function(){var r=e in i.template.prop?this.prop[e]:this.opt[e];return t?t(r):r})},i.prototype.setMargin=function(e){return this.then(function(){switch(a(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e}).then(this.setPageSize)},i.prototype.setPageSize=function(e){function t(e,t){return Math.floor(e*t/72*96)}return this.then(function(){(e=e||np.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:t(e.inner.width,e.k),height:t(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e})},i.prototype.setProgress=function(e,t,r,n){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=r&&(this.progress.n=r),null!=n&&(this.progress.stack=n),this.progress.ratio=this.progress.val/this.progress.state,this},i.prototype.updateProgress=function(e,t,r,n){return this.setProgress(e?this.progress.val+e:null,t||null,r?this.progress.n+r:null,n?this.progress.stack.concat(n):null)},i.prototype.then=function(e,t){var r=this;return this.thenCore(e,t,function(e,t){return r.updateProgress(null,null,1,[e]),Promise.prototype.then.call(this,function(t){return r.updateProgress(null,e),t}).then(e,t).then(function(e){return r.updateProgress(1),e})})},i.prototype.thenCore=function(e,t,r){r=r||Promise.prototype.then;var n=this;e&&(e=e.bind(n)),t&&(t=t.bind(n));var a=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?n:i.convert(Object.assign({},n),Promise.prototype),s=r.call(a,e,t);return i.convert(s,n.__proto__)},i.prototype.thenExternal=function(e,t){return Promise.prototype.then.call(this,e,t)},i.prototype.thenList=function(e){var t=this;return e.forEach(function(e){t=t.thenCore(e)}),t},i.prototype.catch=function(e){e&&(e=e.bind(this));var t=Promise.prototype.catch.call(this,e);return i.convert(t,this)},i.prototype.catchExternal=function(e){return Promise.prototype.catch.call(this,e)},i.prototype.error=function(e){return this.then(function(){throw new Error(e)})},i.prototype.using=i.prototype.set,i.prototype.saveAs=i.prototype.save,i.prototype.export=i.prototype.output,i.prototype.run=i.prototype.then,np.getPageSize=function(e,t,r){if("object"===(0,hl.A)(e)){var n=e;e=n.orientation,t=n.unit||t,r=n.format||r}t=t||"mm",r=r||"a4",e=(""+(e||"P")).toLowerCase();var a,s=(""+r).toLowerCase(),o={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":a=1;break;case"mm":a=72/25.4;break;case"cm":a=72/2.54;break;case"in":a=72;break;case"px":a=.75;break;case"pc":case"em":a=12;break;case"ex":a=6;break;default:throw"Invalid unit: "+t}var i,l=0,c=0;if(o.hasOwnProperty(s))l=o[s][1]/a,c=o[s][0]/a;else try{l=r[1],c=r[0]}catch(qt){throw new Error("Invalid format: "+r)}if("p"===e||"portrait"===e)e="p",c>l&&(i=c,c=l,l=i);else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",l>c&&(i=c,c=l,l=i)}return{width:c,height:l,unit:t,k:a,orientation:e}},e.html=function(e,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(Xp):null;var r=new i(t);return t.worker?r:r.from(e).doCallback()}}(np.API),np.API.addJS=function(e){return of=e,this.internal.events.subscribe("postPutResources",function(){af=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(af+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),sf=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+of+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==af&&void 0!==sf&&this.internal.out("/Names <</JavaScript "+af+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var e=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=e.outline.render().split(/\r\n/),a=0;a<n.length;a++){var s=n[a],o=r.exec(s);if(null!=o){var i=o[1];e.internal.newObjectDeferredBegin(i,!1)}e.internal.write(s)}if(this.outline.createNamedDestinations){var l=this.internal.pages.length,c=[];for(a=0;a<l;a++){var d=e.internal.newObject();c.push(d);var u=e.internal.getPageInfo(a+1);e.internal.write("<< /D["+u.objId+" 0 R /XYZ null null null]>> endobj")}var h=e.internal.newObject();for(e.internal.write("<< /Names [ "),a=0;a<c.length;a++)e.internal.write("(page_"+(a+1)+")"+c[a]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+h+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,r){var n={title:t,options:r,children:[]};return null==e&&(e=this.root),e.children.push(n),n},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var r=0;r<t.children.length;r++)this.genIds_r(t.children[r])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,n=0;n<t.children.length;n++){var a=t.children[n];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(t)),n>0&&this.line("/Prev "+this.makeRef(t.children[n-1])),n<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[n+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var s=this.count=this.count_r({count:0},a);if(s>0&&this.line("/Count "+s),a.options&&a.options.pageNumber){var o=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var i=0;i<t.children.length;i++)this.renderItems(t.children[i])},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var r=0;r<t.children.length;r++)e.count++,this.count_r(e,t.children[r]);return e.count}}])}(np.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(e,r,n,a,s,o){var i,l=this.decode.DCT_DECODE,c=null;if("string"==typeof e||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=s||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,i=function(e){for(var r,n=256*e.charCodeAt(4)+e.charCodeAt(5),a=e.length,s={width:0,height:0,numcomponents:1},o=4;o<a;o+=2){if(o+=n,-1!==t.indexOf(e.charCodeAt(o+1))){r=256*e.charCodeAt(o+5)+e.charCodeAt(o+6),s={width:256*e.charCodeAt(o+7)+e.charCodeAt(o+8),height:r,numcomponents:e.charCodeAt(o+9)};break}n=256*e.charCodeAt(o+2)+e.charCodeAt(o+3)}return s}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),i.numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}c={data:e,width:i.width,height:i.height,colorSpace:o,bitsPerComponent:8,filter:l,index:r,alias:n}}return c}}(np.API),np.API.processPNG=function(e,t,r,n){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var a,s=function(e,t){return new jm(e,t).decode()}(e,{checkCrc:!0}),o=s.width,i=s.height,l=s.channels,c=s.palette,d=s.depth;a=c&&1===l?function(e){for(var t=e.width,r=e.height,n=e.data,a=e.palette,s=e.depth,o=!1,i=[],l=[],c=void 0,d=!1,u=0,h=0;h<a.length;h++){var m=$l(a[h],4),p=m[0],f=m[1],g=m[2],v=m[3];i.push(p,f,g),null!=v&&(0===v?(u++,l.length<1&&l.push(h)):v<255&&(d=!0))}if(d||u>1){o=!0,l=void 0;var x=t*r;c=new Uint8Array(x);for(var b=new DataView(n.buffer),y=0;y<x;y++){var w=$l(a[jf(b,y,s)],4)[3];c[y]=w}}else 0===u&&(l=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:o?8:void 0,colorBytes:n,alphaBytes:c,needSMask:o,palette:i,mask:l}}(s):2===l||4===l?function(e){for(var t=e.data,r=e.width,n=e.height,a=e.channels,s=e.depth,o=2===a?"DeviceGray":"DeviceRGB",i=a-1,l=r*n,c=i,d=l*c,u=1*l,h=Math.ceil(d*s/8),m=Math.ceil(u*s/8),p=new Uint8Array(h),f=new Uint8Array(m),g=new DataView(t.buffer),v=new DataView(p.buffer),x=new DataView(f.buffer),b=!1,y=0;y<l;y++){for(var w=y*a,j=0;j<c;j++)Nf(v,jf(g,w+j,s),y*c+j,s);var N=jf(g,w+c,s);N<(1<<s)-1&&(b=!0),Nf(x,N,1*y,s)}return{colorSpace:o,colorsPerPixel:i,sMaskBitsPerComponent:b?s:void 0,colorBytes:p,alphaBytes:f,needSMask:b}}(s):function(e){var t=e.data,r=1===e.channels?"DeviceGray":"DeviceRGB";return{colorSpace:r,colorsPerPixel:"DeviceGray"===r?1:3,colorBytes:t instanceof Uint16Array?function(e){for(var t=e.length,r=new Uint8Array(2*t),n=new DataView(r.buffer,r.byteOffset,r.byteLength),a=0;a<t;a++)n.setUint16(2*a,e[a],!1);return r}(t):t,needSMask:!1}}(s);var u,h,m,p=a,f=p.colorSpace,g=p.colorsPerPixel,v=p.sMaskBitsPerComponent,x=p.colorBytes,b=p.alphaBytes,y=p.needSMask,w=p.palette,j=p.mask,N=null;return n!==np.API.image_compression.NONE?(N=function(e){var t;switch(e){case np.API.image_compression.FAST:t=11;break;case np.API.image_compression.MEDIUM:t=13;break;case np.API.image_compression.SLOW:t=14;break;default:t=12}return t}(n),u=this.decode.FLATE_DECODE,h="/Predictor ".concat(N," /Colors ").concat(g," /BitsPerComponent ").concat(d," /Columns ").concat(o),e=pf(x,Math.ceil(o*g*d/8),g,d,n),y&&(m=pf(b,Math.ceil(o*v/8),1,v,n))):(u=void 0,h=void 0,e=x,y&&(m=b)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(m&&this.__addimage__.isArrayBuffer(m)||this.__addimage__.isArrayBufferView(m))&&(m=this.__addimage__.arrayBufferToBinaryString(m)),{alias:r,data:e,index:t,filter:u,decodeParameters:h,transparency:j,palette:w,sMask:m,predictor:N,width:o,height:i,bitsPerComponent:d,sMaskBitsPerComponent:v,colorSpace:f}}},function(e){e.processGIF89A=function(t,r,n,a){var s=new kf(t),o=s.width,i=s.height,l=[];s.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:o,height:i},d=new Cf(100).encode(c,100);return e.processJPEG.call(this,d,r,n,a)},e.processGIF87A=e.processGIF89A}(np.API),Ef.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:a,green:n,blue:r,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Ef.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(Dt){Am.log("bit decode error:"+Dt)}},Ef.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,a=0;a<t;a++)for(var s=this.datav.getUint8(this.pos++,!0),o=n*this.width*4+8*a*4,i=0;i<8&&8*a+i<this.width;i++){var l=this.palette[s>>7-i&1];this.data[o+4*i]=l.blue,this.data[o+4*i+1]=l.green,this.data[o+4*i+2]=l.red,this.data[o+4*i+3]=255}0!==r&&(this.pos+=4-r)}},Ef.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<e;a++){var s=this.datav.getUint8(this.pos++,!0),o=n*this.width*4+2*a*4,i=s>>4,l=15&s,c=this.palette[i];if(this.data[o]=c.blue,this.data[o+1]=c.green,this.data[o+2]=c.red,this.data[o+3]=255,2*a+1>=this.width)break;c=this.palette[l],this.data[o+4]=c.blue,this.data[o+4+1]=c.green,this.data[o+4+2]=c.red,this.data[o+4+3]=255}0!==t&&(this.pos+=4-t)}},Ef.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var a=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+4*n;if(a<this.palette.length){var o=this.palette[a];this.data[s]=o.red,this.data[s+1]=o.green,this.data[s+2]=o.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}0!==e&&(this.pos+=4-e)}},Ef.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(s&t)/t*255|0,i=(s>>5&t)/t*255|0,l=(s>>10&t)/t*255|0,c=s>>15?255:0,d=n*this.width*4+4*a;this.data[d]=l,this.data[d+1]=i,this.data[d+2]=o,this.data[d+3]=c}this.pos+=e}},Ef.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var a=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var i=(o&t)/t*255|0,l=(o>>5&r)/r*255|0,c=(o>>11)/t*255|0,d=a*this.width*4+4*s;this.data[d]=c,this.data[d+1]=l,this.data[d+2]=i,this.data[d+3]=255}this.pos+=e}},Ef.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*r;this.data[o]=s,this.data[o+1]=a,this.data[o+2]=n,this.data[o+3]=255}this.pos+=this.width%4}},Ef.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),i=t*this.width*4+4*r;this.data[i]=s,this.data[i+1]=a,this.data[i+2]=n,this.data[i+3]=o}},Ef.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,a){var s=new Ef(t,!1),o=s.width,i=s.height,l={data:s.getData(),width:o,height:i},c=new Cf(100).encode(l,100);return e.processJPEG.call(this,c,r,n,a)}}(np.API),Pf.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,a){var s=new Pf(t),o=s.width,i=s.height,l={data:s.getData(),width:o,height:i},c=new Cf(100).encode(l,100);return e.processJPEG.call(this,c,r,n,a)}}(np.API),np.API.processRGBA=function(e,t,r){for(var n=e.data,a=n.length,s=new Uint8Array(a/4*3),o=new Uint8Array(a/4),i=0,l=0,c=0;c<a;c+=4){var d=n[c],u=n[c+1],h=n[c+2],m=n[c+3];s[i++]=d,s[i++]=u,s[i++]=h,o[l++]=m}var p=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:p,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},np.API.setLanguage=function(e){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]&&(this.internal.languageSettings.languageCode=e,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},lf=np.API,cf=lf.getCharWidthsArray=function(e,t){var r,n,a=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),o=t.charSpace||this.internal.getCharSpace(),i=t.widths?t.widths:a.metadata.Unicode.widths,l=i.fof?i.fof:1,c=t.kerning?t.kerning:a.metadata.Unicode.kerning,d=c.fof?c.fof:1,u=!1!==t.doKerning,h=0,m=e.length,p=0,f=i[0]||l,g=[];for(r=0;r<m;r++)n=e.charCodeAt(r),"function"==typeof a.metadata.widthOfString?g.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(n))+o*(1e3/s)||0)/1e3):(h=u&&"object"===(0,hl.A)(c[n])&&!isNaN(parseInt(c[n][p],10))?c[n][p]/d:0,g.push((i[n]||f)/l+h)),p=n;return g},df=lf.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),a=t.charSpace||this.internal.getCharSpace();return lf.processArabic&&(e=lf.processArabic(e)),"function"==typeof n.metadata.widthOfString?n.metadata.widthOfString(e,r,a)/r:cf.apply(this,arguments).reduce(function(e,t){return e+t},0)},uf=function(e,t,r,n){for(var a=[],s=0,o=e.length,i=0;s!==o&&i+t[s]<r;)i+=t[s],s++;a.push(e.slice(0,s));var l=s;for(i=0;s!==o;)i+t[s]>n&&(a.push(e.slice(l,s)),i=0,l=s),i+=t[s],s++;return l!==s&&a.push(e.slice(l,s)),a},hf=function(e,t,r){r||(r={});var n,a,s,o,i,l,c,d=[],u=[d],h=r.textIndent||0,m=0,p=0,f=e.split(" "),g=cf.apply(this,[" ",r])[0];if(l=-1===r.lineIndent?f[0].length+2:r.lineIndent||0){var v=Array(l).join(" "),x=[];f.map(function(e){(e=e.split(/\s*\n/)).length>1?x=x.concat(e.map(function(e,t){return(t&&e.length?"\n":"")+e})):x.push(e[0])}),f=x,l=df.apply(this,[v,r])}for(s=0,o=f.length;s<o;s++){var b=0;if(n=f[s],l&&"\n"==n[0]&&(n=n.substr(1),b=1),h+m+(p=(a=cf.apply(this,[n,r])).reduce(function(e,t){return e+t},0))>t||b){if(p>t){for(i=uf.apply(this,[n,a,t-(h+m),t]),d.push(i.shift()),d=[i.pop()];i.length;)u.push([i.shift()]);p=a.slice(n.length-(d[0]?d[0].length:0)).reduce(function(e,t){return e+t},0)}else d=[n];u.push(d),h=p+l,m=g}else d.push(n),h+=m+p,m=g}return c=l?function(e,t){return(t?v:"")+e.join(" ")}:function(e){return e.join(" ")},u.map(c)},lf.splitTextToSize=function(e,t,r){var n,a=(r=r||{}).fontSize||this.internal.getFontSize(),s=function(e){if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var t=this.internal.getFont(e.fontName,e.fontStyle),r="Unicode";return t.metadata[r]?{widths:t.metadata[r].widths||{0:1},kerning:t.metadata[r].kerning||{}}:{font:t.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var o=1*this.internal.scaleFactor*t/a;s.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/a:0,s.lineIndent=r.lineIndent;var i,l,c=[];for(i=0,l=n.length;i<l;i++)c=c.concat(hf.apply(this,[n[i],o,s]));return c},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",r="klmnopqrstuvwxyz",n={},a={},s=0;s<16;s++)n[r[s]]=t[s],a[t[s]]=r[s];var o=function(e){return"0x"+parseInt(e,10).toString(16)},i=e.__fontmetrics__.compress=function(e){var t,r,n,s,l=["{"];for(var c in e){if(t=e[c],isNaN(parseInt(c,10))?r="'"+c+"'":(c=parseInt(c,10),r=(r=o(c).slice(2)).slice(0,-1)+a[r.slice(-1)]),"number"==typeof t)t<0?(n=o(t).slice(3),s="-"):(n=o(t).slice(2),s=""),n=s+n.slice(0,-1)+a[n.slice(-1)];else{if("object"!==(0,hl.A)(t))throw new Error("Don't know what to do with value type "+(0,hl.A)(t)+".");n=i(t)}l.push(r+n)}return l.push("}"),l.join("")},l=e.__fontmetrics__.uncompress=function(e){if("string"!=typeof e)throw new Error("Invalid argument passed to uncompress.");for(var t,r,a,s,o={},i=1,l=o,c=[],d="",u="",h=e.length-1,m=1;m<h;m+=1)"'"==(s=e[m])?t?(a=t.join(""),t=void 0):t=[]:t?t.push(s):"{"==s?(c.push([l,a]),l={},a=void 0):"}"==s?((r=c.pop())[0][r[1]]=l,a=void 0,l=r[0]):"-"==s?i=-1:void 0===a?n.hasOwnProperty(s)?(d+=n[s],a=parseInt(d,16)*i,i=1,d=""):d+=s:n.hasOwnProperty(s)?(u+=n[s],l[a]=parseInt(u,16)*i,i=1,a=void 0,u=""):u+=s;return o},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},d={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},u={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t=e.font,r=u.Unicode[t.postScriptName];r&&(t.metadata.Unicode={},t.metadata.Unicode.widths=r.widths,t.metadata.Unicode.kerning=r.kerning);var n=d.Unicode[t.postScriptName];n&&(t.metadata.Unicode.encoding=n,t.encoding=n.codePages[0])}])}(np.API),function(e){var t=function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r};e.API.events.push(["addFont",function(r){var n=void 0,a=r.font,s=r.instance;if(!a.isStandardFont){if(void 0===s)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if("string"!=typeof(n=!1===s.existsFileInVFS(a.postScriptName)?s.loadFile(a.postScriptName):s.getFileFromVFS(a.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");!function(r,n){n=/^\x00\x01\x00\x00/.test(n)?t(n):t(Tm(n)),r.metadata=e.API.TTFFont.open(n),r.metadata.Unicode=r.metadata.Unicode||{encoding:{},kerning:{},widths:[]},r.metadata.glyIdsUsed=[0]}(a,n)}}])}(np),np.API.addSvgAsImage=function(e,t,n,a,s,o,i,l){if(isNaN(t)||isNaN(n))throw Am.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(a)||isNaN(s))throw Am.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=a,c.height=s;var d=c.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,c.width,c.height);var u={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},h=this;return(Sm.canvg?Promise.resolve(Sm.canvg):r.e(455).then(r.bind(r,8455))).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e}).then(function(t){return t.fromString(d,e,u)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(e){return e.render(u)}).then(function(){h.addImage(c.toDataURL("image/jpeg",1),t,n,a,s,i,l)})},np.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var a=0;a<this.internal.pages[n].length;a++)this.internal.pages[n][a]=this.internal.pages[n][a].replace(t,r);return this},np.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,a,s,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},i=Object.keys(o),l=[],c=0,d=0,u=0;function h(e,t){var r,n=!1;for(r=0;r<e.length;r+=1)e[r]===t&&(n=!0);return n}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,"reset"===e||!0===t){var m=i.length;for(u=0;u<m;u+=1)r[i[u]].value=r[i[u]].defaultValue,r[i[u]].explicitSet=!1}if("object"===(0,hl.A)(e))for(a in e)if(s=e[a],h(i,a)&&void 0!==s){if("boolean"===r[a].type&&"boolean"==typeof s)r[a].value=s;else if("name"===r[a].type&&h(r[a].valueSet,s))r[a].value=s;else if("integer"===r[a].type&&Number.isInteger(s))r[a].value=s;else if("array"===r[a].type){for(c=0;c<s.length;c+=1)if(n=!0,1===s[c].length&&"number"==typeof s[c][0])l.push(String(s[c]-1));else if(s[c].length>1){for(d=0;d<s[c].length;d+=1)"number"!=typeof s[c][d]&&(n=!1);!0===n&&l.push([s[c][0]-1,s[c][1]-1].join(" "))}r[a].value="["+l.join(" ")+"]"}else r[a].value=r[a].defaultValue;r[a].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){var e,t=[];for(e in r)!0===r[e].explicitSet&&("name"===r[e].type?t.push("/"+e+" /"+r[e].value):t.push("/"+e+" "+r[e].value));0!==t.length&&this.internal.write("/ViewerPreferences\n<<\n"+t.join("\n")+"\n>>")}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',t=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),r=unescape(encodeURIComponent(e)),n=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),a=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),s=unescape(encodeURIComponent("</x:xmpmeta>")),o=r.length+n.length+a.length+t.length+s.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+o+" >>"),this.internal.write("stream"),this.internal.write(t+r+n+a+s),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(e,n){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:e,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(np.API),function(e){var t=e.API,r=t.pdfEscape16=function(e,t){for(var r,n=t.metadata.Unicode.widths,a=["","0","00","000","0000"],s=[""],o=0,i=e.length;o<i;++o){if(r=t.metadata.characterToGlyph(e.charCodeAt(o)),t.metadata.glyIdsUsed.push(r),t.metadata.toUnicode[r]=e.charCodeAt(o),-1==n.indexOf(r)&&(n.push(r),n.push([parseInt(t.metadata.widthOfGlyph(r),10)])),"0"==r)return s.join("");r=r.toString(16),s.push(a[4-r.length],r)}return s.join("")},n=function(e){var t,r,n,a,s,o,i;for(s="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",n=[],o=0,i=(r=Object.keys(e).sort(function(e,t){return e-t})).length;o<i;o++)t=r[o],n.length>=100&&(s+="\n"+n.length+" beginbfchar\n"+n.join("\n")+"\nendbfchar",n=[]),void 0!==e[t]&&null!==e[t]&&"function"==typeof e[t].toString&&(a=("0000"+e[t].toString(16)).slice(-4),t=("0000"+(+t).toString(16)).slice(-4),n.push("<"+t+"><"+a+">"));return n.length&&(s+="\n"+n.length+" beginbfchar\n"+n.join("\n")+"\nendbfchar\n"),s+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};t.events.push(["putFont",function(t){!function(t){var r=t.font,a=t.out,s=t.newObject,o=t.putStream;if(r.metadata instanceof e.API.TTFFont&&"Identity-H"===r.encoding){for(var i=r.metadata.Unicode.widths,l=r.metadata.subset.encode(r.metadata.glyIdsUsed,1),c="",d=0;d<l.length;d++)c+=String.fromCharCode(l[d]);var u=s();o({data:c,addLength1:!0,objectId:u}),a("endobj");var h=s();o({data:n(r.metadata.toUnicode),addLength1:!0,objectId:h}),a("endobj");var m=s();a("<<"),a("/Type /FontDescriptor"),a("/FontName /"+Qm(r.fontName)),a("/FontFile2 "+u+" 0 R"),a("/FontBBox "+e.API.PDFObject.convert(r.metadata.bbox)),a("/Flags "+r.metadata.flags),a("/StemV "+r.metadata.stemV),a("/ItalicAngle "+r.metadata.italicAngle),a("/Ascent "+r.metadata.ascender),a("/Descent "+r.metadata.decender),a("/CapHeight "+r.metadata.capHeight),a(">>"),a("endobj");var p=s();a("<<"),a("/Type /Font"),a("/BaseFont /"+Qm(r.fontName)),a("/FontDescriptor "+m+" 0 R"),a("/W "+e.API.PDFObject.convert(i)),a("/CIDToGIDMap /Identity"),a("/DW 1000"),a("/Subtype /CIDFontType2"),a("/CIDSystemInfo"),a("<<"),a("/Supplement 0"),a("/Registry (Adobe)"),a("/Ordering ("+r.encoding+")"),a(">>"),a(">>"),a("endobj"),r.objectNumber=s(),a("<<"),a("/Type /Font"),a("/Subtype /Type0"),a("/ToUnicode "+h+" 0 R"),a("/BaseFont /"+Qm(r.fontName)),a("/Encoding /"+r.encoding),a("/DescendantFonts ["+p+" 0 R]"),a(">>"),a("endobj"),r.isAlreadyPutted=!0}}(t)}]),t.events.push(["putFont",function(t){!function(t){var r=t.font,a=t.out,s=t.newObject,o=t.putStream;if(r.metadata instanceof e.API.TTFFont&&"WinAnsiEncoding"===r.encoding){for(var i=r.metadata.rawData,l="",c=0;c<i.length;c++)l+=String.fromCharCode(i[c]);var d=s();o({data:l,addLength1:!0,objectId:d}),a("endobj");var u=s();o({data:n(r.metadata.toUnicode),addLength1:!0,objectId:u}),a("endobj");var h=s();a("<<"),a("/Descent "+r.metadata.decender),a("/CapHeight "+r.metadata.capHeight),a("/StemV "+r.metadata.stemV),a("/Type /FontDescriptor"),a("/FontFile2 "+d+" 0 R"),a("/Flags 96"),a("/FontBBox "+e.API.PDFObject.convert(r.metadata.bbox)),a("/FontName /"+Qm(r.fontName)),a("/ItalicAngle "+r.metadata.italicAngle),a("/Ascent "+r.metadata.ascender),a(">>"),a("endobj"),r.objectNumber=s();for(var m=0;m<r.metadata.hmtx.widths.length;m++)r.metadata.hmtx.widths[m]=parseInt(r.metadata.hmtx.widths[m]*(1e3/r.metadata.head.unitsPerEm));a("<</Subtype/TrueType/Type/Font/ToUnicode "+u+" 0 R/BaseFont/"+Qm(r.fontName)+"/FontDescriptor "+h+" 0 R/Encoding/"+r.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(r.metadata.hmtx.widths)+">>"),a("endobj"),r.isAlreadyPutted=!0}}(t)}]);var a=function(e){var t,n=e.text||"",a=e.x,s=e.y,o=e.options||{},i=e.mutex||{},l=i.pdfEscape,c=i.activeFontKey,d=i.fonts,u=c,h="",m=0,p="",f=d[u].encoding;if("Identity-H"!==d[u].encoding)return{text:n,x:a,y:s,options:o,mutex:i};for(p=n,u=c,Array.isArray(n)&&(p=n[0]),m=0;m<p.length;m+=1)d[u].metadata.hasOwnProperty("cmap")&&(t=d[u].metadata.cmap.unicode.codeMap[p[m].charCodeAt(0)]),t||p[m].charCodeAt(0)<256&&d[u].metadata.hasOwnProperty("Unicode")?h+=p[m]:h+="";var g="";return parseInt(u.slice(1))<14||"WinAnsiEncoding"===f?g=l(h,u).split("").map(function(e){return e.charCodeAt(0).toString(16)}).join(""):"Identity-H"===f&&(g=r(h,d[u])),i.isHex=!0,{text:g,x:a,y:s,options:o,mutex:i}};t.events.push(["postProcessText",function(e){var t=e.text||"",r=[],n={text:t,x:e.x,y:e.y,options:e.options,mutex:e.mutex};if(Array.isArray(t)){var s=0;for(s=0;s<t.length;s+=1)Array.isArray(t[s])&&3===t[s].length?r.push([a(Object.assign({},n,{text:t[s][0]})).text,t[s][1],t[s][2]]):r.push(a(Object.assign({},n,{text:t[s]})).text);e.text=r}else e.text=a(Object.assign({},n,{text:t})).text}])}(np),function(e){var t=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]},e.addFileToVFS=function(e,r){return t.call(this),this.internal.vFS[e]=r,this},e.getFileFromVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]?this.internal.vFS[e]:null}}(np.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(e){var r,n,a,s,o,i,l,c=t,d=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],h={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},m={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},p=["(",")","(","<",">","<","[","]","[","{","}","{","\xab","\xbb","\xab","\u2039","\u203a","\u2039","\u2045","\u2046","\u2045","\u207d","\u207e","\u207d","\u208d","\u208e","\u208d","\u2264","\u2265","\u2264","\u2329","\u232a","\u2329","\ufe59","\ufe5a","\ufe59","\ufe5b","\ufe5c","\ufe5b","\ufe5d","\ufe5e","\ufe5d","\ufe64","\ufe65","\ufe64"],f=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),g=!1,v=0;this.__bidiEngine__={};var x=function(e){var t=e.charCodeAt(),r=t>>8,n=m[r];return void 0!==n?c[256*n+(255&t)]:252===r||253===r?"AL":f.test(r)?"L":8===r?"R":"N"},b=function(e){for(var t,r=0;r<e.length;r++){if("L"===(t=x(e.charAt(r))))return!1;if("R"===t)return!0}return!1},y=function(e,t,o,i){var l,c,d,u,h=t[i];switch(h){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":g=!1;break;case"N":case"AN":break;case"EN":g&&(h="AN");break;case"AL":g=!0,h="R";break;case"WS":case"BN":h="N";break;case"CS":i<1||i+1>=t.length||"EN"!==(l=o[i-1])&&"AN"!==l||"EN"!==(c=t[i+1])&&"AN"!==c?h="N":g&&(c="AN"),h=c===l?c:"N";break;case"ES":h="EN"===(l=i>0?o[i-1]:"B")&&i+1<t.length&&"EN"===t[i+1]?"EN":"N";break;case"ET":if(i>0&&"EN"===o[i-1]){h="EN";break}if(g){h="N";break}for(d=i+1,u=t.length;d<u&&"ET"===t[d];)d++;h=d<u&&"EN"===t[d]?"EN":"N";break;case"NSM":if(a&&!s){for(u=t.length,d=i+1;d<u&&"NSM"===t[d];)d++;if(d<u){var m=e[i],p=m>=1425&&m<=2303||64286===m;if(l=t[d],p&&("R"===l||"AL"===l)){h="R";break}}}h=i<1||"B"===(l=t[i-1])?"N":o[i-1];break;case"B":g=!1,r=!0,h=v;break;case"S":n=!0,h="N"}return h},w=function(e,t,r){var n=e.split("");return r&&j(n,r,{hiLevel:v}),n.reverse(),t&&t.reverse(),n.join("")},j=function(e,t,a){var s,o,i,l,c,m=-1,p=e.length,f=0,b=[],w=v?u:d,j=[];for(g=!1,r=!1,n=!1,o=0;o<p;o++)j[o]=x(e[o]);for(i=0;i<p;i++){if(c=f,b[i]=y(e,j,b,i),s=240&(f=w[c][h[b[i]]]),f&=15,t[i]=l=w[f][5],s>0)if(16===s){for(o=m;o<i;o++)t[o]=1;m=-1}else m=-1;if(w[f][6])-1===m&&(m=i);else if(m>-1){for(o=m;o<i;o++)t[o]=l;m=-1}"B"===j[i]&&(t[i]=0),a.hiLevel|=l}n&&function(e,t,r){for(var n=0;n<r;n++)if("S"===e[n]){t[n]=v;for(var a=n-1;a>=0&&"WS"===e[a];a--)t[a]=v}}(j,t,p)},N=function(e,t,n,a,s){if(!(s.hiLevel<e)){if(1===e&&1===v&&!r)return t.reverse(),void(n&&n.reverse());for(var o,i,l,c,d=t.length,u=0;u<d;){if(a[u]>=e){for(l=u+1;l<d&&a[l]>=e;)l++;for(c=u,i=l-1;c<i;c++,i--)o=t[c],t[c]=t[i],t[i]=o,n&&(o=n[c],n[c]=n[i],n[i]=o);u=l}u++}}},S=function(e,t,r){var n=e.split(""),a={hiLevel:v};return r||(r=[]),j(n,r,a),function(e,t,r){if(0!==r.hiLevel&&l)for(var n,a=0;a<e.length;a++)1===t[a]&&(n=p.indexOf(e[a]))>=0&&(e[a]=p[n+1])}(n,r,a),N(2,n,t,r,a),N(1,n,t,r,a),n.join("")};return this.__bidiEngine__.doBidiReorder=function(e,t,r){if(function(e,t){if(t)for(var r=0;r<e.length;r++)t[r]=r;void 0===s&&(s=b(e)),void 0===i&&(i=b(e))}(e,t),a||!o||i)if(a&&o&&s^i)v=s?1:0,e=w(e,t,r);else if(!a&&o&&i)v=s?1:0,e=S(e,t,r),e=w(e,t);else if(!a||s||o||i){if(a&&!o&&s^i)e=w(e,t),s?(v=0,e=S(e,t,r)):(v=1,e=S(e,t,r),e=w(e,t));else if(a&&s&&!o&&i)v=1,e=S(e,t,r),e=w(e,t);else if(!a&&!o&&s^i){var n=l;s?(v=1,e=S(e,t,r),v=0,l=!1,e=S(e,t,r),l=n):(v=0,e=S(e,t,r),e=w(e,t),v=1,l=!1,e=S(e,t,r),l=n,e=w(e,t))}}else v=0,e=S(e,t,r);else v=s?1:0,e=S(e,t,r);return e},this.__bidiEngine__.setOptions=function(e){e&&(a=e.isInputVisual,o=e.isOutputVisual,s=e.isInputRtl,i=e.isOutputRtl,l=e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(e),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(e){var t=e.text;e.x,e.y;var n=e.options||{};e.mutex,n.lang;var a=[];if(n.isInputVisual="boolean"!=typeof n.isInputVisual||n.isInputVisual,r.setOptions(n),"[object Array]"===Object.prototype.toString.call(t)){var s=0;for(a=[],s=0;s<t.length;s+=1)"[object Array]"===Object.prototype.toString.call(t[s])?a.push([r.doBidiReorder(t[s][0]),t[s][1],t[s][2]]):a.push([r.doBidiReorder(t[s])]);e.text=a}else e.text=r.doBidiReorder(t);r.setOptions({isInputVisual:!0})}])}(np),np.API.TTFFont=function(){function e(e){var t;if(this.rawData=e,t=this.contents=new If(e),this.contents.pos=4,"ttcf"===t.readString(4))throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Xf(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new Tf(this.contents),this.head=new Mf(this),this.name=new Wf(this),this.cmap=new Rf(this),this.toUnicode={},this.hhea=new Ff(this),this.maxp=new qf(this),this.hmtx=new Vf(this),this.post=new Bf(this),this.os2=new Uf(this),this.loca=new Yf(this),this.glyf=new Gf(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var e,t,r,n,a;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var t,r,n,a;for(a=[],t=0,r=(n=this.bbox).length;t<r;t++)e=n[t],a.push(Math.round(e*this.scaleFactor));return a}.call(this),this.stemV=0,this.post.exists?(r=255&(n=this.post.italic_angle),32768&(t=n>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(a=this.familyClass)||2===a||3===a||4===a||5===a||7===a,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(e){var t;return(null!=(t=this.cmap.unicode)?t.codeMap[e]:void 0)||0},e.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},e.prototype.widthOfString=function(e,t,r){var n,a,s,o;for(s=0,a=0,o=(e=""+e).length;0<=o?a<o:a>o;a=0<=o?++a:--a)n=e.charCodeAt(a),s+=this.widthOfGlyph(this.characterToGlyph(n))+r*(1e3/t)||0;return s*(t/1e3)},e.prototype.lineHeight=function(e,t){var r;return null==t&&(t=!1),r=t?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},e}();var _f,If=function(){function e(e){this.data=null!=e?e:[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(e){return this.data[this.pos++]=e},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},e.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},e.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},e.prototype.readString=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)r[t]=String.fromCharCode(this.readByte());return r.join("")},e.prototype.writeString=function(e){var t,r,n;for(n=[],t=0,r=e.length;0<=r?t<r:t>r;t=0<=r?++t:--t)n.push(this.writeByte(e.charCodeAt(t)));return n},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(e){return this.writeInt16(e)},e.prototype.readLongLong=function(){var e,t,r,n,a,s,o,i;return e=this.readByte(),t=this.readByte(),r=this.readByte(),n=this.readByte(),a=this.readByte(),s=this.readByte(),o=this.readByte(),i=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^r)+4294967296*(255^n)+16777216*(255^a)+65536*(255^s)+256*(255^o)+(255^i)+1):72057594037927940*e+281474976710656*t+1099511627776*r+4294967296*n+16777216*a+65536*s+256*o+i},e.prototype.writeLongLong=function(e){var t,r;return t=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(e){return this.writeInt32(e)},e.prototype.read=function(e){var t,r;for(t=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)t.push(this.readByte());return t},e.prototype.write=function(e){var t,r,n,a;for(a=[],r=0,n=e.length;r<n;r++)t=e[r],a.push(this.writeByte(t));return a},e}(),Tf=function(){var e;function t(e){var t,r,n;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},r=0,n=this.tableCount;0<=n?r<n:r>n;r=0<=n?++r:--r)t={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[t.tag]=t}return t.prototype.encode=function(t){var r,n,a,s,o,i,l,c,d,u,h,m,p;for(p in h=Object.keys(t).length,i=Math.log(2),d=16*Math.floor(Math.log(h)/i),s=Math.floor(d/i),c=16*h-d,(n=new If).writeInt(this.scalarType),n.writeShort(h),n.writeShort(d),n.writeShort(s),n.writeShort(c),a=16*h,l=n.pos+a,o=null,m=[],t)for(u=t[p],n.writeString(p),n.writeInt(e(u)),n.writeInt(l),n.writeInt(u.length),m=m.concat(u),"head"===p&&(o=l),l+=u.length;l%4;)m.push(0),l++;return n.write(m),r=2981146554-e(n.data),n.pos=o+8,n.writeUInt32(r),n.data},e=function(e){var t,r,n,a;for(e=Hf.call(e);e.length%4;)e.push(0);for(n=new If(e),r=0,t=0,a=e.length;t<a;t=t+=4)r+=n.readUInt32();return 4294967295&r},t}(),Lf={}.hasOwnProperty,Df=function(e,t){for(var r in t)Lf.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};_f=function(){function e(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var Mf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="head",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},e.prototype.encode=function(e){var t;return(t=new If).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},e}(),Of=function(){function e(e,t){var r,n,a,s,o,i,l,c,d,u,h,m,p,f,g,v,x;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),d=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(i=0;i<256;++i)this.codeMap[i]=e.readByte();break;case 4:for(h=e.readUInt16(),u=h/2,e.pos+=6,a=function(){var t,r;for(r=[],i=t=0;0<=u?t<u:t>u;i=0<=u?++t:--t)r.push(e.readUInt16());return r}(),e.pos+=2,p=function(){var t,r;for(r=[],i=t=0;0<=u?t<u:t>u;i=0<=u?++t:--t)r.push(e.readUInt16());return r}(),l=function(){var t,r;for(r=[],i=t=0;0<=u?t<u:t>u;i=0<=u?++t:--t)r.push(e.readUInt16());return r}(),c=function(){var t,r;for(r=[],i=t=0;0<=u?t<u:t>u;i=0<=u?++t:--t)r.push(e.readUInt16());return r}(),n=(this.length-e.pos+this.offset)/2,o=function(){var t,r;for(r=[],i=t=0;0<=n?t<n:t>n;i=0<=n?++t:--t)r.push(e.readUInt16());return r}(),i=g=0,x=a.length;g<x;i=++g)for(f=a[i],r=v=m=p[i];m<=f?v<=f:v>=f;r=m<=f?++v:--v)0===c[i]?s=r+l[i]:0!==(s=o[c[i]/2+(r-m)-(u-i)]||0)&&(s+=l[i]),this.codeMap[r]=65535&s}e.pos=d}return e.encode=function(e,t){var r,n,a,s,o,i,l,c,d,u,h,m,p,f,g,v,x,b,y,w,j,N,S,k,A,C,E,P,_,I,T,L,D,M,O,R,F,U,B,z,W,q,V,H,G,K;switch(P=new If,s=Object.keys(e).sort(function(e,t){return e-t}),t){case"macroman":for(p=0,f=function(){var e=[];for(m=0;m<256;++m)e.push(0);return e}(),v={0:0},a={},_=0,D=s.length;_<D;_++)null==v[V=e[n=s[_]]]&&(v[V]=++p),a[n]={old:e[n],new:v[e[n]]},f[n]=v[e[n]];return P.writeUInt16(1),P.writeUInt16(0),P.writeUInt32(12),P.writeUInt16(0),P.writeUInt16(262),P.writeUInt16(0),P.write(f),{charMap:a,subtable:P.data,maxGlyphID:p+1};case"unicode":for(C=[],d=[],x=0,v={},r={},g=l=null,I=0,M=s.length;I<M;I++)null==v[y=e[n=s[I]]]&&(v[y]=++x),r[n]={old:y,new:v[y]},o=v[y]-n,null!=g&&o===l||(g&&d.push(g),C.push(n),l=o),g=n;for(g&&d.push(g),d.push(65535),C.push(65535),k=2*(S=C.length),N=2*Math.pow(Math.log(S)/Math.LN2,2),u=Math.log(N/2)/Math.LN2,j=2*S-N,i=[],w=[],h=[],m=T=0,O=C.length;T<O;m=++T){if(A=C[m],c=d[m],65535===A){i.push(0),w.push(0);break}if(A-(E=r[A].new)>=32768)for(i.push(0),w.push(2*(h.length+S-m)),n=L=A;A<=c?L<=c:L>=c;n=A<=c?++L:--L)h.push(r[n].new);else i.push(E-A),w.push(0)}for(P.writeUInt16(3),P.writeUInt16(1),P.writeUInt32(12),P.writeUInt16(4),P.writeUInt16(16+8*S+2*h.length),P.writeUInt16(0),P.writeUInt16(k),P.writeUInt16(N),P.writeUInt16(u),P.writeUInt16(j),W=0,R=d.length;W<R;W++)n=d[W],P.writeUInt16(n);for(P.writeUInt16(0),q=0,F=C.length;q<F;q++)n=C[q],P.writeUInt16(n);for(H=0,U=i.length;H<U;H++)o=i[H],P.writeUInt16(o);for(G=0,B=w.length;G<B;G++)b=w[G],P.writeUInt16(b);for(K=0,z=h.length;K<z;K++)p=h[K],P.writeUInt16(p);return{charMap:r,subtable:P.data,maxGlyphID:x+1}}},e}(),Rf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="cmap",e.prototype.parse=function(e){var t,r,n;for(e.pos=this.offset,this.version=e.readUInt16(),n=e.readUInt16(),this.tables=[],this.unicode=null,r=0;0<=n?r<n:r>n;r=0<=n?++r:--r)t=new Of(e,this.offset),this.tables.push(t),t.isUnicode&&null==this.unicode&&(this.unicode=t);return!0},e.encode=function(e,t){var r,n;return null==t&&(t="macroman"),r=Of.encode(e,t),(n=new If).writeUInt16(0),n.writeUInt16(1),r.table=n.data.concat(r.subtable),r},e}(),Ff=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="hhea",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},e}(),Uf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="OS/2",e.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,r;for(r=[],t=0;t<10;++t)r.push(e.readByte());return r}(),this.charRange=function(){var t,r;for(r=[],t=0;t<4;++t)r.push(e.readInt());return r}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,r;for(r=[],t=0;t<2;t=++t)r.push(e.readInt());return r}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},e}(),Bf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="post",e.prototype.parse=function(e){var t,r,n;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var a;for(r=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=r?a<r:a>r;a=0<=r?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],n=[];e.pos<this.offset+this.length;)t=e.readByte(),n.push(this.names.push(e.readString(t)));return n;case 151552:return r=e.readUInt16(),this.offsets=e.read(r);case 262144:return this.map=function(){var t,r,n;for(n=[],a=t=0,r=this.file.maxp.numGlyphs;0<=r?t<r:t>r;a=0<=r?++t:--t)n.push(e.readUInt32());return n}.call(this)}},e}(),zf=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},Wf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="name",e.prototype.parse=function(e){var t,r,n,a,s,o,i,l,c,d,u;for(e.pos=this.offset,e.readShort(),t=e.readShort(),o=e.readShort(),r=[],a=0;0<=t?a<t:a>t;a=0<=t?++a:--a)r.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+o+e.readShort()});for(i={},a=c=0,d=r.length;c<d;a=++c)n=r[a],e.pos=n.offset,l=e.readString(n.length),s=new zf(l,n),null==i[u=n.nameID]&&(i[u]=[]),i[n.nameID].push(s);this.strings=i,this.copyright=i[0],this.fontFamily=i[1],this.fontSubfamily=i[2],this.uniqueSubfamily=i[3],this.fontName=i[4],this.version=i[5];try{this.postscriptName=i[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(zt){this.postscriptName=i[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=i[7],this.manufacturer=i[8],this.designer=i[9],this.description=i[10],this.vendorUrl=i[11],this.designerUrl=i[12],this.license=i[13],this.licenseUrl=i[14],this.preferredFamily=i[15],this.preferredSubfamily=i[17],this.compatibleFull=i[18],this.sampleText=i[19]},e}(),qf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="maxp",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},e}(),Vf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="hmtx",e.prototype.parse=function(e){var t,r,n,a,s,o,i;for(e.pos=this.offset,this.metrics=[],t=0,o=this.file.hhea.numberOfMetrics;0<=o?t<o:t>o;t=0<=o?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(n=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var r,a;for(a=[],t=r=0;0<=n?r<n:r>n;t=0<=n?++r:--r)a.push(e.readInt16());return a}(),this.widths=function(){var e,t,r,n;for(n=[],e=0,t=(r=this.metrics).length;e<t;e++)a=r[e],n.push(a.advance);return n}.call(this),r=this.widths[this.widths.length-1],i=[],t=s=0;0<=n?s<n:s>n;t=0<=n?++s:--s)i.push(this.widths.push(r));return i},e.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},e}(),Hf=[].slice,Gf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(e){var t,r,n,a,s,o,i,l,c,d;return e in this.cache?this.cache[e]:(a=this.file.loca,t=this.file.contents,r=a.indexOf(e),0===(n=a.lengthOf(e))?this.cache[e]=null:(t.pos=this.offset+r,s=(o=new If(t.read(n))).readShort(),l=o.readShort(),d=o.readShort(),i=o.readShort(),c=o.readShort(),this.cache[e]=-1===s?new Jf(o,l,d,i,c):new Kf(o,s,l,d,i,c),this.cache[e]))},e.prototype.encode=function(e,t,r){var n,a,s,o,i;for(s=[],a=[],o=0,i=t.length;o<i;o++)n=e[t[o]],a.push(s.length),n&&(s=s.concat(n.encode(r)));return a.push(s.length),{table:s,offsets:a}},e}(),Kf=function(){function e(e,t,r,n,a,s){this.raw=e,this.numberOfContours=t,this.xMin=r,this.yMin=n,this.xMax=a,this.yMax=s,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),Jf=function(){function e(e,t,r,n,a){var s,o;for(this.raw=e,this.xMin=t,this.yMin=r,this.xMax=n,this.yMax=a,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],s=this.raw;o=s.readShort(),this.glyphOffsets.push(s.pos),this.glyphIDs.push(s.readUInt16()),32&o;)s.pos+=1&o?4:2,128&o?s.pos+=8:64&o?s.pos+=4:8&o&&(s.pos+=2)}return e.prototype.encode=function(){var e,t,r;for(t=new If(Hf.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)t.pos=this.glyphOffsets[e];return t.data},e}(),Yf=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Df(e,_f),e.prototype.tag="loca",e.prototype.parse=function(e){var t,r;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=0===t?function(){var t,n;for(n=[],r=0,t=this.length;r<t;r+=2)n.push(2*e.readUInt16());return n}.call(this):function(){var t,n;for(n=[],r=0,t=this.length;r<t;r+=4)n.push(e.readUInt32());return n}.call(this)},e.prototype.indexOf=function(e){return this.offsets[e]},e.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},e.prototype.encode=function(e,t){for(var r=new Uint32Array(this.offsets.length),n=0,a=0,s=0;s<r.length;++s)if(r[s]=n,a<t.length&&t[a]==s){++a,r[s]=n;var o=this.offsets[s],i=this.offsets[s+1]-o;i>0&&(n+=i)}for(var l=new Array(4*r.length),c=0;c<r.length;++c)l[4*c+3]=255&r[c],l[4*c+2]=(65280&r[c])>>8,l[4*c+1]=(16711680&r[c])>>16,l[4*c]=(4278190080&r[c])>>24;return l},e}(),Xf=function(){function e(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var e,t,r,n,a;for(t in n=this.font.cmap.tables[0].codeMap,e={},a=this.subset)r=a[t],e[t]=n[r];return e},e.prototype.glyphsFor=function(e){var t,r,n,a,s,o,i;for(n={},s=0,o=e.length;s<o;s++)n[a=e[s]]=this.font.glyf.glyphFor(a);for(a in t=[],n)(null!=(r=n[a])?r.compound:void 0)&&t.push.apply(t,r.glyphIDs);if(t.length>0)for(a in i=this.glyphsFor(t))r=i[a],n[a]=r;return n},e.prototype.encode=function(e,t){var r,n,a,s,o,i,l,c,d,u,h,m,p,f,g;for(n in r=Rf.encode(this.generateCmap(),"unicode"),s=this.glyphsFor(e),h={0:0},g=r.charMap)h[(i=g[n]).old]=i.new;for(m in u=r.maxGlyphID,s)m in h||(h[m]=u++);return c=function(e){var t,r;for(t in r={},e)r[e[t]]=t;return r}(h),d=Object.keys(c).sort(function(e,t){return e-t}),p=function(){var e,t,r;for(r=[],e=0,t=d.length;e<t;e++)o=d[e],r.push(c[o]);return r}(),a=this.font.glyf.encode(s,p,h),l=this.font.loca.encode(a.offsets,p),f={cmap:this.font.cmap.raw(),glyf:a.table,loca:l,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(f["OS/2"]=this.font.os2.raw()),this.font.directory.encode(f)},e}();np.API.PDFObject=function(){var e;function t(){}return e=function(e,t){return(Array(t+1).join("0")+e).slice(-t)},t.convert=function(r){var n,a,s,o;if(Array.isArray(r))return"["+function(){var e,a,s;for(s=[],e=0,a=r.length;e<a;e++)n=r[e],s.push(t.convert(n));return s}().join(" ")+"]";if("string"==typeof r)return"/"+r;if(null!=r?r.isString:void 0)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(r)){for(a in s=["<<"],r)o=r[a],s.push("/"+a+" "+t.convert(o));return s.push(">>"),s.join("\n")}return""+r},t}();const Qf=e=>{let{projects:t=[],colorMode:n=!1,onProjectSelect:a}=e;const s=Ct(),[i,l]=(0,o.useState)([]),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)([]),[f,g]=(0,o.useState)(!1),[v,x]=(0,o.useState)(null),[b,y]=(0,o.useState)(null),[w,j]=(0,o.useState)(!1),[N,S]=(0,o.useState)(0),[k,A]=(0,o.useState)(!1),[C,E]=(0,o.useState)(""),[P,_]=(0,o.useState)(null),I=(0,o.useRef)(null),T=(0,o.useRef)(null),L=(0,o.useRef)(null),D=(0,o.useRef)(null),M=(0,o.useRef)(null),O=(0,o.useRef)(null),R=(0,o.useRef)(null),F=(0,o.useRef)(null),U=(0,o.useRef)(!0),[B,z]=(0,o.useState)(!0),{subjects:W}=ri(),[q,V]=(0,o.useState)("Project Status Update"),[H,G]=(0,o.useState)([]),[K,J]=(0,o.useState)([]),[X,Q]=(0,o.useState)(!1),[Z,$]=(0,o.useState)([]),[ee,te]=(0,o.useState)(!1),[re,ne]=(0,o.useState)(""),[ae,se]=(0,o.useState)(!1),[oe,ie]=(0,o.useState)(null),[le,ce]=(0,o.useState)([]),[de,ue]=(0,o.useState)(""),[he,me]=(0,o.useState)([]),pe=(0,o.useRef)(null),[fe,ge]=(0,o.useState)(!1),[ve,xe]=(0,o.useState)(!1),[be,ye]=(0,o.useState)(!1),[we,je]=(0,o.useState)(0),Ne=e=>{if(null==e)return"";let t=String(e);return t=t.replace(/\xc3\u0192\xc6'\xc3\u201a\xc2\xa2|\xc3\xa2\xe2\u201a\xac\xc5\xa1\xc3\u201a\xc2\xac|\xc3\u201a\xc2\xa2/g,"\u2022"),t=t.replace(/\xc3\u0192\xc6'[^\s]*\|[^\s]*\|[^\s]*/g,""),t=t.replace(/\xc3\u0192\xe2\u20ac\u0161/g,""),t=t.replace(/\xc3\u0192\xc2\xb0/g,""),t=t.replace(/\xc3\u2026\xc2\xb8/g,""),t=t.replace(/\xc2\xa4/g,""),t=t.replace(/\xc5\xbd/g,""),t=t.replace(/\xc2\xa1/g,""),t=t.replace(/\xc3\u0192\xc2\xb0/g,""),t=t.replace(/\xc3\u2026\xc2\xb8/g,""),t=t.replace(/\xc3\u2026\xc2\xb8/g,""),t=t.replace(/[\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8\xc2\xa4\xc5\xbd\xc2\xa1]/g,""),t=t.replace(/[\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8\xc2\xa4\xc5\xbd\xc2\xa1]/g,""),t=t.replace(/[^\x20-\x7E\u00A0-\uFFFF]/g,""),t=t.replace(/\s{2,}/g," ").trim(),t},[Se,ke]=(0,o.useState)(""),[Ae,Ce]=(0,o.useState)(!1),[Ee,Pe]=(0,o.useState)([]),[_e,Ie]=(0,o.useState)(!1),[Te,Le]=(0,o.useState)(""),[De,Me]=(0,o.useState)(!1),[Oe,Re]=(0,o.useState)([]),[Fe,Ue]=(0,o.useState)(!1),[Be,ze]=(0,o.useState)(""),[We,qe]=(0,o.useState)("");(0,o.useEffect)(()=>{try{const e=e=>e?e.firstName||e.lastName?[e.firstName,e.lastName].filter(Boolean).join(" ").trim():(e.name||e.fullName||e.email||"").trim():"";let t="";const r=localStorage.getItem("user")||localStorage.getItem("currentUser");if(r)try{t=e(JSON.parse(r))}catch(Pr){}if(!t){const r=sessionStorage.getItem("user")||sessionStorage.getItem("currentUser");if(r)try{t=e(JSON.parse(r))}catch(Pr){}}qe(t)}catch(Pr){}},[]),(0,o.useEffect)(()=>{i.some(e=>e.requiresRecipientSelection)&&De&&Me(!1)},[i,De]),(0,o.useEffect)(()=>{(async()=>{if(De){Ue(!0);try{console.log("Fetching documents...");const e=[],t=[null],r=new Set;for(;t.length>0;){const n=t.shift(),a=n||"root";if(!r.has(a)){r.add(a);try{const r=await Ma.A.list({parentId:n,limit:1e3});if(r&&r.assets&&Array.isArray(r.assets)){const n=r.assets.filter(e=>"FILE"===e.type);e.push(...n);r.assets.filter(e=>"FOLDER"===e.type).forEach(e=>t.push(e.id))}}catch(XI){console.error("Failed to fetch from folder ".concat(a,":"),XI)}}}console.log("Found documents:",e.length,e),Re(e)}catch(e){console.error("Failed to fetch documents:",e),Re([])}finally{Ue(!1)}}})()},[De]);const[Ve,He]=(0,o.useState)([]),[Ge,Ke]=(0,o.useState)([]),Je=(0,o.useRef)(null),Ye=(0,o.useRef)(null),Xe=(0,o.useRef)([]),Qe=(0,o.useRef)([]),[Ze,$e]=(0,o.useState)(!1),[et,tt]=(0,o.useState)(null),[rt,nt]=(0,o.useState)(["pdf","json"]),[at,st]=(0,o.useState)(!1),[ot,it]=(0,o.useState)(null),[lt,ct]=(0,o.useState)(!1),[dt,ut]=(0,o.useState)(null);(0,o.useEffect)(()=>{Xe.current=Ve},[Ve]),(0,o.useEffect)(()=>{Qe.current=Ee},[Ee]);const ht="bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4",mt="1ad2d156-7732-4f8b-97d3-41addce2d6a7",pt=e=>{if(!e)return"";const t=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=e=>e.replace(/\[(.*?)\]\((https?:\/\/[^)\s]+)\)/g,(e,r,n)=>'<a href="'.concat(t(n),'" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">').concat(t(r),"</a>")),n=String(e).replace(/\r\n?/g,"\n").split("\n"),a=[];let s=!1,o=!1,i=!1,l=!1;const c=()=>{s&&(a.push("</ul>"),s=!1),o&&(a.push("</ol>"),o=!1)};for(let p=0;p<n.length;p++){var d;let e=null!==(d=n[p])&&void 0!==d?d:"";const m=String(e).trim();if(/^```/.test(m)){i?(a.push("</code></pre>"),i=!1):(c(),i=!0,a.push('<pre class="bg-gray-50 border border-gray-200 rounded p-2 overflow-x-auto"><code>'));continue}if(i){a.push("".concat(t(e),"\n"));continue}if(""===m){c(),l=!1,a.push('<div class="h-2"></div>');continue}if(m.startsWith("#")){var u,h;c(),l=!1;const e=Math.min((null===(u=m.match(/^#+/))||void 0===u||null===(h=u[0])||void 0===h?void 0:h.length)||1,6),r=m.replace(/^#+\s*/,"");a.push("<h".concat(e,' class="font-semibold mb-2 mt-1">').concat(t(r),"</h").concat(e,">"));continue}if(/^.{1,120}:$/.test(m)){c(),l=!0;const e=m.slice(0,-1);a.push('<h3 class="font-semibold mb-1 mt-1">'.concat(t(e),"</h3>"));continue}if(/^([1-9]|[1-9][0-9])[.)]\s+/.test(m)||/^([1-9]|[1-9][0-9])\s+-\s+/.test(m)){s&&(a.push("</ul>"),s=!1),o||(a.push('<ol class="list-decimal ml-5 mb-1 space-y-1">'),o=!0);const e=m.replace(/^([1-9]|[1-9][0-9])[.)]\s+/,"").replace(/^([1-9]|[1-9][0-9])\s+-\s+/,"");a.push("<li>".concat(r(t(e)),"</li>")),l=!1;continue}if(/^[-*\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xc2\xa2\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xe2\u201a\xac\xc5\u201c\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xe2\u201a\xac\xc2\x9d]\s+/.test(m)){o&&(a.push("</ol>"),o=!1),s||(a.push('<ul class="list-disc ml-5 mb-1 space-y-1">'),s=!0);const e=m.replace(/^[-*\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xc2\xa2\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xe2\u201a\xac\xc5\u201c\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xe2\u201a\xac\xc2\x9d]\s+/,"");a.push("<li>".concat(r(t(e)),"</li>")),l=!1;continue}if(l){s||(a.push('<ul class="list-disc ml-5 mb-1 space-y-1">'),s=!0),a.push("<li>".concat(r(t(m)),"</li>"));continue}if(/^(Phase|Section|Line Item|Status|Progress|Customer|Project):/i.test(m)){c(),l=!1;const n=e.indexOf(":"),s=e.slice(0,n).trim(),o=e.slice(n+1).trim();a.push('<div class="mb-2 p-2 bg-gray-50 rounded border-l-4 border-blue-400"><strong class="text-blue-700">'.concat(t(s),':</strong> <span class="text-gray-800">').concat(r(t(o)),"</span></div>"));continue}let f=t(e).replace(/\*\*\*([^*]+)\*\*\*/g,"<em><strong>$1</strong></em>").replace(/___([^_]+)___/g,"<em><strong>$1</strong></em>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/__([^_]+)__/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/_([^_]+)_/g,"<em>$1</em>");f=r(f),c(),l=!1,a.push('<p class="mb-1 leading-relaxed">'.concat(f,"</p>"))}s&&a.push("</ul>"),o&&a.push("</ol>"),i&&a.push("</code></pre>");let m=a.join("");return m=m.replace(/\s?`{1,3}\s?/g," ").replace(/\s?\*{2,}\s?/g," ").replace(/\s?_{2,}\s?/g," ").replace(/\s?#{2,}\s?/g," ").replace(/\/{3,}/g," ").replace(/\]\s*\//g," ").replace(/(^|\s)[[\]](?=\s|$)/g," ").replace(/\s{2,}/g," ").trim(),m},ft=e=>{try{const t=String(e||"").trim(),r=t.toLowerCase();if(!t)return We||"You";return["assistant","ai","aiaassistant","bubbles","bubble","bot","agent","vapi","system"].includes(r)||(r.includes("assistant")||r.includes("bubbles")||r.includes("bot")||r.includes("ai")||r.includes("agent")||r.includes("vapi"))?"Bubbles AI":["user","you","client","customer","human","caller"].includes(r)?We||"You":(t.indexOf(" ")>=0||/^[A-Z][a-z]+\s[A-Z]/.test(t),t)}catch(Pr){return We||"You"}};(0,o.useEffect)(()=>{try{if(!b&&Array.isArray(t)&&t.length>0){const e=sessionStorage.getItem("aiAssistant.lastProjectId");if("null"===e)y(null);else if(e){const r=t.find(t=>String(t.id)===String(e));r&&y(r)}}}catch(Pr){}},[t]),(0,o.useEffect)(()=>{try{null!==b&&void 0!==b&&b.id?sessionStorage.setItem("aiAssistant.lastProjectId",String(b.id)):null===b&&sessionStorage.setItem("aiAssistant.lastProjectId","null")}catch(Pr){}},[b,N]),(0,o.useEffect)(()=>{if(1===t.length&&!b){try{if("null"===sessionStorage.getItem("aiAssistant.lastProjectId"))return}catch(Pr){}y(t[0])}},[t,b]),(0,o.useEffect)(()=>{try{window.scrollTo(0,0),T.current&&(T.current.scrollTop=0)}catch(Pr){}},[]),(0,o.useLayoutEffect)(()=>{try{window.scrollTo(0,0);const e=document.documentElement,t=document.body;e.classList.add("no-page-scroll"),t.classList.add("no-page-scroll");const r={html:{overflowY:e.style.overflowY,overflowX:e.style.overflowX,height:e.style.height},body:{position:t.style.position,top:t.style.top,right:t.style.right,bottom:t.style.bottom,left:t.style.left,width:t.style.width,height:t.style.height,overflowY:t.style.overflowY,overflowX:t.style.overflowX}};return e.style.overflowY="hidden",e.style.overflowX="hidden",e.style.height="100%",t.style.position="fixed",t.style.top="0",t.style.right="0",t.style.bottom="0",t.style.left="0",t.style.width="100%",t.style.height="100vh",t.style.overflowY="hidden",t.style.overflowX="hidden",()=>{try{e.classList.remove("no-page-scroll"),t.classList.remove("no-page-scroll"),e.style.overflowY=r.html.overflowY,e.style.overflowX=r.html.overflowX,e.style.height=r.html.height,t.style.position=r.body.position,t.style.top=r.body.top,t.style.right=r.body.right,t.style.bottom=r.body.bottom,t.style.left=r.body.left,t.style.width=r.body.width,t.style.height=r.body.height,t.style.overflowY=r.body.overflowY,t.style.overflowX=r.body.overflowX}catch(Pr){}}}catch(Pr){}},[]),(0,o.useEffect)(()=>{const e=D.current;if(!e)return;const t=()=>{try{je(e.offsetHeight||0)}catch(Pr){}};t();let r=null;if("undefined"!==typeof ResizeObserver){r=new ResizeObserver(()=>t());try{r.observe(e)}catch(Pr){}}else window.addEventListener("resize",t);return()=>{if(r)try{r.disconnect()}catch(Pr){}else window.removeEventListener("resize",t)}},[]),(0,o.useEffect)(()=>{try{if(!_e||!ve&&!fe)return;const e=F.current;if(!e||!U.current)return;"function"===typeof e.scrollTo?e.scrollTo({top:e.scrollHeight,behavior:"auto"}):e.scrollTop=e.scrollHeight}catch(Pr){}},[Ee,Te,_e,ve,fe,B]),(0,o.useEffect)(()=>{const e=F.current;if(!e)return;const t=()=>{const t=Math.abs(e.scrollHeight-e.clientHeight-e.scrollTop)<=16;U.current=t,z(t)};return e.addEventListener("scroll",t,{passive:!0}),t(),()=>{try{e.removeEventListener("scroll",t)}catch(Pr){}}},[_e]),(0,o.useEffect)(()=>{let e=!1;return(async()=>{try{if(e)return;if(pe.current)return void console.log("[Vapi] Already initialized");if(!ht||"your-vapi-public-key"===ht)throw new Error("VAPI_PUBLIC_KEY not configured");const t=await(async()=>{try{if(window.Vapi&&"function"===typeof window.Vapi)return console.log("[Vapi] SDK already loaded from window"),window.Vapi;try{console.log("[Vapi] Attempting to load from npm package...");const{default:e}=await r.e(841).then(r.t.bind(r,841,23));if(e&&"function"===typeof e)return console.log("[Vapi] SDK loaded from npm package"),e}catch(e){console.log("[Vapi] npm package not available, falling back to CDN:",e.message)}console.log("[Vapi] Loading SDK from CDN...");const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/@vapi-ai/web@latest/dist/index.js",t.async=!0;const n=new Promise((e,r)=>{const n=setTimeout(()=>{r(new Error("Vapi SDK loading timeout"))},1e4);t.onload=()=>{clearTimeout(n),window.Vapi&&"function"===typeof window.Vapi?(console.log("[Vapi] SDK loaded successfully from CDN"),e(window.Vapi)):r(new Error("Vapi SDK loaded but constructor not available"))},t.onerror=()=>{clearTimeout(n),r(new Error("Failed to load Vapi SDK from CDN"))}}),a=document.querySelector('script[src*="@vapi-ai/web"]');return a&&a.remove(),document.head.appendChild(t),await n}catch(t){throw console.error("[Vapi] SDK loading failed:",t),t}})();if(e)return;console.log("[Vapi] Initializing with key:",ht.substring(0,8)+"..."),pe.current=new t(ht),console.log("[Vapi] initialized in AIAssistantPage"),Ce(!0),ke(""),pe.current.on("call-start",()=>{console.log("[Vapi] call started"),ge(!1),xe(!0),ke(""),Ie(!0),He([]),Ke([]),Xe.current=[],Qe.current=[],Je.current=new Date,Ye.current=null}),pe.current.on("call-end",async()=>{Ye.current=new Date,console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] Event triggered - DEBUGGING TRANSCRIPT MODAL"),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] voiceConversation length:",Ve.length),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] voiceTranscript:",Ee),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] showTranscriptModal before:",Ze);const e=Array.isArray(Qe.current)?Qe.current:[];let t=Array.isArray(Xe.current)?Xe.current:[];0===t.length&&e.length>0&&(console.log("[Vapi] Using voiceTranscript as fallback"),t=e.map((e,t)=>({speaker:We||"You",message:e,timestamp:new Date,confidence:"high"})),He(t));const r=wt();if(console.log("[Vapi] DEBUG: generated summary:",r),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] conversationToUse.length:",t.length),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] voiceTranscript.length:",e.length),t.length>0||e.length>0){console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] SHOULD show transcript modal - entering try block");try{const e=await Nt(r||{},t);console.log("[Vapi] DEBUG: enhanced summary:",e),tt(e);try{var n,a,s,o;const l=await fetch("/api/voice-transcripts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({sessionId:"voice_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),projectId:(null===b||void 0===b?void 0:b.id)||null,summary:e,fullTranscript:t,metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(n=Je.current)||void 0===n?void 0:n.toLocaleTimeString())||"Unknown"," - ").concat((null===(a=Ye.current)||void 0===a?void 0:a.toLocaleTimeString())||"Unknown"),duration:(null===r||void 0===r?void 0:r.duration)||"Unknown",participantCount:t.length>0?new Set(t.map(e=>e.speaker)).size:1,startTime:null===(s=Je.current)||void 0===s?void 0:s.toISOString(),endTime:null===(o=Ye.current)||void 0===o?void 0:o.toISOString()}})});if(l.ok){const e=await l.json();if(e.success){console.log("[Vapi] Transcript saved to database:",e.data.transcript.id),ut(e.data.transcript.id);try{var i,c;const t="voiceTranscripts",r=JSON.parse(localStorage.getItem(t)||"[]"),n=e.data.transcript.callDate||e.data.transcript.createdAt||(new Date).toISOString(),a=(null!==(i=e.data.transcript.project)&&void 0!==i&&i.projectName?"".concat(e.data.transcript.project.projectName," \xc3\xa2\xe2\u201a\xac\xe2\u20ac\x9d "):"Call \xc3\xa2\xe2\u201a\xac\xe2\u20ac\x9d ")+new Date(n).toLocaleString(),s=e.data.transcript.executiveSummary||Array.isArray(e.data.transcript.fullTranscript)&&(null===(c=e.data.transcript.fullTranscript[0])||void 0===c?void 0:c.message)||"",o={id:e.data.transcript.id,date:new Date(n).toISOString(),title:a,preview:s,raw:e.data.transcript},l=[...r.filter(e=>e.id!==o.id),o].slice(-50);localStorage.setItem(t,JSON.stringify(l))}catch(Pr){}}}}catch(g){console.error("[Vapi] Error saving transcript:",g);try{var d,u;const r="voiceTranscripts",n=JSON.parse(localStorage.getItem(r)||"[]"),a=(new Date).toISOString(),s=(null!==b&&void 0!==b&&b.projectName||null!==b&&void 0!==b&&b.name?"".concat(b.projectName||b.name," \xc3\xa2\xe2\u201a\xac\xe2\u20ac\x9d "):"Call \xc3\xa2\xe2\u201a\xac\xe2\u20ac\x9d ")+new Date(a).toLocaleString(),o=(null===e||void 0===e?void 0:e.executiveSummary)||Array.isArray(t)&&(null===(d=t[0])||void 0===d?void 0:d.message)||"",i={id:"local_".concat(Date.now()),date:a,title:s,preview:o,raw:{id:void 0,callDate:a,duration:(null===e||void 0===e||null===(u=e.metadata)||void 0===u?void 0:u.duration)||"Unknown",executiveSummary:(null===e||void 0===e?void 0:e.executiveSummary)||"",fullTranscript:t||[],project:b?{projectName:b.projectName||b.name}:null}},l=[...n,i].slice(-50);localStorage.setItem(r,JSON.stringify(l))}catch(Pr){}}console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] SUCCESS - About to setShowTranscriptModal(true)"),$e(!0),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] SUCCESS - Called setShowTranscriptModal(true)")}catch(v){var h,m;console.error("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] ERROR generating enhanced summary:",v),tt({metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(h=Je.current)||void 0===h?void 0:h.toLocaleTimeString())||"Unknown"," - ").concat((null===(m=Ye.current)||void 0===m?void 0:m.toLocaleTimeString())||"Unknown"),duration:(null===r||void 0===r?void 0:r.duration)||"Unknown",participantCount:1},executiveSummary:e.join(" ")||"Voice call ended.",keyDecisions:[],actionItems:[],materialsList:[],risks:[],fullTranscript:t}),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] FALLBACK - About to setShowTranscriptModal(true)"),$e(!0),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] FALLBACK - Called setShowTranscriptModal(true)")}}else{var p,f;console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] No conversation data to show - FORCING MODAL ANYWAY FOR TESTING"),tt({metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(p=Je.current)||void 0===p?void 0:p.toLocaleTimeString())||"Unknown"," - ").concat((null===(f=Ye.current)||void 0===f?void 0:f.toLocaleTimeString())||"Unknown"),duration:"Unknown",participantCount:1},executiveSummary:"Call ended with no conversation data captured.",keyDecisions:[],actionItems:[],materialsList:[],risks:[],fullTranscript:[]}),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] FORCE - About to setShowTranscriptModal(true)"),$e(!0),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\xb4 [CALL-END] FORCE - Called setShowTranscriptModal(true)")}if(e.length>0){const t=e.join(" "),r={id:"voice_".concat(Date.now()),type:"user",content:"\xc5\xbd\xc2\xa4Voice: ".concat(t),timestamp:new Date,isVoiceMessage:!0};l(e=>[r,...e])}ge(!1),xe(!1),ke(""),Ie(!1),Pe([]),Qe.current=[],Le("")}),pe.current.on("speech-start",()=>{console.log("[Vapi] speech started (user speaking)")}),pe.current.on("speech-end",()=>{console.log("[Vapi] speech ended (user stopped speaking)")}),pe.current.on("message",e=>{if(console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8|\xc2\xa1 [MESSAGE] type:",e.type,"message:",e),"transcript"===e.type){console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8|\xc2\xa1 [MESSAGE] Processing transcript message");const t=String(e.transcript||e.text||"").trim();if(console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xb8|\xc2\xa1 [MESSAGE] Transcript text:",t),t&&(Le(e=>e?t.startsWith(e)?Ne(t):e.startsWith(t)?e:Ne(t):Ne(t)),Pe(e=>{const r=e[e.length-1]||"";let n=e;n=t.startsWith(r)?e.slice(0,-1).concat(t):r&&r.startsWith(t)?e:[...e,t];const a=n.slice(-50);return console.log("[Vapi] Updated transcript (deduped):",a),Qe.current=a,a}),"final"===e.transcriptType&&e.role)){let r;r="assistant"===e.role||"bot"===e.role?"Bubbles":We||"You",console.log("[Vapi] Final transcript, speaker:",r,"role:",e.role),He(e=>{const n=e[e.length-1];if(n&&Math.abs(n.message.length-t.length)<10&&(n.message.includes(t.slice(0,20))||t.includes(n.message.slice(0,20))))return e;const a=[...e,{speaker:r,message:t,timestamp:new Date,confidence:"high"}];return console.log("[Vapi] Updated conversation:",a),Xe.current=a,a})}}if("user-message"===e.type&&e.message){const t=String(e.message).trim();if(t){const e=We||"You";He(r=>{const n=r[r.length-1],a=n&&(n.speaker===e||"You"===n.speaker),s=n&&new Date-new Date(n.timestamp)<15e3;if(a&&s){const e=[...r.slice(0,-1),(0,Y.A)((0,Y.A)({},n),{},{message:(n.message+" "+t).trim(),timestamp:new Date})];return Xe.current=e,e}{const n=[...r,{speaker:e,message:t,timestamp:new Date,confidence:"high"}];return Xe.current=n,n}})}}if("assistant-message"===e.type&&e.message){const t=String(e.message).trim();t&&He(e=>{const r=e[e.length-1],n=r&&("Bubbles"===r.speaker||"Bubbles AI"===r.speaker),a=r&&new Date-new Date(r.timestamp)<15e3;if(n&&a){const n=[...e.slice(0,-1),(0,Y.A)((0,Y.A)({},r),{},{message:(r.message+" "+t).trim(),timestamp:new Date})];return Xe.current=n,n}{const r=[...e,{speaker:"Bubbles",message:t,timestamp:new Date,confidence:"high"}];return Xe.current=r,r}})}if("function-call"===e.type&&e.functionCall){const t="Called function: ".concat(e.functionCall.name);console.log("[Vapi] Function called:",t),Ke(e=>[...e,t])}if("speech"===e.type&&e.speech){const t=String(e.speech).trim();t&&He(e=>{const r=e[e.length-1],n=r&&("Bubbles"===r.speaker||"Bubbles AI"===r.speaker),a=r&&new Date-new Date(r.timestamp)<15e3;if(n&&a){const n=[...e.slice(0,-1),(0,Y.A)((0,Y.A)({},r),{},{message:(r.message+" "+t).trim(),timestamp:new Date})];return Xe.current=n,n}{const r=[...e,{speaker:"Bubbles",message:t,timestamp:new Date,confidence:"high"}];return Xe.current=r,r}})}}),pe.current.on("error",e=>{console.error("[Vapi] error event:",e);const t=String((null===e||void 0===e?void 0:e.message)||e||"Voice connection error");ke(t),ge(!1),xe(!1)}),pe.current.on("volume-level",e=>{})}catch(_t){console.error("[Vapi] Init error:",_t),ke("Voice initialization failed: ".concat(_t.message)),Ce(!1)}})().catch(t=>{console.error("[Vapi] Async init failed:",t),e||ke("Voice initialization failed")}),()=>{e=!0;try{pe.current&&"function"===typeof pe.current.stop&&pe.current.stop()}catch(_t){console.error("[Vapi] Cleanup error:",_t)}}},[ht]);(0,o.useEffect)(()=>{(async()=>{if(null!==b&&void 0!==b&&b.id)try{var e,t,r;const n=await Da.bubblesService.getCurrentStep(b.id);_((null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.current)||(null===n||void 0===n||null===(t=n.data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.current)||null)}catch(n){console.error("Failed to load current workflow step:",n),_(null)}else _(null)})()},[null===b||void 0===b?void 0:b.id]),(0,o.useEffect)(()=>{(async()=>{if(be||X)try{var e,t;te(!0);const r=await Da.usersService.getTeamMembers(),n=Array.isArray(null===r||void 0===r?void 0:r.data)?r.data:(null===r||void 0===r||null===(e=r.data)||void 0===e?void 0:e.teamMembers)||(null===r||void 0===r||null===(t=r.data)||void 0===t?void 0:t.users)||[];$(Array.isArray(n)?n:[])}catch(Pr){$([])}finally{te(!1)}})()},[be,X]),(0,o.useEffect)(()=>{J([]),Q(!1)},[null===b||void 0===b?void 0:b.id]);const gt=()=>{const e=de.trim();e&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&(me(t=>[...t,e]),ue(""))},vt=async()=>{if(oe&&(0!==le.length||0!==he.length)){h(!0);try{var e,t;await(async(e,t,n,a)=>{try{const{activitiesService:e}=await Promise.resolve().then(r.bind(r,4505));JSON.parse(localStorage.getItem("user")||"{}"),a&&(console.log("\ud83d\udd04 Invalidating activities cache..."),a.invalidateQueries({queryKey:["activities"]}),a.invalidateQueries({queryKey:["activities","recent",50]}),a.refetchQueries({queryKey:["activities","recent",50]}))}catch(s){throw console.error("Error creating system message:",s),s}})(0,0,0,s);const n=await Da.bubblesService.completeAction(oe,le,he),a={id:Date.now(),type:"assistant",content:(null===(e=n.data)||void 0===e||null===(t=e.response)||void 0===t?void 0:t.content)||"Message sent successfully!",timestamp:new Date};l(e=>[a,...e]),ie(null),ce([]),me([]),ue(""),setTimeout(bt,0)}catch(n){const e={id:Date.now(),type:"assistant",content:"Failed to complete the action. Please try again.",timestamp:new Date,isError:!0};l(t=>[e,...t])}finally{h(!1)}}},xt=()=>{ie(null),ce([]),me([]),ue(""),l(e=>e.map(e=>e.requiresRecipientSelection?(0,Y.A)((0,Y.A)({},e),{},{requiresRecipientSelection:!1}):e));const e={id:Date.now(),type:"assistant",content:"Action cancelled. How else can I help you?",timestamp:new Date};l(t=>[e,...t])},bt=()=>{T.current&&(T.current.scrollTop=0)},yt=()=>"ai_assistant_chat_history_".concat((null===b||void 0===b?void 0:b.id)||"general");(0,o.useEffect)(()=>{(()=>{try{const e=localStorage.getItem(yt());if(e){const t=JSON.parse(e);p(t||[])}}catch(e){console.error("Failed to load chat history:",e),p([])}})()},[null===b||void 0===b?void 0:b.id]),(0,o.useEffect)(()=>{if(i.length>0&&!u){const e=setTimeout(()=>{(()=>{if(0!==i.length)try{var e;const t=i.filter(e=>"user"===e.type);if(0===t.length)return;const r=t[0],n=String(null!==(e=null===r||void 0===r?void 0:r.content)&&void 0!==e?e:""),a=n.slice(0,60)+(n.length>60?"...":""),s={id:v||"chat_".concat(Date.now()),messages:i.length>0?[...i]:[],title:a.length>0?a:"No title",timestamp:(new Date).toISOString(),projectId:(null===b||void 0===b?void 0:b.id)||null,projectName:(null===b||void 0===b?void 0:b.projectName)||(null===b||void 0===b?void 0:b.name)||null},o=localStorage.getItem(yt());let l=[];o&&(l=JSON.parse(o)),l=l.filter(e=>e.id!==s.id),l.unshift(s),l=l.slice(0,50),localStorage.setItem(yt(),JSON.stringify(l)),p(l),x(s.id)}catch(t){console.error("Failed to save chat:",t)}})()},1e3);return()=>clearTimeout(e)}},[i,u]);const wt=()=>{var e,t;if(0===Ve.length)return null;const r=Je.current&&Ye.current?Math.round((Ye.current-Je.current)/1e3):0;return{title:"Voice Conversation Summary",duration:"".concat(Math.floor(r/60),"m ").concat(r%60,"s"),startTime:(null===(e=Je.current)||void 0===e?void 0:e.toLocaleTimeString())||"Unknown",endTime:(null===(t=Ye.current)||void 0===t?void 0:t.toLocaleTimeString())||"Unknown",exchanges:Ve.map(e=>({speaker:e.speaker,message:e.message,timestamp:e.timestamp})),actions:Ge.length>0?Ge:["No specific actions were taken during this conversation"],keyPoints:jt(Ve),projectContext:b?{id:b.id,name:b.projectName||b.name}:null}},jt=e=>{const t=[],r=e.filter(e=>"user"===e.speaker&&e.message.includes("?")).map(e=>"Question: ".concat(e.message)),n=e.filter(e=>e.message.toLowerCase().includes("task")||e.message.toLowerCase().includes("issue")||e.message.toLowerCase().includes("problem")).map(e=>"".concat("user"===e.speaker?"User mentioned":"AI addressed",": ").concat(e.message.slice(0,100),"..."));return t.push(...r.slice(0,3)),t.push(...n.slice(0,2)),0===t.length&&t.push("General conversation about project status"),t},Nt=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var r,n,a;const c=b?{name:b.projectName||b.name,number:b.projectNumber,address:b.address||(null===(r=b.customer)||void 0===r?void 0:r.address)}:null,d=t||Ve;try{var s,o;const t=await fetch("/api/transcripts/enhance",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({fullTranscript:d.map(e=>({timestamp:e.timestamp||new Date,speaker:e.speaker||"User",message:e.message,confidence:e.confidence||"high"})),metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(s=Je.current)||void 0===s?void 0:s.toLocaleTimeString())||"Unknown"," - ").concat((null===(o=Ye.current)||void 0===o?void 0:o.toLocaleTimeString())||"Unknown"),duration:(null===e||void 0===e?void 0:e.duration)||"Unknown",participantCount:d.length>0?new Set(d.map(e=>e.speaker)).size:1},projectInfo:c})});if(t.ok){var i;const e=await t.json();if(e.success&&null!==(i=e.data)&&void 0!==i&&i.summary)return console.log("[Vapi] Successfully generated GPT-4o enhanced summary"),e.data.transcriptId&&ut(e.data.transcriptId),e.data.summary}}catch(l){console.error("[Vapi] Error getting AI-enhanced summary:",l)}console.log("[Vapi] Using fallback local extraction");const u={metadata:{callDate:(new Date).toLocaleDateString(),callTime:"".concat((null===(n=Je.current)||void 0===n?void 0:n.toLocaleTimeString())||"Unknown"," - ").concat((null===(a=Ye.current)||void 0===a?void 0:a.toLocaleTimeString())||"Unknown"),duration:(null===e||void 0===e?void 0:e.duration)||"Unknown",project:c,participantCount:d.length>0?new Set(d.map(e=>e.speaker)).size:1},executiveSummary:await St(d),keyDecisions:At(d),actionItems:Et(d),materialsList:Pt(d),risks:It(d),fullTranscript:d.map(e=>({timestamp:e.timestamp||new Date,speaker:e.speaker||"User",message:e.message,confidence:e.confidence||"high"})),actions:Ge};return u}catch(c){return console.error("Error generating enhanced summary:",c),null}},St=async e=>{if(!e||0===e.length)return"No conversation recorded.";const t=e.map(e=>e.message).join(" ");return t.length>200?"Discussion covered project status, materials, and timeline. Key topics included: ".concat(t.substring(0,200),"..."):t},At=e=>{const t=[];return e.forEach(e=>{const r=e.message.toLowerCase();(r.includes("approved")||r.includes("decided")||r.includes("agreed"))&&t.push({decision:e.message,timestamp:e.timestamp||new Date,speaker:e.speaker})}),t},Et=e=>{const t=[];return e.forEach(e=>{const r=e.message.toLowerCase();(r.includes("need to")||r.includes("will")||r.includes("schedule")||r.includes("order"))&&t.push({action:e.message,assignee:"User"===e.speaker?"Customer":"Team",dueDate:null,priority:"medium"})}),t},Pt=e=>{const t=[];return e.forEach(e=>{const r=e.message.toLowerCase();["shingles","lumber","nails","tar","flashing","gutters","materials"].forEach(n=>{r.includes(n)&&t.push({material:n,mentioned:e.message,timestamp:e.timestamp||new Date})})}),t},It=e=>{const t=[];return e.forEach(e=>{const r=e.message.toLowerCase();(r.includes("problem")||r.includes("issue")||r.includes("concern")||r.includes("delay"))&&t.push({risk:e.message,severity:"medium",timestamp:e.timestamp||new Date,status:"open"})}),t},Tt=(e,t,r)=>{const n=new Blob([r],{type:t}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},Lt=()=>{try{var e,t,r,n;const a=new np,s=(new Date).toISOString().split("T")[0],o=a.internal.pageSize.getWidth(),i=a.internal.pageSize.getHeight(),l=20,c=o-2*l;let d=l;const u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.setFontSize(t),a.setFont("helvetica",r?"bold":"normal");a.splitTextToSize(String(e||""),c).forEach(e=>{d>i-l&&(a.addPage(),d=l),a.text(e,l,d),d+=.5*t}),d+=5};a.setFontSize(18),a.setFont("helvetica","bold"),a.text("Voice Call Transcript & Summary",l,d),d+=15,a.setFontSize(10),a.setFont("helvetica","normal"),a.text("Date: ".concat((null===et||void 0===et||null===(e=et.metadata)||void 0===e?void 0:e.callDate)||s),l,d),d+=6,a.text("Duration: ".concat((null===et||void 0===et||null===(t=et.metadata)||void 0===t?void 0:t.duration)||"Unknown"),l,d),d+=6,null!==et&&void 0!==et&&null!==(r=et.metadata)&&void 0!==r&&null!==(n=r.project)&&void 0!==n&&n.name&&(a.text("Project: ".concat(et.metadata.project.name),l,d),d+=6),d+=10,null!==et&&void 0!==et&&et.executiveSummary&&(u("Executive Summary",14,!0),u(et.executiveSummary,10,!1),d+=5),u("Full Transcript",14,!0),null!==et&&void 0!==et&&et.fullTranscript&&et.fullTranscript.length>0?et.fullTranscript.forEach(e=>{const t=new Date(e.timestamp).toLocaleTimeString(),r=ft(e.speaker),n="[".concat(t,"] ").concat(r,": ").concat(e.message);u(n,9,!1)}):u("No transcript available.",10,!1),null!==et&&void 0!==et&&et.actionItems&&et.actionItems.length>0&&(d+=10,u("Action Items",14,!0),et.actionItems.forEach((e,t)=>{u("".concat(t+1,". ").concat(e.action||e),10,!1)})),a.save("transcript_".concat(s,".pdf")),console.log("Client-side PDF generated successfully")}catch(s){var a;console.error("Error generating client PDF:",s);const e=(null===et||void 0===et||null===(a=et.fullTranscript)||void 0===a?void 0:a.map(e=>"[".concat(new Date(e.timestamp).toLocaleTimeString(),"] ").concat(ft(e.speaker),": ").concat(e.message)).join("\n"))||"Transcript generation failed";Tt("transcript_"+(new Date).toISOString().split("T")[0]+".txt","text/plain",e)}},Dt=()=>{const e=(new Date).toISOString().split("T")[0];rt.includes("json")&&Tt("transcript_"+e+".json","application/json",JSON.stringify(et,null,2));const t=()=>{var e,t;const r=[];return r.push("Voice Call Transcript & Summary"),r.push("Date: "+((null===et||void 0===et||null===(e=et.metadata)||void 0===e?void 0:e.callDate)||"")),r.push("Duration: "+((null===et||void 0===et||null===(t=et.metadata)||void 0===t?void 0:t.duration)||"")),r.push(""),r.push("Executive Summary:"),r.push(String((null===et||void 0===et?void 0:et.executiveSummary)||"")),r.push(""),r.push("Full Transcript:"),((null===et||void 0===et?void 0:et.fullTranscript)||[]).forEach(e=>{const t=new Date(e.timestamp).toLocaleTimeString(),n=ft(e.speaker);r.push("["+t+"] "+n+": "+e.message)}),r.join("\n")};rt.includes("txt")&&Tt("transcript_"+e+".txt","text/plain",t()),rt.includes("pdf")&&fetch("/api/transcripts/generate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"")},body:JSON.stringify({summary:et,formats:["pdf"],projectId:null===b||void 0===b?void 0:b.id,sessionId:"voice_".concat(Date.now())})}).then(e=>e.ok?e.json():null).then(t=>{var r,n;if(null!==t&&void 0!==t&&t.success&&null!==t&&void 0!==t&&null!==(r=t.data)&&void 0!==r&&null!==(n=r.downloadLinks)&&void 0!==n&&n.pdf){const r=document.createElement("a");r.href=t.data.downloadLinks.pdf,r.download="transcript_".concat(e,".pdf"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}else console.warn("PDF generation not available from server, generating client-side PDF"),Lt()}).catch(e=>{console.error("PDF generation failed:",e),Lt()}),rt.includes("docx")&&Tt("transcript_"+e+".docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document",t())},Mt=()=>{$e(!1),tt(null),it(null),nt(["pdf","json"])},Ot=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&e.preventDefault();const r=t||c;if(!r.trim())return;const n={id:Date.now(),type:"user",content:r,timestamp:new Date};l(e=>[n,...e]),setTimeout(bt,0),d(""),h(!0);try{var a,s;const e={};K.length>0&&(e.selectedRecipientIds=K);const t=await Da.bubblesService.chat(r,null===b||void 0===b?void 0:b.id,e);if(null!==(a=t.data)&&void 0!==a&&null!==(s=a.response)&&void 0!==s&&s.requiresRecipientSelection){const e={id:Date.now()+1,type:"assistant",content:t.data.response.content,timestamp:new Date,requiresRecipientSelection:!0,availableRecipients:t.data.response.availableRecipients||[],pendingAction:t.data.response.pendingAction};ie(t.data.response.pendingAction),$(t.data.response.availableRecipients||[]),ce([]),Me(!1),l(t=>{const[r,...n]=t;return[r,e,...n]}),setTimeout(bt,0)}else{var o,i,u,m;const e={id:Date.now()+1,type:"assistant",content:(null===(o=t.data)||void 0===o||null===(i=o.response)||void 0===i?void 0:i.content)||"I processed your request.",timestamp:new Date,suggestedActions:(null===(u=t.data)||void 0===u||null===(m=u.response)||void 0===m?void 0:m.suggestedActions)||[]};l(t=>{const[r,...n]=t;return[r,e,...n]}),setTimeout(bt,0)}}catch(p){const e={id:Date.now()+1,type:"assistant",content:"I'm having trouble connecting to my systems right now. Please try again in a moment.",timestamp:new Date,isError:!0};l(t=>{const[r,...n]=t;return[r,e,...n]})}finally{h(!1)}},Rt=e=>{var t;let{message:r}=e;const n="assistant"===r.type,a=r.isError,s=(r.isContextMessage,r.isVoiceMessage);return(0,kt.jsx)("div",{className:"w-full",children:(0,kt.jsxs)("div",{className:"rounded-xl px-4 py-3 border ".concat(s?"bg-blue-50 border-blue-200 text-blue-900":n?a?"bg-red-50 border-red-200 text-red-800":"bg-[#f7f7f8] border-gray-200 text-gray-900":"bg-white border-gray-200 text-gray-900"),children:[(0,kt.jsx)("div",{className:"prose prose-sm max-w-none",style:{fontSize:"10px",lineHeight:"14px"},dangerouslySetInnerHTML:{__html:pt(n?r.content:String(null!==(t=r.content)&&void 0!==t?t:""))}}),r.requiresRecipientSelection&&r.availableRecipients&&(0,kt.jsxs)("div",{className:"mt-4 p-3 bg-white border border-blue-300 rounded-lg",children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Select Recipients:"}),(0,kt.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-1 mb-3",children:r.availableRecipients.map(e=>(0,kt.jsxs)("label",{className:"flex items-center gap-2 text-sm py-1 px-2 hover:bg-blue-50 rounded cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:le.includes(e.id),onChange:()=>{var t;(t=e.id)&&ce(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"rounded border-gray-300"}),(0,kt.jsx)("span",{className:"text-gray-800",children:e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.email||e.id}),e.role&&(0,kt.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.role,")"]})]},e.id))}),("send_document_email"===(null===oe||void 0===oe?void 0:oe.type)||"send_email"===(null===oe||void 0===oe?void 0:oe.type))&&(0,kt.jsxs)("div",{className:"mb-3 border-t pt-3",children:[(0,kt.jsx)("h5",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Or add custom email address:"}),(0,kt.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,kt.jsx)("input",{type:"email",value:de,onChange:e=>{e.stopPropagation(),ue(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),gt())},onFocus:e=>e.stopPropagation(),placeholder:"email@example.com",className:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),gt()},type:"button",className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"Add"})]}),he.length>0&&(0,kt.jsx)("div",{className:"flex flex-wrap gap-2",children:he.map((e,t)=>(0,kt.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-md",children:[e,(0,kt.jsx)("button",{onClick:()=>(e=>{me(t=>t.filter(t=>t!==e))})(e),className:"text-blue-600 hover:text-blue-800",children:"\xd7"})]},t))})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsxs)("button",{onClick:vt,disabled:0===le.length&&0===he.length,className:"px-4 py-2 text-sm rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:["Send to ",le.length+he.length," recipient",le.length+he.length!==1?"s":""]}),(0,kt.jsx)("button",{onClick:xt,className:"px-4 py-2 text-sm rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 transition-colors",children:"Cancel"})]})]}),r.suggestedActions&&r.suggestedActions.length>0&&(0,kt.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:r.suggestedActions.map((e,t)=>(0,kt.jsx)("button",{onClick:()=>Ot(null,e.label||e.action),className:"px-3 py-1 text-xs rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 transition-colors",children:e.label||e.action},t))}),(0,kt.jsx)("div",{className:"text-xs mt-2 text-gray-400",children:r.timestamp instanceof Date?r.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(r.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})};return(0,kt.jsx)("div",{ref:R,className:"ai-assistant-container min-h-0 flex flex-row bg-white rounded-lg shadow-sm overflow-hidden relative",style:{height:"100vh"},children:(0,kt.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,kt.jsx)("style",{children:'\n                .ai-assistant-container {\n                    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";\n                }\n                .prose strong {\n                    font-weight: 600;\n                    color: #1f2937;\n                }\n                .prose li {\n                    margin-bottom: 0.25rem;\n                    padding-left: 0.5rem;\n                }\n                .prose p {\n                    margin-bottom: 0.5rem;\n                    line-height: 1.6;\n                }\n                .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {\n                    margin-top: 1rem;\n                    margin-bottom: 0.75rem;\n                    font-weight: 600;\n                    color: #1f2937;\n                }\n            '}),(0,kt.jsx)("div",{ref:L,className:"flex-shrink-0 p-3 border-b border-gray-200 bg-[#F8FAFC] relative",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,kt.jsx)("div",{className:"flex-1 max-w-2xl relative",children:(0,kt.jsx)(ll,{projects:t,selectedProject:b,onProjectSelect:e=>{console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\x8d AIAssistantPage: onProjectSelect called with:",e),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\x8d AIAssistantPage: Current selectedProject before:",b),y(e),console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8|\xe2\u201a\xac\xc2\x9d|\xc2\x8d AIAssistantPage: setSelectedProject called with:",e),S(e=>e+1),A(!1),E("")},onProjectNavigate:async(e,t)=>{try{if(!e||!a)return;if("Project Workflow"===t){try{console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Navigating to workflow for project:",e.projectName||e.name);const t=e.currentWorkflowItem||{},r=t.phase||"LEAD",n=t.section||"Unknown Section",s=t.lineItem||"Unknown Item";console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Current workflow state:",{phase:r,section:n,lineItem:s});const o=e.id||e._id,i=await fetch("/api/workflow-data/project-position/".concat(o),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(i.ok){const t=await i.json();if(t.success&&t.data){const o=t.data;console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Project position data:",o);const i=o.currentLineItemId||o.currentLineItem||"".concat(r,"-").concat(n,"-0"),l=o.currentSectionId||o.currentSection||n.toLowerCase().replace(/\s+/g,"-");console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Target IDs:",{targetLineItemId:i,targetSectionId:l});const c=(0,Y.A)((0,Y.A)({},e),{},{highlightStep:s,highlightLineItem:s,targetPhase:r,targetSection:n,targetLineItem:s,scrollToCurrentLineItem:!0,navigationTarget:{phase:r,section:n,lineItem:s,stepName:s,lineItemId:i,workflowId:o.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(i),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:l,expandPhase:!0,expandSection:!0}});return void a(c,"Project Workflow",null,"AI Assistant",i,l)}}console.log("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Could not get position data, using fallback navigation")}catch(r){console.error("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Error enhancing workflow navigation:",r)}a(e,"Project Workflow",null,"AI Assistant")}else a(e,"Alerts"===t?"Alerts":"Messages"===t?"Project Messages":"Project Profile",null,"AI Assistant")}catch(r){console.error("\xc3\u0192\xc2\xb0\xc3\u2026\xc2\xb8\xc3\u2026\xc2\xbd|\xc2\xaf AI ASSISTANT: Error in project navigation:",r),a(e,t||"Project Profile",null,"AI Assistant")}},colorMode:n,placeholder:"Select Project"})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("button",{onClick:()=>Me(!De),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-md ".concat(De?"bg-[#6BC22E] text-white hover:bg-[#5AB01D]":"bg-[#7ED242] text-white hover:bg-[#6BC22E]"),title:"Show available documents",children:[(0,kt.jsx)(hn,{className:"w-4 h-4"}),(0,kt.jsx)("span",{className:"hidden md:inline",children:"Documents"})]}),(0,kt.jsxs)("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-white transition-all shadow-md bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700",title:"Bubbles Assistant Playbook",children:[(0,kt.jsx)(Yr,{className:"w-4 h-4"}),(0,kt.jsx)("span",{className:"hidden md:inline",children:"Assistant Playbook"}),(0,kt.jsx)("span",{className:"md:hidden",children:"Playbook"})]}),(0,kt.jsxs)("button",{onClick:()=>{l([]),x(null)},className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors",title:"Clear the current chat",children:[(0,kt.jsx)(wn,{className:"w-3.5 h-3.5"}),"Clear Chat"]})]})]})}),(0,kt.jsx)("div",{ref:D,className:"flex-shrink-0 p-1 px-3 md:px-4 border-b border-gray-200 bg-gray-50",children:(0,kt.jsxs)("form",{onSubmit:Ot,className:"w-full max-w-2xl flex items-center gap-1",children:[(0,kt.jsx)("textarea",{ref:M,value:c,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Ot(e))},placeholder:b?"Ask about ".concat(b.projectName||b.name,"..."):"Send a message...",rows:3,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm resize-none"}),(0,kt.jsx)("button",{type:"submit",disabled:u||!c.trim(),className:"px-3 py-1 rounded-lg flex items-center justify-center gap-2 font-semibold transition-all shadow-sm ".concat(u||!c.trim()?"bg-gray-300 cursor-not-allowed text-gray-500":"bg-black hover:bg-gray-900 text-white"),children:u?(0,kt.jsx)("span",{className:"text-xs md:text-sm",children:"Processing..."}):(0,kt.jsx)("span",{className:"text-xs md:text-sm",children:"Send"})}),(0,kt.jsx)("button",{type:"button",onClick:async()=>{try{console.log("[Vapi] mic clicked")}catch(Pr){}ke("");const e=pe.current;if(e)if("function"===typeof e.start&&"function"===typeof e.stop)try{if(ve||fe)return console.log("[Vapi] Stopping call..."),void await e.stop();try{await navigator.mediaDevices.getUserMedia({audio:!0}),console.log("[Vapi] Microphone permission granted")}catch(t){return console.error("[Vapi] Microphone permission denied:",t),void ke("Microphone permission required for voice chat.")}ge(!0),ke("");let r=null;try{const e=localStorage.getItem("user")||localStorage.getItem("currentUser");if(e){const t=JSON.parse(e);r=t.id||t.userId||null}}catch(Pr){}const n={};null!==b&&void 0!==b&&b.id?(n.variableValues={projectId:b.id,projectName:b.projectName||b.name||"Current Project",userId:r},console.log("[Vapi] Adding project and user context:",n)):r&&(n.variableValues={userId:r},console.log("[Vapi] Adding user context:",n)),console.log("[Vapi] Starting call with assistant ID:",mt),Object.keys(n).length>0?await e.start(mt,n):await e.start(mt)}catch(_t){ge(!1),xe(!1);const t=String((null===_t||void 0===_t?void 0:_t.message)||_t||"Voice start failed");ke(t),console.error("[Vapi] start error:",_t)}else ke("Voice SDK not properly loaded.");else ke("Voice not initialized. Please refresh the page.")},className:"ml-1 p-[6px] rounded-full border flex items-center justify-center transition ".concat(ve?"border-blue-600 bg-blue-50 shadow-glow":"border-gray-300 bg-white hover:bg-gray-100"),"aria-label":ve?"End voice with Bubbles":fe?"Connecting to Bubbles":"Speak to Bubbles",title:ve?"End voice":fe?"Connecting\xc3\u0192\xc2\xa2|\xe2\u20ac\u0161\xc2\xac|\xc2\xa6":"Speak to Bubbles",children:fe?(0,kt.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"animate-spin","aria-hidden":"true",children:[(0,kt.jsx)("circle",{cx:"12",cy:"12",r:"9",stroke:"#93c5fd",strokeWidth:"3",opacity:"0.35"}),(0,kt.jsx)("path",{d:"M21 12a9 9 0 00-9-9",stroke:"#2563eb",strokeWidth:"3",strokeLinecap:"round"})]}):(0,kt.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",className:ve?"animate-pulse":"",children:[(0,kt.jsx)("path",{d:"M9 5a3 3 0 016 0v6a3 3 0 11-6 0V5z",fill:ve?"#2563eb":"#111827"}),(0,kt.jsx)("path",{d:"M5 12a7 7 0 0014 0M12 19v-3",stroke:ve?"#2563eb":"#111827",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,kt.jsx)("button",{type:"button",onClick:()=>ct(!0),className:"ml-1 p-[6px] rounded-full border border-gray-300 bg-white hover:bg-gray-100 flex items-center justify-center","aria-label":"View transcript history",title:"Transcript History",children:(0,kt.jsx)(Kr,{className:"w-[18px] h-[18px] text-gray-700"})}),(0,kt.jsx)("a",{href:"tel:+17243812859",className:"ml-1 p-[6px] rounded-full border border-gray-300 bg-white hover:bg-gray-100 flex items-center justify-center","aria-label":"Call +17243812859",title:"+17243812859",children:(0,kt.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,kt.jsx)("path",{d:"M2.5 6.75C2.5 5.78 3.28 5 4.25 5h2.2c.72 0 1.35.47 1.54 1.16l.8 2.82c.18.65-.07 1.35-.63 1.73l-1.24.85c1.14 2.1 2.95 3.92 5.05 5.05l.85-1.24c.38-.56 1.08-.81 1.73-.63l2.82.8c.69.2 1.16.82 1.16 1.54v2.2c0 .97-.78 1.75-1.75 1.75h-1.5C8.49 21.99 2 15.51 2 7.25v-1.5z",fill:"#111827"})})})]})}),f&&(0,kt.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-20 bg-white",children:(0,kt.jsxs)("div",{className:"flex flex-col h-full",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 p-4 border-b border-gray-200 bg-gray-50",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("button",{onClick:()=>g(!1),className:"p-2 rounded-lg hover:bg-gray-100 flex items-center gap-1",children:[(0,kt.jsx)(nn,{className:"w-4 h-4"}),(0,kt.jsx)("span",{children:"Back"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"font-bold text-lg",children:"Chat History"}),(0,kt.jsxs)("p",{className:"text-sm text-gray-600",children:[m.length," saved conversations"]})]})]}),(0,kt.jsx)("button",{onClick:()=>{l([]),x(null),g(!1)},className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-blue-500 hover:bg-[var(--color-primary-blueprint-blue)] text-white",children:"New Chat"})]})}),(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===m.length?(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[(0,kt.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,kt.jsx)(an,{className:"w-8 h-8 text-gray-400"})}),(0,kt.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"No saved chats yet"}),(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Your conversations will appear here automatically"})]}):m.map(e=>{const t=v===e.id,r=new Date(e.timestamp),n=new Date,a=Math.floor((n-r)/864e5);let s;return s=0===a?"Today":1===a?"Yesterday":a<7?"".concat(a," days ago"):r.toLocaleDateString(),(0,kt.jsx)("div",{className:"group p-4 rounded-lg cursor-pointer transition-all border ".concat(t?"bg-blue-50 border-blue-200":"hover:bg-gray-50 border-gray-200"),onClick:()=>{l(e.messages),x(e.id),g(!1)},children:(0,kt.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("h4",{className:"font-medium text-sm truncate mb-1 text-gray-900",children:e.title}),(0,kt.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:s}),e.projectName&&(0,kt.jsxs)("p",{className:"text-xs text-gray-500 truncate inline-flex items-center gap-1",children:[(0,kt.jsx)(hn,{className:"w-4 h-4"})," ",e.projectName]})]}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),p(t=>t.filter(t=>t.id!==e.id)),v===e.id&&(l([]),x(null))},className:"p-1.5 rounded-md hover:bg-red-100 text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete chat",children:(0,kt.jsx)(wn,{className:"w-4 h-4"})})]})},e.id)})})]})}),X&&(0,kt.jsxs)("div",{className:"w-full border-t border-b border-blue-200 bg-blue-50 px-4 py-3",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-blue-900",children:"Select recipients"}),(0,kt.jsx)("p",{className:"text-xs text-blue-700",children:"Chosen teammates will receive document shares initiated in this chat."})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>J([]),className:"text-xs px-2 py-1 rounded-md border border-blue-300 text-blue-700 hover:bg-blue-100",children:"Clear"}),(0,kt.jsx)("button",{onClick:()=>Q(!1),className:"text-xs px-2 py-1 rounded-md border border-blue-300 text-blue-700 hover:bg-blue-100",children:"Close"})]})]}),(0,kt.jsx)("div",{className:"max-h-40 overflow-y-auto bg-white border border-blue-200 rounded-lg p-3 shadow-sm",children:ee?(0,kt.jsx)("div",{className:"text-sm text-blue-700",children:"Loading team members..."}):0===(Z||[]).length?(0,kt.jsx)("div",{className:"text-sm text-blue-700",children:"No team members available."}):Z.map(e=>{const t=e.id||e.userId,r=e.firstName?"".concat(e.firstName," ").concat(e.lastName||"").trim():e.name||e.email||t;return(0,kt.jsxs)("label",{className:"flex items-center gap-2 text-sm py-1",children:[(0,kt.jsx)("input",{type:"checkbox",checked:K.includes(t),onChange:()=>{var e;(e=t)&&J(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])}}),(0,kt.jsx)("span",{children:r})]},t)})}),K.length>0&&(0,kt.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:K.map(e=>{const t=(Z||[]).find(t=>(t.id||t.userId)===e),r=t?t.firstName?"".concat(t.firstName," ").concat(t.lastName||"").trim():t.name||t.email||e:e;return(0,kt.jsx)("span",{className:"inline-flex items-center gap-1 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:r},e)})})]}),De&&(0,kt.jsxs)("div",{className:"w-80 border-l border-gray-200 bg-white flex flex-col shadow-xl z-30",children:[(0,kt.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-800",children:"Available Documents"}),(0,kt.jsx)("button",{onClick:()=>Me(!1),className:"p-1 hover:bg-gray-200 rounded text-gray-500 hover:text-gray-700",title:"Close",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsx)("input",{type:"text",placeholder:"Search documents...",value:Be,onChange:e=>ze(e.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto p-3",children:Fe?(0,kt.jsx)("div",{className:"text-center py-8 text-gray-500 text-sm",children:(0,kt.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"}),"Loading documents..."]})}):0===Oe.length?(0,kt.jsx)("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No documents found"}):(0,kt.jsx)("div",{className:"space-y-2",children:Oe.filter(e=>{const t=e.filename||e.name||e.title||"";return!Be||t.toLowerCase().includes(Be.toLowerCase())}).map(e=>{const t=e.filename||e.name||e.title||"Untitled";return(0,kt.jsx)("div",{className:"p-3 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer group",onClick:()=>{const e=c+(c?" ":"")+'"'.concat(t,'"');d(e),setTimeout(()=>{if(M.current){M.current.focus();const t=e.length;M.current.setSelectionRange(t,t)}},0)},title:'Click to insert "'.concat(t,'" into message'),children:(0,kt.jsxs)("div",{className:"flex items-start gap-2",children:[(0,kt.jsx)(Kr,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate group-hover:text-blue-600",children:t}),e.fileSize&&(0,kt.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[(e.fileSize/1024).toFixed(0)," KB"]})]})]})},e.id)})})})]}),(0,kt.jsx)("div",{className:"messages-container flex-1 min-h-0 overflow-hidden",children:(0,kt.jsx)("div",{ref:T,className:"w-full h-full overflow-y-auto custom-scrollbar px-3 md:px-4 py-2",children:(0,kt.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(ve||fe)&&(0,kt.jsx)("div",{className:"flex items-center gap-2 text-sm text-blue-700 bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,kt.jsxs)("span",{className:"inline-flex items-center gap-2 font-medium",children:[(0,kt.jsx)("span",{className:"w-2 h-2 rounded-full bg-[var(--color-primary-blueprint-blue)] animate-pulse"}),fe?"Connecting to voice...":"Listening - speak now"]})}),_e&&(Ve.length>0||Te)&&(0,kt.jsx)("div",{className:"w-full flex justify-center",children:(0,kt.jsxs)("div",{className:"w-full max-w-3xl rounded-xl px-5 py-4 border bg-white border-gray-200 shadow-md",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-gray-100",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"}),(0,kt.jsx)("span",{className:"text-sm font-bold text-gray-900 uppercase tracking-wide",children:"Live Transcript"})]}),(0,kt.jsxs)("span",{className:"text-xs font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded",children:[Ve.length," exchanges"]})]}),(0,kt.jsxs)("div",{ref:F,className:"overflow-y-auto overflow-x-hidden h-56 md:h-72 space-y-4",style:{scrollbarWidth:"thin"},role:"log","aria-live":"polite",children:[Ve.map((e,t)=>{const r="Bubbles"===e.speaker||"Bubbles AI"===e.speaker||"assistant"===e.speaker||"Assistant"===e.speaker,n=r?"Bubbles AI":e.speaker||We||"You";return(0,kt.jsxs)("div",{className:"flex gap-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 w-20 text-right ".concat(r?"text-blue-600":"text-gray-700"),children:(0,kt.jsx)("span",{className:"text-xs font-bold uppercase tracking-wide",children:n})}),(0,kt.jsx)("div",{className:"flex-1 text-sm text-gray-800 leading-relaxed",children:Ne(e.message||"")})]},t)}),Te&&(()=>{const e=Ne(Te||"").trim(),t=Ve[Ve.length-1],r=t?Ne(t.message||"").trim():"";return!e||e===r||r.includes(e)?null:(0,kt.jsxs)("div",{className:"flex gap-3 opacity-70",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 w-20 text-right text-gray-500",children:(0,kt.jsx)("span",{className:"text-xs font-bold uppercase tracking-wide",children:We||"You"})}),(0,kt.jsxs)("div",{className:"flex-1 text-sm text-gray-600 leading-relaxed italic",children:[e,(0,kt.jsx)("span",{className:"animate-pulse",children:"..."})]})]})})(),0===Ve.length&&!Te&&(0,kt.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400 text-sm",children:(0,kt.jsx)("span",{children:"Listening..."})})]})]})}),i.filter(e=>!e.isContextMessage).map(e=>(0,kt.jsx)(Rt,{message:e},e.id)),u&&(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsx)("div",{className:"bg-[#f7f7f8] border border-gray-200 rounded-xl px-5 py-3",children:(0,kt.jsxs)("div",{className:"flex space-x-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,kt.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,kt.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),(0,kt.jsx)("div",{ref:I})]})})}),be&&(0,kt.jsxs)("div",{ref:O,className:"p-4 border-t border-gray-200 bg-white",children:[(0,kt.jsxs)("div",{className:"mb-2 text-sm font-semibold flex items-center gap-2",children:[(0,kt.jsx)(an,{className:"w-4 h-4"})," Send Project Message"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"text-xs block mb-1",children:"Subject"}),(0,kt.jsx)("select",{value:q,onChange:e=>V(e.target.value),className:"w-full text-sm rounded-md border px-2 py-2",children:(W||[]).map(e=>(0,kt.jsx)("option",{value:e,children:e},e))})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"text-xs block mb-1",children:"Recipients"}),(0,kt.jsxs)("div",{className:"max-h-24 overflow-auto rounded-md border p-2",children:[(Z||[]).map(e=>(0,kt.jsxs)("label",{className:"flex items-center gap-2 text-sm py-0.5",children:[(0,kt.jsx)("input",{type:"checkbox",checked:H.includes(e.id),onChange:()=>G(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])}),(0,kt.jsx)("span",{children:e.firstName?"".concat(e.firstName," ").concat(e.lastName||"").trim():e.name||e.email||e.id})]},e.id)),(!Z||0===Z.length)&&(0,kt.jsx)("div",{className:"text-xs opacity-70",children:"No team members listed."})]})]}),(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("label",{className:"text-xs block mb-1",children:"Message"}),(0,kt.jsx)("textarea",{value:re,onChange:e=>ne(e.target.value),rows:3,className:"w-full text-sm rounded-md border px-2 py-2 resize-none",placeholder:"Type your message..."})]}),(0,kt.jsxs)("div",{className:"md:col-span-2 flex items-center justify-end gap-2",children:[(0,kt.jsx)("button",{onClick:()=>ye(!1),className:"text-xs px-3 py-2 rounded-md border",children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(null!==b&&void 0!==b&&b.id&&q&&re.trim()){se(!0);try{await Da.projectMessagesService.create(b.id,{content:re.trim(),subject:q,priority:"MEDIUM",recipients:H});try{Array.isArray(H)&&H.length>0&&await Promise.all(H.map(e=>Qo.sendNotification({title:"New Project Message",message:q,type:"PROJECT_UPDATE",recipientId:e,actionData:{projectId:b.id}}).catch(()=>null)))}catch(Pr){}l(e=>[{id:"msg_".concat(Date.now()),type:"assistant",content:"Message sent in project: ".concat(q,"\n\n").concat(re.trim()),timestamp:new Date},...e]),ne(""),G([]),V((null===W||void 0===W?void 0:W[0])||"Project Status Update"),ye(!1)}catch(_t){l(e=>[{id:"msg_err_".concat(Date.now()),type:"error",content:"Failed to send message. Please try again.",timestamp:new Date},...e])}finally{se(!1)}}},disabled:ae||!re.trim(),className:"text-xs px-3 py-2 rounded-md text-white ".concat(ae||!re.trim()?"bg-gray-400":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700"),children:(0,kt.jsx)("span",{className:"font-semibold text-sm md:text-base",children:ae?"Sending...":"SEND"})})]})]})]}),console.log("[Transcript] render showTranscriptModal:",Ze,"transcriptSummary:",!!et),Ze&&et&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center pt-8",style:{zIndex:999999},children:(0,kt.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",style:{zIndex:999999},children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Voice Call Transcript & Summary"}),(0,kt.jsxs)("p",{className:"text-sm text-gray-600",children:[et.metadata.callDate," \xe2\u20ac\xa2 ",et.metadata.duration," \xe2\u20ac\xa2 ",et.metadata.participantCount," participant(s)"]})]})]}),(0,kt.jsx)("button",{onClick:Mt,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,kt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[et.metadata.project&&(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Project Information"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"font-medium",children:"Project:"})," ",et.metadata.project.name]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"font-medium",children:"Number:"})," #",et.metadata.project.number]}),et.metadata.project.address&&(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("span",{className:"font-medium",children:"Address:"})," ",et.metadata.project.address]})]})]}),(0,kt.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Executive Summary"}),(0,kt.jsx)("p",{className:"text-gray-800 leading-relaxed",children:et.executiveSummary})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[((null===et||void 0===et?void 0:et.keyDecisions)||[]).length>0&&(0,kt.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-green-900 mb-3",children:"Key Decisions & Approvals"}),(0,kt.jsx)("div",{className:"space-y-2",children:et.keyDecisions.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-green-200",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-800",children:e.decision}),(0,kt.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:[e.speaker," \xe2\u20ac\xa2 ",new Date(e.timestamp).toLocaleTimeString()]})]},t))})]}),((null===et||void 0===et?void 0:et.actionItems)||[]).length>0&&(0,kt.jsxs)("div",{className:"bg-orange-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-orange-900 mb-3",children:"Action Items"}),(0,kt.jsx)("div",{className:"space-y-2",children:et.actionItems.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-orange-200",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-800 font-medium",children:e.action}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-600",children:[(0,kt.jsxs)("span",{children:["Assignee: ",e.assignee]}),(0,kt.jsxs)("span",{className:"px-2 py-1 rounded ".concat("high"===e.priority?"bg-red-100 text-red-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[e.priority," priority"]})]})]},t))})]}),((null===et||void 0===et?void 0:et.materialsList)||[]).length>0&&(0,kt.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-purple-900 mb-3",children:"Materials Discussed"}),(0,kt.jsx)("div",{className:"space-y-2",children:et.materialsList.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-purple-200",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-800 font-medium",children:e.material}),(0,kt.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:['"',e.mentioned,'"']})]},t))})]}),((null===et||void 0===et?void 0:et.risks)||[]).length>0&&(0,kt.jsxs)("div",{className:"bg-red-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-red-900 mb-3",children:"Risks & Open Issues"}),(0,kt.jsx)("div",{className:"space-y-2",children:et.risks.map((e,t)=>(0,kt.jsxs)("div",{className:"bg-white p-3 rounded border border-red-200",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-800",children:e.risk}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,kt.jsxs)("span",{className:"px-2 py-1 rounded text-xs ".concat("high"===e.severity?"bg-red-100 text-red-800":"medium"===e.severity?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[e.severity," severity"]}),(0,kt.jsx)("span",{className:"text-xs text-gray-600",children:e.status})]})]},t))})]})]}),(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 relative",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Full Conversation Transcript"}),(0,kt.jsxs)("span",{className:"text-xs text-gray-500 bg-gray-200 px-2 py-0.5 rounded-full",children:[((null===et||void 0===et?void 0:et.fullTranscript)||[]).length," messages"]})]}),(0,kt.jsx)("button",{onClick:Mt,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded hover:bg-gray-200",title:"Close transcript",children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"space-y-3 max-h-72 overflow-y-auto pr-2",style:{scrollbarWidth:"thin"},children:[((null===et||void 0===et?void 0:et.fullTranscript)||[]).map((e,t)=>{const r=ft(e.speaker),n="Bubbles"===r||"Bubbles AI"===r||"Assistant"===r,a=e.timestamp?new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"";return(0,kt.jsx)("div",{className:"flex flex-col ".concat(n?"items-start":"items-end"),children:(0,kt.jsxs)("div",{className:"max-w-[85%] rounded-xl px-4 py-3 shadow-sm ".concat(n?"bg-[#F8FAFC] border border-blue-200":"bg-[#F8FAFC] border border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,kt.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ".concat(n?"bg-blue-500 text-white":"bg-gray-500 text-white"),children:n?"B":r.charAt(0).toUpperCase()||"U"}),(0,kt.jsx)("span",{className:"text-sm font-semibold ".concat(n?"text-blue-700":"text-gray-700"),children:r}),(0,kt.jsx)("span",{className:"text-xs text-gray-400",children:a}),e.confidence&&"high"!==e.confidence&&(0,kt.jsx)("span",{className:"text-xs px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded-full",children:e.confidence})]}),(0,kt.jsx)("p",{className:"text-sm text-gray-800 leading-relaxed",children:Ne(e.message)})]})},t)}),0===((null===et||void 0===et?void 0:et.fullTranscript)||[]).length&&(0,kt.jsx)("div",{className:"text-center text-gray-400 text-sm py-8",children:"No transcript data available"})]})]})]}),(0,kt.jsx)("div",{className:"border-t border-gray-200 p-6",children:(0,kt.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Select file formats:"}),(0,kt.jsx)("div",{className:"flex flex-wrap gap-2",children:[{id:"pdf",label:"PDF (Branded)"},{id:"json",label:"JSON (Structured)"},{id:"docx",label:"Word Document"},{id:"txt",label:"Plain Text"}].map(e=>(0,kt.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:rt.includes(e.id),onChange:()=>(e=>{nt(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,kt.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.id))})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("button",{onClick:Mt,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Close"}),(0,kt.jsx)("button",{onClick:async()=>{if(et&&0!==rt.length){st(!0);try{const e=await fetch("/api/transcripts/generate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")},body:JSON.stringify({summary:et,formats:rt,projectId:null===b||void 0===b?void 0:b.id,sessionId:"voice_".concat(Date.now()),useAI:!0})});if(e.ok){const t=await e.json();t.success&&t.data.downloadLinks?(it(t.data.downloadLinks),Object.entries(t.data.downloadLinks).forEach(e=>{let[t,r]=e;const n=document.createElement("a");n.href=r,n.download="transcript_".concat((new Date).toISOString().split("T")[0],".").concat(t),document.body.appendChild(n),n.click(),document.body.removeChild(n)})):Dt()}else Dt()}catch(e){console.error("Error generating transcript files:",e),Dt(),alert("Failed to generate transcript files. Please try again.")}finally{st(!1)}}},disabled:0===rt.length||at,className:"px-6 py-2 text-sm font-medium text-white rounded-lg transition-colors ".concat(0===rt.length||at?"bg-gray-400 cursor-not-allowed":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700"),children:at?(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):"Download Selected (".concat(rt.length,")")})]})]})})]})}),lt&&(0,kt.jsx)(cl,{projectId:null===b||void 0===b?void 0:b.id,onTranscriptSelect:e=>{try{var t,r;const n=null!==e&&void 0!==e&&e.date?new Date(e.date):new Date,a={metadata:{callDate:n.toLocaleDateString(),callTime:n.toLocaleTimeString(),duration:(null===e||void 0===e?void 0:e.duration)||"Unknown",participantCount:(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.participantCount)||2,project:b?{name:b.projectName||b.name,number:b.projectNumber,address:b.address||(null===(r=b.customer)||void 0===r?void 0:r.address)}:null},executiveSummary:(null===e||void 0===e?void 0:e.preview)||(null===e||void 0===e?void 0:e.title)||"",keyDecisions:[],actionItems:[],materialsList:[],risks:[],fullTranscript:(null===e||void 0===e?void 0:e.fullTranscript)||[],actions:[]};tt(a)}catch(Pr){tt({metadata:{callDate:"",callTime:"",duration:"",participantCount:"",project:null},executiveSummary:(null===e||void 0===e?void 0:e.title)||"",keyDecisions:[],actionItems:[],materialsList:[],risks:[],fullTranscript:[],actions:[]})}$e(!0),ct(!1)},onClose:()=>ct(!1)}),(0,kt.jsx)(ts,{visible:w,onClose:()=>j(!1),colorMode:n}),(0,kt.jsx)(ts,{visible:w,onClose:()=>j(!1),colorMode:n})]})})},Zf=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)(null),a=[{id:"safety-training",title:"Safety Training Simulator",description:"Interactive AI-powered safety training scenarios that adapt to user responses and provide personalized learning experiences.",icon:(0,kt.jsx)(dn,{className:"w-6 h-6 text-red-600"}),image:"/safety.jpg",category:"Safety",features:["Interactive Scenarios","Adaptive Learning","Risk Assessment","Certification Tracking"],color:"red"},{id:"equipment-training",title:"Equipment Operation Trainer",description:"Virtual reality and AI-driven training for heavy equipment operation, maintenance procedures, and safety protocols.",icon:(0,kt.jsx)(Xr,{className:"w-6 h-6 text-orange-600"}),image:"/equipment.jpg",category:"Equipment",features:["VR Simulations","Real-time Feedback","Skill Assessment","Maintenance Training"],color:"orange"},{id:"code-compliance",title:"Code Compliance Trainer",description:"AI-powered training system for building codes, regulations, and compliance requirements with interactive quizzes and scenarios.",icon:(0,kt.jsx)(sn,{className:"w-6 h-6 text-purple-600"}),image:"/compliance.jpg",category:"Compliance",features:["Code Updates","Interactive Quizzes","Scenario Training","Certification Prep"],color:"purple"},{id:"project-management",title:"Project Management Academy",description:"Comprehensive AI-driven training for project managers covering scheduling, budgeting, team leadership, and risk management.",icon:(0,kt.jsx)(en,{className:"w-6 h-6 text-green-600"}),image:"/pm.jpg",category:"Management",features:["Leadership Skills","Budget Management","Team Dynamics","Risk Mitigation"],color:"green"},{id:"quality-standards",title:"Quality Standards Trainer",description:"AI-powered training for quality control procedures, inspection protocols, and maintaining construction standards.",icon:(0,kt.jsx)(Yr,{className:"w-6 h-6 text-teal-600"}),image:"/quality.jpg",category:"Quality",features:["Inspection Training","Standard Procedures","Quality Metrics","Defect Recognition"],color:"teal"},{id:"estimating-mastery",title:"Estimating Mastery Program",description:"Comprehensive AI-powered training for construction estimating, including Xactimate, cost analysis, and bid preparation.",icon:(0,kt.jsx)(Kr,{className:"w-6 h-6 text-blue-600"}),image:"/estimating.jpg",category:"Estimation",features:["Xactimate Training","Cost Analysis","Bid Preparation","Market Research"],color:"blue"}],s=()=>{n(null)};return r?(0,kt.jsxs)("div",{className:"w-full max-w-5xl mx-auto px-2 py-2 ".concat(t?"bg-[#0f172a] text-white":"bg-white text-gray-800"),children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("button",{onClick:s,className:"flex items-center gap-2 text-sm font-medium mb-3 px-3 py-2 rounded-lg transition-all duration-200 ".concat(t?"text-blue-400 hover:text-blue-300 hover:bg-blue-900/20":"text-blue-600 hover:text-blue-800 hover:bg-blue-50"),children:"\u2190 Back to AI Training Tools"}),(0,kt.jsx)("h1",{className:"text-lg font-bold mb-2 ".concat(t?"text-white":"text-gray-900"),children:r.title}),(0,kt.jsx)("p",{className:"text-sm leading-relaxed ".concat(t?"text-gray-300":"text-gray-600"),children:r.description})]}),(0,kt.jsxs)("div",{className:"rounded-lg shadow-lg p-6 text-center border ".concat(t?"bg-[#1e293b] border-[#3b82f6]/30 text-white":"bg-white border-gray-200 text-gray-800"),children:[(0,kt.jsx)("div",{className:"text-4xl mb-4",children:"\ud83c\udf93"}),(0,kt.jsx)("h2",{className:"text-lg font-bold mb-2 ".concat(t?"text-white":"text-gray-800"),children:"Training Module Coming Soon"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:"This AI training module is currently in development and will be available soon."})]})]}):(0,kt.jsxs)("div",{className:"w-full max-w-5xl mx-auto px-2 py-2 ".concat(t?"bg-[#0f172a] text-white":"bg-white text-gray-800"),children:[(0,kt.jsx)("div",{className:"mb-4"}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:a.map(e=>(0,kt.jsxs)("div",{onClick:()=>(e=>{n(e)})(e),className:"rounded-lg shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer group overflow-hidden border ".concat(t?"bg-[#1e293b] border-[#3b82f6]/30 hover:bg-[#232b4d]":"bg-white border-gray-200 hover:bg-gray-50"),children:[(0,kt.jsxs)("div",{className:"h-32 relative overflow-hidden",children:[(0,kt.jsx)("img",{src:e.image,alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),(0,kt.jsx)("div",{className:"absolute top-2 right-2",children:(0,kt.jsx)("span",{className:"text-xs font-semibold px-2 py-1 rounded-full border ".concat(t?"bg-[#1e293b]/80 text-gray-300 border-[#3b82f6]/30":"bg-white text-gray-700 border-gray-200"),children:e.category})})]}),(0,kt.jsxs)("div",{className:"p-3",children:[(0,kt.jsx)("h3",{className:"text-sm font-bold mb-2 transition-colors ".concat(t?"text-white group-hover:text-blue-400":"text-gray-900 group-hover:text-blue-600"),children:e.title}),(0,kt.jsx)("p",{className:"text-xs mb-3 leading-relaxed ".concat(t?"text-gray-300":"text-gray-600"),children:e.description}),(0,kt.jsx)("div",{className:"space-y-1 mb-3",children:e.features.slice(0,3).map((e,r)=>(0,kt.jsxs)("div",{className:"flex items-center gap-1 text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)("div",{className:"w-1 h-1 bg-blue-500 rounded-full"}),e]},r))}),(0,kt.jsx)("button",{className:"w-full font-semibold py-2 px-3 rounded-lg transition-all duration-200 text-xs ".concat("bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white"),children:"Get Information"})]})]},e.id))})]})},$f=e=>{let{title:t,file:r,setFile:n,icon:a,color:s,required:o}=e;return(0,kt.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center transition-all duration-300 bg-white hover:bg-gray-50 hover:border-gray-400 hover:shadow-lg",children:r?(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("div",{className:"flex items-center justify-center",children:(0,kt.jsx)(on,{className:"w-12 h-12 text-green-600"})}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("p",{className:"font-semibold text-gray-900 text-lg",children:r.name}),(0,kt.jsxs)("p",{className:"text-sm text-gray-500",children:[(r.size/1024/1024).toFixed(2)," MB"]})]}),(0,kt.jsx)("button",{onClick:()=>{n(null)},className:"text-red-600 hover:text-red-800 text-sm font-medium px-4 py-2 rounded-lg hover:bg-red-50 transition-colors duration-200",children:"Remove"})]}):(0,kt.jsxs)("div",{className:"space-y-8",children:[(0,kt.jsx)("div",{className:"flex items-center justify-center",children:a}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("p",{className:"font-semibold text-gray-900 text-lg",children:[t," ",!o&&(0,kt.jsx)("span",{className:"text-xs text-gray-400 font-normal",children:"(Optional)"})]}),(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Upload PDF or DOCX file"})]}),(0,kt.jsxs)("label",{className:"cursor-pointer",children:[(0,kt.jsx)("input",{type:"file",accept:".pdf,.docx,.doc",onChange:e=>{const t=e.target.files[0];t&&n(t)},className:"hidden"}),(0,kt.jsx)("span",{className:"inline-flex items-center px-4 py-2 mt-6 border border-blue-400 text-sm font-medium rounded-lg text-blue-700 bg-white hover:bg-blue-50 hover:border-blue-500 transition-all duration-200",children:"Choose File"})]})]})})},eg=e=>{let{reportText:t}=e;const[r,n]=(0,o.useState)("");return(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 relative",children:[(0,kt.jsx)("div",{className:"p-8 sm:p-12",children:(0,kt.jsx)("div",{className:"prose max-w-none prose-lg",children:(a=t,a.split("\n").map((e,t)=>e.startsWith("### ")?(0,kt.jsx)("h3",{className:"text-xl font-semibold text-blue-600 mt-6 mb-2",children:e.substring(4)},t):e.startsWith("## ")?(0,kt.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mt-8 mb-4 border-b border-gray-200 pb-2",children:e.substring(3)},t):e.startsWith("# ")?(0,kt.jsx)("h1",{className:"text-3xl font-bold text-gray-900 text-center mb-4",children:e.substring(2)},t):e.startsWith("* ")?(0,kt.jsx)("li",{className:"ml-6 list-disc list-outside text-gray-700",children:e.substring(2)},t):""===e.trim()?(0,kt.jsx)("br",{},t):(0,kt.jsx)("p",{className:"text-gray-700 mb-4 leading-relaxed",children:e},t)).reduce((e,t,r)=>("li"===t.type?e.length>0&&"ul"===e[e.length-1].type?e[e.length-1].props.children.push(t):e.push((0,kt.jsx)("ul",{className:"mb-4",children:[t]},"ul-".concat(r))):e.push(t),e),[]))})}),(0,kt.jsx)("div",{className:"absolute top-6 right-6",children:(0,kt.jsxs)("button",{onClick:()=>{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy"),n("Copied!"),setTimeout(()=>n(""),2e3)}catch(XI){n("Failed to copy")}document.body.removeChild(e)},className:"flex items-center gap-3 px-4 py-3 text-sm font-semibold bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg",children:[r?(0,kt.jsx)(on,{className:"w-5 h-5 text-green-600"}):(0,kt.jsx)(sn,{className:"w-5 h-5"}),r||"Copy Report"]})})]});var a},tg=e=>{let{onBack:t}=e;const[r,n]=(0,o.useState)(null),[a,s]=(0,o.useState)(null),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(""),f=r&&a;return(0,kt.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-12 bg-[#F8FAFC] min-h-screen",children:[(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-10 border border-gray-200 mb-10",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-10",children:[(0,kt.jsx)($f,{title:"Adjuster Estimate",file:r,setFile:n,icon:(0,kt.jsx)(Kr,{className:"w-10 h-10 text-blue-600"}),color:"blue",required:!0}),(0,kt.jsx)($f,{title:"Contractor Scope Sheet",file:a,setFile:s,icon:(0,kt.jsx)(Kr,{className:"w-10 h-10 text-green-600"}),color:"green",required:!0}),(0,kt.jsx)($f,{title:"Contractor Estimate",file:i,setFile:l,icon:(0,kt.jsx)(Kr,{className:"w-10 h-10 text-purple-600"}),color:"purple",required:!1})]}),(0,kt.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-6 pt-8 border-t border-gray-200",children:[(0,kt.jsx)("button",{onClick:async()=>{if(!f)return void p("Please upload at least the Adjuster Estimate and Contractor Scope Sheet.");p(""),h(!0),d("");const e=i?"\n      You are an expert insurance restoration estimator, specializing in analyzing and comparing Xactimate estimates and contractor scope sheets. Your tone should be professional, objective, and collaborative.\n\n      I have uploaded three documents for a water damage claim (Claim ID: HW-789-2025) for analysis. Please act as if you have read and understood them perfectly.\n\n      1.  **Adjuster's Xactimate Estimate (PDF):**\n          * **Assumed Content:** A preliminary estimate from the carrier including water extraction, 3 days of drying equipment, baseboard removal, and a 2-foot flood cut.\n          * **Key Omissions:** Missing content manipulation, attached garage scope, flooring replacement, containment, and uses basic paint specs.\n\n      2.  **Contractor's Scope Sheet (DOCX):**\n          * **Assumed Content:** A detailed on-site scope noting heavy content manipulation (piano, sectional), non-salvageable premium laminate flooring, water damage in the attached garage, the need for dust containment, and a premium two-coat paint system.\n\n      3.  **Contractor's Xactimate Estimate (PDF):**\n          * **Assumed Content:** This estimate includes everything from the adjuster's estimate PLUS line items for: R&R Premium Laminate Flooring, Heavy Content Manipulation, Containment Barrier, Seal & Paint Walls (two coats), and scope for the attached garage.\n\n      **YOUR TASK:**\n      Generate a professional report that the contractor can send to the insurance adjuster. The report must clearly and respectfully outline the discrepancies between the adjuster's and contractor's estimates, using the scope sheet as justification for the necessary additions.\n\n      **REPORT FORMAT:**\n      * Start with a title: \"Supplement Request & Justification Report\".\n      * Use Markdown for formatting.\n      * Create a \"Summary of Proposed Adjustments\" section.\n      * Create a \"Detailed Line Item Justification\" section. For each item, provide: **Item**, **Justification** (citing scope sheet findings), and **Recommendation**.\n      * End with a professional closing statement.\n    ":'\n      You are an expert insurance restoration estimator, tasked with helping a contractor build an accurate estimate. Your tone should be professional, objective, and advisory.\n\n      I have uploaded two documents for a water damage claim (Claim ID: HW-789-2025) for a preliminary analysis. Please act as if you have read and understood them perfectly.\n\n      1.  **Adjuster\'s Xactimate Estimate (PDF):**\n          * **Assumed Content:** A preliminary estimate from the carrier including water extraction, 3 days of drying equipment, baseboard removal, and a 2-foot flood cut.\n          * **Key Omissions:** Missing content manipulation, attached garage scope, flooring replacement, containment, and uses basic paint specs.\n\n      2.  **Contractor\'s Scope Sheet (DOCX):**\n          * **Assumed Content:** A detailed on-site scope noting heavy content manipulation (piano, sectional), non-salvageable premium laminate flooring, water damage in the attached garage, the need for dust containment, and a premium two-coat paint system.\n\n      **YOUR TASK:**\n      Generate a "Pre-Estimate Advisory Report". This report will serve as a guide for the contractor to build their own comprehensive Xactimate estimate by comparing the adjuster\'s initial findings with the more detailed on-site scope.\n\n      **REPORT FORMAT:**\n      * Start with a title: "Pre-Estimate Advisory Report".\n      * Use Markdown for formatting.\n      * Create a "Recommended Additions to Estimate" section.\n      * For each recommended addition, provide: **Item** (e.g., "Content Manipulation - Heavy"), **Justification** (citing scope sheet findings), and an **Estimating Note** (a tip for listing it in Xactimate).\n      * Add a "General Recommendations" section for other potential considerations (e.g., checking local codes, project monitoring).\n      * End with a professional closing statement.\n    ';try{const t={contents:[{role:"user",parts:[{text:e}]}]},r="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_GEMINI_API_KEY||""),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("API call failed with status: ".concat(n.status));const a=await n.json();if(!(a.candidates&&a.candidates.length>0&&a.candidates[0].content&&a.candidates[0].content.parts&&a.candidates[0].content.parts.length>0))throw console.error("Unexpected API response structure:",a),new Error("Failed to parse the analysis from the API response.");{const e=a.candidates[0].content.parts[0].text;d(e)}}catch(XI){console.error("Error during analysis:",XI),p("An error occurred during analysis. Please try again. Details: ".concat(XI.message))}finally{h(!1)}},disabled:!f||u,style:{background:"linear-gradient(90deg, #2563eb, #1d4ed8, #1e40af)",color:"white",padding:"16px 40px",borderRadius:"12px",fontSize:"18px",fontWeight:"600",border:"none",cursor:"pointer",transition:"all 0.3s ease",transform:"scale(1)",boxShadow:"0 10px 25px rgba(37, 99, 235, 0.3)"},onMouseEnter:e=>{e.target.style.background="linear-gradient(90deg, #1d4ed8, #1e40af, #1e3a8a)",e.target.style.transform="scale(1.05)"},onMouseLeave:e=>{e.target.style.background="linear-gradient(90deg, #2563eb, #1d4ed8, #1e40af)",e.target.style.transform="scale(1)"},className:"w-full sm:w-auto flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)($r,{className:"w-6 h-6 animate-spin"}),"Analyzing..."]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(Yr,{className:"w-6 h-6"}),"Run Analysis"]})}),(0,kt.jsx)("button",{onClick:()=>{n(null),s(null),l(null),d(""),p(""),h(!1)},className:"w-full sm:w-auto flex items-center justify-center gap-3 px-10 py-4 text-lg font-semibold text-gray-700 bg-gray-100 rounded-xl shadow-lg hover:bg-gray-200 transition-all duration-300 transform hover:scale-105",children:"Reset"})]})]}),m&&(0,kt.jsxs)("div",{className:"mb-10 bg-red-50 border border-red-200 text-red-700 px-8 py-6 rounded-xl flex items-center gap-4 shadow-lg",children:[(0,kt.jsx)(un,{className:"w-6 h-6 text-red-500 flex-shrink-0"}),(0,kt.jsx)("span",{className:"font-medium text-lg",children:m})]}),c&&(0,kt.jsx)(eg,{reportText:c})]})},rg=["title","titleId"];function ng(e,t){let{title:r,titleId:n}=e,a=An(e,rg);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const ag=o.forwardRef(ng),sg=["title","titleId"];function og(e,t){let{title:r,titleId:n}=e,a=An(e,sg);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))}const ig=o.forwardRef(og),lg=["title","titleId"];function cg(e,t){let{title:r,titleId:n}=e,a=An(e,lg);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const dg=o.forwardRef(cg),ug=["title","titleId"];function hg(e,t){let{title:r,titleId:n}=e,a=An(e,ug);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const mg=o.forwardRef(hg),pg=["title","titleId"];function fg(e,t){let{title:r,titleId:n}=e,a=An(e,pg);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const gg=o.forwardRef(fg),vg=e=>{var t,n;let{colorMode:a}=e;const s=Ct(),[i,l]=(0,o.useState)("upload"),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)(null),[m,p]=(0,o.useState)(""),[f,g]=(0,o.useState)("LEAD"),[v,x]=(0,o.useState)(!1),[b,y]=(0,o.useState)(null),[w,j]=(0,o.useState)({phase:"phase",section:"section",lineItem:"line_item"}),[N,S]=(0,o.useState)([]),[k,A]=(0,o.useState)([]),[C,E]=(0,o.useState)(!1),[P,_]=(0,o.useState)("");(0,o.useEffect)(()=>{(async()=>{try{const e=await fetch("/api/projects",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(e.ok){const t=await e.json();t.success&&t.data&&S(t.data.projects||t.data)}}catch(P){console.error("Failed to fetch projects:",P)}})()},[]),(0,o.useEffect)(()=>{(async()=>{try{console.log("\ud83d\udd0d WORKFLOW IMPORT: Fetching workflow phases for dropdown...");const e=(await Promise.resolve().then(r.bind(r,4505))).default,t=(await e.get("/workflow-data/phases")).data;if(null===t||void 0===t||!t.success||!t.data)throw new Error("Invalid response format");{const e=t.data.map(e=>({id:e.id,name:e.name,displayName:e.displayName||e.name}));A(e),e.length>0&&g(e[0].id),console.log("\u2705 WORKFLOW IMPORT: Loaded workflow phases from database:",e)}}catch(P){console.error("\u274c WORKFLOW IMPORT: Failed to fetch workflow phases:",P);A([{id:"LEAD",name:"LEAD",displayName:"Lead"},{id:"PROSPECT",name:"PROSPECT",displayName:"Prospect"},{id:"APPROVED",name:"APPROVED",displayName:"Approved"},{id:"EXECUTION",name:"EXECUTION",displayName:"Execution"},{id:"COMPLETION",name:"COMPLETION",displayName:"Completion"}]),g("LEAD"),console.log("\u26a0\ufe0f WORKFLOW IMPORT: Using fallback workflow phases due to API error")}})()},[]);const I=La({mutationFn:async e=>{const t=new FormData;return t.append("file",e),await Da.workflowImportService.uploadFile(t)},onSuccess:e=>{h(e.data.importId),y(e.data),l("preview")},onError:e=>{var t,r;alert("Upload failed: ".concat((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}}),T=La({mutationFn:async e=>await Da.workflowImportService.confirmImport(e.importId,{projectId:e.projectId,startingPhase:e.startingPhase,clearExisting:e.clearExisting}),onSuccess:e=>{alert("Workflow imported successfully!"),s.invalidateQueries(["projects"]),s.invalidateQueries(["workflows"]),l("upload"),d(null),h(null),y(null)},onError:e=>{var t,r;alert("Import failed: ".concat((null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||e.message))}}),L=e=>{Da.workflowImportService.downloadTemplate(e)};return(0,kt.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,kt.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,kt.jsxs)("div",{className:"bg-white rounded-lg shadow-lg",children:[(0,kt.jsxs)("div",{className:"border-b px-6 py-4",children:[(0,kt.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Import Workflow Data"}),(0,kt.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Upload an Excel or CSV file with Phase, Section, and Line Item data"})]}),(0,kt.jsx)("div",{className:"px-6 py-4 border-b",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center",style:{color:"upload"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-400)"},children:[(0,kt.jsx)("span",{className:"flex items-center justify-center w-8 h-8 border-2 rounded-full",style:{borderColor:"upload"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-300)"},children:"1"}),(0,kt.jsx)("span",{className:"ml-2 font-medium",children:"Upload File"})]}),(0,kt.jsx)("div",{className:"flex-1 h-0.5 mx-4 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center",style:{color:"preview"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-400)"},children:[(0,kt.jsx)("span",{className:"flex items-center justify-center w-8 h-8 border-2 rounded-full",style:{borderColor:"preview"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-300)"},children:"2"}),(0,kt.jsx)("span",{className:"ml-2 font-medium",children:"Preview & Validate"})]}),(0,kt.jsx)("div",{className:"flex-1 h-0.5 mx-4 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center",style:{color:"mapping"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-400)"},children:[(0,kt.jsx)("span",{className:"flex items-center justify-center w-8 h-8 border-2 rounded-full",style:{borderColor:"mapping"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-300)"},children:"3"}),(0,kt.jsx)("span",{className:"ml-2 font-medium",children:"Configure Import"})]}),(0,kt.jsx)("div",{className:"flex-1 h-0.5 mx-4 bg-gray-300"}),(0,kt.jsxs)("div",{className:"flex items-center",style:{color:"confirm"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-400)"},children:[(0,kt.jsx)("span",{className:"flex items-center justify-center w-8 h-8 border-2 rounded-full",style:{borderColor:"confirm"===i?"var(--color-primary-blueprint-blue)":"var(--color-neutral-gray-300)"},children:"4"}),(0,kt.jsx)("span",{className:"ml-2 font-medium",children:"Confirm"})]})]})}),(0,kt.jsxs)("div",{className:"p-6",children:["upload"===i&&(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"var(--color-primary-light-tint)"},children:[(0,kt.jsx)("h3",{className:"font-medium mb-2",style:{color:"var(--color-primary-blueprint-blue)"},children:"Download Template"}),(0,kt.jsx)("p",{className:"text-sm mb-3",style:{color:"var(--color-primary-blueprint-blue)"},children:"Use our template to ensure your data is formatted correctly"}),(0,kt.jsxs)("div",{className:"flex space-x-3",children:[(0,kt.jsxs)("button",{onClick:()=>L("xlsx"),className:"px-4 py-2 text-white rounded",style:{background:"var(--color-primary-blueprint-blue)"},children:[(0,kt.jsx)(ag,{className:"w-4 h-4 inline mr-2"}),"Excel Template"]}),(0,kt.jsxs)("button",{onClick:()=>L("csv"),className:"px-4 py-2 text-white rounded",style:{background:"var(--color-success-green)"},children:[(0,kt.jsx)(ag,{className:"w-4 h-4 inline mr-2"}),"CSV Template"]})]})]}),(0,kt.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[(0,kt.jsx)(ig,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),(0,kt.jsxs)("label",{className:"cursor-pointer",children:[(0,kt.jsx)("span",{className:"px-4 py-2 text-white rounded",style:{background:"var(--color-primary-blueprint-blue)"},children:"Choose File"}),(0,kt.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{const t=e.target.files[0];if(t){const e=[".xlsx",".xls",".csv"],r=t.name.substring(t.name.lastIndexOf(".")).toLowerCase();if(!e.includes(r))return void alert("Invalid file format. Please upload an Excel (.xlsx, .xls) or CSV (.csv) file.");d(t),I.mutate(t)}},className:"hidden"})]}),(0,kt.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"or drag and drop your Excel/CSV file here"}),(0,kt.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Supported formats: .xlsx, .xls, .csv (max 10MB)"})]}),(0,kt.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,kt.jsxs)("h3",{className:"font-medium text-yellow-900 mb-2",children:[(0,kt.jsx)(dg,{className:"w-5 h-5 inline mr-2"}),"File Requirements"]}),(0,kt.jsxs)("ul",{className:"text-sm text-yellow-700 space-y-1 ml-7",children:[(0,kt.jsx)("li",{children:"\u2022 Must contain headers: Phase, Section, Line Item"}),(0,kt.jsx)("li",{children:"\u2022 Optional headers: Description, Responsible Role, Estimated Duration, Alert Priority"}),(0,kt.jsx)("li",{children:"\u2022 Phases must be: LEAD, PROSPECT, APPROVED, EXECUTION, SUPPLEMENT, or COMPLETION"}),(0,kt.jsx)("li",{children:"\u2022 No empty rows between data"})]})]})]}),"preview"===i&&b&&(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,kt.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"File Summary"}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"File Name"}),(0,kt.jsx)("p",{className:"font-medium",children:b.fileName})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Total Rows"}),(0,kt.jsx)("p",{className:"font-medium",children:b.totalRows})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Valid Rows"}),(0,kt.jsx)("p",{className:"font-medium",style:{color:"var(--color-success-green)"},children:b.validRows})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Error Rows"}),(0,kt.jsx)("p",{className:"font-medium text-red-600",children:b.errorRows})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Data Preview (First 10 Rows)"}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,kt.jsx)("thead",{className:"bg-gray-50",children:(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Row"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Phase"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Section"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Line Item"}),(0,kt.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Role"})]})}),(0,kt.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:b.preview.map((e,t)=>(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.rowNumber}),(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.phase}),(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.section}),(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.lineItem}),(0,kt.jsx)("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.responsibleRole})]},t))})]})})]}),b.errors&&b.errors.length>0&&(0,kt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,kt.jsxs)("h3",{className:"font-medium text-red-900 mb-2",children:[(0,kt.jsx)(mg,{className:"w-5 h-5 inline mr-2"}),"Validation Errors"]}),(0,kt.jsx)("ul",{className:"text-sm text-red-700 space-y-1",children:b.errors.map((e,t)=>(0,kt.jsxs)("li",{children:["Row ",e.rowNumber,": ",e.error]},t))})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("button",{onClick:()=>l("upload"),className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Back"}),(0,kt.jsx)("button",{onClick:()=>l("mapping"),className:"px-4 py-2 text-white rounded",style:{background:"var(--color-primary-blueprint-blue)"},disabled:0===b.validRows,children:"Continue"})]})]}),"mapping"===i&&(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Target Project"}),(0,kt.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,kt.jsx)("option",{value:"",children:"-- Select a Project --"}),N.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.projectNumber," - ",e.projectName]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Phase"}),(0,kt.jsx)("select",{value:f,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:k.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.displayName},e.id))}),(0,kt.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Import will begin from this phase and include all subsequent phases"})]}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",id:"clearExisting",checked:v,onChange:e=>x(e.target.checked),className:"h-4 w-4 rounded",style:{accentColor:"var(--color-primary-blueprint-blue)"}}),(0,kt.jsx)("label",{htmlFor:"clearExisting",className:"ml-2 text-sm text-gray-700",children:"Clear existing workflow data before importing"})]}),v&&(0,kt.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,kt.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,kt.jsx)(dg,{className:"w-5 h-5 inline mr-2"}),"Warning: This will permanently delete all existing workflow data for this project"]})}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("button",{onClick:()=>l("preview"),className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Back"}),(0,kt.jsx)("button",{onClick:()=>l("confirm"),className:"px-4 py-2 text-white rounded",style:{background:"var(--color-primary-blueprint-blue)"},disabled:!m,children:"Review Import"})]})]}),"confirm"===i&&b&&(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,kt.jsxs)("h3",{className:"font-medium text-green-900 mb-3",children:[(0,kt.jsx)(gg,{className:"w-5 h-5 inline mr-2"}),"Ready to Import"]}),(0,kt.jsxs)("div",{className:"text-sm text-green-700 space-y-2",children:[(0,kt.jsxs)("p",{children:["\u2022 ",b.validRows," workflow items will be imported"]}),(0,kt.jsxs)("p",{children:["\u2022 Phases: ",b.summary.phases.join(", ")]}),(0,kt.jsxs)("p",{children:["\u2022 ",b.summary.sections," unique sections"]}),(0,kt.jsxs)("p",{children:["\u2022 Starting from: ",f," phase"]}),v&&(0,kt.jsx)("p",{className:"text-yellow-700",children:"\u2022 Existing workflow will be cleared"})]})]}),(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,kt.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Target Project"}),(0,kt.jsxs)("p",{className:"text-sm text-gray-700",children:[null===(t=N.find(e=>e.id===m))||void 0===t?void 0:t.projectNumber," -",null===(n=N.find(e=>e.id===m))||void 0===n?void 0:n.projectName]})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("button",{onClick:()=>l("mapping"),className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"Back"}),(0,kt.jsx)("button",{onClick:()=>{m?T.mutate({importId:u,projectId:m,startingPhase:f,clearExisting:v}):alert("Please select a project to import the workflow into.")},className:"px-4 py-2 text-white rounded",style:{background:"var(--color-success-green)"},disabled:T.isLoading,children:T.isLoading?"Importing...":"Confirm Import"})]})]})]})]})})})};var xg={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},bg=o.createContext&&o.createContext(xg),yg=["attr","size","title"];function wg(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function jg(){return jg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jg.apply(this,arguments)}function Ng(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Sg(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ng(Object(r),!0).forEach(function(t){kg(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ng(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function kg(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ag(e){return e&&e.map((e,t)=>o.createElement(e.tag,Sg({key:t},e.attr),Ag(e.child)))}function Cg(e){return t=>o.createElement(Eg,jg({attr:Sg({},e.attr)},t),Ag(e.child))}function Eg(e){var t=t=>{var r,{attr:n,size:a,title:s}=e,i=wg(e,yg),l=a||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),o.createElement("svg",jg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,i,{className:r,style:Sg(Sg({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),s&&o.createElement("title",null,s),e.children)};return void 0!==bg?o.createElement(bg.Consumer,null,e=>t(e)):t(xg)}function Pg(e){return Cg({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(e)}function _g(e){return Cg({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"},child:[]}]})(e)}function Ig(e){return Cg({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(e)}function Tg(e){return Cg({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm60.1 106.5L224 336l60.1 93.5c5.1 8-.6 18.5-10.1 18.5h-34.9c-4.4 0-8.5-2.4-10.6-6.3C208.9 405.5 192 373 192 373c-6.4 14.8-10 20-36.6 68.8-2.1 3.9-6.1 6.3-10.5 6.3H110c-9.5 0-15.2-10.5-10.1-18.5l60.3-93.5-60.3-93.5c-5.2-8 .6-18.5 10.1-18.5h34.8c4.4 0 8.5 2.4 10.6 6.3 26.1 48.8 20 33.6 36.6 68.5 0 0 6.1-11.7 36.6-68.5 2.1-3.9 6.2-6.3 10.6-6.3H274c9.5-.1 15.2 10.4 10.1 18.4zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(e)}function Lg(e){return Cg({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(e)}function Dg(e){return Cg({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(e)}function Mg(e){return Cg({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64v-96h160v96zm0-160H64v-96h160v96zm224 160H288v-96h160v96zm0-160H288v-96h160v96z"},child:[]}]})(e)}function Og(e){return Cg({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(e)}function Rg(e){return Cg({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(e)}const Fg=e=>{let{colorMode:t=!1}=e;const[r,n]=(0,o.useState)([]),[a,s]=(0,o.useState)(""),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(null),[m,p]=(0,o.useState)(""),[f,g]=(0,o.useState)(""),[v,x]=(0,o.useState)(!0),[b,y]=(0,o.useState)(!1),[w,j]=(0,o.useState)(null),[N,S]=(0,o.useState)({});(0,o.useEffect)(()=>{A()},[]);const k=()=>sessionStorage.getItem("authToken")||localStorage.getItem("authToken")||sessionStorage.getItem("token")||localStorage.getItem("token"),A=async()=>{try{d(!0);const e=await fetch("".concat(Da.API_BASE_URL,"/complete-excel-data/tables"),{headers:{Authorization:"Bearer ".concat(k()),Accept:"application/json"}});if(!e.ok)throw new Error("Failed to fetch tables");if(!(e.headers.get("content-type")||"").includes("application/json")){await e.text();throw new Error("Server returned non-JSON response (likely a proxy or auth redirect).")}const t=await e.json();n(t.data.tables),console.log("\ud83d\udccb Loaded tables:",t.data.tables.length)}catch(XI){console.error("Error fetching tables:",XI),p("Failed to load database tables: "+XI.message)}finally{d(!1)}},C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=e?"".concat(Da.API_BASE_URL,"/complete-excel-data/template/").concat(e):"".concat(Da.API_BASE_URL,"/complete-excel-data/template/all"),r=await fetch(t,{headers:{Authorization:"Bearer ".concat(k())}});if(!r.ok)throw new Error("Failed to download template");const n=await r.blob(),a=window.URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=e?"".concat(e,"-template.xlsx"):"complete-database-template.xlsx",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(a),document.body.removeChild(s),g("Template downloaded: ".concat(e||"Complete database"))}catch(XI){p("Failed to download template: "+XI.message)}},E=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{d(!0);const t=e?"".concat(Da.API_BASE_URL,"/complete-excel-data/export/").concat(e):"".concat(Da.API_BASE_URL,"/complete-excel-data/export/all"),r=await fetch(t,{headers:{Authorization:"Bearer ".concat(k())}});if(!r.ok)throw new Error("Failed to export data");const n=await r.blob(),a=window.URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=e?"".concat(e,"-export.xlsx"):"complete-database-export.xlsx",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(a),document.body.removeChild(s),g("Data exported: ".concat(e||"Complete database"))}catch(XI){p("Failed to export data: "+XI.message)}finally{d(!1)}};return(0,kt.jsxs)("div",{className:"space-y-6 ".concat(t?"text-gray-100":"text-gray-800"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,kt.jsx)(_g,{className:"text-2xl text-blue-500"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-xl font-bold",children:"Complete Database Manager"}),(0,kt.jsxs)("p",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:["Upload, download, and manage data for all ",r.length," database tables"]})]})]}),(0,kt.jsx)("div",{className:"text-right",children:(0,kt.jsxs)("div",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:["Total Tables: ",r.length," | Total Fields: ",r.reduce((e,t)=>e+t.totalFields,0)]})})]}),m&&(0,kt.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded flex items-center",children:[(0,kt.jsx)(Og,{className:"mr-2"}),m]}),f&&(0,kt.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded flex items-center",children:[(0,kt.jsx)(Pg,{className:"mr-2"}),f]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-6 ".concat(t?"border-gray-600 bg-gray-800":"border-gray-300 bg-white"),children:[(0,kt.jsxs)("h4",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,kt.jsx)(Rg,{className:"mr-2 text-blue-500"}),"Upload Data"]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("div",{className:"flex items-center space-x-4",children:(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"checkbox",checked:v,onChange:e=>x(e.target.checked),className:"mr-2"}),"Auto-detect table from file"]})}),!v&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(t?"text-gray-300":"text-gray-700"),children:"Target Table"}),(0,kt.jsxs)("select",{value:a,onChange:e=>s(e.target.value),className:"w-full p-2 border rounded-md ".concat(t?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300 text-gray-900"),children:[(0,kt.jsx)("option",{value:"",children:"Select a table..."}),r.map(e=>(0,kt.jsxs)("option",{value:e.name,children:[e.displayName," (",e.uploadableFields," uploadable fields)"]},e.name))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(t?"text-gray-300":"text-gray-700"),children:"Select File (.xlsx, .xls, .csv)"}),(0,kt.jsx)("input",{type:"file",id:"complete-excel-file-input",accept:".xlsx,.xls,.csv",onChange:e=>{const t=e.target.files[0];t&&(l(t),p(""),h(null),g(""))},className:"w-full p-2 border rounded-md ".concat(t?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300 text-gray-900")}),i&&(0,kt.jsxs)("div",{className:"mt-2 text-sm text-green-600 flex items-center",children:[(0,kt.jsx)(Tg,{className:"mr-1"}),i.name," (",(i.size/1024/1024).toFixed(2)," MB)"]})]}),(0,kt.jsx)("button",{onClick:async()=>{if(i){d(!0),p(""),g("");try{const e=new FormData;e.append("file",i),a&&!v&&e.append("tableName",a),e.append("autoDetect",v.toString());const t=await fetch("".concat(Da.API_BASE_URL,"/complete-excel-data/upload"),{method:"POST",headers:{Authorization:"Bearer ".concat(k())},body:e});if(!(t.headers.get("content-type")||"").includes("application/json")){await t.text();throw new Error("Server returned non-JSON response for upload.")}const r=await t.json();if(!t.ok)throw new Error(r.message||"Upload failed");h(r.data),g("Upload completed: ".concat(r.data.overall.totalSuccessful,"/").concat(r.data.overall.totalRecords," records processed. Note: Existing records with duplicate unique fields (project numbers, emails) will be updated.")),l(null);const n=document.getElementById("complete-excel-file-input");n&&(n.value="")}catch(XI){console.error("Upload error:",XI),p(XI.message||"Upload failed")}finally{d(!1)}}else p("Please select a file first")},disabled:!i||c,className:"w-full py-2 px-4 rounded-md font-medium flex items-center justify-center ".concat(!i||c?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-[var(--color-primary-blueprint-blue)]"),children:c?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(Dg,{className:"animate-spin mr-2"}),"Processing..."]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(Rg,{className:"mr-2"}),"Upload Data"]})})]})]}),u&&(0,kt.jsxs)("div",{className:"border rounded-lg p-6 ".concat(t?"border-gray-600 bg-gray-800":"border-gray-300 bg-white"),children:[(0,kt.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Upload Results"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,kt.jsxs)("div",{className:"p-3 rounded ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-blue-500",children:u.overall.totalSheets}),(0,kt.jsx)("div",{className:"text-sm",children:"Sheets Processed"})]}),(0,kt.jsxs)("div",{className:"p-3 rounded ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:u.overall.totalRecords}),(0,kt.jsx)("div",{className:"text-sm",children:"Total Records"})]}),(0,kt.jsxs)("div",{className:"p-3 rounded ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-green-500",children:u.overall.totalSuccessful}),(0,kt.jsx)("div",{className:"text-sm",children:"Successful"})]}),(0,kt.jsxs)("div",{className:"p-3 rounded ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-red-500",children:u.overall.totalFailed}),(0,kt.jsx)("div",{className:"text-sm",children:"Failed"})]})]}),Object.entries(u.sheetResults||{}).length>0&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h5",{className:"font-medium mb-2",children:"Sheet Details:"}),(0,kt.jsx)("div",{className:"space-y-2",children:Object.entries(u.sheetResults).map(e=>{let[r,n]=e;return(0,kt.jsxs)("div",{className:"p-3 border rounded ".concat(t?"border-gray-600":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("button",{onClick:()=>(e=>{S(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:!t[e]}))})(r),className:"px-2 py-1 text-xs rounded ".concat(t?"bg-gray-700 text-gray-100":"bg-gray-100 text-gray-700"),children:N[r]?"Hide Details":"View Details"}),(0,kt.jsx)("span",{className:"font-medium",children:r})]}),(0,kt.jsxs)("span",{className:"text-sm",children:["\u2192 ",n.targetTable]})]}),(0,kt.jsxs)("div",{className:"text-sm flex justify-between",children:[(0,kt.jsxs)("span",{className:"text-green-600",children:["\u2713 ",n.successful," successful"]}),(0,kt.jsxs)("span",{className:"text-red-600",children:["\u2717 ",n.failed," failed"]})]}),N[r]&&(0,kt.jsxs)("div",{className:"mt-3 text-sm ".concat(t?"text-gray-200":"text-gray-800"),children:[Array.isArray(n.transformWarnings)&&n.transformWarnings.length>0&&(0,kt.jsxs)("div",{className:"mb-2",children:[(0,kt.jsx)("div",{className:"font-medium mb-1",children:"Transform warnings:"}),(0,kt.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:n.transformWarnings.map((e,r)=>(0,kt.jsx)("div",{className:"".concat(t?"bg-yellow-900 text-yellow-200":"bg-yellow-50 text-yellow-700"," p-2 rounded"),children:e},r))})]}),Array.isArray(n.errors)&&n.errors.length>0&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium mb-1 text-red-600",children:"Row errors:"}),(0,kt.jsx)("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:n.errors.map((e,r)=>(0,kt.jsxs)("div",{className:"".concat(t?"bg-red-900 text-red-200":"bg-red-50 text-red-700"," p-2 rounded"),children:[e.row?"Row ".concat(e.row,": "):"",e.error]},r))})]})]})]},r)})})]}),u.overall.errors&&u.overall.errors.length>0&&(0,kt.jsxs)("div",{className:"mt-4",children:[(0,kt.jsx)("h5",{className:"font-medium mb-2 text-red-600",children:"Errors:"}),(0,kt.jsx)("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:u.overall.errors.map((e,t)=>(0,kt.jsxs)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:[e.sheet,": ",e.error]},t))})]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-6 ".concat(t?"border-gray-600 bg-gray-800":"border-gray-300 bg-white"),children:[(0,kt.jsxs)("h4",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,kt.jsx)(Ig,{className:"mr-2 text-green-500"}),"Download Templates & Export Data"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,kt.jsxs)("button",{onClick:()=>C(),className:"py-2 px-4 bg-green-500 text-white rounded-md hover:bg-[var(--color-success-green)] flex items-center justify-center",children:[(0,kt.jsx)(Ig,{className:"mr-2"}),"Download All Templates"]}),(0,kt.jsxs)("button",{onClick:()=>E(),className:"py-2 px-4 bg-purple-500 text-white rounded-md hover:bg-purple-600 flex items-center justify-center",disabled:c,children:[c?(0,kt.jsx)(Dg,{className:"animate-spin mr-2"}):(0,kt.jsx)(Ig,{className:"mr-2"}),"Export All Data"]})]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-6 ".concat(t?"border-gray-600 bg-gray-800":"border-gray-300 bg-white"),children:[(0,kt.jsxs)("h4",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,kt.jsx)(Mg,{className:"mr-2 text-indigo-500"}),"Database Tables (",r.length,")"]}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"border-gray-600 hover:border-gray-500":"border-gray-200 hover:border-gray-300"," hover:shadow-md transition-all cursor-pointer"),children:[(0,kt.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,kt.jsx)("h5",{className:"font-medium text-sm",children:e.displayName}),(0,kt.jsx)("button",{onClick:()=>(e=>{j(e),y(!0)})(e),className:"text-blue-500 hover:text-blue-600",children:(0,kt.jsx)(Lg,{})})]}),(0,kt.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{children:"Total Fields:"}),(0,kt.jsx)("span",{className:"font-medium",children:e.totalFields})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{children:"Uploadable:"}),(0,kt.jsx)("span",{className:"font-medium text-green-600",children:e.uploadableFields})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{children:"Relations:"}),(0,kt.jsx)("span",{className:"font-medium text-blue-600",children:e.relationships})]})]}),(0,kt.jsxs)("div",{className:"flex space-x-2 mt-3",children:[(0,kt.jsx)("button",{onClick:()=>C(e.name),className:"flex-1 py-1 px-2 text-xs bg-green-500 text-white rounded hover:bg-[var(--color-success-green)]",children:"Template"}),(0,kt.jsx)("button",{onClick:()=>E(e.name),className:"flex-1 py-1 px-2 text-xs bg-purple-500 text-white rounded hover:bg-purple-600",disabled:c,children:"Export"})]})]},e.name))})]}),b&&w&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,kt.jsx)("div",{className:"max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto rounded-lg ".concat(t?"bg-gray-800":"bg-white"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,kt.jsxs)("h3",{className:"text-xl font-bold",children:[w.displayName," Fields"]}),(0,kt.jsx)("button",{onClick:()=>y(!1),className:"text-gray-500 hover:text-gray-700",children:(0,kt.jsx)(Og,{})})]}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"w-full text-sm ".concat(t?"text-gray-100":"text-gray-800"),children:[(0,kt.jsx)("thead",{children:(0,kt.jsxs)("tr",{className:"border-b ".concat(t?"border-gray-600":"border-gray-200"),children:[(0,kt.jsx)("th",{className:"text-left p-2",children:"Field Name"}),(0,kt.jsx)("th",{className:"text-left p-2",children:"Type"}),(0,kt.jsx)("th",{className:"text-left p-2",children:"Required"}),(0,kt.jsx)("th",{className:"text-left p-2",children:"Enum Values"}),(0,kt.jsx)("th",{className:"text-left p-2",children:"Constraint"})]})}),(0,kt.jsx)("tbody",{children:w.fields.map((e,r)=>(0,kt.jsxs)("tr",{className:"border-b ".concat(t?"border-gray-700":"border-gray-100"),children:[(0,kt.jsx)("td",{className:"p-2 font-medium",children:e.name}),(0,kt.jsx)("td",{className:"p-2",children:e.type}),(0,kt.jsx)("td",{className:"p-2",children:e.required?(0,kt.jsx)("span",{className:"text-red-500",children:"\u2713"}):(0,kt.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,kt.jsx)("td",{className:"p-2",children:e.enumValues?(0,kt.jsx)("div",{className:"max-w-xs overflow-x-auto",children:(0,kt.jsx)("div",{className:"text-xs space-y-1",children:e.enumValues.map(e=>(0,kt.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 px-1 rounded mr-1",children:e},e))})}):(0,kt.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,kt.jsx)("td",{className:"p-2 text-xs max-w-xs truncate",title:e.constraint,children:e.constraint})]},r))})]})})]})})})]})};function Ug(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];if("undefined"!==typeof process&&void 0===t)throw new Error("invariant requires an error message argument");if(!e){let e;if(void 0===t)e=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let r=0;e=new Error(t.replace(/%s/g,function(){return n[r++]})),e.name="Invariant Violation"}throw e.framesToPop=1,e}}var Bg=r(122);const zg="undefined"!==typeof window?o.useLayoutEffect:o.useEffect;function Wg(e,t,r){const[n,a]=function(e,t,r){const[n,a]=(0,o.useState)(()=>t(e)),s=(0,o.useCallback)(()=>{const s=t(e);Bg(n,s)||(a(s),r&&r())},[n,e,r]);return zg(s),[n,s]}(e,t,r);return zg(function(){const t=e.getHandlerId();if(null!=t)return e.subscribeToStateChange(a,{handlerIds:[t]})},[e,a]),n}function qg(e,t,r){return Wg(t,e||(()=>({})),()=>r.reconnect())}function Vg(e,t){const r=[...t||[]];return null==t&&"function"!==typeof e&&r.push(e),(0,o.useMemo)(()=>"function"===typeof e?e():e,r)}function Hg(e){return(0,o.useMemo)(()=>e.hooks.dragSource(),[e])}function Gg(e){return(0,o.useMemo)(()=>e.hooks.dragPreview(),[e])}function Kg(e,t,r,n){let a=r?r.call(n,e,t):void 0;if(void 0!==a)return!!a;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;const s=Object.keys(e),o=Object.keys(t);if(s.length!==o.length)return!1;const i=Object.prototype.hasOwnProperty.bind(t);for(let l=0;l<s.length;l++){const o=s[l];if(!i(o))return!1;const c=e[o],d=t[o];if(a=r?r.call(n,c,d,o):void 0,!1===a||void 0===a&&c!==d)return!1}return!0}function Jg(e){return null!==e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Yg(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(0,o.isValidElement)(t)){const n=t;return e(n,r),n}const n=t;!function(e){if("string"===typeof e.type)return;const t=e.type.displayName||e.type.name||"the component";throw new Error("Only native element nodes can now be passed to React DnD connectors."+"You can either wrap ".concat(t," into a <div>, or turn it into a ")+"drag source or a drop target itself.")}(n);return function(e,t){const r=e.ref;return Ug("string"!==typeof r,"Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),r?(0,o.cloneElement)(e,{ref:e=>{Qg(r,e),Qg(t,e)}}):(0,o.cloneElement)(e,{ref:t})}(n,r?t=>e(t,r):e)}}function Xg(e){const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(r.endsWith("Ref"))t[r]=e[r];else{const e=Yg(n);t[r]=()=>e}}),t}function Qg(e,t){"function"===typeof e?e(t):e.current=t}class Zg{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.dragPreview,r=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();r&&this.disconnectDragPreview(),this.handlerId&&(t?r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions)):this.lastConnectedDragPreview=t)}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!Kg(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!Kg(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=Xg({dragSource:(e,t)=>{this.clearDragSource(),this.dragSourceOptions=t||null,Jg(e)?this.dragSourceRef=e:this.dragSourceNode=e,this.reconnectDragSource()},dragPreview:(e,t)=>{this.clearDragPreview(),this.dragPreviewOptions=t||null,Jg(e)?this.dragPreviewRef=e:this.dragPreviewNode=e,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}const $g=(0,o.createContext)({dragDropManager:void 0});function ev(){const{dragDropManager:e}=(0,o.useContext)($g);return Ug(null!=e,"Expected drag drop context"),e}let tv=!1,rv=!1;class nv{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){Ug(!tv,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return tv=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{tv=!1}}isDragging(){if(!this.sourceId)return!1;Ug(!rv,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return rv=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{rv=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}class av{beginDrag(){const e=this.spec,t=this.monitor;let r=null;return r="object"===typeof e.item?e.item:"function"===typeof e.item?e.item(t):{},null!==r&&void 0!==r?r:null}canDrag(){const e=this.spec,t=this.monitor;return"boolean"===typeof e.canDrag?e.canDrag:"function"!==typeof e.canDrag||e.canDrag(t)}isDragging(e,t){const r=this.spec,n=this.monitor,{isDragging:a}=r;return a?a(n):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,r=this.connector,{end:n}=e;n&&n(t.getItem(),t),r.reconnect()}constructor(e,t,r){this.spec=e,this.monitor=t,this.connector=r}}function sv(e,t,r){const n=ev(),a=function(e,t,r){const n=(0,o.useMemo)(()=>new av(e,t,r),[t,r]);return(0,o.useEffect)(()=>{n.spec=e},[e]),n}(e,t,r),s=function(e){return(0,o.useMemo)(()=>{const t=e.type;return Ug(null!=t,"spec.type must be defined"),t},[e])}(e);zg(function(){if(null!=s){const[e,o]=function(e,t,r){const n=r.getRegistry(),a=n.addSource(e,t);return[a,()=>n.removeSource(a)]}(s,a,n);return t.receiveHandlerId(e),r.receiveHandlerId(e),o}},[n,t,r,a,s])}function ov(e,t){const r=Vg(e,t);Ug(!r.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const n=function(){const e=ev();return(0,o.useMemo)(()=>new nv(e),[e])}(),a=function(e,t){const r=ev(),n=(0,o.useMemo)(()=>new Zg(r.getBackend()),[r]);return zg(()=>(n.dragSourceOptions=e||null,n.reconnect(),()=>n.disconnectDragSource()),[n,e]),zg(()=>(n.dragPreviewOptions=t||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,t]),n}(r.options,r.previewOptions);return sv(r,n,a),[qg(r.collect,n,a),Hg(a),Gg(a)]}function iv(e){return(0,o.useMemo)(()=>e.hooks.dropTarget(),[e])}class lv{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;this.handlerId&&(t?e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions)):this.lastConnectedDropTarget=t)}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!Kg(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=Xg({dropTarget:(e,t)=>{this.clearDropTarget(),this.dropTargetOptions=t,Jg(e)?this.dropTargetRef=e:this.dropTargetNode=e,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}let cv=!1;class dv{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;Ug(!cv,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return cv=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{cv=!1}}isOver(e){return!!this.targetId&&this.internalMonitor.isOverTarget(this.targetId,e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}class uv{canDrop(){const e=this.spec,t=this.monitor;return!e.canDrop||e.canDrop(t.getItem(),t)}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function hv(e,t,r){const n=ev(),a=function(e,t){const r=(0,o.useMemo)(()=>new uv(e,t),[t]);return(0,o.useEffect)(()=>{r.spec=e},[e]),r}(e,t),s=function(e){const{accept:t}=e;return(0,o.useMemo)(()=>(Ug(null!=e.accept,"accept must be defined"),Array.isArray(t)?t:[t]),[t])}(e);zg(function(){const[e,o]=function(e,t,r){const n=r.getRegistry(),a=n.addTarget(e,t);return[a,()=>n.removeTarget(a)]}(s,a,n);return t.receiveHandlerId(e),r.receiveHandlerId(e),o},[n,t,a,r,s.map(e=>e.toString()).join("|")])}function mv(e,t){const r=Vg(e,t),n=function(){const e=ev();return(0,o.useMemo)(()=>new dv(e),[e])}(),a=function(e){const t=ev(),r=(0,o.useMemo)(()=>new lv(t.getBackend()),[t]);return zg(()=>(r.dropTargetOptions=e||null,r.reconnect(),()=>r.disconnectDropTarget()),[e]),r}(r.options);return hv(r,n,a),[qg(r.collect,n,a),iv(a)]}function pv(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var fv="function"===typeof Symbol&&Symbol.observable||"@@observable",gv=function(){return Math.random().toString(36).substring(7).split("").join(".")},vv={INIT:"@@redux/INIT"+gv(),REPLACE:"@@redux/REPLACE"+gv(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+gv()}};function xv(e){if("object"!==typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function bv(e,t,r){var n;if("function"===typeof t&&"function"===typeof r||"function"===typeof r&&"function"===typeof arguments[3])throw new Error(pv(0));if("function"===typeof t&&"undefined"===typeof r&&(r=t,t=void 0),"undefined"!==typeof r){if("function"!==typeof r)throw new Error(pv(1));return r(bv)(e,t)}if("function"!==typeof e)throw new Error(pv(2));var a=e,s=t,o=[],i=o,l=!1;function c(){i===o&&(i=o.slice())}function d(){if(l)throw new Error(pv(3));return s}function u(e){if("function"!==typeof e)throw new Error(pv(4));if(l)throw new Error(pv(5));var t=!0;return c(),i.push(e),function(){if(t){if(l)throw new Error(pv(6));t=!1,c();var r=i.indexOf(e);i.splice(r,1),o=null}}}function h(e){if(!xv(e))throw new Error(pv(7));if("undefined"===typeof e.type)throw new Error(pv(8));if(l)throw new Error(pv(9));try{l=!0,s=a(s,e)}finally{l=!1}for(var t=o=i,r=0;r<t.length;r++){(0,t[r])()}return e}return h({type:vv.INIT}),(n={dispatch:h,subscribe:u,getState:d,replaceReducer:function(e){if("function"!==typeof e)throw new Error(pv(10));a=e,h({type:vv.REPLACE})}})[fv]=function(){var e,t=u;return(e={subscribe:function(e){if("object"!==typeof e||null===e)throw new Error(pv(11));function r(){e.next&&e.next(d())}return r(),{unsubscribe:t(r)}}})[fv]=function(){return this},e},n}function yv(e){return"object"===typeof e}const wv="dnd-core/INIT_COORDS",jv="dnd-core/BEGIN_DRAG",Nv="dnd-core/PUBLISH_DRAG_SOURCE",Sv="dnd-core/HOVER",kv="dnd-core/DROP",Av="dnd-core/END_DRAG";function Cv(e,t){return{type:wv,payload:{sourceClientOffset:t||null,clientOffset:e||null}}}const Ev={type:wv,payload:{clientOffset:null,sourceClientOffset:null}};function Pv(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{publishSource:!0};const{publishSource:n=!0,clientOffset:a,getSourceClientOffset:s}=r,o=e.getMonitor(),i=e.getRegistry();e.dispatch(Cv(a)),function(e,t,r){Ug(!t.isDragging(),"Cannot call beginDrag while dragging."),e.forEach(function(e){Ug(r.getSource(e),"Expected sourceIds to be registered.")})}(t,o,i);const l=function(e,t){let r=null;for(let n=e.length-1;n>=0;n--)if(t.canDragSource(e[n])){r=e[n];break}return r}(t,o);if(null==l)return void e.dispatch(Ev);let c=null;if(a){if(!s)throw new Error("getSourceClientOffset must be defined");!function(e){Ug("function"===typeof e,"When clientOffset is provided, getSourceClientOffset must be a function.")}(s),c=s(l)}e.dispatch(Cv(a,c));const d=i.getSource(l).beginDrag(o,l);if(null==d)return;!function(e){Ug(yv(e),"Item must be an object.")}(d),i.pinSource(l);const u=i.getSourceType(l);return{type:jv,payload:{itemType:u,item:d,sourceId:l,clientOffset:a||null,sourceClientOffset:c||null,isSourcePublic:!!n}}}}function _v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Iv(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_v(e,t,r[t])})}return e}function Tv(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=e.getMonitor(),n=e.getRegistry();!function(e){Ug(e.isDragging(),"Cannot call drop while not dragging."),Ug(!e.didDrop(),"Cannot call drop twice during one drag operation.")}(r);const a=function(e){const t=e.getTargetIds().filter(e.canDropOnTarget,e);return t.reverse(),t}(r);a.forEach((a,s)=>{const o=function(e,t,r,n){const a=r.getTarget(e);let s=a?a.drop(n,e):void 0;(function(e){Ug("undefined"===typeof e||yv(e),"Drop result must either be an object or undefined.")})(s),"undefined"===typeof s&&(s=0===t?{}:n.getDropResult());return s}(a,s,n,r),i={type:kv,payload:{dropResult:Iv({},t,o)}};e.dispatch(i)})}}function Lv(e){return function(){const t=e.getMonitor(),r=e.getRegistry();!function(e){Ug(e.isDragging(),"Cannot call endDrag while not dragging.")}(t);const n=t.getSourceId();if(null!=n){r.getSource(n,!0).endDrag(t,n),r.unpinSource()}return{type:Av}}}function Dv(e,t){return null===t?null===e:Array.isArray(e)?e.some(e=>e===t):e===t}function Mv(e){return function(t){let{clientOffset:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e){Ug(Array.isArray(e),"Expected targetIds to be an array.")}(t);const n=t.slice(0),a=e.getMonitor(),s=e.getRegistry();return function(e,t,r){for(let n=e.length-1;n>=0;n--){const a=e[n];Dv(t.getTargetType(a),r)||e.splice(n,1)}}(n,s,a.getItemType()),function(e,t,r){Ug(t.isDragging(),"Cannot call hover while not dragging."),Ug(!t.didDrop(),"Cannot call hover after drop.");for(let n=0;n<e.length;n++){const t=e[n];Ug(e.lastIndexOf(t)===n,"Expected targetIds to be unique in the passed array.");Ug(r.getTarget(t),"Expected targetIds to be registered.")}}(n,a,s),function(e,t,r){e.forEach(function(e){r.getTarget(e).hover(t,e)})}(n,a,s),{type:Sv,payload:{targetIds:n,clientOffset:r||null}}}}function Ov(e){return function(){if(e.getMonitor().isDragging())return{type:Nv}}}class Rv{receiveBackend(e){this.backend=e}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){const e=this,{dispatch:t}=this.store;const r=function(e){return{beginDrag:Pv(e),publishDragSource:Ov(e),hover:Mv(e),drop:Tv(e),endDrag:Lv(e)}}(this);return Object.keys(r).reduce((n,a)=>{const s=r[a];var o;return n[a]=(o=s,function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];const s=o.apply(e,n);"undefined"!==typeof s&&t(s)}),n},{})}dispatch(e){this.store.dispatch(e)}constructor(e,t){this.isSetUp=!1,this.handleRefCountChange=()=>{const e=this.store.getState().refCount>0;this.backend&&(e&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!e&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=e,this.monitor=t,e.subscribe(this.handleRefCountChange)}}function Fv(e,t){return{x:e.x-t.x,y:e.y-t.y}}const Uv=[],Bv=[];Uv.__IS_NONE__=!0,Bv.__IS_ALL__=!0;class zv{subscribeToStateChange(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{handlerIds:r}=t;Ug("function"===typeof e,"listener must be a function."),Ug("undefined"===typeof r||Array.isArray(r),"handlerIds, when specified, must be an array of strings.");let n=this.store.getState().stateId;return this.store.subscribe(()=>{const t=this.store.getState(),a=t.stateId;try{const s=a===n||a===n+1&&!function(e,t){if(e===Uv)return!1;if(e===Bv||"undefined"===typeof t)return!0;const r=(n=e,t.filter(e=>n.indexOf(e)>-1));var n;return r.length>0}(t.dirtyHandlerIds,r);s||e()}finally{n=a}})}subscribeToOffsetChange(e){Ug("function"===typeof e,"listener must be a function.");let t=this.store.getState().dragOffset;return this.store.subscribe(()=>{const r=this.store.getState().dragOffset;r!==t&&(t=r,e())})}canDragSource(e){if(!e)return!1;const t=this.registry.getSource(e);return Ug(t,"Expected to find a valid source. sourceId=".concat(e)),!this.isDragging()&&t.canDrag(this,e)}canDropOnTarget(e){if(!e)return!1;const t=this.registry.getTarget(e);if(Ug(t,"Expected to find a valid target. targetId=".concat(e)),!this.isDragging()||this.didDrop())return!1;return Dv(this.registry.getTargetType(e),this.getItemType())&&t.canDrop(this,e)}isDragging(){return Boolean(this.getItemType())}isDraggingSource(e){if(!e)return!1;const t=this.registry.getSource(e,!0);if(Ug(t,"Expected to find a valid source. sourceId=".concat(e)),!this.isDragging()||!this.isSourcePublic())return!1;return this.registry.getSourceType(e)===this.getItemType()&&t.isDragging(this,e)}isOverTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shallow:!1};if(!e)return!1;const{shallow:r}=t;if(!this.isDragging())return!1;const n=this.registry.getTargetType(e),a=this.getItemType();if(a&&!Dv(n,a))return!1;const s=this.getTargetIds();if(!s.length)return!1;const o=s.indexOf(e);return r?o===s.length-1:o>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return Boolean(this.store.getState().dragOperation.isSourcePublic)}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return function(e){const{clientOffset:t,initialClientOffset:r,initialSourceClientOffset:n}=e;return t&&r&&n?Fv(function(e,t){return{x:e.x+t.x,y:e.y+t.y}}(t,n),r):null}(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return function(e){const{clientOffset:t,initialClientOffset:r}=e;return t&&r?Fv(t,r):null}(this.store.getState().dragOffset)}constructor(e,t){this.store=e,this.registry=t}}const Wv="undefined"!==typeof global?global:self,qv=Wv.MutationObserver||Wv.WebKitMutationObserver;function Vv(e){return function(){const t=setTimeout(n,0),r=setInterval(n,50);function n(){clearTimeout(t),clearInterval(r),e()}}}const Hv="function"===typeof qv?function(e){let t=1;const r=new qv(e),n=document.createTextNode("");return r.observe(n,{characterData:!0}),function(){t=-t,n.data=t}}:Vv;class Gv{call(){try{this.task&&this.task()}catch(e){this.onError(e)}finally{this.task=null,this.release(this)}}constructor(e,t){this.onError=e,this.release=t,this.task=null}}const Kv=new class{enqueueTask(e){const{queue:t,requestFlush:r}=this;t.length||(r(),this.flushing=!0),t[t.length]=e}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{const{queue:e}=this;for(;this.index<e.length;){const t=this.index;if(this.index++,e[t].call(),this.index>this.capacity){for(let t=0,r=e.length-this.index;t<r;t++)e[t]=e[t+this.index];e.length-=this.index,this.index=0}}e.length=0,this.index=0,this.flushing=!1},this.registerPendingError=e=>{this.pendingErrors.push(e),this.requestErrorThrow()},this.requestFlush=Hv(this.flush),this.requestErrorThrow=Vv(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}},Jv=new class{create(e){const t=this.freeTasks,r=t.length?t.pop():new Gv(this.onError,e=>t[t.length]=e);return r.task=e,r}constructor(e){this.onError=e,this.freeTasks=[]}}(Kv.registerPendingError);const Yv="dnd-core/ADD_SOURCE",Xv="dnd-core/ADD_TARGET",Qv="dnd-core/REMOVE_SOURCE",Zv="dnd-core/REMOVE_TARGET";function $v(e,t){t&&Array.isArray(e)?e.forEach(e=>$v(e,!1)):Ug("string"===typeof e||"symbol"===typeof e,t?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}var ex;!function(e){e.SOURCE="SOURCE",e.TARGET="TARGET"}(ex||(ex={}));let tx=0;function rx(e){const t=(tx++).toString();switch(e){case ex.SOURCE:return"S".concat(t);case ex.TARGET:return"T".concat(t);default:throw new Error("Unknown Handler Role: ".concat(e))}}function nx(e){switch(e[0]){case"S":return ex.SOURCE;case"T":return ex.TARGET;default:throw new Error("Cannot parse handler ID: ".concat(e))}}function ax(e,t){const r=e.entries();let n=!1;do{const{done:e,value:[,a]}=r.next();if(a===t)return!0;n=!!e}while(!n);return!1}class sx{addSource(e,t){$v(e),function(e){Ug("function"===typeof e.canDrag,"Expected canDrag to be a function."),Ug("function"===typeof e.beginDrag,"Expected beginDrag to be a function."),Ug("function"===typeof e.endDrag,"Expected endDrag to be a function.")}(t);const r=this.addHandler(ex.SOURCE,e,t);return this.store.dispatch(function(e){return{type:Yv,payload:{sourceId:e}}}(r)),r}addTarget(e,t){$v(e,!0),function(e){Ug("function"===typeof e.canDrop,"Expected canDrop to be a function."),Ug("function"===typeof e.hover,"Expected hover to be a function."),Ug("function"===typeof e.drop,"Expected beginDrag to be a function.")}(t);const r=this.addHandler(ex.TARGET,e,t);return this.store.dispatch(function(e){return{type:Xv,payload:{targetId:e}}}(r)),r}containsHandler(e){return ax(this.dragSources,e)||ax(this.dropTargets,e)}getSource(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Ug(this.isSourceId(e),"Expected a valid source ID.");return t&&e===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(e)}getTarget(e){return Ug(this.isTargetId(e),"Expected a valid target ID."),this.dropTargets.get(e)}getSourceType(e){return Ug(this.isSourceId(e),"Expected a valid source ID."),this.types.get(e)}getTargetType(e){return Ug(this.isTargetId(e),"Expected a valid target ID."),this.types.get(e)}isSourceId(e){return nx(e)===ex.SOURCE}isTargetId(e){return nx(e)===ex.TARGET}removeSource(e){var t;Ug(this.getSource(e),"Expected an existing source."),this.store.dispatch(function(e){return{type:Qv,payload:{sourceId:e}}}(e)),t=()=>{this.dragSources.delete(e),this.types.delete(e)},Kv.enqueueTask(Jv.create(t))}removeTarget(e){Ug(this.getTarget(e),"Expected an existing target."),this.store.dispatch(function(e){return{type:Zv,payload:{targetId:e}}}(e)),this.dropTargets.delete(e),this.types.delete(e)}pinSource(e){const t=this.getSource(e);Ug(t,"Expected an existing source."),this.pinnedSourceId=e,this.pinnedSource=t}unpinSource(){Ug(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(e,t,r){const n=rx(e);return this.types.set(n,t),e===ex.SOURCE?this.dragSources.set(n,r):e===ex.TARGET&&this.dropTargets.set(n,r),n}constructor(e){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=e}}const ox=(e,t)=>e===t;function ix(){let e=arguments.length>1?arguments[1]:void 0;switch(e.type){case Sv:break;case Yv:case Xv:case Zv:case Qv:return Uv;default:return Bv}const{targetIds:t=[],prevTargetIds:r=[]}=e.payload,n=function(e,t){const r=new Map,n=e=>{r.set(e,r.has(e)?r.get(e)+1:1)};e.forEach(n),t.forEach(n);const a=[];return r.forEach((e,t)=>{1===e&&a.push(t)}),a}(t,r),a=n.length>0||!function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ox;if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!r(e[n],t[n]))return!1;return!0}(t,r);if(!a)return Uv;const s=r[r.length-1],o=t[t.length-1];return s!==o&&(s&&n.push(s),o&&n.push(o)),n}function lx(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const cx={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function dx(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cx,t=arguments.length>1?arguments[1]:void 0;const{payload:r}=t;switch(t.type){case wv:case jv:return{initialSourceClientOffset:r.sourceClientOffset,initialClientOffset:r.clientOffset,clientOffset:r.clientOffset};case Sv:return n=e.clientOffset,a=r.clientOffset,!n&&!a||n&&a&&n.x===a.x&&n.y===a.y?e:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){lx(e,t,r[t])})}return e}({},e,{clientOffset:r.clientOffset});case Av:case kv:return cx;default:return e}var n,a}function ux(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){ux(e,t,r[t])})}return e}const mx={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function px(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mx,t=arguments.length>1?arguments[1]:void 0;const{payload:r}=t;switch(t.type){case jv:return hx({},e,{itemType:r.itemType,item:r.item,sourceId:r.sourceId,isSourcePublic:r.isSourcePublic,dropResult:null,didDrop:!1});case Nv:return hx({},e,{isSourcePublic:!0});case Sv:return hx({},e,{targetIds:r.targetIds});case Zv:return-1===e.targetIds.indexOf(r.targetId)?e:hx({},e,{targetIds:(n=e.targetIds,a=r.targetId,n.filter(e=>e!==a))});case kv:return hx({},e,{dropResult:r.dropResult,didDrop:!0,targetIds:[]});case Av:return hx({},e,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return e}var n,a}function fx(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch((arguments.length>1?arguments[1]:void 0).type){case Yv:case Xv:return e+1;case Qv:case Zv:return e-1;default:return e}}function gx(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)+1}function vx(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){vx(e,t,r[t])})}return e}function bx(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return{dirtyHandlerIds:ix(e.dirtyHandlerIds,{type:t.type,payload:xx({},t.payload,{prevTargetIds:(r=e,n="dragOperation.targetIds",a=[],n.split(".").reduce((e,t)=>e&&e[t]?e[t]:a||null,r))})}),dragOffset:dx(e.dragOffset,t),refCount:fx(e.refCount,t),dragOperation:px(e.dragOperation,t),stateId:gx(e.stateId)};var r,n,a}function yx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=function(e){const t="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__;return bv(bx,e&&t&&t({name:"dnd-core",instanceId:"dnd-core"}))}(arguments.length>3&&void 0!==arguments[3]&&arguments[3]),a=new zv(n,new sx(n)),s=new Rv(n,a),o=e(s,t,r);return s.receiveBackend(o),s}function wx(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}let jx=0;const Nx=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var Sx=(0,o.memo)(function(e){var{children:t}=e,r=wx(e,["children"]);const[n,a]=function(e){if("manager"in e){return[{dragDropManager:e.manager},!1]}const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kx(),r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const a=t;a[Nx]||(a[Nx]={dragDropManager:yx(e,t,r,n)});return a[Nx]}(e.backend,e.context,e.options,e.debugMode),r=!e.context;return[t,r]}(r);return(0,o.useEffect)(()=>{if(a){const e=kx();return++jx,()=>{0===--jx&&(e[Nx]=null)}}},[]),(0,kt.jsx)($g.Provider,{value:n,children:t})});function kx(){return"undefined"!==typeof global?global:window}function Ax(e){let t=null;return()=>(null==t&&(t=e()),t)}class Cx{enter(e){const t=this.entered.length;return this.entered=function(e,t){const r=new Set,n=e=>r.add(e);e.forEach(n),t.forEach(n);const a=[];return r.forEach(e=>a.push(e)),a}(this.entered.filter(t=>this.isNodeInDocument(t)&&(!t.contains||t.contains(e))),[e]),0===t&&this.entered.length>0}leave(e){const t=this.entered.length;var r,n;return this.entered=(r=this.entered.filter(this.isNodeInDocument),n=e,r.filter(e=>e!==n)),t>0&&0===this.entered.length}reset(){this.entered=[]}constructor(e){this.entered=[],this.isNodeInDocument=e}}class Ex{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(e=>{Object.defineProperty(this.item,e,{configurable:!0,enumerable:!0,get:()=>(console.warn("Browser doesn't allow reading \"".concat(e,'" until the drop event.')),null)})})}loadDataTransfer(e){if(e){const t={};Object.keys(this.config.exposeProperties).forEach(r=>{const n=this.config.exposeProperties[r];null!=n&&(t[r]={value:n(e,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,t)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(e,t){return t===e.getSourceId()}endDrag(){}constructor(e){this.config=e,this.item={},this.initializeExposedProperties()}}const Px="__NATIVE_FILE__",_x="__NATIVE_URL__",Ix="__NATIVE_TEXT__",Tx="__NATIVE_HTML__";function Lx(e,t,r){const n=t.reduce((t,r)=>t||e.getData(r),"");return null!=n?n:r}const Dx={[Px]:{exposeProperties:{files:e=>Array.prototype.slice.call(e.files),items:e=>e.items,dataTransfer:e=>e},matchesTypes:["Files"]},[Tx]:{exposeProperties:{html:(e,t)=>Lx(e,t,""),dataTransfer:e=>e},matchesTypes:["Html","text/html"]},[_x]:{exposeProperties:{urls:(e,t)=>Lx(e,t,"").split("\n"),dataTransfer:e=>e},matchesTypes:["Url","text/uri-list"]},[Ix]:{exposeProperties:{text:(e,t)=>Lx(e,t,""),dataTransfer:e=>e},matchesTypes:["Text","text/plain"]}};function Mx(e){if(!e)return null;const t=Array.prototype.slice.call(e.types||[]);return Object.keys(Dx).filter(e=>{const r=Dx[e];return!!(null===r||void 0===r?void 0:r.matchesTypes)&&r.matchesTypes.some(e=>t.indexOf(e)>-1)})[0]||null}const Ox=Ax(()=>/firefox/i.test(navigator.userAgent)),Rx=Ax(()=>Boolean(window.safari));class Fx{interpolate(e){const{xs:t,ys:r,c1s:n,c2s:a,c3s:s}=this;let o=t.length-1;if(e===t[o])return r[o];let i,l=0,c=s.length-1;for(;l<=c;){i=Math.floor(.5*(l+c));const n=t[i];if(n<e)l=i+1;else{if(!(n>e))return r[i];c=i-1}}o=Math.max(0,c);const d=e-t[o],u=d*d;return r[o]+n[o]*d+a[o]*u+s[o]*d*u}constructor(e,t){const{length:r}=e,n=[];for(let m=0;m<r;m++)n.push(m);n.sort((t,r)=>e[t]<e[r]?-1:1);const a=[],s=[],o=[];let i,l;for(let m=0;m<r-1;m++)i=e[m+1]-e[m],l=t[m+1]-t[m],s.push(i),a.push(l),o.push(l/i);const c=[o[0]];for(let m=0;m<s.length-1;m++){const e=o[m],t=o[m+1];if(e*t<=0)c.push(0);else{i=s[m];const r=s[m+1],n=i+r;c.push(3*n/((n+r)/e+(n+i)/t))}}c.push(o[o.length-1]);const d=[],u=[];let h;for(let m=0;m<c.length-1;m++){h=o[m];const e=c[m],t=1/s[m],r=e+c[m+1]-h-h;d.push((h-e-r)*t),u.push(r*t*t)}this.xs=e,this.ys=t,this.c1s=c,this.c2s=d,this.c3s=u}}function Ux(e){const t=1===e.nodeType?e:e.parentElement;if(!t)return null;const{top:r,left:n}=t.getBoundingClientRect();return{x:n,y:r}}function Bx(e){return{x:e.clientX,y:e.clientY}}function zx(e,t,r,n,a){const s=function(e){var t;return"IMG"===e.nodeName&&(Ox()||!(null===(t=document.documentElement)||void 0===t?void 0:t.contains(e)))}(t),o=Ux(s?e:t),i={x:r.x-o.x,y:r.y-o.y},{offsetWidth:l,offsetHeight:c}=e,{anchorX:d,anchorY:u}=n,{dragPreviewWidth:h,dragPreviewHeight:m}=function(e,t,r,n){let a=e?t.width:r,s=e?t.height:n;return Rx()&&e&&(s/=window.devicePixelRatio,a/=window.devicePixelRatio),{dragPreviewWidth:a,dragPreviewHeight:s}}(s,t,l,c),{offsetX:p,offsetY:f}=a,g=0===f||f;return{x:0===p||p?p:new Fx([0,.5,1],[i.x,i.x/l*h,i.x+h-l]).interpolate(d),y:g?f:(()=>{let e=new Fx([0,.5,1],[i.y,i.y/c*m,i.y+m-c]).interpolate(u);return Rx()&&s&&(e+=(window.devicePixelRatio-1)*m),e})()}}class Wx{get window(){return this.globalContext?this.globalContext:"undefined"!==typeof window?window:void 0}get document(){var e;return(null===(e=this.globalContext)||void 0===e?void 0:e.document)?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var e;return(null===(e=this.optionsArgs)||void 0===e?void 0:e.rootElement)||this.window}constructor(e,t){this.ownerDocument=null,this.globalContext=e,this.optionsArgs=t}}function qx(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){qx(e,t,r[t])})}return e}class Hx{profile(){var e,t;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:(null===(e=this.dragStartSourceIds)||void 0===e?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:(null===(t=this.dragOverTargetIds)||void 0===t?void 0:t.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){const e=this.rootElement;if(void 0!==e){if(e.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}teardown(){const e=this.rootElement;var t;void 0!==e&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId&&(null===(t=this.window)||void 0===t||t.cancelAnimationFrame(this.asyncEndDragFrameId)))}connectDragPreview(e,t,r){return this.sourcePreviewNodeOptions.set(e,r),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDragSource(e,t,r){this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,r);const n=t=>this.handleDragStart(t,e),a=e=>this.handleSelectStart(e);return t.setAttribute("draggable","true"),t.addEventListener("dragstart",n),t.addEventListener("selectstart",a),()=>{this.sourceNodes.delete(e),this.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",n),t.removeEventListener("selectstart",a),t.setAttribute("draggable","false")}}connectDropTarget(e,t){const r=t=>this.handleDragEnter(t,e),n=t=>this.handleDragOver(t,e),a=t=>this.handleDrop(t,e);return t.addEventListener("dragenter",r),t.addEventListener("dragover",n),t.addEventListener("drop",a),()=>{t.removeEventListener("dragenter",r),t.removeEventListener("dragover",n),t.removeEventListener("drop",a)}}addEventListeners(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return Vx({dropEffect:this.altKeyPressed?"copy":"move"},t||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const e=this.monitor.getSourceId();return Vx({anchorX:.5,anchorY:.5,captureDraggingState:!1},this.sourcePreviewNodeOptions.get(e)||{})}isDraggingNativeItem(){const e=this.monitor.getItemType();return Object.keys(a).some(t=>a[t]===e)}beginDragNativeItem(e,t){this.clearCurrentDragSourceNode(),this.currentNativeSource=function(e,t){const r=Dx[e];if(!r)throw new Error("native type ".concat(e," has no configuration"));const n=new Ex(r);return n.loadDataTransfer(t),n}(e,t),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(e){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;this.mouseMoveTimeoutTimer=setTimeout(()=>{var e;return null===(e=this.rootElement)||void 0===e?void 0:e.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},1e3)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){var e;if(this.currentDragSourceNode=null,this.rootElement)null===(e=this.window)||void 0===e||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0);return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(e,t){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t))}handleDragEnter(e,t){this.dragEnterTargetIds.unshift(t)}handleDragOver(e,t){null===this.dragOverTargetIds&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)}handleDrop(e,t){this.dropTargetIds.unshift(t)}constructor(e,t,r){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=e=>{const t=this.sourceNodes.get(e);return t&&Ux(t)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=e=>Boolean(e&&this.document&&this.document.body&&this.document.body.contains(e)),this.endDragIfSourceWasRemovedFromDOM=()=>{const e=this.currentDragSourceNode;null==e||this.isNodeInDocument(e)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=e=>{null===this.hoverRafId&&"undefined"!==typeof requestAnimationFrame&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(e||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{null!==this.hoverRafId&&"undefined"!==typeof cancelAnimationFrame&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=e=>{if(e.defaultPrevented)return;const{dragStartSourceIds:t}=this;this.dragStartSourceIds=null;const r=Bx(e);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(t||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:r});const{dataTransfer:n}=e,a=Mx(n);if(this.monitor.isDragging()){if(n&&"function"===typeof n.setDragImage){const e=this.monitor.getSourceId(),t=this.sourceNodes.get(e),a=this.sourcePreviewNodes.get(e)||t;if(a){const{anchorX:e,anchorY:s,offsetX:o,offsetY:i}=this.getCurrentSourcePreviewNodeOptions(),l=zx(t,a,r,{anchorX:e,anchorY:s},{offsetX:o,offsetY:i});n.setDragImage(a,l.x,l.y)}}try{null===n||void 0===n||n.setData("application/json",{})}catch(XI){}this.setCurrentDragSourceNode(e.target);const{captureDraggingState:t}=this.getCurrentSourcePreviewNodeOptions();t?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(a)this.beginDragNativeItem(a);else{if(n&&!n.types&&(e.target&&!e.target.hasAttribute||!e.target.hasAttribute("draggable")))return;e.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=e=>{var t;(this.dragEnterTargetIds=[],this.isDraggingNativeItem())&&(null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer));if(!this.enterLeaveCounter.enter(e.target)||this.monitor.isDragging())return;const{dataTransfer:r}=e,n=Mx(r);n&&this.beginDragNativeItem(n,r)},this.handleTopDragEnter=e=>{const{dragEnterTargetIds:t}=this;if(this.dragEnterTargetIds=[],!this.monitor.isDragging())return;this.altKeyPressed=e.altKey,t.length>0&&this.actions.hover(t,{clientOffset:Bx(e)});t.some(e=>this.monitor.canDropOnTarget(e))&&(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect()))},this.handleTopDragOverCapture=e=>{var t;(this.dragOverTargetIds=[],this.isDraggingNativeItem())&&(null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer))},this.handleTopDragOver=e=>{const{dragOverTargetIds:t}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging())return e.preventDefault(),void(e.dataTransfer&&(e.dataTransfer.dropEffect="none"));this.altKeyPressed=e.altKey,this.lastClientOffset=Bx(e),this.scheduleHover(t);(t||[]).some(e=>this.monitor.canDropOnTarget(e))?(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?e.preventDefault():(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=e=>{this.isDraggingNativeItem()&&e.preventDefault();this.enterLeaveCounter.leave(e.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=e=>{var t;(this.dropTargetIds=[],this.isDraggingNativeItem())?(e.preventDefault(),null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer)):Mx(e.dataTransfer)&&e.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=e=>{const{dropTargetIds:t}=this;this.dropTargetIds=[],this.actions.hover(t,{clientOffset:Bx(e)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=e=>{const t=e.target;"function"===typeof t.dragDrop&&("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||(e.preventDefault(),t.dragDrop()))},this.options=new Wx(t,r),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.enterLeaveCounter=new Cx(this.isNodeInDocument)}}const Gx=function(e,t,r){return new Hx(e,t,r)},Kx="user",Jx=e=>{var t,r;let{user:n,isAssigned:a=!1,onRemove:s=null,colorMode:o,sourceRole:i=null}=e;const[{isDragging:l},c]=ov({type:Kx,item:()=>({user:n,isAssigned:a,sourceRole:i}),collect:e=>({isDragging:e.isDragging()})});return(0,kt.jsxs)("div",{ref:c,className:"\n        flex items-center justify-between p-2 rounded-lg cursor-move transition-all duration-200\n        ".concat(l?"opacity-50 scale-95":"opacity-100","\n        ").concat(a?o?"bg-blue-900/20 border border-blue-500/30 text-blue-100":"bg-blue-50 border border-blue-200 text-blue-900":o?"bg-gray-800/50 border border-gray-600 text-gray-200 hover:bg-gray-700/50":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50","\n        hover:shadow-md\n      "),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ".concat(o?"bg-blue-600 text-white":"bg-blue-500 text-white"),children:(null===(t=n.firstName)||void 0===t?void 0:t[0])||(null===(r=n.name)||void 0===r?void 0:r[0])||"?"}),(0,kt.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,kt.jsx)("div",{className:"font-medium text-sm truncate",children:n.firstName&&n.lastName?"".concat(n.firstName," ").concat(n.lastName):n.name}),n.email&&(0,kt.jsx)("div",{className:"text-xs truncate ".concat(o?"text-gray-400":"text-gray-500"),children:n.email})]})]}),(0,kt.jsx)("div",{className:"p-1 rounded text-gray-400 hover:text-gray-600 transition-colors",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16"})})}),a&&s&&(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),s(n.id)},className:"w-6 h-6 rounded-full flex items-center justify-center text-sm hover:scale-110 transition-transform ".concat(o?"bg-red-900/50 text-red-300 hover:bg-red-800":"bg-red-100 text-red-600 hover:bg-red-200"),children:"\xd7"})]})},Yx=e=>{let{roleType:t,roleName:r,icon:n,colorScheme:a,users:s,onAddUser:o,onRemoveUser:i,colorMode:l}=e;const[{isOver:c,canDrop:d},u]=mv({accept:Kx,drop:e=>{e.sourceRole!==t&&o(t,e.user,e.sourceRole)},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})}),h=(e=>{const t={purple:{bg:l?"bg-purple-900/10":"bg-purple-50",border:l?"border-purple-500/30":"border-purple-200",hoverBg:l?"bg-purple-800/20":"bg-purple-100",hoverBorder:l?"border-purple-400":"border-purple-300",text:l?"text-purple-200":"text-purple-900",accent:"purple"},orange:{bg:l?"bg-orange-900/10":"bg-orange-50",border:l?"border-orange-500/30":"border-orange-200",hoverBg:l?"bg-orange-800/20":"bg-orange-100",hoverBorder:l?"border-orange-400":"border-orange-300",text:l?"text-orange-200":"text-orange-900",accent:"orange"},green:{bg:l?"bg-green-900/10":"bg-green-50",border:l?"border-green-500/30":"border-green-200",hoverBg:l?"bg-green-800/20":"bg-green-100",hoverBorder:l?"border-green-400":"border-green-300",text:l?"text-green-200":"text-green-900",accent:"green"},red:{bg:l?"bg-red-900/10":"bg-red-50",border:l?"border-red-500/30":"border-red-200",hoverBg:l?"bg-red-800/20":"bg-red-100",hoverBorder:l?"border-red-400":"border-red-300",text:l?"text-red-200":"text-red-900",accent:"red"},blue:{bg:l?"bg-blue-900/10":"bg-blue-50",border:l?"border-blue-500/30":"border-blue-200",hoverBg:l?"bg-blue-800/20":"bg-blue-100",hoverBorder:l?"border-blue-400":"border-blue-300",text:l?"text-blue-200":"text-blue-900",accent:"blue"},teal:{bg:l?"bg-teal-900/10":"bg-teal-50",border:l?"border-teal-500/30":"border-teal-200",hoverBg:l?"bg-teal-800/20":"bg-teal-100",hoverBorder:l?"border-teal-400":"border-teal-300",text:l?"text-teal-200":"text-teal-900",accent:"teal"}};return t[e]||t.purple})(a);return(0,kt.jsxs)("div",{ref:u,className:"\n        border-2 border-dashed rounded-xl p-4 min-h-[120px] transition-all duration-200 shadow-sm\n        ".concat(c&&d?"".concat(h.hoverBg," ").concat(h.hoverBorder," shadow-lg scale-[1.02]"):"".concat(h.bg," ").concat(h.border),"\n      "),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-lg",children:n}),(0,kt.jsx)("h4",{className:"font-semibold text-sm ".concat(h.text),children:r})]}),(0,kt.jsx)("span",{className:"text-xs px-2 py-1 rounded-full font-medium ".concat(l?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"),children:s.length})]}),(0,kt.jsx)("div",{className:"space-y-2 max-h-[80px] overflow-y-auto",children:s.length>0?s.map(e=>{var r,n;return(0,kt.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg text-sm border ".concat(l?"bg-gray-800/50 border-gray-600":"bg-white border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-semibold ".concat(l?"bg-blue-600 text-white":"bg-blue-500 text-white"),children:(null===(r=e.firstName)||void 0===r?void 0:r[0])||(null===(n=e.name)||void 0===n?void 0:n[0])||"?"}),(0,kt.jsx)("span",{className:"font-medium text-sm truncate",children:e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.name})]}),(0,kt.jsx)("button",{onClick:()=>i(t,e.id),className:"w-5 h-5 rounded-full flex items-center justify-center text-xs hover:scale-110 transition-transform ".concat(l?"bg-red-900/50 text-red-300 hover:bg-red-800":"bg-red-100 text-red-600 hover:bg-red-200"),children:"\xd7"})]},e.id)}):(0,kt.jsxs)("div",{className:"\n            text-center py-4 text-sm rounded-lg border-2 border-dashed\n            ".concat(l?"text-gray-400 border-gray-600":"text-gray-500 border-gray-300","\n          "),children:[(0,kt.jsx)("div",{className:"mb-2 text-lg",children:"\ud83d\udc64"}),"Drop users here"]})})]})},Xx=e=>{let{colorMode:t,roleAssignments:r,setRoleAssignments:n,availableUsers:a,saveRoleAssignments:s}=e;const[i,l]=(0,o.useState)(""),c=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{l("Saving...");let o=(0,Y.A)({},r);a&&a!==e&&(o[a]=(o[a]||[]).filter(e=>e.id!==t.id)),o[e]||(o[e]=[]),o[e].find(e=>e.id===t.id)||(o[e]=[...o[e],t]),n(o),await s(o);const i=u(e),c=t.firstName&&t.lastName?"".concat(t.firstName," ").concat(t.lastName):t.name;a&&a!==e?qr.success("".concat(c," moved to ").concat(i),{duration:2e3}):qr.success("".concat(c," assigned to ").concat(i),{duration:2e3}),l("")}catch(o){console.error("Failed to save role assignments:",o),n(r),qr.error("Failed to assign role: ".concat(o.message||"Unknown error"),{duration:3e3}),l("")}},d=async(e,t)=>{try{const a=(r[e]||[]).find(e=>e.id===t),o=a?a.firstName&&a.lastName?"".concat(a.firstName," ").concat(a.lastName):a.name:"User",i=(0,Y.A)((0,Y.A)({},r),{},{[e]:(r[e]||[]).filter(e=>e.id!==t)});n(i),await s(i);const l=u(e);qr.success("".concat(o," removed from ").concat(l),{duration:2e3})}catch(a){console.error("Failed to save role assignments:",a),n(r),qr.error("Failed to remove role: ".concat(a.message||"Unknown error"),{duration:3e3})}},u=e=>({projectManager:"Project Manager",fieldDirector:"Field Director",officeStaff:"Office Staff",administration:"Administration",subcontractor:"Subcontractor",locationManager:"Location Manager"}[e]||e),h=()=>{const e=Object.values(r).flat().map(e=>e.id);return a.filter(t=>!e.includes(t.id))};return(0,kt.jsx)(Sx,{backend:Gx,children:(0,kt.jsxs)("div",{className:"h-full flex flex-col",children:[(0,kt.jsx)("div",{className:"border-b rounded-t-xl p-4 shadow-sm ".concat(t?"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border-blue-500/30":"bg-[#F8FAFC] border-blue-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(t?"bg-blue-600 text-white":"bg-blue-500 text-white"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"font-bold text-lg ".concat(t?"text-white":"text-gray-900"),children:"Role Management"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-blue-200":"text-blue-700"),children:"Drag and drop users to assign roles. Changes save automatically."})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsxs)("div",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(t?"bg-blue-800/50 text-blue-200":"bg-blue-100 text-blue-800"),children:[h().length," available"]}),i&&(0,kt.jsx)("div",{className:"text-sm font-medium text-blue-600 animate-pulse",children:i})]})]})}),(0,kt.jsx)("div",{className:"flex-1 p-4 overflow-hidden",children:(0,kt.jsxs)("div",{className:"h-full grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{className:"border rounded-xl p-4 shadow-sm ".concat(t?"bg-gray-800/50 border-gray-600":"bg-white border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,kt.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center ".concat(t?"bg-green-600 text-white":"bg-green-500 text-white"),children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),(0,kt.jsx)("h4",{className:"font-semibold text-sm ".concat(t?"text-white":"text-gray-900"),children:"Available Users"})]}),(0,kt.jsxs)("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:[h().map(e=>(0,kt.jsx)(Jx,{user:e,colorMode:t,sourceRole:null},e.id)),0===h().length&&(0,kt.jsxs)("div",{className:"text-center py-8 text-sm rounded-lg border-2 border-dashed ".concat(t?"text-gray-400 border-gray-600":"text-gray-500 border-gray-300"),children:[(0,kt.jsx)("div",{className:"mb-2 text-2xl",children:"\u2705"}),"All users assigned"]})]})]}),(0,kt.jsxs)("div",{className:"lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,kt.jsx)(Yx,{roleType:"projectManager",roleName:"Project Manager",icon:"\ud83c\udfaf",colorScheme:"purple",users:r.projectManager||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Yx,{roleType:"fieldDirector",roleName:"Field Director",icon:"\ud83c\udfd7\ufe0f",colorScheme:"orange",users:r.fieldDirector||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Yx,{roleType:"officeStaff",roleName:"Office Staff",icon:"\ud83d\udccb",colorScheme:"green",users:r.officeStaff||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Yx,{roleType:"administration",roleName:"Administration",icon:"\u2699\ufe0f",colorScheme:"red",users:r.administration||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Yx,{roleType:"subcontractor",roleName:"Subcontractor",icon:"\ud83d\udd28",colorScheme:"blue",users:r.subcontractor||[],onAddUser:c,onRemoveUser:d,colorMode:t}),(0,kt.jsx)(Yx,{roleType:"locationManager",roleName:"Location Manager",icon:"\ud83d\udccd",colorScheme:"teal",users:r.locationManager||[],onAddUser:c,onRemoveUser:d,colorMode:t})]})]})})]})})},Qx=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)([]),[a,s]=(0,o.useState)({}),[i,l]=(0,o.useState)(!0);(0,o.useEffect)(()=>{c()},[]);const c=async()=>{try{const[e,t]=await Promise.all([fetch("/api/follow-up/tracking",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),fetch("/api/follow-up/stats",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})]),[r,a]=await Promise.all([e.json(),t.json()]);r.success&&n(r.data.tracking),a.success&&s(a.data)}catch(e){console.error("Error loading follow-up data:",e)}finally{l(!1)}},d=async e=>{try{const t=await fetch("/api/follow-up/tracking/".concat(e,"/complete"),{method:"PUT",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});(await t.json()).success&&c()}catch(t){console.error("Error completing follow-up:",t)}},u=e=>{switch(e){case"PENDING":return"text-yellow-600 bg-yellow-100";case"SENT":return"text-blue-600 bg-blue-100";case"COMPLETED":return"text-green-600 bg-green-100";case"CANCELLED":default:return"text-gray-600 bg-gray-100";case"FAILED":return"text-red-600 bg-red-100"}};return i?(0,kt.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,kt.jsx)("div",{className:"space-y-2",children:(0,kt.jsx)("div",{className:"space-y-2",children:0===r.length?(0,kt.jsx)("div",{className:"text-center py-8 ".concat(t?"text-gray-400":"text-gray-500"),children:"No follow-ups found"}):r.map(e=>{return(0,kt.jsx)("div",{className:"p-4 rounded border ".concat(t?"bg-[#181f3a] border-[#3b82f6]":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,kt.jsx)("span",{className:"px-2 py-1 rounded text-xs font-semibold ".concat(u(e.status)),children:e.status}),(0,kt.jsx)("span",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:e.originalItemType})]}),(0,kt.jsxs)("div",{className:"text-sm ".concat(t?"text-white":"text-gray-800"),children:["Project: ",e.project.projectName," (#",e.project.projectNumber,")"]}),(0,kt.jsxs)("div",{className:"text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:["Scheduled for: ",(r=e.scheduledFor,new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]}),e.metadata&&(0,kt.jsxs)("div",{className:"text-xs mt-1 ".concat(t?"text-gray-300":"text-gray-600"),children:["TASK"===e.originalItemType&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{children:["Task: ",e.metadata.taskTitle]}),(0,kt.jsxs)("div",{children:["Priority: ",e.metadata.taskPriority]}),e.metadata.taskDueDate&&(0,kt.jsxs)("div",{children:["Due: ",new Date(e.metadata.taskDueDate).toLocaleDateString()]})]}),"WORKFLOW_ALERT"===e.originalItemType&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{children:["Alert: ",e.metadata.alertTitle]}),(0,kt.jsxs)("div",{children:["Priority: ",e.metadata.alertPriority]}),e.metadata.stepName&&(0,kt.jsxs)("div",{children:["Step: ",e.metadata.stepName]})]})]}),e.followUpMessage&&(0,kt.jsxs)("div",{className:"text-xs mt-1 ".concat(t?"text-gray-300":"text-gray-600"),children:["Follow-up Message: ",e.followUpMessage]})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:["PENDING"===e.status&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:()=>d(e.id),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"Complete"}),(0,kt.jsx)("button",{onClick:()=>(async(e,t)=>{try{const r=await fetch("/api/follow-up/tracking/".concat(e,"/cancel"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({reason:t})});(await r.json()).success&&c()}catch(r){console.error("Error cancelling follow-up:",r)}})(e.id,"User cancelled"),className:"px-3 py-1 bg-gray-600 text-white text-xs rounded hover:bg-gray-700",children:"Cancel"})]}),"SENT"===e.status&&(0,kt.jsx)("button",{onClick:()=>d(e.id),className:"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700",children:"Mark Complete"})]})]})},e.id);var r})})})};const Zx=new class{constructor(){this.baseURL="".concat(Da.API_BASE_URL,"/permissions")}getAuthHeaders(){const e=localStorage.getItem("authToken");return console.log("\ud83d\udd0d PERMISSION SERVICE: Token found:",e?"Yes":"No"),{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}async getAllPermissions(){try{const e=await fetch("".concat(this.baseURL),{method:"GET",headers:this.getAuthHeaders()});if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){throw console.error("Failed to fetch permissions:",e),e}}async getRolePermissions(e){try{const t=await fetch("".concat(this.baseURL,"/role/").concat(e),{method:"GET",headers:this.getAuthHeaders()});if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(t){throw console.error("Failed to fetch permissions for role ".concat(e,":"),t),t}}async updateRolePermissions(e,t){try{const r=await fetch("".concat(this.baseURL,"/role/").concat(e),{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify({permissions:t})});if(!r.ok)throw new Error("HTTP error! status: ".concat(r.status));return await r.json()}catch(r){throw console.error("Failed to update permissions for role ".concat(e,":"),r),r}}async getUserPermissions(e){try{const t=await fetch("".concat(this.baseURL,"/user/").concat(e),{method:"GET",headers:this.getAuthHeaders()});if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(t){throw console.error("Failed to fetch permissions for user ".concat(e,":"),t),t}}async checkPermissions(e){try{const t=await fetch("".concat(this.baseURL,"/check"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify({permissions:e})});if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(t){throw console.error("Failed to check permissions:",t),t}}async getPermissionMatrix(){try{console.log("\ud83d\udd0d PERMISSION SERVICE: Fetching permission matrix...");const e=this.getAuthHeaders();console.log("\ud83d\udd0d PERMISSION SERVICE: Headers:",e);const t=await fetch("".concat(this.baseURL,"/matrix"),{method:"GET",headers:e});if(console.log("\ud83d\udd0d PERMISSION SERVICE: Response status:",t.status),!t.ok){const e=await t.text();throw console.error("\ud83d\udd0d PERMISSION SERVICE: Error response:",e),new Error("HTTP error! status: ".concat(t.status," - ").concat(e))}const r=await t.json();return console.log("\ud83d\udd0d PERMISSION SERVICE: Response data:",r),r}catch(e){throw console.error("Failed to fetch permission matrix:",e),e}}async hasPermission(e){try{var t;return(null===(t=(await this.checkPermissions([e])).data.hasPermissions[0])||void 0===t?void 0:t.hasAccess)||!1}catch(r){return console.error("Failed to check permission ".concat(e,":"),r),!1}}async hasAnyPermission(e){try{return(await this.checkPermissions(e)).data.hasPermissions.some(e=>e.hasAccess)}catch(t){return console.error("Failed to check permissions:",t),!1}}async hasAllPermissions(e){try{return(await this.checkPermissions(e)).data.hasPermissions.every(e=>e.hasAccess)}catch(t){return console.error("Failed to check permissions:",t),!1}}},$x=Zx,eb=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)("PROJECT_MANAGER"),[a,s]=(0,o.useState)({}),[i,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(null),[m,p]=(0,o.useState)(null),f=[{value:"PROJECT_MANAGER",label:"Project Manager",icon:"\ud83d\udc77\u200d\u2642\ufe0f",description:"Coordinate project workflows, manage timelines, and oversee project delivery",color:"bg-green-100 text-green-800 border-green-200"},{value:"FIELD_DIRECTOR",label:"Field Director",icon:"\ud83d\udd28",description:"Oversee field operations, crew management, and on-site project execution",color:"bg-orange-100 text-orange-800 border-orange-200"},{value:"OFFICE_STAFF",label:"Office Staff",icon:"\ud83d\udc77",description:"Handle customer communications, scheduling, and administrative tasks",color:"bg-blue-100 text-blue-800 border-blue-200"},{value:"ADMINISTRATION",label:"Administration",icon:"\ud83d\udc51",description:"Manage company settings, users, and overall system configuration",color:"bg-purple-100 text-purple-800 border-purple-200"},{value:"SUBCONTRACTOR",label:"Subcontractor",icon:"\ud83d\udd27",description:"External contractor access for project work",color:"bg-yellow-100 text-yellow-800 border-yellow-200"},{value:"LOCATION_MANAGER",label:"Location Manager",icon:"\ud83c\udfe2",description:"Manage site-specific operations, coordinate with local teams, and oversee location-based project activities",color:"bg-teal-100 text-teal-800 border-teal-200"}],g=[{key:"CREATE_PROJECTS",name:"Create Projects",description:"Start new roofing projects",category:"Project Management",icon:"\ud83c\udfd7\ufe0f"},{key:"EDIT_PROJECTS",name:"Edit Projects",description:"Update project details and specifications",category:"Project Management",icon:"\u270f\ufe0f"},{key:"DELETE_PROJECTS",name:"Delete Projects",description:"Remove projects from system",category:"Project Management",icon:"\ud83d\uddd1\ufe0f"},{key:"MANAGE_USERS",name:"Manage Users",description:"Add, edit, or remove system users",category:"User Management",icon:"\ud83d\udc65"},{key:"VIEW_REPORTS",name:"View Reports",description:"Access project and financial reports",category:"Analytics",icon:"\ud83d\udcca"},{key:"MANAGE_FINANCES",name:"Manage Finances",description:"Handle project costs, estimates, and billing",category:"Financial",icon:"\ud83d\udcb0"},{key:"MANAGE_DOCUMENTS",name:"Manage Documents",description:"Upload, download, and organize project documents",category:"Documentation",icon:"\ud83d\udcc4"},{key:"MANAGE_CALENDAR",name:"Manage Calendar",description:"Schedule work, manage appointments",category:"Scheduling",icon:"\ud83d\udcc5"},{key:"USE_AI_FEATURES",name:"Use AI Features",description:"Access Bubbles AI and advanced features",category:"AI & Automation",icon:"\ud83e\udd16"}],v={PROJECT_MANAGER:["CREATE_PROJECTS","EDIT_PROJECTS","VIEW_REPORTS","MANAGE_DOCUMENTS","MANAGE_CALENDAR","USE_AI_FEATURES"],FIELD_DIRECTOR:["EDIT_PROJECTS","VIEW_REPORTS","MANAGE_DOCUMENTS","MANAGE_CALENDAR"],OFFICE_STAFF:["VIEW_REPORTS","MANAGE_DOCUMENTS","MANAGE_CALENDAR"],ADMINISTRATION:g.map(e=>e.key),SUBCONTRACTOR:["VIEW_REPORTS","MANAGE_DOCUMENTS"],LOCATION_MANAGER:["EDIT_PROJECTS","VIEW_REPORTS","MANAGE_DOCUMENTS","MANAGE_CALENDAR"]};(0,o.useEffect)(()=>{(async()=>{l(!0),h(null);try{const t={};for(const r of f)try{const e=await $x.getRolePermissions(r.value);e.success&&e.data?t[r.value]=e.data.permissions||[]:t[r.value]=v[r.value]||[]}catch(e){console.warn("Failed to load permissions for ".concat(r.value,", using defaults:"),e),t[r.value]=v[r.value]||[]}s(t),p("Permissions loaded successfully"),setTimeout(()=>p(null),3e3)}catch(u){console.error("Error loading permissions:",u),h("Failed to load permissions. Using default settings.");const t={};f.forEach(e=>{t[e.value]=v[e.value]||[]}),s(t)}finally{l(!1)}})()},[]);const x=a[r]||[],b=f.find(e=>e.value===r);return(0,kt.jsxs)("div",{className:"h-screen flex flex-col ".concat(t?"bg-gray-900":"bg-gray-50"),children:[m&&(0,kt.jsx)("div",{className:"p-3 border-b ".concat(t?"bg-green-900/20 border-green-500/40":"bg-green-50 border-green-200"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-green-600",children:"\u2705"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-green-300":"text-green-700"),children:m})]})}),u&&(0,kt.jsx)("div",{className:"p-3 border-b ".concat(t?"bg-red-900/20 border-red-500/40":"bg-red-50 border-red-200"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-red-600",children:"\u274c"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-red-300":"text-red-700"),children:u})]})}),(0,kt.jsx)("div",{className:"p-3 border-b ".concat(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-xl font-bold ".concat(t?"text-white":"text-gray-900"),children:"\ud83d\udd10 Role Permissions"}),(0,kt.jsx)("p",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:"Manage what each role can access in your roofing business"}),i&&(0,kt.jsx)("p",{className:"text-xs ".concat(t?"text-blue-300":"text-blue-600"),children:"Loading permissions from database..."})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{const e=v[r]||[];s(t=>(0,Y.A)((0,Y.A)({},t),{},{[r]:e}))},className:"px-3 py-1.5 rounded text-sm ".concat(t?"bg-orange-600 hover:bg-orange-700 text-white":"bg-orange-500 hover:bg-orange-600 text-white"),children:"\ud83d\udd04 Reset"}),(0,kt.jsx)("button",{onClick:async()=>{d(!0),h(null),p(null);try{console.log("\ud83d\udcbe Saving role permissions to database:",a);const e=Object.entries(a).map(async e=>{let[t,r]=e;try{const e=await $x.updateRolePermissions(t,r);if(!e.success)throw new Error(e.message||"Failed to save permissions for ".concat(t));return console.log("\u2705 Saved permissions for ".concat(t,":"),r),{role:t,success:!0}}catch(n){return console.error("\u274c Failed to save permissions for ".concat(t,":"),n),{role:t,success:!1,error:n.message}}}),t=await Promise.all(e),r=t.filter(e=>!e.success);if(0===r.length)p("All role permissions saved successfully!"),setTimeout(()=>p(null),5e3);else{if(!(r.length<t.length))throw new Error("Failed to save any role permissions");h("Some permissions saved successfully. Failed roles: ".concat(r.map(e=>e.role).join(", ")))}}catch(u){console.error("\u274c Error saving permissions:",u),h("Failed to save permissions: ".concat(u.message))}finally{d(!1)}},disabled:c||i,className:"px-3 py-1.5 rounded text-sm ".concat(c||i?"bg-gray-400 text-gray-200 cursor-not-allowed":t?"bg-green-600 hover:bg-green-700 text-white":"bg-green-500 hover:bg-green-600 text-white"),children:c?(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsx)("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}),(0,kt.jsx)("span",{children:"Saving..."})]}):"\ud83d\udcbe Save"})]})]})}),(0,kt.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,kt.jsxs)("div",{className:"w-48 border-r ".concat(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"p-2 border-b ".concat(t?"border-gray-700":"border-gray-200"),children:(0,kt.jsx)("h3",{className:"text-sm font-semibold ".concat(t?"text-white":"text-gray-900"),children:"Roles"})}),(0,kt.jsx)("div",{className:"p-2 space-y-1",children:f.map(e=>{var s;return(0,kt.jsx)("button",{onClick:()=>n(e.value),className:"w-full p-2 rounded text-left transition-all ".concat(r===e.value?t?"bg-blue-600 text-white":"bg-blue-500 text-white":t?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm",children:e.icon}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-sm",children:e.label}),(0,kt.jsxs)("div",{className:"text-xs opacity-75",children:[(null===(s=a[e.value])||void 0===s?void 0:s.length)||0," permissions"]})]})]})},e.value)})})]}),(0,kt.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,kt.jsx)("div",{className:"p-2 border-b ".concat(t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-lg",children:null===b||void 0===b?void 0:b.icon}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-lg font-semibold ".concat(t?"text-white":"text-gray-900"),children:null===b||void 0===b?void 0:b.label}),(0,kt.jsxs)("p",{className:"text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:[x.length,"/",g.length," permissions enabled"]})]})]}),(0,kt.jsxs)("div",{className:"text-right ".concat(t?"text-blue-400":"text-blue-600"),children:[(0,kt.jsxs)("div",{className:"text-lg font-bold",children:[Math.round(x.length/g.length*100),"%"]}),(0,kt.jsx)("div",{className:"text-xs",children:"Access"})]})]})}),(0,kt.jsx)("div",{className:"flex-1 p-2 overflow-hidden",children:(0,kt.jsx)("div",{className:"h-full grid grid-cols-3 gap-2",children:g.map(e=>{const n=x.includes(e.key);return(0,kt.jsx)("div",{className:"border rounded p-2 cursor-pointer transition-all ".concat(n?t?"bg-green-900/20 border-green-600 text-green-300":"bg-green-50 border-green-200 text-green-800":t?"bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"),onClick:()=>{return t=e.key,void s(e=>{const n=e[r]||[],a=n.includes(t)?n.filter(e=>e!==t):[...n,t];return(0,Y.A)((0,Y.A)({},e),{},{[r]:a})});var t},children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-4 h-4 rounded border ".concat(n?"bg-green-500 border-green-500":t?"border-gray-500":"border-gray-400"),children:n&&(0,kt.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,kt.jsx)("div",{className:"w-1 h-1 bg-white rounded-full"})})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsx)("span",{className:"text-sm",children:e.icon}),(0,kt.jsx)("div",{className:"font-medium text-sm truncate",children:e.name})]}),(0,kt.jsx)("div",{className:"text-xs opacity-75 truncate",children:e.description})]})]})},e.key)})})})]})]})]})},tb=[{value:"ADMIN",label:"Admin"},{value:"MANAGER",label:"Manager"},{value:"PROJECT_MANAGER",label:"Project Manager"},{value:"FOREMAN",label:"Foreman"},{value:"WORKER",label:"Worker"},{value:"CLIENT",label:"Client"},{value:"SUBCONTRACTOR",label:"Subcontractor"}],rb=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)(""),[a,s]=(0,o.useState)("WORKER"),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!1),[f,g]=(0,o.useState)(""),[v,x]=(0,o.useState)(null),[b,y]=(0,o.useState)(""),[w,j]=(0,o.useState)(""),N=()=>{p(!1),g(""),x(null),y(""),j(""),n(""),s("WORKER"),l(""),d("")};return m?(0,kt.jsx)("div",{className:"min-h-screen ".concat(t?"bg-[#0f172a]":"bg-gray-50"," flex items-center justify-center"),children:(0,kt.jsx)("div",{className:"max-w-md w-full mx-4 ".concat(t?"bg-slate-800":"bg-white"," rounded-lg shadow-lg p-8"),children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",children:(0,kt.jsx)("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,kt.jsx)("h3",{className:"text-lg font-medium mb-2 ".concat(t?"text-white":"text-gray-900"),children:"Team Member Added!"}),v?(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("p",{className:"text-sm mb-4 ".concat(t?"text-gray-300":"text-gray-600"),children:["\u2705 Invitation email has been sent to ",(0,kt.jsx)("strong",{children:i})]}),(0,kt.jsx)("p",{className:"text-xs mb-4 ".concat(t?"text-gray-400":"text-gray-500"),children:"The team member can log in using Google OAuth with their email address."})]}):(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("p",{className:"text-sm mb-2 ".concat(t?"text-yellow-400":"text-yellow-600"),children:["\u26a0\ufe0f User created for ",(0,kt.jsx)("strong",{children:i}),", but the invitation email failed to send."]}),b&&(0,kt.jsxs)("p",{className:"text-xs mb-4 ".concat(t?"text-red-300":"text-red-500"),children:["Reason: ",b]})]}),w&&(0,kt.jsxs)("div",{className:"p-3 rounded-md mb-4 ".concat(t?"bg-slate-700":"bg-gray-100"),children:[(0,kt.jsx)("p",{className:"text-xs font-medium mb-2 ".concat(t?"text-gray-300":"text-gray-700"),children:"Manual Setup Link (share this if email isn't received):"}),(0,kt.jsx)("code",{className:"text-xs break-all block p-2 rounded ".concat(t?"bg-slate-800 text-blue-400":"bg-white text-blue-600 border"),children:w}),(0,kt.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(w),alert("Link copied to clipboard!")},className:"mt-2 text-blue-600 hover:text-blue-800 text-sm underline",children:"\ud83d\udccb Copy Setup Link"})]}),(0,kt.jsx)("button",{onClick:N,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors mt-4",children:"Invite Another Member"})]})})}):(0,kt.jsxs)("div",{className:"".concat(t?"bg-slate-800":"bg-white"," rounded-lg shadow-sm border border-gray-200"),children:[(0,kt.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,kt.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Add Team Member"}),(0,kt.jsx)("p",{className:"text-sm text-gray-600",children:"Invite a new team member via email"})]}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),g(""),r.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?a||(g("Please select a role"),0):(g("Please enter a valid email address"),0):(g("Email is required"),0)){h(!0);try{const e=sessionStorage.getItem("authToken")||localStorage.getItem("authToken");if(!e)throw new Error("Authentication required. Please log in again.");const h=await fetch("".concat(Da.API_BASE_URL,"/users/add-team-member"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({firstName:"Team",lastName:"Member",email:r.trim(),phone:null,secondaryPhone:null,preferredPhone:null,role:a})}),g=await h.json();if(console.log("\ud83d\udd0d ADD-TEAM-MEMBER: Response status:",h.status),console.log("\ud83d\udd0d ADD-TEAM-MEMBER: Response data:",g),!h.ok){if(g.errors&&Object.keys(g.errors).length>0){const e=Object.values(g.errors).flat();throw new Error(e.join(", ")||g.message||"Failed to send invite")}throw new Error(g.message||g.error||"Failed to send invite")}if(!g.success)throw new Error(g.message||"Failed to send invite");var t,o,i,c,u,m,f,v,b;console.log("\u2705 ADD-TEAM-MEMBER: User created successfully:",g.data.user),console.log("\u2705 ADD-TEAM-MEMBER: Email sent status:",null===(t=g.data)||void 0===t?void 0:t.emailSent),console.log("\u2705 ADD-TEAM-MEMBER: Email error (if any):",null===(o=g.data)||void 0===o?void 0:o.emailError),console.log("\u2705 ADD-TEAM-MEMBER: Setup link:",null===(i=g.data)||void 0===i?void 0:i.setupLink),l(r.trim()),d(a),p(!0),x((null===(c=g.data)||void 0===c?void 0:c.emailSent)||!1),y((null===(u=g.data)||void 0===u?void 0:u.emailError)||""),j((null===(m=g.data)||void 0===m?void 0:m.setupLink)||(null===(f=g.data)||void 0===f||null===(v=f.user)||void 0===v?void 0:v.setupLink)||""),n(""),s("WORKER"),null!==(b=g.data)&&void 0!==b&&b.emailError&&console.warn("\u26a0\ufe0f ADD-TEAM-MEMBER: Email failed to send:",g.data.emailError)}catch(XI){console.error("\u274c ADD-TEAM-MEMBER: Error details:",XI),console.error("\u274c ADD-TEAM-MEMBER: Full error object:",JSON.stringify(XI,null,2)),g(XI.message||"Failed to send invite")}finally{h(!1)}}},className:"p-4 space-y-4",children:[f&&(0,kt.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,kt.jsxs)("div",{className:"flex",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,kt.jsx)("div",{className:"ml-3",children:(0,kt.jsx)("p",{className:"text-sm text-red-800",children:f})})]})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),(0,kt.jsx)("input",{type:"email",id:"email",name:"email",value:r,onChange:e=>n(e.target.value),placeholder:"colleague@example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),(0,kt.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"An invitation will be sent to this email address. They can sign in using their Google Account."})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),(0,kt.jsx)("select",{id:"role",name:"role",value:a,onChange:e=>s(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white",required:!0,children:tb.map(e=>(0,kt.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,kt.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Select the role for this team member. This will be included in their welcome email."})]}),(0,kt.jsx)("div",{className:"flex justify-end space-x-3 pt-4",children:(0,kt.jsx)("button",{type:"submit",disabled:u,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center",children:u?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending Invite..."]}):"Send Invite"})})]})]})},nb=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)([]),[a,s]=(0,o.useState)(!0),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)("ALL"),[m,p]=(0,o.useState)("active"),[f,g]=(0,o.useState)(null),[v,x]=(0,o.useState)({}),[b,y]=(0,o.useState)(null),[w,j]=(0,o.useState)(!1),[N,S]=(0,o.useState)(null),[k,A]=(0,o.useState)(""),C=[{value:"ADMIN",label:"Administrator",color:"bg-red-100 text-red-800"},{value:"MANAGER",label:"Manager",color:"bg-orange-100 text-orange-800"},{value:"PROJECT_MANAGER",label:"Project Manager",color:"bg-blue-100 text-blue-800"},{value:"FOREMAN",label:"Foreman",color:"bg-green-100 text-green-800"},{value:"WORKER",label:"Worker",color:"bg-gray-100 text-gray-800"},{value:"SUBCONTRACTOR",label:"Subcontractor",color:"bg-purple-100 text-purple-800"}];(0,o.useEffect)(()=>{try{const e=localStorage.getItem("user")||localStorage.getItem("currentUser");if(e){const t=JSON.parse(e);S(t)}}catch(_t){console.error("Error parsing current user:",_t)}E()},[]);const E=async()=>{try{s(!0),l("");const t=localStorage.getItem("authToken")||localStorage.getItem("token");if(!t)return void l("No authentication token found. Please log in again.");console.log("\ud83d\udce1 UserManagementPage: Fetching users from API...");const r=await fetch("".concat(Da.API_BASE_URL,"/users/team-members"),{headers:{Authorization:"Bearer ".concat(t)}});if(console.log("\ud83d\udce1 UserManagementPage: Response status:",r.status),r.ok){var e;const t=await r.json();console.log("\ud83d\udce1 UserManagementPage: API response:",t),t.success&&null!==(e=t.data)&&void 0!==e&&e.teamMembers?(n(t.data.teamMembers),console.log("\u2705 UserManagementPage: Loaded ".concat(t.data.teamMembers.length," users"))):(l("No users found in response"),n([]))}else{const e=await r.text();console.error("\u274c UserManagementPage: API error:",r.status,e),l("Failed to fetch users (".concat(r.status,"): ").concat(e)),n([])}}catch(XI){console.error("\u274c UserManagementPage: Network error:",XI),l("Network error. Please check your connection and try again."),n([])}finally{s(!1)}},P=()=>{if(!N)return!1;return"ADMIN"===(N.role||"").toUpperCase()},_=r.filter(e=>{const t=e.firstName||"",r=e.lastName||"",n=e.email||"",a=t.toLowerCase().includes(c.toLowerCase())||r.toLowerCase().includes(c.toLowerCase())||n.toLowerCase().includes(c.toLowerCase()),s="ALL"===u||e.role===u,o="active"===m?e.isActive:!e.isActive;return a&&s&&o}),I=e=>C.find(t=>t.value===e)||{label:e,color:"bg-gray-100 text-gray-800"};return a?(0,kt.jsx)("div",{className:"min-h-screen ".concat(t?"bg-[#0f172a]":"bg-gray-50"," flex items-center justify-center"),children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,kt.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})}):(0,kt.jsxs)("div",{className:"".concat(t?"bg-slate-800":"bg-white"," rounded-lg shadow-lg"),children:[(0,kt.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,kt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),(0,kt.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage team members and their roles"})]}),(0,kt.jsxs)("div",{className:"text-sm text-gray-500",children:[_.length," users"]})]})}),(0,kt.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,kt.jsx)("button",{onClick:()=>p("active"),className:"flex-1 py-3 text-sm font-medium text-center transition-colors ".concat("active"===m?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"Active Users"}),(0,kt.jsx)("button",{onClick:()=>p("inactive"),className:"flex-1 py-3 text-sm font-medium text-center transition-colors ".concat("inactive"===m?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"Inactive Users"})]}),i&&(0,kt.jsx)("div",{className:"mx-6 mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:(0,kt.jsxs)("div",{className:"flex",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,kt.jsx)("div",{className:"ml-3",children:(0,kt.jsx)("p",{className:"text-sm text-red-800",children:i})})]})}),k&&(0,kt.jsx)("div",{className:"mx-6 mt-4 bg-green-50 border border-green-200 rounded-md p-4",children:(0,kt.jsxs)("div",{className:"flex",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,kt.jsx)("div",{className:"ml-3",children:(0,kt.jsx)("p",{className:"text-sm text-green-800",children:k})})]})}),(0,kt.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),(0,kt.jsx)("input",{type:"text",placeholder:"Search by name or email...",value:c,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,kt.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,kt.jsx)("option",{value:"ALL",children:"All Roles"}),C.map(e=>(0,kt.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,kt.jsx)("div",{className:"flex items-end",children:(0,kt.jsx)("button",{onClick:E,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors",children:"Refresh"})})]})}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,kt.jsx)("thead",{className:"bg-gray-50",children:(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,kt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),(0,kt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,kt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Active"}),(0,kt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,kt.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map(e=>(0,kt.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,kt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:e.avatar?(0,kt.jsx)("img",{className:"h-10 w-10 rounded-full",src:e.avatar,alt:""}):(0,kt.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,kt.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[(e.firstName||"U").charAt(0),(e.lastName||"U").charAt(0)]})})}),(0,kt.jsxs)("div",{className:"ml-4",children:[(0,kt.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName||"Unknown"," ",e.lastName||"User"]}),(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:e.email||"No email"})]})]})}),(0,kt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,kt.jsxs)("div",{className:"text-sm text-gray-900",children:[e.phone&&(0,kt.jsxs)("div",{children:["Primary: ",e.phone]}),e.secondaryPhone&&(0,kt.jsxs)("div",{children:["Secondary: ",e.secondaryPhone]}),e.preferredPhone&&(0,kt.jsxs)("div",{className:"text-blue-600 font-medium",children:["Preferred: ",e.preferredPhone]})]})}),(0,kt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,kt.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(I(e.role).color),children:I(e.role).label})}),(0,kt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,kt.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:e.isActive,onChange:()=>(async e=>{const t=!e.isActive;n(r.map(r=>r.id===e.id?(0,Y.A)((0,Y.A)({},r),{},{isActive:t}):r));try{const r=localStorage.getItem("authToken")||localStorage.getItem("token");if(!(await fetch("".concat(Da.API_BASE_URL,"/users/").concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({isActive:t})})).ok)throw new Error("Failed to update status");A("User ".concat(e.firstName," moved to ").concat(t?"Active":"Inactive"," list")),setTimeout(()=>A(""),2e3)}catch(XI){console.error("Error toggling status:",XI),l("Failed to update user status"),n(r.map(r=>r.id===e.id?(0,Y.A)((0,Y.A)({},r),{},{isActive:!t}):r))}})(e),className:"sr-only peer"}),(0,kt.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})}),(0,kt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("button",{onClick:()=>(e=>{g(e),x({firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone||"",secondaryPhone:e.secondaryPhone||"",preferredPhone:e.preferredPhone||"",role:e.role,isActive:e.isActive})})(e),className:"text-blue-600 hover:text-blue-900",children:"Edit"}),P()&&(0,kt.jsx)("button",{onClick:()=>(e=>{y(e)})(e),className:"text-red-600 hover:text-red-900",disabled:w,children:"Delete"})]})})]},e.id))})]})}),0===_.length&&(0,kt.jsx)("div",{className:"text-center py-12",children:(0,kt.jsx)("div",{className:"text-gray-500",children:c||"ALL"!==u?"No users match your filters":"No ".concat(m," users found")})}),f&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,kt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User"}),(0,kt.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(async()=>{try{l("");const e=localStorage.getItem("authToken")||localStorage.getItem("token");console.log("\ud83d\udd0d UPDATE-USER: Sending update request:",{userId:f.id,updateData:v});const t=await fetch("".concat(Da.API_BASE_URL,"/users/").concat(f.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(v)}),a=await t.json();if(console.log("\ud83d\udd0d UPDATE-USER: Response received:",a),!t.ok)throw new Error(a.message||a.error||"Failed to update user");if(!(a.success&&a.data&&a.data.user))throw new Error(a.message||"Failed to update user");{const e=a.data.user;n(r.map(t=>t.id===f.id?e:t)),g(null),x({}),A("User updated successfully"),setTimeout(()=>A(""),3e3)}}catch(XI){console.error("\u274c UPDATE-USER: Error:",XI),l(XI.message||"Network error. Please try again.")}})()},className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,kt.jsx)("input",{type:"text",value:v.firstName,onChange:e=>x((0,Y.A)((0,Y.A)({},v),{},{firstName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),(0,kt.jsx)("input",{type:"text",value:v.lastName,onChange:e=>x((0,Y.A)((0,Y.A)({},v),{},{lastName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,kt.jsx)("input",{type:"email",value:v.email,onChange:e=>x((0,Y.A)((0,Y.A)({},v),{},{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,kt.jsx)("select",{value:v.role,onChange:e=>x((0,Y.A)((0,Y.A)({},v),{},{role:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:C.map(e=>(0,kt.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{g(null),x({})},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save Changes"})]})]})]})})}),b&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,kt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsx)("h3",{className:"text-lg font-medium text-red-900 mb-4",children:"Delete User"}),(0,kt.jsxs)("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete ",(0,kt.jsxs)("strong",{children:[b.firstName," ",b.lastName]})," (",b.email,")?"]}),(0,kt.jsx)("p",{className:"text-sm text-red-600 mb-4",children:"This action cannot be undone. The user will be permanently removed from the system."}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{y(null)},disabled:w,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),(0,kt.jsx)("button",{type:"button",onClick:async()=>{if(b){j(!0),l(""),A("");try{const e=await Da.usersService.deleteUser(b.id);e.success?(n(r.filter(e=>e.id!==b.id)),y(null),A(e.message||"User ".concat(b.firstName," ").concat(b.lastName," has been deleted successfully")),setTimeout(()=>A(""),5e3)):l(e.message||"Failed to delete user")}catch(XI){var e,t;console.error("Error deleting user:",XI),l((null===(e=XI.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||XI.message||"Failed to delete user. Please try again.")}finally{j(!1)}}},disabled:w,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Deleting...":"Delete User"})]})]})})})]})},ab=e=>{let{colorMode:t,setColorMode:r,currentUser:n,onUserUpdated:a}=e;const[s,i]=(0,o.useState)("profile"),[l,c]=(0,o.useState)(""),[d,u]=(0,o.useState)(""),[h,m]=(0,o.useState)(""),[p,f]=(0,o.useState)(""),[g,v]=(0,o.useState)("America/New_York"),[x,b]=(0,o.useState)("English"),[y,w]=(0,o.useState)(""),[j,N]=(0,o.useState)(""),[S,k]=(0,o.useState)(""),[A,C]=(0,o.useState)(""),[E,P]=(0,o.useState)(""),[_,I]=(0,o.useState)(!1),[T,L]=(0,o.useState)(""),[D,M]=(0,o.useState)(!1),[O,R]=(0,o.useState)(null),[F,U]=(0,o.useState)(null),[B,z]=(0,o.useState)(""),[W,q]=(0,o.useState)(!1),[V,H]=(0,o.useState)(!1),[G,K]=(0,o.useState)(!1),J=async e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return L("Please select a valid image file"),I(!0),void setTimeout(()=>I(!1),3e3);if(t.size>5242880)return L("Image size must be less than 5MB"),I(!0),void setTimeout(()=>I(!1),3e3);R(t);const e=new FileReader;e.onload=e=>{U(e.target.result)},e.readAsDataURL(t);try{const e=new FormData;e.append("avatar",t);const r=await fetch("".concat(Da.API_BASE_URL,"/auth/upload-avatar"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:e}),n=await r.json();if(console.log("\ud83d\udd04 IMMEDIATE AVATAR UPLOAD: Upload result:",n),!n.success)throw new Error(n.message||"Failed to upload profile picture");{const e=n.data.user;console.log("\ud83d\udd04 IMMEDIATE AVATAR UPLOAD: Updated user:",e),console.log("\ud83d\udd04 IMMEDIATE AVATAR UPLOAD: Avatar URL:",null===e||void 0===e?void 0:e.avatar);try{localStorage.setItem("user",JSON.stringify(e)),sessionStorage.setItem("user",JSON.stringify(e))}catch(Pr){}"function"===typeof a&&(console.log("\ud83d\udd04 IMMEDIATE AVATAR UPLOAD: Calling onUserUpdated callback"),a(e)),R(null),L("Profile picture updated successfully!"),I(!0),setTimeout(()=>I(!1),3e3)}}catch(XI){console.error("Immediate avatar upload failed:",XI),L(String((null===XI||void 0===XI?void 0:XI.message)||"Failed to upload profile picture")),I(!0),setTimeout(()=>I(!1),3e3)}}},X=async()=>{try{const e=await fetch("".concat(Da.API_BASE_URL,"/auth/remove-avatar"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")),"Content-Type":"application/json"}}),t=await e.json();if(!t.success)throw new Error(t.message||"Failed to remove profile picture");{const e=t.data.user;try{localStorage.setItem("user",JSON.stringify(e)),sessionStorage.setItem("user",JSON.stringify(e))}catch(Pr){}"function"===typeof a&&a(e),R(null),U(null),L("Profile picture removed successfully!"),I(!0),setTimeout(()=>I(!1),3e3)}}catch(XI){console.error("Remove profile picture failed:",XI),L(String((null===XI||void 0===XI?void 0:XI.message)||"Failed to remove profile picture")),I(!0),setTimeout(()=>I(!1),3e3)}},[Q,Z]=(0,o.useState)({projectManager:[],fieldDirector:[],officeStaff:[],administration:[],subcontractor:[]}),[$,ee]=(0,o.useState)([]),[te,re]=(0,o.useState)(!1),[ne,ae]=(0,o.useState)([]),[se,oe]=(0,o.useState)(null),[ie,le]=(0,o.useState)(!1),[ce,de]=(0,o.useState)(""),[ue,he]=(0,o.useState)(null),me=e=>{try{L(String(null!==e&&void 0!==e?e:"")),I(!0),setTimeout(()=>I(!1),2e3)}catch(Pr){}},[pe,fe]=(0,o.useState)(!0),[ge,ve]=(0,o.useState)(!1),[xe,be]=(0,o.useState)(!0),[ye,we]=(0,o.useState)(!0),[je,Ne]=(0,o.useState)(!0),[Se,ke]=(0,o.useState)(""),[Ae,Ce]=(0,o.useState)(null),[Ee,Pe]=(0,o.useState)(!1),[_e,Ie]=(0,o.useState)(null),[Te,Le]=(0,o.useState)({isEnabled:!1,taskFollowUpDays:7,taskFollowUpHours:0,taskFollowUpMinutes:0,reminderFollowUpDays:3,reminderFollowUpHours:0,reminderFollowUpMinutes:0,alertFollowUpDays:5,alertFollowUpHours:0,alertFollowUpMinutes:0,maxFollowUpAttempts:3,followUpMessage:""}),[De,Me]=(0,o.useState)(!1),Oe=null===n||void 0===n?void 0:n.id;(0,o.useEffect)(()=>{if(n){w(n.firstName||""),N(n.lastName||""),u(n.email||""),m(n.phone||"");let e=n.displayName||"";if(!e)try{e=JSON.parse(localStorage.getItem("user")||"{}").displayName||""}catch(Pr){}z(e),c("".concat(n.firstName||""," ").concat(n.lastName||"").trim()),v(n.timezone||"America/New_York"),b(n.language||"English")}},[Oe]),(0,o.useEffect)(()=>{if(null!==n&&void 0!==n&&n.avatar&&F){const e=new Image,t=n.avatar.startsWith("spaces://")?"https://".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_NAME||"kenstruction",".").concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_ENDPOINT||"nyc3.digitaloceanspaces.com","/").concat(n.avatar.replace("spaces://","")):n.avatar;e.onload=()=>{console.log("\u2705 Avatar image loaded successfully, clearing preview"),U(null)},e.onerror=()=>{console.error("\u274c Avatar image failed to load, keeping preview"),console.error("Failed URL:",t)},e.src=t}},[null===n||void 0===n?void 0:n.avatar,F]);const Re=async e=>{try{const t=localStorage.getItem("authToken")||localStorage.getItem("authToken");console.log("\ud83d\udcbe Saving role assignments:",e);const r={};Object.keys(e).forEach(t=>{const n=e[t]||[];r[t]=n.map(e=>e.id)}),console.log("\ud83d\udce4 Sending to backend:",r);const n=await fetch("".concat(Da.API_BASE_URL,"/roles/sync"),{method:"POST",headers:(0,Y.A)({"Content-Type":"application/json"},t&&{Authorization:"Bearer ".concat(t)}),body:JSON.stringify({roleAssignments:r})});if(!n.ok){const e=await n.json();throw new Error(e.message||"HTTP error! status: ".concat(n.status))}const a=await n.json();console.log("\u2705 Role assignments saved successfully:",a)}catch(t){throw console.error("\u274c Error saving role assignments:",t),t}};(0,o.useEffect)(()=>{let e=!0;return(async()=>{try{re(!0);const a=localStorage.getItem("authToken")||localStorage.getItem("authToken");a||console.warn("\u26a0\ufe0f No auth token found"),console.log("\ud83d\udce1 Fetching users from API...");const s=await fetch("".concat(Da.API_BASE_URL,"/users/team-members"),{headers:{Authorization:"Bearer ".concat(a)}});if(s.ok){var t,r,n;const a=await s.json();if(console.log("\u2705 Received ".concat((null===(t=a.data)||void 0===t||null===(r=t.teamMembers)||void 0===r?void 0:r.length)||0," users from API")),e&&a.success&&null!==(n=a.data)&&void 0!==n&&n.teamMembers){const e=a.data.teamMembers.filter(e=>!1!==e.isActive&&"Inactive"!==e.status);ee(e)}else console.warn("\u26a0\ufe0f API returned success but no data")}else console.error("\u274c API returned status ".concat(s.status));await(async()=>{try{const e=localStorage.getItem("authToken")||localStorage.getItem("authToken");if(!e)return void console.log("\u26a0\ufe0f No token available for loading role assignments");console.log("\ud83d\udce1 Loading role assignments...");const t=await fetch("".concat(Da.API_BASE_URL,"/roles"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){const e=await t.json();if(console.log("\ud83d\udcca Role assignments received:",e),e.success){const t={projectManager:[],fieldDirector:[],officeStaff:[],administration:[]};Object.keys(t).forEach(r=>{const n="projectManager"===r?"productManager":r,a=e.data[n]||e.data[r];if(a)if(Array.isArray(a))t[r]=a;else if(a.userId){const e=$.find(e=>e.id===a.userId);e&&(t[r]=[e])}}),console.log("\u2705 Setting role assignments (new format):",t),Z(t)}}else console.error("\u274c Failed to load role assignments: ".concat(t.status))}catch(e){console.error("Error loading role assignments:",e)}})()}catch(a){console.error("Error loading users and roles:",a),me("Failed to load users. Please check your connection.")}finally{re(!1)}})(),()=>{e=!1}},[]);const Fe=async()=>{if(!Ae||!Se)return void me("Please select a file and workflow template");Pe(!0);const e=new FormData;e.append("file",Ae),e.append("workflowTemplateId",Se);try{const t=await fetch("".concat(Da.API_BASE_URL,"/project-import/upload"),{method:"POST",body:e}),r=await t.json();if(r.success){const e=r.data.successful||0,t=r.data.failed||0;Ie({total:r.data.total||0,successful:e,failed:r.data.errors||[]});let n="Import completed: ".concat(e," projects created successfully");t>0&&(n+=", ".concat(t," failed")),me(n),Ce(null)}else me("Import failed: ".concat(String(r.message||"Unknown error")))}catch(t){console.error("Error importing projects:",t),me("Import failed due to an error")}finally{Pe(!1)}},Ue=e=>{try{let t,r;switch(e){case"combined":t="project_customer_combined_template.csv",r="/templates/project_customer_combined_template.csv";break;case"combined-instructions":t="Combined_Upload_Instructions.md",r="/templates/COMBINED_UPLOAD_INSTRUCTIONS.md";break;default:throw new Error("Invalid template type")}const n=document.createElement("a");n.href=r,n.download=t,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n),me("Downloaded ".concat(e," template successfully!"))}catch(t){console.error("Error downloading template:",t),me("Failed to download ".concat(e," template"))}};(0,o.useEffect)(()=>{(async()=>{try{const e=[{id:"standard",name:"Standard Roofing Workflow",description:"Default 7-phase roofing workflow"},{id:"express",name:"Express Workflow",description:"Simplified workflow for small projects"},{id:"insurance",name:"Insurance Claims Workflow",description:"Workflow optimized for insurance claims"}];ae(e),e.length>0&&ke(e[0].id)}catch(e){console.error("Error fetching workflow templates:",e)}})()},[]);const Be=async()=>{Me(!0);try{const e=await fetch("/api/follow-up/settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||localStorage.getItem("authToken"))},body:JSON.stringify(Te)}),t=await e.json();if(!t.success)throw new Error(t.message||"Failed to save follow-up settings");L("Follow-up settings saved successfully!"),I(!0),setTimeout(()=>I(!1),3e3)}catch(e){console.error("Error saving follow-up settings:",e),L("Failed to save follow-up settings"),I(!0),setTimeout(()=>I(!1),3e3)}finally{Me(!1)}};(0,o.useEffect)(()=>{(async()=>{try{const e=await fetch("/api/follow-up/settings",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))}}),t=await e.json();t.success&&Le(t.data.settings)}catch(e){console.error("Error loading follow-up settings:",e)}})()},[]);const ze=[{id:"profile",label:"Profile",icon:"\ud83d\udc64"},{id:"security",label:"Security",icon:"\ud83d\udd12"},{id:"roles",label:"Roles",icon:"\ud83d\udc65"},{id:"permissions",label:"Permissions",icon:"\ud83d\udd10"},{id:"team-members",label:"Team Members",icon:"\ud83d\udc65"},{id:"add-team-member",label:"Add Team Member",icon:"\u2795"},{id:"follow-up",label:"Bubbles AI",icon:"\ud83e\udd16"}],We=()=>(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,kt.jsxs)("div",{className:"relative",children:[F?(0,kt.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-blue-500",children:(0,kt.jsx)("img",{src:F,alt:"Profile",className:"w-full h-full object-cover"})}):null!==n&&void 0!==n&&n.avatar?(0,kt.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-blue-500",children:(0,kt.jsx)("img",{src:n.avatar.startsWith("spaces://")?"https://".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_NAME||"kenstruction",".").concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_ENDPOINT||"nyc3.digitaloceanspaces.com","/").concat(n.avatar.replace("spaces://","")):n.avatar,alt:"Profile",className:"w-full h-full object-cover",onError:e=>{console.error("Profile image failed to load:",e),console.error("Avatar URL:",n.avatar),console.error("Constructed URL:",e.target.src),e.target.style.display="none"}})}):(0,kt.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold ".concat("bg-[#F8FAFC] text-white"),children:"".concat(((null===n||void 0===n?void 0:n.firstName)||"U").charAt(0).toUpperCase()).concat(((null===n||void 0===n?void 0:n.lastName)||"").charAt(0).toUpperCase())}),(0,kt.jsx)("button",{type:"button",onClick:()=>document.getElementById("profile-picture-upload").click(),className:"absolute -bottom-1 -right-1 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-blue-600 transition-colors",title:"Change profile picture",children:(0,kt.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(F||(null===n||void 0===n?void 0:n.avatar))&&(0,kt.jsx)("button",{type:"button",onClick:X,className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors shadow-sm",title:"Remove profile picture",children:(0,kt.jsx)("svg",{className:"w-1.5 h-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"text-sm font-bold ".concat(t?"text-white":"text-gray-800"),children:B||l||"".concat((null===n||void 0===n?void 0:n.firstName)||""," ").concat((null===n||void 0===n?void 0:n.lastName)||"").trim()||"User"}),(0,kt.jsx)("div",{className:"text-xs ".concat(t?"text-blue-200":"text-blue-600"),children:(()=>{const e=String((null===n||void 0===n?void 0:n.role)||"").toUpperCase();return null!==n&&void 0!==n&&n.position?n.position:"WORKER"===e?"User":(null===n||void 0===n?void 0:n.role)||"User"})()}),(0,kt.jsx)("div",{className:"text-[10px] ".concat(t?"text-gray-300":"text-gray-500"),children:d})]})]}),(0,kt.jsx)("input",{id:"profile-picture-upload",type:"file",accept:"image/*",onChange:J,className:"hidden"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"First Name"}),(0,kt.jsx)("input",{type:"text",value:y,onChange:e=>w(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Last Name"}),(0,kt.jsx)("input",{type:"text",value:j,onChange:e=>N(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Email Address"}),(0,kt.jsx)("input",{type:"email",value:d,onChange:e=>u(e.target.value),className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Phone Number"}),(0,kt.jsx)("input",{type:"tel",value:h,onChange:e=>{const t=e.target.value;m(t)},onBlur:e=>{m(Hi(e.target.value))},placeholder:"(555) 555-5555",className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Display Name"}),(0,kt.jsx)("input",{type:"text",value:B,onChange:e=>z(e.target.value),placeholder:"How your name appears in the Bubbles system",className:"w-full p-2 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")}),(0,kt.jsx)("p",{className:"text-xs mt-1 ".concat(t?"text-gray-400":"text-gray-500"),children:"How your name is displayed in the Bubbles system"})]})]})]}),qe=()=>{switch(s){case"profile":default:return We();case"security":return(0,kt.jsx)("div",{className:"space-y-3",children:(0,kt.jsxs)("div",{className:"",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold mb-2 ".concat(t?"text-white":"text-gray-800"),children:"Change Password"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Current Password"}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("input",{type:W?"text":"password",value:E,onChange:e=>P(e.target.value),className:"w-full p-2 pr-10 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white"),autoComplete:"current-password"}),(0,kt.jsx)("button",{type:"button",onClick:()=>q(!W),className:"absolute right-3 top-1/2 transform -translate-y-1/2 ".concat(t?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700"),children:W?(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):(0,kt.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"New Password"}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("input",{type:V?"text":"password",value:S,onChange:e=>k(e.target.value),className:"w-full p-2 pr-10 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white"),autoComplete:"new-password"}),(0,kt.jsx)("button",{type:"button",onClick:()=>H(!V),className:"absolute right-3 top-1/2 transform -translate-y-1/2 ".concat(t?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700"),children:V?(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):(0,kt.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Confirm New Password"}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("input",{type:G?"text":"password",value:A,onChange:e=>C(e.target.value),className:"w-full p-2 pr-10 rounded border focus:ring-1 focus:ring-blue-400 transition-all text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white"),autoComplete:"new-password"}),(0,kt.jsx)("button",{type:"button",onClick:()=>K(!G),className:"absolute right-3 top-1/2 transform -translate-y-1/2 ".concat(t?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700"),children:G?(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):(0,kt.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]})]})]})]})});case"roles":return(0,kt.jsx)(Xx,{colorMode:t,roleAssignments:Q,setRoleAssignments:Z,availableUsers:$,saveRoleAssignments:Re});case"permissions":return(0,kt.jsx)(eb,{colorMode:t});case"team-members":return(0,kt.jsx)(nb,{colorMode:t});case"add-team-member":return(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"flex items-center mb-4",children:(0,kt.jsx)("button",{onClick:()=>i("team-members"),className:"mr-4 text-blue-600 hover:text-blue-800",children:"\u2190 Back to Team Members"})}),(0,kt.jsx)(rb,{colorMode:t})]});case"follow-up":return(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("h3",{className:"text-base font-semibold ".concat(t?"text-white":"text-gray-800"),children:"Bubbles AI Settings"}),(0,kt.jsx)("button",{onClick:Be,disabled:De,className:"px-3 py-1.5 rounded text-xs font-semibold transition-all duration-200 ".concat(De?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:De?"Saving...":"Save"})]}),(0,kt.jsxs)("div",{className:"mb-2",children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold mb-1 ".concat(t?"text-white":"text-gray-800"),children:"Follow-up Tracking"}),(0,kt.jsx)("div",{className:"text-xs text-gray-500",children:(0,kt.jsx)(Qx,{colorMode:t})})]}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-2 rounded border",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold ".concat(t?"text-white":"text-gray-800"),children:"Enable Automatic Follow-ups"}),(0,kt.jsx)("p",{className:"text-xs ".concat(t?"text-gray-300":"text-gray-600"),children:"Send follow-up reminders for tasks and alerts"})]}),(0,kt.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:Te.isEnabled,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{isEnabled:e.target.checked})),className:"sr-only peer"}),(0,kt.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),Te.isEnabled&&(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"border rounded p-2",children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold mb-2 ".concat(t?"text-white":"text-gray-800"),children:"Task Follow-up Timing"}),(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:Te.taskFollowUpDays,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{taskFollowUpDays:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:Te.taskFollowUpHours,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{taskFollowUpHours:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:Te.taskFollowUpMinutes,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{taskFollowUpMinutes:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]})]}),(0,kt.jsxs)("div",{className:"border rounded p-2",children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold mb-2 ".concat(t?"text-white":"text-gray-800"),children:"Reminder Follow-up Timing"}),(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:Te.reminderFollowUpDays,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{reminderFollowUpDays:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:Te.reminderFollowUpHours,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{reminderFollowUpHours:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:Te.reminderFollowUpMinutes,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{reminderFollowUpMinutes:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]})]}),(0,kt.jsxs)("div",{className:"border rounded p-2",children:[(0,kt.jsx)("h4",{className:"text-xs font-semibold mb-2 ".concat(t?"text-white":"text-gray-800"),children:"Alert Follow-up Timing"}),(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Days"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"365",value:Te.alertFollowUpDays,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{alertFollowUpDays:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Hours"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"23",value:Te.alertFollowUpHours,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{alertFollowUpHours:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-gray-300":"text-gray-700"),children:"Minutes"}),(0,kt.jsx)("input",{type:"number",min:"0",max:"59",value:Te.alertFollowUpMinutes,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{alertFollowUpMinutes:parseInt(e.target.value)||0})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-white":"text-gray-800"),children:"Max Follow-up Attempts"}),(0,kt.jsx)("input",{type:"number",min:"1",max:"10",value:Te.maxFollowUpAttempts,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{maxFollowUpAttempts:parseInt(e.target.value)||3})),className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-medium mb-1 ".concat(t?"text-white":"text-gray-800"),children:"Custom Follow-up Message"}),(0,kt.jsx)("textarea",{value:Te.followUpMessage,onChange:e=>Le(t=>(0,Y.A)((0,Y.A)({},t),{},{followUpMessage:e.target.value})),placeholder:"Custom message...",rows:2,maxLength:1e3,className:"w-full px-2 py-1 rounded border text-xs ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"border-gray-300 bg-white")}),(0,kt.jsxs)("p",{className:"text-xs mt-1 ".concat(t?"text-gray-400":"text-gray-500"),children:[Te.followUpMessage.length,"/1000"]})]})]})]})]})]});case"complete-excel":return(0,kt.jsx)(Fg,{colorMode:t});case"project-import":return(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"bg-blue-900/20 border-blue-500/40":"bg-blue-50 border-blue-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(t?"text-blue-300":"text-blue-900"),children:"\ud83d\udccb Project Data Import"}),(0,kt.jsx)("p",{className:"text-sm mb-3 ".concat(t?"text-blue-200":"text-blue-700"),children:"Import projects with customer data. Each project will be initialized with the complete 91-line item workflow starting at the LEAD phase."}),(0,kt.jsxs)("div",{className:"text-xs space-y-1 ".concat(t?"text-blue-200":"text-blue-600"),children:[(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Required Columns:"})," projectNumber, projectName, primaryName, primaryEmail, primaryPhone, address, projectType, budget, startDate, endDate"]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Optional Columns:"})," secondaryName, secondaryEmail, secondaryPhone, primaryContact, notes (customer notes), status, priority, estimatedCost, actualCost, description (project description), pmPhone, pmEmail, progress"]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Valid Project Types:"})," ROOF_REPLACEMENT, KITCHEN_REMODEL, BATHROOM_RENOVATION, SIDING_INSTALLATION, WINDOW_REPLACEMENT, FLOORING, PAINTING, ELECTRICAL_WORK, PLUMBING, HVAC, DECK_CONSTRUCTION, LANDSCAPING, OTHER"]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Valid Statuses:"})," PENDING, IN_PROGRESS, COMPLETED, ON_HOLD"]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Valid Priorities:"})," LOW, MEDIUM, HIGH"]})]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"bg-gray-800/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(t?"text-blue-300":"text-blue-900"),children:"\ud83d\udd27 Workflow Template"}),(0,kt.jsx)("p",{className:"text-sm mb-3 ".concat(t?"text-gray-300":"text-gray-700"),children:"Select the workflow template to assign to imported projects"}),(0,kt.jsxs)("select",{value:Se,onChange:e=>ke(e.target.value),className:"w-full p-2 rounded border text-sm ".concat(t?"bg-[#181f3a] border-[#3b82f6] text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Select a workflow template..."}),ne.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.name," - ",e.description]},e.id))]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"bg-gray-800/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(t?"text-blue-300":"text-blue-900"),children:"\ud83d\udcc4 Download CSV Template"}),(0,kt.jsx)("p",{className:"text-sm mb-3 ".concat(t?"text-gray-300":"text-gray-700"),children:"Download the combined Project + Customer template with project number field"}),(0,kt.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,kt.jsx)("button",{onClick:()=>Ue("combined"),className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 transition-colors text-sm font-medium",children:"\ud83c\udfd7\ufe0f\ud83d\udc65 Combined Template"}),(0,kt.jsx)("button",{onClick:()=>Ue("combined-instructions"),className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors text-sm font-medium",children:"\ud83d\udccb Upload Instructions"})]})]}),(0,kt.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(t?"border-gray-600 hover:border-gray-500":"border-gray-300 hover:border-gray-400"),children:[(0,kt.jsx)("div",{className:"text-4xl mb-4",children:"\ud83c\udfd7\ufe0f"}),Ae?(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"p-3 rounded border ".concat(t?"bg-gray-800 border-gray-600":"bg-gray-100 border-gray-300"),children:[(0,kt.jsxs)("p",{className:"text-sm font-medium ".concat(t?"text-white":"text-gray-800"),children:["Selected: ",Ae.name]}),(0,kt.jsxs)("p",{className:"text-xs ".concat(t?"text-gray-300":"text-gray-600"),children:["Size: ",(Ae.size/1024).toFixed(1)," KB"]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,kt.jsx)("button",{onClick:Fe,disabled:Ee||!Se,className:"px-6 py-2 rounded font-medium transition-colors ".concat(Ee||!Se?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700"),children:Ee?"\ud83d\udd04 Importing...":"\ud83d\udce4 Import Projects"}),(0,kt.jsx)("button",{onClick:()=>{Ce(null),Ie(null)},className:"px-4 py-2 rounded border transition-colors ".concat(t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"})]})]}):(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"cursor-pointer",children:[(0,kt.jsx)("span",{className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded hover:bg-blue-700 transition-colors",children:"Choose Project File"}),(0,kt.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{const t=e.target.files[0];t&&(Ce(t),Ie(null))},className:"hidden"})]}),(0,kt.jsx)("p",{className:"mt-2 text-sm ".concat(t?"text-gray-300":"text-gray-600"),children:"Upload your Excel or CSV file with project data"}),(0,kt.jsx)("p",{className:"mt-1 text-xs ".concat(t?"text-gray-400":"text-gray-500"),children:"Supported formats: .xlsx, .xls, .csv (max 10MB)"})]})]}),_e&&(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(_e.failed.length>0?t?"bg-yellow-900/20 border-yellow-500/40":"bg-yellow-50 border-yellow-200":t?"bg-green-900/20 border-green-500/40":"bg-green-50 border-green-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(_e.failed.length>0?t?"text-yellow-300":"text-yellow-900":t?"text-green-300":"text-green-900"),children:"\ud83d\udcca Import Results"}),(0,kt.jsxs)("div",{className:"text-sm space-y-2 ".concat(_e.failed.length>0?t?"text-yellow-200":"text-yellow-800":t?"text-green-200":"text-green-800"),children:[(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Total:"})," ",_e.total]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Successful:"})," ",_e.successful.length]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Failed:"})," ",_e.failed.length]})]}),_e.successful.length>0&&(0,kt.jsxs)("div",{className:"mt-4",children:[(0,kt.jsx)("h4",{className:"font-medium text-sm mb-2 ".concat(t?"text-green-300":"text-green-900"),children:"\u2705 Successfully Imported Projects:"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[_e.successful.slice(0,5).map((e,r)=>(0,kt.jsxs)("div",{className:"text-xs p-2 rounded ".concat(t?"bg-green-900/30":"bg-green-100"),children:[(0,kt.jsx)("strong",{children:e.projectNumber})," - ",e.customerName]},r)),_e.successful.length>5&&(0,kt.jsxs)("p",{className:"text-xs ".concat(t?"text-green-300":"text-green-700"),children:["... and ",_e.successful.length-5," more"]})]})]}),_e.failed.length>0&&(0,kt.jsxs)("div",{className:"mt-4",children:[(0,kt.jsx)("h4",{className:"font-medium text-sm mb-2 ".concat(t?"text-red-300":"text-red-900"),children:"\u274c Failed Imports:"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[_e.failed.slice(0,3).map((e,r)=>(0,kt.jsxs)("div",{className:"text-xs p-2 rounded ".concat(t?"bg-red-900/30":"bg-red-100"),children:[(0,kt.jsxs)("strong",{children:["Row ",e.row||r+1,":"]})," ",String(e.error||e.message||"Unknown error")]},r)),_e.failed.length>3&&(0,kt.jsxs)("p",{className:"text-xs ".concat(t?"text-red-300":"text-red-700"),children:["... and ",_e.failed.length-3," more errors"]})]})]})]}),(0,kt.jsxs)("div",{className:"border rounded-lg p-4 ".concat(t?"bg-gray-800/50 border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("h3",{className:"font-medium mb-2 ".concat(t?"text-blue-300":"text-blue-900"),children:"\ud83d\udca1 Example Project Data"}),(0,kt.jsx)("div",{className:"overflow-x-auto",children:(0,kt.jsxs)("table",{className:"min-w-full text-xs border-collapse ".concat(t?"border-gray-600":"border-gray-300"),children:[(0,kt.jsx)("thead",{children:(0,kt.jsxs)("tr",{className:t?"bg-gray-700/50":"bg-gray-100",children:[(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"projectNumber"}),(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"projectName"}),(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"primaryName"}),(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"primaryEmail"}),(0,kt.jsx)("th",{className:"px-2 py-1 text-left border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-900"),children:"address"})]})}),(0,kt.jsxs)("tbody",{children:[(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"12345"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"Smith Roof Replacement"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"John Smith"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"john.smith@email.com"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"123 Main St, Dallas TX"})]}),(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"12346"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"Doe Kitchen Remodel"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"Jane Doe"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"jane.doe@email.com"}),(0,kt.jsx)("td",{className:"px-2 py-1 border ".concat(t?"border-gray-600 text-gray-300":"border-gray-300 text-gray-800"),children:"456 Oak Ave, Dallas TX"})]})]})]})})]})]});case"workflow-import":return(0,kt.jsx)(vg,{})}};return(0,kt.jsx)("div",{className:"min-h-screen ".concat(t?"bg-[#0f172a]":"bg-gray-50"),children:(0,kt.jsx)("div",{className:"max-w-4xl mx-auto p-3",children:(0,kt.jsxs)("div",{className:"rounded-lg shadow-sm border ".concat(t?"bg-[#232b4d]/80 border-[#3b82f6]/40":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"flex flex-wrap border-b border-gray-200",children:ze.map(e=>(0,kt.jsxs)("button",{onClick:()=>i(e.id),className:"flex items-center gap-1 px-3 py-2 text-xs font-semibold transition-all duration-200 ".concat(s===e.id?"".concat(t?"text-blue-400 border-b-2 border-blue-400":"text-blue-600 border-b-2 border-blue-600"):"".concat(t?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800")),children:[(0,kt.jsx)("span",{className:"text-sm",children:e.icon}),e.label]},e.id))}),(0,kt.jsxs)("div",{className:"p-4",children:["profile"===s||"security"===s?(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!D){M(!0);try{var t;let e=null;if(O){const t=new FormData;t.append("avatar",O);const n=await fetch("".concat(Da.API_BASE_URL,"/auth/upload-avatar"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:t}),s=await n.json();if(console.log("\ud83d\udd04 AVATAR UPLOAD: Upload result:",s),!s.success)throw new Error(s.message||"Failed to upload profile picture");var r;e=s.data.user,console.log("\ud83d\udd04 AVATAR UPLOAD: Updated user:",e),console.log("\ud83d\udd04 AVATAR UPLOAD: Avatar URL:",null===(r=e)||void 0===r?void 0:r.avatar);try{localStorage.setItem("user",JSON.stringify(e)),sessionStorage.setItem("user",JSON.stringify(e))}catch(Pr){}"function"===typeof a&&(console.log("\ud83d\udd04 AVATAR UPLOAD: Calling onUserUpdated callback"),a(e)),R(null)}const n={};y&&y.trim()&&(n.firstName=y.trim()),j&&j.trim()&&(n.lastName=j.trim()),d&&d.trim()&&(n.email=d.trim()),h&&h.trim()&&(n.phone=h.trim()),g&&(n.timezone=g),x&&(n.language=x),void 0!==B&&null!==B&&(n.displayName=B.trim()||null),console.log("\ud83d\udd0d PROFILE SAVE: Sending payload:",n);const s=await Da.authService.updateUserProfile(n);if(console.log("\ud83d\udd0d PROFILE SAVE: API response:",s),null===s||void 0===s||!s.success||null===s||void 0===s||null===(t=s.data)||void 0===t||!t.user)throw new Error((null===s||void 0===s?void 0:s.message)||"Failed to update profile");{const t=s.data.user;if(console.log("\ud83d\udd0d PROFILE SAVE: Updated user data:",t),e&&e.avatar&&!t.avatar&&(t.avatar=e.avatar),!t.avatar)try{const e=JSON.parse(localStorage.getItem("user")||"{}");e.avatar&&(t.avatar=e.avatar)}catch(Pr){}w(t.firstName||""),N(t.lastName||""),u(t.email||""),m(t.phone||""),z(t.displayName||""),c("".concat(t.firstName||""," ").concat(t.lastName||"").trim());try{localStorage.setItem("user",JSON.stringify(t)),sessionStorage.setItem("user",JSON.stringify(t))}catch(Pr){}"function"===typeof a&&(console.log("\ud83d\udd0d PROFILE SAVE: Calling onUserUpdated callback with user:",t),a(t)),L("Profile updated successfully!"),I(!0),setTimeout(()=>I(!1),4e3)}}catch(XI){var n,s;console.error("Profile save failed:",XI),console.error("Profile save error details:",{message:null===XI||void 0===XI?void 0:XI.message,response:null===XI||void 0===XI||null===(n=XI.response)||void 0===n?void 0:n.data,status:null===XI||void 0===XI||null===(s=XI.response)||void 0===s?void 0:s.status}),L(String((null===XI||void 0===XI?void 0:XI.message)||"Failed to save profile")),I(!0),setTimeout(()=>I(!1),3e3)}finally{M(!1)}}},children:[qe(),(0,kt.jsx)("div",{className:"flex justify-end pt-3 border-t border-gray-200 mt-4",children:(0,kt.jsx)("button",{type:"submit",disabled:D,className:"px-6 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm ".concat(D?"bg-gray-400 cursor-not-allowed":t?"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white shadow-blue-900/20":"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white shadow-blue-600/20"," hover:shadow-md transform hover:scale-105"),children:(0,kt.jsx)("span",{className:"flex items-center gap-2",children:D?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,kt.jsx)("span",{children:"Saving..."})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"\ud83d\udcbe"}),(0,kt.jsx)("span",{children:"Save Changes"})]})})})})]}):qe(),_&&(0,kt.jsx)("div",{className:"fixed top-4 right-4 p-4 rounded-lg shadow-lg z-[99999] border-2 ".concat(t?"bg-green-800 border-green-600 text-white":"bg-green-100 border-green-300 text-green-800"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold text-sm",children:"Success!"}),(0,kt.jsx)("div",{className:"text-sm opacity-90",children:String(T)})]})]})})]})]})})})},sb=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})};class ob extends o.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Calendar Error Boundary caught an error:",e,t)}render(){var e;return this.state.hasError?(0,kt.jsxs)("div",{className:"p-8 text-center",children:[(0,kt.jsx)("div",{className:"text-red-500 text-xl font-bold mb-4",children:"Something went wrong"}),(0,kt.jsx)("p",{className:"text-gray-600 mb-4",children:"There was an error loading the calendar."}),(0,kt.jsx)("button",{onClick:()=>this.setState({hasError:!1,error:null}),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"}),(0,kt.jsx)("pre",{className:"mt-4 p-4 bg-gray-100 rounded text-left text-xs overflow-auto max-h-40",children:null===(e=this.state.error)||void 0===e?void 0:e.toString()})]}):this.props.children}}const ib=e=>{var t;let{projects:r,tasks:n,activities:a,colorMode:s,onProjectSelect:i}=e;const[l,c]=(0,o.useState)(new Date),[d,u]=(0,o.useState)(new Date),[h,m]=(0,o.useState)("month"),[p,f]=(0,o.useState)("team"),[g,v]=(0,o.useState)([]),[x,b]=(0,o.useState)([]),[y,w]=(0,o.useState)("all"),[j,N]=(0,o.useState)(null),[S,k]=(0,o.useState)(!1),[A,C]=(0,o.useState)(!1),[E,P]=(0,o.useState)([]),[_,I]=(0,o.useState)(!1),[T,L]=(0,o.useState)(!1),[D,M]=(0,o.useState)(null),[O,R]=(0,o.useState)(null),[F,U]=(0,o.useState)({title:"",type:"meeting",date:(new Date).toISOString().split("T")[0],time:"09:00",endTime:"10:00",description:"",projectId:"",priority:"medium"}),[B,z]=(0,o.useState)({}),[W,q]=(0,o.useState)(!1),[V,H]=(0,o.useState)(!1),G=["#3B82F6","#2563EB","#1D4ED8","#7C3AED","#8B5CF6","#10B981","#059669","#047857","#14B8A6","#06B6D4","#F59E0B","#D97706","#B45309","#EF4444","#DC2626","#EC4899","#DB2777","#6366F1","#4B5563","#6B7280"],[K,J]=(0,o.useState)({}),[X,Q]=(0,o.useState)(null),[Z,$]=(0,o.useState)(""),[ee,te]=(0,o.useState)("3y"),[re,ne]=(0,o.useState)("all"),[ae,se]=(0,o.useState)(!1),[oe,ie]=(0,o.useState)([]),[le,ce]=(0,o.useState)([]),[de,ue]=(0,o.useState)(!1),[he,me]=(0,o.useState)(!1),[pe,fe]=(0,o.useState)([]),[ge,ve]=(0,o.useState)(!1),[xe,be]=(0,o.useState)(!1),[ye,we]=(0,o.useState)(null),[je,Ne]=(0,o.useState)(null),Se=e=>{const t=((null===e||void 0===e?void 0:e.type)||"").toLowerCase(),r=(null===e||void 0===e?void 0:e.title)||"",n=r.toLowerCase();return"task"===t||"alert"===t||r.includes("\u26a0\ufe0f")||n.includes("alert")};(0,o.useEffect)(()=>{(async()=>{try{const e=await Da.authService.getCurrentUser();R(e)}catch(e){console.error("Failed to fetch current user:",e)}})()},[]);const ke=(e,t)=>{J(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t})),(async(e,t)=>{try{const r=localStorage.getItem("authToken"),n=await fetch("/api/users/".concat(e,"/calendar-color"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({calendarColor:t})});n.ok?console.log("\u2705 Calendar color saved for user ".concat(e,": ").concat(t)):console.error("Failed to save calendar color:",await n.text())}catch(r){console.error("Error saving calendar color:",r)}})(e,t),Q(null)},Ae=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e?L(!0):I(!0);const r=localStorage.getItem("authToken"),n=await fetch("/api/calendar-events?view=".concat(p),{headers:{Authorization:"Bearer ".concat(r)}});if(n.ok){var t;const e=await n.json();let r=[];Array.isArray(e)?r=e:null!==(t=e.data)&&void 0!==t&&t.events&&Array.isArray(e.data.events)?r=e.data.events:e.data&&Array.isArray(e.data)?r=e.data:e.events&&Array.isArray(e.events)&&(r=e.events),P(r.filter(e=>!Se(e))),M(new Date)}}catch(r){console.error("Error fetching calendar events:",r),P([])}finally{I(!1),L(!1)}},Ce=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"3y";if(!e||e.trim().length<2)return ce([]),void me(!1);ue(!0);try{const n=localStorage.getItem("authToken"),a=await fetch("/api/calendar-events/search?query=".concat(encodeURIComponent(e),"&dateRange=").concat(t),{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(a.ok){var r;const n=await a.json();let s=[];null!==(r=n.data)&&void 0!==r&&r.events?s=n.data.events:Array.isArray(n.data)&&(s=n.data),ce(s),me(!0),console.log("\ud83d\udcc5 Search found ".concat(s.length,' events for "').concat(e,'" within ').concat(t))}}catch(n){console.error("Error searching events:",n)}finally{ue(!1)}};(0,o.useEffect)(()=>{Ae();const e=setInterval(()=>{Ae(!0)},3e4),t=()=>{console.log("\ud83d\udcc5 Calendar update event received - refreshing..."),Ae(!0)};window.addEventListener("calendar:eventAdded",t),window.addEventListener("calendar:eventUpdated",t),window.addEventListener("calendar:eventDeleted",t);const r=()=>{Ae(!0)};return window.addEventListener("focus",r),()=>{clearInterval(e),window.removeEventListener("calendar:eventAdded",t),window.removeEventListener("calendar:eventUpdated",t),window.removeEventListener("calendar:eventDeleted",t),window.removeEventListener("focus",r)}},[p]),(0,o.useEffect)(()=>{(async()=>{try{const e=await Da.usersService.getTeamMembers();console.log("Calendar: fetchTeam response:",e);let t=[];e&&e.data&&Array.isArray(e.data.teamMembers)?(console.log("Calendar: Found members in response.data.teamMembers"),t=e.data.teamMembers):e&&Array.isArray(e.teamMembers)?(console.log("Calendar: Found members in response.teamMembers"),t=e.teamMembers):e&&Array.isArray(e.data)?(console.log("Calendar: Found members in response.data"),t=e.data):Array.isArray(e)&&(console.log("Calendar: Found members in response array"),t=e),console.log("Calendar: Setting ".concat(t.length," team members")),v(t);const r={};t.forEach((e,t)=>{e.calendarColor?r[e.id]=e.calendarColor:r[e.id]=G[t%G.length]}),J(e=>(0,Y.A)((0,Y.A)({},r),e));const n={};t.forEach(e=>{n[e.id]=!0}),z(e=>(0,Y.A)((0,Y.A)({},n),e))}catch(e){console.error("Failed to fetch team members:",e),v([])}})()},[]);const Ee=e=>{const t=e.getDay(),r=new Date(e);r.setDate(e.getDate()-t);const n=[];for(let a=0;a<7;a++){const t=new Date(r);t.setDate(r.getDate()+a),n.push({date:t,isCurrentMonth:t.getMonth()===e.getMonth(),events:Pe(t)})}return n},Pe=e=>{const t=[],n=e.toDateString(),a=e.toISOString().split("T")[0];Array.isArray(E)&&E.forEach(e=>{let r=null,n=null;if(e.startTime){const t=new Date(e.startTime);r=t.toISOString().split("T")[0],n=t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}else e.date&&(r=e.date,n=e.time);if(r===a){var s,o,i;const r=(null===(s=e.organizer)||void 0===s?void 0:s.id)||e.organizerId;if(Object.keys(B).length>0&&r&&!1===B[r])return;let a=e.color||_e((null===(o=e.eventType)||void 0===o?void 0:o.toLowerCase())||e.type);r&&K[r]&&(a=K[r]);const l={id:e.id||e._id||"db-event-".concat(e.title,"-").concat(Date.now()),title:e.title,type:(null===(i=e.eventType)||void 0===i?void 0:i.toLowerCase())||e.type||"meeting",time:n||e.time,priority:e.priority||"medium",color:a,description:e.description,projectId:e.projectId,attendees:e.attendees,organizer:e.organizer,organizerId:r,startTime:e.startTime,endTime:e.endTime};Se(l)||t.push(l)}}),(r||[]).forEach(e=>{e.materialsDeliveryStart&&new Date(e.materialsDeliveryStart).toDateString()===n&&t.push({id:"delivery-".concat(e.id),title:"\ud83d\udce6 ".concat(e.projectName||e.name," - Materials"),type:"delivery",project:e,time:"8:00 AM",priority:"medium",color:"bg-amber-500"}),e.laborStart&&new Date(e.laborStart).toDateString()===n&&t.push({id:"labor-".concat(e.id),title:"\ud83d\udc77 ".concat(e.projectName||e.name," - Labor"),type:"labor",project:e,time:"7:00 AM",priority:"medium",color:"bg-indigo-500"})});return[{date:"2024-01-02",title:"\ud83c\udfe2 New Year Office Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-01-03",title:"\ud83d\udd27 Equipment Calibration",type:"maintenance",time:"8:00 AM"},{date:"2024-01-05",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-08",title:"\ud83d\udc65 Client Consultation - Johnson Roof",type:"meeting",time:"10:00 AM"},{date:"2024-01-09",title:"\ud83d\udcca Monthly Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-01-10",title:"\ud83d\udee0\ufe0f Tool Maintenance Day",type:"maintenance",time:"8:00 AM"},{date:"2024-01-12",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-15",title:"\ud83d\udcc5 Safety Training - Fall Protection",type:"training",time:"10:00 AM"},{date:"2024-01-17",title:"\ud83d\udcdd Permit Application Deadline",type:"deadline",time:"5:00 PM"},{date:"2024-01-19",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-23",title:"\ud83d\udd27 Vehicle Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-01-24",title:"\ud83d\udcca Project Progress Review",type:"meeting",time:"1:00 PM"},{date:"2024-01-26",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-29",title:"\ud83d\udc65 Insurance Agent Meeting",type:"meeting",time:"3:00 PM"},{date:"2024-01-30",title:"\ud83d\udcc5 OSHA Compliance Training",type:"training",time:"9:00 AM"},{date:"2024-01-31",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-02-02",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-05",title:"\ud83d\udc65 Client Meeting - Smith Residence",type:"meeting",time:"10:00 AM"},{date:"2024-02-06",title:"\ud83d\udd27 Equipment Inventory Check",type:"maintenance",time:"8:00 AM"},{date:"2024-02-07",title:"\ud83d\udcca Quarterly Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-02-09",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-12",title:"\ud83d\udc65 Subcontractor Coordination",type:"meeting",time:"11:00 AM"},{date:"2024-02-13",title:"\ud83d\udee0\ufe0f Safety Equipment Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-02-14",title:"\ud83d\udcc5 First Aid Training",type:"training",time:"10:00 AM"},{date:"2024-02-16",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-19",title:"\ud83d\udc65 Site Walkthrough - New Project",type:"inspection",time:"9:00 AM"},{date:"2024-02-20",title:"\ud83d\udcdd Insurance Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-02-21",title:"\ud83d\udd27 Generator Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-02-23",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-26",title:"\ud83d\udc65 Team Building Event",type:"meeting",time:"12:00 PM"},{date:"2024-02-27",title:"\ud83d\udcca Budget Review Meeting",type:"meeting",time:"1:00 PM"},{date:"2024-02-28",title:"\ud83d\udcc5 CPR Certification Renewal",type:"training",time:"9:00 AM"},{date:"2024-02-29",title:"\ud83d\udcdd Monthly Safety Reports",type:"deadline",time:"5:00 PM"},{date:"2024-03-01",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-04",title:"\ud83d\udc65 Client Presentation - Large Project",type:"meeting",time:"10:00 AM"},{date:"2024-03-05",title:"\ud83d\udd27 Compressor Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-03-06",title:"\ud83d\udcca Annual Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-03-08",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-11",title:"\ud83d\udc65 Architect Meeting - Design Review",type:"meeting",time:"11:00 AM"},{date:"2024-03-12",title:"\ud83d\udee0\ufe0f Scaffolding Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-03-13",title:"\ud83d\udcc5 Hazard Communication Training",type:"training",time:"10:00 AM"},{date:"2024-03-15",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-18",title:"\ud83d\udc65 Quality Control Review",type:"meeting",time:"1:00 PM"},{date:"2024-03-19",title:"\ud83d\udcdd Contract Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-03-20",title:"\ud83d\udd27 Welding Equipment Check",type:"maintenance",time:"8:00 AM"},{date:"2024-03-22",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-25",title:"\ud83d\udc65 Site Safety Audit",type:"inspection",time:"9:00 AM"},{date:"2024-03-26",title:"\ud83d\udcca Performance Review Meeting",type:"meeting",time:"2:00 PM"},{date:"2024-03-27",title:"\ud83d\udcc5 Confined Space Training",type:"training",time:"10:00 AM"},{date:"2024-03-29",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-31",title:"\ud83d\udcdd Quarterly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-04-01",title:"\ud83c\udfe2 Spring Safety Kickoff",type:"meeting",time:"8:00 AM"},{date:"2024-04-02",title:"\ud83d\udd27 Spring Equipment Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-04-03",title:"\ud83d\udc65 New Project Kickoff Meeting",type:"meeting",time:"10:00 AM"},{date:"2024-04-05",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-09",title:"\ud83d\udee0\ufe0f Electrical Safety Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-04-10",title:"\ud83d\udcc5 Ladder Safety Training",type:"training",time:"10:00 AM"},{date:"2024-04-12",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-15",title:"\ud83d\udc65 Subcontractor Safety Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-04-16",title:"\ud83d\udcdd Tax Filing Deadline",type:"deadline",time:"5:00 PM"},{date:"2024-04-17",title:"\ud83d\udd27 Crane Inspection",type:"maintenance",time:"8:00 AM"},{date:"2024-04-19",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-22",title:"\ud83d\udc65 Project Completion Review",type:"meeting",time:"1:00 PM"},{date:"2024-04-23",title:"\ud83d\udcca Monthly Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-04-24",title:"\ud83d\udcc5 Personal Protective Equipment Training",type:"training",time:"10:00 AM"},{date:"2024-04-26",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-29",title:"\ud83d\udc65 Insurance Claim Meeting",type:"meeting",time:"3:00 PM"},{date:"2024-04-30",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-05-01",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-03",title:"\ud83d\udc65 Client Meeting - Summer Projects",type:"meeting",time:"10:00 AM"},{date:"2024-05-06",title:"\ud83d\udd27 HVAC System Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-05-07",title:"\ud83d\udcca Q2 Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-05-10",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-13",title:"\ud83d\udc65 Site Safety Walkthrough",type:"inspection",time:"9:00 AM"},{date:"2024-05-14",title:"\ud83d\udcc5 Heat Stress Training",type:"training",time:"10:00 AM"},{date:"2024-05-17",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-20",title:"\ud83d\udc65 Equipment Rental Meeting",type:"meeting",time:"11:00 AM"},{date:"2024-05-21",title:"\ud83d\udcdd Permit Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-05-22",title:"\ud83d\udd27 Excavator Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-05-24",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-27",title:"\ud83d\udc65 Memorial Day Safety Briefing",type:"meeting",time:"8:00 AM"},{date:"2024-05-28",title:"\ud83d\udcca Monthly Progress Review",type:"meeting",time:"1:00 PM"},{date:"2024-05-29",title:"\ud83d\udcc5 Emergency Response Training",type:"training",time:"10:00 AM"},{date:"2024-05-31",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-06-03",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-05",title:"\ud83d\udc65 Summer Project Kickoff",type:"meeting",time:"10:00 AM"},{date:"2024-06-06",title:"\ud83d\udd27 Summer Equipment Prep",type:"maintenance",time:"8:00 AM"},{date:"2024-06-07",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-10",title:"\ud83d\udc65 Client Site Visit - Summer Homes",type:"meeting",time:"11:00 AM"},{date:"2024-06-11",title:"\ud83d\udee0\ufe0f Summer Safety Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-06-12",title:"\ud83d\udcc5 Heat Illness Prevention Training",type:"training",time:"10:00 AM"},{date:"2024-06-14",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-17",title:"\ud83d\udc65 Subcontractor Summer Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-06-18",title:"\ud83d\udcdd Insurance Mid-Year Review",type:"deadline",time:"4:00 PM"},{date:"2024-06-19",title:"\ud83d\udd27 Cooling System Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-06-21",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-24",title:"\ud83d\udc65 Summer Project Review",type:"meeting",time:"1:00 PM"},{date:"2024-06-25",title:"\ud83d\udcca Q2 Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-06-26",title:"\ud83d\udcc5 Summer Safety Training",type:"training",time:"10:00 AM"},{date:"2024-06-28",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-30",title:"\ud83d\udcdd Quarterly Reports Due",type:"deadline",time:"5:00 PM"}].forEach(e=>{e.date===a&&t.push({id:"mock-".concat(e.date,"-").concat(e.type),title:e.title,type:e.type,time:e.time,priority:"medium",color:_e(e.type)})}),t},_e=e=>{switch(e){case"meeting":return"bg-blue-500";case"training":return"bg-purple-500";case"maintenance":return"bg-orange-500";case"inspection":return"bg-yellow-500";case"deadline":return"bg-red-500";case"project-start":return"bg-green-500";case"project-end":return"bg-emerald-500";case"delivery":return"bg-amber-500";case"labor":return"bg-indigo-500";default:return"bg-gray-500"}},Ie=e=>"all"===y?e:e.filter(e=>e.type===y),Te=e=>{const t=e.color;return(e=>e&&e.startsWith("#"))(t)?{className:"text-white hover:opacity-90 shadow-sm",style:{backgroundColor:t}}:{className:"".concat(t," text-white hover:opacity-90 shadow-sm"),style:{}}},Le=e=>{c(t=>{const r=new Date(t);return r.setMonth(t.getMonth()+e),r})},De=e=>e.toDateString()===(new Date).toDateString(),Me=e=>e.toDateString()===d.toDateString(),Oe=e=>{u(e)},Re=e=>{N(e),k(!0),e.project&&i&&i(e.project,"Project Workflow",null,"Company Calendar")},Fe=()=>{k(!1),N(null),be(!1),we(null)},Ue=(e,t)=>{we(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))},Be=()=>{C(!1),U({title:"",type:"meeting",date:(new Date).toISOString().split("T")[0],time:"09:00",endTime:"10:00",description:"",projectId:"",priority:"medium"})},ze=(e,t)=>{U(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))},We=(e=>{const t=e.getFullYear(),r=e.getMonth(),n=new Date(t,r,1),a=new Date(t,r+1,0).getDate(),s=[];for(let i=n.getDay()-1;i>=0;i--){const e=new Date(t,r,-i);s.push({date:e,isCurrentMonth:!1,events:Pe(e)})}for(let i=1;i<=a;i++){const e=new Date(t,r,i);s.push({date:e,isCurrentMonth:!0,events:Pe(e)})}const o=42-s.length;for(let i=1;i<=o;i++){const e=new Date(t,r+1,i);s.push({date:e,isCurrentMonth:!1,events:Pe(e)})}return s})(l);return(0,kt.jsxs)("div",{className:"animate-fade-in w-full max-w-full",children:[(0,kt.jsxs)("div",{className:"mb-4 rounded-2xl overflow-hidden ".concat("bg-[#F8FAFC]"," shadow-xl border ").concat(s?"border-white/10":"border-slate-200"),children:[(0,kt.jsx)("div",{className:"px-6 py-4 ".concat(s?"bg-gradient-to-r from-blue-600/10 via-purple-600/5 to-blue-600/10":"bg-[#F8FAFC]"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("div",{className:"flex items-center rounded-xl p-1 ".concat(s?"bg-slate-800/80":"bg-white shadow-sm border border-slate-200"),children:["month","week","day"].map(e=>(0,kt.jsx)("button",{onClick:()=>m(e),className:"px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-300 ".concat("".concat(h===e?s?"bg-[#F8FAFC] text-white shadow-lg shadow-blue-500/25":"bg-[#F8FAFC] text-white shadow-lg shadow-blue-600/25":s?"text-slate-400 hover:text-white hover:bg-slate-700/50":"text-slate-600 hover:text-slate-900 hover:bg-slate-100")),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,kt.jsx)("div",{className:"h-8 w-px ".concat(s?"bg-slate-700":"bg-slate-200")}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsxs)("button",{onClick:()=>{C(!0)},className:"flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-semibold text-white bg-[var(--color-brand-aqua-blue)] hover:bg-[var(--color-brand-deep-teal)] shadow-lg shadow-[var(--color-brand-aqua-blue)]/30 hover:shadow-[var(--color-brand-aqua-blue)]/50 transition-all duration-300 hover:scale-[1.02]",children:[(0,kt.jsx)(rn,{className:"w-4 h-4"}),"Add Event"]}),(0,kt.jsxs)("div",{className:"flex items-center rounded-xl p-1 ".concat(s?"bg-slate-800/80":"bg-white shadow-sm border border-slate-200"),children:[(0,kt.jsx)("button",{onClick:()=>f("team"),className:"flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-300 ".concat("".concat("team"===p?"bg-[var(--color-brand-aqua-blue)] text-white shadow-lg shadow-[var(--color-brand-aqua-blue)]/25":s?"text-slate-400 hover:text-white hover:bg-slate-700/50":"text-slate-600 hover:text-slate-900 hover:bg-slate-100")),title:"View all team events",children:"\ud83d\udc65 Team"}),(0,kt.jsx)("button",{onClick:()=>f("personal"),className:"flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-300 ".concat("".concat("personal"===p?"bg-[var(--color-brand-deep-teal)] text-white shadow-lg shadow-[var(--color-brand-deep-teal)]/25":s?"text-slate-400 hover:text-white hover:bg-slate-700/50":"text-slate-600 hover:text-slate-900 hover:bg-slate-100")),title:"View only your assigned events",children:"\ud83d\udc64 My Events"})]}),(0,kt.jsx)("button",{onClick:()=>Ae(),disabled:T||_,className:"p-2.5 rounded-xl transition-all duration-300 ".concat(s?"bg-slate-700/50 text-slate-300 hover:bg-slate-700 border border-slate-600":"bg-slate-100 text-slate-600 hover:bg-slate-200 border border-slate-200"," ").concat(T||_?"opacity-60":"hover:scale-105"),title:D?"Last updated: ".concat(D.toLocaleTimeString()):"Refresh",children:(0,kt.jsx)("span",{className:"text-lg ".concat(T?"animate-spin inline-block":""),children:"\ud83d\udd04"})}),(0,kt.jsx)("button",{onClick:()=>{ge||(async()=>{try{const t=localStorage.getItem("authToken"),r=await fetch("/api/calendar-events/recent",{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(r.ok){var e;const t=await r.json();let n=[];null!==(e=t.data)&&void 0!==e&&e.events?n=t.data.events:Array.isArray(t.data)&&(n=t.data),fe(n),console.log("\ud83d\udcc5 Fetched",n.length,"recently added events")}}catch(t){console.error("Error fetching recently added events:",t)}})(),ve(!ge)},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 ".concat(ge?s?"bg-emerald-500/20 text-emerald-300 border border-emerald-500/30":"bg-emerald-50 text-emerald-700 border border-emerald-200":s?"bg-slate-700/50 text-slate-300 border border-slate-600":"bg-slate-100 text-slate-600 border border-slate-200"),title:"Recently Added Events (Audit Trail)",children:"\ud83d\udd50 Recent"})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"relative flex items-center gap-3 px-5 py-3 rounded-2xl transition-all duration-300 ".concat(s?"bg-gradient-to-r from-slate-800/90 to-slate-700/90 border border-slate-600/50 shadow-lg shadow-slate-900/30 hover:shadow-xl hover:shadow-slate-900/40 hover:border-slate-500/50":"bg-[#F8FAFC] border border-slate-200/80 shadow-lg shadow-slate-200/50 hover:shadow-xl hover:shadow-slate-300/50 hover:border-blue-200"),style:{minWidth:"380px"},children:[(0,kt.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-xl transition-all duration-300 ".concat(s?"bg-gradient-to-br from-blue-500/20 to-indigo-500/20 border border-blue-500/30":"bg-[#F8FAFC] border border-blue-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5 ".concat(s?"text-blue-400":"text-blue-600"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,kt.jsx)("input",{type:"text",value:Z,onChange:e=>$(e.target.value),onKeyDown:e=>{"Enter"===e.key&&Z.trim().length>=2&&Ce(Z,ee)},placeholder:"Search events...",className:"flex-1 bg-transparent text-sm font-medium outline-none transition-all duration-300 ".concat(s?"text-white placeholder-slate-400":"text-slate-800 placeholder-slate-400"),style:{minWidth:"160px"}}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl transition-all duration-300 cursor-pointer ".concat(s?"bg-slate-700/60 border border-slate-600/50 hover:bg-slate-600/60":"bg-[#F8FAFC] border border-slate-200 hover:from-[var(--color-brand-aqua-blue-light-tint)] hover:to-[var(--color-brand-aqua-blue-light-tint)] hover:border-[var(--color-brand-aqua-blue)]"),children:[(0,kt.jsx)("svg",{className:"w-4 h-4 ".concat(s?"text-slate-400":"text-slate-500"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,kt.jsxs)("select",{value:ee,onChange:e=>te(e.target.value),className:"bg-transparent text-sm font-semibold outline-none cursor-pointer appearance-none pr-1 ".concat(s?"text-slate-300":"text-slate-700"),children:[(0,kt.jsx)("option",{value:"3m",children:"3 Months"}),(0,kt.jsx)("option",{value:"6m",children:"6 Months"}),(0,kt.jsx)("option",{value:"1y",children:"1 Year"}),(0,kt.jsx)("option",{value:"2y",children:"2 Years"}),(0,kt.jsx)("option",{value:"3y",children:"3 Years"}),(0,kt.jsx)("option",{value:"5y",children:"5 Years"})]}),(0,kt.jsx)("svg",{className:"w-3 h-3 ".concat(s?"text-slate-500":"text-slate-400"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),(0,kt.jsx)("button",{onClick:()=>Z.trim().length>=2&&Ce(Z,ee),disabled:Z.trim().length<2||de,className:"flex items-center justify-center w-10 h-10 rounded-xl transition-all duration-300 ".concat(Z.trim().length>=2?"bg-[var(--color-brand-aqua-blue)] text-white shadow-md shadow-[var(--color-brand-aqua-blue)]/30 hover:bg-[var(--color-brand-deep-teal)] hover:shadow-lg hover:shadow-[var(--color-brand-aqua-blue)]/40 hover:scale-105 cursor-pointer":s?"bg-slate-700/50 text-slate-500 cursor-not-allowed":"bg-slate-100 text-slate-400 cursor-not-allowed"),title:"Search",children:de?(0,kt.jsxs)("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})})]}),he&&le.length>0&&(0,kt.jsxs)("button",{onClick:()=>{me(!1),ce([]),$("")},className:"flex items-center gap-2 px-4 py-3 rounded-xl font-semibold text-sm transition-all duration-300 ".concat(s?"bg-gradient-to-r from-red-500/20 to-rose-500/20 text-red-300 border border-red-500/30 hover:from-red-500/30 hover:to-rose-500/30 hover:border-red-400/50":"bg-[#F8FAFC] text-red-600 border border-red-200 hover:from-red-100 hover:to-rose-100 hover:border-red-300"),children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,kt.jsx)("span",{children:"Clear"})]}),D&&(0,kt.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl ".concat(s?"bg-slate-800/60 border border-slate-700/50":"bg-slate-50 border border-slate-200"),children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full animate-pulse ".concat(s?"bg-emerald-400":"bg-emerald-500")}),(0,kt.jsx)("span",{className:"text-xs font-medium ".concat(s?"text-slate-400":"text-slate-500"),children:D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]})}),(0,kt.jsx)("div",{className:"px-6 py-3 ".concat(s?"bg-slate-800/50 border-t border-slate-700/50":"bg-slate-50 border-t border-slate-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wider ".concat(s?"text-slate-500":"text-slate-400"),children:"Team Calendars"}),(0,kt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,kt.jsx)("button",{onClick:()=>{const e={};(g||[]).forEach(t=>{e[t.id]=!0}),z(e)},className:"px-3 py-1 rounded-lg text-xs font-medium transition-all ".concat(s?"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 border border-emerald-500/20":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200"),children:"Show All"}),(0,kt.jsx)("button",{onClick:()=>{const e={};(g||[]).forEach(t=>{e[t.id]=!1}),z(e)},className:"px-3 py-1 rounded-lg text-xs font-medium transition-all ".concat(s?"bg-slate-700/50 text-slate-400 hover:bg-slate-700 border border-slate-600":"bg-slate-100 text-slate-500 hover:bg-slate-200 border border-slate-200"),children:"Hide All"})]})]}),(0,kt.jsx)("div",{className:"flex-1 flex items-center justify-end gap-2 flex-wrap",children:(g||[]).map(e=>{var t;const r=K[e.id]||G[g.indexOf(e)%G.length],n=!1!==B[e.id];return(0,kt.jsxs)("div",{className:"relative group",children:[(0,kt.jsxs)("button",{onClick:()=>z(t=>(0,Y.A)((0,Y.A)({},t),{},{[e.id]:!1===t[e.id]})),className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all duration-300 ".concat(n?s?"bg-slate-700/80 text-white shadow-sm hover:bg-slate-700":"bg-white text-slate-800 shadow-sm border border-slate-200 hover:shadow-md":s?"bg-slate-800/50 text-slate-500 hover:bg-slate-700/50":"bg-slate-100 text-slate-400 hover:bg-slate-200"),title:"".concat(e.firstName," ").concat(e.lastName),children:[(0,kt.jsx)("span",{className:"w-3 h-3 rounded-full ring-2 ring-offset-1 transition-all ".concat(s?"ring-offset-slate-800":"ring-offset-white"),style:{backgroundColor:r,opacity:n?1:.4,ringColor:n?r:"transparent"}}),(0,kt.jsxs)("span",{className:"transition-all ".concat(n?"":"opacity-50"),children:[e.firstName," ",null===(t=e.lastName)||void 0===t?void 0:t.charAt(0),"."]})]}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),Q(X===e.id?null:e.id)},className:"absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 opacity-0 group-hover:opacity-100 transition-all hover:scale-125 shadow-lg ".concat(s?"border-slate-800":"border-white"),style:{backgroundColor:r},title:"Change color"}),X===e.id&&(0,kt.jsxs)("div",{className:"absolute top-full right-0 mt-2 p-3 rounded-xl shadow-2xl z-50 ".concat(s?"bg-slate-800 border border-slate-700":"bg-white border border-slate-200"),onClick:e=>e.stopPropagation(),children:[(0,kt.jsx)("div",{className:"text-xs font-medium mb-2 ".concat(s?"text-slate-400":"text-slate-500"),children:"Choose Color"}),(0,kt.jsx)("div",{className:"grid grid-cols-5 gap-1.5 mb-2",children:G.map((t,r)=>(0,kt.jsx)("button",{onClick:()=>ke(e.id,t),className:"w-7 h-7 rounded-lg hover:scale-110 transition-transform shadow-sm border-2 ".concat(s?"border-slate-700":"border-slate-100"),style:{backgroundColor:t}},r))}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 pt-2 border-t border-slate-200/20",children:[(0,kt.jsx)("input",{type:"color",onChange:t=>ke(e.id,t.target.value),className:"w-8 h-8 rounded-lg cursor-pointer"}),(0,kt.jsx)("span",{className:"text-xs ".concat(s?"text-slate-500":"text-slate-400"),children:"Custom"})]})]})]},e.id)})})]})})]}),ge&&(0,kt.jsxs)("div",{className:"mb-3 p-4 rounded-xl shadow-md ".concat(s?"bg-[#1e293b] border border-green-500/30":"bg-white border border-green-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsx)("h3",{className:"text-sm font-bold ".concat(s?"text-white":"text-gray-800"),children:"\ud83d\udd50 Recently Added (Audit Trail)"}),(0,kt.jsx)("span",{className:"text-xs ".concat(s?"text-gray-400":"text-gray-500"),children:"Last 15 events by creation time"})]}),(0,kt.jsx)("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:0===pe.length?(0,kt.jsx)("div",{className:"text-center py-4 text-xs ".concat(s?"text-gray-400":"text-gray-500"),children:"No recently added events"}):pe.map((e,t)=>(0,kt.jsxs)("div",{onClick:()=>Re(e),className:"flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-all ".concat(s?"hover:bg-[#374151] bg-[#0f172a]":"hover:bg-gray-100 bg-gray-50"),children:[(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"text-sm font-medium truncate ".concat(s?"text-white":"text-gray-800"),children:e.title||"Untitled Event"}),(0,kt.jsxs)("div",{className:"text-xs ".concat(s?"text-gray-400":"text-gray-500"),children:["Event Date: ",e.startTime?new Date(e.startTime).toLocaleDateString():"N/A"]}),(0,kt.jsxs)("div",{className:"text-xs ".concat(s?"text-gray-500":"text-gray-400"),children:["Created: ",e.createdAt?new Date(e.createdAt).toLocaleString():"N/A"]}),e.organizer&&(0,kt.jsxs)("div",{className:"text-xs ".concat(s?"text-blue-400":"text-blue-600"),children:["By: ",e.organizer.firstName," ",e.organizer.lastName]})]}),(0,kt.jsx)("span",{className:"text-[10px] px-2 py-1 rounded ".concat(s?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-600"),children:e.eventType||"Event"})]},e.id||t))})]}),he&&le.length>0&&(0,kt.jsxs)("div",{className:"mb-4 rounded-2xl overflow-hidden shadow-xl ".concat(s?"bg-[#F8FAFC] border border-[var(--color-brand-aqua-blue)]/20":"bg-[#F8FAFC] border border-[var(--color-brand-aqua-blue)]/30"),children:[(0,kt.jsxs)("div",{className:"px-5 py-4 flex items-center justify-between ".concat(s?"bg-[var(--color-brand-aqua-blue)]/10 border-b border-slate-700/50":"bg-[#F8FAFC] border-b border-slate-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"flex items-center justify-center w-9 h-9 rounded-xl ".concat(s?"bg-[var(--color-brand-aqua-blue)]/20 border border-[var(--color-brand-aqua-blue)]/30":"bg-[var(--color-brand-aqua-blue-light-tint)] border border-[var(--color-brand-aqua-blue)]/30"),children:(0,kt.jsx)("svg",{className:"w-5 h-5 ".concat(s?"text-blue-400":"text-blue-600"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-sm font-bold ".concat(s?"text-white":"text-slate-800"),children:"Search Results"}),(0,kt.jsxs)("p",{className:"text-xs ".concat(s?"text-slate-400":"text-slate-500"),children:["Found ",(0,kt.jsx)("span",{className:"font-semibold ".concat(s?"text-blue-400":"text-blue-600"),children:le.length})," event",1!==le.length?"s":"",' for "',Z,'"']})]})]}),(0,kt.jsxs)("button",{onClick:()=>{me(!1),ce([]),$("")},className:"flex items-center gap-2 px-3 py-2 rounded-xl text-xs font-semibold transition-all duration-300 ".concat(s?"bg-slate-700/50 text-slate-400 hover:bg-slate-700 hover:text-white border border-slate-600/50":"bg-slate-100 text-slate-500 hover:bg-slate-200 hover:text-slate-700 border border-slate-200"),children:[(0,kt.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Close"]})]}),(0,kt.jsx)("div",{className:"p-4 space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar",children:le.map((e,t)=>{const r=Te(e);return(0,kt.jsxs)("div",{onClick:()=>Re(e),className:"group flex items-start gap-4 p-4 rounded-xl cursor-pointer transition-all duration-300 ".concat(s?"bg-slate-700/30 hover:bg-slate-700/60 border border-slate-700/50 hover:border-slate-600":"bg-white hover:bg-blue-50/50 border border-slate-200/80 hover:border-blue-200 shadow-sm hover:shadow-md"),children:[(0,kt.jsx)("div",{className:"w-1.5 h-full min-h-[48px] rounded-full flex-shrink-0",style:r.style.backgroundColor?{backgroundColor:r.style.backgroundColor}:{backgroundColor:"#3B82F6"}}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"text-sm font-semibold truncate group-hover:text-blue-500 transition-colors ".concat(s?"text-white":"text-slate-800"),children:e.title||"Untitled Event"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs ".concat(s?"text-slate-400":"text-slate-500"),children:[(0,kt.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.startTime?new Date(e.startTime).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"N/A",e.startTime&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{className:s?"text-slate-600":"text-slate-300",children:"\u2022"}),(0,kt.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),new Date(e.startTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})]})]}),e.description&&(0,kt.jsxs)("div",{className:"text-xs mt-1.5 line-clamp-1 ".concat(s?"text-slate-500":"text-slate-400"),children:[e.description.substring(0,100),e.description.length>100?"...":""]}),e.organizer&&(0,kt.jsxs)("div",{className:"flex items-center gap-1.5 mt-2 text-xs ".concat(s?"text-blue-400":"text-blue-600"),children:[(0,kt.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.organizer.firstName," ",e.organizer.lastName]})]}),(0,kt.jsx)("div",{className:"flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-semibold ".concat(s?"bg-slate-800 text-slate-300 border border-slate-700":"bg-[#F8FAFC] text-slate-600 border border-slate-200"),children:e.eventType||"Event"})]},e.id||t)})})]}),(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3 p-3 rounded-xl shadow-md ".concat(s?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:[(0,kt.jsx)("button",{onClick:()=>Le(-1),className:"p-1.5 rounded-md transition-all duration-200 shadow-sm ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"),children:(0,kt.jsx)(nn,{className:"w-4 h-4"})}),(0,kt.jsx)("h2",{className:"text-base font-bold ".concat(s?"text-white":"text-gray-800"),children:(qe=l,qe.toLocaleDateString("en-US",{month:"long",year:"numeric"}))}),(0,kt.jsx)("button",{onClick:()=>Le(1),className:"p-1.5 rounded-md transition-all duration-200 shadow-sm ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"),children:(0,kt.jsx)(sb,{className:"w-4 h-4"})})]}),"month"===h&&(0,kt.jsxs)("div",{className:"rounded-lg shadow-lg border overflow-hidden ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"grid grid-cols-7 ".concat(s?"bg-[#F8FAFC] border-b border-[#3b82f6]/40":"bg-[#F8FAFC] border-b border-gray-200"),children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,kt.jsx)("div",{className:"p-2 text-center text-xs font-bold ".concat(s?"text-gray-300":"text-gray-700"),children:e},e))}),(0,kt.jsx)("div",{className:"grid grid-cols-7",children:We.map((e,t)=>(0,kt.jsxs)("div",{onClick:()=>Oe(e.date),className:"min-h-[60px] p-1 border-r border-b cursor-pointer transition-all duration-200 ".concat(s?"border-[#3b82f6]/20 hover:bg-[#374151]/50":"border-gray-200 hover:bg-blue-50/50"," ").concat(e.isCurrentMonth?"":s?"bg-[#1e293b]/30":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-xs font-bold mb-1 ".concat(De(e.date)?"bg-[var(--color-brand-aqua-blue)] text-white rounded-full w-5 h-5 flex items-center justify-center shadow-md":Me(e.date)?"".concat("text-[var(--color-brand-aqua-blue)]"," font-bold"):e.isCurrentMonth?s?"text-white":"text-gray-900":s?"text-gray-500":"text-gray-400"),children:e.date.getDate()}),(0,kt.jsxs)("div",{className:"space-y-0.5",children:[Ie(e.events).slice(0,1).map(e=>{const t=Te(e);return(0,kt.jsxs)("div",{onClick:t=>{t.stopPropagation(),Re(e)},className:"text-xs p-0.5 rounded cursor-pointer transition-all duration-200 ".concat(t.className),style:t.style,title:"".concat(e.time," - ").concat(e.title),children:[(0,kt.jsx)("div",{className:"truncate font-medium text-xs",children:e.title}),(0,kt.jsx)("div",{className:"text-xs opacity-90",children:e.time})]},e.id)}),Ie(e.events).length>1&&(0,kt.jsxs)("button",{onClick:t=>{t.stopPropagation(),Ne({date:e.date,events:Ie(e.events)})},className:"w-full text-xs px-1 py-0.5 rounded shadow-sm font-medium transition-all duration-200 hover:scale-105 ".concat("bg-[var(--color-brand-aqua-blue)] text-white hover:bg-[var(--color-brand-deep-teal)]"),children:["+",Ie(e.events).length-1," more"]})]})]},t))})]}),"week"===h&&(0,kt.jsxs)("div",{className:"rounded-lg shadow-lg border overflow-hidden ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"grid grid-cols-7 ".concat(s?"bg-[#F8FAFC] border-b border-[#3b82f6]/40":"bg-[#F8FAFC] border-b border-gray-200"),children:Ee(d).map((e,t)=>(0,kt.jsxs)("div",{className:"p-2 text-center cursor-pointer transition-all ".concat(Me(e.date)?s?"bg-[#3b82f6]/30":"bg-blue-100":""),onClick:()=>Oe(e.date),children:[(0,kt.jsx)("div",{className:"text-xs font-bold ".concat(s?"text-gray-300":"text-gray-700"),children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t]}),(0,kt.jsx)("div",{className:"text-sm font-bold ".concat(De(e.date)?"bg-[var(--color-brand-aqua-blue)] text-white rounded-full w-6 h-6 flex items-center justify-center mx-auto":s?"text-white":"text-gray-900"),children:e.date.getDate()})]},t))}),(0,kt.jsx)("div",{className:"grid grid-cols-7",children:Ee(d).map((e,t)=>(0,kt.jsx)("div",{className:"min-h-[300px] p-2 border-r ".concat(s?"border-[#3b82f6]/20":"border-gray-200"),children:(0,kt.jsx)("div",{className:"space-y-1",children:Ie(e.events).map(e=>{const t=Te(e);return(0,kt.jsxs)("div",{onClick:()=>Re(e),className:"text-xs p-2 rounded cursor-pointer transition-all duration-200 ".concat(t.className),style:t.style,children:[(0,kt.jsx)("div",{className:"font-bold text-[10px] opacity-80",children:e.time}),(0,kt.jsx)("div",{className:"font-medium truncate",children:e.title})]},e.id)})})},t))})]}),"day"===h&&(0,kt.jsxs)("div",{className:"rounded-lg shadow-lg border overflow-hidden ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:[(0,kt.jsxs)("div",{className:"p-4 text-center ".concat(s?"bg-[#F8FAFC] border-b border-[#3b82f6]/40":"bg-[#F8FAFC] border-b border-gray-200"),children:[(0,kt.jsx)("div",{className:"text-lg font-bold ".concat(s?"text-white":"text-gray-900"),children:d.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),(0,kt.jsxs)("div",{className:"flex justify-center gap-2 mt-2",children:[(0,kt.jsx)("button",{onClick:()=>u(new Date(d.setDate(d.getDate()-1))),className:"px-3 py-1 rounded text-xs ".concat(s?"bg-[#374151] text-white hover:bg-[#4b5563]":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"\u2190 Previous Day"}),(0,kt.jsx)("button",{onClick:()=>u(new Date),className:"px-3 py-1 rounded text-xs bg-blue-600 text-white hover:bg-blue-700",children:"Today"}),(0,kt.jsx)("button",{onClick:()=>u(new Date(d.setDate(d.getDate()+1))),className:"px-3 py-1 rounded text-xs ".concat(s?"bg-[#374151] text-white hover:bg-[#4b5563]":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Next Day \u2192"})]})]}),(0,kt.jsx)("div",{className:"max-h-[600px] overflow-y-auto",children:(e=>{const t=[];for(let r=6;r<=21;r++){const n=r<12?"".concat(r,":00 AM"):12===r?"12:00 PM":"".concat(r-12,":00 PM"),a=Pe(e).filter(e=>{if(!e.time)return!1;const t=parseInt(e.time.split(":")[0]);return(e.time.toLowerCase().includes("pm")&&12!==t?t+12:t)===r});t.push({hour:r,timeStr:n,events:a})}return t})(d).map((e,t)=>(0,kt.jsxs)("div",{className:"flex border-b ".concat(s?"border-[#3b82f6]/20":"border-gray-200"),children:[(0,kt.jsx)("div",{className:"w-20 p-2 text-xs font-medium ".concat(s?"text-gray-400 bg-[#0f172a]":"text-gray-500 bg-gray-50"),children:e.timeStr}),(0,kt.jsx)("div",{className:"flex-1 min-h-[50px] p-1",children:e.events.map(e=>{const t=Te(e);return(0,kt.jsxs)("div",{onClick:()=>Re(e),className:"text-xs p-2 rounded cursor-pointer transition-all duration-200 ".concat(t.className," mb-1"),style:t.style,children:[(0,kt.jsx)("div",{className:"font-medium",children:e.title}),(0,kt.jsx)("div",{className:"opacity-80 text-[10px]",children:e.description||"No description"})]},e.id)})})]},t))})]}),S&&j&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999]",children:(0,kt.jsx)("div",{className:"rounded-xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto border ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(s?"text-white":"text-gray-800"),children:xe?"Edit Event":"Event Details"}),(0,kt.jsx)("button",{onClick:Fe,className:"p-2 rounded-lg transition-all duration-200 ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),xe&&ye?(0,kt.jsxs)("div",{className:"space-y-5",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Event Title *"}),(0,kt.jsx)("input",{type:"text",value:ye.title,onChange:e=>Ue("title",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event title"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Event Type"}),(0,kt.jsxs)("select",{value:ye.type,onChange:e=>Ue("type",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"meeting",children:"Meeting"}),(0,kt.jsx)("option",{value:"training",children:"Training"}),(0,kt.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,kt.jsx)("option",{value:"inspection",children:"Inspection"}),(0,kt.jsx)("option",{value:"deadline",children:"Deadline"}),(0,kt.jsx)("option",{value:"project-start",children:"Project Start"}),(0,kt.jsx)("option",{value:"project-end",children:"Project End"}),(0,kt.jsx)("option",{value:"delivery",children:"Delivery"}),(0,kt.jsx)("option",{value:"labor",children:"Labor"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Date"}),(0,kt.jsx)("input",{type:"date",value:ye.date,onChange:e=>Ue("date",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Start Time"}),(0,kt.jsx)("input",{type:"time",value:ye.time,onChange:e=>Ue("time",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"End Time"}),(0,kt.jsx)("input",{type:"time",value:ye.endTime,onChange:e=>Ue("endTime",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200")})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Description (Optional)"}),(0,kt.jsx)("textarea",{value:ye.description,onChange:e=>Ue("description",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event description..."})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:()=>be(!1),className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(ye&&ye.title.trim())try{var e;const t=new Date("".concat(ye.date,"T").concat(ye.time,":00")),r=new Date("".concat(ye.date,"T").concat(ye.endTime,":00"));if(r<=t)return void gr.error("End time must be after start time");const n={title:ye.title,description:ye.description,startTime:t.toISOString(),endTime:r.toISOString(),eventType:ye.type.toUpperCase(),projectId:ye.projectId||void 0},a=localStorage.getItem("authToken"),s=await fetch("/api/calendar-events/".concat(ye.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(n)});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Failed to update event")}const o=await s.json();console.log("\u2705 Calendar event updated:",o),window.dispatchEvent(new CustomEvent("calendar:eventUpdated",{detail:{event:null===(e=o.data)||void 0===e?void 0:e.event}})),Fe(),gr.success("Event updated successfully!",{duration:3e3,icon:"\u270f\ufe0f"}),await Ae()}catch(t){console.error("Error updating event:",t),gr.error("Failed to update event: ".concat(t.message))}else gr.error("Please enter an event title")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat("bg-[var(--color-brand-aqua-blue)] text-white hover:bg-[var(--color-brand-deep-teal)]"),children:"Save Changes"})]})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("div",{children:(0,kt.jsx)("div",{className:"inline-block px-3 py-1.5 rounded-lg text-sm font-medium text-white shadow-md ".concat(j.color),children:(null===(t=j.type)||void 0===t?void 0:t.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase()))||"Event"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-bold text-lg mb-2 ".concat(s?"text-white":"text-gray-800"),children:j.title}),(0,kt.jsxs)("p",{className:"text-sm ".concat(s?"text-gray-300":"text-gray-600"),children:[j.time," \u2022 ",d.toLocaleDateString()]}),j.endTime&&(0,kt.jsxs)("p",{className:"text-sm mt-1 ".concat(s?"text-gray-400":"text-gray-500"),children:["Ends: ",new Date(j.endTime).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})]})]}),j.description&&(0,kt.jsx)("div",{className:"p-3 rounded-lg ".concat(s?"bg-[#374151]":"bg-gray-50"),children:(0,kt.jsx)("p",{className:"text-sm ".concat(s?"text-gray-300":"text-gray-600"),children:j.description})}),j.project&&(0,kt.jsxs)("div",{className:"p-4 rounded-lg shadow-sm ".concat(s?"bg-[#374151] border border-[#3b82f6]/20":"bg-blue-50 border border-blue-200"),children:[(0,kt.jsx)("p",{className:"text-sm font-bold mb-1 ".concat(s?"text-gray-300":"text-gray-700"),children:"Related Project:"}),(0,kt.jsx)("p",{className:"text-sm ".concat(s?"text-white":"text-gray-800"),children:j.project.name})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:Fe,className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Close"}),j.id&&!j.id.startsWith("mock-")&&!j.id.startsWith("delivery-")&&!j.id.startsWith("labor-")&&(0,kt.jsx)("button",{onClick:()=>{if(!j)return;let e=(new Date).toISOString().split("T")[0],t="09:00",r="10:00";if(j.startTime){const r=new Date(j.startTime);e=r.toISOString().split("T")[0],t=r.toTimeString().slice(0,5)}if(j.endTime){r=new Date(j.endTime).toTimeString().slice(0,5)}we({id:j.id,title:j.title||"",type:j.type||"meeting",date:e,time:t,endTime:r,description:j.description||"",projectId:j.projectId||""}),be(!0)},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat("bg-amber-500 text-white hover:bg-amber-600"),children:"\u270f\ufe0f Edit Event"}),j.project&&(0,kt.jsx)("button",{onClick:()=>{Fe(),i&&i(j.project,"Project Workflow",null,"Company Calendar")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat("bg-[var(--color-brand-aqua-blue)] text-white hover:bg-[var(--color-brand-deep-teal)]"),children:"View Project"})]})]})]})})}),je&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999]",children:(0,kt.jsxs)("div",{className:"rounded-xl shadow-2xl max-w-lg w-full mx-4 max-h-[80vh] overflow-hidden border ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"p-5 ".concat(s?"bg-gradient-to-r from-[var(--color-brand-aqua-blue)]/20 to-[var(--color-brand-deep-teal)]/20 border-b border-[#3b82f6]/30":"bg-[#F8FAFC] border-b border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h3",{className:"text-lg font-bold ".concat(s?"text-white":"text-gray-800"),children:["\ud83d\udcc5 Events for ",je.date.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})]}),(0,kt.jsxs)("p",{className:"text-sm ".concat(s?"text-gray-400":"text-gray-500"),children:[je.events.length," event",1!==je.events.length?"s":""," scheduled"]})]}),(0,kt.jsx)("button",{onClick:()=>Ne(null),className:"p-2 rounded-lg transition-all duration-200 ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,kt.jsx)("div",{className:"p-4 space-y-3 max-h-[60vh] overflow-y-auto",children:je.events.map((e,t)=>{var r;const n=Te(e);return(0,kt.jsxs)("div",{onClick:()=>{Ne(null),Re(e)},className:"group flex items-start gap-4 p-4 rounded-xl cursor-pointer transition-all duration-300 ".concat(s?"bg-slate-700/30 hover:bg-slate-700/60 border border-slate-700/50 hover:border-[var(--color-brand-aqua-blue)]/50":"bg-white hover:bg-blue-50/50 border border-slate-200/80 hover:border-[var(--color-brand-aqua-blue)]/50 shadow-sm hover:shadow-md"),children:[(0,kt.jsx)("div",{className:"w-1.5 h-full min-h-[48px] rounded-full flex-shrink-0",style:n.style.backgroundColor?{backgroundColor:n.style.backgroundColor}:{backgroundColor:"#0089D1"}}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"text-sm font-semibold truncate group-hover:text-[var(--color-brand-aqua-blue)] transition-colors ".concat(s?"text-white":"text-slate-800"),children:e.title||"Untitled Event"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs ".concat(s?"text-slate-400":"text-slate-500"),children:[(0,kt.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.time||"All day",e.endTime&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{className:s?"text-slate-600":"text-slate-300",children:"\u2192"}),new Date(e.endTime).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})]})]}),e.description&&(0,kt.jsx)("div",{className:"text-xs mt-1.5 line-clamp-2 ".concat(s?"text-slate-500":"text-slate-400"),children:e.description})]}),(0,kt.jsx)("div",{className:"px-2.5 py-1 rounded-md text-xs font-medium ".concat(s?"bg-slate-600/50 text-slate-300":"bg-slate-100 text-slate-600"),children:(null===(r=e.type)||void 0===r?void 0:r.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase()))||"Event"}),(0,kt.jsx)("svg",{className:"w-5 h-5 opacity-0 group-hover:opacity-100 transition-opacity ".concat("text-[var(--color-brand-aqua-blue)]"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]},e.id||t)})}),(0,kt.jsx)("div",{className:"p-4 ".concat(s?"bg-slate-800/50 border-t border-slate-700/50":"bg-gray-50 border-t border-gray-200"),children:(0,kt.jsx)("button",{onClick:()=>Ne(null),className:"w-full px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Close"})})]})}),A&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999]",children:(0,kt.jsx)("div",{className:"rounded-xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto border ".concat(s?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(s?"text-white":"text-gray-800"),children:"Add New Event"}),(0,kt.jsx)("button",{onClick:Be,className:"p-2 rounded-lg transition-all duration-200 ".concat(s?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"space-y-5",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Event Title *"}),(0,kt.jsx)("input",{type:"text",value:F.title,onChange:e=>ze("title",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event title"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Assign to User(s) *"}),(0,kt.jsxs)("div",{className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm min-h-[46px] ".concat(s?"bg-[#374151] border-gray-600":"bg-white border-gray-300"),children:[(0,kt.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:(x||[]).map(e=>{const t=(g||[]).find(t=>t.id===e);return(0,kt.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-[var(--color-brand-aqua-blue-light-tint)] text-[var(--color-brand-deep-teal)]",children:[t?"".concat(t.firstName," ").concat(t.lastName):"Unknown User",(0,kt.jsx)("button",{onClick:()=>b(t=>t.filter(t=>t!==e)),className:"ml-1 text-[var(--color-brand-aqua-blue)] hover:text-[var(--color-brand-deep-teal)]",children:"\xd7"})]},e)})}),(0,kt.jsxs)("select",{onChange:e=>{const t=e.target.value;t&&!x.includes(t)&&b(e=>[...e,t]),e.target.value=""},className:"w-full bg-transparent focus:outline-none ".concat(s?"text-white":"text-gray-900"),children:[(0,kt.jsx)("option",{value:"",children:"Select a user..."}),(g||[]).filter(e=>!(x||[]).includes(e.id)).map(e=>(0,kt.jsxs)("option",{value:e.id,children:[null===e||void 0===e?void 0:e.firstName," ",null===e||void 0===e?void 0:e.lastName]},e.id))]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Event Type"}),(0,kt.jsxs)("select",{value:F.type,onChange:e=>ze("type",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"meeting",children:"Meeting"}),(0,kt.jsx)("option",{value:"training",children:"Training"}),(0,kt.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,kt.jsx)("option",{value:"inspection",children:"Inspection"}),(0,kt.jsx)("option",{value:"deadline",children:"Deadline"}),(0,kt.jsx)("option",{value:"project-start",children:"Project Start"}),(0,kt.jsx)("option",{value:"project-end",children:"Project End"}),(0,kt.jsx)("option",{value:"delivery",children:"Delivery"}),(0,kt.jsx)("option",{value:"labor",children:"Labor"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Date"}),(0,kt.jsx)("input",{type:"date",value:F.date,onChange:e=>ze("date",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Start Time"}),(0,kt.jsx)("input",{type:"time",value:F.time,onChange:e=>ze("time",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"End Time"}),(0,kt.jsx)("input",{type:"time",value:F.endTime,onChange:e=>ze("endTime",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200")})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Priority"}),(0,kt.jsxs)("select",{value:F.priority,onChange:e=>ze("priority",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"low",children:"Low"}),(0,kt.jsx)("option",{value:"medium",children:"Medium"}),(0,kt.jsx)("option",{value:"high",children:"High"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Related Project (Optional)"}),(0,kt.jsxs)("select",{value:F.projectId,onChange:e=>ze("projectId",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"",children:"No project"}),(r||[]).map(e=>(0,kt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Description (Optional)"}),(0,kt.jsx)("textarea",{value:F.description,onChange:e=>ze("description",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(s?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-[var(--color-brand-aqua-blue)] focus:ring-2 focus:ring-[var(--color-brand-aqua-blue)]/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event description..."})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:Be,className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(s?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(F.title.trim())if(0!==x.length)try{var e;const t=F.time,[r,n]=t.split(":"),a=(new Date(2e3,0,1,r,n).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),new Date("".concat(F.date,"T").concat(F.time,":00"))),s=new Date("".concat(F.date,"T").concat(F.endTime,":00")),o={title:F.title,description:F.description,startTime:a.toISOString(),endTime:s.toISOString(),eventType:F.type.toUpperCase(),organizerId:null===O||void 0===O?void 0:O.id,projectId:F.projectId||void 0,attendees:x.map(e=>({userId:e}))},i=localStorage.getItem("authToken"),l=await fetch("/api/calendar-events",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify(o)});if(!l.ok){const e=await l.json().catch(()=>({}));throw new Error(e.message||"Failed to create event")}const c=await l.json();console.log("\u2705 Calendar event created:",c),window.dispatchEvent(new CustomEvent("calendar:eventAdded",{detail:{event:null===(e=c.data)||void 0===e?void 0:e.event}})),Be(),gr.success("Event created successfully!",{duration:3e3,icon:"\ud83d\udcc5"}),await Ae()}catch(t){console.error("Error creating event:",t),gr.error("Failed to create event: ".concat(t.message))}else alert("Please assign at least one user");else alert("Please enter an event title")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat("bg-[var(--color-brand-aqua-blue)] text-white hover:bg-[var(--color-brand-deep-teal)]"),children:"Create Event"})]})]})})})]});var qe},lb=e=>(0,kt.jsx)(ob,{children:(0,kt.jsx)(ib,(0,Y.A)({},e))}),cb=e=>{let{className:t="w-5 h-5"}=e;return(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})},db=e=>{let{projects:t,tasks:r,activities:n,colorMode:a,onProjectSelect:s}=e;const[i,l]=(0,o.useState)(new Date),[c,d]=(0,o.useState)(new Date),[u,h]=(0,o.useState)("month"),[m,p]=(0,o.useState)("all"),[f,g]=(0,o.useState)(null),[v,x]=(0,o.useState)(!1),[b,y]=(0,o.useState)(!1),[w,j]=(0,o.useState)([]),[N,S]=(0,o.useState)(!1),[k,A]=(0,o.useState)(null),[C,E]=(0,o.useState)({title:"",type:"meeting",date:(new Date).toISOString().split("T")[0],time:"09:00",description:"",projectId:"",priority:"medium"});(0,o.useEffect)(()=>{(async()=>{try{const e=await Da.authService.getCurrentUser();A(e)}catch(e){console.error("Failed to fetch current user:",e)}})()},[]);const P=async()=>{try{S(!0);const e=await fetch("/api/calendar-events");if(e.ok){const t=await e.json(),r=Array.isArray(t)?t:t.data||t.events||[];j(r)}}catch(e){console.error("Error fetching calendar events:",e),j([])}finally{S(!1)}};(0,o.useEffect)(()=>{P()},[]);const _=e=>{const n=[],a=e.toDateString(),s=e.toISOString().split("T")[0];Array.isArray(w)&&w.forEach(e=>{e.date===s&&n.push({id:e._id||"db-event-".concat(e.title),title:e.title,type:e.type,time:e.time,priority:e.priority,color:e.color||I(e.type),description:e.description,projectId:e.projectId})}),t.forEach(e=>{e.startDate&&new Date(e.startDate).toDateString()===a&&n.push({id:"project-start-".concat(e.id),title:"\ud83d\ude80 ".concat(e.projectName||e.name," - Start"),type:"project-start",project:e,time:"9:00 AM",priority:"high",color:"bg-green-500"}),e.endDate&&new Date(e.endDate).toDateString()===a&&n.push({id:"project-end-".concat(e.id),title:"\ud83c\udfc1 ".concat(e.projectName||e.name," - Completion"),type:"project-end",project:e,time:"5:00 PM",priority:"high",color:"bg-emerald-500"}),e.materialsDeliveryStart&&new Date(e.materialsDeliveryStart).toDateString()===a&&n.push({id:"delivery-".concat(e.id),title:"\ud83d\udce6 ".concat(e.projectName||e.name," - Materials"),type:"delivery",project:e,time:"8:00 AM",priority:"medium",color:"bg-amber-500"}),e.laborStart&&new Date(e.laborStart).toDateString()===a&&n.push({id:"labor-".concat(e.id),title:"\ud83d\udc77 ".concat(e.projectName||e.name," - Labor"),type:"labor",project:e,time:"7:00 AM",priority:"medium",color:"bg-indigo-500"})}),r.forEach(e=>{e.alertDate&&new Date(e.alertDate).toDateString()===a&&n.push({id:"task-".concat(e.id),title:"\u26a0\ufe0f ".concat(e.title),type:"task",task:e,time:"12:00 PM",priority:e.priority,color:"high"===e.priority?"bg-red-500":"bg-purple-500"})});return[{date:"2024-01-02",title:"\ud83c\udfe2 New Year Office Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-01-03",title:"\ud83d\udd27 Equipment Calibration",type:"maintenance",time:"8:00 AM"},{date:"2024-01-05",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-08",title:"\ud83d\udc65 Client Consultation - Johnson Roof",type:"meeting",time:"10:00 AM"},{date:"2024-01-09",title:"\ud83d\udcca Monthly Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-01-10",title:"\ud83d\udee0\ufe0f Tool Maintenance Day",type:"maintenance",time:"8:00 AM"},{date:"2024-01-12",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-15",title:"\ud83d\udcc5 Safety Training - Fall Protection",type:"training",time:"10:00 AM"},{date:"2024-01-17",title:"\ud83d\udcdd Permit Application Deadline",type:"deadline",time:"5:00 PM"},{date:"2024-01-19",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-23",title:"\ud83d\udd27 Vehicle Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-01-24",title:"\ud83d\udcca Project Progress Review",type:"meeting",time:"1:00 PM"},{date:"2024-01-26",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-01-29",title:"\ud83d\udc65 Insurance Agent Meeting",type:"meeting",time:"3:00 PM"},{date:"2024-01-30",title:"\ud83d\udcc5 OSHA Compliance Training",type:"training",time:"9:00 AM"},{date:"2024-01-31",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-02-02",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-05",title:"\ud83d\udc65 Client Meeting - Smith Residence",type:"meeting",time:"10:00 AM"},{date:"2024-02-06",title:"\ud83d\udd27 Equipment Inventory Check",type:"maintenance",time:"8:00 AM"},{date:"2024-02-07",title:"\ud83d\udcca Quarterly Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-02-09",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-12",title:"\ud83d\udc65 Subcontractor Coordination",type:"meeting",time:"11:00 AM"},{date:"2024-02-13",title:"\ud83d\udee0\ufe0f Safety Equipment Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-02-14",title:"\ud83d\udcc5 First Aid Training",type:"training",time:"10:00 AM"},{date:"2024-02-16",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-19",title:"\ud83d\udc65 Site Walkthrough - New Project",type:"inspection",time:"9:00 AM"},{date:"2024-02-20",title:"\ud83d\udcdd Insurance Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-02-21",title:"\ud83d\udd27 Generator Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-02-23",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-02-26",title:"\ud83d\udc65 Team Building Event",type:"meeting",time:"12:00 PM"},{date:"2024-02-27",title:"\ud83d\udcca Budget Review Meeting",type:"meeting",time:"1:00 PM"},{date:"2024-02-28",title:"\ud83d\udcc5 CPR Certification Renewal",type:"training",time:"9:00 AM"},{date:"2024-02-29",title:"\ud83d\udcdd Monthly Safety Reports",type:"deadline",time:"5:00 PM"},{date:"2024-03-01",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-04",title:"\ud83d\udc65 Client Presentation - Large Project",type:"meeting",time:"10:00 AM"},{date:"2024-03-05",title:"\ud83d\udd27 Compressor Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-03-06",title:"\ud83d\udcca Annual Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-03-08",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-11",title:"\ud83d\udc65 Architect Meeting - Design Review",type:"meeting",time:"11:00 AM"},{date:"2024-03-12",title:"\ud83d\udee0\ufe0f Scaffolding Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-03-13",title:"\ud83d\udcc5 Hazard Communication Training",type:"training",time:"10:00 AM"},{date:"2024-03-15",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-18",title:"\ud83d\udc65 Quality Control Review",type:"meeting",time:"1:00 PM"},{date:"2024-03-19",title:"\ud83d\udcdd Contract Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-03-20",title:"\ud83d\udd27 Welding Equipment Check",type:"maintenance",time:"8:00 AM"},{date:"2024-03-22",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-25",title:"\ud83d\udc65 Site Safety Audit",type:"inspection",time:"9:00 AM"},{date:"2024-03-26",title:"\ud83d\udcca Performance Review Meeting",type:"meeting",time:"2:00 PM"},{date:"2024-03-27",title:"\ud83d\udcc5 Confined Space Training",type:"training",time:"10:00 AM"},{date:"2024-03-29",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-03-31",title:"\ud83d\udcdd Quarterly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-04-01",title:"\ud83c\udfe2 Spring Safety Kickoff",type:"meeting",time:"8:00 AM"},{date:"2024-04-02",title:"\ud83d\udd27 Spring Equipment Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-04-03",title:"\ud83d\udc65 New Project Kickoff Meeting",type:"meeting",time:"10:00 AM"},{date:"2024-04-05",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-09",title:"\ud83d\udee0\ufe0f Electrical Safety Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-04-10",title:"\ud83d\udcc5 Ladder Safety Training",type:"training",time:"10:00 AM"},{date:"2024-04-12",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-15",title:"\ud83d\udc65 Subcontractor Safety Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-04-16",title:"\ud83d\udcdd Tax Filing Deadline",type:"deadline",time:"5:00 PM"},{date:"2024-04-17",title:"\ud83d\udd27 Crane Inspection",type:"maintenance",time:"8:00 AM"},{date:"2024-04-19",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-22",title:"\ud83d\udc65 Project Completion Review",type:"meeting",time:"1:00 PM"},{date:"2024-04-23",title:"\ud83d\udcca Monthly Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-04-24",title:"\ud83d\udcc5 Personal Protective Equipment Training",type:"training",time:"10:00 AM"},{date:"2024-04-26",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-04-29",title:"\ud83d\udc65 Insurance Claim Meeting",type:"meeting",time:"3:00 PM"},{date:"2024-04-30",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-05-01",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-03",title:"\ud83d\udc65 Client Meeting - Summer Projects",type:"meeting",time:"10:00 AM"},{date:"2024-05-06",title:"\ud83d\udd27 HVAC System Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-05-07",title:"\ud83d\udcca Q2 Planning Session",type:"meeting",time:"2:00 PM"},{date:"2024-05-10",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-13",title:"\ud83d\udc65 Site Safety Walkthrough",type:"inspection",time:"9:00 AM"},{date:"2024-05-14",title:"\ud83d\udcc5 Heat Stress Training",type:"training",time:"10:00 AM"},{date:"2024-05-17",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-20",title:"\ud83d\udc65 Equipment Rental Meeting",type:"meeting",time:"11:00 AM"},{date:"2024-05-21",title:"\ud83d\udcdd Permit Renewal Deadline",type:"deadline",time:"4:00 PM"},{date:"2024-05-22",title:"\ud83d\udd27 Excavator Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-05-24",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-05-27",title:"\ud83d\udc65 Memorial Day Safety Briefing",type:"meeting",time:"8:00 AM"},{date:"2024-05-28",title:"\ud83d\udcca Monthly Progress Review",type:"meeting",time:"1:00 PM"},{date:"2024-05-29",title:"\ud83d\udcc5 Emergency Response Training",type:"training",time:"10:00 AM"},{date:"2024-05-31",title:"\ud83d\udcdd Monthly Reports Due",type:"deadline",time:"5:00 PM"},{date:"2024-06-03",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-05",title:"\ud83d\udc65 Summer Project Kickoff",type:"meeting",time:"10:00 AM"},{date:"2024-06-06",title:"\ud83d\udd27 Summer Equipment Prep",type:"maintenance",time:"8:00 AM"},{date:"2024-06-07",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-10",title:"\ud83d\udc65 Client Site Visit - Summer Homes",type:"meeting",time:"11:00 AM"},{date:"2024-06-11",title:"\ud83d\udee0\ufe0f Summer Safety Inspection",type:"inspection",time:"8:00 AM"},{date:"2024-06-12",title:"\ud83d\udcc5 Heat Illness Prevention Training",type:"training",time:"10:00 AM"},{date:"2024-06-14",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-17",title:"\ud83d\udc65 Subcontractor Summer Meeting",type:"meeting",time:"9:00 AM"},{date:"2024-06-18",title:"\ud83d\udcdd Insurance Mid-Year Review",type:"deadline",time:"4:00 PM"},{date:"2024-06-19",title:"\ud83d\udd27 Cooling System Maintenance",type:"maintenance",time:"8:00 AM"},{date:"2024-06-21",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-24",title:"\ud83d\udc65 Summer Project Review",type:"meeting",time:"1:00 PM"},{date:"2024-06-25",title:"\ud83d\udcca Q2 Financial Review",type:"meeting",time:"2:00 PM"},{date:"2024-06-26",title:"\ud83d\udcc5 Summer Safety Training",type:"training",time:"10:00 AM"},{date:"2024-06-28",title:"\ud83d\udccb Weekly Safety Briefing",type:"meeting",time:"7:30 AM"},{date:"2024-06-30",title:"\ud83d\udcdd Quarterly Reports Due",type:"deadline",time:"5:00 PM"}].forEach(e=>{e.date===s&&n.push({id:"mock-".concat(e.date,"-").concat(e.type),title:e.title,type:e.type,time:e.time,priority:"medium",color:I(e.type)})}),n},I=e=>{switch(e){case"meeting":return"bg-blue-500";case"training":return"bg-purple-500";case"maintenance":return"bg-orange-500";case"inspection":return"bg-yellow-500";case"deadline":case"task":return"bg-red-500";case"project-start":return"bg-green-500";case"project-end":return"bg-emerald-500";case"delivery":return"bg-amber-500";case"labor":return"bg-indigo-500";default:return"bg-gray-500"}},T=e=>"all"===m?e:e.filter(e=>e.type===m),L=e=>{l(t=>{const r=new Date(t);return r.setMonth(t.getMonth()+e),r})},D=e=>e.toDateString()===(new Date).toDateString(),M=e=>e.toDateString()===c.toDateString(),O=()=>{x(!1),g(null)},R=()=>{y(!1),E({title:"",type:"meeting",date:(new Date).toISOString().split("T")[0],time:"09:00",description:"",projectId:"",priority:"medium"})},F=(e,t)=>{E(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))},U=(e=>{const t=e.getFullYear(),r=e.getMonth(),n=new Date(t,r,1),a=new Date(t,r+1,0).getDate(),s=[];for(let i=n.getDay()-1;i>=0;i--){const e=new Date(t,r,-i);s.push({date:e,isCurrentMonth:!1,events:_(e)})}for(let i=1;i<=a;i++){const e=new Date(t,r,i);s.push({date:e,isCurrentMonth:!0,events:_(e)})}const o=42-s.length;for(let i=1;i<=o;i++){const e=new Date(t,r+1,i);s.push({date:e,isCurrentMonth:!1,events:_(e)})}return s})(i);return(0,kt.jsxs)("div",{className:"animate-fade-in w-full max-w-full",children:[(0,kt.jsx)("div",{className:"mb-4 p-4 rounded-xl shadow-lg ".concat(a?"bg-[#F8FAFC] border border-[#3b82f6]/20":"bg-[#F8FAFC] border border-blue-200"),children:(0,kt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-3",children:[(0,kt.jsx)("div",{className:"flex-1",children:(0,kt.jsx)("p",{className:"text-sm ".concat(a?"text-gray-300":"text-gray-600"),children:"View and manage project alerts in calendar format"})}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"flex rounded-md p-0.5 shadow-md ".concat(a?"bg-[#1e293b] border border-[#3b82f6]/30":"bg-white border border-gray-200"),children:["month","week","day"].map(e=>(0,kt.jsx)("button",{onClick:()=>h(e),className:"px-2 py-0.5 text-xs font-medium rounded transition-all duration-200 ".concat("".concat(u===e?a?"bg-[#3b82f6] text-white shadow-md":"bg-[var(--color-primary-blueprint-blue)] text-white shadow-md":a?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100")),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,kt.jsxs)("button",{onClick:()=>{y(!0)},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all duration-200 shadow-lg ".concat(a?"bg-[#F8FAFC] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-[#F8FAFC] text-white hover:from-blue-700 hover:to-indigo-700"),children:[(0,kt.jsx)(rn,{className:"w-3 h-3"}),"Add Event"]})]})]})}),(0,kt.jsx)("div",{className:"mb-3 p-3 rounded-xl shadow-md ".concat(a?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:(0,kt.jsx)("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All Events",icon:"\ud83d\udcc5"},{key:"meeting",label:"Meetings",icon:"\ud83d\udc65"},{key:"training",label:"Training",icon:"\ud83d\udcda"},{key:"maintenance",label:"Maintenance",icon:"\ud83d\udd27"},{key:"inspection",label:"Inspections",icon:"\ud83d\udd0d"},{key:"deadline",label:"Deadlines",icon:"\u23f0"},{key:"project-start",label:"Project Start",icon:"\ud83d\ude80"},{key:"project-end",label:"Project End",icon:"\ud83c\udfc1"},{key:"delivery",label:"Deliveries",icon:"\ud83d\udce6"},{key:"labor",label:"Labor",icon:"\ud83d\udc77"},{key:"task",label:"Tasks",icon:"\ud83d\udccb"}].map(e=>(0,kt.jsxs)("button",{onClick:()=>p(e.key),className:"flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium transition-all duration-200 shadow-sm ".concat(m===e.key?"".concat(a?"bg-[#3b82f6] text-white shadow-md":"bg-[var(--color-primary-blueprint-blue)] text-white shadow-md"):"".concat(a?"bg-[#374151] text-gray-300 hover:text-white hover:bg-[#4b5563]":"bg-gray-100 text-gray-600 hover:text-gray-800 hover:bg-gray-200")),children:[(0,kt.jsx)("span",{className:"text-xs",children:e.icon}),e.label]},e.key))})}),(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3 p-3 rounded-xl shadow-md ".concat(a?"bg-[#1e293b] border border-[#3b82f6]/20":"bg-white border border-gray-200"),children:[(0,kt.jsx)("button",{onClick:()=>L(-1),className:"p-1.5 rounded-md transition-all duration-200 shadow-sm ".concat(a?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"),children:(0,kt.jsx)(nn,{className:"w-4 h-4"})}),(0,kt.jsx)("h2",{className:"text-base font-bold ".concat(a?"text-white":"text-gray-800"),children:(B=i,B.toLocaleDateString("en-US",{month:"long",year:"numeric"}))}),(0,kt.jsx)("button",{onClick:()=>L(1),className:"p-1.5 rounded-md transition-all duration-200 shadow-sm ".concat(a?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-600 hover:text-gray-800 hover:bg-gray-100"),children:(0,kt.jsx)(cb,{className:"w-4 h-4"})})]}),(0,kt.jsxs)("div",{className:"rounded-lg shadow-lg border overflow-hidden ".concat(a?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:[(0,kt.jsx)("div",{className:"grid grid-cols-7 ".concat(a?"bg-[#F8FAFC] border-b border-[#3b82f6]/40":"bg-[#F8FAFC] border-b border-gray-200"),children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,kt.jsx)("div",{className:"p-2 text-center text-xs font-bold ".concat(a?"text-gray-300":"text-gray-700"),children:e},e))}),(0,kt.jsx)("div",{className:"grid grid-cols-7",children:U.map((e,t)=>(0,kt.jsxs)("div",{onClick:()=>(e=>{d(e)})(e.date),className:"min-h-[60px] p-1 border-r border-b cursor-pointer transition-all duration-200 ".concat(a?"border-[#3b82f6]/20 hover:bg-[#374151]/50":"border-gray-200 hover:bg-blue-50/50"," ").concat(e.isCurrentMonth?"":a?"bg-[#1e293b]/30":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"text-xs font-bold mb-1 ".concat(D(e.date)?"bg-[#F8FAFC] text-white rounded-full w-5 h-5 flex items-center justify-center shadow-md":M(e.date)?"".concat(a?"text-blue-400":"text-blue-600"," font-bold"):e.isCurrentMonth?a?"text-white":"text-gray-900":a?"text-gray-500":"text-gray-400"),children:e.date.getDate()}),(0,kt.jsxs)("div",{className:"space-y-0.5",children:[T(e.events).slice(0,1).map(e=>(0,kt.jsxs)("div",{onClick:t=>{t.stopPropagation(),(e=>{g(e),x(!0),e.project&&s&&s(e.project,"Project Workflow",null,"Alerts Calendar")})(e)},className:"text-xs p-0.5 rounded cursor-pointer transition-all duration-200 ".concat(e.color," text-white hover:opacity-90 shadow-sm"),title:"".concat(e.time," - ").concat(e.title),children:[(0,kt.jsx)("div",{className:"truncate font-medium text-xs",children:e.title}),(0,kt.jsx)("div",{className:"text-xs opacity-90",children:e.time})]},e.id)),T(e.events).length>1&&(0,kt.jsxs)("div",{className:"text-xs px-1 py-0.5 rounded shadow-sm ".concat(a?"bg-gray-600 text-gray-200":"bg-gray-200 text-gray-600"),children:["+",T(e.events).length-1," more"]})]})]},t))})]}),v&&f&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999]",children:(0,kt.jsx)("div",{className:"rounded-xl shadow-2xl max-w-md w-full mx-4 border ".concat(a?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(a?"text-white":"text-gray-800"),children:"Event Details"}),(0,kt.jsx)("button",{onClick:O,className:"p-2 rounded-lg transition-all duration-200 ".concat(a?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsx)("div",{children:(0,kt.jsx)("div",{className:"inline-block px-3 py-1.5 rounded-lg text-sm font-medium text-white shadow-md ".concat(f.color),children:f.type.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase())})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-bold text-lg mb-2 ".concat(a?"text-white":"text-gray-800"),children:f.title}),(0,kt.jsxs)("p",{className:"text-sm ".concat(a?"text-gray-300":"text-gray-600"),children:[f.time," \u2022 ",c.toLocaleDateString()]})]}),f.project&&(0,kt.jsxs)("div",{className:"p-4 rounded-lg shadow-sm ".concat(a?"bg-[#374151] border border-[#3b82f6]/20":"bg-blue-50 border border-blue-200"),children:[(0,kt.jsx)("p",{className:"text-sm font-bold mb-1 ".concat(a?"text-gray-300":"text-gray-700"),children:"Related Project:"}),(0,kt.jsx)("p",{className:"text-sm ".concat(a?"text-white":"text-gray-800"),children:f.project.name})]}),f.task&&(0,kt.jsxs)("div",{className:"p-4 rounded-lg shadow-sm ".concat(a?"bg-[#374151] border border-[#3b82f6]/20":"bg-purple-50 border border-purple-200"),children:[(0,kt.jsx)("p",{className:"text-sm font-bold mb-1 ".concat(a?"text-gray-300":"text-gray-700"),children:"Related Task:"}),(0,kt.jsx)("p",{className:"text-sm ".concat(a?"text-white":"text-gray-800"),children:f.task.title})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:O,className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(a?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Close"}),f.project&&(0,kt.jsx)("button",{onClick:()=>{O(),s&&s(f.project,"Project Workflow",null,"Alerts Calendar")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(a?"bg-[#F8FAFC] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-[#F8FAFC] text-white hover:from-blue-700 hover:to-indigo-700"),children:"View Project"})]})]})})}),b&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999]",children:(0,kt.jsx)("div",{className:"rounded-xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto border ".concat(a?"bg-[#1e293b] border-[#3b82f6]/30":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(a?"text-white":"text-gray-800"),children:"Add New Event"}),(0,kt.jsx)("button",{onClick:R,className:"p-2 rounded-lg transition-all duration-200 ".concat(a?"text-gray-300 hover:text-white hover:bg-[#374151]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"space-y-5",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(a?"text-gray-300":"text-gray-700"),children:"Event Title *"}),(0,kt.jsx)("input",{type:"text",value:C.title,onChange:e=>F("title",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(a?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event title"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(a?"text-gray-300":"text-gray-700"),children:"Event Type"}),(0,kt.jsxs)("select",{value:C.type,onChange:e=>F("type",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(a?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"meeting",children:"Meeting"}),(0,kt.jsx)("option",{value:"training",children:"Training"}),(0,kt.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,kt.jsx)("option",{value:"inspection",children:"Inspection"}),(0,kt.jsx)("option",{value:"deadline",children:"Deadline"}),(0,kt.jsx)("option",{value:"project-start",children:"Project Start"}),(0,kt.jsx)("option",{value:"project-end",children:"Project End"}),(0,kt.jsx)("option",{value:"delivery",children:"Delivery"}),(0,kt.jsx)("option",{value:"labor",children:"Labor"}),(0,kt.jsx)("option",{value:"task",children:"Task"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(a?"text-gray-300":"text-gray-700"),children:"Date"}),(0,kt.jsx)("input",{type:"date",value:C.date,onChange:e=>F("date",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(a?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(a?"text-gray-300":"text-gray-700"),children:"Time"}),(0,kt.jsx)("input",{type:"time",value:C.time,onChange:e=>F("time",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(a?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200")})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(a?"text-gray-300":"text-gray-700"),children:"Priority"}),(0,kt.jsxs)("select",{value:C.priority,onChange:e=>F("priority",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(a?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"low",children:"Low"}),(0,kt.jsx)("option",{value:"medium",children:"Medium"}),(0,kt.jsx)("option",{value:"high",children:"High"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(a?"text-gray-300":"text-gray-700"),children:"Related Project (Optional)"}),(0,kt.jsxs)("select",{value:C.projectId,onChange:e=>F("projectId",e.target.value),className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(a?"bg-[#374151] border-gray-600 text-white focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),children:[(0,kt.jsx)("option",{value:"",children:"No project"}),(t||[]).map(e=>(0,kt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-bold mb-2 ".concat(a?"text-gray-300":"text-gray-700"),children:"Description (Optional)"}),(0,kt.jsx)("textarea",{value:C.description,onChange:e=>F("description",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border text-sm shadow-sm ".concat(a?"bg-[#374151] border-gray-600 text-white placeholder-gray-400 focus:border-[#3b82f6] focus:ring-2 focus:ring-[#3b82f6]/20":"bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"," focus:outline-none transition-all duration-200"),placeholder:"Enter event description..."})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,kt.jsx)("button",{onClick:R,className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(a?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:async()=>{if(C.title.trim())try{const e=C.time,[t,r]=e.split(":"),n=(new Date(2e3,0,1,t,r).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),new Date("".concat(C.date,"T").concat(C.time,":00"))),a=new Date(n.getTime()+36e5),s={title:C.title,description:C.description,startTime:n.toISOString(),endTime:a.toISOString(),eventType:C.type.toUpperCase(),organizerId:null===k||void 0===k?void 0:k.id,projectId:C.projectId||void 0},o=await fetch("/api/calendar-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw new Error("Failed to create event");await o.json();alert('Event "'.concat(C.title,'" created successfully!')),R(),await P()}catch(e){console.error("Error creating event:",e),alert("Failed to create event. Please try again.")}else alert("Please enter an event title")},className:"flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 shadow-md ".concat(a?"bg-[#F8FAFC] text-white hover:from-[#2563eb] hover:to-[#1d4ed8]":"bg-[#F8FAFC] text-white hover:from-blue-700 hover:to-indigo-700"),children:"Create Event"})]})]})})})]});var B};function ub(e,t){const r=new Date(e),n=new Date(t);return"".concat(r.toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ").concat(n.toLocaleDateString("en-US",{month:"short",day:"numeric"}))}function hb(e){return{Roofing:"bg-blue-500",Siding:"bg-green-500",Decking:"bg-yellow-500",Renovation:"bg-purple-500",Remodeling:"bg-pink-500",Electrical:"bg-orange-500",Plumbing:"bg-teal-500"}[e]||"bg-gray-500"}function mb(e){switch(e){case"lead":return(0,kt.jsx)(Kr,{className:"w-4 h-4 text-purple-500"});case"prospect":return(0,kt.jsx)(Kr,{className:"w-4 h-4 text-orange-500"});case"approved":return(0,kt.jsx)(on,{className:"w-4 h-4 text-green-500"});case"execution":return(0,kt.jsx)(on,{className:"w-4 h-4 text-blue-500"});case"supplement":return(0,kt.jsx)(Kr,{className:"w-4 h-4 text-yellow-500"});case"completion":return(0,kt.jsx)(on,{className:"w-4 h-4 text-teal-500"});default:return(0,kt.jsx)(Kr,{className:"w-4 h-4 text-gray-400"})}}function pb(e){const t=new Date,r=new Date(e.materialsDeliveryStart),n=new Date(e.materialsDeliveryEnd);return t<r?{status:"pending",icon:"\u23f3",text:"Pending"}:t>=r&&t<=n?{status:"transit",icon:"\ud83d\ude9a",text:"In Transit"}:{status:"delivered",icon:"\u2714\ufe0f",text:"Delivered"}}function fb(e){const t=new Date,r=new Date(e.laborStart||e.startDate),n=new Date(e.laborEnd||e.endDate);return t<r?{status:"scheduled",icon:"\ud83d\udcc5",text:"Scheduled"}:t>=r&&t<=n?{status:"active",icon:"\ud83d\udee0\ufe0f",text:"In Progress"}:{status:"completed",icon:"\u2705",text:"Completed"}}function gb(){var e,t,n;const[a,s]=(0,o.useState)(null),[i,l]=(0,o.useState)(new Date),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)(""),[f,g]=(0,o.useState)(null),[v,x]=(0,o.useState)("weekly"),[b,y]=(0,o.useState)(!0),[w,j]=(0,o.useState)(""),[N,S]=(0,o.useState)(""),[k,A]=(0,o.useState)(""),[C,E]=(0,o.useState)(""),[P,_]=(0,o.useState)(!1),[I,T]=(0,o.useState)("materials"),[L,D]=(0,o.useState)(null),[M,O]=(0,o.useState)(null),[R,F]=(0,o.useState)(null),[U,B]=(0,o.useState)([]);(0,o.useEffect)(()=>{(async()=>{try{console.log("\ud83d\udd0d PROJECT SCHEDULES: Fetching workflow phases for status filter...");const e=(await Promise.resolve().then(r.bind(r,4505))).default,t=(await e.get("/workflow-data/phases")).data;if(null===t||void 0===t||!t.success||!t.data)throw new Error("Invalid response format");{const e=t.data.map(e=>({id:e.id,name:e.name,displayName:e.displayName||e.name}));B(e),console.log("\u2705 PROJECT SCHEDULES: Loaded workflow phases from database:",e)}}catch(e){console.error("\u274c PROJECT SCHEDULES: Failed to fetch workflow phases:",e);B([{id:"LEAD",name:"LEAD",displayName:"Lead Phase"},{id:"PROSPECT",name:"PROSPECT",displayName:"Prospect"},{id:"APPROVED",name:"APPROVED",displayName:"Approved Phase"},{id:"EXECUTION",name:"EXECUTION",displayName:"Execution Phase"},{id:"COMPLETION",name:"COMPLETION",displayName:"Completion Phase"}]),console.log("\u26a0\ufe0f PROJECT SCHEDULES: Using fallback workflow phases due to API error")}})()},[]);const[z,W]=(0,o.useState)(()=>{const e=localStorage.getItem("projectSchedules");if(e)try{const t=JSON.parse(e);return[].map(e=>{const r=t.find(t=>t.id===e.id);return r?(0,Y.A)((0,Y.A)({},e),{},{laborStart:r.laborStart,laborEnd:r.laborEnd,materialsDeliveryStart:r.materialsDeliveryStart,materialsDeliveryEnd:r.materialsDeliveryEnd}):e})}catch(t){return console.error("Error loading saved schedules:",t),[]}return[]}),q=async()=>{try{y(!0);const e="localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname?"".concat(window.location.protocol,"//").concat(window.location.host):{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL||"http://localhost:8000",t=await fetch("".concat(e,"/api/schedules"));if(t.ok){const e=await t.json();console.log("Loaded schedules from backend:",e);const r=(z||[]).map(t=>{const r=e.find(e=>e.projectId===t.id);return r?(0,Y.A)((0,Y.A)({},t),{},{laborStart:r.laborStart,laborEnd:r.laborEnd,materialsDeliveryStart:r.materialsDeliveryStart,materialsDeliveryEnd:r.materialsDeliveryEnd}):t});W(r),V(r)}}catch(e){console.error("Error loading schedules from backend:",e)}finally{y(!1)}};(0,o.useEffect)(()=>{q()},[]),(0,o.useEffect)(()=>{const e=e=>{if(L){const t=e.target.closest("td");if(t){const e=parseInt(t.getAttribute("data-project-id")),r=parseInt(t.getAttribute("data-day-idx"));e&&void 0!==r&&e===L.projectId&&O({projectId:e,dayIdx:r})}}};return L&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",()=>{D(null),O(null)})),()=>{document.removeEventListener("mousemove",e)}},[L]);const V=e=>{try{const t=(e||[]).map(e=>({id:e.id,laborStart:e.laborStart,laborEnd:e.laborEnd,materialsDeliveryStart:e.materialsDeliveryStart,materialsDeliveryEnd:e.materialsDeliveryEnd}));localStorage.setItem("projectSchedules",JSON.stringify(t))}catch(t){console.error("Error saving schedules to localStorage:",t)}},H=new Date(i);H.setDate(i.getDate()-i.getDay());const G=function(e){const t=[],r=new Date(e);for(let n=0;n<7;n++){const e=new Date(r);e.setDate(r.getDate()+n),t.push(new Date(e))}return t}(H),K=(0,o.useMemo)(()=>{const e=new Set;return(z||[]).forEach(t=>{t.type&&e.add(t.type)}),Array.from(e)},[z]),J=(0,o.useMemo)(()=>(z||[]).filter(e=>{var t;const r=(c||"").toLowerCase(),n=!r||(e.name||"").toLowerCase().includes(r)||((null===(t=e.client)||void 0===t?void 0:t.name)||"").toLowerCase().includes(r)||(e.location||"").toLowerCase().includes(r),a=!u||e.type===u,s=!m||e.status===m;return n&&a&&s}),[z,c,u,m]),X=J.filter(e=>!e.materialsDeliveryStart&&!e.laborStart&&!e.startDate),Q=(e,t,r)=>{g((0,Y.A)((0,Y.A)({},t),{},{type:r})),T(r),e.dataTransfer.effectAllowed="move"},Z=async(e,t)=>{if(console.log("Mouse up on project",e,"day",t),console.log("Drag start:",L),console.log("Drag end:",M),console.log("Selected type:",I),L&&L.projectId===e){const r=M||{projectId:e,dayIdx:t},n=Math.min(L.dayIdx,r.dayIdx),a=Math.max(L.dayIdx,r.dayIdx),s=G[n],o=G[a];console.log("Scheduling range:",n,"to",a),console.log("Start day:",s),console.log("End day:",o);const i={projectId:e,laborStart:"labor"===I?s.toISOString():void 0,laborEnd:"labor"===I?o.toISOString():void 0,materialsDeliveryStart:"materials"===I?s.toISOString():void 0,materialsDeliveryEnd:"materials"===I?o.toISOString():void 0};console.log("Sending payload:",i);try{const t="localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname?"".concat(window.location.protocol,"//").concat(window.location.host):{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_API_URL||"http://localhost:8000",r=await fetch("".concat(t,"/api/schedules"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!r.ok){const e=await r.text();throw console.error("Server response:",r.status,e),new Error("Failed to save schedule: ".concat(r.status," ").concat(e))}const n=await r.json();console.log("Schedule saved successfully:",n);const a=z.map(t=>t.id!==e?t:"materials"===I?(0,Y.A)((0,Y.A)({},t),{},{materialsDeliveryStart:s.toISOString(),materialsDeliveryEnd:o.toISOString()}):(0,Y.A)((0,Y.A)({},t),{},{laborStart:s.toISOString(),laborEnd:o.toISOString()}));W(a),V(a),alert("Successfully scheduled ".concat(I," for ").concat(s.toLocaleDateString()," to ").concat(o.toLocaleDateString()))}catch(XI){console.error("Error saving schedule:",XI),alert("Error saving schedule to backend: "+XI.message)}D(null),O(null)}};return(0,kt.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",style:{overflow:"hidden"},children:[b&&(0,kt.jsx)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,kt.jsx)("span",{className:"text-blue-700",children:"Loading schedules from server..."})]})}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsxs)("div",{className:"mb-4",children:[(0,kt.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Project Schedules"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Drag materials and labor buttons to schedule projects"})]}),(0,kt.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("button",{className:"px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[(0,kt.jsx)(gn,{className:"w-4 h-4"}),"Add Project"]}),(0,kt.jsxs)("select",{value:v,onChange:e=>x(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,kt.jsx)("option",{value:"weekly",children:"Weekly View"}),(0,kt.jsx)("option",{value:"daily",children:"Daily View"}),(0,kt.jsx)("option",{value:"monthly",children:"Monthly View"})]})]})}),(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("button",{onClick:()=>{l(new Date)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Today"}),(0,kt.jsxs)("button",{onClick:q,disabled:b,className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{const e=new Date(i);e.setDate(i.getDate()-7),l(e)},className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,kt.jsx)(nn,{className:"w-5 h-5"})}),(0,kt.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:ub(H,new Date(H.getTime()+5184e5))}),(0,kt.jsx)("button",{onClick:()=>{const e=new Date(i);e.setDate(i.getDate()+7),l(e)},className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,kt.jsx)(fn,{className:"w-5 h-5"})})]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)(pn,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,kt.jsx)("input",{type:"text",placeholder:"Search projects...",value:c,onChange:e=>d(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-64"})]}),(0,kt.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,kt.jsx)("option",{value:"",children:"All Trades"}),K.map(e=>(0,kt.jsx)("option",{value:e,children:e},e))]}),(0,kt.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,kt.jsx)("option",{value:"",children:"All Status"}),U.map(e=>(0,kt.jsx)("option",{value:e.id,children:e.displayName},e.id))]})]})]})]}),(0,kt.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,kt.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,kt.jsx)("span",{className:"font-semibold text-blue-800",children:"How to Schedule:"})]}),(0,kt.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,kt.jsxs)("p",{children:["\u2022 Drag the ",(0,kt.jsx)("span",{className:"font-semibold",children:"Materials"})," or ",(0,kt.jsx)("span",{className:"font-semibold",children:"Labor"})," buttons from each project row"]}),(0,kt.jsx)("p",{children:"\u2022 Drop them onto the calendar days to schedule delivery or work"}),(0,kt.jsx)("p",{children:"\u2022 Drag across multiple days to schedule longer periods"})]})]}),(0,kt.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:(0,kt.jsx)("div",{className:"overflow-x-auto",style:{overflowY:"hidden"},children:(0,kt.jsxs)("table",{className:"min-w-full table-fixed",style:{tableLayout:"fixed"},children:[(0,kt.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,kt.jsxs)("tr",{children:[(0,kt.jsx)("th",{className:"sticky left-0 z-20 bg-gray-50 border-r border-gray-200 px-4 py-2 text-left text-sm font-semibold text-gray-900 w-64",children:"Projects"}),G.map((e,t)=>(0,kt.jsx)("th",{className:"px-4 py-4 text-center text-sm font-semibold text-gray-900 w-32",children:(0,kt.jsxs)("div",{className:"flex flex-col items-center",children:[(0,kt.jsx)("span",{className:"text-gray-500 text-xs",children:e.toLocaleDateString("en-US",{weekday:"short"})}),(0,kt.jsx)("span",{className:"text-lg font-bold",children:e.getDate()})]})},t))]})}),(0,kt.jsxs)("tbody",{children:[J.map((e,t)=>{var r,n;return(0,kt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,kt.jsx)("td",{className:"sticky left-0 z-10 bg-white border-r border-gray-200 px-3 py-2 align-top group",onMouseEnter:()=>F(e.id),onMouseLeave:()=>F(null),children:(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ".concat(hb(e.type)),children:(null===(r=e.type)||void 0===r?void 0:r[0])||"P"}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900 truncate",children:e.name}),(0,kt.jsx)("div",{className:"text-xs text-gray-600 truncate",children:null===(n=e.client)||void 0===n?void 0:n.name}),(0,kt.jsxs)("div",{className:"flex gap-1 mt-1",children:[(0,kt.jsxs)("button",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded bg-blue-100 hover:bg-blue-200 text-blue-700 text-xs font-semibold cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:t=>Q(t,e,"materials"),title:"Drag to schedule materials delivery",children:[(0,kt.jsx)(vn,{className:"w-3 h-3"})," Materials"]}),(0,kt.jsxs)("button",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded bg-green-100 hover:bg-green-200 text-green-700 text-xs font-semibold cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:t=>Q(t,e,"labor"),title:"Drag to schedule labor",children:[(0,kt.jsx)(xn,{className:"w-3 h-3"})," Labor"]})]})]})]})}),G.map((t,r)=>{const n=function(e,t){if(!e.materialsDeliveryStart||!e.materialsDeliveryEnd)return!1;const r=new Date(e.materialsDeliveryStart),n=new Date(e.materialsDeliveryEnd);return r<=t&&t<=n}(e,t),a=function(e,t){if(!e.laborStart||!e.laborEnd)return!1;const r=new Date(e.laborStart),n=new Date(e.laborEnd);return r<=t&&t<=n}(e,t),o=((e,t)=>{if(!L||!M)return!1;if(L.projectId!==e)return!1;const r=Math.min(L.dayIdx,M.dayIdx),n=Math.max(L.dayIdx,M.dayIdx);return t>=r&&t<=n})(e.id,r);return(0,kt.jsx)("td",{className:"align-top px-2 py-2 w-32 h-20 border-r border-gray-100 ".concat(o?"materials"===I?"bg-blue-200":"bg-green-200":""),"data-project-id":e.id,"data-day-idx":r,onMouseDown:()=>{return t=e.id,n=r,console.log("Mouse down on project",t,"day",n,"type",I),D({projectId:t,dayIdx:n}),void O({projectId:t,dayIdx:n});var t,n},onMouseEnter:()=>{return t=e.id,n=r,void(L&&L.projectId===t&&(console.log("Mouse enter on project",t,"day",n),O({projectId:t,dayIdx:n})));var t,n},onMouseMove:()=>{return t=e.id,n=r,void(L&&L.projectId===t&&(console.log("Mouse move on project",t,"day",n),O({projectId:t,dayIdx:n})));var t,n},onMouseUp:()=>Z(e.id,r),onDragOver:e=>{e.preventDefault(),e.currentTarget.style.backgroundColor=f?"materials"===f.type?"#dbeafe":"#dcfce7":""},onDragLeave:e=>{e.currentTarget.style.backgroundColor=""},onDrop:t=>{t.preventDefault(),t.currentTarget.style.backgroundColor="",f&&Z(e.id,r)},style:{cursor:"pointer",userSelect:"none"},children:(0,kt.jsxs)("div",{className:"space-y-2",children:[n&&(0,kt.jsx)("div",{className:"group cursor-pointer",onClick:()=>s(e),children:(0,kt.jsxs)("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-2 shadow-sm hover:shadow-md transition-all duration-200",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,kt.jsx)(vn,{className:"w-3 h-3 text-blue-600"}),(0,kt.jsx)("span",{className:"text-xs font-medium text-blue-800",children:"Materials"})]}),(0,kt.jsx)("div",{className:"text-xs text-blue-700",children:pb(e).text})]})}),a&&(0,kt.jsx)("div",{className:"group cursor-pointer",onClick:()=>s(e),children:(0,kt.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded-lg p-2 shadow-sm hover:shadow-md transition-all duration-200",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,kt.jsx)(xn,{className:"w-3 h-3 text-green-600"}),(0,kt.jsx)("span",{className:"text-xs font-medium text-green-800",children:"Labor"})]}),(0,kt.jsx)("div",{className:"text-xs text-green-700",children:fb(e).text})]})}),!n&&!a&&(0,kt.jsx)("div",{className:"h-12 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 cursor-pointer flex items-center justify-center",style:{minHeight:"48px"},onDragOver:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#3b82f6",e.currentTarget.style.backgroundColor="#eff6ff"},onDragLeave:e=>{e.currentTarget.style.borderColor="",e.currentTarget.style.backgroundColor=""},onDrop:t=>{t.preventDefault(),t.currentTarget.style.borderColor="",t.currentTarget.style.backgroundColor="",f&&Z(e.id,r)},children:(0,kt.jsx)("span",{className:"text-xs text-gray-400",children:"Drop to schedule"})})]})},r)})]},e.id)}),X.length>0&&(0,kt.jsxs)("tr",{className:"border-t-2 border-yellow-300 bg-yellow-50",children:[(0,kt.jsx)("td",{className:"sticky left-0 z-10 bg-yellow-50 border-r border-gray-200 px-6 py-4 align-top",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm bg-yellow-500",children:"?"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold text-yellow-900",children:"Unscheduled Projects"}),(0,kt.jsxs)("div",{className:"text-xs text-yellow-700",children:[X.length," projects"]})]})]})}),(0,kt.jsx)("td",{colSpan:G.length,className:"px-4 py-4",children:(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:X.map(e=>{var t,r;return(0,kt.jsx)("div",{draggable:!0,onDragStart:t=>Q(t,e,"materials"),className:"group cursor-pointer",onClick:()=>s(e),children:(0,kt.jsxs)("div",{className:"rounded-lg p-3 shadow-sm border border-yellow-300 bg-white hover:shadow-md transition-all duration-200",children:[(0,kt.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("div",{className:"font-semibold text-sm text-gray-900 truncate",children:e.name}),(0,kt.jsx)("div",{className:"text-xs text-gray-600 truncate",children:null===(t=e.client)||void 0===t?void 0:t.name})]}),mb(e.status)]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,kt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(hb(e.type)," text-white"),children:e.type}),(0,kt.jsxs)("span",{className:"text-gray-600",children:["$",null===(r=e.estimateValue)||void 0===r?void 0:r.toLocaleString()]})]})]})},e.id)})})})]})]})]})})}),a&&(0,kt.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,kt.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ".concat(hb(a.type)),children:(null===(e=a.type)||void 0===e?void 0:e[0])||"P"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:a.name}),(0,kt.jsx)("p",{className:"text-sm text-gray-600",children:a.type})]})]}),(0,kt.jsx)("button",{onClick:()=>s(null),className:"text-gray-400 hover:text-gray-600",children:(0,kt.jsx)(Zr,{className:"w-6 h-6"})})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"Project Details"}),(0,kt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Client:"}),(0,kt.jsx)("span",{className:"font-medium",children:null===(t=a.client)||void 0===t?void 0:t.name})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Location:"}),(0,kt.jsx)("span",{className:"font-medium",children:a.location})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Project Manager:"}),(0,kt.jsx)("span",{className:"font-medium",children:a.projectManager?"".concat(a.projectManager.firstName," ").concat(a.projectManager.lastName):"Not Assigned"})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Value:"}),(0,kt.jsxs)("span",{className:"font-medium",children:["$",null===(n=a.estimateValue)||void 0===n?void 0:n.toLocaleString()]})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"Schedule & Status"}),(0,kt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Labor Period:"}),(0,kt.jsx)("span",{className:"font-medium",children:a.laborStart?ub(a.laborStart,a.laborEnd):"Not Scheduled"})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Materials:"}),(0,kt.jsx)("span",{className:"font-medium",children:a.materialsDeliveryStart?ub(a.materialsDeliveryStart,a.materialsDeliveryEnd):"Not Scheduled"})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Progress:"}),(0,kt.jsxs)("span",{className:"font-medium",children:[a.progress||0,"%"]})]}),(0,kt.jsxs)("div",{className:"flex justify-between",children:[(0,kt.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,kt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("active"===a.status?"bg-green-100 text-green-800":"planning"===a.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]})]})]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"Progress"}),(0,kt.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,kt.jsx)("div",{className:"bg-[var(--color-primary-blueprint-blue)] h-3 rounded-full transition-all duration-500",style:{width:"".concat(a.progress||0,"%")}})}),(0,kt.jsxs)("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[(0,kt.jsx)("span",{children:"0%"}),(0,kt.jsx)("span",{children:"100%"})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3",children:[(0,kt.jsx)("button",{className:"flex-1 px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 font-medium",children:"Edit Project"}),a.materialsDeliveryStart?(0,kt.jsx)("button",{className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium",onClick:()=>{const e=(0,Y.A)((0,Y.A)({},a),{},{materialsDeliveryStart:null,materialsDeliveryEnd:null}),t=z.map(t=>t.id===a.id?e:t);W(t),V(t),s(null)},children:"Clear Materials"}):(0,kt.jsx)("button",{className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",onClick:()=>{T("materials"),_(!0)},children:"Schedule Materials"}),a.laborStart?(0,kt.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium",onClick:()=>{const e=(0,Y.A)((0,Y.A)({},a),{},{laborStart:null,laborEnd:null}),t=z.map(t=>t.id===a.id?e:t);W(t),V(t),s(null)},children:"Clear Labor"}):(0,kt.jsx)("button",{className:"px-4 py-2 bg-[var(--color-success-green)] text-white rounded-lg hover:bg-green-700 font-medium",onClick:()=>{T("labor"),_(!0)},children:"Schedule Labor"})]})]})})}),P&&(0,kt.jsx)("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/50",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,kt.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:["Schedule ","materials"===I?"Materials Delivery":"Labor"]}),(0,kt.jsx)("button",{onClick:()=>{_(!1),j(""),S(""),A(""),E("")},className:"text-gray-400 hover:text-gray-600",children:(0,kt.jsx)(Zr,{className:"w-6 h-6"})})]}),"materials"===I?(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Materials Delivery Start Date"}),(0,kt.jsx)("input",{type:"date",value:w,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Materials Delivery End Date"}),(0,kt.jsx)("input",{type:"date",value:N,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,kt.jsx)("button",{onClick:()=>(e=>{if(!e||!w||!N)return;console.log("Scheduling materials for:",e.name,"from",w,"to",N);const t=z.map(t=>t.id===e.id?(0,Y.A)((0,Y.A)({},t),{},{materialsDeliveryStart:w,materialsDeliveryEnd:N}):t);console.log("Updated projects:",t),W(t),s(null),_(!1),j(""),S(""),V(t)})(a),disabled:!w||!N,className:"w-full px-4 py-2 bg-[var(--color-primary-blueprint-blue)] text-white rounded-lg hover:bg-blue-700 font-medium disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Schedule Materials"})]}):(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Labor Start Date"}),(0,kt.jsx)("input",{type:"date",value:k,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Labor End Date"}),(0,kt.jsx)("input",{type:"date",value:C,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),(0,kt.jsx)("button",{onClick:()=>(e=>{if(!e||!k||!C)return;console.log("Scheduling labor for:",e.name,"from",k,"to",C);const t=z.map(t=>t.id===e.id?(0,Y.A)((0,Y.A)({},t),{},{laborStart:k,laborEnd:C}):t);console.log("Updated projects:",t),W(t),s(null),_(!1),A(""),E(""),V(t)})(a),disabled:!k||!C,className:"w-full px-4 py-2 bg-[var(--color-success-green)] text-white rounded-lg hover:bg-green-700 font-medium disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Schedule Labor"})]})]})})]})}const vb=["title","titleId"];function xb(e,t){let{title:r,titleId:n}=e,a=An(e,vb);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"}))}const bb=o.forwardRef(xb),yb=["title","titleId"];function wb(e,t){let{title:r,titleId:n}=e,a=An(e,yb);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}const jb=o.forwardRef(wb),Nb=["title","titleId"];function Sb(e,t){let{title:r,titleId:n}=e,a=An(e,Nb);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const kb=o.forwardRef(Sb),Ab=["title","titleId"];function Cb(e,t){let{title:r,titleId:n}=e,a=An(e,Ab);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const Eb=o.forwardRef(Cb),Pb=["title","titleId"];function _b(e,t){let{title:r,titleId:n}=e,a=An(e,Pb);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const Ib=o.forwardRef(_b),Tb=["title","titleId"];function Lb(e,t){let{title:r,titleId:n}=e,a=An(e,Tb);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"}))}const Db=o.forwardRef(Lb),Mb=["title","titleId"];function Ob(e,t){let{title:r,titleId:n}=e,a=An(e,Mb);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const Rb=o.forwardRef(Ob),Fb={"application/pdf":{type:"PDF",icon:"\ud83d\udcc4",color:"text-red-500"},"application/msword":{type:"Word",icon:"\ud83d\udcdd",color:"text-blue-500"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{type:"Word",icon:"\ud83d\udcdd",color:"text-blue-500"},"application/vnd.ms-excel":{type:"Excel",icon:"\ud83d\udcca",color:"text-green-500"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{type:"Excel",icon:"\ud83d\udcca",color:"text-green-500"},"application/vnd.ms-powerpoint":{type:"PowerPoint",icon:"\ud83d\udcfd\ufe0f",color:"text-orange-500"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{type:"PowerPoint",icon:"\ud83d\udcfd\ufe0f",color:"text-orange-500"},"image/jpeg":{type:"JPEG",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},"image/jpg":{type:"JPEG",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},"image/png":{type:"PNG",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},"image/gif":{type:"GIF",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},"image/svg+xml":{type:"SVG",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},"image/webp":{type:"WebP",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},"application/zip":{type:"ZIP",icon:"\ud83d\udddc\ufe0f",color:"text-gray-500"},"application/x-rar-compressed":{type:"RAR",icon:"\ud83d\udddc\ufe0f",color:"text-gray-500"},"application/x-7z-compressed":{type:"7Z",icon:"\ud83d\udddc\ufe0f",color:"text-gray-500"},"text/plain":{type:"Text",icon:"\ud83d\udcc4",color:"text-gray-600"},"text/csv":{type:"CSV",icon:"\ud83d\udcca",color:"text-green-600"},"text/javascript":{type:"JavaScript",icon:"\ud83d\udcbb",color:"text-yellow-500"},"text/html":{type:"HTML",icon:"\ud83d\udcbb",color:"text-orange-600"},"text/css":{type:"CSS",icon:"\ud83d\udcbb",color:"text-blue-600"},"application/json":{type:"JSON",icon:"\ud83d\udcbb",color:"text-gray-600"},default:{type:"File",icon:"\ud83d\udcc4",color:"text-gray-500"}},Ub=function(e){var t;if(e&&Fb[e])return Fb[e];const r=null===(t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"").split(".").pop())||void 0===t?void 0:t.toLowerCase(),n={pdf:{type:"PDF",icon:"\ud83d\udcc4",color:"text-red-500"},doc:{type:"Word",icon:"\ud83d\udcdd",color:"text-blue-500"},docx:{type:"Word",icon:"\ud83d\udcdd",color:"text-blue-500"},xls:{type:"Excel",icon:"\ud83d\udcca",color:"text-green-500"},xlsx:{type:"Excel",icon:"\ud83d\udcca",color:"text-green-500"},ppt:{type:"PowerPoint",icon:"\ud83d\udcfd\ufe0f",color:"text-orange-500"},pptx:{type:"PowerPoint",icon:"\ud83d\udcfd\ufe0f",color:"text-orange-500"},jpg:{type:"JPEG",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},jpeg:{type:"JPEG",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},png:{type:"PNG",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},gif:{type:"GIF",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},svg:{type:"SVG",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},webp:{type:"WebP",icon:"\ud83d\uddbc\ufe0f",color:"text-purple-500"},zip:{type:"ZIP",icon:"\ud83d\udddc\ufe0f",color:"text-gray-500"},rar:{type:"RAR",icon:"\ud83d\udddc\ufe0f",color:"text-gray-500"},"7z":{type:"7Z",icon:"\ud83d\udddc\ufe0f",color:"text-gray-500"},txt:{type:"Text",icon:"\ud83d\udcc4",color:"text-gray-600"},csv:{type:"CSV",icon:"\ud83d\udcca",color:"text-green-600"},js:{type:"JavaScript",icon:"\ud83d\udcbb",color:"text-yellow-500"},html:{type:"HTML",icon:"\ud83d\udcbb",color:"text-orange-600"},css:{type:"CSS",icon:"\ud83d\udcbb",color:"text-blue-600"},json:{type:"JSON",icon:"\ud83d\udcbb",color:"text-gray-600"}};return r&&n[r]?n[r]:Fb.default},Bb=e=>{let{isOpen:t,onClose:r,files:n=[],onConfirm:a,onCancel:s,colorMode:i=!1}=e;const[l,c]=(0,o.useState)({}),[d,u]=(0,o.useState)({});(0,o.useEffect)(()=>{if(t&&n.length>0){const e={};n.forEach((t,r)=>{e[r]=t.name||"File ".concat(r+1)}),c(e),u({})}},[t,n]);const h=()=>{s(),r()};return t&&0!==n.length?(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden ".concat(i?"bg-slate-800":"bg-white"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b ".concat(i?"border-slate-700":"border-gray-200"),children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-xl font-bold ".concat(i?"text-white":"text-gray-900"),children:"Rename Files"}),(0,kt.jsxs)("p",{className:"text-sm mt-1 ".concat(i?"text-gray-300":"text-gray-600"),children:[n.length," file",n.length>1?"s":""," ready to upload"]})]}),(0,kt.jsx)("button",{onClick:h,className:"p-2 rounded-lg transition ".concat(i?"hover:bg-slate-700 text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-500 hover:text-gray-700"),children:(0,kt.jsx)(Rb,{className:"h-5 w-5"})})]}),(0,kt.jsx)("div",{className:"p-6 max-h-96 overflow-y-auto",children:(0,kt.jsx)("div",{className:"space-y-4",children:n.map((e,t)=>{const r=Ub(e.type,e.name),n=(e.size/1024/1024).toFixed(2);return(0,kt.jsx)("div",{className:"p-4 rounded-lg border ".concat(i?"border-slate-600 bg-slate-700/50":"border-gray-200 bg-gray-50"),children:(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center ".concat(i?"bg-slate-600":"bg-gray-100"),children:(0,kt.jsx)("span",{className:"text-lg",children:r.icon})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,kt.jsx)("span",{className:"text-sm font-medium ".concat(i?"text-white":"text-gray-900"),children:r.type}),(0,kt.jsxs)("span",{className:"text-xs ".concat(i?"text-gray-400":"text-gray-500"),children:[n," MB"]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("input",{type:"text",value:l[t]||"",onChange:e=>((e,t)=>{c(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t})),d[e]&&u(t=>{const r=(0,Y.A)({},t);return delete r[e],r})})(t,e.target.value),className:"w-full px-3 py-2 rounded-lg border text-sm transition ".concat(d[t]?"border-red-300 bg-red-50 focus:border-red-500 focus:ring-red-500":i?"border-slate-600 bg-slate-800 text-white placeholder-gray-400 focus:border-blue-500 focus:ring-blue-500":"border-gray-300 bg-white text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"),placeholder:"Enter file name..."}),d[t]&&(0,kt.jsx)("p",{className:"mt-1 text-xs text-red-600",children:d[t]})]})]})]})},t)})})}),(0,kt.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t ".concat(i?"border-slate-700":"border-gray-200"),children:[(0,kt.jsx)("button",{onClick:h,className:"px-6 py-2 rounded-lg font-medium transition ".concat(i?"border border-slate-600 text-gray-300 hover:bg-slate-700 hover:text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:()=>{if((()=>{const e={},t=new Set;return Object.entries(l).forEach(r=>{let[n,a]=r;a.trim()?t.has(a.trim())?e[n]="File name must be unique":t.add(a.trim()):e[n]="File name is required"}),u(e),0===Object.keys(e).length})()){console.log("\ud83d\udcdd FileRenameModal: Creating renamed files...");const t=n.map((e,t)=>{const r=l[t]||e.name;if(console.log("  - File ".concat(t,': "').concat(e.name,'" -> "').concat(r,'"')),!(e instanceof File))throw console.error("\u274c FileRenameModal: Invalid file object at index",t,e),new Error("Invalid file object at index ".concat(t));if(r===e.name)return console.log("  \u2713 Keeping original name for: ".concat(e.name)),e;try{const t=new File([e],r,{type:e.type,lastModified:e.lastModified||Date.now()});return console.log('  \u2713 Created renamed file: "'.concat(t.name,'" (').concat(t.size," bytes, type: ").concat(t.type,")")),t}catch(n){throw console.error("\u274c FileRenameModal: Error creating File object:",n),new Error('Failed to rename file "'.concat(e.name,'": ').concat(n.message))}});console.log("\u2705 FileRenameModal: All files processed, confirming upload...");try{a(t)}catch(e){throw console.error("\u274c FileRenameModal: Error in onConfirm callback:",e),e}}else console.warn("\u26a0\ufe0f FileRenameModal: Validation failed")},className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition",children:"Upload Files"})]})]})}):null},zb=e=>{let{isOpen:t,onClose:r,onConfirm:n,itemName:a,itemType:s="item",colorMode:o=!1}=e;return t?(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"rounded-2xl shadow-2xl max-w-md w-full ".concat(o?"bg-slate-800":"bg-white"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 p-6 border-b ".concat(o?"border-slate-700":"border-gray-200"),children:[(0,kt.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center ".concat(o?"bg-red-900/20":"bg-red-100"),children:(0,kt.jsx)(dg,{className:"h-6 w-6 text-red-600"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h3",{className:"text-lg font-bold ".concat(o?"text-white":"text-gray-900"),children:["Delete ",s]}),(0,kt.jsx)("p",{className:"text-sm ".concat(o?"text-gray-300":"text-gray-600"),children:"This action cannot be undone"})]})]}),(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsxs)("p",{className:"text-sm ".concat(o?"text-gray-300":"text-gray-700"," mb-4"),children:["Are you sure you want to delete ",(0,kt.jsxs)("strong",{children:['"',a,'"']}),"? This ",s," will be moved to the trash and permanently deleted after 90 days."]}),(0,kt.jsx)("div",{className:"p-3 rounded-lg ".concat(o?"bg-yellow-900/20 border border-yellow-600":"bg-yellow-50 border border-yellow-200"),children:(0,kt.jsxs)("p",{className:"text-xs ".concat(o?"text-yellow-300":"text-yellow-700"),children:[(0,kt.jsx)("strong",{children:"Note:"})," The ",s," will be kept in the trash for 90 days before permanent deletion."]})})]}),(0,kt.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t ".concat(o?"border-slate-700":"border-gray-200"),children:[(0,kt.jsx)("button",{onClick:r,className:"px-6 py-2 rounded-lg font-medium transition ".concat(o?"border border-slate-600 text-gray-300 hover:bg-slate-700 hover:text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsxs)("button",{onClick:n,className:"px-6 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition flex items-center gap-2",children:[(0,kt.jsx)(kb,{className:"h-4 w-4"}),"Delete ",s]})]})]})}):null},Wb=e=>{let{isOpen:t,onClose:r,onConfirm:n,currentName:a="",colorMode:s=!1}=e;const[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)("");(0,o.useEffect)(()=>{t&&(l(a),d(""))},[t,a]);const u=e=>{e.preventDefault(),i.trim()?i.trim()!==a?i.trim().length<2?d("Folder name must be at least 2 characters"):i.trim().length>100?d("Folder name must be less than 100 characters"):n(i.trim()):r():d("Folder name is required")},h=()=>{l(a),d(""),r()};return t?(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"rounded-2xl shadow-2xl max-w-md w-full ".concat(s?"bg-slate-800":"bg-white"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b ".concat(s?"border-slate-700":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat(s?"bg-amber-900/20":"bg-amber-100"),children:(0,kt.jsx)(bb,{className:"h-5 w-5 text-amber-600"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-bold ".concat(s?"text-white":"text-gray-900"),children:"Rename Folder"}),(0,kt.jsx)("p",{className:"text-sm ".concat(s?"text-gray-300":"text-gray-600"),children:"Enter a new name for this folder"})]})]}),(0,kt.jsx)("button",{onClick:h,className:"p-2 rounded-lg transition ".concat(s?"hover:bg-slate-700 text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-500 hover:text-gray-700"),children:(0,kt.jsx)(Rb,{className:"h-5 w-5"})})]}),(0,kt.jsx)("form",{onSubmit:u,className:"p-6",children:(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(s?"text-gray-300":"text-gray-700"),children:"Folder Name"}),(0,kt.jsx)("input",{type:"text",value:i,onChange:e=>{l(e.target.value),d("")},className:"w-full px-3 py-2 rounded-lg border text-sm transition ".concat(c?"border-red-300 bg-red-50 focus:border-red-500 focus:ring-red-500":s?"border-slate-600 bg-slate-800 text-white placeholder-gray-400 focus:border-blue-500 focus:ring-blue-500":"border-gray-300 bg-white text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500"),placeholder:"Enter folder name...",autoFocus:!0}),c&&(0,kt.jsx)("p",{className:"mt-1 text-xs text-red-600",children:c})]})}),(0,kt.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t ".concat(s?"border-slate-700":"border-gray-200"),children:[(0,kt.jsx)("button",{onClick:h,className:"px-6 py-2 rounded-lg font-medium transition ".concat(s?"border border-slate-600 text-gray-300 hover:bg-slate-700 hover:text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{onClick:u,className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition",children:"Rename Folder"})]})]})}):null},qb=()=>{const[e,t]=(0,o.useState)([]),[r,n]=(0,o.useState)([]),[a,s]=(0,o.useState)(!0),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)([]),[m,p]=(0,o.useState)(!1),[f,g]=(0,o.useState)(!1),[v,x]=(0,o.useState)([]),[b,y]=(0,o.useState)(!1),[w,j]=(0,o.useState)(null),[N,S]=(0,o.useState)(null),[k,A]=(0,o.useState)(new Set),[C,E]=(0,o.useState)(""),[P,_]=(0,o.useState)(null),[I,T]=(0,o.useState)(!1),[L,D]=(0,o.useState)(!1),[M,O]=(0,o.useState)([]),[R,F]=(0,o.useState)(!1),[U,B]=(0,o.useState)(null),[z,W]=(0,o.useState)(!1),[q,V]=(0,o.useState)(null),[H,G]=(0,o.useState)(!1),[K,J]=(0,o.useState)([]),[Y,X]=(0,o.useState)(null),Q=(0,o.useRef)(null),Z=async()=>{try{const e=await Ma.assetsService.list({type:"FOLDER",limit:100});t((null===e||void 0===e?void 0:e.assets)||[])}catch(XI){console.error("Failed to load folders")}},$=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;s(!0);try{const t=await Ma.assetsService.list({parentId:e,search:i,limit:50});n((null===t||void 0===t?void 0:t.assets)||[]),h((null===t||void 0===t?void 0:t.breadcrumbs)||[])}catch(XI){qr.error("Failed to load items")}finally{s(!1)}};(0,o.useEffect)(()=>{Z(),te()},[]),(0,o.useEffect)(()=>{$(c)},[c,i]),(0,o.useEffect)(()=>{const e=e=>{console.log("\ud83d\udd04 Documents & Resources received refresh event:",e.detail),Z(),$(c)};return window.addEventListener("fm:refresh",e),()=>window.removeEventListener("fm:refresh",e)},[c]),(0,o.useEffect)(()=>{},[]);const ee=e=>{B(e),F(!0)},te=async()=>{try{const e=await Ma.assetsService.list({type:"TRASH",limit:100});J((null===e||void 0===e?void 0:e.assets)||[])}catch(XI){console.error("Failed to load trash items")}},re=e=>{V(e),W(!0)},ne=async()=>{if(C.trim()){console.log("Creating folder with:",{name:C,parentId:c});try{const e=await Ma.assetsService.createFolder({name:C,parentId:c});console.log("Folder created successfully:",e),E(""),await Promise.all([Z(),$(c)]),qr.success('Folder "'.concat(C,'" created successfully!'))}catch(XI){var e,t,r,n,a,s,o,i,l,d;if(console.error("Failed to create folder:",{error:XI,response:null===(e=XI.response)||void 0===e?void 0:e.data,status:null===(t=XI.response)||void 0===t?void 0:t.status}),400===(null===(r=XI.response)||void 0===r?void 0:r.status))null!==(s=XI.response)&&void 0!==s&&null!==(o=s.data)&&void 0!==o&&null!==(i=o.message)&&void 0!==i&&i.toLowerCase().includes("already exists")?qr.error('A folder named "'.concat(C,'" already exists in this location')):null!==(l=XI.response)&&void 0!==l&&null!==(d=l.data)&&void 0!==d&&d.message?qr.error(XI.response.data.message):qr.error("Invalid folder name. Please try a different name.");else if(401===(null===(n=XI.response)||void 0===n?void 0:n.status))qr.error("Please log in to create folders");else if(403===(null===(a=XI.response)||void 0===a?void 0:a.status))qr.error("You do not have permission to create folders here");else if("Network Error"===XI.message)qr.error("Unable to connect to the server. Please check your connection.");else{var u,h;qr.error((null===(u=XI.response)||void 0===u||null===(h=u.data)||void 0===h?void 0:h.message)||"Failed to create folder. Please try again.")}}}else qr.error("Please enter a folder name")},ae=(e,t)=>{j(t),e.dataTransfer.effectAllowed="move"},se=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},oe=async(e,t)=>{if(e.preventDefault(),e.stopPropagation(),!w)return;if(w.id===t)return j(null),void S(null);const r=null!==t&&void 0!==t?t:null;if(w.parentId===r)return j(null),void S(null);try{await Ma.assetsService.bulkOperation({operation:"move",assetIds:[w.id],data:{parentId:r}}),await Z(),await $(c),qr.success("Moved ".concat(w.title))}catch(XI){qr.error("Move failed")}finally{j(null),S(null)}},ie=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e.filter(e=>(e.parentId||null)===t)},le=r.filter(e=>"FOLDER"===e.type),ce=r.filter(e=>"FOLDER"!==e.type),de=le.filter(e=>{var t;return null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase())}),ue=ce.filter(e=>{var t;return null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase())}),he=e=>{let{folder:t,level:r=0}=e;const n=k.has(t.id),a=ie(t.id);return(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 py-2 px-3 rounded-lg cursor-pointer transition group ".concat(c===t.id?"bg-blue-50 text-blue-700":"hover:bg-slate-100"," ").concat(N===t.id?"bg-blue-50 ring-2 ring-blue-300":""),style:{paddingLeft:"".concat(16*r+12,"px")},onDragOver:e=>{se(e),S(t.id)},onDragLeave:()=>S(null),onDrop:e=>oe(e,t.id),children:[a.length>0&&(0,kt.jsx)("button",{onClick:()=>(e=>{const t=new Set(k);t.has(e)?t.delete(e):t.add(e),A(t)})(t.id),className:"p-0.5",children:n?(0,kt.jsx)(ms,{className:"h-4 w-4"}):(0,kt.jsx)(gs,{className:"h-4 w-4"})}),(0,kt.jsx)(bb,{className:"h-5 w-5 flex-shrink-0 text-slate-500"}),(0,kt.jsx)("span",{className:"flex-1 text-sm truncate",onClick:()=>d(t.id),children:t.title}),(0,kt.jsxs)("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:[(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),re(t)},className:"p-1 hover:bg-blue-100 rounded",children:(0,kt.jsx)(jb,{className:"h-4 w-4 text-blue-600"})}),(0,kt.jsx)("button",{onClick:e=>{e.stopPropagation(),ee(t)},className:"p-1 hover:bg-red-100 rounded",children:(0,kt.jsx)(kb,{className:"h-4 w-4 text-red-600"})})]})]}),n&&a.map(e=>(0,kt.jsx)(he,{folder:e,level:r+1},e.id))]})};return(0,kt.jsxs)("div",{className:"h-screen flex flex-col bg-white",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 bg-[#F8FAFC] text-white shadow-lg",children:(0,kt.jsxs)("div",{className:"px-6 py-3 flex items-center justify-between gap-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold whitespace-nowrap",children:"All Folders"}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"text",placeholder:"New folder...",value:C,onChange:e=>E(e.target.value),onKeyDown:e=>"Enter"===e.key&&ne(),className:"w-40 px-3 py-1.5 bg-white border border-white/30 rounded-lg text-sm text-white placeholder-white/70 focus:bg-white focus:outline-none"}),(0,kt.jsx)("button",{onClick:ne,className:"px-2 py-1.5 bg-white hover:bg-white rounded-lg transition",children:(0,kt.jsx)(Eb,{className:"h-5 w-5"})})]})]}),(0,kt.jsxs)("div",{className:"flex-1 flex items-center gap-4",children:[(0,kt.jsxs)("div",{className:"flex-1 relative max-w-md",children:[(0,kt.jsx)(Ib,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-white/70"}),(0,kt.jsx)("input",{type:"text",placeholder:"Search...",value:i,onChange:e=>l(e.target.value),className:"w-full pl-9 pr-4 py-1.5 bg-white border border-white/30 rounded-lg text-sm text-white placeholder-white/70 focus:bg-white focus:outline-none"})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,kt.jsx)("button",{onClick:()=>d(null),className:"text-white/90 hover:text-white font-medium",children:"Home"}),u.map((e,t)=>(0,kt.jsxs)(o.Fragment,{children:[(0,kt.jsx)("span",{className:"text-white/60",children:"/"}),(0,kt.jsx)("button",{onClick:()=>d(e.id),className:"text-white/90 hover:text-white",children:e.title})]},e.id))]})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsxs)("button",{onClick:()=>p(!0),className:"px-3 py-1.5 bg-white hover:bg-white rounded-lg text-sm font-medium transition",children:[(0,kt.jsx)(Db,{className:"h-4 w-4 inline mr-1.5"}),"Playbook"]}),(0,kt.jsxs)("button",{onClick:()=>{G(!H),H||te()},className:"px-3 py-1.5 rounded-lg text-sm font-medium transition ".concat(H?"bg-red-500 text-white hover:bg-red-600":"bg-white hover:bg-white"),children:[(0,kt.jsx)(kb,{className:"h-4 w-4 inline mr-1.5"}),H?"Hide Trash":"Trash"]}),(0,kt.jsxs)("button",{onClick:()=>g(!0),className:"px-3 py-1.5 bg-[#7ED242] text-white rounded-lg text-sm font-medium hover:bg-[#6BC22E] hover:shadow-lg transition",children:[(0,kt.jsx)($i,{className:"h-4 w-4 inline mr-1.5"}),"Upload"]})]})]})}),(0,kt.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,kt.jsx)("div",{className:"w-80 border-r border-slate-200 bg-slate-50 flex flex-col overflow-hidden",children:(0,kt.jsxs)("div",{className:"flex-1 overflow-y-auto p-3",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 py-2 px-3 rounded-lg cursor-pointer mb-1 ".concat(null===c?"bg-blue-50 text-blue-700":"hover:bg-slate-100"),onClick:()=>d(null),onDragOver:se,onDrop:e=>oe(e,null),children:[(0,kt.jsx)(bb,{className:"h-5 w-5 text-slate-500"}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:"Home"})]}),ie(null).map(e=>(0,kt.jsx)(he,{folder:e,level:0},e.id))]})}),(0,kt.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:(0,kt.jsx)("div",{onDrop:e=>{e.preventDefault();const t=Array.from(e.dataTransfer.files);t.length>0&&(O(t),D(!0))},onDragOver:e=>e.preventDefault(),className:"border-2 border-dashed border-transparent hover:border-blue-300 transition-colors ".concat(H?"bg-red-50":"bg-slate-50"),children:(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:a?(0,kt.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#0089D1]"})}):(0,kt.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[de.map(e=>{var t,r,n,a;const s=null===(t=e.metadata)||void 0===t?void 0:t.isProjectFolder,o=null===(r=e.metadata)||void 0===r?void 0:r.projectNumber,i=null===(n=e.metadata)||void 0===n?void 0:n.customerName,l=null===(a=e.metadata)||void 0===a?void 0:a.address;return(0,kt.jsxs)("div",{draggable:!0,onDragStart:t=>ae(t,e),onDragOver:se,onDrop:t=>oe(t,e.id),onClick:()=>d(e.id),className:"p-3 bg-white border-2 rounded-xl cursor-pointer hover:shadow-md hover:border-blue-300 transition group relative ".concat((null===w||void 0===w?void 0:w.id)===e.id?"opacity-50":""," ").concat(N===e.id?"border-blue-400 bg-blue-50":"border-slate-200"),children:[(0,kt.jsx)(bb,{className:"h-10 w-10 text-amber-500 mx-auto mb-2"}),s&&o?(0,kt.jsxs)("div",{className:"text-center space-y-0.5",children:[(0,kt.jsxs)("p",{className:"text-xs font-bold text-blue-600",children:["#",o]}),(0,kt.jsx)("p",{className:"text-xs font-medium text-gray-800 leading-tight break-words",children:i||"Unknown"}),(0,kt.jsx)("p",{className:"text-xs text-gray-600 leading-tight break-words",children:l||e.title})]}):(0,kt.jsx)("p",{className:"text-xs font-medium text-center leading-tight break-words",children:e.title}),(0,kt.jsxs)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 flex gap-1",children:[(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),re(e)},className:"p-1 bg-blue-50 rounded hover:bg-blue-100",children:(0,kt.jsx)(jb,{className:"h-4 w-4 text-blue-600"})}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),ee(e)},className:"p-1 bg-red-50 rounded hover:bg-red-100",children:(0,kt.jsx)(kb,{className:"h-4 w-4 text-red-600"})})]})]},e.id)}),ue.map(e=>{const t=Ub(e.mimeType,e.title);return(0,kt.jsxs)("div",{draggable:!0,onDragStart:t=>ae(t,e),className:"p-4 bg-white border border-slate-200 rounded-xl hover:shadow-md hover:border-slate-300 transition group relative ".concat((null===w||void 0===w?void 0:w.id)===e.id?"opacity-50":""),onClick:()=>{_(e),T(!0)},children:[(0,kt.jsxs)("div",{className:"flex flex-col items-center",children:[(0,kt.jsx)("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mb-2 ".concat(t.color.replace("text-","bg-").replace("-500","-100")),children:(0,kt.jsx)("span",{className:"text-2xl",children:t.icon})}),(0,kt.jsx)("p",{className:"text-xs font-medium text-center text-gray-600 mb-1",children:t.type})]}),(0,kt.jsx)("p",{className:"text-sm font-medium text-center truncate mb-1",children:e.title}),(0,kt.jsxs)("p",{className:"text-xs text-slate-500 text-center",children:[(e.fileSize/1024/1024).toFixed(2)," MB"]}),(0,kt.jsx)("button",{onClick:t=>{t.stopPropagation(),ee(e)},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1 bg-red-50 rounded hover:bg-red-100",children:(0,kt.jsx)(kb,{className:"h-4 w-4 text-red-600"})})]},e.id)})]})})})})]}),H&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)(kb,{className:"h-6 w-6 text-red-600"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Trash"}),(0,kt.jsx)("p",{className:"text-sm text-gray-600",children:"Items will be permanently deleted after 90 days"})]})]}),(0,kt.jsx)("button",{onClick:()=>G(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:(0,kt.jsx)(Rb,{className:"h-5 w-5 text-gray-500"})})]}),(0,kt.jsx)("div",{className:"p-6 max-h-96 overflow-y-auto",children:0===K.length?(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)(kb,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,kt.jsx)("p",{className:"text-gray-500",children:"Trash is empty"})]}):(0,kt.jsx)("div",{className:"grid grid-cols-2 gap-4",children:K.map(e=>(0,kt.jsx)("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:["FOLDER"===e.type?(0,kt.jsx)(bb,{className:"h-8 w-8 text-amber-500"}):(0,kt.jsx)("div",{className:"w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center",children:(0,kt.jsx)("span",{className:"text-lg",children:Ub(e.mimeType,e.title).icon})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.title}),(0,kt.jsxs)("p",{className:"text-xs text-gray-500",children:["Deleted ",new Date(e.deletedAt).toLocaleDateString()]})]})]})},e.id))})})]})}),f&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full",children:[(0,kt.jsx)("h3",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Upload Files"}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select files to upload"}),(0,kt.jsx)("input",{ref:Q,type:"file",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);if(console.log("\ud83d\udcc1 Files selected:",t.map(e=>({name:e.name,size:e.size,type:e.type}))),t.length>0){const e=t.filter(e=>e instanceof File);if(e.length!==t.length)return console.error("\u274c Some files are not File instances"),void qr.error("Invalid file selection. Please try again.");O(e),g(!1),D(!0)}else console.warn("\u26a0\ufe0f No files selected")},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),(0,kt.jsx)("div",{className:"flex gap-3",children:(0,kt.jsx)("button",{onClick:()=>{g(!1),x([]),O([]),Q.current&&(Q.current.value="")},className:"flex-1 px-6 py-3 border-2 border-slate-300 rounded-xl font-medium hover:bg-slate-50 transition",children:"Cancel"})})]})}),(0,kt.jsx)(ts,{visible:m,onClose:()=>p(!1),colorMode:!1}),(0,kt.jsx)(Bb,{isOpen:L,onClose:()=>{D(!1),O([]),Q.current&&(Q.current.value="")},files:M,onConfirm:async e=>{if(console.log("\u2705 FileRenameModal confirmed with files:",e.map(e=>({name:e.name,isFile:e instanceof File,size:e.size}))),!e||0===e.length)return console.error("\u274c No renamed files received"),qr.error("No files to upload"),void D(!1);const t=e.filter(e=>e instanceof File);if(t.length!==e.length)return console.error("\u274c Some renamed files are not File instances"),qr.error("Invalid file objects. Please try uploading again."),D(!1),void O([]);D(!1),await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=e||v;if(console.log("\ud83d\ude80 handleUpload called with:",{filesToUpload:(null===e||void 0===e?void 0:e.length)||e,selectedFiles:(null===v||void 0===v?void 0:v.length)||v,finalFiles:(null===t||void 0===t?void 0:t.length)||t,fileNames:(null===t||void 0===t?void 0:t.map(e=>(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.title)||"no-name"))||[]}),!t||!Array.isArray(t)||0===t.length)return console.error("\u274c No files to upload - aborting"),void qr.error("No files selected for upload");const r=t.filter(e=>!(e instanceof File));if(r.length>0)return console.error("\u274c Invalid file objects:",r),void qr.error("Invalid file objects detected. Please try selecting files again.");y(!0);try{console.log("\ud83d\udce4 Starting upload with files:",t.map(e=>({name:e.name,size:e.size,type:e.type})));const e=await Ma.assetsService.uploadFiles({files:t,parentId:c||null});console.log("\u2705 Upload result:",e),Q.current&&(Q.current.value=""),await $(c),g(!1),x([]),O([]),qr.success("Successfully uploaded ".concat(t.length," file(s)!"))}catch(XI){var n,a,s,o,i,l;console.error("\u274c Upload error details:",{error:XI,message:XI.message,response:null===(n=XI.response)||void 0===n?void 0:n.data,status:null===(a=XI.response)||void 0===a?void 0:a.status,stack:XI.stack});const t=(null===(s=XI.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||(null===(i=XI.response)||void 0===i||null===(l=i.data)||void 0===l?void 0:l.error)||XI.message||"Unknown error occurred";qr.error("Upload failed: ".concat(t))}finally{y(!1)}}(t)},onCancel:()=>{D(!1),O([]),x([]),Q.current&&(Q.current.value="")},colorMode:!1}),(0,kt.jsx)(Oa,{document:P,isOpen:I,onClose:()=>{T(!1),_(null)}}),(0,kt.jsx)(zb,{isOpen:R,onClose:()=>{F(!1),B(null)},onConfirm:async()=>{if(U)try{await Ma.assetsService.bulkOperation({operation:"moveToTrash",assetIds:[U.id]}),await Promise.all([$(c),Z(),te()]),qr.success("".concat("FOLDER"===U.type?"Folder":"File"," moved to trash"))}catch(XI){qr.error("Delete failed")}finally{F(!1),B(null)}},itemName:(null===U||void 0===U?void 0:U.title)||"",itemType:"FOLDER"===(null===U||void 0===U?void 0:U.type)?"folder":"file",colorMode:!1}),(0,kt.jsx)(Wb,{isOpen:z,onClose:()=>{W(!1),V(null)},onConfirm:async e=>{if(q)try{await Ma.assetsService.bulkOperation({operation:"rename",assetIds:[q.id],newName:e,parentId:q.parentId}),await Promise.all([$(c),Z()]),qr.success("Folder renamed successfully")}catch(XI){qr.error("Rename failed")}finally{W(!1),V(null)}},currentName:(null===q||void 0===q?void 0:q.title)||"",colorMode:!1})]})},Vb=e=>{var t;let{colorMode:r,projects:n,onProjectSelect:a,navigationContext:s,previousPage:i}=e;const{pushNavigation:l,goBack:c,canGoBack:d,getPrevious:u}=mi(),{subjects:h}=ri(),m=(0,o.useRef)(null),{isUserOnline:p,getUserStatus:f,isConnected:g}=(()=>{const{socketService:e,isConnected:t}=Zo(),[r,n]=(0,o.useState)(new Map),[a,s]=(0,o.useState)(new Map);(0,o.useEffect)(()=>{if(t){e.updateUserStatus("online");const t=e=>{const{userId:t,status:r,timestamp:a}=e;n(e=>{const n=new Map(e);return"online"===r?n.set(t,!0):"offline"===r?n.delete(t):n.set(t,r),n}),s(e=>{const r=new Map(e);return r.set(t,new Date(a)),r}),console.log("\ud83d\udc64 User ".concat(t," is now ").concat(r))};e.on("userStatus",t);const r=["mousemove","keydown","click","scroll"];let a=null;const o=()=>{a&&clearTimeout(a),e.updateUserStatus("online"),a=setTimeout(()=>{e.updateUserStatus("away")},3e5)};r.forEach(e=>{window.addEventListener(e,o,{passive:!0})});const i=()=>{document.hidden?e.updateUserStatus("away"):e.updateUserStatus("online")};document.addEventListener("visibilitychange",i);const l=()=>{e.updateUserStatus("offline")};return window.addEventListener("beforeunload",l),()=>{e.off("userStatus",t),e.updateUserStatus("offline"),r.forEach(e=>{window.removeEventListener(e,o)}),document.removeEventListener("visibilitychange",i),window.removeEventListener("beforeunload",l),a&&clearTimeout(a)}}},[t,e]);const i=(0,o.useCallback)(e=>r.has(e),[r]),l=(0,o.useCallback)(e=>{const t=r.get(e);return t?!0===t?"online":t:"offline"},[r]),c=(0,o.useCallback)(e=>a.get(e)||null,[a]);return{onlineUsers:r,isUserOnline:i,getUserStatus:l,getLastActivity:c,isConnected:t}})(),[v,x]=(0,o.useState)(null),[b,y]=(0,o.useState)([]),[w,j]=(0,o.useState)(null),[N,S]=(0,o.useState)({}),[k,A]=(0,o.useState)(!0),[C,E]=(0,o.useState)(!1),[P,_]=(0,o.useState)(null),[I,T]=(0,o.useState)(""),[L,D]=(0,o.useState)(!1),[M,O]=(0,o.useState)({unreadBySender:[],conversationRecency:{}}),[R,F]=(0,o.useState)(""),[U,B]=(0,o.useState)(""),[z,W]=(0,o.useState)(""),[q,V]=(0,o.useState)([]),[H,G]=(0,o.useState)(!1),[K,J]=(0,o.useState)(""),[X,Q]=(0,o.useState)(!1);(0,o.useEffect)(()=>{console.log("\ud83d\udd0d MY MESSAGES: Component mounted"),l("My Messages",{projects:n,navigationContext:{pageName:"My Messages",fromPage:(null===s||void 0===s?void 0:s.fromPage)||i||"Dashboard"}})},[l,n,s,i]),(0,o.useEffect)(()=>{const e=Da.authService.getStoredUser();e&&x(e)},[]),(0,o.useEffect)(()=>{v&&(async()=>{try{var e,t,r;A(!0),_(null);const n=await Da.default.get("/users/team-members");if(null!==(e=n.data)&&void 0!==e&&e.success&&null!==(t=n.data)&&void 0!==t&&null!==(r=t.data)&&void 0!==r&&r.teamMembers){const e=n.data.data.teamMembers.filter(e=>e.id!==(null===v||void 0===v?void 0:v.id));y(e),e.length>0&&!w&&j(e[0].id)}else console.warn("No team members found in response"),y([])}catch(XI){console.error("Error fetching team members:",XI),_("Failed to load team members"),y([])}finally{A(!1)}})()},[v,w]),(0,o.useEffect)(()=>{v&&(async()=>{try{var e,t;const r=await Da.default.get("/messages/unread/by-sender");null!==(e=r.data)&&void 0!==e&&e.success&&null!==(t=r.data)&&void 0!==t&&t.data&&O(r.data.data)}catch(XI){console.error("Error fetching unread summary:",XI)}})()},[v]);const Z=(0,o.useCallback)(async e=>{if(e)try{var t,r;E(!0);const n=await Da.default.get("/messages/conversation/".concat(e));if(null!==(t=n.data)&&void 0!==t&&t.success&&null!==(r=n.data)&&void 0!==r&&r.data){const t=n.data.data||[];S(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t.map(e=>{var t;return{id:e.id,fromMe:e.senderId===(null===v||void 0===v?void 0:v.id),text:e.content,timestamp:new Date(e.created_at).toLocaleString(),createdAt:new Date(e.created_at),read:(null===(t=e.readBy)||void 0===t?void 0:t.includes(null===v||void 0===v?void 0:v.id))||e.senderId===(null===v||void 0===v?void 0:v.id),sender:e.sender}})}))}}catch(XI){console.error("Error fetching conversation:",XI),S(t=>(0,Y.A)((0,Y.A)({},t),{},{[e]:[]}))}finally{E(!1)}},[v]);(0,o.useEffect)(()=>{w&&v&&Z(w)},[w,v,Z]),(0,o.useEffect)(()=>{m.current&&m.current.scrollIntoView({behavior:"smooth"})},[N,w]);const $=b.find(e=>e.id===w),ee=N[w]||[],te=o.useMemo(()=>{const e={};(M.unreadBySender||[]).forEach(t=>{e[t.senderId]={unreadCount:t.unreadCount,lastMessageAt:new Date(t.lastMessageAt)}});const t=M.conversationRecency||{};return b.map(r=>{const n=e[r.id],a=N[r.id]||[],s=a.filter(e=>!e.fromMe&&!e.read).length,o=a.length>0?a[a.length-1]:null,i=n?n.unreadCount>0:s>0,l=n?n.unreadCount:s;let c;return c=t[r.id]?new Date(t[r.id]):null!==o&&void 0!==o&&o.createdAt?o.createdAt:new Date(0),(0,Y.A)((0,Y.A)({},r),{},{hasUnread:i,unreadCount:l,lastMessageAt:c})}).sort((e,t)=>{const r=e.hasUnread?1:0,n=t.hasUnread?1:0;return r!==n?n-r:t.lastMessageAt-e.lastMessageAt})},[b,N,M]),re=e=>{if(!e)return"Unknown User";return"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||e.email||"Unknown User"},ne=e=>{var t,r,n,a;if(!e)return"?";return(((null===(t=e.firstName)||void 0===t?void 0:t.charAt(0))||"")+((null===(r=e.lastName)||void 0===r?void 0:r.charAt(0))||"")).toUpperCase()||(null===(n=e.email)||void 0===n||null===(a=n.charAt(0))||void 0===a?void 0:a.toUpperCase())||"?"},ae=e=>{switch(f(e)){case"online":return{color:"bg-green-500",label:"Online",pulse:!0};case"away":return{color:"bg-yellow-500",label:"Away",pulse:!1};case"busy":return{color:"bg-red-500",label:"Busy",pulse:!1};default:return{color:"bg-gray-400",label:"Offline",pulse:!1}}};return(0,kt.jsxs)("div",{className:"h-[calc(100vh-100px)] w-full flex flex-col overflow-hidden ".concat(r?"bg-slate-900":"bg-gray-50"),children:[(0,kt.jsxs)("div",{className:"flex-shrink-0 px-2 pt-1 pb-1 ".concat(r?"bg-slate-900":"bg-gray-50"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)(Di,{colorMode:r,variant:"secondary",preservePosition:!0,onClick:()=>{if(null===s||void 0===s?void 0:s.isMenuNavigation){const e=null===s||void 0===s?void 0:s.fromPage;if(e&&"Project Messages"!==e)return void(a?a(null,e):window.location.href="/")}if(d()){c()||(a?a(null,"Overview"):window.location.href="/")}else a?a(null,"Overview"):window.location.href="/"},showNavigationInfo:!0,navigationContext:{currentPage:"My Messages",canGoBack:d(),previousPage:(null===(t=u())||void 0===t?void 0:t.pageName)||(null===s||void 0===s?void 0:s.fromPage)||i||"Dashboard"}}),(0,kt.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium ".concat(g?"bg-green-100 text-green-700 border border-green-200":"bg-yellow-100 text-yellow-700 border border-yellow-200"),children:[(0,kt.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(g?"bg-green-500 animate-pulse":"bg-yellow-500")}),g?"Live":"Connecting..."]})]}),P&&(0,kt.jsxs)("div",{className:"mt-2 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm",children:[P,(0,kt.jsx)("button",{onClick:()=>_(null),className:"ml-4 text-red-500 hover:text-red-700",children:"Dismiss"})]})]}),(0,kt.jsx)("div",{className:"flex-1 min-h-0 px-4 pb-4",children:k?(0,kt.jsxs)("div",{className:"flex items-center justify-center h-full",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,kt.jsx)("span",{className:"ml-3 ".concat(r?"text-gray-300":"text-gray-600"),children:"Loading team members..."})]}):0===b.length?(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full ".concat(r?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)("div",{className:"text-5xl mb-4",children:"\ud83d\udc65"}),(0,kt.jsx)("p",{className:"text-lg font-medium",children:"No team members found"}),(0,kt.jsx)("p",{className:"text-sm",children:"Add team members to start messaging"})]}):(0,kt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 h-full",children:[(0,kt.jsxs)("div",{className:"flex flex-col border-t-4 border-blue-400 shadow-[0_2px_8px_rgba(0,0,0,0.1)] rounded-[8px] ".concat(r?"bg-[#232b4d]/80":"bg-white"," overflow-hidden"),children:[(0,kt.jsx)("div",{className:"flex-shrink-0 p-4 border-b ".concat(r?"border-gray-600":"border-gray-200"),children:(0,kt.jsxs)("h3",{className:"text-sm font-semibold ".concat(r?"text-white":"text-gray-800"),children:["Team Members (",b.length,")"]})}),(0,kt.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto custom-scrollbar p-4 space-y-2",children:te.map(e=>{const t=e.unreadCount,n=ae(e.id),a=e.hasUnread;return(0,kt.jsxs)("button",{onClick:()=>j(e.id),className:"w-full text-left p-3 rounded-lg transition-all duration-200 relative ".concat(w===e.id?r?"bg-[var(--color-primary-blueprint-blue)]/20 border border-blue-500/30":"bg-blue-50 border border-blue-200":a?r?"bg-red-500/10 border border-red-500/30 hover:bg-red-500/20":"bg-red-50 border border-red-200 hover:bg-red-100":r?"hover:bg-gray-700/30 border border-transparent":"hover:bg-gray-50 border border-transparent"," ").concat(a?"shadow-md":""),children:[a&&(0,kt.jsx)("div",{className:"absolute right-2 top-2 w-3 h-3 bg-red-500 rounded-full animate-pulse shadow-lg"}),(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"relative",children:[e.avatar?(0,kt.jsx)("img",{src:e.avatar,alt:re(e),className:"w-8 h-8 rounded-full object-cover ".concat(a?"ring-2 ring-red-500 ring-offset-1":"")}):(0,kt.jsx)("div",{className:"w-8 h-8 bg-[#F8FAFC] rounded-full flex items-center justify-center text-white text-sm font-medium ".concat(a?"ring-2 ring-red-500 ring-offset-1":""),children:ne(e)}),(0,kt.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 ".concat(r?"border-[#232b4d]":"border-white"," ").concat(n.color," ").concat(n.pulse?"animate-pulse":""),title:n.label})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-sm ".concat(a?"font-semibold":""," ").concat(r?"text-white":"text-gray-900"),children:re(e)}),(0,kt.jsxs)("div",{className:"text-xs flex items-center gap-1 ".concat(r?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)("span",{children:e.role||"Team Member"}),(0,kt.jsx)("span",{className:"text-[10px]",children:"\u2022"}),(0,kt.jsx)("span",{className:"text-[10px] ".concat("Online"===n.label?"text-green-500":"Away"===n.label?"text-yellow-500":"text-gray-400"),children:n.label})]})]})]}),t>0&&(0,kt.jsx)("div",{className:"flex flex-col items-center",children:(0,kt.jsx)("div",{className:"bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center shadow-lg",children:t>9?"9+":t})})]})]},e.id)})})]}),(0,kt.jsxs)("div",{className:"lg:col-span-2 flex flex-col border-t-4 border-blue-400 shadow-[0_2px_8px_rgba(0,0,0,0.1)] rounded-[8px] ".concat(r?"bg-[#232b4d]/80":"bg-white"," overflow-hidden"),children:[(0,kt.jsx)("div",{className:"flex-shrink-0 p-4 border-b ".concat(r?"border-gray-600":"border-gray-200"),children:$?(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsxs)("div",{className:"relative",children:[$.avatar?(0,kt.jsx)("img",{src:$.avatar,alt:re($),className:"w-10 h-10 rounded-full object-cover"}):(0,kt.jsx)("div",{className:"w-10 h-10 bg-[#F8FAFC] rounded-full flex items-center justify-center text-white font-medium",children:ne($)}),(()=>{const e=ae($.id);return(0,kt.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-2 ".concat(r?"border-[#232b4d]":"border-white"," ").concat(e.color," ").concat(e.pulse?"animate-pulse":""),title:e.label})})()]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"font-semibold ".concat(r?"text-white":"text-gray-900"),children:re($)}),(0,kt.jsxs)("p",{className:"text-xs flex items-center gap-1 ".concat(r?"text-gray-400":"text-gray-500"),children:[(0,kt.jsx)("span",{children:$.role||"Team Member"}),(0,kt.jsx)("span",{children:"\u2022"}),(()=>{const e=ae($.id);return(0,kt.jsx)("span",{className:"font-medium ".concat("Online"===e.label?"text-green-500":"Away"===e.label?"text-yellow-500":"text-gray-400"),children:e.label})})(),(0,kt.jsx)("span",{children:"\u2022"}),(0,kt.jsx)("span",{children:$.email})]})]})]}):(0,kt.jsx)("div",{className:"".concat(r?"text-gray-400":"text-gray-500"),children:"Select a team member to start chatting"})}),(0,kt.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto custom-scrollbar p-4",children:C?(0,kt.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===ee.length?(0,kt.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,kt.jsx)("div",{className:"text-4xl mb-3",children:"\ud83d\udcac"}),(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(r?"text-gray-300":"text-gray-600"," mb-2"),children:"No messages yet"}),(0,kt.jsxs)("div",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-500"),children:["Start a conversation with ",re($)]})]}):(0,kt.jsxs)("div",{className:"space-y-4",children:[ee.map((e,t)=>(0,kt.jsx)("div",{className:"flex ".concat(e.fromMe?"justify-end":"justify-start"),children:(0,kt.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(e.fromMe?"bg-[var(--color-primary-blueprint-blue)] text-white":r?"bg-gray-700 text-gray-200":"bg-gray-200 text-gray-800"),children:[(0,kt.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.text}),(0,kt.jsx)("p",{className:"text-xs mt-1 opacity-75",children:e.timestamp})]})},e.id||t)),(0,kt.jsx)("div",{ref:m})]})}),$&&(0,kt.jsxs)("div",{className:"flex-shrink-0 p-4 border-t ".concat(r?"border-gray-600":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,kt.jsx)("button",{onClick:()=>Q(!1),className:"px-3 py-2 rounded-lg text-xs font-medium transition-colors ".concat(X?r?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300":"bg-[var(--color-primary-blueprint-blue)] text-white"),children:"Quick Message"}),(0,kt.jsx)("button",{onClick:()=>Q(!0),className:"px-3 py-2 rounded-lg text-xs font-medium transition-colors ".concat(X?"bg-[var(--color-primary-blueprint-blue)] text-white":r?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Project Message"})]}),X?(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),R&&U&&z.trim()&&0!==q.length)try{D(!0);const e=q.map(e=>"all"===e?Promise.resolve():Da.default.post("/messages",{content:"**".concat(U,"**\n\n").concat(z.trim()),type:"DIRECT",recipientId:e,projectId:R,priority:"MEDIUM"}));await Promise.all(e),F(""),B(""),W(""),V([]),G(!1),J(""),Q(!1),q.includes(w)&&Z(w),alert("Project message sent successfully!")}catch(XI){console.error("Error sending project message:",XI),alert("Failed to send message. Please try again.")}finally{D(!1)}},className:"space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:["Project ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{value:R,onChange:e=>F(e.target.value),required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(r?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Select Project"}),(n||[]).map(e=>(0,kt.jsxs)("option",{value:e.id,children:["#",String(e.projectNumber||e.id).padStart(5,"0")," - ",e.projectName||e.name||e.address]},e.id))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:["To ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("select",{value:q||"",onChange:e=>{const t=Array.from(e.target.selectedOptions,e=>e.value);V(t)},multiple:!0,required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(r?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),style:{minHeight:"40px"},children:b.map(e=>(0,kt.jsx)("option",{value:e.id,children:re(e)},e.id))}),(0,kt.jsx)("p",{className:"text-[10px] mt-1 ".concat(r?"text-gray-400":"text-gray-500"),children:"Hold Ctrl/Cmd to select multiple recipients"})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:["Subject ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"text",placeholder:"Enter subject line...",value:U,onChange:e=>B(e.target.value),required:!0,className:"w-full px-2 py-1 border rounded text-xs ".concat(r?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("input",{type:"checkbox",checked:H||!1,onChange:e=>G(e.target.checked),className:"mr-1"}),"Send as a Task"]}),H&&(0,kt.jsxs)("select",{value:K||"",onChange:e=>J(e.target.value),className:"w-full px-2 py-1 border rounded text-xs ".concat(r?"bg-[#232b4d] border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"),children:[(0,kt.jsx)("option",{value:"",children:"Assign Task To..."}),b.map(e=>(0,kt.jsx)("option",{value:e.id,children:re(e)},e.id))]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-medium mb-1 ".concat(r?"text-gray-300":"text-gray-700"),children:["Message ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("textarea",{value:z,onChange:e=>W(e.target.value),placeholder:"Enter your message here...",required:!0,rows:2,className:"w-full px-2 py-1 border rounded text-xs resize-none ".concat(r?"bg-[#232b4d] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500")})]}),(0,kt.jsxs)("div",{className:"flex justify-end gap-1.5 pt-1",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{F(""),B(""),W(""),V([]),G(!1),J(""),Q(!1)},className:"px-3 py-1.5 text-xs font-medium rounded border transition-colors ".concat(r?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:!R||!U||!z.trim()||0===q.length||L,className:"px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(R&&U&&z.trim()&&q.length>0&&!L?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:L?"Sending...":"Send Message"})]})]}):(0,kt.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(async()=>{if(I.trim()&&w&&!L)try{var e;D(!0);const a=await Da.default.post("/messages",{content:I.trim(),type:"DIRECT",recipientId:w,priority:"MEDIUM"});if(null!==(e=a.data)&&void 0!==e&&e.success){var t,r;const e={id:(null===(t=a.data.data)||void 0===t||null===(r=t.message)||void 0===r?void 0:r.id)||Date.now(),fromMe:!0,text:I.trim(),timestamp:(new Date).toLocaleString(),createdAt:new Date,read:!0};S(t=>(0,Y.A)((0,Y.A)({},t),{},{[w]:[...t[w]||[],e]})),T("")}else{var n;console.error("Failed to send message:",null===(n=a.data)||void 0===n?void 0:n.message),alert("Failed to send message. Please try again.")}}catch(XI){console.error("Error sending message:",XI),alert("Failed to send message. Please try again.")}finally{D(!1)}})()},className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"text",value:I,onChange:e=>T(e.target.value),placeholder:"Message ".concat(re($),"..."),disabled:L,className:"flex-1 px-3 py-2 rounded-lg border text-sm ".concat(r?"bg-[#1e293b] border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800 placeholder-gray-500"," ").concat(L?"opacity-50":"")}),(0,kt.jsx)("button",{type:"submit",disabled:!I.trim()||L,className:"px-4 py-2 rounded-lg font-medium text-sm transition-colors ".concat(I.trim()&&!L?"bg-[var(--color-primary-blueprint-blue)] text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:L?"Sending...":"Send"})]})]})]})]})})]})};function Hb(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"12"},child:[]},{tag:"line",attr:{x1:"12",y1:"16",x2:"12.01",y2:"16"},child:[]}]})(e)}function Gb(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"},child:[]}]})(e)}function Kb(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"polyline",attr:{points:"12 6 12 12 16 14"},child:[]}]})(e)}function Jb(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"7 10 12 15 17 10"},child:[]},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"},child:[]}]})(e)}function Yb(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"},child:[]},{tag:"polyline",attr:{points:"15 3 21 3 21 9"},child:[]},{tag:"line",attr:{x1:"10",y1:"14",x2:"21",y2:"3"},child:[]}]})(e)}function Xb(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"},child:[]},{tag:"polyline",attr:{points:"22,6 12,13 2,6"},child:[]}]})(e)}function Qb(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"},child:[]}]})(e)}function Zb(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 4 23 10 17 10"},child:[]},{tag:"polyline",attr:{points:"1 20 1 14 7 14"},child:[]},{tag:"path",attr:{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"},child:[]}]})(e)}function $b(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"},child:[]}]})(e)}function ey(e){return Cg({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"},child:[]},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"},child:[]}]})(e)}function ty(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function ry(e){return ty(e,Date.now())}function ny(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"===typeof e&&"[object Date]"===t?new e.constructor(+e):"number"===typeof e||"[object Number]"===t||"string"===typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function ay(e,t){const r=ny(e),n=ny(t),a=r.getTime()-n.getTime();return a<0?-1:a>0?1:a}Math.pow(10,8);const sy=6048e5,oy=43200;function iy(e,t){const r=ny(e),n=ny(t);return 12*(r.getFullYear()-n.getFullYear())+(r.getMonth()-n.getMonth())}function ly(e){const t=ny(e);return t.setHours(23,59,59,999),t}function cy(e){const t=ny(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function dy(e){const t=ny(e);return+ly(t)===+cy(t)}function uy(e,t){const r=ny(e),n=ny(t),a=ay(r,n),s=Math.abs(iy(r,n));let o;if(s<1)o=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-a*s);let t=ay(r,n)===-a;dy(ny(e))&&1===s&&1===ay(e,n)&&(t=!1),o=a*(s-Number(t))}return 0===o?0:o}function hy(e,t){return+ny(e)-+ny(t)}function my(e,t,r){const n=hy(e,t)/1e3;return(a=null===r||void 0===r?void 0:r.roundingMethod,e=>{const t=(a?Math[a]:Math.trunc)(e);return 0===t?0:t})(n);var a}const py={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function fy(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const gy={date:fy({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:fy({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:fy({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},vy={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function xy(e){return(t,r)=>{let n;if("formatting"===(null!==r&&void 0!==r&&r.context?String(r.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,a=null!==r&&void 0!==r&&r.width?String(r.width):t;n=e.formattingValues[a]||e.formattingValues[t]}else{const t=e.defaultWidth,a=null!==r&&void 0!==r&&r.width?String(r.width):e.defaultWidth;n=e.values[a]||e.values[t]}return n[e.argumentCallback?e.argumentCallback(t):t]}}const by={ordinalNumber:(e,t)=>{const r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:xy({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:xy({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:xy({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:xy({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:xy({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function yy(e){return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=r.width,a=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],s=t.match(a);if(!s)return null;const o=s[0],i=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(i)?function(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r;return}(i,e=>e.test(o)):function(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r;return}(i,e=>e.test(o));let c;c=e.valueCallback?e.valueCallback(l):l,c=r.valueCallback?r.valueCallback(c):c;return{value:c,rest:t.slice(o.length)}}}const wy={ordinalNumber:(jy={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.match(jy.matchPattern);if(!r)return null;const n=r[0],a=e.match(jy.parsePattern);if(!a)return null;let s=jy.valueCallback?jy.valueCallback(a[0]):a[0];return s=t.valueCallback?t.valueCallback(s):s,{value:s,rest:e.slice(n.length)}}),era:yy({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:yy({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:yy({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:yy({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:yy({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})};var jy;const Ny={code:"en-US",formatDistance:(e,t,r)=>{let n;const a=py[e];return n="string"===typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),null!==r&&void 0!==r&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n},formatLong:gy,formatRelative:(e,t,r,n)=>vy[e],localize:by,match:wy,options:{weekStartsOn:0,firstWeekContainsDate:1}};let Sy={};function ky(){return Sy}function Ay(e){const t=ny(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function Cy(e,t,r){var n,a;const s=ky(),o=null!==(n=null!==(a=null===r||void 0===r?void 0:r.locale)&&void 0!==a?a:s.locale)&&void 0!==n?n:Ny,i=ay(e,t);if(isNaN(i))throw new RangeError("Invalid time value");const l=Object.assign({},r,{addSuffix:null===r||void 0===r?void 0:r.addSuffix,comparison:i});let c,d;i>0?(c=ny(t),d=ny(e)):(c=ny(e),d=ny(t));const u=my(d,c),h=(Ay(d)-Ay(c))/1e3,m=Math.round((u-h)/60);let p;if(m<2)return null!==r&&void 0!==r&&r.includeSeconds?u<5?o.formatDistance("lessThanXSeconds",5,l):u<10?o.formatDistance("lessThanXSeconds",10,l):u<20?o.formatDistance("lessThanXSeconds",20,l):u<40?o.formatDistance("halfAMinute",0,l):u<60?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",1,l):0===m?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",m,l);if(m<45)return o.formatDistance("xMinutes",m,l);if(m<90)return o.formatDistance("aboutXHours",1,l);if(m<1440){const e=Math.round(m/60);return o.formatDistance("aboutXHours",e,l)}if(m<2520)return o.formatDistance("xDays",1,l);if(m<oy){const e=Math.round(m/1440);return o.formatDistance("xDays",e,l)}if(m<86400)return p=Math.round(m/oy),o.formatDistance("aboutXMonths",p,l);if(p=uy(d,c),p<12){const e=Math.round(m/oy);return o.formatDistance("xMonths",e,l)}{const e=p%12,t=Math.trunc(p/12);return e<3?o.formatDistance("aboutXYears",t,l):e<9?o.formatDistance("overXYears",t,l):o.formatDistance("almostXYears",t+1,l)}}function Ey(e,t){return Cy(e,ry(e),t)}const Py=e=>{let{emails:t,onEmailClick:r,loading:n,emptyMessage:a}=e;if(n)return(0,kt.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-aqua-blue"})});if(!t||0===t.length)return(0,kt.jsxs)("div",{className:"text-center py-12",children:[(0,kt.jsx)(Xb,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,kt.jsx)("p",{className:"text-gray-500",children:a||"No emails found"})]});const s=e=>{switch(e){case"delivered":case"opened":return(0,kt.jsx)(Gb,{className:"text-semantic-success"});case"failed":case"bounced":return(0,kt.jsx)(Hb,{className:"text-semantic-danger"});default:return(0,kt.jsx)(Kb,{className:"text-brand-aqua-blue"})}},o=e=>{switch(e){case"delivered":return"bg-green-100 text-green-800";case"opened":return"bg-blue-100 text-blue-800";case"failed":case"bounced":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,kt.jsx)("div",{className:"space-y-3",children:t.map(e=>{var t,n,a,i,l;return(0,kt.jsx)("div",{onClick:()=>r&&r(e),className:"bg-white rounded-lg border border-border-silver p-4 hover:border-brand-aqua-blue hover:shadow-soft transition-all cursor-pointer",children:(0,kt.jsx)("div",{className:"flex items-start justify-between",children:(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:null!==(t=e.sender)&&void 0!==t&&t.avatar?(0,kt.jsx)("img",{src:e.sender.avatar,alt:e.senderName,className:"w-10 h-10 rounded-full"}):(0,kt.jsx)("div",{className:"w-10 h-10 rounded-full bg-[#F8FAFC] flex items-center justify-center text-white font-semibold",children:(null===(n=e.senderName)||void 0===n?void 0:n.charAt(0))||(null===(a=e.senderEmail)||void 0===a?void 0:a.charAt(0))||"U"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"font-semibold text-text-charcoal",children:e.senderName||e.senderEmail}),(0,kt.jsx)("span",{className:"text-xs text-text-light-gray",children:Ey(new Date(e.createdAt),{addSuffix:!0})})]}),(0,kt.jsxs)("div",{className:"text-sm text-text-light-gray",children:["to ",(null===(i=e.toEmails)||void 0===i?void 0:i.join(", "))||"recipients"]})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[s(e.status),(0,kt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(o(e.status)),children:e.status})]})]}),(0,kt.jsx)("h4",{className:"font-semibold text-text-charcoal mb-1 truncate",children:e.subject}),e.bodyText&&(0,kt.jsxs)("p",{className:"text-sm text-text-light-gray line-clamp-2 mb-2",children:[e.bodyText.substring(0,150),"..."]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 text-xs text-text-light-gray",children:[(0,kt.jsx)("span",{className:"px-2 py-1 bg-brand-aqua-blue-light-tint text-brand-aqua-blue rounded-full",children:(l=e.emailType,{project_update:"Project Update",customer_communication:"Customer",team_communication:"Team",bubbles_ai:"AI Assistant",general:"General",notification:"Notification",system:"System"}[l]||l)}),e.project&&(0,kt.jsxs)("span",{className:"flex items-center gap-1",children:[(0,kt.jsx)("span",{className:"font-medium",children:"Project:"}),e.project.projectName]}),e.customer&&(0,kt.jsxs)("span",{className:"flex items-center gap-1",children:[(0,kt.jsx)("span",{className:"font-medium",children:"Customer:"}),e.customer.primaryName]}),e.attachments&&e.attachments.length>0&&(0,kt.jsxs)("span",{className:"flex items-center gap-1",children:[(0,kt.jsx)(Qb,{className:"w-3 h-3"}),e.attachments.length," attachment",1!==e.attachments.length?"s":""]})]})]})})},e.id)})})};function _y(e){const t=ny(e);return t.setHours(0,0,0,0),t}function Iy(e,t){const r=_y(e),n=_y(t),a=+r-Ay(r),s=+n-Ay(n);return Math.round((a-s)/864e5)}function Ty(e){const t=ny(e),r=ty(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function Ly(e){const t=ny(e);return Iy(t,Ty(t))+1}function Dy(e,t){var r,n,a,s,o,i;const l=ky(),c=null!==(r=null!==(n=null!==(a=null!==(s=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==s?s:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==a?a:l.weekStartsOn)&&void 0!==n?n:null===(i=l.locale)||void 0===i||null===(i=i.options)||void 0===i?void 0:i.weekStartsOn)&&void 0!==r?r:0,d=ny(e),u=d.getDay(),h=(u<c?7:0)+u-c;return d.setDate(d.getDate()-h),d.setHours(0,0,0,0),d}function My(e){return Dy(e,{weekStartsOn:1})}function Oy(e){const t=ny(e),r=t.getFullYear(),n=ty(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const a=My(n),s=ty(e,0);s.setFullYear(r,0,4),s.setHours(0,0,0,0);const o=My(s);return t.getTime()>=a.getTime()?r+1:t.getTime()>=o.getTime()?r:r-1}function Ry(e){const t=Oy(e),r=ty(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),My(r)}function Fy(e){const t=ny(e),r=+My(t)-+Ry(t);return Math.round(r/sy)+1}function Uy(e,t){var r,n,a,s,o,i;const l=ny(e),c=l.getFullYear(),d=ky(),u=null!==(r=null!==(n=null!==(a=null!==(s=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==s?s:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==a?a:d.firstWeekContainsDate)&&void 0!==n?n:null===(i=d.locale)||void 0===i||null===(i=i.options)||void 0===i?void 0:i.firstWeekContainsDate)&&void 0!==r?r:1,h=ty(e,0);h.setFullYear(c+1,0,u),h.setHours(0,0,0,0);const m=Dy(h,t),p=ty(e,0);p.setFullYear(c,0,u),p.setHours(0,0,0,0);const f=Dy(p,t);return l.getTime()>=m.getTime()?c+1:l.getTime()>=f.getTime()?c:c-1}function By(e,t){var r,n,a,s,o,i;const l=ky(),c=null!==(r=null!==(n=null!==(a=null!==(s=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==s?s:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==a?a:l.firstWeekContainsDate)&&void 0!==n?n:null===(i=l.locale)||void 0===i||null===(i=i.options)||void 0===i?void 0:i.firstWeekContainsDate)&&void 0!==r?r:1,d=Uy(e,t),u=ty(e,0);u.setFullYear(d,0,c),u.setHours(0,0,0,0);return Dy(u,t)}function zy(e,t){const r=ny(e),n=+Dy(r,t)-+By(r,t);return Math.round(n/sy)+1}function Wy(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const qy={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return Wy("yy"===t?n%100:n,t.length)},M(e,t){const r=e.getMonth();return"M"===t?String(r+1):Wy(r+1,2)},d:(e,t)=>Wy(e.getDate(),t.length),a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];default:return"am"===r?"a.m.":"p.m."}},h:(e,t)=>Wy(e.getHours()%12||12,t.length),H:(e,t)=>Wy(e.getHours(),t.length),m:(e,t)=>Wy(e.getMinutes(),t.length),s:(e,t)=>Wy(e.getSeconds(),t.length),S(e,t){const r=t.length,n=e.getMilliseconds();return Wy(Math.trunc(n*Math.pow(10,r-3)),t.length)}},Vy="midnight",Hy="noon",Gy="morning",Ky="afternoon",Jy="evening",Yy="night",Xy={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if("yo"===t){const t=e.getFullYear(),n=t>0?t:1-t;return r.ordinalNumber(n,{unit:"year"})}return qy.y(e,t)},Y:function(e,t,r,n){const a=Uy(e,n),s=a>0?a:1-a;if("YY"===t){return Wy(s%100,2)}return"Yo"===t?r.ordinalNumber(s,{unit:"year"}):Wy(s,t.length)},R:function(e,t){return Wy(Oy(e),t.length)},u:function(e,t){return Wy(e.getFullYear(),t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return Wy(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return Wy(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return qy.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return Wy(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const a=zy(e,n);return"wo"===t?r.ordinalNumber(a,{unit:"week"}):Wy(a,t.length)},I:function(e,t,r){const n=Fy(e);return"Io"===t?r.ordinalNumber(n,{unit:"week"}):Wy(n,t.length)},d:function(e,t,r){return"do"===t?r.ordinalNumber(e.getDate(),{unit:"date"}):qy.d(e,t)},D:function(e,t,r){const n=Ly(e);return"Do"===t?r.ordinalNumber(n,{unit:"dayOfYear"}):Wy(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const a=e.getDay(),s=(a-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return Wy(s,2);case"eo":return r.ordinalNumber(s,{unit:"day"});case"eee":return r.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(a,{width:"short",context:"formatting"});default:return r.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const a=e.getDay(),s=(a-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return Wy(s,t.length);case"co":return r.ordinalNumber(s,{unit:"day"});case"ccc":return r.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(a,{width:"narrow",context:"standalone"});case"cccccc":return r.day(a,{width:"short",context:"standalone"});default:return r.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),a=0===n?7:n;switch(t){case"i":return String(a);case"ii":return Wy(a,t.length);case"io":return r.ordinalNumber(a,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let a;switch(a=12===n?Hy:0===n?Vy:n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(a,{width:"narrow",context:"formatting"});default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let a;switch(a=n>=17?Jy:n>=12?Ky:n>=4?Gy:Yy,t){case"B":case"BB":case"BBB":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(a,{width:"narrow",context:"formatting"});default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,r){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),r.ordinalNumber(t,{unit:"hour"})}return qy.h(e,t)},H:function(e,t,r){return"Ho"===t?r.ordinalNumber(e.getHours(),{unit:"hour"}):qy.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return"Ko"===t?r.ordinalNumber(n,{unit:"hour"}):Wy(n,t.length)},k:function(e,t,r){let n=e.getHours();return 0===n&&(n=24),"ko"===t?r.ordinalNumber(n,{unit:"hour"}):Wy(n,t.length)},m:function(e,t,r){return"mo"===t?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):qy.m(e,t)},s:function(e,t,r){return"so"===t?r.ordinalNumber(e.getSeconds(),{unit:"second"}):qy.s(e,t)},S:function(e,t){return qy.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(0===n)return"Z";switch(t){case"X":return Zy(n);case"XXXX":case"XX":return $y(n);default:return $y(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return Zy(n);case"xxxx":case"xx":return $y(n);default:return $y(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Qy(n,":");default:return"GMT"+$y(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Qy(n,":");default:return"GMT"+$y(n,":")}},t:function(e,t,r){return Wy(Math.trunc(e.getTime()/1e3),t.length)},T:function(e,t,r){return Wy(e.getTime(),t.length)}};function Qy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=e>0?"-":"+",n=Math.abs(e),a=Math.trunc(n/60),s=n%60;return 0===s?r+String(a):r+String(a)+t+Wy(s,2)}function Zy(e,t){if(e%60===0){return(e>0?"-":"+")+Wy(Math.abs(e)/60,2)}return $y(e,t)}function $y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=e>0?"-":"+",n=Math.abs(e);return r+Wy(Math.trunc(n/60),2)+t+Wy(n%60,2)}const ew=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},tw=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},rw={p:tw,P:(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],a=r[2];if(!a)return ew(e,t);let s;switch(n){case"P":s=t.dateTime({width:"short"});break;case"PP":s=t.dateTime({width:"medium"});break;case"PPP":s=t.dateTime({width:"long"});break;default:s=t.dateTime({width:"full"})}return s.replace("{{date}}",ew(n,t)).replace("{{time}}",tw(a,t))}},nw=/^D+$/,aw=/^Y+$/,sw=["D","DD","YY","YYYY"];function ow(e){return e instanceof Date||"object"===typeof e&&"[object Date]"===Object.prototype.toString.call(e)}function iw(e){if(!ow(e)&&"number"!==typeof e)return!1;const t=ny(e);return!isNaN(Number(t))}const lw=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,cw=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,dw=/^'([^]*?)'?$/,uw=/''/g,hw=/[a-zA-Z]/;function mw(e,t,r){var n,a,s,o,i,l,c,d,u,h,m,p,f,g;const v=ky(),x=null!==(n=null!==(a=null===r||void 0===r?void 0:r.locale)&&void 0!==a?a:v.locale)&&void 0!==n?n:Ny,b=null!==(s=null!==(o=null!==(i=null!==(l=null===r||void 0===r?void 0:r.firstWeekContainsDate)&&void 0!==l?l:null===r||void 0===r||null===(c=r.locale)||void 0===c||null===(c=c.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==i?i:v.firstWeekContainsDate)&&void 0!==o?o:null===(d=v.locale)||void 0===d||null===(d=d.options)||void 0===d?void 0:d.firstWeekContainsDate)&&void 0!==s?s:1,y=null!==(u=null!==(h=null!==(m=null!==(p=null===r||void 0===r?void 0:r.weekStartsOn)&&void 0!==p?p:null===r||void 0===r||null===(f=r.locale)||void 0===f||null===(f=f.options)||void 0===f?void 0:f.weekStartsOn)&&void 0!==m?m:v.weekStartsOn)&&void 0!==h?h:null===(g=v.locale)||void 0===g||null===(g=g.options)||void 0===g?void 0:g.weekStartsOn)&&void 0!==u?u:0,w=ny(e);if(!iw(w))throw new RangeError("Invalid time value");let j=t.match(cw).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,rw[t])(e,x.formatLong)}return e}).join("").match(lw).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:pw(e)};if(Xy[t])return{isToken:!0,value:e};if(t.match(hw))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});x.localize.preprocessor&&(j=x.localize.preprocessor(w,j));const N={firstWeekContainsDate:b,weekStartsOn:y,locale:x};return j.map(n=>{if(!n.isToken)return n.value;const a=n.value;(null!==r&&void 0!==r&&r.useAdditionalWeekYearTokens||!function(e){return aw.test(e)}(a))&&(null!==r&&void 0!==r&&r.useAdditionalDayOfYearTokens||!function(e){return nw.test(e)}(a))||function(e,t,r){const n=function(e,t,r){const n="Y"===e[0]?"years":"days of the month";return"Use `".concat(e.toLowerCase(),"` instead of `").concat(e,"` (in `").concat(t,"`) for formatting ").concat(n," to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md")}(e,t,r);if(console.warn(n),sw.includes(e))throw new RangeError(n)}(a,t,String(e));return(0,Xy[a[0]])(w,a,x.localize,N)}).join("")}function pw(e){const t=e.match(dw);return t?t[1].replace(uw,"'"):e}const fw=e=>{var t,r,n;let{emailId:a,email:s,onClose:i}=e;const[l,c]=(0,o.useState)(s),[d,u]=(0,o.useState)(!s),[h,m]=(0,o.useState)(null);(0,o.useEffect)(()=>{!s&&a&&p()},[a,s]);const p=async()=>{try{u(!0);const e=localStorage.getItem("token"),t=await fetch("/api/email/".concat(a),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw new Error("Failed to fetch email details");const r=await t.json();c(r.data)}catch(XI){m(XI.message)}finally{u(!1)}};return l||d?(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-silver bg-[#F8FAFC]",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 text-white",children:[(0,kt.jsx)(Xb,{className:"w-6 h-6"}),(0,kt.jsx)("h2",{className:"text-xl font-bold",children:"Email Details"})]}),(0,kt.jsx)("button",{onClick:i,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors",children:(0,kt.jsx)(ey,{className:"w-6 h-6"})})]}),(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:d?(0,kt.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-aqua-blue"})}):h?(0,kt.jsxs)("div",{className:"text-center py-12",children:[(0,kt.jsx)(Hb,{className:"mx-auto h-12 w-12 text-semantic-danger mb-4"}),(0,kt.jsx)("p",{className:"text-semantic-danger",children:h})]}):l?(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsxs)("div",{className:"bg-background-ash rounded-lg p-4 space-y-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"text-sm font-semibold text-text-light-gray block mb-1",children:"Subject"}),(0,kt.jsx)("h3",{className:"text-xl font-bold text-text-charcoal",children:l.subject})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold text-text-light-gray w-20",children:"From:"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[null!==(t=l.sender)&&void 0!==t&&t.avatar?(0,kt.jsx)("img",{src:l.sender.avatar,alt:l.senderName,className:"w-8 h-8 rounded-full"}):(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#F8FAFC] flex items-center justify-center text-white text-sm font-semibold",children:(null===(r=l.senderName)||void 0===r?void 0:r.charAt(0))||"U"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-text-charcoal",children:l.senderName}),(0,kt.jsx)("div",{className:"text-sm text-text-light-gray",children:l.senderEmail})]})]})]}),(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold text-text-light-gray w-20 pt-1",children:"To:"}),(0,kt.jsx)("div",{className:"flex-1",children:null===(n=l.toEmails)||void 0===n?void 0:n.map((e,t)=>{var r;return(0,kt.jsxs)("div",{className:"text-text-charcoal",children:[(null===(r=l.toNames)||void 0===r?void 0:r[t])&&(0,kt.jsxs)("span",{className:"font-medium",children:[l.toNames[t]," "]}),(0,kt.jsxs)("span",{className:"text-text-light-gray",children:["<",e,">"]})]},t)})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-6 pt-2 border-t border-border-silver",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("label",{className:"text-sm font-semibold text-text-light-gray",children:"Sent:"}),(0,kt.jsx)("span",{className:"text-text-charcoal",children:mw(new Date(l.sentAt||l.createdAt),"PPpp")})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"delivered":case"opened":return(0,kt.jsx)(Gb,{className:"text-semantic-success"});case"failed":case"bounced":return(0,kt.jsx)(Hb,{className:"text-semantic-danger"});default:return(0,kt.jsx)(Kb,{className:"text-brand-aqua-blue"})}})(l.status),(0,kt.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat((e=>{switch(e){case"delivered":return"bg-green-100 text-green-800";case"opened":return"bg-blue-100 text-blue-800";case"failed":case"bounced":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(l.status)),children:l.status})]})]}),(l.project||l.customer||l.task)&&(0,kt.jsxs)("div",{className:"flex items-center gap-4 pt-2 border-t border-border-silver",children:[l.project&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-text-light-gray",children:"Project:"}),(0,kt.jsxs)("span",{className:"text-brand-aqua-blue font-medium",children:[l.project.projectName," (#",l.project.projectNumber,")"]})]}),l.customer&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-text-light-gray",children:"Customer:"}),(0,kt.jsx)("span",{className:"text-text-charcoal font-medium",children:l.customer.primaryName})]}),l.task&&(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("span",{className:"text-sm font-semibold text-text-light-gray",children:"Task:"}),(0,kt.jsx)("span",{className:"text-text-charcoal font-medium",children:l.task.title})]})]})]}),l.attachments&&l.attachments.length>0&&(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("h4",{className:"text-sm font-semibold text-text-charcoal mb-3 flex items-center gap-2",children:[(0,kt.jsx)(Qb,{className:"w-4 h-4"}),"Attachments (",l.attachments.length,")"]}),(0,kt.jsx)("div",{className:"space-y-2",children:l.attachments.map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center justify-between p-3 bg-background-ash rounded-lg border border-border-silver hover:border-brand-aqua-blue transition-colors",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)(Qb,{className:"w-5 h-5 text-brand-aqua-blue"}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-medium text-text-charcoal",children:e.filename}),e.size&&(0,kt.jsxs)("div",{className:"text-sm text-text-light-gray",children:[(e.size/1024).toFixed(2)," KB"]})]})]}),(0,kt.jsx)("button",{className:"text-brand-aqua-blue hover:text-brand-deep-teal p-2 rounded-lg hover:bg-brand-aqua-blue-light-tint transition-colors",children:(0,kt.jsx)(Jb,{className:"w-5 h-5"})})]},t))})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold text-text-charcoal mb-3",children:"Message"}),l.bodyHtml?(0,kt.jsx)("div",{className:"prose max-w-none bg-white border border-border-silver rounded-lg p-6",dangerouslySetInnerHTML:{__html:l.bodyHtml}}):(0,kt.jsx)("div",{className:"bg-white border border-border-silver rounded-lg p-6 whitespace-pre-wrap",children:l.bodyText})]}),(l.deliveredAt||l.openedAt||l.clickedAt)&&(0,kt.jsxs)("div",{className:"bg-background-ash rounded-lg p-4",children:[(0,kt.jsx)("h4",{className:"text-sm font-semibold text-text-charcoal mb-3",children:"Tracking"}),(0,kt.jsxs)("div",{className:"space-y-2 text-sm",children:[l.deliveredAt&&(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-semantic-success",children:[(0,kt.jsx)(Gb,{className:"w-4 h-4"}),(0,kt.jsxs)("span",{children:["Delivered: ",mw(new Date(l.deliveredAt),"PPpp")]})]}),l.openedAt&&(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-brand-aqua-blue",children:[(0,kt.jsx)(Yb,{className:"w-4 h-4"}),(0,kt.jsxs)("span",{children:["Opened: ",mw(new Date(l.openedAt),"PPpp")]})]}),l.clickedAt&&(0,kt.jsxs)("div",{className:"flex items-center gap-2 text-accent-vibrant-green",children:[(0,kt.jsx)(Yb,{className:"w-4 h-4"}),(0,kt.jsxs)("span",{children:["Link clicked: ",mw(new Date(l.clickedAt),"PPpp")]})]})]})]})]}):null}),(0,kt.jsx)("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-border-silver bg-background-ash",children:(0,kt.jsx)("button",{onClick:i,className:"px-6 py-2 bg-white border border-border-silver text-text-charcoal rounded-lg hover:bg-background-ash transition-colors font-medium",children:"Close"})})]})}):null},gw=()=>{const[e,t]=(0,o.useState)([]),[r,n]=(0,o.useState)(!0),[a,s]=(0,o.useState)(null),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)(""),[f,g]=(0,o.useState)(50),[v,x]=(0,o.useState)(0),[b,y]=(0,o.useState)(0);(0,o.useEffect)(()=>{w()},[u,m,f,v]);const w=async()=>{console.log("\ud83d\udce7 EMAIL HISTORY: fetchEmails called");try{var e;n(!0),s(null);const r=localStorage.getItem("token");if(console.log("\ud83d\udce7 EMAIL HISTORY: Token:",r?"Present":"Missing"),!r)return console.warn("\ud83d\udce7 EMAIL HISTORY: No token found"),s("Authentication required. Please log in."),void n(!1);const a=new URLSearchParams;u&&a.append("emailType",u),m&&a.append("status",m),a.append("limit",f),a.append("offset",v),console.log("\ud83d\udce7 EMAIL HISTORY: Fetching with params:",a.toString());const o=await fetch("/api/email/history?".concat(a),{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(console.log("\ud83d\udce7 EMAIL HISTORY: Response status:",o.status),!o.ok){if(401===o.status)throw new Error("Session expired. Please log in again.");throw new Error("Failed to fetch emails")}const i=await o.json();console.log("\ud83d\udce7 EMAIL HISTORY: Received data:",i),t(i.data.emails||[]),y(i.data.total||0),console.log("\ud83d\udce7 EMAIL HISTORY: Emails loaded:",(null===(e=i.data.emails)||void 0===e?void 0:e.length)||0)}catch(XI){console.error("\ud83d\udce7 EMAIL HISTORY: Error:",XI),s(XI.message)}finally{n(!1)}},j=e.filter(e=>{var t,r,n,a;if(!c)return!0;const s=c.toLowerCase();return(null===(t=e.subject)||void 0===t?void 0:t.toLowerCase().includes(s))||(null===(r=e.senderName)||void 0===r?void 0:r.toLowerCase().includes(s))||(null===(n=e.senderEmail)||void 0===n?void 0:n.toLowerCase().includes(s))||(null===(a=e.toEmails)||void 0===a?void 0:a.some(e=>e.toLowerCase().includes(s)))}),N={total:b,sent:e.filter(e=>"sent"===e.status).length,delivered:e.filter(e=>"delivered"===e.status).length,opened:e.filter(e=>"opened"===e.status).length};return(0,kt.jsx)("div",{className:"min-h-screen p-6",style:{backgroundColor:"var(--color-background-ash)"},children:(0,kt.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,kt.jsxs)("div",{className:"rounded-lg p-8 text-white",style:{background:"linear-gradient(to right, var(--color-brand-aqua-blue), var(--color-accent-vibrant-green))",boxShadow:"var(--shadow-medium)"},children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,kt.jsx)("div",{className:"bg-white bg-opacity-20 p-4 rounded-lg",children:(0,kt.jsx)(Xb,{className:"w-10 h-10"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{className:"text-3xl font-bold",children:"Email History"}),(0,kt.jsx)("p",{className:"text-white text-opacity-90 mt-1",children:"View and manage all email communications"})]})]}),(0,kt.jsxs)("div",{className:"flex gap-3",children:[(0,kt.jsxs)("button",{onClick:()=>{console.log("\ud83d\udce7 EMAIL HISTORY: Refresh button clicked"),w()},disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition-colors disabled:opacity-50 cursor-pointer",children:[(0,kt.jsx)(Zb,{className:"w-5 h-5 ".concat(r?"animate-spin":"")}),"Refresh"]}),(0,kt.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition-colors",children:[(0,kt.jsx)(Jb,{className:"w-5 h-5"}),"Export"]})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",boxShadow:"var(--shadow-soft)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,kt.jsx)("div",{className:"text-3xl font-bold text-white",children:N.total}),(0,kt.jsx)("div",{className:"text-sm mt-1 text-white text-opacity-90",children:"Total Emails"})]}),(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",boxShadow:"var(--shadow-soft)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,kt.jsx)("div",{className:"text-3xl font-bold text-white",children:N.sent}),(0,kt.jsx)("div",{className:"text-sm mt-1 text-white text-opacity-90",children:"Sent"})]}),(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",boxShadow:"var(--shadow-soft)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,kt.jsx)("div",{className:"text-3xl font-bold text-white",children:N.delivered}),(0,kt.jsx)("div",{className:"text-sm mt-1 text-white text-opacity-90",children:"Delivered"})]}),(0,kt.jsxs)("div",{className:"rounded-lg p-4",style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",boxShadow:"var(--shadow-soft)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,kt.jsx)("div",{className:"text-3xl font-bold text-white",children:N.opened}),(0,kt.jsx)("div",{className:"text-sm mt-1 text-white text-opacity-90",children:"Opened"})]})]})]}),(0,kt.jsx)("div",{className:"bg-white rounded-lg p-6",style:{border:"1px solid var(--color-border-silver)",boxShadow:"var(--shadow-soft)"},children:(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold mb-2",style:{color:"var(--color-text-charcoal)"},children:"Search"}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)($b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-light-gray w-5 h-5"}),(0,kt.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Search by subject, sender, or recipient...",className:"w-full pl-10 pr-4 py-2 rounded-lg focus:outline-none",style:{border:"1px solid var(--color-border-silver)",transition:"all 0.2s"},onFocus:e=>{e.target.style.borderColor="var(--color-brand-aqua-blue)",e.target.style.boxShadow="0 0 0 3px rgba(0, 137, 209, 0.1)"},onBlur:e=>{e.target.style.borderColor="var(--color-border-silver)",e.target.style.boxShadow="none"}})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold mb-2",style:{color:"var(--color-text-charcoal)"},children:"Email Type"}),(0,kt.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 rounded-lg focus:outline-none",style:{border:"1px solid var(--color-border-silver)",transition:"all 0.2s"},onFocus:e=>{e.target.style.borderColor="var(--color-brand-aqua-blue)",e.target.style.boxShadow="0 0 0 3px rgba(0, 137, 209, 0.1)"},onBlur:e=>{e.target.style.borderColor="var(--color-border-silver)",e.target.style.boxShadow="none"},children:[(0,kt.jsx)("option",{value:"",children:"All Types"}),(0,kt.jsx)("option",{value:"project_update",children:"Project Update"}),(0,kt.jsx)("option",{value:"customer_communication",children:"Customer"}),(0,kt.jsx)("option",{value:"team_communication",children:"Team"}),(0,kt.jsx)("option",{value:"bubbles_ai",children:"AI Assistant"}),(0,kt.jsx)("option",{value:"general",children:"General"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold mb-2",style:{color:"var(--color-text-charcoal)"},children:"Status"}),(0,kt.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 rounded-lg focus:outline-none",style:{border:"1px solid var(--color-border-silver)",transition:"all 0.2s"},onFocus:e=>{e.target.style.borderColor="var(--color-brand-aqua-blue)",e.target.style.boxShadow="0 0 0 3px rgba(0, 137, 209, 0.1)"},onBlur:e=>{e.target.style.borderColor="var(--color-border-silver)",e.target.style.boxShadow="none"},children:[(0,kt.jsx)("option",{value:"",children:"All Status"}),(0,kt.jsx)("option",{value:"sent",children:"Sent"}),(0,kt.jsx)("option",{value:"delivered",children:"Delivered"}),(0,kt.jsx)("option",{value:"opened",children:"Opened"}),(0,kt.jsx)("option",{value:"failed",children:"Failed"}),(0,kt.jsx)("option",{value:"bounced",children:"Bounced"})]})]})]})}),a?(0,kt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-red-800",children:[(0,kt.jsx)("p",{className:"font-semibold",children:"Error loading emails"}),(0,kt.jsx)("p",{className:"text-sm mt-1",children:a})]}):(0,kt.jsxs)("div",{className:"bg-white rounded-lg p-6",style:{border:"1px solid var(--color-border-silver)",boxShadow:"var(--shadow-soft)"},children:[(0,kt.jsx)(Py,{emails:j,onEmailClick:l,loading:r,emptyMessage:"No emails found matching your filters"}),b>f&&(0,kt.jsxs)("div",{className:"flex items-center justify-between mt-6 pt-6 border-t border-border-silver",children:[(0,kt.jsxs)("div",{className:"text-sm text-text-light-gray",children:["Showing ",v+1," to ",Math.min(v+f,b)," of ",b," emails"]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("button",{onClick:()=>{v>0&&x(Math.max(0,v-f))},disabled:0===v,className:"px-4 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",style:{backgroundColor:"var(--color-background-ash)",color:"var(--color-text-charcoal)"},onMouseEnter:e=>!e.target.disabled&&(e.target.style.backgroundColor="var(--color-brand-aqua-blue-light-tint)"),onMouseLeave:e=>e.target.style.backgroundColor="var(--color-background-ash)",children:"Previous"}),(0,kt.jsx)("button",{onClick:()=>{v+f<b&&x(v+f)},disabled:v+f>=b,className:"px-4 py-2 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",style:{backgroundColor:"var(--color-brand-aqua-blue)"},onMouseEnter:e=>!e.target.disabled&&(e.target.style.backgroundColor="var(--color-brand-deep-teal)"),onMouseLeave:e=>e.target.style.backgroundColor="var(--color-brand-aqua-blue)",children:"Next"})]})]})]}),i&&(0,kt.jsx)(fw,{email:i,onClose:()=>l(null)})]})})};(()=>{const e=localStorage.getItem("mockFeedbackStore");if(e)try{return JSON.parse(e)}catch(t){console.error("Error parsing stored feedback data:",t)}new Date(Date.now()-1728e5).toISOString(),new Date(Date.now()-432e6).toISOString(),new Date(Date.now()-6048e5).toISOString(),new Date(Date.now()-2592e5).toISOString(),new Date(Date.now()-12096e5).toISOString(),new Date(Date.now()-864e5).toISOString(),new Date(Date.now()-2592e5).toISOString(),new Date(Date.now()-3456e5).toISOString()})();const vw=async e=>(await new Promise(e=>setTimeout(e,200)),[{id:"1",type:"comment",title:"New comment on your feedback",message:'John Developer commented on "Dashboard loading slowly"',read:!1,createdAt:new Date(Date.now()-36e5).toISOString()},{id:"2",type:"vote",title:"Your feedback received an upvote",message:'Someone upvoted "Add bulk actions for project management"',read:!1,createdAt:new Date(Date.now()-72e5).toISOString()},{id:"3",type:"status_change",title:"Feedback status updated",message:'Your feedback "AI-powered predictions" is now Planned',read:!0,createdAt:new Date(Date.now()-864e5).toISOString()}]),xw=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},bw=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var yw={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const ww=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],jw=(0,o.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:i="",children:l,iconNode:c}=e,d=An(e,ww);return(0,o.createElement)("svg",(0,Y.A)((0,Y.A)((0,Y.A)({ref:t},yw),{},{width:n,height:n,stroke:r,strokeWidth:s?24*Number(a)/Number(n):a,className:bw("lucide",i)},!l&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"}),d),[...c.map(e=>{let[t,r]=e;return(0,o.createElement)(t,r)}),...Array.isArray(l)?l:[l]])}),Nw=["className"],Sw=(e,t)=>{const r=(0,o.forwardRef)((r,n)=>{let{className:a}=r,s=An(r,Nw);return(0,o.createElement)(jw,(0,Y.A)({ref:n,iconNode:t,className:bw("lucide-".concat((i=xw(e),i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),a)},s));var i});return r.displayName=xw(e),r},kw=Sw("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Aw=Sw("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),Cw=Sw("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Ew=Sw("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),Pw=Sw("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),_w=Sw("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Iw=Sw("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Tw=e=>{let{onSubmit:t,colorMode:r,currentUser:n,isOpen:a=!0,onClose:s}=e;const[i,l]=(0,o.useState)({type:"bug",title:"",description:"",stepsToReproduce:"",expectedBehavior:"",actualBehavior:"",severity:"medium",problem:"",proposal:"",impact:"",environment:"",tags:[]}),[c,d]=(0,o.useState)([]),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!1),f=(0,o.useRef)(null),g=(0,o.useRef)(null),v=[{id:"bug",label:"Bug Report",icon:kw,color:"red"},{id:"improvement",label:"Improvement",icon:Aw,color:"blue"},{id:"idea",label:"New Idea",icon:Cw,color:"green"}],x=(e,t)=>{l(r=>(0,Y.A)((0,Y.A)({},r),{},{[e]:t}))},b=async e=>{const t=[],r=[];for(const a of e){const e=a.size<=10485760,s=a.type.startsWith("image/")||"application/pdf"===a.type;if(e&&s)if(a.type.startsWith("image/"))try{const e=await y(a);t.push({file:a,name:a.name,type:a.type,size:a.size,dataUrl:e,isImage:!0})}catch(n){console.error("Error processing image:",n),r.push(a.name)}else t.push({file:a,name:a.name,type:a.type,size:a.size,isImage:!1});else r.push(a.name)}r.length>0&&qr.error("Some files were rejected. Only images and PDFs up to 10MB are allowed."),t.length>0&&(d(e=>[...e,...t]),qr.success("Added ".concat(t.length," file(s)")))},y=e=>new Promise((t,r)=>{const n=new FileReader;n.onload=e=>t(e.target.result),n.onerror=r,n.readAsDataURL(e)});return a?(0,kt.jsxs)("form",{ref:g,onSubmit:async e=>{if(e.preventDefault(),i.title.trim()&&i.description.trim()){h(!0);try{const e={userAgent:navigator.userAgent,url:window.location.href,timestamp:(new Date).toISOString(),screen:{width:window.screen.width,height:window.screen.height}},r=c.map(e=>({name:e.name,type:e.type,size:e.size,dataUrl:e.dataUrl||null,isImage:e.isImage||!1})),n=(0,Y.A)((0,Y.A)({},i),{},{environment:e,attachments:r});await t(n),l({type:"bug",title:"",description:"",stepsToReproduce:"",expectedBehavior:"",actualBehavior:"",severity:"medium",problem:"",proposal:"",impact:"",environment:"",tags:[]}),d([]),s&&s()}catch(r){qr.error("Failed to submit feedback")}finally{h(!1)}}else qr.error("Title and description are required")},className:"overflow-y-auto",onPaste:async e=>{var t;const r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;const n=[];for(let a=0;a<r.length;a++){const e=r[a];if(-1!==e.type.indexOf("image")){const t=e.getAsFile();if(t){const e=new File([t],"snippet-".concat(Date.now(),".png"),{type:t.type});n.push(e)}}}n.length>0&&(e.preventDefault(),await b(n),qr.success("Pasted ".concat(n.length," image(s) from clipboard")))},children:[(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-3 ".concat(r?"text-gray-300":"text-gray-700"),children:"Feedback Type"}),(0,kt.jsx)("div",{className:"grid grid-cols-3 gap-3",children:v.map(e=>{const t=e.icon;return(0,kt.jsxs)("button",{type:"button",onClick:()=>x("type",e.id),className:"p-4 rounded-xl border-2 transition-all ".concat(i.type===e.id?"border-".concat(e.color,"-500 bg-").concat(e.color,"-50"):r?"border-slate-600 bg-slate-700 hover:bg-slate-600":"border-gray-300 bg-white hover:bg-gray-50"),children:[(0,kt.jsx)(t,{className:"h-6 w-6 mx-auto mb-2 text-".concat(e.color,"-500")}),(0,kt.jsx)("span",{className:"text-sm font-medium ".concat(r?"text-white":"text-gray-900"),children:e.label})]},e.id)})})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:["Title ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("input",{type:"text",id:"feedback-title",name:"title",value:i.title,onChange:e=>x("title",e.target.value),placeholder:"Brief, descriptive title...",className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent"),required:!0})]}),"bug"===i.type&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Steps to Reproduce"}),(0,kt.jsx)("textarea",{id:"feedback-steps-to-reproduce",name:"stepsToReproduce",value:i.stepsToReproduce,onChange:e=>x("stepsToReproduce",e.target.value),placeholder:"1. Go to...\n2. Click on...\n3. See error...",rows:4,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Expected Behavior"}),(0,kt.jsx)("textarea",{id:"feedback-expected-behavior",name:"expectedBehavior",value:i.expectedBehavior,onChange:e=>x("expectedBehavior",e.target.value),placeholder:"What should happen...",rows:3,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Actual Behavior"}),(0,kt.jsx)("textarea",{id:"feedback-actual-behavior",name:"actualBehavior",value:i.actualBehavior,onChange:e=>x("actualBehavior",e.target.value),placeholder:"What actually happens...",rows:3,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Severity"}),(0,kt.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"low",label:"Low",color:"green"},{value:"medium",label:"Medium",color:"yellow"},{value:"high",label:"High",color:"orange"},{value:"critical",label:"Critical",color:"red"}].map(e=>(0,kt.jsxs)("button",{type:"button",onClick:()=>x("severity",e.value),className:"p-3 rounded-lg border-2 transition-all ".concat(i.severity===e.value?"border-".concat(e.color,"-500 bg-").concat(e.color,"-50"):r?"border-slate-600 bg-slate-700 hover:bg-slate-600":"border-gray-300 bg-white hover:bg-gray-50"),children:[(0,kt.jsx)("div",{className:"w-3 h-3 rounded-full bg-".concat(e.color,"-500 mx-auto mb-1")}),(0,kt.jsx)("span",{className:"text-xs font-medium ".concat(r?"text-white":"text-gray-900"),children:e.label})]},e.value))})]})]}),("improvement"===i.type||"idea"===i.type)&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"improvement"===i.type?"Current Problem":"Use Case"}),(0,kt.jsx)("textarea",{id:"feedback-problem",name:"problem",value:i.problem,onChange:e=>x("problem",e.target.value),placeholder:"Describe the current issue or use case...",rows:4,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"improvement"===i.type?"Proposed Solution":"Idea Description"}),(0,kt.jsx)("textarea",{id:"feedback-proposal",name:"proposal",value:i.proposal,onChange:e=>x("proposal",e.target.value),placeholder:"Describe your solution or idea...",rows:4,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Expected Impact"}),(0,kt.jsx)("textarea",{id:"feedback-impact",name:"impact",value:i.impact,onChange:e=>x("impact",e.target.value),placeholder:"How would this benefit users? What's the impact?",rows:3,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium ".concat(r?"text-gray-300":"text-gray-700"),children:["Description ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("div",{className:"flex space-x-2",children:(0,kt.jsx)("button",{type:"button",onClick:()=>p(!m),className:"text-sm px-3 py-1 rounded-lg ".concat(m?r?"bg-blue-600 text-white":"bg-blue-500 text-white":r?"bg-slate-700 text-gray-300":"bg-gray-100 text-gray-600"),children:m?"Edit":"Preview"})})]}),m?(0,kt.jsx)("div",{className:"p-4 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-300"),dangerouslySetInnerHTML:{__html:(w=i.description,w.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>"))}}):(0,kt.jsx)("textarea",{id:"feedback-description",name:"description",value:i.description,onChange:e=>x("description",e.target.value),placeholder:"Describe your feedback in detail... (Markdown supported)",rows:6,className:"w-full px-4 py-3 rounded-xl border ".concat(r?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent"),required:!0})]}),(0,kt.jsxs)("div",{className:"mb-6",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium mb-2 ".concat(r?"text-gray-300":"text-gray-700"),children:"Attachments (Images/PDFs up to 10MB)"}),(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsx)("input",{ref:f,type:"file",multiple:!0,accept:"image/*,.pdf",onChange:async e=>{const t=Array.from(e.target.files);await b(t)},className:"hidden"}),(0,kt.jsxs)("button",{type:"button",onClick:()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.click()},className:"w-full p-4 border-2 border-dashed rounded-xl transition-colors ".concat(r?"border-slate-600 hover:border-slate-500 hover:bg-slate-700":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"),children:[(0,kt.jsx)(Ew,{className:"h-6 w-6 mx-auto mb-2"}),(0,kt.jsx)("span",{className:"text-sm ".concat(r?"text-gray-300":"text-gray-600"),children:"Click to upload files"})]}),c.length>0&&(0,kt.jsx)("div",{className:"space-y-3",children:c.map((e,t)=>(0,kt.jsxs)("div",{className:"p-3 rounded-lg border ".concat(r?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[e.isImage?(0,kt.jsx)(Pw,{className:"h-4 w-4 text-blue-500"}):(0,kt.jsx)(_w,{className:"h-4 w-4 text-red-500"}),(0,kt.jsx)("span",{className:"text-sm font-medium ".concat(r?"text-white":"text-gray-900"),children:e.name}),(0,kt.jsxs)("span",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-500"),children:["(",(e.size/1024/1024).toFixed(1),"MB)"]})]}),(0,kt.jsx)("button",{type:"button",onClick:()=>(e=>{d(t=>t.filter((t,r)=>r!==e))})(t),className:"text-red-500 hover:text-red-700",children:(0,kt.jsx)(Iw,{className:"h-4 w-4"})})]}),e.isImage&&e.dataUrl&&(0,kt.jsx)("div",{className:"mt-2 rounded-lg overflow-hidden border border-gray-300 max-w-md",children:(0,kt.jsx)("img",{src:e.dataUrl,alt:e.name,className:"w-full h-auto max-h-64 object-contain"})})]},t))}),(0,kt.jsx)("div",{className:"text-xs mt-2 ".concat(r?"text-gray-400":"text-gray-500"),children:"\ud83d\udca1 Tip: You can paste images directly from your clipboard (e.g., Windows Snipping Tool)"})]})]}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,kt.jsx)("button",{type:"button",onClick:s,className:"px-6 py-3 rounded-xl font-medium transition-colors ".concat(r?"bg-slate-700 text-white hover:bg-slate-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"),children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:u||!i.title.trim()||!i.description.trim(),className:"px-6 py-3 rounded-xl font-medium transition-colors ".concat(!u&&i.title.trim()&&i.description.trim()?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:u?"Submitting...":"Submit Feedback"})]})]}):null;var w},Lw=Sw("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Dw=Sw("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Mw=Sw("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ow=Sw("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),Rw=Sw("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Fw=Sw("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Uw=Sw("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Bw=Sw("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),zw=Sw("thumbs-up",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),Ww=Sw("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),qw=Sw("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]),Vw=Sw("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),Hw=Sw("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Gw=e=>{var t,r,n,a,s,i,l;let{feedback:c,currentUser:d,onVote:u,onFollow:h,onClick:m,onDelete:p,colorMode:f}=e;const[g,v]=(0,o.useState)(!1),[x,b]=(0,o.useState)(!1),[y,w]=(0,o.useState)(c.voteCount||0),[j,N]=(0,o.useState)(c.hasVoted||!1),[S,k]=(0,o.useState)(c.isFollowing||!1),[A,C]=(0,o.useState)(!1);(0,o.useEffect)(()=>{w(c.voteCount||0),N(c.hasVoted||!1)},[c.voteCount,c.hasVoted]),(0,o.useEffect)(()=>{k(c.isFollowing||!1)},[c.isFollowing]);const E=(null===d||void 0===d?void 0:d.id)===(null===(t=c.author)||void 0===t?void 0:t.id),P=(e=>{switch(e){case"BUG":default:return kw;case"IMPROVEMENT":return Aw;case"IDEA":return Cw}})(c.type),_=(e=>{switch(e){case"OPEN":default:return Lw;case"IN_REVIEW":return Dw;case"PLANNED":return Mw;case"IN_PROGRESS":return Ow;case"DONE":return Rw;case"CLOSED":return Fw}})(c.status),I=(e=>{switch(e){case"BUG":return"red";case"IMPROVEMENT":return"blue";case"IDEA":return"green";default:return"gray"}})(c.type),T=(e=>{switch(e){case"OPEN":case"DONE":return"green";case"IN_REVIEW":return"yellow";case"PLANNED":return"blue";case"IN_PROGRESS":return"purple";default:return"gray"}})(c.status),L=(e=>{switch(e){case"LOW":return"green";case"MEDIUM":return"yellow";case"HIGH":return"orange";case"CRITICAL":return"red";default:return"gray"}})(c.severity);return(0,kt.jsxs)("div",{onClick:m,className:"cursor-pointer transition-all duration-200 hover:shadow-lg mb-4 ".concat(f?"bg-slate-800 border-slate-600 shadow-slate-900/20":"bg-white border-gray-300 shadow-gray-200/50"," border-2 border-l-4 border-l-").concat(I,"-500 rounded-xl p-5 hover:scale-[1.01] hover:shadow-xl"),style:{boxShadow:f?"0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2)":"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:[(0,kt.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,kt.jsx)("div",{className:"p-2 rounded-lg bg-".concat(I,"-100 border border-").concat(I,"-200"),children:(0,kt.jsx)(P,{className:"h-5 w-5 text-".concat(I,"-600")})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(f?"text-white":"text-gray-900"," line-clamp-2"),children:c.title}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-".concat(I,"-100 text-").concat(I,"-800"),children:c.type}),(0,kt.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-".concat(T,"-100 text-").concat(T,"-800"),children:[(0,kt.jsx)(_,{className:"h-3 w-3 mr-1"}),c.status.replace("_"," ")]}),c.severity&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-".concat(L,"-100 text-").concat(L,"-800"),children:c.severity})]})]})]}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,kt.jsx)(Mw,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:Ey(new Date(c.createdAt),{addSuffix:!0})})]}),E&&p&&(0,kt.jsx)("button",{onClick:async e=>{e.stopPropagation(),window.confirm("Are you sure you want to delete this feedback post? This action cannot be undone.")&&p&&await p(c.id)},className:"p-1 rounded-md transition-all duration-200 opacity-60 hover:opacity-100 ".concat(f?"text-gray-400 hover:text-red-400 hover:bg-red-900/20":"text-gray-400 hover:text-red-500 hover:bg-red-50"),title:"Delete this post",children:(0,kt.jsx)(Uw,{className:"h-3.5 w-3.5"})})]})]}),(0,kt.jsx)("div",{className:"mb-3 ".concat(f?"text-gray-300":"text-gray-600"," line-clamp-2"),children:c.description}),c.attachments&&Array.isArray(c.attachments)&&c.attachments.length>0&&(0,kt.jsxs)("div",{className:"mb-3 space-y-2",children:[c.attachments.filter(e=>e.isImage&&e.dataUrl).slice(0,3).map((e,t)=>(0,kt.jsx)("div",{className:"rounded-lg overflow-hidden border border-gray-300 max-w-full",children:(0,kt.jsx)("img",{src:e.dataUrl,alt:e.name||"Attachment ".concat(t+1),className:"w-full h-auto max-h-48 object-contain cursor-pointer hover:opacity-90 transition-opacity",onClick:t=>{t.stopPropagation();const r=window.open();r&&r.document.write('<img src="'.concat(e.dataUrl,'" style="max-width: 100%; height: auto;" />'))}})},t)),c.attachments.filter(e=>e.isImage&&e.dataUrl).length>3&&(0,kt.jsxs)("div",{className:"text-xs ".concat(f?"text-gray-400":"text-gray-500"),children:["+",c.attachments.filter(e=>e.isImage&&e.dataUrl).length-3," more image(s)"]})]}),c.tags&&c.tags.length>0&&(0,kt.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[c.tags.slice(0,3).map((e,t)=>(0,kt.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ".concat(f?"bg-slate-700 text-slate-300":"bg-gray-100 text-gray-700"),children:[(0,kt.jsx)(Bw,{className:"h-3 w-3 mr-1"}),e]},t)),c.tags.length>3&&(0,kt.jsxs)("span",{className:"text-xs ".concat(f?"text-gray-400":"text-gray-500"),children:["+",c.tags.length-3," more"]})]}),(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,kt.jsxs)("button",{onClick:async e=>{if(e.stopPropagation(),g)return;const t=y,r=j;j?(w(e=>e-1),N(!1)):(w(e=>e+1),N(!0)),v(!0);try{await u(c.id,"upvote")}catch(n){w(t),N(r),gr.error("Failed to update vote. Please try again.")}finally{v(!1)}},disabled:g,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors ".concat(j?"bg-blue-100 text-blue-700":f?"bg-slate-700 text-gray-300 hover:bg-slate-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,kt.jsx)(zw,{className:"h-4 w-4 ".concat(j?"text-blue-600 fill-current":"")}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:y})]}),h&&(0,kt.jsxs)("button",{onClick:async e=>{if(e.stopPropagation(),A||!h)return;const t=S;k(!t),C(!0);try{await h(c.id,!t),gr.success(t?"Unfollowed feedback":"Now following this feedback")}catch(r){k(t),gr.error("Failed to update follow status. Please try again.")}finally{C(!1)}},disabled:A,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors ".concat(S?"bg-green-100 text-green-700":f?"bg-slate-700 text-gray-300 hover:bg-slate-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"),title:S?"Unfollow this feedback":"Follow this feedback",children:[S?(0,kt.jsx)(Ww,{className:"h-4 w-4 text-green-600 fill-current"}):(0,kt.jsx)(qw,{className:"h-4 w-4"}),(0,kt.jsx)("span",{className:"text-sm font-medium",children:S?"Following":"Follow"})]}),(0,kt.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,kt.jsx)(Vw,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:c.commentCount||0})]}),c.assignee&&(0,kt.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,kt.jsx)(Hw,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:c.assignee.name})]})]}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[null!==(r=c.author)&&void 0!==r&&r.avatar?(0,kt.jsx)("img",{src:c.author.avatar,alt:(null===(n=c.author)||void 0===n?void 0:n.name)||"User",className:"w-8 h-8 rounded-full object-cover border-2 border-gray-300",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):null,(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(f?"bg-slate-700 text-white":"bg-gray-200 text-gray-700"),style:{display:null!==(a=c.author)&&void 0!==a&&a.avatar?"none":"flex"},children:(null===(s=c.author)||void 0===s||null===(i=s.name)||void 0===i?void 0:i.charAt(0))||"U"}),(0,kt.jsxs)("div",{className:"text-sm",children:[(0,kt.jsx)("div",{className:"font-medium ".concat(f?"text-white":"text-gray-900"),children:(null===(l=c.author)||void 0===l?void 0:l.name)||"Anonymous"}),(0,kt.jsx)("div",{className:"text-xs ".concat(f?"text-gray-400":"text-gray-500"),children:Ey(new Date(c.createdAt),{addSuffix:!0})})]})]})]}),c.developerResponseCount>0&&(0,kt.jsx)("div",{onClick:e=>{e.stopPropagation(),m()},className:"mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200 cursor-pointer hover:bg-blue-100 transition-colors",children:(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,kt.jsxs)("span",{className:"text-sm font-medium text-blue-800",children:[c.developerResponseCount," developer response",1!==c.developerResponseCount?"s":""]}),(0,kt.jsx)("span",{className:"text-xs text-blue-600 ml-auto",children:"Click to view"})]})})]})};function Kw(e){if("undefined"===typeof Proxy)return e;const t=new Map;return new Proxy(function(){return e(...arguments)},{get:(r,n)=>"create"===n?e:(t.has(n)||t.set(n,e(n)),t.get(n))})}function Jw(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}const Yw=e=>Array.isArray(e);function Xw(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Qw(e){return"string"===typeof e||Array.isArray(e)}function Zw(e){const t=[{},{}];return null===e||void 0===e||e.values.forEach((e,r)=>{t[0][r]=e.get(),t[1][r]=e.getVelocity()}),t}function $w(e,t,r,n){if("function"===typeof t){const[a,s]=Zw(n);t=t(void 0!==r?r:e.custom,a,s)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[a,s]=Zw(n);t=t(void 0!==r?r:e.custom,a,s)}return t}function ej(e,t,r){const n=e.getProps();return $w(n,t,void 0!==r?r:n.custom,e)}const tj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],rj=["initial",...tj];function nj(e){let t;return()=>(void 0===t&&(t=e()),t)}const aj=nj(()=>void 0!==window.ScrollTimeline);class sj{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let r=0;r<this.animations.length;r++)this.animations[r][e]=t}attachTimeline(e,t){const r=this.animations.map(r=>aj()&&r.attachTimeline?r.attachTimeline(e):"function"===typeof t?t(r):void 0);return()=>{r.forEach((e,t)=>{e&&e(),this.animations[t].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach(t=>t[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class oj extends sj{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}function ij(e,t){return e?e[t]||e.default||e:void 0}const lj=2e4;function cj(e){let t=0;let r=e.next(t);for(;!r.done&&t<lj;)t+=50,r=e.next(t);return t>=lj?1/0:t}function dj(e){return"function"===typeof e}function uj(e,t){e.timeline=t,e.onfinish=null}const hj=e=>Array.isArray(e)&&"number"===typeof e[0],mj={linearEasing:void 0};function pj(e,t){const r=nj(e);return()=>{var e;return null!==(e=mj[t])&&void 0!==e?e:r()}}const fj=pj(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(_t){return!1}return!0},"linearEasing"),gj=(e,t,r)=>{const n=t-e;return 0===n?1:(r-e)/n},vj=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n="";const a=Math.max(Math.round(t/r),2);for(let s=0;s<a;s++)n+=e(gj(0,a-1,s))+", ";return"linear(".concat(n.substring(0,n.length-2),")")};function xj(e){return Boolean("function"===typeof e&&fj()||!e||"string"===typeof e&&(e in yj||fj())||hj(e)||Array.isArray(e)&&e.every(xj))}const bj=e=>{let[t,r,n,a]=e;return"cubic-bezier(".concat(t,", ").concat(r,", ").concat(n,", ").concat(a,")")},yj={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:bj([0,.65,.55,1]),circOut:bj([.55,0,1,.45]),backIn:bj([.31,.01,.66,-.59]),backOut:bj([.33,1.53,.69,.99])};function wj(e,t){return e?"function"===typeof e&&fj()?vj(e,t):hj(e)?bj(e):Array.isArray(e)?e.map(e=>wj(e,t)||yj.easeOut):yj[e]:void 0}const jj={x:!1,y:!1};function Nj(){return jj.x||jj.y}function Sj(e,t){const r=function(e,t,r){var n;if(e instanceof Element)return[e];if("string"===typeof e){let a=document;t&&(a=t.current);const s=null!==(n=null===r||void 0===r?void 0:r[e])&&void 0!==n?n:a.querySelectorAll(e);return s?Array.from(s):[]}return Array.from(e)}(e),n=new AbortController;return[r,(0,Y.A)((0,Y.A)({passive:!0},t),{},{signal:n.signal}),()=>n.abort()]}function kj(e){return t=>{"touch"===t.pointerType||Nj()||e(t)}}const Aj=(e,t)=>!!t&&(e===t||Aj(e,t.parentElement)),Cj=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary,Ej=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Pj=new WeakSet;function _j(e){return t=>{"Enter"===t.key&&e(t)}}function Ij(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Tj(e){return Cj(e)&&!Nj()}function Lj(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[n,a,s]=Sj(e,r),o=e=>{const n=e.currentTarget;if(!Tj(e)||Pj.has(n))return;Pj.add(n);const s=t(e),o=(e,t)=>{window.removeEventListener("pointerup",i),window.removeEventListener("pointercancel",l),Tj(e)&&Pj.has(n)&&(Pj.delete(n),"function"===typeof s&&s(e,{success:t}))},i=e=>{o(e,r.useGlobalTarget||Aj(n,e.target))},l=e=>{o(e,!1)};window.addEventListener("pointerup",i,a),window.addEventListener("pointercancel",l,a)};return n.forEach(e=>{(function(e){return Ej.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(r.useGlobalTarget?window:e).addEventListener("pointerdown",o,a),e.addEventListener("focus",e=>((e,t)=>{const r=e.currentTarget;if(!r)return;const n=_j(()=>{if(Pj.has(r))return;Ij(r,"down");const e=_j(()=>{Ij(r,"up")});r.addEventListener("keyup",e,t),r.addEventListener("blur",()=>Ij(r,"cancel"),t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)})(e,a),a)}),s}const Dj=e=>1e3*e,Mj=e=>e/1e3,Oj=e=>e;const Rj=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Fj=new Set(Rj),Uj=new Set(["width","height","top","left","right","bottom",...Rj]),Bj=e=>Yw(e)?e[e.length-1]||0:e,zj=!1,Wj=!1;const qj=["read","resolveKeyframes","update","preRender","render","postRender"];function Vj(e,t){let r=!1,n=!0;const a={delta:0,timestamp:0,isProcessing:!1},s=()=>r=!0,o=qj.reduce((e,t)=>(e[t]=function(e){let t=new Set,r=new Set,n=!1,a=!1;const s=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function i(t){s.has(t)&&(l.schedule(t),e()),t(o)}const l={schedule:function(e){const a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&n?t:r;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&s.add(e),a.has(e)||a.add(e),e},cancel:e=>{r.delete(e),s.delete(e)},process:e=>{o=e,n?a=!0:(n=!0,[t,r]=[r,t],t.forEach(i),t.clear(),n=!1,a&&(a=!1,l.process(e)))}};return l}(s),e),{}),{read:i,resolveKeyframes:l,update:c,preRender:d,render:u,postRender:h}=o,m=()=>{const s=Wj?a.timestamp:performance.now();r=!1,a.delta=n?1e3/60:Math.max(Math.min(s-a.timestamp,40),1),a.timestamp=s,a.isProcessing=!0,i.process(a),l.process(a),c.process(a),d.process(a),u.process(a),h.process(a),a.isProcessing=!1,r&&t&&(n=!1,e(m))},p=qj.reduce((t,s)=>{const i=o[s];return t[s]=function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r||(r=!0,n=!0,a.isProcessing||e(m)),i.schedule(t,s,o)},t},{});return{schedule:p,cancel:e=>{for(let t=0;t<qj.length;t++)o[qj[t]].cancel(e)},state:a,steps:o}}const{schedule:Hj,cancel:Gj,state:Kj,steps:Jj}=Vj("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:Oj,!0);let Yj;function Xj(){Yj=void 0}const Qj={now:()=>(void 0===Yj&&Qj.set(Kj.isProcessing||Wj?Kj.timestamp:performance.now()),Yj),set:e=>{Yj=e,queueMicrotask(Xj)}};function Zj(e,t){-1===e.indexOf(t)&&e.push(t)}function $j(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class eN{constructor(){this.subscriptions=[]}add(e){return Zj(this.subscriptions,e),()=>$j(this.subscriptions,e)}notify(e,t,r){const n=this.subscriptions.length;if(n)if(1===n)this.subscriptions[0](e,t,r);else for(let a=0;a<n;a++){const n=this.subscriptions[a];n&&n(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function tN(e,t){return t?e*(1e3/t):0}const rN={current:void 0};class nN{constructor(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=function(e){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=Qj.now();t.updatedAt!==n&&t.setPrevFrameValue(),t.prev=t.current,t.setCurrent(e),t.current!==t.prev&&t.events.change&&t.events.change.notify(t.current),r&&t.events.renderRequest&&t.events.renderRequest.notify(t.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=Qj.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(e=>!isNaN(parseFloat(e)))(this.current))}setPrevFrameValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new eN);const r=this.events[e].add(t);return"change"===e?()=>{r(),Hj.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return rN.current&&rN.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Qj.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return tN(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function aN(e,t){return new nN(e,t)}const sN=["transitionEnd","transition"];function oN(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,aN(r))}const iN=e=>Boolean(e&&e.getVelocity);function lN(e,t){const r=e.getValue("willChange");if(function(e){return Boolean(iN(e)&&e.add)}(r))return r.add(t)}const cN=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),dN="data-"+cN("framerAppearId");function uN(e){return e.props[dN]}const hN=!1,mN=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e;function pN(e,t,r,n){if(e===t&&r===n)return Oj;const a=t=>function(e,t,r,n,a){let s,o,i=0;do{o=t+(r-t)/2,s=mN(o,n,a)-e,s>0?r=o:t=o}while(Math.abs(s)>1e-7&&++i<12);return o}(t,0,1,e,r);return e=>0===e||1===e?e:mN(a(e),t,n)}const fN=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,gN=e=>t=>1-e(1-t),vN=pN(.33,1.53,.69,.99),xN=gN(vN),bN=fN(xN),yN=e=>(e*=2)<1?.5*xN(e):.5*(2-Math.pow(2,-10*(e-1))),wN=e=>1-Math.sin(Math.acos(e)),jN=gN(wN),NN=fN(wN),SN=e=>/^0(?:[\0-\x08\x0E-\x1F!-\x2D\/-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+$/.test(e);function kN(e){return"number"===typeof e?0===e:null===e||("none"===e||"0"===e||SN(e))}const AN=(e,t,r)=>r>t?t:r<e?e:r,CN={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},EN=(0,Y.A)((0,Y.A)({},CN),{},{transform:e=>AN(0,1,e)}),PN=(0,Y.A)((0,Y.A)({},CN),{},{default:1}),_N=e=>Math.round(1e5*e)/1e5,IN=/-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/g;const TN=/^(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))$/i,LN=(e,t)=>r=>Boolean("string"===typeof r&&TN.test(r)&&r.startsWith(e)||t&&!function(e){return null==e}(r)&&Object.prototype.hasOwnProperty.call(r,t)),DN=(e,t,r)=>n=>{if("string"!==typeof n)return n;const[a,s,o,i]=n.match(IN);return{[e]:parseFloat(a),[t]:parseFloat(s),[r]:parseFloat(o),alpha:void 0!==i?parseFloat(i):1}},MN=(0,Y.A)((0,Y.A)({},CN),{},{transform:e=>Math.round((e=>AN(0,255,e))(e))}),ON={test:LN("rgb","red"),parse:DN("red","green","blue"),transform:e=>{let{red:t,green:r,blue:n,alpha:a=1}=e;return"rgba("+MN.transform(t)+", "+MN.transform(r)+", "+MN.transform(n)+", "+_N(EN.transform(a))+")"}};const RN={test:LN("#"),parse:function(e){let t="",r="",n="",a="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),a=e.substring(4,5),t+=t,r+=r,n+=n,a+=a),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:a?parseInt(a,16)/255:1}},transform:ON.transform},FN=e=>({test:t=>"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>"".concat(t).concat(e)}),UN=FN("deg"),BN=FN("%"),zN=FN("px"),WN=FN("vh"),qN=FN("vw"),VN=(0,Y.A)((0,Y.A)({},BN),{},{parse:e=>BN.parse(e)/100,transform:e=>BN.transform(100*e)}),HN={test:LN("hsl","hue"),parse:DN("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:r,lightness:n,alpha:a=1}=e;return"hsla("+Math.round(t)+", "+BN.transform(_N(r))+", "+BN.transform(_N(n))+", "+_N(EN.transform(a))+")"}},GN={test:e=>ON.test(e)||RN.test(e)||HN.test(e),parse:e=>ON.test(e)?ON.parse(e):HN.test(e)?HN.parse(e):RN.parse(e),transform:e=>"string"===typeof e?e:e.hasOwnProperty("red")?ON.transform(e):HN.transform(e)},KN=/(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))/gi;const JN="number",YN="color",XN=/var[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)|#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\)|-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/gi;function QN(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},a=[];let s=0;const o=t.replace(XN,e=>(GN.test(e)?(n.color.push(s),a.push(YN),r.push(GN.parse(e))):e.startsWith("var(")?(n.var.push(s),a.push("var"),r.push(e)):(n.number.push(s),a.push(JN),r.push(parseFloat(e))),++s,"${}")).split("${}");return{values:r,split:o,indexes:n,types:a}}function ZN(e){return QN(e).values}function $N(e){const{split:t,types:r}=QN(e),n=t.length;return e=>{let a="";for(let s=0;s<n;s++)if(a+=t[s],void 0!==e[s]){const t=r[s];a+=t===JN?_N(e[s]):t===YN?GN.transform(e[s]):e[s]}return a}}const eS=e=>"number"===typeof e?0:e;const tS={test:function(e){var t,r;return isNaN(e)&&"string"===typeof e&&((null===(t=e.match(IN))||void 0===t?void 0:t.length)||0)+((null===(r=e.match(KN))||void 0===r?void 0:r.length)||0)>0},parse:ZN,createTransformer:$N,getAnimatableNone:function(e){const t=ZN(e);return $N(e)(t.map(eS))}},rS=new Set(["brightness","contrast","saturate","opacity"]);function nS(e){const[t,r]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[n]=r.match(IN)||[];if(!n)return e;const a=r.replace(n,"");let s=rS.has(t)?1:0;return n!==r&&(s*=100),t+"("+s+a+")"}const aS=/\b([\x2Da-z]*)\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\)/g,sS=(0,Y.A)((0,Y.A)({},tS),{},{getAnimatableNone:e=>{const t=e.match(aS);return t?t.map(nS).join(" "):e}}),oS={borderWidth:zN,borderTopWidth:zN,borderRightWidth:zN,borderBottomWidth:zN,borderLeftWidth:zN,borderRadius:zN,radius:zN,borderTopLeftRadius:zN,borderTopRightRadius:zN,borderBottomRightRadius:zN,borderBottomLeftRadius:zN,width:zN,maxWidth:zN,height:zN,maxHeight:zN,top:zN,right:zN,bottom:zN,left:zN,padding:zN,paddingTop:zN,paddingRight:zN,paddingBottom:zN,paddingLeft:zN,margin:zN,marginTop:zN,marginRight:zN,marginBottom:zN,marginLeft:zN,backgroundPositionX:zN,backgroundPositionY:zN},iS={rotate:UN,rotateX:UN,rotateY:UN,rotateZ:UN,scale:PN,scaleX:PN,scaleY:PN,scaleZ:PN,skew:UN,skewX:UN,skewY:UN,distance:zN,translateX:zN,translateY:zN,translateZ:zN,x:zN,y:zN,z:zN,perspective:zN,transformPerspective:zN,opacity:EN,originX:VN,originY:VN,originZ:zN},lS=(0,Y.A)((0,Y.A)({},CN),{},{transform:Math.round}),cS=(0,Y.A)((0,Y.A)((0,Y.A)({},oS),iS),{},{zIndex:lS,size:zN,fillOpacity:EN,strokeOpacity:EN,numOctaves:lS}),dS=(0,Y.A)((0,Y.A)({},cS),{},{color:GN,backgroundColor:GN,outlineColor:GN,fill:GN,stroke:GN,borderColor:GN,borderTopColor:GN,borderRightColor:GN,borderBottomColor:GN,borderLeftColor:GN,filter:sS,WebkitFilter:sS}),uS=e=>dS[e];function hS(e,t){let r=uS(e);return r!==sS&&(r=tS),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const mS=new Set(["auto","none","0"]);const pS=e=>e===CN||e===zN,fS=(e,t)=>parseFloat(e.split(", ")[t]),gS=(e,t)=>(r,n)=>{let{transform:a}=n;if("none"===a||!a)return 0;const s=a.match(/^matrix3d\(((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)\)$/);if(s)return fS(s[1],t);{const t=a.match(/^matrix\(((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)\)$/);return t?fS(t[1],e):0}},vS=new Set(["x","y","z"]),xS=Rj.filter(e=>!vS.has(e));const bS={width:(e,t)=>{let{x:r}=e,{paddingLeft:n="0",paddingRight:a="0"}=t;return r.max-r.min-parseFloat(n)-parseFloat(a)},height:(e,t)=>{let{y:r}=e,{paddingTop:n="0",paddingBottom:a="0"}=t;return r.max-r.min-parseFloat(n)-parseFloat(a)},top:(e,t)=>{let{top:r}=t;return parseFloat(r)},left:(e,t)=>{let{left:r}=t;return parseFloat(r)},bottom:(e,t)=>{let{y:r}=e,{top:n}=t;return parseFloat(n)+(r.max-r.min)},right:(e,t)=>{let{x:r}=e,{left:n}=t;return parseFloat(n)+(r.max-r.min)},x:gS(4,13),y:gS(5,14)};bS.translateX=bS.x,bS.translateY=bS.y;const yS=new Set;let wS=!1,jS=!1;function NS(){if(jS){const e=Array.from(yS).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),r=new Map;t.forEach(e=>{const t=function(e){const t=[];return xS.forEach(r=>{const n=e.getValue(r);void 0!==n&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}(e);t.length&&(r.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=r.get(e);t&&t.forEach(t=>{let[r,n]=t;var a;null===(a=e.getValue(r))||void 0===a||a.set(n)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}jS=!1,wS=!1,yS.forEach(e=>e.complete()),yS.clear()}function SS(){yS.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(jS=!0)})}class kS{constructor(e,t,r,n,a){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=n,this.element=a,this.isAsync=s}scheduleResolve(){this.isScheduled=!0,this.isAsync?(yS.add(this),wS||(wS=!0,Hj.read(SS),Hj.resolveKeyframes(NS))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:n}=this;for(let a=0;a<e.length;a++)if(null===e[a])if(0===a){const a=null===n||void 0===n?void 0:n.get(),s=e[e.length-1];if(void 0!==a)e[0]=a;else if(r&&t){const n=r.readValue(t,s);void 0!==n&&null!==n&&(e[0]=n)}void 0===e[0]&&(e[0]=s),n&&void 0===a&&n.set(e[0])}else e[a]=e[a-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),yS.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,yS.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}let AS=Oj,CS=Oj;const ES=e=>/^-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)$/.test(e),PS=e=>t=>"string"===typeof t&&t.startsWith(e),_S=PS("--"),IS=PS("var(--"),TS=e=>!!IS(e)&&LS.test(e.split("/*")[0].trim()),LS=/var\(--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)$/i,DS=/^var\(--(?:([\x2D0-9A-Z_a-z]+)|([\x2D0-9A-Z_a-z]+), ?([ #%\(\),-\.0-9A-Za-z]+))\)/;function MS(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;CS(r<=4,'Max CSS variable fallback depth detected in property "'.concat(e,'". This may indicate a circular fallback dependency.'));const[n,a]=function(e){const t=DS.exec(e);if(!t)return[,];const[,r,n,a]=t;return["--".concat(null!==r&&void 0!==r?r:n),a]}(e);if(!n)return;const s=window.getComputedStyle(t).getPropertyValue(n);if(s){const e=s.trim();return ES(e)?parseFloat(e):e}return TS(a)?MS(a,t,r+1):a}const OS=e=>t=>t.test(e),RS=[CN,zN,BN,UN,qN,WN,{test:e=>"auto"===e,parse:e=>e}],FS=e=>RS.find(OS(e));class US extends kS{constructor(e,t,r,n,a){super(e,t,r,n,a,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let i=0;i<e.length;i++){let r=e[i];if("string"===typeof r&&(r=r.trim(),TS(r))){const n=MS(r,t.current);void 0!==n&&(e[i]=n),i===e.length-1&&(this.finalKeyframe=r)}}if(this.resolveNoneKeyframes(),!Uj.has(r)||2!==e.length)return;const[n,a]=e,s=FS(n),o=FS(a);if(s!==o)if(pS(s)&&pS(o))for(let i=0;i<e.length;i++){const t=e[i];"string"===typeof t&&(e[i]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let n=0;n<e.length;n++)kN(e[n])&&r.push(n);r.length&&function(e,t,r){let n,a=0;for(;a<e.length&&!n;){const t=e[a];"string"===typeof t&&!mS.has(t)&&QN(t).values.length&&(n=e[a]),a++}if(n&&r)for(const s of t)e[s]=hS(r,n)}(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;"height"===r&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=bS[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const n=t[t.length-1];void 0!==n&&e.getValue(r,n).jump(n,!1)}measureEndState(){var e;const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const a=t.getValue(r);a&&a.jump(this.measuredOrigin,!1);const s=n.length-1,o=n[s];n[s]=bS[r](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach(e=>{let[r,n]=e;t.getValue(r).set(n)}),this.resolveNoneKeyframes()}}const BS=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!tS.test(e)&&"0"!==e||e.startsWith("url(")));function zS(e,t,r,n){const a=e[0];if(null===a)return!1;if("display"===t||"visibility"===t)return!0;const s=e[e.length-1],o=BS(a,t),i=BS(s,t);return AS(o===i,"You are trying to animate ".concat(t,' from "').concat(a,'" to "').concat(s,'". ').concat(a," is not an animatable value - to enable this animation set ").concat(a," to a value animatable to ").concat(s," via the `style` property.")),!(!o||!i)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}(e)||("spring"===r||dj(r))&&n)}const WS=e=>null!==e;function qS(e,t,r){let{repeat:n,repeatType:a="loop"}=t;const s=e.filter(WS),o=n&&"loop"!==a&&n%2===1?0:s.length-1;return o&&void 0!==r?r:s[o]}const VS=["autoplay","delay","type","repeat","repeatDelay","repeatType"];class HS{constructor(e){let{autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:a=0,repeatDelay:s=0,repeatType:o="loop"}=e,i=An(e,VS);this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Qj.now(),this.options=(0,Y.A)({autoplay:t,delay:r,type:n,repeat:a,repeatDelay:s,repeatType:o},i),this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(SS(),NS()),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=Qj.now(),this.hasAttemptedResolve=!0;const{name:r,type:n,velocity:a,delay:s,onComplete:o,onUpdate:i,isGenerator:l}=this.options;if(!l&&!zS(e,r,n,a)){if(hN||!s)return i&&i(qS(e,this.options,t)),o&&o(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,t);!1!==c&&(this._resolved=(0,Y.A)({keyframes:e,finalKeyframe:t},c),this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const GS=(e,t,r)=>e+(t-e)*r;function KS(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function JS(e,t){return r=>r>0?t:e}const YS=(e,t,r)=>{const n=e*e,a=r*(t*t-n)+n;return a<0?0:Math.sqrt(a)},XS=[RN,ON,HN];function QS(e){const t=(e=>XS.find(t=>t.test(e)))(e);if(AS(Boolean(t),"'".concat(e,"' is not an animatable color. Use the equivalent color code instead.")),!Boolean(t))return!1;let r=t.parse(e);return t===HN&&(r=function(e){let{hue:t,saturation:r,lightness:n,alpha:a}=e;t/=360,r/=100,n/=100;let s=0,o=0,i=0;if(r){const e=n<.5?n*(1+r):n+r-n*r,a=2*n-e;s=KS(a,e,t+1/3),o=KS(a,e,t),i=KS(a,e,t-1/3)}else s=o=i=n;return{red:Math.round(255*s),green:Math.round(255*o),blue:Math.round(255*i),alpha:a}}(r)),r}const ZS=(e,t)=>{const r=QS(e),n=QS(t);if(!r||!n)return JS(e,t);const a=(0,Y.A)({},r);return e=>(a.red=YS(r.red,n.red,e),a.green=YS(r.green,n.green,e),a.blue=YS(r.blue,n.blue,e),a.alpha=GS(r.alpha,n.alpha,e),ON.transform(a))},$S=(e,t)=>r=>t(e(r)),ek=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce($S)},tk=new Set(["none","hidden"]);function rk(e,t){return r=>GS(e,t,r)}function nk(e){return"number"===typeof e?rk:"string"===typeof e?TS(e)?JS:GN.test(e)?ZS:ok:Array.isArray(e)?ak:"object"===typeof e?GN.test(e)?ZS:sk:JS}function ak(e,t){const r=[...e],n=r.length,a=e.map((e,r)=>nk(e)(e,t[r]));return e=>{for(let t=0;t<n;t++)r[t]=a[t](e);return r}}function sk(e,t){const r=(0,Y.A)((0,Y.A)({},e),t),n={};for(const a in r)void 0!==e[a]&&void 0!==t[a]&&(n[a]=nk(e[a])(e[a],t[a]));return e=>{for(const t in n)r[t]=n[t](e);return r}}const ok=(e,t)=>{const r=tS.createTransformer(t),n=QN(e),a=QN(t);return n.indexes.var.length===a.indexes.var.length&&n.indexes.color.length===a.indexes.color.length&&n.indexes.number.length>=a.indexes.number.length?tk.has(e)&&!a.values.length||tk.has(t)&&!n.values.length?function(e,t){return tk.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}(e,t):ek(ak(function(e,t){var r;const n=[],a={color:0,var:0,number:0};for(let s=0;s<t.values.length;s++){const o=t.types[s],i=e.indexes[o][a[o]],l=null!==(r=e.values[i])&&void 0!==r?r:0;n[s]=l,a[o]++}return n}(n,a),a.values),r):(AS(!0,"Complex values '".concat(e,"' and '").concat(t,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.")),JS(e,t))};function ik(e,t,r){if("number"===typeof e&&"number"===typeof t&&"number"===typeof r)return GS(e,t,r);return nk(e)(e,t)}function lk(e,t,r){const n=Math.max(t-5,0);return tN(r-e(n),t-n)}const ck={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},dk=.001;function uk(e){let t,r,{duration:n=ck.duration,bounce:a=ck.bounce,velocity:s=ck.velocity,mass:o=ck.mass}=e;AS(n<=Dj(ck.maxDuration),"Spring duration must be 10 seconds or less");let i=1-a;i=AN(ck.minDamping,ck.maxDamping,i),n=AN(ck.minDuration,ck.maxDuration,Mj(n)),i<1?(t=e=>{const t=e*i,r=t*n,a=t-s,o=mk(e,i),l=Math.exp(-r);return dk-a/o*l},r=e=>{const r=e*i*n,a=r*s+s,o=Math.pow(i,2)*Math.pow(e,2)*n,l=Math.exp(-r),c=mk(Math.pow(e,2),i);return(-t(e)+dk>0?-1:1)*((a-o)*l)/c}):(t=e=>Math.exp(-e*n)*((e-s)*n+1)-.001,r=e=>Math.exp(-e*n)*(n*n*(s-e)));const l=function(e,t,r){let n=r;for(let a=1;a<hk;a++)n-=e(n)/t(n);return n}(t,r,5/n);if(n=Dj(n),isNaN(l))return{stiffness:ck.stiffness,damping:ck.damping,duration:n};{const e=Math.pow(l,2)*o;return{stiffness:e,damping:2*i*Math.sqrt(o*e),duration:n}}}const hk=12;function mk(e,t){return e*Math.sqrt(1-t*t)}const pk=["duration","bounce"],fk=["stiffness","damping","mass"];function gk(e,t){return t.some(t=>void 0!==e[t])}function vk(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ck.visualDuration,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ck.bounce;const r="object"!==typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:a}=r;const s=r.keyframes[0],o=r.keyframes[r.keyframes.length-1],i={done:!1,value:s},{stiffness:l,damping:c,mass:d,duration:u,velocity:h,isResolvedFromDuration:m}=function(e){let t=(0,Y.A)({velocity:ck.velocity,stiffness:ck.stiffness,damping:ck.damping,mass:ck.mass,isResolvedFromDuration:!1},e);if(!gk(e,fk)&&gk(e,pk))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(1.2*r),a=n*n,s=2*AN(.05,1,1-(e.bounce||0))*Math.sqrt(a);t=(0,Y.A)((0,Y.A)({},t),{},{mass:ck.mass,stiffness:a,damping:s})}else{const r=uk(e);t=(0,Y.A)((0,Y.A)((0,Y.A)({},t),r),{},{mass:ck.mass}),t.isResolvedFromDuration=!0}return t}((0,Y.A)((0,Y.A)({},r),{},{velocity:-Mj(r.velocity||0)})),p=h||0,f=c/(2*Math.sqrt(l*d)),g=o-s,v=Mj(Math.sqrt(l/d)),x=Math.abs(g)<5;let b;if(n||(n=x?ck.restSpeed.granular:ck.restSpeed.default),a||(a=x?ck.restDelta.granular:ck.restDelta.default),f<1){const e=mk(v,f);b=t=>{const r=Math.exp(-f*v*t);return o-r*((p+f*v*g)/e*Math.sin(e*t)+g*Math.cos(e*t))}}else if(1===f)b=e=>o-Math.exp(-v*e)*(g+(p+v*g)*e);else{const e=v*Math.sqrt(f*f-1);b=t=>{const r=Math.exp(-f*v*t),n=Math.min(e*t,300);return o-r*((p+f*v*g)*Math.sinh(n)+e*g*Math.cosh(n))/e}}const y={calculatedDuration:m&&u||null,next:e=>{const t=b(e);if(m)i.done=e>=u;else{let r=0;f<1&&(r=0===e?Dj(p):lk(b,e,t));const s=Math.abs(r)<=n,l=Math.abs(o-t)<=a;i.done=s&&l}return i.value=i.done?o:t,i},toString:()=>{const e=Math.min(cj(y),lj),t=vj(t=>y.next(e*t).value,e,30);return e+"ms "+t}};return y}function xk(e){let{keyframes:t,velocity:r=0,power:n=.8,timeConstant:a=325,bounceDamping:s=10,bounceStiffness:o=500,modifyTarget:i,min:l,max:c,restDelta:d=.5,restSpeed:u}=e;const h=t[0],m={done:!1,value:h},p=e=>void 0===l?c:void 0===c||Math.abs(l-e)<Math.abs(c-e)?l:c;let f=n*r;const g=h+f,v=void 0===i?g:i(g);v!==g&&(f=v-h);const x=e=>-f*Math.exp(-e/a),b=e=>v+x(e),y=e=>{const t=x(e),r=b(e);m.done=Math.abs(t)<=d,m.value=m.done?v:r};let w,j;const N=e=>{(e=>void 0!==l&&e<l||void 0!==c&&e>c)(m.value)&&(w=e,j=vk({keyframes:[m.value,p(m.value)],velocity:lk(b,e,m.value),damping:s,stiffness:o,restDelta:d,restSpeed:u}))};return N(0),{calculatedDuration:null,next:e=>{let t=!1;return j||void 0!==w||(t=!0,y(e),N(e)),void 0!==w&&e>=w?j.next(e-w):(!t&&y(e),m)}}}const bk=pN(.42,0,1,1),yk=pN(0,0,.58,1),wk=pN(.42,0,.58,1),jk={linear:Oj,easeIn:bk,easeInOut:wk,easeOut:yk,circIn:wN,circInOut:NN,circOut:jN,backIn:xN,backInOut:bN,backOut:vN,anticipate:yN},Nk=e=>{if(hj(e)){CS(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[t,r,n,a]=e;return pN(t,r,n,a)}return"string"===typeof e?(CS(void 0!==jk[e],"Invalid easing type '".concat(e,"'")),jk[e]):e};function Sk(e,t){let{clamp:r=!0,ease:n,mixer:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=e.length;if(CS(s===t.length,"Both input and output ranges must be the same length"),1===s)return()=>t[0];if(2===s&&t[0]===t[1])return()=>t[1];const o=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=function(e,t,r){const n=[],a=r||ik,s=e.length-1;for(let o=0;o<s;o++){let r=a(e[o],e[o+1]);if(t){const e=Array.isArray(t)?t[o]||Oj:t;r=ek(e,r)}n.push(r)}return n}(t,n,a),l=i.length,c=r=>{if(o&&r<e[0])return t[0];let n=0;if(l>1)for(;n<e.length-2&&!(r<e[n+1]);n++);const a=gj(e[n],e[n+1],r);return i[n](a)};return r?t=>c(AN(e[0],e[s-1],t)):c}function kk(e){const t=[0];return function(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const a=gj(0,t,n);e.push(GS(r,1,a))}}(t,e.length-1),t}function Ak(e){let{duration:t=300,keyframes:r,times:n,ease:a="easeInOut"}=e;const s=(e=>Array.isArray(e)&&"number"!==typeof e[0])(a)?a.map(Nk):Nk(a),o={done:!1,value:r[0]},i=function(e,t){return e.map(e=>e*t)}(n&&n.length===r.length?n:kk(r),t),l=Sk(i,r,{ease:Array.isArray(s)?s:(c=r,d=s,c.map(()=>d||wk).splice(0,c.length-1))});var c,d;return{calculatedDuration:t,next:e=>(o.value=l(e),o.done=e>=t,o)}}const Ck=e=>{const t=t=>{let{timestamp:r}=t;return e(r)};return{start:()=>Hj.update(t,!0),stop:()=>Gj(t),now:()=>Kj.isProcessing?Kj.timestamp:Qj.now()}},Ek={decay:xk,inertia:xk,tween:Ak,keyframes:Ak,spring:vk},Pk=e=>e/100;class _k extends HS{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:t,motionValue:r,element:n,keyframes:a}=this.options,s=(null===n||void 0===n?void 0:n.KeyframeResolver)||kS;this.resolver=new s(a,(e,t)=>this.onKeyframesResolved(e,t),t,r,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:r=0,repeatDelay:n=0,repeatType:a,velocity:s=0}=this.options,o=dj(t)?t:Ek[t]||Ak;let i,l;o!==Ak&&"number"!==typeof e[0]&&(i=ek(Pk,ik(e[0],e[1])),e=[0,100]);const c=o((0,Y.A)((0,Y.A)({},this.options),{},{keyframes:e}));"mirror"===a&&(l=o((0,Y.A)((0,Y.A)({},this.options),{},{keyframes:[...e].reverse(),velocity:-s}))),null===c.calculatedDuration&&(c.calculatedDuration=cj(c));const{calculatedDuration:d}=c,u=d+n;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:i,calculatedDuration:d,resolvedDuration:u,totalDuration:u*(r+1)-n}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{resolved:r}=this;if(!r){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:n,generator:a,mirroredGenerator:s,mapPercentToKeyframes:o,keyframes:i,calculatedDuration:l,totalDuration:c,resolvedDuration:d}=r;if(null===this.startTime)return a.next(0);const{delay:u,repeat:h,repeatType:m,repeatDelay:p,onUpdate:f}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const g=this.currentTime-u*(this.speed>=0?1:-1),v=this.speed>=0?g<0:g>c;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let x=this.currentTime,b=a;if(h){const e=Math.min(this.currentTime,c)/d;let t=Math.floor(e),r=e%1;!r&&e>=1&&(r=1),1===r&&t--,t=Math.min(t,h+1);Boolean(t%2)&&("reverse"===m?(r=1-r,p&&(r-=p/d)):"mirror"===m&&(b=s)),x=AN(0,1,r)*d}const y=v?{done:!1,value:i[0]}:b.next(x);o&&(y.value=o(y.value));let{done:w}=y;v||null===l||(w=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const j=null===this.holdTime&&("finished"===this.state||"running"===this.state&&w);return j&&void 0!==n&&(y.value=qS(i,this.options,n)),f&&f(y.value),j&&this.finish(),y}get duration(){const{resolved:e}=this;return e?Mj(e.calculatedDuration):0}get time(){return Mj(this.currentTime)}set time(e){e=Dj(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Mj(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=Ck,onPlay:t,startTime:r}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),t&&t();const n=this.driver.now();null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=n):this.startTime=null!==r&&void 0!==r?r:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const Ik=new Set(["opacity","clipPath","filter","transform"]);const Tk=nj(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Lk=["onComplete","onUpdate","motionValue","element"],Dk=["motionValue","onUpdate","onComplete","element"];const Mk={anticipate:yN,backInOut:bN,circInOut:NN};class Ok extends HS{constructor(e){super(e);const{name:t,motionValue:r,element:n,keyframes:a}=this.options;this.resolver=new US(a,(e,t)=>this.onKeyframesResolved(e,t),t,r,n),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:r=300,times:n,ease:a,type:s,motionValue:o,name:i,startTime:l}=this.options;if(!o.owner||!o.owner.current)return!1;var c;if("string"===typeof a&&fj()&&a in Mk&&(a=Mk[a]),dj((c=this.options).type)||"spring"===c.type||!xj(c.ease)){const t=this.options,{onComplete:o,onUpdate:i,motionValue:l,element:c}=t,d=An(t,Lk),u=function(e,t){const r=new _k((0,Y.A)((0,Y.A)({},t),{},{keyframes:e,repeat:0,delay:0,isGenerator:!0}));let n={done:!1,value:e[0]};const a=[];let s=0;for(;!n.done&&s<2e4;)n=r.sample(s),a.push(n.value),s+=10;return{times:void 0,keyframes:a,duration:s-10,ease:"linear"}}(e,d);1===(e=u.keyframes).length&&(e[1]=e[0]),r=u.duration,n=u.times,a=u.ease,s="keyframes"}const d=function(e,t,r){let{delay:n=0,duration:a=300,repeat:s=0,repeatType:o="loop",ease:i="easeInOut",times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c={[t]:r};l&&(c.offset=l);const d=wj(i,a);return Array.isArray(d)&&(c.easing=d),e.animate(c,{delay:n,duration:a,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:s+1,direction:"reverse"===o?"alternate":"normal"})}(o.owner.current,i,e,(0,Y.A)((0,Y.A)({},this.options),{},{duration:r,times:n,ease:a}));return d.startTime=null!==l&&void 0!==l?l:this.calcStartTime(),this.pendingTimeline?(uj(d,this.pendingTimeline),this.pendingTimeline=void 0):d.onfinish=()=>{const{onComplete:r}=this.options;o.set(qS(e,this.options,t)),r&&r(),this.cancel(),this.resolveFinishedPromise()},{animation:d,duration:r,times:n,type:s,ease:a,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return Mj(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return Mj(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.currentTime=Dj(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return Oj;const{animation:r}=t;uj(r,e)}else this.pendingTimeline=e;return Oj}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:r,duration:n,type:a,ease:s,times:o}=e;if("idle"===t.playState||"finished"===t.playState)return;if(this.time){const e=this.options,{motionValue:t,onUpdate:i,onComplete:l,element:c}=e,d=An(e,Dk),u=new _k((0,Y.A)((0,Y.A)({},d),{},{keyframes:r,duration:n,type:a,ease:s,times:o,isGenerator:!0})),h=Dj(this.time);t.setWithVelocity(u.sample(h-10).value,u.sample(h).value,10)}const{onStop:i}=this.options;i&&i(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:r,repeatDelay:n,repeatType:a,damping:s,type:o}=e;if(!t||!t.owner||!(t.owner.current instanceof HTMLElement))return!1;const{onUpdate:i,transformTemplate:l}=t.owner.getProps();return Tk()&&r&&Ik.has(r)&&!i&&!l&&!n&&"mirror"!==a&&0!==s&&"inertia"!==o}}const Rk={type:"spring",stiffness:500,damping:25,restSpeed:10},Fk={type:"keyframes",duration:.8},Uk={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Bk=(e,t)=>{let{keyframes:r}=t;return r.length>2?Fk:Fj.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===r[1]?2*Math.sqrt(550):30,restSpeed:10}:Rk:Uk},zk=["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","elapsed"];const Wk=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;return o=>{const i=ij(n,e)||{},l=i.delay||n.delay||0;let{elapsed:c=0}=n;c-=Dj(l);let d=(0,Y.A)((0,Y.A)({keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity()},i),{},{delay:-c,onUpdate:e=>{t.set(e),i.onUpdate&&i.onUpdate(e)},onComplete:()=>{o(),i.onComplete&&i.onComplete()},name:e,motionValue:t,element:s?void 0:a});(function(e){let{when:t,delay:r,delayChildren:n,staggerChildren:a,staggerDirection:s,repeat:o,repeatType:i,repeatDelay:l,from:c,elapsed:d}=e,u=An(e,zk);return!!Object.keys(u).length})(i)||(d=(0,Y.A)((0,Y.A)({},d),Bk(e,d))),d.duration&&(d.duration=Dj(d.duration)),d.repeatDelay&&(d.repeatDelay=Dj(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let u=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(d.duration=0,0===d.delay&&(u=!0)),(hN||zj)&&(u=!0,d.duration=0,d.delay=0),u&&!s&&void 0!==t.get()){const e=qS(d.keyframes,i);if(void 0!==e)return Hj.update(()=>{d.onUpdate(e),d.onComplete()}),new oj([])}return!s&&Ok.supports(d)?new Ok(d):new _k(d)}},qk=["transition","transitionEnd"];function Vk(e,t){let{protectedKeys:r,needsAnimating:n}=e;const a=r.hasOwnProperty(t)&&!0!==n[t];return n[t]=!1,a}function Hk(e,t){let{delay:r=0,transitionOverride:n,type:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var s;let{transition:o=e.getDefaultTransition(),transitionEnd:i}=t,l=An(t,qk);n&&(o=n);const c=[],d=a&&e.animationState&&e.animationState.getState()[a];for(const u in l){const t=e.getValue(u,null!==(s=e.latestValues[u])&&void 0!==s?s:null),n=l[u];if(void 0===n||d&&Vk(d,u))continue;const a=(0,Y.A)({delay:r},ij(o||{},u));let i=!1;if(window.MotionHandoffAnimation){const t=uN(e);if(t){const e=window.MotionHandoffAnimation(t,u,Hj);null!==e&&(a.startTime=e,i=!0)}}lN(e,u),t.start(Wk(u,t,n,e.shouldReduceMotion&&Uj.has(u)?{type:!1}:a,e,i));const h=t.animation;h&&c.push(h)}return i&&Promise.all(c).then(()=>{Hj.update(()=>{i&&function(e,t){let r=ej(e,t)||{},{transitionEnd:n={},transition:a={}}=r,s=An(r,sN);s=(0,Y.A)((0,Y.A)({},s),n);for(const o in s)oN(e,o,Bj(s[o]))}(e,i)})}),c}function Gk(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n;const a=ej(e,t,"exit"===r.type?null===(n=e.presenceContext)||void 0===n?void 0:n.custom:void 0);let{transition:s=e.getDefaultTransition()||{}}=a||{};r.transitionOverride&&(s=r.transitionOverride);const o=a?()=>Promise.all(Hk(e,a,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:a=0,staggerChildren:o,staggerDirection:i}=s;return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5?arguments[5]:void 0;const o=[],i=(e.variantChildren.size-1)*n,l=1===a?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*n}:function(){return i-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*n};return Array.from(e.variantChildren).sort(Kk).forEach((e,n)=>{e.notify("AnimationStart",t),o.push(Gk(e,t,(0,Y.A)((0,Y.A)({},s),{},{delay:r+l(n)})).then(()=>e.notify("AnimationComplete",t)))}),Promise.all(o)}(e,t,a+n,o,i,r)}:()=>Promise.resolve(),{when:l}=s;if(l){const[e,t]="beforeChildren"===l?[o,i]:[i,o];return e().then(()=>t())}return Promise.all([o(),i(r.delay)])}function Kk(e,t){return e.sortNodePosition(t)}const Jk=rj.length;function Yk(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&Yk(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let r=0;r<Jk;r++){const n=rj[r],a=e.props[n];(Qw(a)||!1===a)&&(t[n]=a)}return t}const Xk=["transition","transitionEnd"],Qk=[...tj].reverse(),Zk=tj.length;function $k(e){return t=>Promise.all(t.map(t=>{let{animation:r,options:n}=t;return function(e,t){let r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const a=t.map(t=>Gk(e,t,n));r=Promise.all(a)}else if("string"===typeof t)r=Gk(e,t,n);else{const a="function"===typeof t?ej(e,t,n.custom):t;r=Promise.all(Hk(e,a,n))}return r.then(()=>{e.notify("AnimationComplete",t)})}(e,r,n)}))}function eA(e){let t=$k(e),r=nA(),n=!0;const a=t=>(r,n)=>{var a;const s=ej(e,n,"exit"===t?null===(a=e.presenceContext)||void 0===a?void 0:a.custom:void 0);if(s){const{transition:e,transitionEnd:t}=s,n=An(s,Xk);r=(0,Y.A)((0,Y.A)((0,Y.A)({},r),n),t)}return r};function s(s){const{props:o}=e,i=Yk(e.parent)||{},l=[],c=new Set;let d={},u=1/0;for(let t=0;t<Zk;t++){const h=Qk[t],m=r[h],p=void 0!==o[h]?o[h]:i[h],f=Qw(p),g=h===s?m.isActive:null;!1===g&&(u=t);let v=p===i[h]&&p!==o[h]&&f;if(v&&n&&e.manuallyAnimateOnMount&&(v=!1),m.protectedKeys=(0,Y.A)({},d),!m.isActive&&null===g||!p&&!m.prevProp||Jw(p)||"boolean"===typeof p)continue;const x=tA(m.prevProp,p);let b=x||h===s&&m.isActive&&!v&&f||t>u&&f,y=!1;const w=Array.isArray(p)?p:[p];let j=w.reduce(a(h),{});!1===g&&(j={});const{prevResolvedValues:N={}}=m,S=(0,Y.A)((0,Y.A)({},N),j),k=t=>{b=!0,c.has(t)&&(y=!0,c.delete(t)),m.needsAnimating[t]=!0;const r=e.getValue(t);r&&(r.liveStyle=!1)};for(const e in S){const t=j[e],r=N[e];if(d.hasOwnProperty(e))continue;let n=!1;n=Yw(t)&&Yw(r)?!Xw(t,r):t!==r,n?void 0!==t&&null!==t?k(e):c.add(e):void 0!==t&&c.has(e)?k(e):m.protectedKeys[e]=!0}m.prevProp=p,m.prevResolvedValues=j,m.isActive&&(d=(0,Y.A)((0,Y.A)({},d),j)),n&&e.blockInitialAnimation&&(b=!1);b&&(!(v&&x)||y)&&l.push(...w.map(e=>({animation:e,options:{type:h}})))}if(c.size){const t={};c.forEach(r=>{const n=e.getBaseTarget(r),a=e.getValue(r);a&&(a.liveStyle=!0),t[r]=null!==n&&void 0!==n?n:null}),l.push({animation:t})}let h=Boolean(l.length);return!n||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(h=!1),n=!1,h?t(l):Promise.resolve()}return{animateChanges:s,setActive:function(t,n){var a;if(r[t].isActive===n)return Promise.resolve();null===(a=e.variantChildren)||void 0===a||a.forEach(e=>{var r;return null===(r=e.animationState)||void 0===r?void 0:r.setActive(t,n)}),r[t].isActive=n;const o=s(t);for(const e in r)r[e].protectedKeys={};return o},setAnimateFunction:function(r){t=r(e)},getState:()=>r,reset:()=>{r=nA(),n=!0}}}function tA(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!Xw(t,e)}function rA(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function nA(){return{animate:rA(!0),whileInView:rA(),whileHover:rA(),whileTap:rA(),whileDrag:rA(),whileFocus:rA(),exit:rA()}}class aA{constructor(e){this.isMounted=!1,this.node=e}update(){}}let sA=0;const oA={animation:{Feature:class extends aA{constructor(e){super(e),e.animationState||(e.animationState=eA(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Jw(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends aA{constructor(){super(...arguments),this.id=sA++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const n=this.node.animationState.setActive("exit",!e);t&&!e&&n.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}};function iA(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function lA(e){return{point:{x:e.pageX,y:e.pageY}}}function cA(e,t,r,n){return iA(e,t,(e=>t=>Cj(t)&&e(t,lA(t)))(r),n)}const dA=(e,t)=>Math.abs(e-t);class uA{constructor(e,t){let{transformPagePoint:r,contextWindow:n,dragSnapToOrigin:a=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=pA(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,r=function(e,t){const r=dA(e.x,t.x),n=dA(e.y,t.y);return Math.sqrt(r**2+n**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!r)return;const{point:n}=e,{timestamp:a}=Kj;this.history.push((0,Y.A)((0,Y.A)({},n),{},{timestamp:a}));const{onStart:s,onMove:o}=this.handlers;t||(s&&s(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=hA(t,this.transformPagePoint),Hj.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:r,onSessionEnd:n,resumeAnimation:a}=this.handlers;if(this.dragSnapToOrigin&&a&&a(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const s=pA("pointercancel"===e.type?this.lastMoveEventInfo:hA(t,this.transformPagePoint),this.history);this.startEvent&&r&&r(e,s),n&&n(e,s)},!Cj(e))return;this.dragSnapToOrigin=a,this.handlers=t,this.transformPagePoint=r,this.contextWindow=n||window;const s=hA(lA(e),this.transformPagePoint),{point:o}=s,{timestamp:i}=Kj;this.history=[(0,Y.A)((0,Y.A)({},o),{},{timestamp:i})];const{onSessionStart:l}=t;l&&l(e,pA(s,this.history)),this.removeListeners=ek(cA(this.contextWindow,"pointermove",this.handlePointerMove),cA(this.contextWindow,"pointerup",this.handlePointerUp),cA(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Gj(this.updatePoint)}}function hA(e,t){return t?{point:t(e.point)}:e}function mA(e,t){return{x:e.x-t.x,y:e.y-t.y}}function pA(e,t){let{point:r}=e;return{point:r,delta:mA(r,gA(t)),offset:mA(r,fA(t)),velocity:vA(t,.1)}}function fA(e){return e[0]}function gA(e){return e[e.length-1]}function vA(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const a=gA(e);for(;r>=0&&(n=e[r],!(a.timestamp-n.timestamp>Dj(t)));)r--;if(!n)return{x:0,y:0};const s=Mj(a.timestamp-n.timestamp);if(0===s)return{x:0,y:0};const o={x:(a.x-n.x)/s,y:(a.y-n.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function xA(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function bA(e){return e.max-e.min}function yA(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=n,e.originPoint=GS(t.min,t.max,e.origin),e.scale=bA(r)/bA(t),e.translate=GS(r.min,r.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function wA(e,t,r,n){yA(e.x,t.x,r.x,n?n.originX:void 0),yA(e.y,t.y,r.y,n?n.originY:void 0)}function jA(e,t,r){e.min=r.min+t.min,e.max=e.min+bA(t)}function NA(e,t,r){e.min=t.min-r.min,e.max=e.min+bA(t)}function SA(e,t,r){NA(e.x,t.x,r.x),NA(e.y,t.y,r.y)}function kA(e,t,r){return{min:void 0!==t?e.min+t:void 0,max:void 0!==r?e.max+r-(e.max-e.min):void 0}}function AA(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}const CA=.35;function EA(e,t,r){return{min:PA(e,t),max:PA(e,r)}}function PA(e,t){return"number"===typeof e?e:e[t]||0}const _A=()=>({x:{min:0,max:0},y:{min:0,max:0}});function IA(e){return[e("x"),e("y")]}function TA(e){let{top:t,left:r,right:n,bottom:a}=e;return{x:{min:r,max:n},y:{min:t,max:a}}}function LA(e){return void 0===e||1===e}function DA(e){let{scale:t,scaleX:r,scaleY:n}=e;return!LA(t)||!LA(r)||!LA(n)}function MA(e){return DA(e)||OA(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function OA(e){return RA(e.x)||RA(e.y)}function RA(e){return e&&"0%"!==e}function FA(e,t,r){return r+t*(e-r)}function UA(e,t,r,n,a){return void 0!==a&&(e=FA(e,a,n)),FA(e,r,n)+t}function BA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;e.min=UA(e.min,t,r,n,a),e.max=UA(e.max,t,r,n,a)}function zA(e,t){let{x:r,y:n}=t;BA(e.x,r.translate,r.scale,r.originPoint),BA(e.y,n.translate,n.scale,n.originPoint)}const WA=.999999999999,qA=1.0000000000001;function VA(e,t){e.min=e.min+t,e.max=e.max+t}function HA(e,t,r,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;BA(e,t,r,GS(e.min,e.max,a),n)}function GA(e,t){HA(e.x,t.x,t.scaleX,t.scale,t.originX),HA(e.y,t.y,t.scaleY,t.scale,t.originY)}function KA(e,t){return TA(function(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}(e.getBoundingClientRect(),t))}const JA=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null},YA=new WeakMap;class XA{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e){let{snapToCursor:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:r}=this.visualElement;if(r&&!1===r.isPresent)return;const{dragSnapToOrigin:n}=this.getProps();this.panSession=new uA(e,{onSessionStart:e=>{const{dragSnapToOrigin:r}=this.getProps();r?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(lA(e).point)},onStart:(e,t)=>{const{drag:r,dragPropagation:n,onDragStart:a}=this.getProps();if(r&&!n&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(s=r)||"y"===s?jj[s]?null:(jj[s]=!0,()=>{jj[s]=!1}):jj.x||jj.y?null:(jj.x=jj.y=!0,()=>{jj.x=jj.y=!1}),!this.openDragLock))return;var s;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),IA(e=>{let t=this.getAxisMotionValue(e).get()||0;if(BN.test(t)){const{projection:r}=this.visualElement;if(r&&r.layout){const n=r.layout.layoutBox[e];if(n){t=bA(n)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),a&&Hj.postRender(()=>a(e,t)),lN(this.visualElement,"transform");const{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:r,dragDirectionLock:n,onDirectionLock:a,onDrag:s}=this.getProps();if(!r&&!this.openDragLock)return;const{offset:o}=t;if(n&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=null;Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x");return r}(o),void(null!==this.currentDirection&&a&&a(this.currentDirection));this.updateAxis("x",t.point,o),this.updateAxis("y",t.point,o),this.visualElement.render(),s&&s(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>IA(e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:n,contextWindow:JA(this.visualElement)})}stop(e,t){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:n}=t;this.startAnimation(n);const{onDragEnd:a}=this.getProps();a&&Hj.postRender(()=>a(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:n}=this.getProps();if(!r||!QA(e,n,this.currentDirection))return;const a=this.getAxisMotionValue(e);let s=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(s=function(e,t,r){let{min:n,max:a}=t;return void 0!==n&&e<n?e=r?GS(n,e,r.min):Math.max(e,n):void 0!==a&&e>a&&(e=r?GS(a,e,r.max):Math.min(e,a)),e}(s,this.constraints[e],this.elastic[e])),a.set(s)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,a=this.constraints;t&&xA(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!n)&&function(e,t){let{top:r,left:n,bottom:a,right:s}=t;return{x:kA(e.x,n,s),y:kA(e.y,r,a)}}(n.layoutBox,t),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:CA;return!1===e?e=0:!0===e&&(e=CA),{x:EA(e,"left","right"),y:EA(e,"top","bottom")}}(r),a!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&IA(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const r={};return void 0!==t.min&&(r.min=t.min-e.min),void 0!==t.max&&(r.max=t.max-e.min),r}(n.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!xA(e))return!1;const r=e.current;CS(null!==r,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const a=function(e,t,r){const n=KA(e,r),{scroll:a}=t;return a&&(VA(n.x,a.offset.x),VA(n.y,a.offset.y)),n}(r,n.root,this.visualElement.getTransformPagePoint());let s=function(e,t){return{x:AA(e.x,t.x),y:AA(e.y,t.y)}}(n.layout.layoutBox,a);if(t){const e=t(function(e){let{x:t,y:r}=e;return{top:r.min,right:t.max,bottom:r.max,left:t.min}}(s));this.hasMutatedConstraints=!!e,e&&(s=TA(e))}return s}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:n,dragTransition:a,dragSnapToOrigin:s,onDragTransitionEnd:o}=this.getProps(),i=this.constraints||{},l=IA(o=>{if(!QA(o,t,this.currentDirection))return;let l=i&&i[o]||{};s&&(l={min:0,max:0});const c=n?200:1e6,d=n?40:1e7,u=(0,Y.A)((0,Y.A)({type:"inertia",velocity:r?e[o]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10},a),l);return this.startAxisValueAnimation(o,u)});return Promise.all(l).then(o)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return lN(this.visualElement,e),r.start(Wk(e,r,0,t,this.visualElement,!1))}stopAnimation(){IA(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){IA(e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()})}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t="_drag".concat(e.toUpperCase()),r=this.visualElement.getProps(),n=r[t];return n||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){IA(t=>{const{drag:r}=this.getProps();if(!QA(t,r,this.currentDirection))return;const{projection:n}=this.visualElement,a=this.getAxisMotionValue(t);if(n&&n.layout){const{min:r,max:s}=n.layout.layoutBox[t];a.set(e[t]-GS(r,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!xA(t)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};IA(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const r=t.get();n[e]=function(e,t){let r=.5;const n=bA(e),a=bA(t);return a>n?r=gj(t.min,t.max-n,e.min):n>a&&(r=gj(e.min,e.max-a,t.min)),AN(0,1,r)}({min:r,max:r},this.constraints[e])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),IA(t=>{if(!QA(t,e,null))return;const r=this.getAxisMotionValue(t),{min:a,max:s}=this.constraints[t];r.set(GS(a,s,n[t]))})}addListeners(){if(!this.visualElement.current)return;YA.set(this.visualElement,this);const e=cA(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:r=!0}=this.getProps();t&&r&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();xA(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,n=r.addEventListener("measure",t);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Hj.read(t);const a=iA(window,"resize",()=>this.scalePositionWithinConstraints()),s=r.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:r}=e;this.isDragging&&r&&(IA(e=>{const r=this.getAxisMotionValue(e);r&&(this.originPoint[e]+=t[e].translate,r.set(r.get()+t[e].translate))}),this.visualElement.render())});return()=>{a(),e(),n(),s&&s()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:a=!1,dragElastic:s=CA,dragMomentum:o=!0}=e;return(0,Y.A)((0,Y.A)({},e),{},{drag:t,dragDirectionLock:r,dragPropagation:n,dragConstraints:a,dragElastic:s,dragMomentum:o})}}function QA(e,t,r){return(!0===t||t===e)&&(null===r||r===e)}const ZA=e=>(t,r)=>{e&&Hj.postRender(()=>e(t,r))};const $A=(0,o.createContext)(null);function eC(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=(0,o.useContext)($A);if(null===t)return[!0,null];const{isPresent:r,onExitComplete:n,register:a}=t,s=(0,o.useId)();(0,o.useEffect)(()=>{e&&a(s)},[e]);const i=(0,o.useCallback)(()=>e&&n&&n(s),[s,n,e]);return!r&&n?[!1,i]:[!0]}const tC=(0,o.createContext)({}),rC=(0,o.createContext)({}),nC={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function aC(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const sC={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!zN.test(e))return e;e=parseFloat(e)}const r=aC(e,t.target.x),n=aC(e,t.target.y);return"".concat(r,"% ").concat(n,"%")}},oC={correct:(e,t)=>{let{treeScale:r,projectionDelta:n}=t;const a=e,s=tS.parse(e);if(s.length>5)return a;const o=tS.createTransformer(e),i="number"!==typeof s[0]?1:0,l=n.x.scale*r.x,c=n.y.scale*r.y;s[0+i]/=l,s[1+i]/=c;const d=GS(l,c,.5);return"number"===typeof s[2+i]&&(s[2+i]/=d),"number"===typeof s[3+i]&&(s[3+i]/=d),o(s)}},iC={};const{schedule:lC,cancel:cC}=Vj(queueMicrotask,!1);class dC extends o.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:n}=this.props,{projection:a}=e;var s;s=hC,Object.assign(iC,s),a&&(t.group&&t.group.add(a),r&&r.register&&n&&r.register(a),a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions((0,Y.A)((0,Y.A)({},a.options),{},{onExitComplete:()=>this.safeToRemove()}))),nC.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:n,isPresent:a}=this.props,s=r.projection;return s?(s.isPresent=a,n||e.layoutDependency!==t||void 0===t?s.willUpdate():this.safeToRemove(),e.isPresent!==a&&(a?s.promote():s.relegate()||Hj.postRender(()=>{const e=s.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),lC.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:n}=e;n&&(n.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function uC(e){const[t,r]=eC(),n=(0,o.useContext)(tC);return(0,kt.jsx)(dC,(0,Y.A)((0,Y.A)({},e),{},{layoutGroup:n,switchLayoutGroup:(0,o.useContext)(rC),isPresent:t,safeToRemove:r}))}const hC={borderRadius:(0,Y.A)((0,Y.A)({},sC),{},{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:sC,borderTopRightRadius:sC,borderBottomLeftRadius:sC,borderBottomRightRadius:sC,boxShadow:oC};const mC=(e,t)=>e.depth-t.depth;class pC{constructor(){this.children=[],this.isDirty=!1}add(e){Zj(this.children,e),this.isDirty=!0}remove(e){$j(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(mC),this.isDirty=!1,this.children.forEach(e)}}function fC(e,t){const r=Qj.now(),n=a=>{let{timestamp:s}=a;const o=s-r;o>=t&&(Gj(n),e(o-t))};return Hj.read(n,!0),()=>Gj(n)}function gC(e){const t=iN(e)?e.get():e;return(e=>Boolean(e&&"object"===typeof e&&e.mix&&e.toValue))(t)?t.toValue():t}const vC=["TopLeft","TopRight","BottomLeft","BottomRight"],xC=vC.length,bC=e=>"string"===typeof e?parseFloat(e):e,yC=e=>"number"===typeof e||zN.test(e);function wC(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const jC=SC(0,.5,jN),NC=SC(.5,.95,Oj);function SC(e,t,r){return n=>n<e?0:n>t?1:r(gj(e,t,n))}function kC(e,t){e.min=t.min,e.max=t.max}function AC(e,t){kC(e.x,t.x),kC(e.y,t.y)}function CC(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function EC(e,t,r,n,a){return e=FA(e-=t,1/r,n),void 0!==a&&(e=FA(e,1/a,n)),e}function PC(e,t,r,n,a){let[s,o,i]=r;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;BN.test(t)&&(t=parseFloat(t),t=GS(o.min,o.max,t/100)-o.min);if("number"!==typeof t)return;let i=GS(s.min,s.max,n);e===s&&(i-=t),e.min=EC(e.min,t,r,i,a),e.max=EC(e.max,t,r,i,a)}(e,t[s],t[o],t[i],t.scale,n,a)}const _C=["x","scaleX","originX"],IC=["y","scaleY","originY"];function TC(e,t,r,n){PC(e.x,t,_C,r?r.x:void 0,n?n.x:void 0),PC(e.y,t,IC,r?r.y:void 0,n?n.y:void 0)}function LC(e){return 0===e.translate&&1===e.scale}function DC(e){return LC(e.x)&&LC(e.y)}function MC(e,t){return e.min===t.min&&e.max===t.max}function OC(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function RC(e,t){return OC(e.x,t.x)&&OC(e.y,t.y)}function FC(e){return bA(e.x)/bA(e.y)}function UC(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class BC{constructor(){this.members=[]}add(e){Zj(this.members,e),e.scheduleRender()}remove(e){if($j(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let r;for(let n=t;n>=0;n--){const e=this.members[n];if(!1!==e.isPresent){r=e;break}}return!!r&&(this.promote(r),!0)}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;!1===n&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const zC={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},WC="undefined"!==typeof window&&void 0!==window.MotionDebug,qC=["","X","Y","Z"],VC={visibility:"hidden"};let HC=0;function GC(e,t,r,n){const{latestValues:a}=t;a[e]&&(r[e]=a[e],t.setStaticValue(e,0),n&&(n[e]=0))}function KC(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=uN(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:t,layoutId:n}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Hj,!(t||n))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&KC(n)}function JC(e){let{attachResizeListener:t,defaultParent:r,measureScroll:n,checkIsScrollRoot:a,resetTransform:s}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===r||void 0===r?void 0:r();this.id=HC++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,WC&&(zC.totalNodes=zC.resolvedTargetDeltas=zC.recalculatedProjection=0),this.nodes.forEach(QC),this.nodes.forEach(aE),this.nodes.forEach(sE),this.nodes.forEach(ZC),WC&&window.MotionDebug.record(zC)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let r=0;r<this.path.length;r++)this.path[r].shouldResetTransform=!0;this.root===this&&(this.nodes=new pC)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new eN),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];t&&t.notify(...n)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.hasTreeAnimated;if(this.instance)return;var n;this.isSVG=(n=e)instanceof SVGElement&&"svg"!==n.tagName,this.instance=e;const{layoutId:a,layout:s,visualElement:o}=this.options;if(o&&!o.current&&o.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),r&&(s||a)&&(this.isLayoutDirty=!0),t){let r;const n=()=>this.root.updateBlockedByResize=!1;t(e,()=>{this.root.updateBlockedByResize=!0,r&&r(),r=fC(n,250),nC.hasAnimatedSinceResize&&(nC.hasAnimatedSinceResize=!1,this.nodes.forEach(nE))})}a&&this.root.registerSharedNode(a,this),!1!==this.options.animate&&o&&(a||s)&&this.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:r,hasRelativeTargetChanged:n,layout:a}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const s=this.options.transition||o.getDefaultTransition()||uE,{onLayoutAnimationStart:i,onLayoutAnimationComplete:l}=o.getProps(),c=!this.targetLayout||!RC(this.targetLayout,a)||n,d=!r&&n;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||d||r&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(t,d);const e=(0,Y.A)((0,Y.A)({},ij(s,"layout")),{},{onPlay:i,onComplete:l});(o.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e)}else r||nE(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=a})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Gj(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(oE),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&KC(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let a=0;a<this.path.length;a++){const e=this.path[a];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:r}=this.options;if(void 0===t&&!r)return;const n=this.getTransformTemplate();this.prevTransformTemplateValue=n?n(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(eE);this.isUpdating||this.nodes.forEach(tE),this.isUpdating=!1,this.nodes.forEach(rE),this.nodes.forEach(YC),this.nodes.forEach(XC),this.clearAllSnapshots();const e=Qj.now();Kj.delta=AN(0,1e3/60,e-Kj.timestamp),Kj.timestamp=e,Kj.isProcessing=!0,Jj.update.process(Kj),Jj.preRender.process(Kj),Jj.render.process(Kj),Kj.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,lC.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach($C),this.sharedNodes.forEach(iE)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Hj.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Hj.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let r=0;r<this.path.length;r++){this.path[r].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t){const t=a(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!s)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!DC(this.projectionDelta),r=this.getTransformTemplate(),n=r?r(this.latestValues,""):void 0,a=n!==this.prevTransformTemplateValue;e&&(t||MA(this.latestValues)||a)&&(s(this.instance,n),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let r=this.removeElementScroll(t);var n;return e&&(r=this.removeTransform(r)),pE((n=r).x),pE(n.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:r,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const r=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(gE))){const{scroll:e}=this.root;e&&(VA(r.x,e.offset.x),VA(r.y,e.offset.y))}return r}removeElementScroll(e){var t;const r={x:{min:0,max:0},y:{min:0,max:0}};if(AC(r,e),null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)return r;for(let n=0;n<this.path.length;n++){const t=this.path[n],{scroll:a,options:s}=t;t!==this.root&&a&&s.layoutScroll&&(a.wasRoot&&AC(r,e),VA(r.x,a.offset.x),VA(r.y,a.offset.y))}return r}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r={x:{min:0,max:0},y:{min:0,max:0}};AC(r,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&GA(r,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),MA(e.latestValues)&&GA(r,e.latestValues)}return MA(this.latestValues)&&GA(r,this.latestValues),r}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};AC(t,e);for(let r=0;r<this.path.length;r++){const e=this.path[r];if(!e.instance)continue;if(!MA(e.latestValues))continue;DA(e.latestValues)&&e.updateSnapshot();const n=_A();AC(n,e.measurePageBox()),TC(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,n)}return MA(this.latestValues)&&TC(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options=(0,Y.A)((0,Y.A)((0,Y.A)({},this.options),e),{},{crossfade:void 0===e.crossfade||e.crossfade})}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Kj.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const r=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=r.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=r.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=r.isSharedProjectionDirty);const n=Boolean(this.resumingFrom)||this!==r;if(!(e||n&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:a,layoutId:s}=this.options;if(this.layout&&(a||s)){if(this.resolvedRelativeTargetAt=Kj.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},SA(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),AC(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,i,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,i=this.relativeTarget,l=this.relativeParent.target,jA(o.x,i.x,l.x),jA(o.y,i.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):AC(this.target,this.layout.layoutBox),zA(this.target,this.targetDelta)):AC(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},SA(this.relativeTargetOrigin,this.target,e.target),AC(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}WC&&zC.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!DA(this.parent.latestValues)&&!OA(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),r=Boolean(this.resumingFrom)||this!==t;let n=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(n=!1),r&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===Kj.timestamp&&(n=!1),n)return;const{layout:a,layoutId:s}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!a&&!s)return;AC(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,i=this.treeScale.y;!function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=r.length;if(!a)return;let s,o;t.x=t.y=1;for(let i=0;i<a;i++){s=r[i],o=s.projectionDelta;const{visualElement:a}=s.options;a&&a.props.style&&"contents"===a.props.style.display||(n&&s.options.layoutScroll&&s.scroll&&s!==s.root&&GA(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,zA(e,o)),n&&MA(s.latestValues)&&GA(e,s.latestValues))}t.x<qA&&t.x>WA&&(t.x=1),t.y<qA&&t.y>WA&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,r),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(CC(this.prevProjectionDelta.x,this.projectionDelta.x),CC(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),wA(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===o&&this.treeScale.y===i&&UC(this.projectionDelta.x,this.prevProjectionDelta.x)&&UC(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),WC&&zC.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t;if(null===(t=this.options.visualElement)||void 0===t||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this.snapshot,n=r?r.latestValues:{},a=(0,Y.A)({},this.latestValues),s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const o={x:{min:0,max:0},y:{min:0,max:0}},i=(r?r.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(i&&!c&&!0===this.options.crossfade&&!this.path.some(dE));let u;this.animationProgress=0,this.mixTargetDelta=t=>{const r=t/1e3;lE(s.x,e.x,r),lE(s.y,e.y,r),this.setTargetDelta(s),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(SA(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,r,n){cE(e.x,t.x,r.x,n),cE(e.y,t.y,r.y,n)}(this.relativeTarget,this.relativeTargetOrigin,o,r),u&&function(e,t){return MC(e.x,t.x)&&MC(e.y,t.y)}(this.relativeTarget,u)&&(this.isProjectionDirty=!1),u||(u={x:{min:0,max:0},y:{min:0,max:0}}),AC(u,this.relativeTarget)),i&&(this.animationValues=a,function(e,t,r,n,a,s){a?(e.opacity=GS(0,void 0!==r.opacity?r.opacity:1,jC(n)),e.opacityExit=GS(void 0!==t.opacity?t.opacity:1,0,NC(n))):s&&(e.opacity=GS(void 0!==t.opacity?t.opacity:1,void 0!==r.opacity?r.opacity:1,n));for(let o=0;o<xC;o++){const a="border".concat(vC[o],"Radius");let s=wC(t,a),i=wC(r,a);void 0===s&&void 0===i||(s||(s=0),i||(i=0),0===s||0===i||yC(s)===yC(i)?(e[a]=Math.max(GS(bC(s),bC(i),n),0),(BN.test(i)||BN.test(s))&&(e[a]+="%")):e[a]=i)}(t.rotate||r.rotate)&&(e.rotate=GS(t.rotate||0,r.rotate||0,n))}(a,n,this.latestValues,r,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=r},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Gj(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Hj.update(()=>{nC.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,r){const n=iN(e)?e:aN(e);return n.start(Wk("",n,t,r)),n.animation}(0,1e3,(0,Y.A)((0,Y.A)({},e),{},{onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}})),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:r,layout:n,latestValues:a}=e;if(t&&r&&n){if(this!==e&&this.layout&&n&&fE(this.options.animationType,this.layout.layoutBox,n.layoutBox)){r=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=bA(this.layout.layoutBox.x);r.x.min=e.target.x.min,r.x.max=r.x.min+t;const n=bA(this.layout.layoutBox.y);r.y.min=e.target.y.min,r.y.max=r.y.min+n}AC(t,r),GA(t,a),wA(this.projectionDeltaWithTransform,this.layoutCorrected,t,a)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new BC);this.sharedNodes.get(e).add(t);const r=t.options.initialPromotionConfig;t.promote({transition:r?r.transition:void 0,preserveFollowOpacity:r&&r.shouldPreserveFollowOpacity?r.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=this.getStack();n&&n.promote(this,r),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:r}=e;if((r.z||r.rotate||r.rotateX||r.rotateY||r.rotateZ||r.skewX||r.skewY)&&(t=!0),!t)return;const n={};r.z&&GC("z",e,n,this.animationValues);for(let a=0;a<qC.length;a++)GC("rotate".concat(qC[a]),e,n,this.animationValues),GC("skew".concat(qC[a]),e,n,this.animationValues);e.render();for(const a in n)e.setStaticValue(a,n[a]),this.animationValues&&(this.animationValues[a]=n[a]);e.scheduleRender()}getProjectionStyles(e){var t,r;if(!this.instance||this.isSVG)return;if(!this.isVisible)return VC;const n={visibility:""},a=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,n.opacity="",n.pointerEvents=gC(null===e||void 0===e?void 0:e.pointerEvents)||"",n.transform=a?a(this.latestValues,""):"none",n;const s=this.getLead();if(!this.projectionDelta||!this.layout||!s.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=gC(null===e||void 0===e?void 0:e.pointerEvents)||""),this.hasProjected&&!MA(this.latestValues)&&(t.transform=a?a({},""):"none",this.hasProjected=!1),t}const o=s.animationValues||s.latestValues;this.applyTransformsToTarget(),n.transform=function(e,t,r){let n="";const a=e.x.translate/t.x,s=e.y.translate/t.y,o=(null===r||void 0===r?void 0:r.z)||0;if((a||s||o)&&(n="translate3d(".concat(a,"px, ").concat(s,"px, ").concat(o,"px) ")),1===t.x&&1===t.y||(n+="scale(".concat(1/t.x,", ").concat(1/t.y,") ")),r){const{transformPerspective:e,rotate:t,rotateX:a,rotateY:s,skewX:o,skewY:i}=r;e&&(n="perspective(".concat(e,"px) ").concat(n)),t&&(n+="rotate(".concat(t,"deg) ")),a&&(n+="rotateX(".concat(a,"deg) ")),s&&(n+="rotateY(".concat(s,"deg) ")),o&&(n+="skewX(".concat(o,"deg) ")),i&&(n+="skewY(".concat(i,"deg) "))}const i=e.x.scale*t.x,l=e.y.scale*t.y;return 1===i&&1===l||(n+="scale(".concat(i,", ").concat(l,")")),n||"none"}(this.projectionDeltaWithTransform,this.treeScale,o),a&&(n.transform=a(o,n.transform));const{x:i,y:l}=this.projectionDelta;n.transformOrigin="".concat(100*i.origin,"% ").concat(100*l.origin,"% 0"),s.animationValues?n.opacity=s===this?null!==(r=null!==(t=o.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==r?r:1:this.preserveOpacity?this.latestValues.opacity:o.opacityExit:n.opacity=s===this?void 0!==o.opacity?o.opacity:"":void 0!==o.opacityExit?o.opacityExit:0;for(const c in iC){if(void 0===o[c])continue;const{correct:e,applyTo:t}=iC[c],r="none"===n.transform?o[c]:e(o[c],s);if(t){const e=t.length;for(let a=0;a<e;a++)n[t[a]]=r}else n[c]=r}return this.options.layoutId&&(n.pointerEvents=s===this?gC(null===e||void 0===e?void 0:e.pointerEvents)||"":"none"),n}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()}),this.root.nodes.forEach(eE),this.root.sharedNodes.clear()}}}function YC(e){e.updateLayout()}function XC(e){var t;const r=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:n}=e.layout,{animationType:a}=e.options,s=r.source!==e.layout.source;"size"===a?IA(e=>{const n=s?r.measuredBox[e]:r.layoutBox[e],a=bA(n);n.min=t[e].min,n.max=n.min+a}):fE(a,r.layoutBox,t)&&IA(n=>{const a=s?r.measuredBox[n]:r.layoutBox[n],o=bA(t[n]);a.max=a.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[n].max=e.relativeTarget[n].min+o)});const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};wA(o,t,r.layoutBox);const i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};s?wA(i,e.applyTransform(n,!0),r.measuredBox):wA(i,t,r.layoutBox);const l=!DC(o);let c=!1;if(!e.resumeFrom){const n=e.getClosestProjectingParent();if(n&&!n.resumeFrom){const{snapshot:a,layout:s}=n;if(a&&s){const o={x:{min:0,max:0},y:{min:0,max:0}};SA(o,r.layoutBox,a.layoutBox);const i={x:{min:0,max:0},y:{min:0,max:0}};SA(i,t,s.layoutBox),RC(o,i)||(c=!0),n.options.layoutRoot&&(e.relativeTarget=i,e.relativeTargetOrigin=o,e.relativeParent=n)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:r,delta:i,layoutDelta:o,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function QC(e){WC&&zC.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function ZC(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function $C(e){e.clearSnapshot()}function eE(e){e.clearMeasurements()}function tE(e){e.isLayoutDirty=!1}function rE(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function nE(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function aE(e){e.resolveTargetDelta()}function sE(e){e.calcProjection()}function oE(e){e.resetSkewAndRotation()}function iE(e){e.removeLeadSnapshot()}function lE(e,t,r){e.translate=GS(t.translate,0,r),e.scale=GS(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function cE(e,t,r,n){e.min=GS(t.min,r.min,n),e.max=GS(t.max,r.max,n)}function dE(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const uE={duration:.45,ease:[.4,0,.1,1]},hE=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),mE=hE("applewebkit/")&&!hE("chrome/")?Math.round:Oj;function pE(e){e.min=mE(e.min),e.max=mE(e.max)}function fE(e,t,r){return"position"===e||"preserve-aspect"===e&&!function(e,t,r){return Math.abs(e-t)<=r}(FC(t),FC(r),.2)}function gE(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const vE=JC({attachResizeListener:(e,t)=>iA(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),xE={current:void 0},bE=JC({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!xE.current){const e=new vE({});e.mount(window),e.setOptions({layoutScroll:!0}),xE.current=e}return xE.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),yE={pan:{Feature:class extends aA{constructor(){super(...arguments),this.removePointerDownListener=Oj}onPointerDown(e){this.session=new uA(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:JA(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:ZA(e),onStart:ZA(t),onMove:r,onEnd:(e,t)=>{delete this.session,n&&Hj.postRender(()=>n(e,t))}}}mount(){this.removePointerDownListener=cA(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends aA{constructor(e){super(e),this.removeGroupControls=Oj,this.removeListeners=Oj,this.controls=new XA(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Oj}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:bE,MeasureLayout:uC}};function wE(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover","Start"===r);const a=n["onHover"+r];a&&Hj.postRender(()=>a(t,lA(t)))}function jE(e,t,r){const{props:n}=e;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap","Start"===r);const a=n["onTap"+("End"===r?"":r)];a&&Hj.postRender(()=>a(t,lA(t)))}const NE=["root"],SE=new WeakMap,kE=new WeakMap,AE=e=>{const t=SE.get(e.target);t&&t(e)},CE=e=>{e.forEach(AE)};function EE(e,t,r){const n=function(e){let{root:t}=e,r=An(e,NE);const n=t||document;kE.has(n)||kE.set(n,{});const a=kE.get(n),s=JSON.stringify(r);return a[s]||(a[s]=new IntersectionObserver(CE,(0,Y.A)({root:t},r))),a[s]}(t);return SE.set(e,r),n.observe(e),()=>{SE.delete(e),n.unobserve(e)}}const PE={some:0,all:1};const _E={inView:{Feature:class extends aA{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:n="some",once:a}=e,s={root:t?t.current:void 0,rootMargin:r,threshold:"number"===typeof n?n:PE[n]};return EE(this.node.current,s,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,a&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:r,onViewportLeave:n}=this.node.getProps(),s=t?r:n;s&&s(e)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,r=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:r={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==r[e]}(e,t));r&&this.startObserver()}unmount(){}}},tap:{Feature:class extends aA{mount(){const{current:e}=this.node;e&&(this.unmount=Lj(e,e=>(jE(this.node,e,"Start"),(e,t)=>{let{success:r}=t;return jE(this.node,e,r?"End":"Cancel")}),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends aA{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(_t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ek(iA(this.node.current,"focus",()=>this.onFocus()),iA(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends aA{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[n,a,s]=Sj(e,r),o=kj(e=>{const{target:r}=e,n=t(e);if("function"!==typeof n||!r)return;const s=kj(e=>{n(e),r.removeEventListener("pointerleave",s)});r.addEventListener("pointerleave",s,a)});return n.forEach(e=>{e.addEventListener("pointerenter",o,a)}),s}(e,e=>(wE(this.node,e,"Start"),e=>wE(this.node,e,"End"))))}unmount(){}}}},IE={layout:{ProjectionNode:bE,MeasureLayout:uC}},TE=(0,o.createContext)({strict:!1}),LE=(0,o.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),DE=(0,o.createContext)({});function ME(e){return Jw(e.animate)||rj.some(t=>Qw(e[t]))}function OE(e){return Boolean(ME(e)||e.variants)}function RE(e){const{initial:t,animate:r}=function(e,t){if(ME(e)){const{initial:t,animate:r}=e;return{initial:!1===t||Qw(t)?t:void 0,animate:Qw(r)?r:void 0}}return!1!==e.inherit?t:{}}(e,(0,o.useContext)(DE));return(0,o.useMemo)(()=>({initial:t,animate:r}),[FE(t),FE(r)])}function FE(e){return Array.isArray(e)?e.join(" "):e}const UE="undefined"!==typeof window,BE={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},zE={};for(const ZI in BE)zE[ZI]={isEnabled:e=>BE[ZI].some(t=>!!e[t])};const WE=Symbol.for("motionComponentSymbol");function qE(e,t,r){return(0,o.useCallback)(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&("function"===typeof r?r(n):xA(r)&&(r.current=n))},[t])}const VE=UE?o.useLayoutEffect:o.useEffect;function HE(e,t,r,n,a){var s,i;const{visualElement:l}=(0,o.useContext)(DE),c=(0,o.useContext)(TE),d=(0,o.useContext)($A),u=(0,o.useContext)(LE).reducedMotion,h=(0,o.useRef)(null);n=n||c.renderer,!h.current&&n&&(h.current=n(e,{visualState:t,parent:l,props:r,presenceContext:d,blockInitialAnimation:!!d&&!1===d.initial,reducedMotionConfig:u}));const m=h.current,p=(0,o.useContext)(rC);!m||m.projection||!a||"html"!==m.type&&"svg"!==m.type||function(e,t,r,n){const{layoutId:a,layout:s,drag:o,dragConstraints:i,layoutScroll:l,layoutRoot:c}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:GE(e.parent)),e.projection.setOptions({layoutId:a,layout:s,alwaysMeasureLayout:Boolean(o)||i&&xA(i),visualElement:e,animationType:"string"===typeof s?s:"both",initialPromotionConfig:n,layoutScroll:l,layoutRoot:c})}(h.current,r,a,p);const f=(0,o.useRef)(!1);(0,o.useInsertionEffect)(()=>{m&&f.current&&m.update(r,d)});const g=r[dN],v=(0,o.useRef)(Boolean(g)&&!(null===(s=window.MotionHandoffIsComplete)||void 0===s?void 0:s.call(window,g))&&(null===(i=window.MotionHasOptimisedAnimation)||void 0===i?void 0:i.call(window,g)));return VE(()=>{m&&(f.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),lC.render(m.render),v.current&&m.animationState&&m.animationState.animateChanges())}),(0,o.useEffect)(()=>{m&&(!v.current&&m.animationState&&m.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,g)}),v.current=!1))}),m}function GE(e){if(e)return!1!==e.options.allowProjection?e.projection:GE(e.parent)}function KE(e){let{preloadedFeatures:t,createVisualElement:r,useRender:n,useVisualState:a,Component:s}=e;var i,l;function c(e,t){let i;const l=(0,Y.A)((0,Y.A)((0,Y.A)({},(0,o.useContext)(LE)),e),{},{layoutId:JE(e)}),{isStatic:c}=l,d=RE(e),u=a(e,c);if(!c&&UE){!function(){(0,o.useContext)(TE).strict;0}();const e=function(e){const{drag:t,layout:r}=zE;if(!t&&!r)return{};const n=(0,Y.A)((0,Y.A)({},t),r);return{MeasureLayout:(null===t||void 0===t?void 0:t.isEnabled(e))||(null===r||void 0===r?void 0:r.isEnabled(e))?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}(l);i=e.MeasureLayout,d.visualElement=HE(s,u,l,r,e.ProjectionNode)}return(0,kt.jsxs)(DE.Provider,{value:d,children:[i&&d.visualElement?(0,kt.jsx)(i,(0,Y.A)({visualElement:d.visualElement},l)):null,n(s,e,qE(u,d.visualElement,t),u,c,d.visualElement)]})}t&&function(e){for(const t in e)zE[t]=(0,Y.A)((0,Y.A)({},zE[t]),e[t])}(t),c.displayName="motion.".concat("string"===typeof s?s:"create(".concat(null!==(l=null!==(i=s.displayName)&&void 0!==i?i:s.name)&&void 0!==l?l:"",")"));const d=(0,o.forwardRef)(c);return d[WE]=s,d}function JE(e){let{layoutId:t}=e;const r=(0,o.useContext)(tC).id;return r&&void 0!==t?r+"-"+t:t}const YE=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function XE(e){return"string"===typeof e&&!e.includes("-")&&!!(YE.indexOf(e)>-1||/[A-Z]/.test(e))}function QE(e){const t=(0,o.useRef)(null);return null===t.current&&(t.current=e()),t.current}const ZE=["transitionEnd","transition"];const $E=e=>(t,r)=>{const n=(0,o.useContext)(DE),a=(0,o.useContext)($A),s=()=>function(e,t,r,n){let{scrapeMotionValuesFromProps:a,createRenderState:s,onUpdate:o}=e;const i={latestValues:eP(t,r,n,a),renderState:s()};return o&&(i.onMount=e=>o((0,Y.A)({props:t,current:e},i)),i.onUpdate=e=>o(e)),i}(e,t,n,a);return r?s():QE(s)};function eP(e,t,r,n){const a={},s=n(e,{});for(const h in s)a[h]=gC(s[h]);let{initial:o,animate:i}=e;const l=ME(e),c=OE(e);t&&c&&!l&&!1!==e.inherit&&(void 0===o&&(o=t.initial),void 0===i&&(i=t.animate));let d=!!r&&!1===r.initial;d=d||!1===o;const u=d?i:o;if(u&&"boolean"!==typeof u&&!Jw(u)){const t=Array.isArray(u)?u:[u];for(let r=0;r<t.length;r++){const n=$w(e,t[r]);if(n){const{transitionEnd:e,transition:t}=n,r=An(n,ZE);for(const n in r){let e=r[n];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(a[n]=e)}for(const n in e)a[n]=e[n]}}}return a}const tP=(e,t)=>t&&"number"===typeof e?t.transform(e):e,rP={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},nP=Rj.length;function aP(e,t,r){const{style:n,vars:a,transformOrigin:s}=e;let o=!1,i=!1;for(const l in t){const e=t[l];if(Fj.has(l))o=!0;else if(_S(l))a[l]=e;else{const t=tP(e,cS[l]);l.startsWith("origin")?(i=!0,s[l]=t):n[l]=t}}if(t.transform||(o||r?n.transform=function(e,t,r){let n="",a=!0;for(let s=0;s<nP;s++){const o=Rj[s],i=e[o];if(void 0===i)continue;let l=!0;if(l="number"===typeof i?i===(o.startsWith("scale")?1:0):0===parseFloat(i),!l||r){const e=tP(i,cS[o]);l||(a=!1,n+="".concat(rP[o]||o,"(").concat(e,") ")),r&&(t[o]=e)}}return n=n.trim(),r?n=r(t,a?"":n):a&&(n="none"),n}(t,e.transform,r):n.transform&&(n.transform="none")),i){const{originX:e="50%",originY:t="50%",originZ:r=0}=s;n.transformOrigin="".concat(e," ").concat(t," ").concat(r)}}const sP={offset:"stroke-dashoffset",array:"stroke-dasharray"},oP={offset:"strokeDashoffset",array:"strokeDasharray"};function iP(e,t,r){return"string"===typeof e?e:zN.transform(t+r*e)}const lP=["attrX","attrY","attrScale","originX","originY","pathLength","pathSpacing","pathOffset"];function cP(e,t,r,n){let{attrX:a,attrY:s,attrScale:o,originX:i,originY:l,pathLength:c,pathSpacing:d=1,pathOffset:u=0}=t;if(aP(e,An(t,lP),n),r)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:h,style:m,dimensions:p}=e;h.transform&&(p&&(m.transform=h.transform),delete h.transform),p&&(void 0!==i||void 0!==l||m.transform)&&(m.transformOrigin=function(e,t,r){const n=iP(t,e.x,e.width),a=iP(r,e.y,e.height);return"".concat(n," ").concat(a)}(p,void 0!==i?i:.5,void 0!==l?l:.5)),void 0!==a&&(h.x=a),void 0!==s&&(h.y=s),void 0!==o&&(h.scale=o),void 0!==c&&function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const s=a?sP:oP;e[s.offset]=zN.transform(-n);const o=zN.transform(t),i=zN.transform(r);e[s.array]="".concat(o," ").concat(i)}(h,c,d,u,!1)}const dP=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),uP=()=>(0,Y.A)((0,Y.A)({},{style:{},transform:{},transformOrigin:{},vars:{}}),{},{attrs:{}}),hP=e=>"string"===typeof e&&"svg"===e.toLowerCase();function mP(e,t,r,n){let{style:a,vars:s}=t;Object.assign(e.style,a,n&&n.getProjectionStyles(r));for(const o in s)e.style.setProperty(o,s[o])}const pP=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function fP(e,t,r,n){mP(e,t,void 0,n);for(const a in t.attrs)e.setAttribute(pP.has(a)?a:cN(a),t.attrs[a])}function gP(e,t){let{layout:r,layoutId:n}=t;return Fj.has(e)||e.startsWith("origin")||(r||void 0!==n)&&(!!iC[e]||"opacity"===e)}function vP(e,t,r){var n;const{style:a}=e,s={};for(const o in a)(iN(a[o])||t.style&&iN(t.style[o])||gP(o,e)||void 0!==(null===(n=null===r||void 0===r?void 0:r.getValue(o))||void 0===n?void 0:n.liveStyle))&&(s[o]=a[o]);return s}function xP(e,t,r){const n=vP(e,t,r);for(const a in e)if(iN(e[a])||iN(t[a])){n[-1!==Rj.indexOf(a)?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a]=e[a]}return n}const bP=["x","y","width","height","cx","cy","r"],yP={useVisualState:$E({scrapeMotionValuesFromProps:xP,createRenderState:uP,onUpdate:e=>{let{props:t,prevProps:r,current:n,renderState:a,latestValues:s}=e;if(!n)return;let o=!!t.drag;if(!o)for(const l in s)if(Fj.has(l)){o=!0;break}if(!o)return;let i=!r;if(r)for(let l=0;l<bP.length;l++){const e=bP[l];t[e]!==r[e]&&(i=!0)}i&&Hj.read(()=>{!function(e,t){try{t.dimensions="function"===typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(_t){t.dimensions={x:0,y:0,width:0,height:0}}}(n,a),Hj.render(()=>{cP(a,s,hP(n.tagName),t.transformTemplate),fP(n,a)})})}})},wP={useVisualState:$E({scrapeMotionValuesFromProps:vP,createRenderState:dP})};function jP(e,t,r){for(const n in t)iN(t[n])||gP(n,r)||(e[n]=t[n])}function NP(e,t){const r={};return jP(r,e.style||{},e),Object.assign(r,function(e,t){let{transformTemplate:r}=e;return(0,o.useMemo)(()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return aP(e,t,r),Object.assign({},e.vars,e.style)},[t])}(e,t)),r}function SP(e,t){const r={},n=NP(e,t);return e.drag&&!1!==e.dragListener&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=!0===e.drag?"none":"pan-".concat("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const kP=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function AP(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||kP.has(e)}let CP=e=>!AP(e);try{(EP=require("@emotion/is-prop-valid").default)&&(CP=e=>e.startsWith("on")?!AP(e):EP(e))}catch(yl){}var EP;function PP(e,t,r,n){const a=(0,o.useMemo)(()=>{const r=uP();return cP(r,t,hP(n),e.transformTemplate),(0,Y.A)((0,Y.A)({},r.attrs),{},{style:(0,Y.A)({},r.style)})},[t]);if(e.style){const t={};jP(t,e.style,e),a.style=(0,Y.A)((0,Y.A)({},t),a.style)}return a}function _P(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(t,r,n,a,s)=>{let{latestValues:i}=a;const l=(XE(t)?PP:SP)(r,i,s,t),c=function(e,t,r){const n={};for(const a in e)"values"===a&&"object"===typeof e.values||(CP(a)||!0===r&&AP(a)||!t&&!AP(a)||e.draggable&&a.startsWith("onDrag"))&&(n[a]=e[a]);return n}(r,"string"===typeof t,e),d=t!==o.Fragment?(0,Y.A)((0,Y.A)((0,Y.A)({},c),l),{},{ref:n}):{},{children:u}=r,h=(0,o.useMemo)(()=>iN(u)?u.get():u,[u]);return(0,o.createElement)(t,(0,Y.A)((0,Y.A)({},d),{},{children:h}))}}function IP(e,t){return function(r){let{forwardMotionProps:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{forwardMotionProps:!1};const a=XE(r)?yP:wP;return KE((0,Y.A)((0,Y.A)({},a),{},{preloadedFeatures:e,useRender:_P(n),createVisualElement:t,Component:r}))}}const TP={current:null},LP={current:!1};const DP=[...RS,GN,tS],MP=new WeakMap;const OP=["willChange"],RP=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class FP{scrapeMotionValuesFromProps(e,t,r){return{}}constructor(e){let{parent:t,props:r,presenceContext:n,reducedMotionConfig:a,blockInitialAnimation:s,visualState:o}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=kS,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Qj.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Hj.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:d}=o;this.onUpdate=d,this.latestValues=l,this.baseTarget=(0,Y.A)({},l),this.initialValues=r.initial?(0,Y.A)({},l):{},this.renderState=c,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.options=i,this.blockInitialAnimation=Boolean(s),this.isControllingVariants=ME(r),this.isVariantNode=OE(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const u=this.scrapeMotionValuesFromProps(r,{},this),{willChange:h}=u,m=An(u,OP);for(const p in m){const e=m[p];void 0!==l[p]&&iN(e)&&e.set(l[p],!1)}}mount(e){this.current=e,MP.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),LP.current||function(){if(LP.current=!0,UE)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>TP.current=e.matches;e.addListener(t),t()}else TP.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||TP.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){MP.delete(this.current),this.projection&&this.projection.unmount(),Gj(this.notifyUpdate),Gj(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=Fj.has(e),n=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&Hj.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0)}),a=t.on("renderRequest",this.scheduleRender);let s;window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{n(),a(),s&&s(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in zE){const t=zE[e];if(!t)continue;const{isEnabled:r,Feature:n}=t;if(!this.features[e]&&n&&r(this.props)&&(this.features[e]=new n(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<RP.length;r++){const t=RP[r];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const n=e["on"+t];n&&(this.propEventSubscriptions[t]=this.on(t,n))}this.prevMotionValues=function(e,t,r){for(const n in t){const a=t[n],s=r[n];if(iN(a))e.addValue(n,a);else if(iN(s))e.addValue(n,aN(a,{owner:e}));else if(s!==a)if(e.hasValue(n)){const t=e.getValue(n);!0===t.liveStyle?t.jump(a):t.hasAnimated||t.set(a)}else{const t=e.getStaticValue(n);e.addValue(n,aN(void 0!==t?t:a,{owner:e}))}}for(const n in r)void 0===t[n]&&e.removeValue(n);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return void 0===r&&void 0!==t&&(r=aN(null===t?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){var r;let n=void 0===this.latestValues[e]&&this.current?null!==(r=this.getBaseTargetFromProps(this.props,e))&&void 0!==r?r:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return void 0!==n&&null!==n&&("string"===typeof n&&(ES(n)||SN(n))?n=parseFloat(n):!(e=>DP.find(OS(e)))(n)&&tS.test(t)&&(n=hS(e,t)),this.setBaseTarget(e,iN(n)?n.get():n)),iN(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:r}=this.props;let n;if("string"===typeof r||"object"===typeof r){const a=$w(this.props,r,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);a&&(n=a[e])}if(r&&void 0!==n)return n;const a=this.getBaseTargetFromProps(this.props,e);return void 0===a||iN(a)?void 0!==this.initialValues[e]&&void 0===n?void 0:this.baseTarget[e]:a}on(e,t){return this.events[e]||(this.events[e]=new eN),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.events[e].notify(...r)}}}class UP extends FP{constructor(){super(...arguments),this.KeyframeResolver=US}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:r,style:n}=t;delete r[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;iN(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent="".concat(e))}))}}class BP extends UP{constructor(){super(...arguments),this.type="html",this.renderInstance=mP}readValueFromInstance(e,t){if(Fj.has(t)){const e=uS(t);return e&&e.default||0}{const n=(r=e,window.getComputedStyle(r)),a=(_S(t)?n.getPropertyValue(t):n[t])||0;return"string"===typeof a?a.trim():a}var r}measureInstanceViewportBox(e,t){let{transformPagePoint:r}=t;return KA(e,r)}build(e,t,r){aP(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return vP(e,t,r)}}class zP extends UP{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=_A}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Fj.has(t)){const e=uS(t);return e&&e.default||0}return t=pP.has(t)?t:cN(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return xP(e,t,r)}build(e,t,r){cP(e,t,this.isSVGTag,r.transformTemplate)}renderInstance(e,t,r,n){fP(e,t,0,n)}mount(e){this.isSVGTag=hP(e.tagName),super.mount(e)}}const WP=(e,t)=>XE(e)?new zP(t):new BP(t,{allowProjection:e!==o.Fragment}),qP=Kw(IP((0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},oA),_E),yE),IE),WP));class VP extends o.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function HP(e){let{children:t,isPresent:r}=e;const n=(0,o.useId)(),a=(0,o.useRef)(null),s=(0,o.useRef)({width:0,height:0,top:0,left:0}),{nonce:i}=(0,o.useContext)(LE);return(0,o.useInsertionEffect)(()=>{const{width:e,height:t,top:o,left:l}=s.current;if(r||!a.current||!e||!t)return;a.current.dataset.motionPopId=n;const c=document.createElement("style");return i&&(c.nonce=i),document.head.appendChild(c),c.sheet&&c.sheet.insertRule('\n          [data-motion-pop-id="'.concat(n,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(o,"px !important;\n            left: ").concat(l,"px !important;\n          }\n        ")),()=>{document.head.removeChild(c)}},[r]),(0,kt.jsx)(VP,{isPresent:r,childRef:a,sizeRef:s,children:o.cloneElement(t,{ref:a})})}const GP=e=>{let{children:t,initial:r,isPresent:n,onExitComplete:a,custom:s,presenceAffectsLayout:i,mode:l}=e;const c=QE(KP),d=(0,o.useId)(),u=(0,o.useCallback)(e=>{c.set(e,!0);for(const t of c.values())if(!t)return;a&&a()},[c,a]),h=(0,o.useMemo)(()=>({id:d,initial:r,isPresent:n,custom:s,onExitComplete:u,register:e=>(c.set(e,!1),()=>c.delete(e))}),i?[Math.random(),u]:[n,u]);return(0,o.useMemo)(()=>{c.forEach((e,t)=>c.set(t,!1))},[n]),o.useEffect(()=>{!n&&!c.size&&a&&a()},[n]),"popLayout"===l&&(t=(0,kt.jsx)(HP,{isPresent:n,children:t})),(0,kt.jsx)($A.Provider,{value:h,children:t})};function KP(){return new Map}const JP=e=>e.key||"";function YP(e){const t=[];return o.Children.forEach(e,e=>{(0,o.isValidElement)(e)&&t.push(e)}),t}const XP=e=>{let{children:t,custom:r,initial:n=!0,onExitComplete:a,presenceAffectsLayout:s=!0,mode:i="sync",propagate:l=!1}=e;const[c,d]=eC(l),u=(0,o.useMemo)(()=>YP(t),[t]),h=l&&!c?[]:u.map(JP),m=(0,o.useRef)(!0),p=(0,o.useRef)(u),f=QE(()=>new Map),[g,v]=(0,o.useState)(u),[x,b]=(0,o.useState)(u);VE(()=>{m.current=!1,p.current=u;for(let e=0;e<x.length;e++){const t=JP(x[e]);h.includes(t)?f.delete(t):!0!==f.get(t)&&f.set(t,!1)}},[x,h.length,h.join("-")]);const y=[];if(u!==g){let e=[...u];for(let t=0;t<x.length;t++){const r=x[t],n=JP(r);h.includes(n)||(e.splice(t,0,r),y.push(r))}return"wait"===i&&y.length&&(e=y),b(YP(e)),void v(u)}const{forceRender:w}=(0,o.useContext)(tC);return(0,kt.jsx)(kt.Fragment,{children:x.map(e=>{const t=JP(e),o=!(l&&!c)&&(u===x||h.includes(t));return(0,kt.jsx)(GP,{isPresent:o,initial:!(m.current&&!n)&&void 0,custom:o?void 0:r,presenceAffectsLayout:s,mode:i,onExitComplete:o?void 0:()=>{if(!f.has(t))return;f.set(t,!0);let e=!0;f.forEach(t=>{t||(e=!1)}),e&&(null===w||void 0===w||w(),b(p.current),l&&(null===d||void 0===d||d()),a&&a())},children:e},t)})})},QP=e=>{let{notifications:t,colorMode:r}=e;const[n,a]=(0,o.useState)(!1),s=(null===t||void 0===t?void 0:t.filter(e=>!e.read).length)||0;return(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsxs)("button",{onClick:()=>a(!n),className:"relative p-2 rounded-lg transition-colors ".concat(r?"hover:bg-slate-700":"hover:bg-gray-100"),children:[(0,kt.jsx)(Ww,{className:"h-6 w-6 ".concat(r?"text-gray-300":"text-gray-600")}),s>0&&(0,kt.jsx)(qP.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:s>9?"9+":s})]}),(0,kt.jsx)(XP,{children:n&&(0,kt.jsxs)(qP.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},className:"absolute left-0 top-full mt-2 w-80 ".concat(r?"bg-slate-800 border-slate-700":"bg-white border-gray-200"," border rounded-xl shadow-xl z-50"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-4 border-b ".concat(r?"border-slate-700":"border-gray-200"),children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold ".concat(r?"text-white":"text-gray-900"),children:"Notifications"}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[s>0&&(0,kt.jsx)("button",{onClick:()=>{console.log("Marking all notifications as read")},className:"text-sm ".concat(r?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:"Mark all read"}),(0,kt.jsx)("button",{onClick:()=>a(!1),className:"p-1 rounded ".concat(r?"hover:bg-slate-700":"hover:bg-gray-100"),children:(0,kt.jsx)(Iw,{className:"h-4 w-4"})})]})]}),(0,kt.jsx)("div",{className:"max-h-96 overflow-y-auto",children:t&&t.length>0?(0,kt.jsx)("div",{className:"divide-y divide-gray-200",children:t.slice(0,10).map(e=>{const t=(e=>{switch(e){case"comment":return Vw;case"vote":return zw;case"status_change":return Rw;case"bug":return kw;default:return Ww}})(e.type),n=(e=>{switch(e){case"comment":return"text-blue-500";case"vote":return"text-green-500";case"status_change":return"text-purple-500";case"bug":return"text-red-500";default:return"text-gray-500"}})(e.type);return(0,kt.jsx)(qP.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"p-4 hover:bg-gray-50 transition-colors ".concat(e.read?"":r?"bg-blue-900/20":"bg-blue-50"),children:(0,kt.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0 ".concat(n),children:(0,kt.jsx)(t,{className:"h-5 w-5"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("p",{className:"text-sm font-medium ".concat(r?"text-white":"text-gray-900"),children:e.title}),!e.read&&(0,kt.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"})]}),(0,kt.jsx)("p",{className:"text-sm ".concat(r?"text-gray-300":"text-gray-600"," mt-1"),children:e.message}),(0,kt.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,kt.jsx)("span",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-500"),children:Ey(new Date(e.createdAt),{addSuffix:!0})}),!e.read&&(0,kt.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Marking notification as read:",t);var t},className:"text-xs ".concat(r?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:"Mark as read"})]})]})]})},e.id)})}):(0,kt.jsxs)("div",{className:"p-8 text-center",children:[(0,kt.jsx)(Ww,{className:"h-12 w-12 mx-auto mb-4 ".concat(r?"text-gray-600":"text-gray-400")}),(0,kt.jsx)("h3",{className:"text-lg font-medium ".concat(r?"text-gray-300":"text-gray-900"," mb-2"),children:"No notifications"}),(0,kt.jsx)("p",{className:"text-sm ".concat(r?"text-gray-400":"text-gray-500"),children:"You're all caught up! New notifications will appear here."})]})}),t&&t.length>10&&(0,kt.jsx)("div",{className:"p-4 border-t ".concat(r?"border-slate-700":"border-gray-200"),children:(0,kt.jsx)("button",{className:"w-full text-sm ".concat(r?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"),children:"View all notifications"})})]})})]})},ZP=Sw("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),$P=Sw("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),e_=Sw("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),t_=e=>{var t,r;let{feedback:n,currentUser:a,onClose:s,onStatusChange:i,colorMode:l}=e;const[c,d]=(0,o.useState)([]),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)([]),[f,g]=(0,o.useState)(!1),[v,x]=(0,o.useState)(!1),[b,y]=(0,o.useState)(!1),[w,j]=(0,o.useState)(!1),[N,S]=(0,o.useState)("");(0,o.useEffect)(()=>{(async()=>{try{const e=await Da.feedbackService.getComments(n.id);console.log("Comments loaded via API:",e.data),e.data&&e.data.success&&Array.isArray(e.data.data)?d(e.data.data):(console.error("Invalid comments response structure:",e.data),d([]))}catch(e){console.error("Failed to load comments:",e),d([])}})()},[n.id]),(0,o.useEffect)(()=>{const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]);const k="DEVELOPER"===(null===a||void 0===a?void 0:a.role)||"ADMIN"===(null===a||void 0===a?void 0:a.role),A=[{value:"OPEN",label:"Open",icon:Lw,color:"green"},{value:"IN_REVIEW",label:"In Review",icon:Mw,color:"yellow"},{value:"PLANNED",label:"Planned",icon:Rw,color:"blue"},{value:"IN_PROGRESS",label:"In Progress",icon:Ow,color:"purple"},{value:"DONE",label:"Done",icon:Rw,color:"green"},{value:"CLOSED",label:"Closed",icon:Fw,color:"gray"}],C=e=>{i(n.id,{assigneeId:e}),y(!1)},E=()=>{if(N.trim()){const e=[...n.tags||[],N.trim()];i(n.id,{tags:e}),S(""),j(!1)}},P=e=>new Promise((t,r)=>{const n=new FileReader;n.onload=e=>t(e.target.result),n.onerror=r,n.readAsDataURL(e)}),_=(e=>{switch(e){case"BUG":default:return kw;case"IMPROVEMENT":return Aw;case"IDEA":return Cw}})(n.type),I=(e=>{switch(e){case"BUG":return"red";case"IMPROVEMENT":return"blue";case"IDEA":return"green";default:return"gray"}})(n.type);return(0,kt.jsx)(qP.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-end z-50",onClick:s,children:(0,kt.jsxs)(qP.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"w-full max-w-2xl h-full ".concat(l?"bg-slate-800":"bg-white"," shadow-2xl"),onClick:e=>e.stopPropagation(),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b ".concat(l?"border-slate-700":"border-gray-200"),children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,kt.jsx)("div",{className:"p-2 rounded-lg bg-".concat(I,"-100"),children:(0,kt.jsx)(_,{className:"h-5 w-5 text-".concat(I,"-600")})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h2",{className:"text-xl font-bold ".concat(l?"text-white":"text-gray-900"),children:n.title}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-".concat(I,"-100 text-").concat(I,"-800"),children:n.type}),(0,kt.jsxs)("span",{className:"text-sm ".concat(l?"text-gray-400":"text-gray-500"),children:["#",n.id.slice(-6)]})]})]})]}),(0,kt.jsx)("button",{onClick:s,className:"p-2 rounded-lg transition-colors ".concat(l?"hover:bg-slate-700 text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-500 hover:text-gray-700"),title:"Close (Esc)",children:(0,kt.jsx)(Iw,{className:"h-6 w-6"})})]}),(0,kt.jsx)("div",{className:"flex-1 overflow-y-auto max-h-[calc(100vh-200px)]",children:(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsx)("div",{className:"prose max-w-none ".concat(l?"prose-invert":""),children:(0,kt.jsx)("div",{className:"whitespace-pre-wrap ".concat(l?"text-gray-300":"text-gray-700"),children:n.description})}),n.attachments&&Array.isArray(n.attachments)&&n.attachments.length>0&&(0,kt.jsxs)("div",{className:"mt-6",children:[(0,kt.jsxs)("h4",{className:"text-sm font-medium mb-3 ".concat(l?"text-gray-300":"text-gray-700"),children:["Attachments (",n.attachments.length,")"]}),(0,kt.jsx)("div",{className:"space-y-4",children:n.attachments.map((e,t)=>(0,kt.jsxs)("div",{className:"p-4 rounded-lg border ".concat(l?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"),children:[(0,kt.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[e.isImage?(0,kt.jsx)(Pw,{className:"h-4 w-4 text-blue-500"}):(0,kt.jsx)(_w,{className:"h-4 w-4 text-red-500"}),(0,kt.jsx)("span",{className:"text-sm font-medium ".concat(l?"text-white":"text-gray-900"),children:e.name||"Attachment ".concat(t+1)}),e.size&&(0,kt.jsxs)("span",{className:"text-xs ".concat(l?"text-gray-400":"text-gray-500"),children:["(",(e.size/1024/1024).toFixed(1),"MB)"]})]})}),e.isImage&&e.dataUrl&&(0,kt.jsx)("div",{className:"mt-3 rounded-lg overflow-hidden border border-gray-300 max-w-2xl",children:(0,kt.jsx)("img",{src:e.dataUrl,alt:e.name||"Attachment ".concat(t+1),className:"w-full h-auto max-h-96 object-contain cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{const t=window.open();t&&t.document.write("\n                                  <html>\n                                    <head><title>".concat(e.name||"Image",'</title></head>\n                                    <body style="margin: 0; padding: 20px; background: #1e1e1e; display: flex; justify-content: center; align-items: center; min-height: 100vh;">\n                                      <img src="').concat(e.dataUrl,'" style="max-width: 100%; height: auto; border-radius: 8px;" />\n                                    </body>\n                                  </html>\n                                '))}})})]},t))})]}),k&&(0,kt.jsxs)("div",{className:"mt-6 p-4 rounded-lg border border-blue-200 bg-blue-50",children:[(0,kt.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-3",children:"Developer Controls"}),(0,kt.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsxs)("button",{onClick:()=>x(!v),className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50",children:[(0,kt.jsx)("span",{className:"text-sm",children:"Status"}),(0,kt.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:n.status})]}),v&&(0,kt.jsx)("div",{className:"absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:A.map(e=>{const t=e.icon;return(0,kt.jsxs)("button",{onClick:()=>{return t=e.value,i(n.id,{status:t}),void x(!1);var t},className:"w-full flex items-center space-x-2 px-3 py-2 text-left hover:bg-gray-50",children:[(0,kt.jsx)(t,{className:"h-4 w-4"}),(0,kt.jsx)("span",{className:"text-sm",children:e.label})]},e.value)})})]}),(0,kt.jsx)("div",{className:"relative",children:(0,kt.jsx)("select",{value:n.severity||"MEDIUM",onChange:e=>{return t=e.target.value,void i(n.id,{severity:t});var t},className:"px-3 py-2 rounded-lg border border-gray-300 bg-white text-sm",children:[{value:"LOW",label:"Low",color:"green"},{value:"MEDIUM",label:"Medium",color:"yellow"},{value:"HIGH",label:"High",color:"orange"},{value:"CRITICAL",label:"Critical",color:"red"}].map(e=>(0,kt.jsx)("option",{value:e.value,children:e.label},e.value))})}),(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsxs)("button",{onClick:()=>y(!b),className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50",children:[(0,kt.jsx)(Hw,{className:"h-4 w-4"}),(0,kt.jsx)("span",{className:"text-sm",children:"Assign"})]}),b&&(0,kt.jsxs)("div",{className:"absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:[(0,kt.jsx)("button",{onClick:()=>C(null),className:"w-full flex items-center space-x-2 px-3 py-2 text-left hover:bg-gray-50",children:(0,kt.jsx)("span",{className:"text-sm",children:"Unassigned"})}),(0,kt.jsx)("button",{onClick:()=>C("dev1"),className:"w-full flex items-center space-x-2 px-3 py-2 text-left hover:bg-gray-50",children:(0,kt.jsx)("span",{className:"text-sm",children:"John Developer"})})]})]})]}),(0,kt.jsxs)("div",{className:"mt-3",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,kt.jsx)(Bw,{className:"h-4 w-4 text-gray-500"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Tags"}),(0,kt.jsx)("button",{onClick:()=>j(!w),className:"text-blue-500 hover:text-blue-600",children:(0,kt.jsx)(ZP,{className:"h-4 w-4"})})]}),(0,kt.jsx)("div",{className:"flex flex-wrap gap-2",children:null===(t=n.tags)||void 0===t?void 0:t.map((e,t)=>(0,kt.jsxs)("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-md text-xs bg-gray-100 text-gray-700",children:[(0,kt.jsx)("span",{children:e}),(0,kt.jsx)("button",{onClick:()=>(e=>{var t;const r=(null===(t=n.tags)||void 0===t?void 0:t.filter(t=>t!==e))||[];i(n.id,{tags:r})})(e),className:"text-gray-500 hover:text-red-500",children:(0,kt.jsx)(Iw,{className:"h-3 w-3"})})]},t))}),w&&(0,kt.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,kt.jsx)("input",{type:"text",value:N,onChange:e=>S(e.target.value),placeholder:"Add tag...",className:"flex-1 px-2 py-1 text-sm border border-gray-300 rounded",onKeyPress:e=>"Enter"===e.key&&E()}),(0,kt.jsx)("button",{onClick:E,className:"px-2 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Add"})]})]})]}),(0,kt.jsxs)("div",{className:"mt-8",children:[(0,kt.jsxs)("h4",{className:"text-lg font-semibold mb-4 ".concat(l?"text-white":"text-gray-900"),children:["Comments (",c.length,")"]}),console.log("Total comments in state:",c.length,c),(0,kt.jsx)("div",{className:"mb-6 p-4 rounded-lg border ".concat(l?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(l?"bg-slate-600 text-white":"bg-gray-200 text-gray-700"),children:(null===a||void 0===a||null===(r=a.name)||void 0===r?void 0:r.charAt(0))||"U"}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("textarea",{value:u,onChange:e=>h(e.target.value),onPaste:async e=>{var t;const r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;const n=[];for(let a=0;a<r.length;a++){const e=r[a];if(-1!==e.type.indexOf("image")){const t=e.getAsFile();if(t){const e=new File([t],"snippet-".concat(Date.now(),".png"),{type:t.type});n.push(e)}}}n.length>0&&(e.preventDefault(),await(async e=>{const t=[],r=[];for(const a of e){const e=a.size<=10485760,s=a.type.startsWith("image/");if(e&&s)try{const e=await P(a);t.push({name:a.name,type:a.type,size:a.size,dataUrl:e,isImage:!0})}catch(n){console.error("Error processing image:",n),r.push(a.name)}else r.push(a.name)}r.length>0&&gr.error("Some images were rejected. Only images up to 10MB are allowed."),t.length>0&&(p(e=>[...e,...t]),gr.success("Added ".concat(t.length," image(s)")))})(n),gr.success("Pasted ".concat(n.length," image(s) from clipboard")))},placeholder:"Add a comment... (You can paste images from clipboard)",rows:3,className:"w-full px-3 py-2 rounded-lg border ".concat(l?"bg-slate-600 border-slate-500 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")}),m.length>0&&(0,kt.jsx)("div",{className:"mt-2 space-y-2",children:m.map((e,t)=>(0,kt.jsxs)("div",{className:"relative inline-block rounded-lg overflow-hidden border ".concat(l?"border-slate-500":"border-gray-300"),children:[(0,kt.jsx)("img",{src:e.dataUrl,alt:e.name||"Attachment ".concat(t+1),className:"max-w-xs h-auto max-h-32 object-contain"}),(0,kt.jsx)("button",{type:"button",onClick:()=>(e=>{p(t=>t.filter((t,r)=>r!==e))})(t),className:"absolute top-1 right-1 p-1 rounded-full ".concat(l?"bg-slate-800 text-white":"bg-white text-gray-700"," hover:bg-red-500 hover:text-white transition-colors"),children:(0,kt.jsx)(Iw,{className:"h-3 w-3"})})]},t))}),(0,kt.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,kt.jsx)("div",{className:"text-xs ".concat(l?"text-gray-400":"text-gray-500"),children:"\ud83d\udca1 Tip: Paste images directly from clipboard (e.g., Windows Snipping Tool)"}),(0,kt.jsxs)("button",{onClick:async()=>{if(u.trim()||0!==m.length){g(!0);try{var e,t;let r=u.trim();if(m.length>0){const e=m.filter(e=>e.isImage&&e.dataUrl).map(e=>'<img src="'.concat(e.dataUrl,'" alt="').concat(e.name||"Image",'" style="max-width: 100%; height: auto; border-radius: 8px; margin: 8px 0;" />')).join("\n");r=r?r+"\n\n"+e:e}const a=await Da.feedbackService.addComment(n.id,{body:r,isDeveloper:k,parentId:null});if(console.log("Comment created via API:",a.data),console.log("Comment ID from API:",null===(e=a.data)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.id),console.log("Full comment object:",JSON.stringify(a.data,null,2)),!a.data||!a.data.success)return console.error("Invalid API response structure:",a.data),void gr.error("Invalid response from server");if(!a.data.data||!a.data.data.id)return console.error("Comment created but no ID returned from API:",a.data),void gr.error("Comment created but missing ID");const s=a.data.data;console.log("Adding comment to state:",s),d(e=>{const t=[s,...e];return console.log("Previous comments:",e),console.log("New comment being added:",s),console.log("New comments state:",t),console.log("New comments length:",t.length),t}),h(""),p([]),gr.success("Comment posted successfully!")}catch(r){console.error("Failed to submit comment:",r),gr.error("Failed to post comment. Please try again.")}finally{g(!1)}}},disabled:!u.trim()&&0===m.length||f,className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors ".concat(!u.trim()&&0===m.length||f?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),children:[(0,kt.jsx)($P,{className:"h-4 w-4"}),(0,kt.jsx)("span",{children:f?"Posting...":"Post Comment"})]})]})]})]})}),(0,kt.jsxs)("div",{className:"space-y-4",children:[console.log("Total comments in state:",c.length,c),Array.isArray(c)&&c.length>0?c.map((e,t)=>{var r,s,o,i,c,u,h;return console.log("Rendering comment:",e.id,"at index:",t),(0,kt.jsx)("div",{className:"p-4 rounded-lg border ".concat(e.isPinned?"border-yellow-300 bg-yellow-50":l?"bg-slate-700 border-slate-600":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"flex items-start space-x-3",children:[null!==(r=e.author)&&void 0!==r&&r.avatar?(0,kt.jsx)("img",{src:e.author.avatar,alt:(null===(s=e.author)||void 0===s?void 0:s.name)||"User",className:"w-8 h-8 rounded-full object-cover ".concat(e.isDeveloper?"border-2 border-blue-500":"border-2 border-gray-300"),onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):null,(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(e.isDeveloper?"bg-blue-500 text-white":l?"bg-slate-600 text-white":"bg-gray-200 text-gray-700"),style:{display:null!==(o=e.author)&&void 0!==o&&o.avatar?"none":"flex"},children:(null===(i=e.author)||void 0===i||null===(c=i.name)||void 0===c?void 0:c.charAt(0))||"U"}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("span",{className:"font-medium ".concat(l?"text-white":"text-gray-900"),children:(null===(u=e.author)||void 0===u?void 0:u.name)||"Anonymous"}),e.isDeveloper&&(0,kt.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Developer"}),e.isPinned&&(0,kt.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,kt.jsx)(e_,{className:"h-3 w-3 mr-1"}),"Pinned"]}),(0,kt.jsx)("span",{className:"text-xs ".concat(l?"text-gray-400":"text-gray-500"),children:(()=>{try{if(!e.createdAt)return"Just now";const t=new Date(e.createdAt);return isNaN(t.getTime())?"Just now":Ey(t,{addSuffix:!0})}catch(t){return"Just now"}})()})]}),(null===a||void 0===a?void 0:a.id)===(null===(h=e.author)||void 0===h?void 0:h.id)&&(0,kt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this comment? This action cannot be undone."))try{await Da.feedbackService.deleteComment(n.id,e),d(t=>t.filter(t=>t.id!==e)),gr.success("Comment deleted successfully")}catch(t){console.error("Failed to delete comment:",t),gr.error("Failed to delete comment. Please try again.")}})(e.id),className:"p-1.5 rounded-lg transition-colors ".concat(l?"hover:bg-red-900/20 text-red-400 hover:text-red-300":"hover:bg-red-50 text-red-600 hover:text-red-700"),title:"Delete this comment",children:(0,kt.jsx)(Iw,{className:"h-3 w-3"})})]}),(0,kt.jsx)("div",{className:"".concat(l?"text-gray-300":"text-gray-700"),children:e.body&&(e.body.includes("<img")||e.body.includes("data:image"))?(0,kt.jsx)("div",{dangerouslySetInnerHTML:{__html:e.body.replace(/\n/g,"<br>").replace(/&lt;img/g,"<img").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&")},className:"comment-content [&_img]:max-w-full [&_img]:h-auto [&_img]:rounded-lg [&_img]:my-2 [&_img]:block",style:{wordBreak:"break-word"}}):(0,kt.jsx)("div",{className:"whitespace-pre-wrap",children:e.body})})]})]})},e.id||"comment-".concat(t,"-").concat(Date.now()))}):(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)(Vw,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,kt.jsx)("p",{className:"text-gray-500",children:"No comments yet"}),(0,kt.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Be the first to comment on this feedback"})]})]})]})]})})]})})},r_=Sw("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),n_=Sw("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),a_=["DONE","CLOSED"],s_=e=>{let{colorMode:t,currentUser:r}=e;const n=Ct(),[a,s]=(0,o.useState)("active"),[i,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)({status:"all",severity:"all",dateRange:"all",sortBy:"newest"}),[f,g]=(0,o.useState)(""),{data:v,isLoading:x,error:b}=Pa({queryKey:["feedback",a,m,f],queryFn:async()=>{const e=(0,Y.A)((0,Y.A)({},m),{},{search:f});if("completed"===a)e.status="archived";else if("active"!==a){const t={bugs:"BUG",improvements:"IMPROVEMENT",ideas:"IDEA",mine:"MINE",following:"FOLLOWING"};e.type=t[a]||a.toUpperCase()}"completed"!==a&&(e.excludeArchived=!0);return(await Da.feedbackService.getFeedback(e)).data}}),{data:y}=Pa({queryKey:["notifications",null===r||void 0===r?void 0:r.id],queryFn:async()=>{try{return await Da.feedbackService.getNotifications(null===r||void 0===r?void 0:r.id)}catch(b){return await vw(null===r||void 0===r?void 0:r.id)}},enabled:!(null===r||void 0===r||!r.id)}),w=La({mutationFn:async e=>(await Da.feedbackService.createFeedback(e)).data,onSuccess:e=>{gr.success("Feedback submitted successfully!"),n.invalidateQueries(["feedback"])},onError:e=>{console.error("Failed to submit feedback:",e),gr.error("Failed to submit feedback. Please try again.")}}),j=La({mutationFn:async e=>{let{feedbackId:t,action:r}=e;return(await Da.feedbackService.vote(t,r)).data},onSuccess:()=>{n.invalidateQueries(["feedback"])}}),N=La({mutationFn:async e=>{let{feedbackId:t,status:r,assigneeId:n,tags:a}=e;return(await Da.feedbackService.updateStatus(t,{status:r,assigneeId:n,tags:a})).data},onSuccess:(e,t)=>{if(n.invalidateQueries(["feedback"]),c&&c.id===t.feedbackId){const e=(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},c),t.status&&{status:t.status}),void 0!==t.assigneeId&&{assigneeId:t.assigneeId}),t.tags&&{tags:t.tags});d(e),t.status&&a_.includes(t.status)?(gr.success("Thread marked as ".concat(t.status," and moved to Archive")),l(!1),d(null)):gr.success("Status updated successfully")}else gr.success("Status updated successfully")},onError:e=>{console.error("Failed to update status:",e),gr.error("Failed to update status. Please try again.")}}),S=La({mutationFn:async e=>(await Da.feedbackService.deleteFeedback(e)).data,onSuccess:()=>{n.invalidateQueries(["feedback"]),gr.success("Feedback deleted successfully")},onError:e=>{console.error("Failed to delete feedback:",e),gr.error("Failed to delete feedback. Please try again.")}}),k=La({mutationFn:async e=>{let{feedbackId:t,shouldFollow:r}=e;if(r){return(await Da.feedbackService.follow(t)).data}return(await Da.feedbackService.unfollow(t)).data},onSuccess:()=>{n.invalidateQueries(["feedback"])}}),A=async e=>{await S.mutateAsync(e)},C=(e,t)=>{j.mutate({feedbackId:e,action:t})},E=async(e,t)=>{await k.mutateAsync({feedbackId:e,shouldFollow:t})},P=Array.isArray(null===v||void 0===v?void 0:v.data)?v.data:[],_=Array.isArray(y)?y.filter(e=>!e.read):[];return(0,kt.jsxs)("div",{className:"min-h-screen ".concat(t?"bg-slate-900":"bg-gray-50"),children:[(0,kt.jsx)("div",{className:"border-b ".concat(t?"bg-slate-800 border-slate-700":"bg-white border-gray-200"),children:(0,kt.jsx)("div",{className:"px-4 py-3",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,kt.jsx)(QP,{notifications:_,colorMode:t}),(0,kt.jsxs)("div",{className:"flex items-center space-x-1",children:[[{key:"active",label:"Active"},{key:"bugs",label:"Bugs"},{key:"improvements",label:"Improvements"},{key:"ideas",label:"Ideas"},{key:"mine",label:"Mine"},{key:"following",label:"Following"}].map(e=>(0,kt.jsx)("button",{onClick:()=>s(e.key),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat(a===e.key?t?"bg-blue-600 text-white":"bg-blue-500 text-white":t?"text-gray-300 hover:text-white hover:bg-slate-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:e.label},e.key)),(0,kt.jsx)("div",{className:"mx-2 h-6 w-px ".concat(t?"bg-slate-600":"bg-gray-300")}),(0,kt.jsxs)("button",{onClick:()=>s("completed"),className:"px-3 py-1 rounded text-sm font-medium transition-colors flex items-center gap-1.5 ".concat("completed"===a?t?"bg-green-600 text-white":"bg-green-500 text-white":t?"text-gray-300 hover:text-white hover:bg-slate-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[(0,kt.jsx)(Rw,{className:"h-3.5 w-3.5"}),"Completed"]})]})]}),(0,kt.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(t?"bg-blue-600 text-white hover:bg-blue-700":"bg-blue-500 text-white hover:bg-blue-600"),children:"Submit Feedback"})]})})}),(0,kt.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:[(0,kt.jsx)("div",{className:"mb-4",children:(0,kt.jsxs)("div",{className:"relative",children:[(0,kt.jsx)("input",{type:"text",placeholder:"Search feedback...",value:f,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(t?"bg-slate-800 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500")}),(0,kt.jsx)(r_,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"})]})}),(0,kt.jsx)("div",{className:"space-y-3",children:x?(0,kt.jsx)("div",{className:"space-y-3",children:[...Array(3)].map((e,r)=>(0,kt.jsxs)("div",{className:"animate-pulse ".concat(t?"bg-slate-800":"bg-white"," rounded-lg p-4"),children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,kt.jsx)("div",{className:"h-8 w-8 rounded-lg ".concat(t?"bg-slate-700":"bg-gray-200")}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("div",{className:"h-4 w-3/4 rounded ".concat(t?"bg-slate-700":"bg-gray-200"," mb-2")}),(0,kt.jsx)("div",{className:"h-3 w-1/2 rounded ".concat(t?"bg-slate-700":"bg-gray-200")})]})]}),(0,kt.jsx)("div",{className:"h-3 w-full rounded ".concat(t?"bg-slate-700":"bg-gray-200"," mb-2")}),(0,kt.jsx)("div",{className:"h-3 w-2/3 rounded ".concat(t?"bg-slate-700":"bg-gray-200")})]},r))}):0===P.length?(0,kt.jsx)("div",{className:"text-center py-8 ".concat(t?"text-gray-400":"text-gray-500"),children:"completed"===a?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(Rw,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),(0,kt.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No completed threads"}),(0,kt.jsx)("p",{children:"Threads marked as Done or Closed will appear here."})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(n_,{className:"h-8 w-8 mx-auto mb-3 opacity-50"}),(0,kt.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No feedback found"}),(0,kt.jsx)("p",{children:"Try adjusting your filters or search terms."})]})}):P.map(e=>(0,kt.jsx)(Gw,{feedback:e,onClick:()=>(e=>{d(e),l(!0)})(e),onDelete:A,onVote:C,onFollow:E,currentUser:r,colorMode:t},e.id))})]}),i&&c&&(0,kt.jsx)(t_,{feedback:c,onClose:()=>l(!1),onVote:C,onStatusChange:(e,t)=>{N.mutate((0,Y.A)({feedbackId:e},t))},colorMode:t,currentUser:r}),u&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,kt.jsxs)("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-hidden rounded-lg ".concat(t?"bg-slate-800":"bg-white"),children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between p-6 border-b ".concat(t?"border-slate-700":"border-gray-200"),children:[(0,kt.jsx)("h2",{className:"text-2xl font-bold ".concat(t?"text-white":"text-gray-900"),children:"Submit Feedback"}),(0,kt.jsx)("button",{onClick:()=>h(!1),className:"p-2 rounded-lg ".concat(t?"hover:bg-slate-700":"hover:bg-gray-100"),children:(0,kt.jsx)(Iw,{className:"h-6 w-6"})})]}),(0,kt.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:(0,kt.jsx)(Tw,{onSubmit:async e=>{await w.mutateAsync(e),h(!1)},onClose:()=>h(!1),colorMode:t,currentUser:r})})]})})]})},o_=e=>{let{onSuccess:t,onError:r}=e;return(0,kt.jsxs)("button",{onClick:()=>{try{window.location.href="/api/oauth/google"}catch(e){console.error("Google login error:",e),r&&r(e)}},className:"w-full flex items-center justify-center px-6 py-4 border-2 border-gray-200 rounded-xl shadow-md bg-white text-base font-semibold text-gray-700 hover:bg-gray-50 hover:shadow-lg hover:border-gray-300 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transform hover:scale-[1.02] active:scale-[0.98]",children:[(0,kt.jsxs)("svg",{className:"w-6 h-6 mr-3",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,kt.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,kt.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,kt.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,kt.jsx)("span",{className:"text-gray-800",children:"Continue with Google"})]})},i_=e=>{let{onLoginSuccess:t}=e;return(0,kt.jsxs)("div",{className:"min-h-screen bg-[#F8FAFC] flex items-center justify-center p-4 relative overflow-hidden",children:[(0,kt.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl p-10 max-w-md w-full border border-gray-100 relative z-10",children:[(0,kt.jsxs)("div",{className:"text-center mb-8",children:[(0,kt.jsx)("div",{className:"flex justify-center mb-6",children:(0,kt.jsx)("img",{src:"/bubbles-logo.png",alt:"Bubbles AI",className:"h-20 w-auto object-contain",onError:e=>{e.target.style.display="none"}})}),(0,kt.jsx)("h1",{className:"text-4xl font-bold text-[#111827] mb-3",children:"Welcome to Bubbles AI"}),(0,kt.jsx)("p",{className:"text-gray-600 text-lg",children:"Sign in with your Google account to get started"})]}),(0,kt.jsxs)("div",{className:"space-y-6",children:[(0,kt.jsx)(o_,{onSuccess:e=>{t&&t(e)},onError:e=>{console.error("Google login error:",e)}}),(0,kt.jsx)("div",{className:"text-center pt-4 border-t border-gray-100",children:(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Secure authentication powered by Google"})})]})]}),(0,kt.jsx)("style",{children:"\n        @keyframes blob {\n          0% {\n            transform: translate(0px, 0px) scale(1);\n          }\n          33% {\n            transform: translate(30px, -50px) scale(1.1);\n          }\n          66% {\n            transform: translate(-20px, 20px) scale(0.9);\n          }\n          100% {\n            transform: translate(0px, 0px) scale(1);\n          }\n        }\n        .animate-blob {\n          animation: blob 7s infinite;\n        }\n        .animation-delay-2000 {\n          animation-delay: 2s;\n        }\n        .animation-delay-4000 {\n          animation-delay: 4s;\n        }\n      "})]})},l_=()=>{const[e,t]=(0,o.useState)(""),[r,n]=(0,o.useState)(""),[a,s]=(0,o.useState)(!1),[i,l]=(0,o.useState)({type:"",text:""}),[c,d]=(0,o.useState)(!1),u=F();(0,o.useEffect)(()=>{h()},[]);const h=async()=>{const{data:{session:e},error:t}=await kn.supabase.auth.getSession();if(t)return console.error("Error checking recovery session:",t),void l({type:"error",text:"Invalid or expired reset link. Please request a new password reset."});e?d(!0):l({type:"error",text:"No valid reset session found. Please check your email for the reset link."})};return(0,kt.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"linear-gradient(135deg, rgba(26, 90, 153, 0.18), rgba(232, 240, 247, 0.9))"},children:(0,kt.jsxs)("div",{className:"rounded-2xl shadow-xl p-8 max-w-md w-full",style:{backgroundColor:"var(--color-surface-white)",boxShadow:"var(--shadow-medium)"},children:[(0,kt.jsxs)("div",{className:"text-center mb-8",children:[(0,kt.jsx)("div",{className:"mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4",style:{backgroundColor:"var(--color-primary-light-tint)",color:"var(--color-primary-blueprint-blue)"},children:(0,kt.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 011.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),(0,kt.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Reset Password"}),(0,kt.jsx)("p",{className:"text-gray-600",children:c?"Enter your new password below":"Checking reset link..."})]}),c?(0,kt.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),e===r)if(e.length<6)l({type:"error",text:"Password must be at least 6 characters long"});else{s(!0),l({type:"",text:""});try{await(0,kn.f3)(e),l({type:"success",text:"Password updated successfully! Redirecting to login..."}),t(""),n(""),setTimeout(()=>{u("/login")},3e3)}catch(o){console.error("Error updating password:",o),l({type:"error",text:o.message||"Failed to update password. Please try again."})}finally{s(!1)}}else l({type:"error",text:"Passwords do not match"})},children:[(0,kt.jsxs)("div",{className:"space-y-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),(0,kt.jsx)("input",{id:"newPassword",type:"password",value:e,onChange:e=>t(e.target.value),required:!0,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{borderColor:"var(--color-border-gray)",backgroundColor:"var(--color-surface-white)"},placeholder:"Enter new password",minLength:6,disabled:a}),(0,kt.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Minimum 6 characters"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),(0,kt.jsx)("input",{id:"confirmPassword",type:"password",value:r,onChange:e=>n(e.target.value),required:!0,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2",style:{borderColor:"var(--color-border-gray)",backgroundColor:"var(--color-surface-white)"},placeholder:"Confirm new password",minLength:6,disabled:a})]})]}),(0,kt.jsx)("button",{type:"submit",disabled:a||!e||!r,className:"btn btn-secondary w-full mt-6 disabled:opacity-50 disabled:cursor-not-allowed",children:a?(0,kt.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,kt.jsxs)("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",style:{color:"var(--color-surface-white)"},children:[(0,kt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,kt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating Password..."]}):"Update Password"})]}):(0,kt.jsxs)("div",{className:"text-center py-8",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 mx-auto",style:{borderBottom:"2px solid var(--color-primary-blueprint-blue)",borderTop:"2px solid transparent"}}),(0,kt.jsx)("p",{className:"mt-4 text-sm text-gray-600",children:"Validating reset link\u2026"})]}),i.text&&(0,kt.jsx)("div",{className:"mt-6 p-3 rounded-lg text-sm",style:{backgroundColor:"error"===i.type?"var(--color-danger-light-tint)":"success"===i.type?"rgba(16, 185, 129, 0.12)":"var(--color-primary-light-tint)",color:"error"===i.type?"var(--color-danger-red)":"success"===i.type?"var(--color-success-green)":"var(--color-primary-blueprint-blue)"},children:i.text}),c&&(0,kt.jsx)("div",{className:"mt-6 text-center",children:(0,kt.jsx)("button",{onClick:()=>u("/login"),className:"text-sm font-medium transition-colors",style:{color:"var(--color-primary-blueprint-blue)"},children:"Back to Login"})})]})})},c_=["title","titleId"];function d_(e,t){let{title:r,titleId:n}=e,a=An(e,c_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"}))}const u_=o.forwardRef(d_),h_=["title","titleId"];function m_(e,t){let{title:r,titleId:n}=e,a=An(e,h_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z"}))}const p_=o.forwardRef(m_),f_=["title","titleId"];function g_(e,t){let{title:r,titleId:n}=e,a=An(e,f_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}))}const v_=o.forwardRef(g_),x_=["title","titleId"];function b_(e,t){let{title:r,titleId:n}=e,a=An(e,x_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const y_=o.forwardRef(b_),w_=["title","titleId"];function j_(e,t){let{title:r,titleId:n}=e,a=An(e,w_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"}))}const N_=o.forwardRef(j_),S_=[{id:"ADMIN",name:"Administration",description:"Manage company settings, users, and overall system configuration",icon:u_,color:"bg-purple-500",features:["User Management","System Settings","Financial Controls","Company Configuration"]},{id:"FIELD_DIRECTOR",name:"Field Director",description:"Oversee field operations, crew management, and on-site project execution",icon:p_,color:"bg-orange-500",features:["Crew Management","Safety Oversight","Quality Control","Equipment Coordination"]},{id:"OFFICE_STAFF",name:"Office Staff",description:"Handle customer communications, scheduling, and administrative tasks",icon:v_,color:"bg-blue-500",features:["Customer Service","Scheduling","Documentation","Communication"]},{id:"OWNER",name:"Owner",description:"Full system access with advanced workflow customization and business controls",icon:y_,color:"bg-green-500",features:["Complete Access","Workflow Design","Business Analytics","Strategic Planning"],isOwner:!0},{id:"PROJECT_MANAGER",name:"Project Manager",description:"Coordinate project workflows, manage timelines, and oversee project delivery",icon:N_,color:"bg-indigo-500",features:["Project Coordination","Timeline Management","Resource Planning","Client Relations"]},{id:"LOCATION_MANAGER",name:"Location Manager",description:"Manage site-specific operations, coordinate with local teams, and oversee location-based project activities",icon:u_,color:"bg-teal-500",features:["Site Management","Local Coordination","Location Oversight","Regional Operations"]}],k_=e=>{let{onRoleSelected:t,loading:r=!1}=e;const[n,a]=(0,o.useState)(null),[s,i]=(0,o.useState)(null);return(0,kt.jsx)("div",{className:"min-h-screen bg-[#F8FAFC] flex items-center justify-center p-4",children:(0,kt.jsxs)("div",{className:"max-w-6xl w-full",children:[(0,kt.jsxs)("div",{className:"text-center mb-12",children:[(0,kt.jsx)("div",{className:"mx-auto w-16 h-16 bg-[var(--color-primary-blueprint-blue)] rounded-full flex items-center justify-center mb-6",children:(0,kt.jsx)(N_,{className:"w-8 h-8 text-white"})}),(0,kt.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Welcome to Kenstruction"}),(0,kt.jsx)("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Let's set up your account by selecting your role. This helps us customize your experience and provide the right tools for your work."})]}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:S_.map(e=>{const t=e.icon,r=n===e.id,o=s===e.id;return(0,kt.jsxs)("div",{className:"\n                  relative bg-white rounded-xl shadow-lg border-2 transition-all duration-300 cursor-pointer\n                  transform hover:scale-105 hover:shadow-xl\n                  ".concat(r?"border-blue-500 ring-4 ring-blue-200 shadow-xl scale-105":"border-gray-200 hover:border-gray-300","\n                  ").concat(e.isOwner?"ring-2 ring-green-200":"","\n                "),onClick:()=>{return t=e.id,void a(t);var t},onMouseEnter:()=>i(e.id),onMouseLeave:()=>i(null),children:[e.isOwner&&(0,kt.jsx)("div",{className:"absolute -top-3 -right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full",children:"RECOMMENDED"}),r&&(0,kt.jsx)("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,kt.jsxs)("div",{className:"p-6",children:[(0,kt.jsx)("div",{className:"w-16 h-16 ".concat(e.color," rounded-lg flex items-center justify-center mb-4 mx-auto transition-transform duration-300 ").concat(o?"scale-110":""),children:(0,kt.jsx)(t,{className:"w-8 h-8 text-white"})}),(0,kt.jsx)("h3",{className:"text-xl font-semibold text-gray-900 text-center mb-3",children:e.name}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm text-center mb-4 min-h-[3rem]",children:e.description}),(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Key Responsibilities"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[e.features.slice(0,3).map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,kt.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full mr-2 flex-shrink-0"}),e]},t)),e.features.length>3&&(0,kt.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["+",e.features.length-3," more..."]})]})]})]})]},e.id)})}),(0,kt.jsx)("div",{className:"flex justify-center space-x-4",children:(0,kt.jsx)("button",{onClick:()=>{n&&t&&t(n)},disabled:!n||r,className:"\n              px-8 py-3 rounded-lg font-semibold text-white transition-all duration-300\n              transform hover:scale-105 disabled:transform-none\n              ".concat(n&&!r?"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 shadow-lg hover:shadow-xl":"bg-gray-400 cursor-not-allowed","\n            "),children:r?(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,kt.jsx)("span",{children:"Setting up your account..."})]}):"Continue"})}),(0,kt.jsxs)("div",{className:"text-center mt-8",children:[(0,kt.jsx)("p",{className:"text-sm text-gray-500",children:"Don't worry, you can change your role later in the settings if needed."}),"OWNER"===n&&(0,kt.jsx)("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg max-w-md mx-auto",children:(0,kt.jsxs)("p",{className:"text-sm text-green-700",children:[(0,kt.jsx)("strong",{children:"Owner Role Selected:"})," You'll be guided through a quick setup process to customize your workflows and get the most out of the system."]})})]})]})})},A_=["title","titleId"];function C_(e,t){let{title:r,titleId:n}=e,a=An(e,A_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"}))}const E_=o.forwardRef(C_),P_=["title","titleId"];function __(e,t){let{title:r,titleId:n}=e,a=An(e,P_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12a7.5 7.5 0 0 0 15 0m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m16.5 0H21m-1.5 0H12m-8.457 3.077 1.41-.513m14.095-5.13 1.41-.513M5.106 17.785l1.15-.964m11.49-9.642 1.149-.964M7.501 19.795l.75-1.3m7.5-12.99.75-1.3m-6.063 16.658.26-1.477m2.605-14.772.26-1.477m0 17.726-.26-1.477M10.698 4.614l-.26-1.477M16.5 19.794l-.75-1.299M7.5 4.205 12 12m6.894 5.785-1.149-.964M6.256 7.178l-1.15-.964m15.352 8.864-1.41-.513M4.954 9.435l-1.41-.514M12.002 12l-3.75 6.495"}))}const I_=o.forwardRef(__),T_=["title","titleId"];function L_(e,t){let{title:r,titleId:n}=e,a=An(e,T_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}const D_=o.forwardRef(L_),M_=["title","titleId"];function O_(e,t){let{title:r,titleId:n}=e,a=An(e,M_);return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),r?o.createElement("title",{id:n},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"}))}const R_=o.forwardRef(O_),F_=[{id:"default",title:"Use Default Roofing Workflow",description:"Start with our proven roofing workflow that includes all standard phases and line items",icon:gg,color:"bg-green-500",features:["15 workflow phases from Lead to Completion","86 professionally named line items","Automated alerts and progression","Ready to use immediately"],recommended:!0},{id:"customize",title:"Customize Default Workflow",description:"Start with the default workflow but modify phases, sections, and line items to fit your process",icon:E_,color:"bg-blue-500",features:["Built on proven foundation","Add or remove phases","Customize line item names","Tailor to your specific needs"]},{id:"create",title:"Create New Workflow",description:"Build a completely custom workflow from scratch with your own phases and processes",icon:Db,color:"bg-purple-500",features:["Complete creative control","Define your own phases","Custom line items and sections","Advanced workflow design"],advanced:!0}],U_=e=>{let{onComplete:t,onBack:r,currentUser:n}=e;const[a,s]=(0,o.useState)(1),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(null),f=()=>(0,kt.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,kt.jsxs)("div",{className:"text-center mb-12",children:[(0,kt.jsx)("div",{className:"mx-auto w-16 h-16 bg-[var(--color-primary-blueprint-blue)] rounded-full flex items-center justify-center mb-6",children:(0,kt.jsx)(I_,{className:"w-8 h-8 text-white"})}),(0,kt.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Set Up Your Project Workflow"}),(0,kt.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Choose how you'd like to configure your project workflow system. This determines how your projects will be managed and tracked."})]}),(0,kt.jsx)("div",{className:"grid gap-6 mb-8",children:F_.map(e=>{const t=e.icon,r=i===e.id;return(0,kt.jsxs)("div",{className:"\n                relative bg-white rounded-xl border-2 p-6 cursor-pointer transition-all duration-300\n                hover:shadow-lg transform hover:scale-[1.02]\n                ".concat(r?"border-blue-500 ring-4 ring-blue-200 shadow-xl":"border-gray-200 hover:border-gray-300","\n              "),onClick:()=>l(e.id),children:[(0,kt.jsxs)("div",{className:"absolute top-4 right-4 flex space-x-2",children:[e.recommended&&(0,kt.jsx)("span",{className:"bg-green-100 text-green-700 text-xs font-medium px-3 py-1 rounded-full",children:"RECOMMENDED"}),e.advanced&&(0,kt.jsx)("span",{className:"bg-purple-100 text-purple-700 text-xs font-medium px-3 py-1 rounded-full",children:"ADVANCED"})]}),r&&(0,kt.jsx)("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,kt.jsxs)("div",{className:"flex items-start space-x-6",children:[(0,kt.jsx)("div",{className:"w-16 h-16 ".concat(e.color," rounded-lg flex items-center justify-center flex-shrink-0"),children:(0,kt.jsx)(t,{className:"w-8 h-8 text-white"})}),(0,kt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,kt.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:e.title}),(0,kt.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,kt.jsx)("div",{className:"grid grid-cols-2 gap-2",children:e.features.map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[(0,kt.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full mr-2 flex-shrink-0"}),e]},t))})]})]})]},e.id)})}),"create"===i&&(0,kt.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-6 mb-8",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Workflow Name"}),(0,kt.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Enter a name for your custom workflow (e.g., 'Premium Roofing Process')",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,kt.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Give your workflow a descriptive name that reflects your business process."})]})]}),g=()=>{const e=F_.find(e=>e.id===i);return(0,kt.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,kt.jsxs)("div",{className:"text-center mb-8",children:[(0,kt.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Workflow Setup Complete!"}),(0,kt.jsxs)("p",{className:"text-lg text-gray-600",children:["Your ",null===e||void 0===e?void 0:e.title.toLowerCase()," is ready to use."]})]}),(0,kt.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-8 mb-8",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,kt.jsx)("div",{className:"w-12 h-12 ".concat(null===e||void 0===e?void 0:e.color," rounded-lg flex items-center justify-center"),children:(0,kt.jsx)(e.icon,{className:"w-6 h-6 text-white"})}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"create"===i&&c?c:null===e||void 0===e?void 0:e.title}),(0,kt.jsx)("p",{className:"text-gray-600",children:null===e||void 0===e?void 0:e.description})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,kt.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:"15"}),(0,kt.jsx)("div",{className:"text-sm text-gray-600",children:"Workflow Phases"})]}),(0,kt.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-green-600 mb-1",children:"86"}),(0,kt.jsx)("div",{className:"text-sm text-gray-600",children:"Line Items"})]}),(0,kt.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,kt.jsx)("div",{className:"text-2xl font-bold text-purple-600 mb-1",children:"Auto"}),(0,kt.jsx)("div",{className:"text-sm text-gray-600",children:"Alert System"})]})]}),(0,kt.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,kt.jsx)("h4",{className:"font-semibold text-blue-900 mb-3",children:"What happens next:"}),(0,kt.jsxs)("div",{className:"space-y-2 text-sm text-blue-800",children:[(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)(gg,{className:"w-4 h-4 mr-2 text-blue-600"}),"Your workflow system will be activated"]}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)(gg,{className:"w-4 h-4 mr-2 text-blue-600"}),"All projects will use this workflow structure"]}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)(gg,{className:"w-4 h-4 mr-2 text-blue-600"}),"Automatic alerts will be enabled for line items"]}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)(gg,{className:"w-4 h-4 mr-2 text-blue-600"}),"You can customize workflows anytime in Settings"]})]})]})]})]})},v=async()=>{h(!0);try{const e={workflowOption:i,customWorkflowName:"create"===i?c:null,completedAt:(new Date).toISOString()};console.log("Completing onboarding with:",e),t&&t(e)}catch(e){console.error("Error completing onboarding:",e)}finally{h(!1)}},x=()=>1!==a||!!i&&!("create"===i&&!c.trim());return(0,kt.jsxs)("div",{className:"min-h-screen bg-[#F8FAFC] py-8 px-4",children:[(0,kt.jsx)("div",{className:"max-w-2xl mx-auto mb-8",children:(0,kt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(a>=1?"bg-[var(--color-primary-blueprint-blue)] text-white":"bg-gray-200 text-gray-600"),children:"1"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Workflow Selection"})]}),(0,kt.jsx)("div",{className:"flex-1 h-1 rounded ".concat(a>=2?"bg-[var(--color-primary-blueprint-blue)]":"bg-gray-200")}),(0,kt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(a>=2?"bg-[var(--color-primary-blueprint-blue)] text-white":"bg-gray-200 text-gray-600"),children:"2"}),(0,kt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Setup Complete"})]})]})}),(0,kt.jsx)("div",{className:"mb-8",children:1===a?(0,kt.jsx)(f,{}):(0,kt.jsx)(g,{})}),(0,kt.jsxs)("div",{className:"max-w-5xl mx-auto flex justify-between items-center",children:[(0,kt.jsxs)("button",{onClick:1===a?r:()=>s(1),className:"flex items-center space-x-2 px-6 py-3 text-gray-600 hover:text-gray-800 transition-colors",children:[(0,kt.jsx)(D_,{className:"w-4 h-4"}),(0,kt.jsx)("span",{children:"Back"})]}),(0,kt.jsx)("button",{onClick:async()=>{if(1===a){if(!i)return;if("create"===i&&!c.trim())return;h(!0);try{await new Promise(e=>setTimeout(e,1e3)),s(2)}catch(e){console.error("Error setting up workflow:",e)}finally{h(!1)}}else await v()},disabled:!x()||u,className:"\n            flex items-center space-x-2 px-8 py-3 rounded-lg font-semibold text-white transition-all duration-300\n            transform hover:scale-105 disabled:transform-none\n            ".concat(x()&&!u?"bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 shadow-lg hover:shadow-xl":"bg-gray-400 cursor-not-allowed","\n          "),children:u?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,kt.jsx)("span",{children:"Setting up..."})]}):1===a?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"Continue"}),(0,kt.jsx)(R_,{className:"w-4 h-4"})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("span",{children:"Complete Setup"}),(0,kt.jsx)(gg,{className:"w-4 h-4"})]})})]})]})},B_={ADMIN:"ADMIN",FIELD_DIRECTOR:"FOREMAN",OFFICE_STAFF:"WORKER",OWNER:"ADMIN",PROJECT_MANAGER:"PROJECT_MANAGER",LOCATION_MANAGER:"LOCATION_MANAGER"},z_=e=>{let{currentUser:t,onComplete:r}=e;const[n,a]=(0,o.useState)("role-selection"),[s,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)(null);(0,o.useEffect)(()=>{(null!==t&&void 0!==t&&t.hasCompletedOnboarding||"WORKER"!==(null===t||void 0===t?void 0:t.role))&&(null===r||void 0===r||r())},[t,r]);const h=async e=>{c(!0),u(null);try{const t=B_[e]||e,r=await Da.onboardingService.updateRole({role:t,onboardingRole:e,hasCompletedOnboarding:"OWNER"!==e});if(!r.success)throw new Error(r.message||"Failed to update user role");i(e),"OWNER"===e?a("owner-onboarding"):p({role:e,mappedRole:t,completedAt:(new Date).toISOString()})}catch(XI){console.error("Error updating user role:",XI),u("Failed to update your role. Please try again.")}finally{c(!1)}},m=async e=>{c(!0);try{const t=await Da.onboardingService.completeOnboarding({role:s,workflowSetup:e,completedAt:(new Date).toISOString()});if(!t.success)throw new Error(t.message||"Failed to complete onboarding");p({role:s,mappedRole:B_[s],workflowSetup:e,completedAt:(new Date).toISOString()})}catch(XI){console.error("Error completing onboarding:",XI),u("Failed to complete onboarding. Please try again."),c(!1)}},p=e=>{const n=(0,Y.A)((0,Y.A)({},t),{},{role:e.mappedRole,onboardingRole:e.role,hasCompletedOnboarding:!0,onboardingData:e});localStorage.setItem("user",JSON.stringify(n)),r&&r(e)},f=()=>{a("role-selection"),i(null),u(null)};if(d)return(0,kt.jsx)("div",{className:"min-h-screen bg-[#F8FAFC] flex items-center justify-center p-4",children:(0,kt.jsxs)("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center",children:[(0,kt.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,kt.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Setup Error"}),(0,kt.jsx)("p",{className:"text-gray-600 mb-6",children:d}),(0,kt.jsx)("button",{onClick:()=>{u(null),a("role-selection")},className:"w-full bg-[var(--color-primary-blueprint-blue)] hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors",children:"Try Again"})]})});switch(n){case"role-selection":return(0,kt.jsx)(k_,{onRoleSelected:h,loading:l});case"owner-onboarding":return(0,kt.jsx)(U_,{currentUser:t,onComplete:m,onBack:f});default:return null}},W_=e=>{let{colorMode:t}=e;const[r,n]=(0,o.useState)(""),[a,s]=(0,o.useState)({phone:"",secondaryPhone:"",preferredPhone:"",position:"",department:"",bio:""}),[i,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(!0),[u,h]=(0,o.useState)(""),[m,p]=(0,o.useState)(!1),[f,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{const e=new URLSearchParams(window.location.search).get("token");e?(n(e),v(e)):(h("Invalid setup link"),d(!1))},[]);const v=async e=>{try{const t=await fetch("".concat(Da.API_BASE_URL,"/auth/verify-setup-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),r=await t.json();r.success?(l(r.data.user),s(e=>(0,Y.A)((0,Y.A)({},e),{},{phone:r.data.user.phone||"",secondaryPhone:r.data.user.secondaryPhone||"",preferredPhone:r.data.user.preferredPhone||""}))):h(r.message||"Invalid or expired setup link")}catch(XI){h("Network error. Please try again."),console.error("Error verifying token:",XI)}finally{d(!1)}},x=e=>{const{name:t,value:r}=e.target;s(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:r}))},b=e=>{const{name:t,value:r}=e.target,n=r.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");s(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:n}))},y=e=>{const{value:t}=e.target;s(e=>(0,Y.A)((0,Y.A)({},e),{},{preferredPhone:t}))};return c?(0,kt.jsx)("div",{className:"min-h-screen ".concat(t?"bg-[#0f172a]":"bg-gray-50"," flex items-center justify-center"),children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,kt.jsx)("p",{className:"mt-4 text-gray-600",children:"Verifying setup link..."})]})}):m?(0,kt.jsx)("div",{className:"min-h-screen ".concat(t?"bg-[#0f172a]":"bg-gray-50"," flex items-center justify-center"),children:(0,kt.jsx)("div",{className:"max-w-md w-full mx-4 ".concat(t?"bg-slate-800":"bg-white"," rounded-lg shadow-lg p-8"),children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",children:(0,kt.jsx)("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Profile Setup Complete!"}),(0,kt.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Your profile has been successfully set up. You can now sign in with Google OAuth."}),(0,kt.jsx)("p",{className:"text-xs text-gray-500 mb-4",children:"Redirecting to login in 3 seconds..."}),(0,kt.jsx)("p",{className:"text-xs text-blue-600",children:'Remember: Use "Continue with Google" to sign in with your email address.'})]})})}):i?(0,kt.jsx)("div",{className:"min-h-screen ".concat(t?"bg-[#0f172a]":"bg-gray-50"," py-8"),children:(0,kt.jsx)("div",{className:"max-w-2xl mx-auto px-4",children:(0,kt.jsxs)("div",{className:"".concat(t?"bg-slate-800":"bg-white"," rounded-lg shadow-lg"),children:[(0,kt.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,kt.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Complete Your Profile Setup"}),(0,kt.jsxs)("p",{className:"text-gray-600 mt-1",children:["Welcome ",i.firstName,"! Please complete your profile to get started."]})]}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),h(""),!a.phone||!a.secondaryPhone||a.preferredPhone||(h("Please select which phone number is preferred for customer communications"),0)){g(!0);try{const e=await fetch("".concat(Da.API_BASE_URL,"/auth/complete-profile-setup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:r,phone:a.phone,secondaryPhone:a.secondaryPhone,preferredPhone:a.preferredPhone,position:a.position,department:a.department,bio:a.bio})}),t=await e.json();t.success?(p(!0),setTimeout(()=>{window.location.href="/login"},3e3)):h(t.message||"Failed to complete profile setup")}catch(XI){h("Network error. Please try again."),console.error("Error completing profile setup:",XI)}finally{g(!1)}}},className:"p-6 space-y-6",children:[u&&(0,kt.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,kt.jsxs)("div",{className:"flex",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,kt.jsx)("div",{className:"ml-3",children:(0,kt.jsx)("p",{className:"text-sm text-red-800",children:u})})]})}),(0,kt.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,kt.jsx)("h3",{className:"text-sm font-medium text-blue-800 mb-2",children:"Your Account Information"}),(0,kt.jsxs)("div",{className:"text-sm text-blue-700",children:[(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Name:"})," ",i.firstName," ",i.lastName]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Email:"})," ",i.email]}),(0,kt.jsxs)("p",{children:[(0,kt.jsx)("strong",{children:"Role:"})," ",i.role]})]}),(0,kt.jsx)("div",{className:"mt-3 pt-3 border-t border-blue-200",children:(0,kt.jsxs)("p",{className:"text-xs text-blue-600",children:[(0,kt.jsx)("strong",{children:"Note:"})," You'll sign in using Google OAuth with your email address (",i.email,"). No password needed!"]})})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Phone"}),(0,kt.jsx)("input",{type:"tel",id:"phone",name:"phone",value:a.phone,onChange:b,placeholder:"(555) 123-4567",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"secondaryPhone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Phone"}),(0,kt.jsx)("input",{type:"tel",id:"secondaryPhone",name:"secondaryPhone",value:a.secondaryPhone,onChange:b,placeholder:"(555) 123-4567",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(a.phone||a.secondaryPhone)&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Phone for Customer Communications"}),(0,kt.jsxs)("div",{className:"space-y-2",children:[a.phone&&(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"radio",name:"preferredPhone",value:a.phone,checked:a.preferredPhone===a.phone,onChange:y,className:"mr-2"}),(0,kt.jsxs)("span",{className:"text-sm text-gray-700",children:["Primary Phone: ",a.phone]})]}),a.secondaryPhone&&(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"radio",name:"preferredPhone",value:a.secondaryPhone,checked:a.preferredPhone===a.secondaryPhone,onChange:y,className:"mr-2"}),(0,kt.jsxs)("span",{className:"text-sm text-gray-700",children:["Secondary Phone: ",a.secondaryPhone]})]})]})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"position",className:"block text-sm font-medium text-gray-700 mb-2",children:"Position"}),(0,kt.jsx)("input",{type:"text",id:"position",name:"position",value:a.position,onChange:x,placeholder:"e.g., Project Manager, Foreman",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"department",className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),(0,kt.jsx)("input",{type:"text",id:"department",name:"department",value:a.department,onChange:x,placeholder:"e.g., Operations, Sales",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,kt.jsx)("textarea",{id:"bio",name:"bio",value:a.bio,onChange:x,placeholder:"Tell us a bit about yourself...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,kt.jsxs)("div",{className:"flex justify-end space-x-3 pt-6",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>window.location.href="/login",className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,kt.jsx)("button",{type:"submit",disabled:f,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:f?"Completing Setup...":"Complete Setup"})]})]})]})})}):(0,kt.jsx)("div",{className:"min-h-screen ".concat(t?"bg-[#0f172a]":"bg-gray-50"," flex items-center justify-center"),children:(0,kt.jsx)("div",{className:"max-w-md w-full mx-4 ".concat(t?"bg-slate-800":"bg-white"," rounded-lg shadow-lg p-8"),children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:(0,kt.jsx)("svg",{className:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,kt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Setup Link Invalid"}),(0,kt.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:u}),(0,kt.jsx)("button",{onClick:()=>window.location.href="/login",className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors",children:"Go to Login"})]})})})},q_=e=>{let{onLoginSuccess:t}=e;const r=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{if(r.current)return;(()=>{const e=new URLSearchParams(window.location.search),n=e.get("token"),a=e.get("user"),s=e.get("error");if(s)return console.error("OAuth error:",s),window.history.replaceState({},"","/"),void window.location.reload();if(n&&a)try{const e=JSON.parse(decodeURIComponent(a));localStorage.setItem("authToken",n),localStorage.setItem("user",JSON.stringify(e)),console.log("\u2705 Google OAuth successful:",e),console.log("\u2705 Token stored in localStorage:",n.substring(0,20)+"..."),console.log("\u2705 User stored:",e.email),r.current=!0,t?(console.log("\u2705 Calling onLoginSuccess handler with user:",e),console.log("\u2705 User object structure:",{hasId:!!e.id,hasFirstName:!!e.firstName,hasUserMetadata:!!e.user_metadata,email:e.email}),t(e),requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.history.replaceState({},"","/")})})):(window.history.replaceState({},"","/"),window.location.reload())}catch(o){console.error("Error parsing user data:",o),window.history.replaceState({},"","/"),window.location.reload()}else console.error("Missing token or user data",{token:!!n,userParam:!!a}),window.history.replaceState({},"","/"),window.location.reload()})()},[t]),(0,kt.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Completing Google authentication..."})]})})},V_=()=>(0,kt.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{verticalAlign:"middle"},children:[(0,kt.jsx)("path",{d:"M12 6.5L13.2 10.8L17.5 12L13.2 13.2L12 17.5L10.8 13.2L6.5 12L10.8 10.8L12 6.5Z",fill:"#3b82f6"}),(0,kt.jsx)("rect",{x:"17.5",y:"4.5",width:"2",height:"2",rx:"1",fill:"#3b82f6"}),(0,kt.jsx)("rect",{x:"17.5",y:"17.5",width:"2",height:"2",rx:"1",fill:"#3b82f6"})]}),H_=()=>(0,kt.jsxs)("div",{className:"flex items-center justify-center gap-1 mt-2 w-full",children:[(0,kt.jsx)("span",{className:"text-base font-semibold text-brand-500 tracking-wide",children:"AI-Powered"}),(0,kt.jsx)(V_,{})]});function G_(e){return Array.isArray?Array.isArray(e):"[object Array]"===$_(e)}function K_(e){return"string"===typeof e}function J_(e){return"number"===typeof e}function Y_(e){return!0===e||!1===e||function(e){return X_(e)&&null!==e}(e)&&"[object Boolean]"==$_(e)}function X_(e){return"object"===typeof e}function Q_(e){return void 0!==e&&null!==e}function Z_(e){return!e.trim().length}function $_(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const eI=Object.prototype.hasOwnProperty;class tI{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(e=>{let r=rI(e);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(e=>{e.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function rI(e){let t=null,r=null,n=null,a=1,s=null;if(K_(e)||G_(e))n=e,t=nI(e),r=aI(e);else{if(!eI.call(e,"name"))throw new Error((e=>"Missing ".concat(e," property in key"))("name"));const o=e.name;if(n=o,eI.call(e,"weight")&&(a=e.weight,a<=0))throw new Error((e=>"Property 'weight' in key '".concat(e,"' must be a positive integer"))(o));t=nI(o),r=aI(o),s=e.getFn}return{path:t,id:r,weight:a,src:n,getFn:s}}function nI(e){return G_(e)?e:e.split(".")}function aI(e){return G_(e)?e.join("."):e}const sI={useExtendedSearch:!1,getFn:function(e,t){let r=[],n=!1;const a=(e,t,s)=>{if(Q_(e))if(t[s]){const o=e[t[s]];if(!Q_(o))return;if(s===t.length-1&&(K_(o)||J_(o)||Y_(o)))r.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;let t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(o));else if(G_(o)){n=!0;for(let e=0,r=o.length;e<r;e+=1)a(o[e],t,s+1)}else t.length&&a(o,t,s+1)}else r.push(e)};return a(e,K_(t)?t.split("."):t,0),n?r:r[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var oI=(0,Y.A)((0,Y.A)((0,Y.A)((0,Y.A)({},{isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1}),{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1}),{location:0,threshold:.6,distance:100}),sI);const iI=/[^ ]+/g;class lI{constructor(){let{getFn:e=oI.getFn,fieldNormWeight:t=oI.fieldNormWeight}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.norm=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const r=new Map,n=Math.pow(10,t);return{get(t){const a=t.match(iI).length;if(r.has(a))return r.get(a);const s=1/Math.pow(a,.5*e),o=parseFloat(Math.round(s*n)/n);return r.set(a,o),o},clear(){r.clear()}}}(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.docs=e}setIndexRecords(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.records=e}setKeys(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.keys=e,this._keysMap={},e.forEach((e,t)=>{this._keysMap[e.id]=t})}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,K_(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();K_(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,r=this.size();t<r;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!Q_(e)||Z_(e))return;let r={v:e,i:t,n:this.norm.get(e)};this.records.push(r)}_addObject(e,t){let r={i:t,$:{}};this.keys.forEach((t,n)=>{let a=t.getFn?t.getFn(e):this.getFn(e,t.path);if(Q_(a))if(G_(a)){let e=[];const t=[{nestedArrIndex:-1,value:a}];for(;t.length;){const{nestedArrIndex:r,value:n}=t.pop();if(Q_(n))if(K_(n)&&!Z_(n)){let t={v:n,i:r,n:this.norm.get(n)};e.push(t)}else G_(n)&&n.forEach((e,r)=>{t.push({nestedArrIndex:r,value:e})})}r.$[n]=e}else if(K_(a)&&!Z_(a)){let e={v:a,n:this.norm.get(a)};r.$[n]=e}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function cI(e,t){let{getFn:r=oI.getFn,fieldNormWeight:n=oI.fieldNormWeight}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=new lI({getFn:r,fieldNormWeight:n});return a.setKeys(e.map(rI)),a.setSources(t),a.create(),a}function dI(e){let{errors:t=0,currentLocation:r=0,expectedLocation:n=0,distance:a=oI.distance,ignoreLocation:s=oI.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=t/e.length;if(s)return o;const i=Math.abs(n-r);return a?o+i/a:i?1:o}const uI=32;function hI(e,t,r){let{location:n=oI.location,distance:a=oI.distance,threshold:s=oI.threshold,findAllMatches:o=oI.findAllMatches,minMatchCharLength:i=oI.minMatchCharLength,includeMatches:l=oI.includeMatches,ignoreLocation:c=oI.ignoreLocation}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.length>uI)throw new Error((e=>"Pattern length exceeds max of ".concat(e,"."))(uI));const d=t.length,u=e.length,h=Math.max(0,Math.min(n,u));let m=s,p=h;const f=i>1||l,g=f?Array(u):[];let v;for(;(v=e.indexOf(t,p))>-1;){let e=dI(t,{currentLocation:v,expectedLocation:h,distance:a,ignoreLocation:c});if(m=Math.min(e,m),p=v+d,f){let e=0;for(;e<d;)g[v+e]=1,e+=1}}p=-1;let x=[],b=1,y=d+u;const w=1<<d-1;for(let N=0;N<d;N+=1){let n=0,s=y;for(;n<s;){dI(t,{errors:N,currentLocation:h+s,expectedLocation:h,distance:a,ignoreLocation:c})<=m?n=s:y=s,s=Math.floor((y-n)/2+n)}y=s;let i=Math.max(1,h-s+1),l=o?u:Math.min(h+s,u)+d,v=Array(l+2);v[l+1]=(1<<N)-1;for(let o=l;o>=i;o-=1){let n=o-1,s=r[e.charAt(n)];if(f&&(g[n]=+!!s),v[o]=(v[o+1]<<1|1)&s,N&&(v[o]|=(x[o+1]|x[o])<<1|1|x[o+1]),v[o]&w&&(b=dI(t,{errors:N,currentLocation:n,expectedLocation:h,distance:a,ignoreLocation:c}),b<=m)){if(m=b,p=n,p<=h)break;i=Math.max(1,2*h-p)}}if(dI(t,{errors:N+1,currentLocation:h,expectedLocation:h,distance:a,ignoreLocation:c})>m)break;x=v}const j={isMatch:p>=0,score:Math.max(.001,b)};if(f){const e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:oI.minMatchCharLength,r=[],n=-1,a=-1,s=0;for(let o=e.length;s<o;s+=1){let o=e[s];o&&-1===n?n=s:o||-1===n||(a=s-1,a-n+1>=t&&r.push([n,a]),n=-1)}return e[s-1]&&s-n>=t&&r.push([n,s-1]),r}(g,i);e.length?l&&(j.indices=e):j.isMatch=!1}return j}function mI(e){let t={};for(let r=0,n=e.length;r<n;r+=1){const a=e.charAt(r);t[a]=(t[a]||0)|1<<n-r-1}return t}const pI=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class fI{constructor(e){let{location:t=oI.location,threshold:r=oI.threshold,distance:n=oI.distance,includeMatches:a=oI.includeMatches,findAllMatches:s=oI.findAllMatches,minMatchCharLength:o=oI.minMatchCharLength,isCaseSensitive:i=oI.isCaseSensitive,ignoreDiacritics:l=oI.ignoreDiacritics,ignoreLocation:c=oI.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.options={location:t,threshold:r,distance:n,includeMatches:a,findAllMatches:s,minMatchCharLength:o,isCaseSensitive:i,ignoreDiacritics:l,ignoreLocation:c},e=i?e:e.toLowerCase(),e=l?pI(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const d=(e,t)=>{this.chunks.push({pattern:e,alphabet:mI(e),startIndex:t})},u=this.pattern.length;if(u>uI){let e=0;const t=u%uI,r=u-t;for(;e<r;)d(this.pattern.substr(e,uI),e),e+=uI;if(t){const e=u-uI;d(this.pattern.substr(e),e)}}else d(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:r,includeMatches:n}=this.options;if(e=t?e:e.toLowerCase(),e=r?pI(e):e,this.pattern===e){let t={isMatch:!0,score:0};return n&&(t.indices=[[0,e.length-1]]),t}const{location:a,distance:s,threshold:o,findAllMatches:i,minMatchCharLength:l,ignoreLocation:c}=this.options;let d=[],u=0,h=!1;this.chunks.forEach(t=>{let{pattern:r,alphabet:m,startIndex:p}=t;const{isMatch:f,score:g,indices:v}=hI(e,r,m,{location:a+p,distance:s,threshold:o,findAllMatches:i,minMatchCharLength:l,includeMatches:n,ignoreLocation:c});f&&(h=!0),u+=g,f&&v&&(d=[...d,...v])});let m={isMatch:h,score:h?u/this.chunks.length:1};return h&&n&&(m.indices=d),m}}class gI{constructor(e){this.pattern=e}static isMultiMatch(e){return vI(e,this.multiRegex)}static isSingleMatch(e){return vI(e,this.singleRegex)}search(){}}function vI(e,t){const r=e.match(t);return r?r[1]:null}class xI extends gI{constructor(e){let{location:t=oI.location,threshold:r=oI.threshold,distance:n=oI.distance,includeMatches:a=oI.includeMatches,findAllMatches:s=oI.findAllMatches,minMatchCharLength:o=oI.minMatchCharLength,isCaseSensitive:i=oI.isCaseSensitive,ignoreDiacritics:l=oI.ignoreDiacritics,ignoreLocation:c=oI.ignoreLocation}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),this._bitapSearch=new fI(e,{location:t,threshold:r,distance:n,includeMatches:a,findAllMatches:s,minMatchCharLength:o,isCaseSensitive:i,ignoreDiacritics:l,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class bI extends gI{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t,r=0;const n=[],a=this.pattern.length;for(;(t=e.indexOf(this.pattern,r))>-1;)r=t+a,n.push([t,r-1]);const s=!!n.length;return{isMatch:s,score:s?0:1,indices:n}}}const yI=[class extends gI{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},bI,class extends gI{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},class extends gI{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends gI{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends gI{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},class extends gI{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},xI],wI=yI.length,jI=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;const NI=new Set([xI.type,bI.type]);class SI{constructor(e){let{isCaseSensitive:t=oI.isCaseSensitive,ignoreDiacritics:r=oI.ignoreDiacritics,includeMatches:n=oI.includeMatches,minMatchCharLength:a=oI.minMatchCharLength,ignoreLocation:s=oI.ignoreLocation,findAllMatches:o=oI.findAllMatches,location:i=oI.location,threshold:l=oI.threshold,distance:c=oI.distance}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:a,findAllMatches:o,ignoreLocation:s,location:i,threshold:l,distance:c},e=t?e:e.toLowerCase(),e=r?pI(e):e,this.pattern=e,this.query=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.split("|").map(e=>{let r=e.trim().split(jI).filter(e=>e&&!!e.trim()),n=[];for(let a=0,s=r.length;a<s;a+=1){const e=r[a];let s=!1,o=-1;for(;!s&&++o<wI;){const r=yI[o];let a=r.isMultiMatch(e);a&&(n.push(new r(a,t)),s=!0)}if(!s)for(o=-1;++o<wI;){const r=yI[o];let a=r.isSingleMatch(e);if(a){n.push(new r(a,t));break}}}return n})}(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:a}=this.options;e=n?e:e.toLowerCase(),e=a?pI(e):e;let s=0,o=[],i=0;for(let l=0,c=t.length;l<c;l+=1){const n=t[l];o.length=0,s=0;for(let t=0,a=n.length;t<a;t+=1){const a=n[t],{isMatch:l,indices:c,score:d}=a.search(e);if(!l){i=0,s=0,o.length=0;break}if(s+=1,i+=d,r){const e=a.constructor.type;NI.has(e)?o=[...o,...c]:o.push(c)}}if(s){let e={isMatch:!0,score:i/s};return r&&(e.indices=o),e}}return{isMatch:!1,score:1}}}const kI=[];function AI(e,t){for(let r=0,n=kI.length;r<n;r+=1){let n=kI[r];if(n.condition(e,t))return new n(e,t)}return new fI(e,t)}const CI="$and",EI="$or",PI="$path",_I="$val",II=e=>!(!e[CI]&&!e[EI]),TI=e=>({[CI]:Object.keys(e).map(t=>({[t]:e[t]}))});function LI(e,t){let{auto:r=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=e=>{let a=Object.keys(e);const s=(e=>!!e[PI])(e);if(!s&&a.length>1&&!II(e))return n(TI(e));if((e=>!G_(e)&&X_(e)&&!II(e))(e)){const n=s?e[PI]:a[0],o=s?e[_I]:e[n];if(!K_(o))throw new Error((e=>"Invalid value for key ".concat(e))(n));const i={keyId:aI(n),pattern:o};return r&&(i.searcher=AI(o,t)),i}let o={children:[],operator:a[0]};return a.forEach(t=>{const r=e[t];G_(r)&&r.forEach(e=>{o.children.push(n(e))})}),o};return II(e)||(e=TI(e)),n(e)}function DI(e,t){const r=e.matches;t.matches=[],Q_(r)&&r.forEach(e=>{if(!Q_(e.indices)||!e.indices.length)return;const{indices:r,value:n}=e;let a={indices:r,value:n};e.key&&(a.key=e.key.src),e.idx>-1&&(a.refIndex=e.idx),t.matches.push(a)})}function MI(e,t){t.score=e.score}class OI{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;this.options=(0,Y.A)((0,Y.A)({},oI),t),this.options.useExtendedSearch,this._keyStore=new tI(this.options.keys),this.setCollection(e,r)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof lI))throw new Error("Incorrect 'index' type");this._myIndex=t||cI(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Q_(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>!1;const t=[];for(let r=0,n=this._docs.length;r<n;r+=1){const a=this._docs[r];e(a,r)&&(this.removeAt(r),r-=1,n-=1,t.push(a))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e){let{limit:t=-1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{includeMatches:r,includeScore:n,shouldSort:a,sortFn:s,ignoreFieldNorm:o}=this.options;let i=K_(e)?K_(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,t){let{ignoreFieldNorm:r=oI.ignoreFieldNorm}=t;e.forEach(e=>{let t=1;e.matches.forEach(e=>{let{key:n,norm:a,score:s}=e;const o=n?n.weight:null;t*=Math.pow(0===s&&o?Number.EPSILON:s,(o||1)*(r?1:a))}),e.score=t})}(i,{ignoreFieldNorm:o}),a&&i.sort(s),J_(t)&&t>-1&&(i=i.slice(0,t)),function(e,t){let{includeMatches:r=oI.includeMatches,includeScore:n=oI.includeScore}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=[];return r&&a.push(DI),n&&a.push(MI),e.map(e=>{const{idx:r}=e,n={item:t[r],refIndex:r};return a.length&&a.forEach(t=>{t(e,n)}),n})}(i,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(e){const t=AI(e,this.options),{records:r}=this._myIndex,n=[];return r.forEach(e=>{let{v:r,i:a,n:s}=e;if(!Q_(r))return;const{isMatch:o,score:i,indices:l}=t.searchIn(r);o&&n.push({item:r,idx:a,matches:[{score:i,value:r,norm:s,indices:l}]})}),n}_searchLogical(e){const t=LI(e,this.options),r=(e,t,n)=>{if(!e.children){const{keyId:r,searcher:a}=e,s=this._findMatches({key:this._keyStore.get(r),value:this._myIndex.getValueForItemAtKeyId(t,r),searcher:a});return s&&s.length?[{idx:n,item:t,matches:s}]:[]}const a=[];for(let s=0,o=e.children.length;s<o;s+=1){const o=e.children[s],i=r(o,t,n);if(i.length)a.push(...i);else if(e.operator===CI)return[]}return a},n=this._myIndex.records,a={},s=[];return n.forEach(e=>{let{$:n,i:o}=e;if(Q_(n)){let e=r(t,n,o);e.length&&(a[o]||(a[o]={idx:o,item:n,matches:[]},s.push(a[o])),e.forEach(e=>{let{matches:t}=e;a[o].matches.push(...t)}))}}),s}_searchObjectList(e){const t=AI(e,this.options),{keys:r,records:n}=this._myIndex,a=[];return n.forEach(e=>{let{$:n,i:s}=e;if(!Q_(n))return;let o=[];r.forEach((e,r)=>{o.push(...this._findMatches({key:e,value:n[r],searcher:t}))}),o.length&&a.push({idx:s,item:n,matches:o})}),a}_findMatches(e){let{key:t,value:r,searcher:n}=e;if(!Q_(r))return[];let a=[];if(G_(r))r.forEach(e=>{let{v:r,i:s,n:o}=e;if(!Q_(r))return;const{isMatch:i,score:l,indices:c}=n.searchIn(r);i&&a.push({score:l,key:t,value:r,idx:s,norm:o,indices:c})});else{const{v:e,n:s}=r,{isMatch:o,score:i,indices:l}=n.searchIn(e);o&&a.push({score:i,key:t,value:e,norm:s,indices:l})}return a}}OI.version="7.1.0",OI.createIndex=cI,OI.parseIndex=function(e){let{getFn:t=oI.getFn,fieldNormWeight:r=oI.fieldNormWeight}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{keys:n,records:a}=e,s=new lI({getFn:t,fieldNormWeight:r});return s.setKeys(n),s.setIndexRecords(a),s},OI.config=oI,OI.parseQuery=LI,function(){kI.push(...arguments)}(SI);const RI=e=>{if(!e)return"";const t=e.replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):e},FI={includeScore:!0,includeMatches:!0,threshold:.2,keys:[{name:"projectNumber",weight:15},{name:"name",weight:12},{name:"projectName",weight:12},{name:"address",weight:11},{name:"customer.name",weight:10},{name:"customer.primaryName",weight:10},{name:"client.name",weight:10},{name:"customer.phone",weight:9},{name:"customer.primaryPhone",weight:9},{name:"client.phone",weight:9},{name:"customer.email",weight:9},{name:"customer.primaryEmail",weight:9},{name:"client.email",weight:9},{name:"projectManager.name",weight:8},{name:"projectManager.firstName",weight:8},{name:"phase",weight:8},{name:"status",weight:7},{name:"projectType",weight:7},{name:"type",weight:7},{name:"description",weight:5},{name:"notes",weight:4}]},UI={includeScore:!0,includeMatches:!0,threshold:.2,keys:[{name:"name",weight:10},{name:"primaryName",weight:10},{name:"email",weight:8},{name:"primaryEmail",weight:8},{name:"phone",weight:8},{name:"primaryPhone",weight:8},{name:"address",weight:6},{name:"secondaryName",weight:7},{name:"secondaryEmail",weight:7},{name:"secondaryPhone",weight:7}]},BI={includeScore:!0,includeMatches:!0,threshold:.2,keys:[{name:"subject",weight:8},{name:"content",weight:6},{name:"description",weight:6},{name:"projectName",weight:5},{name:"author",weight:4},{name:"projectNumber",weight:5}]};class zI{constructor(){this.data={projects:[],customers:[],messages:[]},this.fuseInstances={projects:null,customers:null,messages:null}}updateData(e){let{projects:t=[],activities:r=[]}=e;this.data.projects=t||[],this.data.messages=r||[],this.data.customers=this.extractCustomers(this.data.projects),this.fuseInstances.projects=new OI(this.data.projects,FI),this.fuseInstances.customers=new OI(this.data.customers,UI),this.fuseInstances.messages=new OI(this.data.messages,BI)}extractCustomers(e){const t=new Map;return e.forEach(e=>{const r=e.client||e.customer;if(r&&(r.name||r.primaryName)){const n=r.name||r.primaryName,a=n.toLowerCase();t.has(a)||t.set(a,{id:r.id||"customer-".concat(t.size),name:n,primaryName:r.primaryName||r.name,email:r.email||r.primaryEmail,primaryEmail:r.primaryEmail||r.email,phone:r.phone||r.primaryPhone,primaryPhone:r.primaryPhone||r.phone,secondaryName:r.secondaryName,secondaryEmail:r.secondaryEmail,secondaryPhone:r.secondaryPhone,address:r.address||e.address,projects:[]}),t.get(a).projects.push(e)}}),Array.from(t.values())}search(e){if(!e||e.trim().length<1)return[];const t=[];if(this.fuseInstances.projects){const r=this.fuseInstances.projects.search(e);t.push(...this.formatProjectResults(r))}if(this.fuseInstances.customers){const r=this.fuseInstances.customers.search(e);t.push(...this.formatCustomerResults(r))}if(this.fuseInstances.messages){const r=this.fuseInstances.messages.search(e);t.push(...this.formatMessageResults(r))}return t.sort((e,t)=>(e.fuseScore||1)-(t.fuseScore||1)).slice(0,50)}formatProjectResults(e){return e.map(e=>{var t;const r=e.item,n=r.client||r.customer,a=(null===n||void 0===n?void 0:n.name)||(null===n||void 0===n?void 0:n.primaryName)||"Unknown Customer",s=(0,Y.A)((0,Y.A)({},r),{},{currentWorkflowItem:this.getProjectWorkflowInfo(r)});return{id:r.id,type:"project",category:"Projects",title:(null===(t=r.projectNumber)||void 0===t?void 0:t.toString())||"No Project #",subtitle:a,description:r.address||r.projectName||r.name||"No address",fuseScore:e.score,matches:e.matches,data:s,navigationTarget:{page:"projects",projectId:r.id,project:(0,Y.A)((0,Y.A)({},s),{},{scrollToProjectId:String(r.id)})}}})}getProjectWorkflowInfo(e){try{if(e&&e.workflowState){return{section:e.workflowState.currentSectionName||e.workflowState.sectionDisplayName||e.workflowState.sectionName,lineItem:e.workflowState.currentLineItemName||e.workflowState.stepName||e.workflowState.lineItemName,phase:e.workflowState.currentPhase||e.workflowState.phaseName||e.workflowState.phase,stepId:e.workflowState.currentLineItem||e.workflowState.stepId,sectionId:e.workflowState.currentSection||e.workflowState.sectionId}}}catch(XI){}return{section:e.currentSection||e.section||e.sectionName||"Initial Inspection",lineItem:e.currentLineItem||e.stepName||e.lineItemName||"Review Site & Structure",phase:e.phase||e.currentPhase||e.phaseName||"LEAD",stepId:e.currentLineItemId||e.stepId,sectionId:e.currentSectionId||e.sectionId}}formatCustomerResults(e){return e.map(e=>{const t=e.item;return{id:t.id,type:"customer",category:"Customers",title:t.name||t.primaryName,subtitle:RI(t.phone||t.primaryPhone)||t.email||t.primaryEmail||"No contact info",description:"".concat(t.projects.length," project(s)"),fuseScore:e.score,matches:e.matches,data:t,navigationTarget:{page:"customers",customerId:t.id}}})}formatMessageResults(e){return e.map(e=>{const t=e.item,r=this.data.projects.find(e=>e.id===t.projectId||e._id===t.projectId);return{id:t.id,type:"message",category:"Messages",title:t.subject||"Message",subtitle:(null===r||void 0===r?void 0:r.projectNumber)||t.projectName||"Unknown Project",description:t.content||t.description||"",fuseScore:e.score,matches:e.matches,data:t,navigationTarget:{page:"project-messages",projectId:t.projectId,messageId:t.id,project:r}}})}}const WI=class{constructor(){this.initializeNLP()}initializeNLP(){this.entities={status:{completed:["completed","finished","done","complete","closed"],"in-progress":["in progress","ongoing","active","current","working","progress"],"not-started":["not started","pending","new","upcoming"],"on-hold":["on hold","paused","suspended","delayed","hold"]},phase:{LEAD:["lead","leads","prospect"],APPROVED:["approved","approval","contract","contracted"],EXECUTION:["execution","construction","building","work","installing"],COMPLETION:["completion","completed","finished","done"]},timeframe:{today:["today","this day"],"this-week":["this week","current week"],"last-week":["last week","past week","previous week"],"this-month":["this month","current month"],"last-month":["last month","past month","previous month"],"last-quarter":["last quarter","past quarter","previous quarter","past 3 months"],"last-year":["last year","past year","previous year"]},projectType:{roof:["roof","roofing","roofs","shingle","shingles"],repair:["repair","repairs","fix","maintenance"],replacement:["replacement","replace","new roof"],inspection:["inspection","inspect","assessment"]}},this.intentPatterns=[{pattern:/(?:show|find|list|get)\s+(?:me\s+)?(.+?)\s+projects?/i,intent:"search.projects"},{pattern:/(?:show|find|list|get)\s+(?:me\s+)?(completed|finished|done)\s+projects?/i,intent:"search.by.status"},{pattern:/(?:show|find|list|get)\s+(?:me\s+)?(in.progress|ongoing|active)\s+projects?/i,intent:"search.by.status"},{pattern:/(?:show|find|list|get)\s+(?:me\s+)?projects?\s+from\s+(.+)/i,intent:"search.by.timeframe"},{pattern:/(?:show|find|list|get)\s+(?:me\s+)?(lead|approved|execution|completion)\s+(?:phase\s+)?projects?/i,intent:"search.by.phase"},{pattern:/(?:find|show)\s+(?:me\s+)?customer\s+(.+)/i,intent:"search.customer"},{pattern:/(?:find|show)\s+(?:me\s+)?project\s+(.+)/i,intent:"search.project"},{pattern:/(completed|finished|done)\s+projects?/i,intent:"search.by.status"},{pattern:/(in.progress|ongoing|active)\s+projects?/i,intent:"search.by.status"},{pattern:/projects?\s+from\s+(.+)/i,intent:"search.by.timeframe"},{pattern:/(lead|approved|execution|completion)\s+projects?/i,intent:"search.by.phase"},{pattern:/(roof|roofing|repair|replacement)\s+projects?/i,intent:"search.by.type"}]}async process(e,t){const r=t.toLowerCase().trim();let n="None",a=[],s=.3;for(const o of this.intentPatterns){const e=r.match(o.pattern);if(e){n=o.intent,s=.8;const t=e[1]||e[0];a=this.extractEntities(t,r);break}}return"None"===n&&(a=this.extractEntities(r,r),a.length>0&&(n=this.determineIntentFromEntities(a),s=.6)),{intent:n,score:s,entities:a}}extractEntities(e,t){const r=[],n=e.toLowerCase();if(Object.keys(this.entities).forEach(e=>{Object.keys(this.entities[e]).forEach(t=>{const a=this.entities[e][t];for(const s of a)if(n.includes(s.toLowerCase()))return void r.push({entity:e,resolution:{value:t},sourceText:s,confidence:.9})})}),!r.some(e=>"customer"===e.entity||"project"===e.entity)){const e=n.split(/\s+/).filter(e=>e.length>2&&!this.isKnownKeyword(e)&&/^[a-zA-Z0-9]+$/.test(e));e.length>0&&r.push({entity:"searchText",resolution:{value:e.join(" ")},sourceText:e.join(" "),confidence:.7})}return r}isKnownKeyword(e){return["show","find","get","list","search","me","all","the","projects","project","customer","customers","from","by","with","and","or","in","on","at","to","for"].includes(e.toLowerCase())}determineIntentFromEntities(e){const t=e.map(e=>e.entity);return t.includes("status")?"search.by.status":t.includes("phase")?"search.by.phase":t.includes("timeframe")?"search.by.timeframe":t.includes("projectType")?"search.by.type":t.includes("searchText")?"search.general":"None"}isNaturalLanguageQuery(e){const t=["show","find","get","list","search","display","last","past","previous","this","current","today","yesterday","week","month","quarter","year","completed","finished","done","progress","ongoing","pending","active","hold","paused","lead","approved","execution","completion","roof","roofing","repair","replacement","inspection","what","which","who","when","where","how","from","with","all","projects","customers"],r=e.toLowerCase();if(r.split(/\s+/).length>=3){return t.some(e=>r.includes(e))}return[/show me.*projects/i,/find.*projects/i,/projects from/i,/completed.*projects/i,/.*last (week|month|quarter|year)/i,/.*this (week|month)/i].some(t=>t.test(e))}};const qI=class{constructor(){this.nlpManager=new WI,this.conventionalSearchService=new zI,this.isInitialized=!0}updateData(e){this.conventionalSearchService.updateData(e)}async search(e){try{const t=await this.nlpManager.process("en",e.toLowerCase()),r=t.intent,n=t.entities||[],a=t.score||0;if(a<.3)return console.log("\ud83d\udd0d Low NLP confidence, using conventional search"),this.conventionalSearchService.search(e);console.log("\ud83e\udd16 NLP Intent:",r,"Entities:",n,"Confidence:",a);const s=this.buildStructuredQuery(r,n,e);return this.executeStructuredSearch(s,e)}catch(t){return console.error("\ud83d\udea8 NLP search error, falling back to conventional search:",t),this.conventionalSearchService.search(e)}}buildStructuredQuery(e,t,r){const n={intent:e,filters:{},searchText:null,originalQuery:r,confidence:t.length>0?Math.max(...t.map(e=>e.confidence||.7)):.5};return t.forEach(e=>{switch(e.entity){case"status":n.filters.status=e.resolution.value;break;case"phase":n.filters.phase=e.resolution.value.toUpperCase();break;case"timeframe":n.filters.timeframe=e.resolution.value;break;case"projectType":n.filters.projectType=e.resolution.value;break;case"searchText":n.searchText=e.resolution.value;break;default:n.searchText||(n.searchText=e.sourceText)}}),n}async executeStructuredSearch(e,t){const{intent:r,filters:n,searchText:a}=e;try{const s=await fetch("/api/search/advanced",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intent:r,filters:n,searchText:a,originalQuery:t,entities:[],limit:50})});if(!s.ok)throw new Error("Search API error: ".concat(s.status));const o=await s.json();if(o.success&&o.data.results)return o.data.results.map(t=>(0,Y.A)((0,Y.A)({},t),{},{nlp:{intent:r,confidence:e.confidence||.8,isStructuredSearch:!0,apiSource:!0}}));throw new Error("Invalid API response")}catch(s){return console.error("\ud83d\udea8 API search failed, falling back to client-side:",s),this.executeClientSideSearch(e,t)}}executeClientSideSearch(e,t){const{intent:r,filters:n,searchText:a}=e;let s=[];const o=this.conventionalSearchService.data.projects||[],i=this.conventionalSearchService.data.customers||[];this.conventionalSearchService.data.messages;switch(r){case"search.by.status":s=this.filterProjectsByStatus(o,n.status);break;case"search.by.phase":s=this.filterProjectsByPhase(o,n.phase);break;case"search.by.timeframe":s=this.filterProjectsByTimeframe(o,n.timeframe);break;case"search.by.type":s=this.filterProjectsByType(o,n.projectType);break;case"search.customer":a&&(s=this.searchCustomers(i,a));break;case"search.project":a&&(s=this.searchProjects(o,a));break;default:s=this.conventionalSearchService.search(t)}return s.map(t=>(0,Y.A)((0,Y.A)({},t),{},{nlp:{intent:r,confidence:e.confidence,isStructuredSearch:!0,clientSideFallback:!0}}))}filterProjectsByStatus(e,t){const r=e.filter(e=>{const r=(e.status||"").toLowerCase();switch(t){case"completed":return r.includes("completed")||r.includes("finished")||r.includes("done");case"in-progress":return r.includes("progress")||r.includes("active")||r.includes("ongoing");case"not-started":return r.includes("not started")||r.includes("pending")||r.includes("new");case"on-hold":return r.includes("hold")||r.includes("paused")||r.includes("suspended");default:return!1}});return this.conventionalSearchService.formatProjectResults(r.map(e=>({item:e,score:.1})))}filterProjectsByPhase(e,t){const r=e.filter(e=>(e.phase||"").toUpperCase()===t);return this.conventionalSearchService.formatProjectResults(r.map(e=>({item:e,score:.1})))}filterProjectsByTimeframe(e,t){const r=new Date,n=e.filter(e=>{const n=new Date(e.createdAt||e.dateCreated||r);switch(t){case"today":return n.toDateString()===r.toDateString();case"this-week":return n>=new Date(r.setDate(r.getDate()-r.getDay()));case"last-week":const e=new Date(r.setDate(r.getDate()-r.getDay()-7)),t=new Date(r.setDate(r.getDate()-r.getDay()));return n>=e&&n<=t;case"this-month":return n.getMonth()===r.getMonth()&&n.getFullYear()===r.getFullYear();case"last-month":const a=new Date(r.getFullYear(),r.getMonth()-1,1),s=new Date(r.getFullYear(),r.getMonth(),0);return n>=a&&n<=s;case"last-quarter":return n>=new Date(r.getFullYear(),r.getMonth()-3,1);case"last-year":const o=new Date(r.getFullYear()-1,0,1),i=new Date(r.getFullYear()-1,11,31);return n>=o&&n<=i;default:return!1}});return this.conventionalSearchService.formatProjectResults(n.map(e=>({item:e,score:.1})))}filterProjectsByType(e,t){const r=e.filter(e=>(e.projectType||e.type||"").toLowerCase().includes(t));return this.conventionalSearchService.formatProjectResults(r.map(e=>({item:e,score:.1})))}searchCustomers(e,t){const r=e.filter(e=>{const r=(e.name||e.primaryName||"").toLowerCase(),n=(e.email||e.primaryEmail||"").toLowerCase(),a=(e.phone||e.primaryPhone||"").toLowerCase();return r.includes(t.toLowerCase())||n.includes(t.toLowerCase())||a.includes(t.toLowerCase())});return this.conventionalSearchService.formatCustomerResults(r.map(e=>({item:e,score:.1})))}searchProjects(e,t){const r=e.filter(e=>{const r=(e.projectNumber||"").toString().toLowerCase(),n=(e.name||e.projectName||"").toLowerCase(),a=(e.address||"").toLowerCase();return r.includes(t.toLowerCase())||n.includes(t.toLowerCase())||a.includes(t.toLowerCase())});return this.conventionalSearchService.formatProjectResults(r.map(e=>({item:e,score:.1})))}},VI=e=>{let{text:t,matches:r=[],query:n=""}=e;const a="string"===typeof t?t:null==t?"":String(t);if(!r||0===r.length||!a)return(0,kt.jsx)("span",{children:a});const s=r.filter(e=>e.value===a||"string"===typeof e.value&&e.value.includes(a));if(0===s.length){if(!n.trim())return(0,kt.jsx)("span",{children:a});const e=new RegExp(n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),t=a.split(e),r=a.match(e)||[];return(0,kt.jsx)("span",{children:t.map((e,t)=>(0,kt.jsxs)(o.Fragment,{children:[e,r[t]&&(0,kt.jsx)("strong",{className:"search-highlight",children:r[t]})]},t))})}const i=[];let l=0;return(s[0].indices||[]).forEach((e,t)=>{let[r,n]=e;r>l&&i.push((0,kt.jsx)("span",{children:a.substring(l,r)},"unmatched-".concat(t,"-pre"))),i.push((0,kt.jsx)("strong",{className:"search-highlight",children:a.substring(r,n+1)},"matched-".concat(t))),l=n+1}),l<a.length&&i.push((0,kt.jsx)("span",{children:a.substring(l)},"unmatched-post")),(0,kt.jsx)("span",{children:i})};function HI(e){let{projects:t=[],activities:r=[],handleCreateAlert:n,handleAddActivity:a,onNavigateToResult:s,colorMode:i=!1,className:l=""}=e;const[c,d]=(0,o.useState)(""),[u,h]=(0,o.useState)([]),[m,p]=(0,o.useState)(!1),[f,g]=(0,o.useState)(!1),[v,x]=(0,o.useState)([]),[b,y]=(0,o.useState)(!1),w=(0,o.useRef)(null),j=(0,o.useRef)(null),N=(0,o.useRef)(null),S=(0,o.useMemo)(()=>{const e=new zI;return e.updateData({projects:t,activities:r}),e},[t,r]),k=(0,o.useMemo)(()=>{const e=new qI;return e.updateData({projects:t,activities:r}),e},[t,r]);(0,o.useEffect)(()=>{const e=setTimeout(async()=>{if(c.length<1)return h([]),void p(!1);p(!0);try{let r,n=!1;try{var e;n="function"===typeof(null===k||void 0===k||null===(e=k.nlpManager)||void 0===e?void 0:e.isNaturalLanguageQuery)&&k.nlpManager.isNaturalLanguageQuery(c)}catch(t){console.warn("NL detection failed, falling back to conventional search:",t),n=!1}n?(console.log("\ud83e\udd16 Using NL search for:",c),r=await k.search(c)):(console.log("\ud83d\udd0d Using conventional search for:",c),r=S.search(c)),h(r)}catch(r){console.error("Search error:",r);const e=S.search(c);h(e)}p(!1)},150);return()=>clearTimeout(e)},[c,S,k]),(0,o.useEffect)(()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&g(!1)};document.addEventListener("mousedown",e);const t=e=>{(e.ctrlKey||e.metaKey)&&("k"===e.key||"K"===e.key)&&(e.preventDefault(),j.current&&(j.current.focus(),g(!0)))};return document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[]);const A=e=>{let{phase:t,size:r="md"}=e;const n=(e=>Wn.getPhaseButtonProps(e))(t),a="sm"===r?"w-8 h-8 text-xs":"w-10 h-10 text-sm";return(0,kt.jsx)("div",{className:"".concat(n.bgColor," ").concat(n.textColor," ").concat(a," rounded-full flex items-center justify-center font-bold shadow-sm border border-white/20"),title:n.fullName,children:n.initials})},C=(e,t)=>e.matches?e.matches.filter(e=>{const r="string"===typeof e.key?e.key:"";return r===t||r.endsWith(t)||r.includes(t)}):[],E=e=>{if(!e||"string"!==typeof e)return"Address not available";const t=e.split(",").map(e=>e.trim()).filter(Boolean);return 0===t.length?"Address not available":t.join(", ")},P=e=>{g(!1),d(""),s&&(e.navigationTarget||("Projects"===e.category?e.navigationTarget={page:"projects",project:e.data}:"Customers"===e.category?e.navigationTarget={page:"Profile",project:e.data}:e.navigationTarget={page:"projects"}),s(e))},_=(0,o.useMemo)(()=>{const e=u.reduce((e,t)=>{const r=t.category;return e[r]||(e[r]=[]),e[r].push(t),e},{});return Object.keys(e).forEach(t=>{e[t]=e[t].slice(0,10)}),e},[u]),I=e=>{switch(e){case"Projects":return(0,kt.jsx)("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})});case"Customers":return(0,kt.jsx)("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})});case"Messages":return(0,kt.jsx)("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})});default:return(0,kt.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}};return(0,kt.jsxs)("div",{className:"global-search-container ".concat(f?"search-active":""," ").concat(l),ref:w,children:[(0,kt.jsx)("div",{className:"search-icon-wrapper",children:(0,kt.jsx)("svg",{className:"search-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,kt.jsx)("input",{ref:j,type:"text",className:"global-search-input ".concat(i?"dark-mode":""),placeholder:"Search projects, customers, or alerts...",value:c,onChange:e=>d(e.target.value),onKeyDown:e=>{"Escape"!==e.key?"Enter"===e.key&&u&&u.length>0&&P(u[0]):g(!1)},onFocus:()=>{g(!0),(()=>{const e=[];for(let t=0;t<6;t++){const r={id:Date.now()+t,size:10*Math.random()+5,left:40*Math.random()-20,delay:.5*Math.random()};e.push(r)}x(e),y(!0),setTimeout(()=>{x([]),y(!1)},1500)})()}}),v.length>0&&(0,kt.jsx)("div",{className:"bubbles-container",children:v.map(e=>(0,kt.jsx)("div",{className:"bubble",style:{width:"".concat(e.size,"px"),height:"".concat(e.size,"px"),left:"".concat(e.left,"px"),animationDelay:"".concat(e.delay,"s")}},e.id))}),b&&(0,kt.jsx)("div",{className:"ripple-effect"}),c&&(0,kt.jsx)("button",{className:"search-clear-btn",onClick:()=>d(""),type:"button",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),f&&c.length>0&&(0,kt.jsxs)("div",{ref:N,className:"search-results-dropdown-simple ".concat(i?"bg-[#1e293b] border-gray-600":""),children:[m&&(0,kt.jsx)("div",{className:"search-result-item-message",children:"Loading..."}),!m&&0===Object.keys(_).length&&(0,kt.jsxs)("div",{className:"search-result-item-message",children:['No results found for "',c,'"']}),!m&&Object.entries(_).map(e=>{let[t,r]=e;return(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"px-4 py-2 border-b sticky top-0 z-10 ".concat(i?"bg-[#232b4d] border-gray-600 text-gray-300":"bg-gray-50 border-gray-200 text-gray-700"),children:(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[I(t),(0,kt.jsxs)("span",{className:"text-xs font-semibold uppercase tracking-wide",children:[t," (",r.length,")"]})]})}),r.map((e,r)=>{var n,a,o,l,d,u;return(0,kt.jsxs)("div",{className:"search-result-item-simplified border-b border-gray-100 p-4 cursor-pointer ".concat(i?"border-gray-600 hover:bg-gray-700/50":"hover:bg-gray-50"),onClick:()=>P(e),children:["Projects"===t&&(0,kt.jsxs)("div",{className:"space-y-3",children:[(0,kt.jsxs)("div",{className:"customer-contact-section",children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(i?"text-gray-200":"text-gray-800"),children:(0,kt.jsx)(VI,{text:(null===(n=e.data.customer)||void 0===n?void 0:n.primaryName)||e.data.clientName||e.subtitle||"Unknown Customer",matches:C(e,"client"),query:c})}),(0,kt.jsxs)("div",{className:"text-xs flex gap-4 mt-1 ".concat(i?"text-gray-400":"text-gray-600"),children:[(null===(a=e.data.customer)||void 0===a?void 0:a.primaryPhone)&&(0,kt.jsxs)("span",{children:["\ud83d\udcde ",e.data.customer.primaryPhone]}),(null===(o=e.data.customer)||void 0===o?void 0:o.primaryEmail)&&(0,kt.jsxs)("span",{children:["\u2709\ufe0f ",e.data.customer.primaryEmail]})]})]}),(0,kt.jsxs)("div",{className:"project-info-section",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,kt.jsx)(A,{phase:e.data.phase,size:"sm"}),(0,kt.jsxs)("div",{className:"text-sm ".concat(i?"text-gray-300":"text-gray-700"," flex items-center gap-2"),children:[(0,kt.jsxs)("button",{className:"font-semibold hover:underline ".concat(i?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"),onClick:t=>{t.stopPropagation(),s&&s((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Project Profile",project:e.data}}))},title:"View Project Profile",children:["#",String(e.data.projectNumber||e.data.id||"00000").padStart(5,"0")]}),(0,kt.jsx)("span",{className:"".concat(i?"text-gray-500":"text-gray-400"),children:"\u2022"}),(0,kt.jsx)(VI,{text:e.data.projectName||e.title||"Unnamed Project",matches:C(e,"name"),query:c})]})]}),(0,kt.jsxs)("div",{className:"text-xs space-y-1 ".concat(i?"text-gray-400":"text-gray-600"),children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("strong",{children:"Phase:"})," ",e.data.phase||"Unknown"]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("strong",{children:"Section:"})," ",(null===(l=e.data.currentWorkflowItem)||void 0===l?void 0:l.section)||"Not Available"]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("strong",{children:"Line Item:"}),null!==(d=e.data.currentWorkflowItem)&&void 0!==d&&d.lineItem?(0,kt.jsx)("button",{className:"ml-1 hover:underline ".concat(i?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"),onClick:async t=>{if(t.stopPropagation(),s&&e.data.currentWorkflowItem)try{console.log("\ud83c\udfaf SEARCH LINE ITEM: Starting navigation to line item in workflow"),console.log("\ud83c\udfaf SEARCH LINE ITEM: Project:",e.data.projectName),console.log("\ud83c\udfaf SEARCH LINE ITEM: Line Item:",e.data.currentWorkflowItem.lineItem),console.log("\ud83c\udfaf SEARCH LINE ITEM: Section:",e.data.currentWorkflowItem.section),console.log("\ud83c\udfaf SEARCH LINE ITEM: Phase:",e.data.phase);const t=e.data.phase||"LEAD",r=e.data.currentWorkflowItem.section||"Unknown Section",n=e.data.currentWorkflowItem.lineItem||"Unknown Item",a=await fetch("/api/workflow-data/project-position/".concat(e.data.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"demo-sarah-owner-token-fixed-12345")}});if(a.ok){const o=await a.json();if(o.success&&o.data){const a=o.data;console.log("\ud83c\udfaf SEARCH LINE ITEM: Project position data:",a);const i=a.currentLineItemId||a.currentLineItem||"".concat(t,"-").concat(r,"-0"),l=a.currentSectionId||a.currentSection||r.toLowerCase().replace(/\s+/g,"-");console.log("\ud83c\udfaf SEARCH LINE ITEM: Target IDs:",{targetLineItemId:i,targetSectionId:l}),s((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Project Workflow",project:(0,Y.A)((0,Y.A)({},e.data),{},{highlightStep:n,highlightLineItem:n,targetPhase:t,targetSection:r,targetLineItem:n,scrollToCurrentLineItem:!0,navigationTarget:{phase:t,section:r,lineItem:n,stepName:n,lineItemId:i,workflowId:a.workflowId,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(i),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:l,expandPhase:!0,expandSection:!0,autoOpen:!0}}),targetLineItemId:i,targetSectionId:l}}))}else{console.error("\ud83c\udfaf SEARCH LINE ITEM: Position response not successful, using fallback");const a="".concat(t,"-").concat(r,"-0"),o=r.toLowerCase().replace(/\s+/g,"-");s((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Project Workflow",project:(0,Y.A)((0,Y.A)({},e.data),{},{highlightStep:n,highlightLineItem:n,targetPhase:t,targetSection:r,targetLineItem:n,scrollToCurrentLineItem:!0,navigationTarget:{phase:t,section:r,lineItem:n,stepName:n,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(a),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:o,expandPhase:!0,expandSection:!0,autoOpen:!0}}),targetLineItemId:a,targetSectionId:o}}))}}else{console.error("\ud83c\udfaf SEARCH LINE ITEM: Failed to get project position, using fallback");const a="".concat(t,"-").concat(r,"-0"),o=r.toLowerCase().replace(/\s+/g,"-");s((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Project Workflow",project:(0,Y.A)((0,Y.A)({},e.data),{},{highlightStep:n,highlightLineItem:n,targetPhase:t,targetSection:r,targetLineItem:n,scrollToCurrentLineItem:!0,navigationTarget:{phase:t,section:r,lineItem:n,stepName:n,highlightMode:"line-item",scrollBehavior:"smooth",targetElementId:"lineitem-".concat(a),highlightColor:"#0066CC",highlightDuration:3e3,targetSectionId:o,expandPhase:!0,expandSection:!0,autoOpen:!0}}),targetLineItemId:a,targetSectionId:o}}))}}catch(r){console.error("\ud83c\udfaf SEARCH LINE ITEM: Error in navigation:",r),s((0,Y.A)((0,Y.A)({},e),{},{page:"Project Workflow"}))}},title:"Navigate to Line Item in Workflow",children:e.data.currentWorkflowItem.lineItem}):(0,kt.jsx)("span",{className:"ml-1",children:"Not Available"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("strong",{children:"Address:"})," ",E((u=e.data,u&&(u.address||u.customer&&u.customer.address||u.client&&u.client.address)||""))]})]})]})]}),"Customers"===t&&(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("div",{className:"text-sm font-medium ".concat(i?"text-gray-200":"text-gray-800"),children:(0,kt.jsx)(VI,{text:e.title,matches:C(e,"name"),query:c})}),(0,kt.jsxs)("div",{className:"text-xs flex gap-4 ".concat(i?"text-gray-400":"text-gray-600"),children:[e.data.phone&&(0,kt.jsxs)("span",{children:["\ud83d\udcde ",e.data.phone]}),e.data.email&&(0,kt.jsxs)("span",{children:["\u2709\ufe0f ",e.data.email]})]}),(0,kt.jsxs)("div",{className:"text-xs ".concat(i?"text-gray-300":"text-gray-700"),children:[(0,kt.jsx)("strong",{children:"Address:"})," ",E(e.data.address)]}),e.data.projectId&&(0,kt.jsx)("div",{children:(0,kt.jsx)("button",{className:"text-xs hover:underline ".concat(i?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"),onClick:t=>{t.stopPropagation(),s&&s((0,Y.A)((0,Y.A)({},e),{},{navigationTarget:{page:"Profile",project:{id:e.data.projectId}}}))},title:"View Customer's Project",children:"View Project \u2192"})})]}),"Messages"===t&&(0,kt.jsxs)("div",{className:"space-y-2",children:[(0,kt.jsx)("div",{className:"text-sm ".concat(i?"text-gray-200":"text-gray-800"),children:(0,kt.jsx)(VI,{text:e.title,matches:C(e,"subject"),query:c})}),(0,kt.jsx)("div",{className:"text-xs ".concat(i?"text-gray-400":"text-gray-600"),children:(0,kt.jsx)(VI,{text:e.subtitle||e.description,matches:C(e,"content"),query:c})})]})]},"".concat(t,"-").concat(r))})]},t)})]})]})}const GI=e=>{let{isOpen:t,onClose:n,onProjectCreated:a}=e;const[s,i]=(0,o.useState)({primaryName:"",primaryEmail:"",primaryEmailType:"PERSONAL",primaryPhone:"",primaryPhoneType:"MOBILE",customerTypeOfContact:"PRIMARY_CONTACT",secondaryName:"",secondaryEmail:"",secondaryEmailType:"PERSONAL",secondaryPhone:"",secondaryPhoneType:"MOBILE",secondaryTypeOfContact:"SECONDARY_CONTACT",primaryContact:"PRIMARY",primaryPhoneContact:"PRIMARY",address:"",addressComponents:{},projectTypes:[],description:"",startingPhase:"LEAD",projectManagerId:"",leadSourceId:"",subcontractorIds:[]}),[l,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)(1),[h,m]=(0,o.useState)({}),[p,f]=(0,o.useState)([]),[g,v]=(0,o.useState)(!0),[x,b]=(0,o.useState)([]),[y,w]=(0,o.useState)([]),[j,N]=(0,o.useState)(!1),[S,k]=(0,o.useState)(!1),[A,C]=(0,o.useState)(!1),[E,P]=(0,o.useState)([]),_=()=>((0,o.useEffect)(()=>{const e=setTimeout(()=>{C(!1)},5e3);return()=>clearTimeout(e)},[]),(0,kt.jsx)("div",{className:"fixed top-4 right-4 z-[99999] animate-in slide-in-from-right duration-300",children:(0,kt.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg shadow-lg p-4 max-w-sm",children:(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-green-800",children:"Project Created Successfully!"}),(0,kt.jsx)("p",{className:"text-sm text-green-700 mt-1",children:"Your new project has been added to the system and is ready for management."})]}),(0,kt.jsx)("button",{onClick:()=>C(!1),className:"flex-shrink-0 text-green-400 hover:text-green-600 transition-colors",children:(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})),I=e=>{let{requirements:t}=e;return 0===t.length?null:(0,kt.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4",children:(0,kt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,kt.jsx)("div",{className:"flex-shrink-0",children:(0,kt.jsx)("div",{className:"w-6 h-6 bg-amber-100 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-4 h-4 text-amber-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})}),(0,kt.jsxs)("div",{className:"flex-1",children:[(0,kt.jsx)("h3",{className:"text-sm font-semibold text-amber-800 mb-2",children:"Complete the following to continue:"}),(0,kt.jsx)("ul",{className:"space-y-1",children:t.map((e,t)=>(0,kt.jsxs)("li",{className:"flex items-center gap-2 text-sm text-amber-700",children:[(0,kt.jsx)("svg",{className:"w-4 h-4 text-amber-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e]},t))})]})]})})},T=[{value:"ROOFING",label:"Roofing",icon:"\ud83c\udfe0",description:"Roof installation and repair"},{value:"GUTTERS",label:"Gutters",icon:"\ud83c\udf27\ufe0f",description:"Gutter installation and maintenance"},{value:"INTERIOR_PAINT",label:"Interior Paint",icon:"\ud83c\udfa8",description:"Interior painting services"},{value:"FENCE",label:"Fence",icon:"\ud83d\udd32",description:"Fence installation and repair"},{value:"WATER_LEAK",label:"Water Leak",icon:"\ud83d\udca7",description:"Water leak detection and repair"},{value:"MOLD",label:"Mold",icon:"\ud83e\udda0",description:"Mold remediation and prevention"},{value:"WINDOWS",label:"Windows",icon:"\ud83e\ude9f",description:"Window installation and replacement"},{value:"SIDING",label:"Siding",icon:"\ud83c\udfd8\ufe0f",description:"Siding installation and repair"},{value:"DECKS",label:"Decks",icon:"\ud83c\udfd7\ufe0f",description:"Deck construction and repair"},{value:"REPAIR_EXTERIOR",label:"Repair - Exterior",icon:"\ud83d\udd27",description:"Exterior repairs and maintenance"},{value:"REPAIR_INTERIOR",label:"Repair - Interior",icon:"\ud83d\udee0\ufe0f",description:"Interior repairs and maintenance"}],L=[{value:"LEAD",label:"Lead",description:"Initial lead capture and qualification",icon:"\ud83d\udccb"},{value:"PROSPECT",label:"Prospect",description:"Prospect development and estimation",icon:"\ud83d\udd0d"},{value:"APPROVED",label:"Approved",description:"Approved projects ready for execution",icon:"\u2705"},{value:"EXECUTION",label:"Execution",description:"Active project execution",icon:"\ud83d\udea7"},{value:"SECOND_SUPPLEMENT",label:"2nd Supplement",description:"Supplemental estimates and approvals",icon:"\ud83d\udcdd"},{value:"COMPLETION",label:"Completion",description:"Financial processing and project closeout",icon:"\ud83c\udf89"}],D=[{id:1,title:"Customer Information",description:"Primary and secondary customer details"},{id:2,title:"Project Details",description:"Project type and configuration"},{id:3,title:"Review & Create",description:"Final review and submission"}];(0,o.useEffect)(()=>{t?((async()=>{try{var e;const{usersService:n}=await Promise.resolve().then(r.bind(r,4505)),a=await n.getTeamMembers(),s=Array.isArray(null===a||void 0===a||null===(e=a.data)||void 0===e?void 0:e.teamMembers)?a.data.teamMembers:[];f(s);try{const e=localStorage.getItem("authToken")||localStorage.getItem("token"),t=await fetch("".concat(Da.API_BASE_URL,"/roles"),{method:"GET",headers:(0,Y.A)({"Content-Type":"application/json"},e&&{Authorization:"Bearer ".concat(e)})});if(t.ok){const e=await t.json();if(e.success&&e.data){const t=[];if(e.data.projectManager)if(Array.isArray(e.data.projectManager))t.push(...e.data.projectManager);else if(e.data.projectManager.userId){const r=s.find(t=>t.id===e.data.projectManager.userId);r&&t.push(r)}if(e.data.productManager&&e.data.productManager.userId){const r=s.find(t=>t.id===e.data.productManager.userId);r&&!t.find(e=>e.id===r.id)&&t.push(r)}b(t);const r=[];if(e.data.subcontractor)if(Array.isArray(e.data.subcontractor))r.push(...e.data.subcontractor);else if(e.data.subcontractor.userId){const t=s.find(t=>t.id===e.data.subcontractor.userId);t&&r.push(t)}w(r);const n=s.filter(e=>{const t=(e.role||"").toUpperCase().replace(/\s+/g,"_");return["PROJECT_MANAGER","MANAGER","ADMIN","OWNER"].includes(t)});n.forEach(e=>{t.find(t=>t.id===e.id)||t.push(e)}),b(t)}}}catch(t){console.error("Error fetching role assignments:",t);const e=s.filter(e=>{const t=(e.role||"").toUpperCase().replace(/\s+/g,"_");return["PROJECT_MANAGER","MANAGER","ADMIN","OWNER"].includes(t)});b(e);const r=s.filter(e=>"SUBCONTRACTOR"===(e.role||"").toUpperCase().replace(/\s+/g,"_"));w(r)}}catch(n){console.error("Error fetching users:",n)}finally{v(!1)}})(),setTimeout(()=>{const e=document.querySelector(".modal-content");e&&(e.scrollTop=0)},100)):(U(),N(!1),k(!1))},[t]);const M=e=>{if(!e)return e;const t=e.replace(/[^\d]/g,"");return 0===t.length?"":t.length<4?t:t.length<7?"(".concat(t.slice(0,3),") ").concat(t.slice(3)):"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6,10))},O=e=>{const{name:t,value:r}=e.target;let n=r;"primaryPhone"!==t&&"secondaryPhone"!==t||(n=M(r)),i(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:n})),h[t]&&m(e=>(0,Y.A)((0,Y.A)({},e),{},{[t]:""}))},R=e=>{const t={},r=[];return 1===e&&(s.address.trim()||(t.address="Project address is required",r.push("Enter project address")),s.primaryEmail.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.primaryEmail)&&(t.primaryEmail="Please enter a valid email address",r.push("Enter a valid email address")),s.secondaryEmail&&s.secondaryEmail.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.secondaryEmail)&&(t.secondaryEmail="Please enter a valid secondary email address",r.push("Enter a valid secondary email address"))),m(t),P(r),0===Object.keys(t).length},F=async e=>{if(e.preventDefault(),!l&&R(d)){c(!0);try{const e={primaryName:s.primaryName.trim(),primaryEmail:s.primaryEmail.trim(),primaryEmailType:s.primaryEmailType,primaryPhone:s.primaryPhone?s.primaryPhone.trim():"555-555-5555",primaryPhoneType:s.primaryPhoneType,primaryContact:s.primaryContact,primaryPhoneContact:s.primaryPhoneContact,address:s.address.trim()};s.secondaryName&&s.secondaryName.trim()&&(e.secondaryName=s.secondaryName.trim()),s.secondaryEmail&&s.secondaryEmail.trim()&&(e.secondaryEmail=s.secondaryEmail.trim(),e.secondaryEmailType=s.secondaryEmailType),s.secondaryPhone&&s.secondaryPhone.trim()&&(e.secondaryPhone=s.secondaryPhone.trim(),e.secondaryPhoneType=s.secondaryPhoneType),console.log("\ud83d\udd0d Sending customer data:",e);const r=await Da.default.post("/customers",e);if(!r.data.success){const e=r.data.errors?Object.values(r.data.errors).join(", "):r.data.message||"Failed to create customer";throw new Error(e)}const o=r.data.data.id,i=(s.address,{projectName:s.address||"New Project",projectType:s.projectTypes[0],additionalTrades:s.projectTypes.slice(1),tradeTypes:s.projectTypes,description:s.description,budget:1e3,customerId:o,projectManagerId:s.projectManagerId,startDate:(new Date).toISOString(),endDate:new Date(Date.now()+7776e6).toISOString(),startingPhase:s.startingPhase,leadSourceId:s.leadSourceId||void 0}),l=await Da.default.post("/projects",i);if(!l.data.success)throw new Error(l.data.message||"Failed to create project");if(console.log("\u2705 Project created successfully with trades:",s.projectTypes),s.subcontractorIds.length>0&&l.data.data.id)try{for(const e of s.subcontractorIds)await Da.default.post("/projects/".concat(l.data.data.id,"/team-members"),{userId:e,role:"SUBCONTRACTOR"});console.log("\u2705 Subcontractors added to project")}catch(t){console.error("Error adding subcontractors to project:",t)}a&&a(l.data.data),C(!0),U(),n()}catch(r){if(console.error("Error creating project:",r),r.response&&r.response.data){console.error("Server validation error:",r.response.data);const e=r.response.data;let t=e.message||"Failed to create customer";e.errors&&(Array.isArray(e.errors)?t=e.errors.map(e=>"".concat(e.field||e.path||"Error",": ").concat(e.message||e.msg||String(e))).join("\n"):"object"===typeof e.errors&&(t=Object.entries(e.errors).map(e=>{let[t,r]=e;const n="object"===typeof r?r.message||JSON.stringify(r):r;return"".concat(t,": ").concat(n)}).join("\n"))),alert("Error creating project:\n"+t)}else alert("Error creating project: "+r.message)}finally{c(!1)}}},U=()=>{i({primaryName:"",primaryEmail:"",primaryEmailType:"PERSONAL",primaryPhone:"",primaryPhoneType:"MOBILE",customerTypeOfContact:"PRIMARY_CONTACT",secondaryName:"",secondaryEmail:"",secondaryEmailType:"PERSONAL",secondaryPhone:"",secondaryPhoneType:"MOBILE",secondaryTypeOfContact:"SECONDARY_CONTACT",primaryContact:"PRIMARY",primaryPhoneContact:"PRIMARY",address:"",projectTypes:[],description:"",startingPhase:"LEAD",projectManagerId:"",leadSourceId:"",subcontractorIds:[]}),u(1),m({})};return t?(0,kt.jsxs)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[99999] p-4",children:[(0,kt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[95vh] flex flex-col animate-fade-in",children:[(0,kt.jsxs)("div",{className:"bg-[#F8FAFC] text-white px-6 py-3 flex-shrink-0 rounded-t-2xl",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsx)("div",{children:(0,kt.jsx)("h2",{className:"text-xl font-bold",children:"Create New Project"})}),(0,kt.jsx)("button",{onClick:()=>{U(),n()},className:"p-1.5 rounded-lg hover:bg-white transition-colors",children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsx)("div",{className:"flex items-center justify-center mt-2",children:D.map((e,t)=>(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all duration-300 ".concat(d>=e.id?"bg-white text-blue-600 border-white":"border-white/30 text-white/30"),children:d>e.id?(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):(0,kt.jsx)("span",{className:"font-semibold text-sm",children:e.id})}),t<D.length-1&&(0,kt.jsx)("div",{className:"w-12 h-0.5 mx-2 transition-all duration-300 ".concat((e.id,"bg-white"))})]},e.id))})]}),(0,kt.jsx)("div",{className:"p-4 flex-1 overflow-y-auto modal-content scroll-smooth",children:(0,kt.jsxs)("form",{onSubmit:F,children:[1===d&&(0,kt.jsxs)("div",{className:"space-y-4 animate-slide-up",children:[(0,kt.jsx)("div",{children:(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Customer Information"})}),(0,kt.jsx)(I,{requirements:E}),(0,kt.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-100",children:[(0,kt.jsxs)("h4",{className:"text-base font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),"Primary Customer"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,kt.jsx)("input",{type:"text",name:"primaryName",value:s.primaryName,onChange:O,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 ".concat(h.primaryName?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"John Doe"}),h.primaryName&&(0,kt.jsxs)("p",{className:"mt-1.5 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.primaryName]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"email",name:"primaryEmail",value:s.primaryEmail,onChange:O,className:"flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 ".concat(h.primaryEmail?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"john@email.com"}),(0,kt.jsxs)("select",{name:"primaryEmailType",value:s.primaryEmailType,onChange:O,className:"w-28 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 bg-white",children:[(0,kt.jsx)("option",{value:"PERSONAL",children:"Personal"}),(0,kt.jsx)("option",{value:"WORK",children:"Work"})]})]}),h.primaryEmail&&(0,kt.jsxs)("p",{className:"mt-1.5 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.primaryEmail]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Primary Phone"}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"tel",name:"primaryPhone",value:s.primaryPhone,onChange:O,onBlur:e=>{const t=M(e.target.value);i(e=>(0,Y.A)((0,Y.A)({},e),{},{primaryPhone:t}))},className:"flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 ".concat(h.primaryPhone?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"(865) 555-1212"}),(0,kt.jsxs)("select",{name:"primaryPhoneType",value:s.primaryPhoneType,onChange:O,className:"w-28 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 bg-white",children:[(0,kt.jsx)("option",{value:"MOBILE",children:"Mobile"}),(0,kt.jsx)("option",{value:"HOME",children:"Home"}),(0,kt.jsx)("option",{value:"WORK",children:"Work"})]})]}),h.primaryPhone&&(0,kt.jsxs)("p",{className:"mt-1.5 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.primaryPhone]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Secondary Phone ",(0,kt.jsx)("span",{className:"text-gray-400 text-xs",children:"(Optional)"})]}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"tel",name:"secondaryPhone",value:s.secondaryPhone,onChange:O,onBlur:e=>{const t=M(e.target.value);i(e=>(0,Y.A)((0,Y.A)({},e),{},{secondaryPhone:t}))},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400",placeholder:"(865) 555-1212"}),(0,kt.jsxs)("select",{name:"secondaryPhoneType",value:s.secondaryPhoneType,onChange:O,className:"w-28 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 bg-white",children:[(0,kt.jsx)("option",{value:"MOBILE",children:"Mobile"}),(0,kt.jsx)("option",{value:"HOME",children:"Home"}),(0,kt.jsx)("option",{value:"WORK",children:"Work"})]})]})]}),(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Type"}),(0,kt.jsxs)("select",{name:"customerTypeOfContact",value:s.customerTypeOfContact,onChange:O,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 bg-white",children:[(0,kt.jsx)("option",{value:"PRIMARY_CONTACT",children:"Primary Contact"}),(0,kt.jsx)("option",{value:"SECONDARY_CONTACT",children:"Secondary Contact"}),(0,kt.jsx)("option",{value:"TENANT",children:"Tenant"}),(0,kt.jsx)("option",{value:"PROPERTY_MANAGER",children:"Property Manager"}),(0,kt.jsx)("option",{value:"GENERAL_CONTRACTOR",children:"General Contractor"})]})]}),(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Project Address ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)(ci,{name:"address",value:s.address,onChange:O,onPlaceSelect:e=>{console.log("\ud83d\udd0d ADDRESS DEBUG: Place selected:",e),console.log("\ud83d\udd0d ADDRESS DEBUG: Address components:",e.addressComponents),i(t=>(0,Y.A)((0,Y.A)({},t),{},{address:e.formattedAddress,addressComponents:e.addressComponents||{}})),h.address&&m(e=>(0,Y.A)((0,Y.A)({},e),{},{address:""}))},placeholder:"Enter full project address",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 ".concat(h.address?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),required:!0}),s.addressComponents&&"object"===typeof s.addressComponents&&Object.keys(s.addressComponents).length>0&&(0,kt.jsxs)("div",{className:"mt-3 p-4 bg-white border border-blue-200 rounded-lg shadow-sm",children:[(0,kt.jsxs)("div",{className:"text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),"Parsed Address Details"]}),(0,kt.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.addressComponents.street_number&&s.addressComponents.route&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-500 font-medium block",children:"Street"}),(0,kt.jsxs)("span",{className:"text-gray-900",children:[s.addressComponents.street_number," ",s.addressComponents.route]})]}),s.addressComponents.locality&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-500 font-medium block",children:"City"}),(0,kt.jsx)("span",{className:"text-gray-900",children:s.addressComponents.locality})]}),s.addressComponents.administrative_area_level_1&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-500 font-medium block",children:"State"}),(0,kt.jsx)("span",{className:"text-gray-900",children:s.addressComponents.administrative_area_level_1})]}),s.addressComponents.postal_code&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-gray-500 font-medium block",children:"ZIP Code"}),(0,kt.jsx)("span",{className:"text-gray-900 font-semibold",children:s.addressComponents.postal_code})]})]})]}),h.address&&(0,kt.jsxs)("p",{className:"mt-1.5 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.address]})]})]})]}),j?(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,kt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,kt.jsxs)("h4",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})}),"Secondary Customer"]}),(0,kt.jsx)("button",{type:"button",onClick:()=>{N(!1),i(e=>(0,Y.A)((0,Y.A)({},e),{},{secondaryName:"",secondaryEmail:"",secondaryPhone:"",secondaryTypeOfContact:"SECONDARY_CONTACT"}))},className:"text-gray-400 hover:text-red-500 transition-colors p-1",children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,kt.jsx)("input",{type:"text",name:"secondaryName",value:s.secondaryName,onChange:O,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 ".concat(h.secondaryName?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"Jane Doe"}),h.secondaryName&&(0,kt.jsxs)("p",{className:"mt-1.5 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.secondaryName]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"email",name:"secondaryEmail",value:s.secondaryEmail,onChange:O,className:"flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 ".concat(h.secondaryEmail?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"),placeholder:"jane@email.com"}),(0,kt.jsxs)("select",{name:"secondaryEmailType",value:s.secondaryEmailType,onChange:O,className:"w-28 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 bg-white",children:[(0,kt.jsx)("option",{value:"PERSONAL",children:"Personal"}),(0,kt.jsx)("option",{value:"WORK",children:"Work"})]})]}),h.secondaryEmail&&(0,kt.jsxs)("p",{className:"mt-1.5 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.secondaryEmail]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,kt.jsxs)("div",{className:"flex gap-2",children:[(0,kt.jsx)("input",{type:"tel",name:"secondaryPhone",value:s.secondaryPhone,onChange:O,onBlur:e=>{const t=M(e.target.value);i(e=>(0,Y.A)((0,Y.A)({},e),{},{secondaryPhone:t}))},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400",placeholder:"(865) 555-1212"}),(0,kt.jsxs)("select",{name:"secondaryPhoneType",value:s.secondaryPhoneType,onChange:O,className:"w-28 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 bg-white",children:[(0,kt.jsx)("option",{value:"MOBILE",children:"Mobile"}),(0,kt.jsx)("option",{value:"HOME",children:"Home"}),(0,kt.jsx)("option",{value:"WORK",children:"Work"})]})]})]}),(0,kt.jsxs)("div",{className:"md:col-span-2",children:[(0,kt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Type"}),(0,kt.jsxs)("select",{name:"secondaryTypeOfContact",value:s.secondaryTypeOfContact,onChange:O,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 bg-white",children:[(0,kt.jsx)("option",{value:"PRIMARY_CONTACT",children:"Primary Contact"}),(0,kt.jsx)("option",{value:"SECONDARY_CONTACT",children:"Secondary Contact"}),(0,kt.jsx)("option",{value:"TENANT",children:"Tenant"}),(0,kt.jsx)("option",{value:"PROPERTY_MANAGER",children:"Property Manager"}),(0,kt.jsx)("option",{value:"GENERAL_CONTRACTOR",children:"General Contractor"})]})]}),!j&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Primary Contact"}),(0,kt.jsxs)("select",{name:"primaryContact",value:s.primaryContact,onChange:O,className:"w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300 text-sm",children:[(0,kt.jsx)("option",{value:"PRIMARY",children:"Primary Customer"}),(0,kt.jsx)("option",{value:"SECONDARY",children:"Secondary Customer"})]})]})]})]}):(0,kt.jsx)("div",{children:(0,kt.jsxs)("button",{type:"button",onClick:()=>N(!0),className:"w-full px-4 py-3.5 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-all duration-200 flex items-center justify-center gap-2 font-medium",children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Secondary Customer (Optional)"]})}),j&&s.secondaryName&&s.primaryPhone&&s.secondaryPhone&&(0,kt.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[(0,kt.jsxs)("h4",{className:"text-base font-semibold text-yellow-800 mb-2 flex items-center gap-2",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})}),"Primary Phone Number"]}),(0,kt.jsx)("p",{className:"text-sm text-yellow-700 mb-2",children:"Both customers have phone numbers. Please select which one should be the primary contact number:"}),(0,kt.jsxs)("div",{className:"flex gap-4",children:[(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"radio",name:"primaryPhoneContact",value:"PRIMARY",checked:"PRIMARY"===s.primaryPhoneContact,onChange:O,className:"mr-2"}),(0,kt.jsxs)("span",{className:"text-sm",children:[s.primaryPhone," (",s.primaryPhoneType,")"]})]}),(0,kt.jsxs)("label",{className:"flex items-center",children:[(0,kt.jsx)("input",{type:"radio",name:"primaryPhoneContact",value:"SECONDARY",checked:"SECONDARY"===s.primaryPhoneContact,onChange:O,className:"mr-2"}),(0,kt.jsxs)("span",{className:"text-sm",children:[s.secondaryPhone," (",s.secondaryPhoneType,")"]})]})]})]})]}),2===d&&(0,kt.jsxs)("div",{className:"space-y-3 animate-slide-up",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Project Configuration"}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Select project type and starting phase"})]}),(0,kt.jsx)(I,{requirements:E}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-xs font-semibold text-gray-700 mb-2",children:["Trade Types ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:T.map(e=>(0,kt.jsxs)("label",{className:"relative p-2 border rounded-lg cursor-pointer transition-all duration-200 group ".concat(s.projectTypes.includes(e.value)?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"," ").concat(h.projectTypes?"border-red-300 bg-red-50":""),children:[(0,kt.jsx)("input",{type:"checkbox",checked:s.projectTypes.includes(e.value),onChange:()=>{return t=e.value,i(e=>(0,Y.A)((0,Y.A)({},e),{},{projectTypes:e.projectTypes.includes(t)?e.projectTypes.filter(e=>e!==t):[...e.projectTypes,t]})),void(h.projectTypes&&m(e=>(0,Y.A)((0,Y.A)({},e),{},{projectTypes:""})));var t},className:"sr-only"}),(0,kt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,kt.jsx)("div",{className:"w-6 h-6 rounded flex items-center justify-center text-sm transition-all duration-200 ".concat(s.projectTypes.includes(e.value)?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:e.icon}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900",children:e.label}),(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]}),s.projectTypes.includes(e.value)&&(0,kt.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},e.value))}),h.projectTypes&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.projectTypes]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:["Starting Phase ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Select the phase to start the project. All previous phases will be automatically marked as completed."}),(0,kt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:L.map(e=>(0,kt.jsxs)("label",{className:"relative p-4 border-2 rounded-xl cursor-pointer transition-all duration-200 group ".concat(s.startingPhase===e.value?"border-green-500 bg-green-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"),children:[(0,kt.jsx)("input",{type:"radio",name:"startingPhase",value:e.value,checked:s.startingPhase===e.value,onChange:()=>(e=>{i(t=>(0,Y.A)((0,Y.A)({},t),{},{startingPhase:e}))})(e.value),className:"sr-only"}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg transition-all duration-200 ".concat(s.startingPhase===e.value?"bg-green-500 text-white":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:e.icon}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("div",{className:"font-semibold text-gray-900",children:e.label}),(0,kt.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]}),s.startingPhase===e.value&&(0,kt.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center",children:(0,kt.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},e.value))})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Project Manager ",(0,kt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,kt.jsxs)("select",{name:"projectManagerId",value:s.projectManagerId,onChange:O,className:"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300",disabled:g,children:[(0,kt.jsx)("option",{value:"",children:"Select a project manager"}),x.map(e=>(0,kt.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),g&&(0,kt.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Loading project managers..."}),!g&&0===x.length&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-amber-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"No project managers assigned in Settings \u2192 Roles"]}),h.projectManagerId&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,kt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),h.projectManagerId]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Lead Source"}),(0,kt.jsxs)("select",{name:"leadSourceId",value:s.leadSourceId,onChange:O,className:"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300",children:[(0,kt.jsx)("option",{value:"",children:"Select a lead source (optional)"}),["Website","Google Maps","Social Media","Word of Mouth"].map((e,t)=>(0,kt.jsx)("option",{value:e,children:e},t))]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Subcontractors (Optional)"}),(0,kt.jsx)("div",{className:"border-2 border-gray-200 rounded-xl p-4 max-h-48 overflow-y-auto",children:y.length>0?y.map(e=>(0,kt.jsxs)("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[(0,kt.jsx)("input",{type:"checkbox",checked:s.subcontractorIds.includes(e.id),onChange:t=>{const r=t.target.checked?[...s.subcontractorIds,e.id]:s.subcontractorIds.filter(t=>t!==e.id);i((0,Y.A)((0,Y.A)({},s),{},{subcontractorIds:r}))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,kt.jsxs)("span",{className:"text-sm text-gray-700",children:[e.firstName," ",e.lastName]})]},e.id)):(0,kt.jsx)("p",{className:"text-sm text-gray-500 text-center py-2",children:"No subcontractors assigned in Settings \u2192 Roles"})}),s.subcontractorIds.length>0&&(0,kt.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[s.subcontractorIds.length," subcontractor",s.subcontractorIds.length>1?"s":""," selected"]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Project Description"}),(0,kt.jsx)("textarea",{name:"description",value:s.description,onChange:O,rows:3,className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all duration-200 hover:border-gray-300 resize-none",placeholder:"Describe the project scope, special requirements, or additional notes..."})]})]}),3===d&&(0,kt.jsxs)("div",{className:"space-y-3 animate-slide-up",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Review Project Details"}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Please review all information before creating the project"})]}),(0,kt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-semibold text-sm text-gray-900 mb-2",children:"Customer Information"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-xs text-gray-500",children:"Primary Customer:"}),(0,kt.jsx)("p",{className:"font-medium text-sm",children:s.customerName||"Not specified"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Primary Email:"}),(0,kt.jsx)("p",{className:"font-medium",children:s.customerEmail||"Not specified"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Primary Phone:"}),(0,kt.jsx)("p",{className:"font-medium",children:s.customerPhone||"Not specified"})]}),s.secondaryName&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Secondary Customer:"}),(0,kt.jsx)("p",{className:"font-medium",children:s.secondaryName})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Secondary Email:"}),(0,kt.jsx)("p",{className:"font-medium",children:s.secondaryEmail||"Not specified"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Secondary Phone:"}),(0,kt.jsx)("p",{className:"font-medium",children:s.secondaryPhone||"Not specified"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Primary Contact:"}),(0,kt.jsx)("p",{className:"font-medium",children:"PRIMARY"===s.primaryContact?"Primary Customer":"Secondary Customer"})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Project Address:"}),(0,kt.jsx)("p",{className:"font-medium",children:s.address||"Not specified"})]})]})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h4",{className:"font-semibold text-sm text-gray-900 mb-2",children:"Project Configuration"}),(0,kt.jsxs)("div",{className:"space-y-1",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Project Name:"}),(0,kt.jsx)("p",{className:"font-medium",children:s.address||"Auto-generated from address"})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Trade Types:"}),(0,kt.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:s.projectTypes.map(e=>{const t=T.find(t=>t.value===e);return(0,kt.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[null===t||void 0===t?void 0:t.icon," ",null===t||void 0===t?void 0:t.label]},e)})})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Starting Phase:"}),(0,kt.jsx)("div",{className:"flex items-center gap-1 mt-1",children:(()=>{const e=L.find(e=>e.value===s.startingPhase);return(0,kt.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 rounded-lg text-sm",children:[null===e||void 0===e?void 0:e.icon," ",null===e||void 0===e?void 0:e.label]})})()})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Project Manager:"}),(0,kt.jsx)("p",{className:"font-medium",children:s.projectManagerId?(()=>{const e=[...x,...p].find(e=>e.id===s.projectManagerId);return e?"".concat(e.firstName," ").concat(e.lastName):"Not found"})():"Not assigned"})]})]})]})]}),s.description&&(0,kt.jsxs)("div",{children:[(0,kt.jsx)("span",{className:"text-sm text-gray-500",children:"Description:"}),(0,kt.jsx)("p",{className:"mt-1 text-gray-900",children:s.description})]})]})]}),(0,kt.jsx)("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200 flex-shrink-0 -mx-4 -mb-4 rounded-b-2xl",children:(0,kt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,kt.jsxs)("button",{type:"button",onClick:()=>{u(e=>Math.max(e-1,1)),P([]),setTimeout(()=>{const e=document.querySelector(".modal-content");e&&(e.scrollTop=0)},100)},disabled:1===d,className:"px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 ".concat(1===d?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:text-gray-900 hover:bg-gray-200"),children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Previous"]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,kt.jsx)("button",{type:"button",onClick:()=>{U(),n()},className:"px-4 py-2 text-gray-700 bg-white border-2 border-gray-300 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-all duration-200",children:"Cancel"}),d<3?(0,kt.jsxs)("button",{type:"button",onClick:()=>{R(d)&&(u(e=>Math.min(e+1,3)),P([]),setTimeout(()=>{const e=document.querySelector(".modal-content");e&&(e.scrollTop=0)},100))},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 shadow-sm hover:shadow-md transition-all duration-200 flex items-center gap-2",children:["Next",(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}):(0,kt.jsx)("button",{type:"button",onClick:F,disabled:l,className:"px-5 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 shadow-sm hover:shadow-md transition-all duration-200 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Creating..."]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Create Project"]})})]})]})})]})})]}),A&&(0,kt.jsx)(_,{})]}):null},KI=new St({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4),refetchOnWindowFocus:!1,refetchOnReconnect:!0},mutations:{retry:1}}});function JI(){const[e,t]=(0,o.useState)("Overview"),[n,a]=(0,o.useState)(!1),[s,i]=(0,o.useState)(!1),[l,c]=(0,o.useState)(()=>{try{const e=localStorage.getItem("sidebarPinned");return!e||JSON.parse(e)}catch(Pr){return!0}}),[d,u]=(0,o.useState)(!1),[h,m]=(0,o.useState)(!1),[p,f]=(0,o.useState)(!1),[g,v]=(0,o.useState)(()=>{try{const e=localStorage.getItem("user");if(e)return JSON.parse(e)}catch(Pr){}try{const e=sessionStorage.getItem("user");if(e)return JSON.parse(e)}catch(Pr){}return null}),[x,b]=(0,o.useState)(!1),[y,w]=(0,o.useState)(!1),[j,N]=(0,o.useState)([]),[S,k]=(0,o.useState)([]),[A,C]=(0,o.useState)([]),[E,P]=(0,o.useState)(!1),[_,I]=(0,o.useState)(null),T=(0,o.useRef)(null),L=(0,o.useRef)(0),D=(L.current,(0,o.useRef)({})),M=e=>{try{if(!e)return;D.current[e]=(()=>{try{var e,t,r,n;const a=[window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,(null===(e=document.querySelector(".flex-1.overflow-y-auto"))||void 0===e?void 0:e.scrollTop)||0,(null===(t=document.querySelector("main"))||void 0===t?void 0:t.scrollTop)||0,(null===(r=document.querySelector("#root"))||void 0===r?void 0:r.scrollTop)||0,(null===(n=document.querySelector(".overflow-y-auto"))||void 0===n?void 0:n.scrollTop)||0];return Math.max(...a)}catch(Pr){return window.pageYOffset||0}})()}catch(Pr){}},[O,R]=(0,o.useState)({selectedProject:null,projectInitialView:"Profile",projectSourceSection:null,previousPage:"Overview"}),[F,U]=(0,o.useState)(!1),[B,z]=(0,o.useState)(!1),[W,q]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{if(x&&g)return void console.log("\ud83d\udd0d AUTH: Already authenticated, skipping auth check");const e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(e&&(e.startsWith("demo-")||e.startsWith("temp-token-"))&&t)try{const r=JSON.parse(t),n=e.split("-"),a=n[n.length-1],s="demo-user-".concat(a);if(r.id===s)return v(r),void b(!0);console.log("\ud83d\udd04 CLEARING INCONSISTENT AUTH DATA - Will re-authenticate..."),localStorage.removeItem("authToken"),localStorage.removeItem("user")}catch(_t){console.error("Error parsing stored user:",_t),localStorage.removeItem("authToken"),localStorage.removeItem("user")}const r=localStorage.getItem("authToken");if(console.log("\ud83d\udd0d AUTH: Checking for token. Found:",!!r),r){console.log("\ud83d\udd0d AUTH: Token found, verifying...");try{if(r.startsWith("demo-")||r.startsWith("temp-token-")){const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);return v(t),void b(!0)}}try{const e=new AbortController,t=setTimeout(()=>e.abort(),5e3);console.log("\ud83d\udd0d AUTH: Verifying token with API:","".concat(Da.API_BASE_URL,"/auth/me"));const a=await fetch("".concat(Da.API_BASE_URL,"/auth/me"),{headers:{Authorization:"Bearer ".concat(r)},signal:e.signal});if(console.log("\ud83d\udd0d AUTH: Token verification response status:",a.status),clearTimeout(t),a.ok){var n;const e=await a.json();if(console.log("\ud83d\udd0d AUTH: Token verification successful, user data:",e),e.user||null!==(n=e.data)&&void 0!==n&&n.user){const t=e.user||e.data.user;return console.log("\ud83d\udd0d AUTH: Setting authenticated user:",t),v(t),void b(!0)}}else console.log("\ud83d\udd0d AUTH: Token verification failed - clearing token. Status:",a.status),localStorage.removeItem("authToken")}catch(a){return"AbortError"===a.name?console.error("Token verification timed out"):console.log("Token verification failed:",a.message),localStorage.removeItem("authToken"),b(!1),void v(null)}}catch(s){return console.error("Token verification failed:",s),localStorage.removeItem("authToken"),b(!1),void v(null)}}console.log("\ud83d\udd0d AUTH: No valid token found - showing login screen"),b(!1),v(null)})()},[]),(0,o.useEffect)(()=>{(async()=>{if(x&&g)try{const e=!1===g.hasCompletedOnboarding||"WORKER"===g.role&&!g.id;console.log("\ud83d\udd0d ONBOARDING: Checking status for user:",g),console.log("\ud83d\udd0d ONBOARDING: User role:",g.role),console.log("\ud83d\udd0d ONBOARDING: User ID:",g.id),console.log("\ud83d\udd0d ONBOARDING: hasCompletedOnboarding:",g.hasCompletedOnboarding),console.log("\ud83d\udd0d ONBOARDING: needsOnboarding result:",e),U(e),z(!0)}catch(e){console.error("Error checking onboarding status:",e),z(!0)}})()},[x,g]);const V=e=>{console.log("Onboarding completed:",e);const t=(0,Y.A)((0,Y.A)({},g),{},{role:(null===e||void 0===e?void 0:e.mappedRole)||(null===e||void 0===e?void 0:e.role)||(null===g||void 0===g?void 0:g.role),hasCompletedOnboarding:!0,onboardingData:e});v(t),U(!1),localStorage.setItem("user",JSON.stringify(t))},H=async e=>{if(!e)return;if(e.id&&e.firstName&&!e.user_metadata)return console.log("\u2705 Regular backend login/registration - setting user state"),v(e),void b(!0);const t=e;try{var r,n,a,s;const e="localhost"===window.location.hostname?"http://localhost:5000/api/auth/supabase-token-exchange":"/api/auth/supabase-token-exchange",o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,firstName:(null===(r=t.user_metadata)||void 0===r?void 0:r.firstName)||(null===(n=t.email)||void 0===n?void 0:n.split("@")[0])||"User",lastName:(null===(a=t.user_metadata)||void 0===a?void 0:a.lastName)||"",role:(null===(s=t.user_metadata)||void 0===s?void 0:s.role)||"WORKER"})});if(o.ok){const e=await o.json();e.success&&e.token&&e.user&&(localStorage.setItem("authToken",e.token),localStorage.setItem("user",JSON.stringify(e.user)),v(e.user),b(!0))}else console.error("Token exchange failed with status:",o.status),await G(t)}catch(o){console.error("Failed to exchange Supabase token:",o),await G(t)}},G=async e=>{var t,r,n,a;console.log("Using fallback authentication for user:",e.email);const s="temp-token-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),o=s.split("-"),i=o[o.length-1],l="demo-user-".concat(i),c={id:l,email:e.email,firstName:(null===(t=e.user_metadata)||void 0===t?void 0:t.firstName)||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"User",lastName:(null===(n=e.user_metadata)||void 0===n?void 0:n.lastName)||"",role:(null===(a=e.user_metadata)||void 0===a?void 0:a.role)||"WORKER",isActive:!0,theme:"LIGHT"};localStorage.setItem("authToken",s),localStorage.setItem("user",JSON.stringify(c)),v(c),b(!0),console.log("Fallback authentication completed for:",c.email,"with ID:",l)};(0,o.useEffect)(()=>{const e=e=>{var t;console.warn("\ud83d\udd10 App: Session expired event received:",null===(t=e.detail)||void 0===t?void 0:t.message),b(!1),v(null)};return window.addEventListener("auth:sessionExpired",e),()=>{window.removeEventListener("auth:sessionExpired",e)}},[]),(0,o.useEffect)(()=>{if(!x)return;let e=!1;return(async()=>{try{P(!0),I(null);const t=await Da.projectsService.getAll({limit:200});if(e)return;if(t.success&&t.data){const e=(t.data.projects||t.data||[]).map(e=>(0,Y.A)((0,Y.A)({},e),{},{id:e.id||e._id,name:e.name||e.projectName,client:e.client||{name:"Unknown Client",email:"",phone:""},projectManager:e.projectManager||{firstName:"Sarah",lastName:"Johnson",email:"sarah.johnson@company.com",phone:"5559876543"}}));C(e),console.log("\u2705 Fetched projects from API:",e.length)}else C([])}catch(t){if(e)return;console.error("Error fetching projects:",t),I(t.message),C([])}finally{e||P(!1)}})(),()=>{e=!0}},[x]),(0,o.useEffect)(()=>{if(!x)return;(async()=>{try{console.log("\ud83d\udd0d Fetching activities from API...");const e=await Da.activitiesService.getAll();if(e.success&&e.data){const t=(Array.isArray(e.data)?e.data:Array.isArray(e.data.activities)?e.data.activities:[]).map(e=>(0,Y.A)((0,Y.A)({},e),{},{id:e.id||e._id,projectId:e.projectId||e.project_id,subject:e.subject||e.title,content:e.content||e.description||e.message,author:e.author||e.user||e.createdBy||"Unknown User",timestamp:e.timestamp||e.createdAt||e.date||(new Date).toISOString()}));N(t),console.log("\u2705 Fetched activities from API:",t.length)}else console.warn("Failed to fetch activities:",e.message),N([])}catch(e){console.error("Error fetching activities:",e),N([])}})()},[x]);const K=()=>(null===g||void 0===g?void 0:g.email)||"";(0,o.useEffect)(()=>{const e=e=>{T.current&&!T.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,o.useEffect)(()=>{if(Date.now()<L.current)return void(e=>{try{const t=D.current[e];if(null==t)return;const r=()=>{window.scrollTo({top:t,left:0,behavior:"auto"}),[document.querySelector(".flex-1.overflow-y-auto"),document.querySelector("main"),document.querySelector("#root"),document.querySelector(".overflow-y-auto")].forEach(e=>{e&&(e.scrollTop=t)})};r(),setTimeout(r,50),setTimeout(r,120),setTimeout(r,250)}catch(Pr){}})(e);window.scrollTo({top:0,behavior:"auto"}),document.body.scrollTop=0,document.documentElement.scrollTop=0,document.documentElement.scrollLeft=0,document.body.scrollLeft=0;const t=[document.querySelector("main"),document.querySelector("#root"),document.querySelector(".overflow-y-auto"),document.querySelector(".flex-1"),document.querySelector("[data-section]"),document.querySelector(".h-full"),document.querySelector('[class*="overflow"]'),document.querySelector(".scroll-container"),document.querySelector(".content-area"),document.querySelector(".flex-1.overflow-y-auto")];t.forEach(e=>{e&&(e.scrollTop=0,e.scrollLeft=0)});const r=()=>{window.scrollTo({top:0,behavior:"auto"}),document.body.scrollTop=0,document.documentElement.scrollTop=0,t.forEach(e=>{e&&(e.scrollTop=0)})};r(),setTimeout(r,5),setTimeout(r,15),setTimeout(r,30),setTimeout(r,60),setTimeout(r,120),setTimeout(r,250),setTimeout(r,500),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},600)},[e]),(0,o.useEffect)(()=>{if(O.selectedProject){const e=()=>{const e=document.querySelector(".flex-1.overflow-y-auto");e&&(e.scrollTop=0),window.scrollTo(0,0);[document.querySelector("main"),document.querySelector("#root"),document.querySelector(".overflow-y-auto"),document.querySelector(".flex-1"),document.querySelector("[data-section]"),document.querySelector(".h-full"),document.querySelector('[class*="overflow"]'),document.querySelector(".scroll-container"),document.querySelector(".content-area"),document.querySelector(".flex-1.overflow-y-auto")].forEach(e=>{e&&(e.scrollTop=0,e.scrollLeft=0)})};e(),setTimeout(e,10),setTimeout(e,50),setTimeout(e,100),setTimeout(e,500),setTimeout(e,1e3)}},[O.selectedProject]),(0,o.useEffect)(()=>{const t=t=>{try{var r;const n=(null===t||void 0===t?void 0:t.detail)||{},a=n.projectId||(null===(r=n.project)||void 0===r?void 0:r.id);if(!a)return;const s=A.find(e=>String(e.id)===String(a))||n.project;if(!s)return;R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:s,projectInitialView:"Project Documents",projectSourceSection:"Documents & Resources",previousPage:e}))}catch(XI){console.error("Failed to handle app:openProjectDocuments event",XI)}};return window.addEventListener("app:openProjectDocuments",t),()=>window.removeEventListener("app:openProjectDocuments",t)},[A,e]),(0,o.useEffect)(()=>{const e=()=>{try{R(e=>{if(!e||!e.dashboardState)return e;const t=(0,Y.A)({},e.dashboardState);return t.workflowRestore&&delete t.workflowRestore,(0,Y.A)((0,Y.A)({},e),{},{dashboardState:t})})}catch(_t){console.warn("Failed to clear dashboard workflowRestore",_t)}};return window.addEventListener("dashboard:clearWorkflowRestore",e),()=>window.removeEventListener("dashboard:clearWorkflowRestore",e)},[]),(0,o.useEffect)(()=>{if(!x&&!y){const e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(e&&t&&!e.startsWith("demo-")&&!e.startsWith("temp-token-")){(async()=>{try{w(!0);const r=await fetch("".concat(Da.API_BASE_URL,"/auth/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(r.ok){var t;const e=await r.json();if(e.user||null!==(t=e.data)&&void 0!==t&&t.user){const t=e.user||e.data.user;v(t),b(!0)}}else localStorage.removeItem("authToken"),localStorage.removeItem("user")}catch(r){console.error("Token verification failed in auth check:",r),localStorage.removeItem("authToken")}finally{w(!1)}})()}}},[x,y]),(0,o.useEffect)(()=>{const e=async()=>{if(x)try{var e;const t=await Da.messagesService.getUnreadCount(),r=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.unreadCount)||(null===t||void 0===t?void 0:t.unreadCount)||0;q(r>0)}catch(t){console.error("Failed to fetch unread messages count:",t),q(!1)}else q(!1)};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[x]),(0,o.useEffect)(()=>{if(!x)return;Qo.connect();const e=e=>{console.log("\ud83d\udcec Real-time: New direct message received",e),q(!0),"granted"===Notification.permission&&document.hidden&&new Notification("New message from ".concat(e.senderName||"Team Member"),{body:e.content||"You have a new message",icon:"/kenstruction-logo.png",tag:"message-".concat(e.messageId)})};return Qo.on("newDirectMessage",e),()=>{Qo.off("newDirectMessage",e)}},[x]);const J=window.location.pathname,X="/auth/callback"===J||"/auth/error"===J||"/reset-password"===J||J.startsWith("/setup-profile");if("/auth/error"===J)return localStorage.removeItem("authToken"),localStorage.removeItem("user"),window.history.replaceState({},"","/"),window.location.reload(),null;if(!x&&!X)return(0,kt.jsx)(Et,{client:KI,children:(0,kt.jsx)(i_,{onLoginSuccess:H})});const Q=r=>{console.log("\ud83d\udd0d APP: navigate called with page:",r),console.log("\ud83d\udd0d APP: Current activePage:",e),M(e),R(t=>(0,Y.A)((0,Y.A)({},t),{},{previousPage:e,selectedProject:null,dashboardState:"Overview"===r?null:t.dashboardState,navigationContext:(0,Y.A)((0,Y.A)({},t.navigationContext),{},{fromPage:e,toPage:r,timestamp:Date.now(),isMenuNavigation:!0})})),t(r),a(!1),"Project Messages"===r&&q(!1)},Z=function(r){var n;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Project Workflow",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(console.log("\ud83d\udd0d APP: handleProjectSelect called with:"),console.log("\ud83d\udd0d APP: project:",null===r||void 0===r?void 0:r.name),console.log("\ud83d\udd0d APP: view:",s),console.log("\ud83d\udd0d APP: phase:",o),console.log("\ud83d\udd0d APP: sourceSection:",i),console.log("\ud83d\udd0d APP: targetLineItemId:",l),console.log("\ud83d\udd0d APP: targetSectionId:",c),!r&&("Overview"===s||"Projects"===s||"Project Messages"===s||"AI Assistant"===s||"AI Tools"===s||"Company Calendar"===s||"Archived Projects"===s||"Settings"===s||"Estimator"===s))return console.log("\ud83d\udd0d APP: Null project with page navigation, going to:",s),R(e=>{const t={targetLineItemId:e.targetLineItemId||null,targetSectionId:e.targetSectionId||null,project:e.selectedProject||e.scrollToProject||null};return(0,Y.A)((0,Y.A)({},e),{},{dashboardState:(0,Y.A)((0,Y.A)({},e.dashboardState||{}),{},{workflowRestore:t})})}),t(s),void a(!1);if("Projects"===s)return console.log("\ud83d\udd0d APP: Setting activePage to Projects"),console.log("\ud83d\udd0d APP: Current activePage before update:",e),t("Projects"),console.log("\ud83d\udd0d APP: Setting navigationState with selectedProject: null"),console.log("\ud83d\udd0d APP: Current navigationState before update:",O),R(t=>{const n=(0,Y.A)((0,Y.A)({},t),{},{selectedProject:null,projectSourceSection:i,previousPage:e,scrollToProject:r,dashboardState:(0,Y.A)((0,Y.A)({},t.dashboardState||{}),{},{selectedPhase:o||t.dashboardState&&t.dashboardState.selectedPhase||null,expandedPhases:t.dashboardState&&t.dashboardState.expandedPhases||null,scrollToProject:r})});return console.log("\ud83d\udd0d APP: New navigationState:",n),console.log("\ud83d\udd0d APP: Preserved dashboard state:",null===r||void 0===r?void 0:r.dashboardState),n}),a(!1),void console.log("\ud83d\udd0d APP: Navigation setup complete, returning early");if("Profile"===s||"Project Profile"===s){console.log("\ud83d\udd0d APP: Navigating to Project Profile for:",null===r||void 0===r?void 0:r.name),t("Projects");const n=(null===r||void 0===r?void 0:r.id)||(null===r||void 0===r?void 0:r._id)||(null===r||void 0===r?void 0:r.projectId)||(null===r||void 0===r?void 0:r.project_id),s=A.find(e=>String(e.id)===String(n)),l=s?(0,Y.A)((0,Y.A)((0,Y.A)({},s),r),{},{id:s.id,_id:s._id}):(0,Y.A)((0,Y.A)({},r),{},{id:n||"temp-".concat(Date.now()),name:(null===r||void 0===r?void 0:r.name)||(null===r||void 0===r?void 0:r.projectName)||"Selected Project"});return R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:l,projectInitialView:"Profile",projectSourceSection:i||"Dashboard",previousPage:e,dashboardState:(0,Y.A)((0,Y.A)({},t.dashboardState||{}),{},{selectedPhase:o||t.dashboardState&&t.dashboardState.selectedPhase||null})})),void a(!1)}const d=(null===r||void 0===r?void 0:r.id)||(null===r||void 0===r?void 0:r._id)||(null===r||void 0===r?void 0:r.projectId)||(null===r||void 0===r?void 0:r.project_id),u=A.find(e=>String(e.id)===String(d)),h=u?(0,Y.A)((0,Y.A)((0,Y.A)({},u),r),{},{id:u.id,_id:u._id}):(0,Y.A)((0,Y.A)({},r),{},{id:d||"temp-".concat(Date.now()),name:(null===r||void 0===r?void 0:r.name)||(null===r||void 0===r?void 0:r.projectName)||"Selected Project"});try{null!==h&&void 0!==h&&h.id&&sessionStorage.setItem("aiAssistant.lastProjectId",String(h.id))}catch(Pr){}const m="current-alerts"===((null===r||void 0===r?void 0:r.returnToSection)||"").toString().toLowerCase()?"Current Alerts":null;let p=i||(null===r||void 0===r?void 0:r.navigationSource)||m||O.projectSourceSection||null;"Current Alerts"===O.projectSourceSection&&"Current Alerts"!==p&&(p="Current Alerts");const f={selectedProject:h,projectInitialView:s,projectSourceSection:p,previousPage:"Current Alerts"===p?"Overview":O.selectedProject?O.previousPage:e,dashboardState:(0,Y.A)((0,Y.A)({},(null===r||void 0===r?void 0:r.dashboardState)||O.dashboardState||{}),l?{workflowRestore:{targetLineItemId:l,targetSectionId:c,project:h}}:{}),targetLineItemId:l,targetSectionId:c,selectionNonce:(null===r||void 0===r||null===(n=r.navigationTarget)||void 0===n?void 0:n.nonce)||Date.now()};console.log("\ud83d\udd0d APP: Setting navigationState:",f),console.log("\ud83d\udd0d APP: Dashboard state being preserved:",null===r||void 0===r?void 0:r.dashboardState),R(f),a(!1)},$=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(console.log("\ud83d\udd0d BACK_TO_PROJECTS: handleBackToProjects called"),console.log("\ud83d\udd0d BACK_TO_PROJECTS: projectSourceSection:",O.projectSourceSection),console.log("\ud83d\udd0d BACK_TO_PROJECTS: previousPage:",O.previousPage),console.log("\ud83d\udd0d BACK_TO_PROJECTS: selectedProject:",O.selectedProject),console.log("\ud83d\udd0d BACK_TO_PROJECTS: specificProject passed:",e),"Project Workflow Alerts"===O.projectSourceSection){console.log("\ud83d\udd0d BACK_TO_PROJECTS: Navigating back to ProjectDetailPage with Alerts tab");const e=O.selectedProject||O.scrollToProject;if(e)return void R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:e,projectInitialView:"Alerts",projectSourceSection:"Project Workflow Alerts"}))}if("Current Alerts"===O.projectSourceSection||O.selectedProject&&"current-alerts"===O.selectedProject.returnToSection||O.dashboardState&&O.dashboardState.currentAlertsState)return console.log("\ud83d\udd0d BACK_TO_PROJECTS: PRIORITY HANDLING - Navigating back to Current Alerts section"),L.current=Date.now()+1500,R(e=>(0,Y.A)((0,Y.A)({},e),{},{selectedProject:null,dashboardState:null})),t("Overview"),setTimeout(()=>{const e=document.querySelector('[data-section="current-alerts"]');e?(console.log("\ud83d\udd0d BACK_TO_PROJECTS: Successfully scrolled to Current Alerts section"),e.scrollIntoView({behavior:"smooth",block:"start"}),e.style.boxShadow="0 0 10px rgba(59, 130, 246, 0.5)",setTimeout(()=>{e.style.boxShadow="",L.current=0},2e3)):(console.warn("\ud83d\udd0d BACK_TO_PROJECTS: Current Alerts section not found, retrying..."),setTimeout(()=>{const e=document.querySelector('[data-section="current-alerts"]');e?(console.log("\ud83d\udd0d BACK_TO_PROJECTS: Found Current Alerts section on retry"),e.scrollIntoView({behavior:"smooth",block:"start"}),L.current=0):(console.error("\ud83d\udd0d BACK_TO_PROJECTS: Current Alerts section still not found"),L.current=0)},500))},100),void setTimeout(()=>{const e=document.querySelector('[data-section="current-alerts"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},700);if("Project Phases"===O.projectSourceSection&&O.selectedProject){console.log("\ud83d\udd0d BACK_TO_PROJECTS: Coming from Project Phases section, returning to Overview with phase restored");const e=O.selectedProject.dashboardState;return console.log("\ud83d\udd0d BACK_TO_PROJECTS: Dashboard state from project:",e),R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:null,dashboardState:e})),t("Overview"),void setTimeout(()=>{const e=document.querySelector('[data-section="project-phases"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)}if(R(e=>(0,Y.A)((0,Y.A)({},e),{},{selectedProject:null})),"Projects"===O.previousPage)t("Projects");else if("Overview"===O.previousPage){const r=O.dashboardState;if(console.log("\ud83d\udd0d BACK_TO_PROJECTS: Dashboard state for restoration:",r),"Project Messages"===O.projectSourceSection||"My Project Messages"===O.projectSourceSection)return t("Overview"),void setTimeout(()=>{const e=document.querySelector('[data-section="project-messages"]');e?e.scrollIntoView({behavior:"smooth",block:"start"}):setTimeout(()=>{const e=document.querySelector('[data-section="project-messages"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},200)},150);"Project Cubes"===O.projectSourceSection?(t("Overview"),setTimeout(()=>{const e=document.querySelector('[data-section="project-cubes"]');e?e.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},500)):"Project Phases"===O.projectSourceSection?(t("Overview"),console.log("\ud83d\udd0d BACK_TO_PROJECTS: Project Phases - dashboard state being restored:",r),console.log("\ud83d\udd0d BACK_TO_PROJECTS: selectedPhase in dashboard state:",null===r||void 0===r?void 0:r.selectedPhase),R(t=>{const n=(0,Y.A)((0,Y.A)({},t),{},{dashboardState:r,scrollToProject:e||t.scrollToProject});return console.log("\ud83d\udd0d BACK_TO_PROJECTS: New navigation state:",n),n}),setTimeout(()=>{const e=document.querySelector('[data-section="project-phases"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)):(t("Overview"),setTimeout(()=>{const e=document.querySelector('[data-section="project-cubes"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100))}else t(O.previousPage)},ee=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"General Update";try{const n={type:"message_sent",description:t,projectId:e?e.id:null,priority:"Low",metadata:{subject:r}},a=await Da.activitiesService.create(n);a.success&&a.activity&&N(e=>[a.activity,...e])}catch(n){console.error("Error creating activity:",n);const a={id:Date.now(),author:Vr(g),avatar:"I",content:t,timestamp:(new Date).toISOString(),projectId:e?e.id:null,project:e?e.name:null,subject:r};N(e=>[a,...e])}},te=e=>{const t=(A||[]).map(t=>t.id===e.id?e:t);C(t),R(t=>(0,Y.A)((0,Y.A)({},t),{},{selectedProject:e}))},re=e=>{C(t=>[e,...t])},ne=[{name:"Dashboard",icon:(0,kt.jsx)(Gr,{}),page:"Overview"},{name:"My Messages",icon:(0,kt.jsx)(an,{}),page:"Project Messages",hasUnread:W},{name:"Company Calendar",icon:(0,kt.jsx)(ln,{}),page:"Company Calendar"},{isSeparator:!0},{name:"Bubbles",icon:(0,kt.jsx)(Yr,{}),page:"AI Assistant",isAIAssistant:!0},{name:"AI Estimate Analysis",icon:(0,kt.jsx)(Kr,{}),page:"Estimator"},{name:"AI Training Tools",icon:(0,kt.jsx)(en,{}),page:"AI Tools"},{name:"Project Schedules",icon:(0,kt.jsx)(ln,{}),page:"Project Schedules",isDisabled:!0},{name:"Documents & Resources",icon:(0,kt.jsx)(Kr,{}),page:"Documents & Resources"},{name:"AI Knowledge Base",icon:(0,kt.jsx)(an,{}),page:"Training & Knowledge Base"},{name:"Feedback Hub",icon:(0,kt.jsx)(Jr,{}),page:"Feedback Hub"},{name:"Archived Projects",icon:(0,kt.jsx)(cn,{}),page:"Archived Projects"}];return F&&B?(0,kt.jsxs)(Et,{client:KI,children:[(0,kt.jsx)(ul,{children:(0,kt.jsx)(z_,{currentUser:g,onComplete:V})}),(0,kt.jsx)(Wr,{})]}):"/auth/callback"===window.location.pathname?(0,kt.jsx)(Et,{client:KI,children:(0,kt.jsx)(ul,{children:(0,kt.jsx)(q_,{onLoginSuccess:H})})}):"/reset-password"===window.location.pathname?(0,kt.jsx)(Et,{client:KI,children:(0,kt.jsx)(ul,{children:(0,kt.jsx)(l_,{})})}):window.location.pathname.startsWith("/setup-profile")?(0,kt.jsx)(Et,{client:KI,children:(0,kt.jsx)(ul,{children:(0,kt.jsx)(W_,{colorMode:d})})}):!B&&x?(0,kt.jsxs)(Et,{client:KI,children:[(0,kt.jsx)(ul,{children:(0,kt.jsx)("div",{className:"min-h-screen bg-[#F8FAFC] flex items-center justify-center",children:(0,kt.jsxs)("div",{className:"text-center",children:[(0,kt.jsx)("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,kt.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Setting up your workspace..."}),(0,kt.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare everything for you."})]})})}),(0,kt.jsx)(Wr,{})]}):(0,kt.jsxs)(Et,{client:KI,children:[(0,kt.jsx)(ul,{children:(0,kt.jsx)(Si,{children:(0,kt.jsxs)(ni,{children:[(0,kt.jsxs)("div",{className:"flex h-screen font-sans overflow-hidden transition-colors duration-500 ".concat(d?"bg-[#1e293b] text-gray-100":"bg-[#F8FAFC] text-gray-900"),children:[n&&(0,kt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>a(!1)}),(0,kt.jsxs)("aside",{className:"fixed lg:static inset-y-0 left-0 z-50 flex flex-col transition-all duration-300 ease-in-out\n                ".concat(d?"bg-neutral-900 border-r border-neutral-700 text-white":"bg-white shadow-soft border-r border-[#E2E8F0] text-gray-900","\n                ").concat(n?"translate-x-0":"-translate-x-full lg:translate-x-0","\n                mobile-safe-area"),style:{width:s&&!l?"64px":"288px"},onMouseEnter:()=>!l&&i(!1),onMouseLeave:()=>!l&&setTimeout(()=>i(!0),300),children:[(0,kt.jsxs)("div",{className:"p-3 flex flex-col items-center border-b ".concat(d?"border-neutral-700 bg-neutral-900":"border-[#E2E8F0] bg-white"),children:[s?(0,kt.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center font-bold text-xl ".concat(d?"bg-brand-500 text-white":"bg-blue-600 text-white"," shadow-lg"),children:"K"}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"w-40 h-16 rounded-xl flex items-center justify-center shadow-brand-glow overflow-hidden border-2 ".concat(d?"bg-neutral-800 border-brand-500":"bg-white border-neutral-200"),children:(0,kt.jsx)("img",{src:d?"/kenstruction-logo-dark.png":"/kenstruction-logo.png",alt:"Kenstruction Logo",className:"w-full h-full object-contain rounded-xl"})}),(0,kt.jsx)(H_,{})]}),(0,kt.jsx)("button",{onClick:()=>{const e=!l;c(e),localStorage.setItem("sidebarPinned",JSON.stringify(e)),e||i(!0)},className:"mt-2 p-1.5 rounded-lg transition-colors ".concat(d?"hover:bg-neutral-700 text-gray-300":"hover:bg-gray-100 text-gray-600"),title:l?"Auto-collapse sidebar":"Pin sidebar",children:l?(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{d:"M16 12V4H17V2H7V4H8V12L6 14V16H11.2V22H12.8V16H18V14L16 12Z"})}):(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12V4H17V2H7V4H8V12L6 14V16H11.2V22H12.8V16H18V14L16 12Z"})})})]}),(0,kt.jsx)("nav",{className:"flex-1 py-3 space-y-1.5 overflow-hidden transition-all duration-300 ".concat(s?"px-2":"pl-5 pr-4"),children:ne.map((t,r)=>t.isAIAssistant?(0,kt.jsxs)("button",{onClick:()=>Q(t.page),className:"w-full text-left flex items-center gap-3 py-2 px-4 text-[10px] font-semibold rounded-lg transition-all duration-200 ".concat(e!==t.page||O.selectedProject?d?"text-[#e0eaff] hover:bg-[#232526]/60 hover:text-[#26d0ce]":"text-gray-700 hover:bg-white hover:text-primary-700 hover:shadow-soft":"bg-[#F8FAFC] text-white shadow-md"),children:[(0,kt.jsx)("span",{className:"w-4 h-4 flex items-center justify-center",children:t.icon}),!s&&(0,kt.jsx)("span",{className:"flex-1",children:t.name})]},t.name):t.isDropdown?(0,kt.jsxs)("div",{className:"relative group",children:[(0,kt.jsxs)("button",{className:"w-full text-left flex items-center gap-3 py-2.5 px-4 font-bold rounded-lg uppercase tracking-wide text-[9px] transition-all duration-200 ".concat(d?"text-[#f2fcfe] hover:bg-[#232526]/60":"text-gray-700 hover:bg-white"),tabIndex:0,"aria-haspopup":"true","aria-expanded":"false",children:[(0,kt.jsx)("span",{className:"w-5 h-5 flex items-center justify-center",children:t.icon}),!s&&(0,kt.jsx)("span",{className:"flex-1",children:t.name}),!s&&(0,kt.jsx)("span",{className:"ml-auto",children:(0,kt.jsx)(tn,{className:"w-3 h-3"})})]}),(0,kt.jsx)("div",{className:"absolute left-0 top-full z-20 min-w-[180px] bg-[#F8FAFC] shadow-xl rounded-lg py-2 opacity-0 group-hover:opacity-100 group-hover:pointer-events-auto pointer-events-none transition-all duration-200 border border-[#3b82f6] text-white",style:{marginTop:2},children:t.children.map(e=>(0,kt.jsxs)("button",{onClick:()=>Q(e.page),className:"w-full text-left flex items-center gap-3 py-2 px-4 text-[9px] font-semibold rounded-lg hover:bg-[#232526]/60 hover:text-[#26d0ce] transition-all duration-200",children:[(0,kt.jsx)("span",{children:e.icon}),(0,kt.jsx)("span",{children:e.name})]},e.name))})]},t.name):t.isSection?(0,kt.jsxs)("div",{className:"mt-4 mb-2 flex items-center gap-3 font-bold text-[9px] uppercase tracking-wide ".concat(d?"text-[#f2fcfe] drop-shadow-lg":"text-gray-700 dark:text-gray-200"),children:[(0,kt.jsx)("span",{className:"w-5 h-5 flex items-center justify-center",children:t.icon}),(0,kt.jsx)("span",{children:t.name})]},t.name):t.isSubItem?(0,kt.jsxs)("button",{onClick:()=>Q(t.page),className:"w-full text-left flex items-center gap-3 py-2 px-4 ml-4 text-[9px] font-semibold rounded-lg transition-all duration-200 ".concat(e!==t.page||O.selectedProject?d?"text-[#f2fcfe] hover:bg-[#232526]/60 hover:text-[#26d0ce]":"text-gray-700 hover:bg-white hover:text-primary-700 hover:shadow-soft":"bg-[#F8FAFC] text-white shadow-md"),children:[(0,kt.jsx)("span",{className:"w-4 h-4 flex items-center justify-center",children:t.icon}),!s&&(0,kt.jsx)("span",{className:"flex-1",children:t.name})]},t.name):t.isBullet?(0,kt.jsxs)("button",{onClick:()=>Q(t.page),className:"w-full text-left flex items-center gap-3 pl-12 pr-4 py-2 text-[9px] font-medium rounded transition-all duration-200 group ".concat(d?"text-[#e0eaff] hover:bg-[#232526]/40 hover:text-[#26d0ce]":"text-gray-600 hover:bg-blue-50 hover:text-blue-700 dark:hover:bg-blue-900/30"),children:[(0,kt.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-gradient-to-tr ".concat(d?"from-[#26d0ce] to-[#1a2980]":"from-blue-400 to-emerald-400"," mr-2 group-hover:from-blue-600 group-hover:to-emerald-600")}),(0,kt.jsx)("span",{children:t.name})]},t.name):t.isSeparator?(0,kt.jsx)("div",{className:"my-3 mx-4 border-t ".concat(d?"border-[#26d0ce]/40":"border-gray-300 dark:border-gray-700")},r):(0,kt.jsxs)("button",{onClick:()=>!t.isDisabled&&Q(t.page),disabled:t.isDisabled,className:"w-full text-left flex items-center gap-3 py-2 px-4 text-[10px] font-semibold rounded-lg transition-all duration-200 ".concat(t.isDisabled?d?"text-gray-500 cursor-not-allowed opacity-50":"text-gray-400 cursor-not-allowed opacity-50":e!==t.page||O.selectedProject?d?"text-[#e0eaff] hover:bg-[#232526]/60 hover:text-[#26d0ce]":"text-gray-700 hover:bg-white hover:text-primary-700 hover:shadow-soft":"bg-[#F8FAFC] text-white shadow-md"),children:[(0,kt.jsxs)("span",{className:"w-4 h-4 flex items-center justify-center relative",children:[t.icon,s&&(t.badge>0||t.hasUnread)&&(0,kt.jsx)("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"})]}),!s&&(0,kt.jsx)("span",{className:"flex-1",children:t.name}),!s&&t.hasUnread&&(0,kt.jsx)("span",{className:"w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse shadow-lg ml-2",title:"New messages"}),!s&&t.badge&&t.badge>0&&(0,kt.jsx)("span",{className:"inline-flex items-center justify-center min-w-[18px] h-[18px] px-1 text-[7px] font-bold rounded-full ml-2 ".concat("Project Messages"===t.page?d?"bg-blue-500 text-white shadow-lg":"bg-blue-500 text-white shadow-md":d?"bg-red-500 text-white shadow-lg":"bg-red-500 text-white shadow-md"),children:t.badge>99?"99+":t.badge})]},t.name))})]}),(0,kt.jsxs)("main",{className:"flex-1 flex flex-col min-w-0 text-xs font-sans transition-colors duration-500 ".concat(d?"bg-neutral-900 text-white":"bg-[#F8FAFC]"),style:{minWidth:0,fontSize:"12px"},children:[(0,kt.jsxs)("header",{className:"hidden lg:flex items-center justify-between p-4 border-b transition-all duration-300 z-[9999] ".concat(d?"bg-neutral-800 border-neutral-700 text-white":"bg-white border-[#E2E8F0] shadow-soft"),children:[(0,kt.jsxs)("div",{className:"flex items-center flex-1 min-w-0",children:["Overview"!==e&&(0,kt.jsxs)("div",{className:"flex-shrink-0",children:[(0,kt.jsx)("h1",{className:"text-xl font-bold ".concat(d?"text-white":"text-gray-800"),children:"Alerts"===e?"Project Alerts":"Company Calendar"===e?"Company Calendar":"Email History"===e?"Email History":"AI Assistant"===e?"":"AI Tools"===e?"AI Training Tools":"Archived Projects"===e?"Archived Projects":"Project Messages"===e?"Messages":"Estimator"===e?"Estimate Comparison & Analysis":"Customers"===e?"Customer Management":"Projects"===e?"Project Workflow":e}),(0,kt.jsx)("p",{className:"text-sm font-medium ".concat(d?"text-gray-200":"text-gray-600"),children:"Alerts"===e?"Monitor project alerts, tasks, and urgent notifications.":"Project Schedules"===e?"Plan and organize project timelines and milestones":"Company Calendar"===e?"Company-wide events, meetings, and project schedules":"Email History"===e?"View all sent emails with tracking, attachments, and project associations":"AI Assistant"===e?"":"AI Tools"===e?"Advanced AI-powered construction management tools":"Archived Projects"===e?"Completed projects and historical records":"Project Messages"===e?"Stay up-to-date with activity feeds and manage important project messages in one place.":"Estimator"===e?"Upload documents to generate a discrepancy report or a pre-estimate advisory.":"Customers"===e?"Manage customer information, contacts, and project associations":"Project management and construction oversight"})]}),(0,kt.jsx)("div",{className:"flex-1 max-w-3xl xl:max-w-4xl mx-8",children:(0,kt.jsx)(HI,{projects:A,activities:j,onNavigateToResult:e=>{if(console.log("\ud83d\udd0d Search navigation called with result:",e),!e||!e.navigationTarget)return void console.error("\u274c Invalid search result - missing navigationTarget");const r=e.navigationTarget;if(console.log("\ud83d\udd0d Navigation target:",r),"Project Workflow"===r.page&&r.project)return console.log("\ud83d\udd0d Navigating directly to Project Workflow from search with targeting"),void Z(r.project,"Project Workflow",null,"Global Search",r.targetLineItemId,r.targetSectionId);if("project"===e.type&&e.data)return console.log("\ud83d\udd0d Navigating to project detail:",e.data.projectNumber||e.data.id),void Z(e.data,"Project Profile",null,"Global Search");switch(r.page){case"project-detail":r.project&&Z(r.project,"Project Workflow",null,"Global Search");break;case"project-messages":r.project&&Z(r.project,"Messages",null,"Global Search");break;case"projects":r.project?Z(r.project,"Project Profile",null,"Global Search"):t("Projects");break;case"Profile":case"Project Profile":r.project&&Z(r.project,"Project Profile",null,"Global Search");break;case"Project Workflow":r.project&&Z(r.project,"Project Workflow",null,"Global Search",r.targetLineItemId,r.targetSectionId);break;default:console.log("Unhandled search navigation - defaulting to Projects page"),t("Projects")}},handleCreateAlert:e=>{console.log("ACTION: Creating alert for project:",e),alert('Creating an alert for "'.concat(e.name||e.projectName,'"...'))},handleAddActivity:e=>{console.log("ACTION: Adding activity for project:",e),alert('Adding an activity for "'.concat(e.name||e.projectName,'"...'))},colorMode:d,className:"w-full"})})]}),(0,kt.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[(0,kt.jsxs)("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 bg-[#0089D1] text-white shadow-soft hover:shadow-medium hover:-translate-y-0.5 border border-[#0089D1]/20",children:[(0,kt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),(0,kt.jsx)("span",{children:"Add Project"})]}),(0,kt.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(d?"bg-[#1e293b] hover:bg-[#232b4d] text-white":"bg-gray-100 hover:bg-gray-200"),children:(0,kt.jsx)(Jr,{})}),(0,kt.jsxs)("div",{className:"relative",ref:T,children:[(0,kt.jsx)("button",{onClick:()=>m(!h),className:"flex items-center gap-3 p-2 rounded-lg transition-colors ".concat(d?"bg-[#1e293b] hover:bg-[#232b4d] text-white":"bg-gray-100 hover:bg-gray-200"),children:null!==g&&void 0!==g&&g.avatar?(0,kt.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden border-2 border-blue-500",children:(0,kt.jsx)("img",{src:g.avatar.startsWith("spaces://")?"https://".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_NAME||"kenstruction",".").concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyC3KmPaCtYwN4n0G0m7ZVK3wXm_zu-nar0",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxb3RkeHVocHRwa21ic3J2amdhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Njg2NjMsImV4cCI6MjA3MTQ0NDY2M30.6220K6MLU1-tnI8o9QEwgKNUPd53HZpkHVDuBG2mMI0",REACT_APP_SUPABASE_URL:"https://kqotdxuhptpkmbsrvjga.supabase.co",REACT_APP_VAPI_ASSISTANT_ID:"1ad2d156-7732-4f8b-97d3-41addce2d6a7",REACT_APP_VAPI_PUBLIC_KEY:"bafbcec8-96b4-48d0-8ea0-6c8ce48d3ac4"}.REACT_APP_DO_SPACES_ENDPOINT||"nyc3.digitaloceanspaces.com","/").concat(g.avatar.replace("spaces://","")):g.avatar,alt:"Profile",className:"w-full h-full object-cover",onError:e=>{console.error("Profile image failed to load:",e),console.error("Avatar URL:",g.avatar),e.target.style.display="none"},onLoad:()=>{console.log("Profile image loaded successfully:",g.avatar)}},g.avatar)}):(0,kt.jsx)("div",{className:"w-8 h-8 bg-[#F8FAFC] rounded-full flex items-center justify-center text-white font-semibold text-sm",children:Hr(g)})}),h&&(0,kt.jsx)("div",{className:"absolute right-0 top-full mt-2 w-56 rounded-lg shadow-xl z-[99999] border ".concat(d?"bg-[#1e293b] border-brand-500/40 text-white":"bg-white border-gray-200"),children:(0,kt.jsxs)("div",{className:"py-2",children:[(0,kt.jsx)("div",{className:"px-4 pb-2 text-[10px] ".concat(d?"text-gray-300":"text-gray-500"),children:"Signed in as"}),(0,kt.jsx)("div",{className:"px-4 pb-2 text-sm font-medium truncate ".concat(d?"text-white":"text-gray-900"),title:K(),children:K()}),(0,kt.jsx)("div",{className:"".concat(d?"border-[#3b82f6]/30":"border-gray-200"," border-t my-2")}),(0,kt.jsxs)("button",{onClick:()=>{m(!1),Q("Settings")},className:"w-full text-left px-4 py-2 text-sm flex items-center gap-2 ".concat(d?"text-white hover:bg-[#232b4d]":"text-gray-700 hover:bg-gray-100"),children:[(0,kt.jsx)(Xr,{})," Settings"]}),(0,kt.jsx)("div",{className:"".concat(d?"border-[#3b82f6]/30":"border-gray-200"," border-t my-2")}),(0,kt.jsxs)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),m(!1),(async()=>{const{supabase:e}=await Promise.resolve().then(r.bind(r,759));await e.auth.signOut(),localStorage.removeItem("authToken"),localStorage.removeItem("user"),b(!1),v(null)})()},className:"w-full text-left px-4 py-2 text-sm flex items-center gap-2 ".concat(d?"text-red-300 hover:bg-[#3b0f0f]":"text-red-600 hover:bg-red-50"),children:[(0,kt.jsx)(Qr,{})," Logout"]})]})})]})]})]}),(0,kt.jsxs)("header",{className:"lg:hidden border-b p-3 flex items-center justify-between transition-colors duration-500 ".concat(d?"bg-neutral-800 border-neutral-700 text-white":"bg-white border-[#E2E8F0]"),children:[(0,kt.jsx)("button",{onClick:()=>a(!0),className:"p-2 rounded-lg transition-colors ".concat(d?"bg-[#232b4d] hover:bg-[#1e293b] text-white":"bg-gray-100 hover:bg-gray-200"),children:(0,kt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,kt.jsxs)("div",{className:"flex items-center",children:[(0,kt.jsx)("img",{src:d?"/kenstruction-logo-dark.png":"/kenstruction-logo.png",alt:"Kenstruction Logo",className:"w-8 h-8 rounded-lg"}),(0,kt.jsx)("span",{className:"ml-2 font-semibold ".concat(d?"text-white":"text-gray-800"),children:"Kenstruction"})]}),(0,kt.jsx)("div",{className:"w-10"})," "]}),(0,kt.jsx)("div",{className:"flex-1 p-4 overflow-x-hidden",children:(0,kt.jsx)("div",{className:"flex-1 overflow-hidden",children:(console.log("\ud83d\udd0d MAIN_RENDER: navigationState.selectedProject:",O.selectedProject),console.log("\ud83d\udd0d MAIN_RENDER: activePage:",e),O.selectedProject?"Project Workflow"===O.projectInitialView?(console.log("\ud83d\udd0d MAIN_RENDER: Rendering ProjectChecklistPage (Workflow view)"),(0,kt.jsx)(ol,{project:O.selectedProject,onUpdate:te,onPhaseCompletionChange:(e,t)=>console.log("Phase completion:",e,t),targetLineItemId:O.targetLineItemId,targetSectionId:O.targetSectionId,selectionNonce:O.selectionNonce,onBack:$,colorMode:d,projectSourceSection:O.projectSourceSection,onProjectSelect:Z})):(console.log("\ud83d\udd0d MAIN_RENDER: Rendering ProjectDetailPage (Profile view)"),(0,kt.jsx)(el,{project:O.selectedProject,initialView:O.projectInitialView,onBack:$,colorMode:d,previousPage:O.previousPage,projectSourceSection:O.projectSourceSection,onSendMessage:ee,tasks:S,projects:A,onUpdate:te,activities:j,onAddActivity:ee,onProjectSelect:Z,targetLineItemId:O.targetLineItemId,targetSectionId:O.targetSectionId,selectionNonce:O.selectionNonce})):(console.log("\ud83d\udd0d MAIN_RENDER: Rendering renderPage()"),(()=>{switch(console.log("\ud83d\udd0d RENDER: renderPage called with activePage:",e),console.log("\ud83d\udd0d RENDER: navigationState.selectedProject:",O.selectedProject),e){case"Overview":default:return(0,kt.jsx)(ii,{tasks:S,activities:j,onProjectSelect:Z,onAddActivity:ee,dashboardState:O.dashboardState});case"Projects":return(0,kt.jsx)(Vi,{onProjectSelect:Z,onCreateProject:re,projects:A,colorMode:d,projectSourceSection:O.projectSourceSection,onNavigateBack:$,scrollToProject:O.scrollToProject});case"Project Messages":return(0,kt.jsx)(Vb,{colorMode:d,projects:A,onProjectSelect:Z,navigationContext:O.navigationContext,previousPage:O.previousPage});case"Project Schedules":return(0,kt.jsx)(gb,{});case"Company Calendar":return(0,kt.jsx)(lb,{projects:A,tasks:S,activities:j,onProjectSelect:Z,colorMode:d});case"Feedback Hub":return(0,kt.jsx)(s_,{colorMode:d,currentUser:g});case"Documents & Resources":return(0,kt.jsx)(qb,{});case"Alerts Calendar":return(0,kt.jsx)(db,{projects:A,tasks:S,activities:j,onProjectSelect:Z,colorMode:d});case"AI Tools":return(0,kt.jsx)(Zf,{colorMode:d});case"Training & Knowledge Base":return(0,kt.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-10",children:[(0,kt.jsx)("p",{className:"text-lg text-gray-600 mb-8",children:"AI Powered Guidance for Company Information Below"}),(0,kt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-t-4 border-blue-500 flex flex-col gap-2 hover:shadow-xl transition",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6.5V18a2 2 0 002 2h12a2 2 0 002-2V6.5M4 6.5L12 3l8 3.5"})}),(0,kt.jsx)("span",{className:"font-bold text-blue-700 text-lg",children:"AI Company Documents"})]}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Instantly search, summarize, and answer questions about your company handbooks, policies, and internal documents using AI."})]}),(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-t-4 border-green-500 flex flex-col gap-2 hover:shadow-xl transition",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17v-2a2 2 0 012-2h2a2 2 0 012 2v2m-6 0h6a2 2 0 002-2v-5a2 2 0 00-2-2h-2a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2v2"})}),(0,kt.jsx)("span",{className:"font-bold text-green-700 text-lg",children:"AI Project Documents"})]}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Get AI-powered insights, summaries, and answers from your project files, contracts, and technical documents."})]}),(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-t-4 border-yellow-500 flex flex-col gap-2 hover:shadow-xl transition",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("svg",{className:"w-6 h-6 text-yellow-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,kt.jsx)("span",{className:"font-bold text-yellow-700 text-lg",children:"AI Manufacturer Guidance"})]}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Access up-to-date, AI-curated manufacturer recommendations, product specs, and compliance information."})]}),(0,kt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border-t-4 border-purple-500 flex flex-col gap-2 hover:shadow-xl transition",children:[(0,kt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,kt.jsx)("svg",{className:"w-6 h-6 text-purple-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 01-8 0m8 0V5a4 4 0 00-8 0v2m8 0a4 4 0 01-8 0V7"})}),(0,kt.jsx)("span",{className:"font-bold text-purple-700 text-lg",children:"AI Installation Guidance"})]}),(0,kt.jsx)("p",{className:"text-gray-600 text-sm",children:"Get step-by-step, AI-driven installation instructions and troubleshooting for your field teams."})]})]})]});case"Archived Projects":return(0,kt.jsx)(il,{projects:A,colorMode:d,onProjectSelect:Z,navigate:Q});case"Email History":return(0,kt.jsx)(gw,{colorMode:d});case"AI Assistant":return(0,kt.jsx)(Qf,{projects:A,colorMode:d,onProjectSelect:Z});case"Settings":return(0,kt.jsx)(ab,{colorMode:d,setColorMode:u,currentUser:g,onUserUpdated:e=>{console.log("\ud83d\udd04 USER UPDATED: Received updated user:",e),console.log("\ud83d\udd04 USER UPDATED: Avatar URL:",null===e||void 0===e?void 0:e.avatar);try{v(e),localStorage.setItem("user",JSON.stringify(e)),sessionStorage.setItem("user",JSON.stringify(e)),v((0,Y.A)((0,Y.A)({},e),{},{_lastUpdated:Date.now()}))}catch(Pr){}}});case"Estimator":return(0,kt.jsx)(tg,{})}})()))})})]})]}),(0,kt.jsx)(GI,{isOpen:p,onClose:()=>f(!1),onProjectCreated:e=>{var t,r,n,a,s,o;console.log("Project created:",e),f(!1);const i=(0,Y.A)((0,Y.A)({},e),{},{id:e.id||e._id,name:e.name||e.projectName,client:e.client||e.customer?{name:(null===(t=e.customer)||void 0===t?void 0:t.primaryName)||(null===(r=e.client)||void 0===r?void 0:r.name)||"Unknown Client",email:(null===(n=e.customer)||void 0===n?void 0:n.primaryEmail)||(null===(a=e.client)||void 0===a?void 0:a.email)||"",phone:(null===(s=e.customer)||void 0===s?void 0:s.primaryPhone)||(null===(o=e.client)||void 0===o?void 0:o.phone)||""}:{name:"Unknown Client",email:"",phone:""},projectManager:e.projectManager||{firstName:"Sarah",lastName:"Johnson",email:"sarah.johnson@company.com",phone:"5559876543"}});C(e=>[i,...e]),Da.projectsService&&Da.projectsService.getAll&&Da.projectsService.getAll({limit:200}).then(e=>{if(e.success&&e.data){const t=(e.data.projects||e.data||[]).map(e=>(0,Y.A)((0,Y.A)({},e),{},{id:e.id||e._id,name:e.name||e.projectName,client:e.client||{name:"Unknown Client",email:"",phone:""},projectManager:e.projectManager||{firstName:"Sarah",lastName:"Johnson",email:"sarah.johnson@company.com",phone:"5559876543"}}));C(t)}}).catch(e=>{console.error("Error refreshing projects:",e)})}})]})})}),(0,kt.jsx)(Wr,{})]})}function YI(){const e=O(),t=o.useContext(L).navigationType,r=(0,o.useRef)(new Map);return(0,o.useEffect)(()=>{const t=()=>{r.current.set(e.key,window.scrollY)};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[e.key]),(0,o.useEffect)(()=>{if("POP"===t){var n;const t=null!==(n=r.current.get(e.key))&&void 0!==n?n:0;window.scrollTo({top:t,left:0,behavior:"auto"})}else window.scrollTo({top:0,left:0,behavior:"auto"})},[e.pathname,e.search,e.hash,e.key,t]),null}l.createRoot(document.getElementById("root")).render((0,kt.jsx)(o.StrictMode,{children:(0,kt.jsxs)(G,{children:[(0,kt.jsx)(YI,{}),(0,kt.jsx)(JI,{})]})}))})();
//# sourceMappingURL=main.2e302e97.js.map