<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alert Navigation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #0066CC;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0052a3;
        }
        .alert-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .alert-section {
            font-weight: bold;
            color: #0066CC;
        }
        .alert-line-item {
            color: #333;
            cursor: pointer;
            text-decoration: underline;
        }
        .alert-line-item:hover {
            color: #0066CC;
        }
        .log {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Alert Navigation Test</h1>
    
    <div class="test-section">
        <h2>Test Alert Data</h2>
        <p>This test simulates the alert data structure and navigation logic that was fixed.</p>
        
        <div class="alert-item">
            <div><strong>Alert ID:</strong> alert-123</div>
            <div><strong>Project:</strong> Project #001 - Test Project</div>
            <div><strong>Section:</strong> <span class="alert-section">Input Customer Information</span></div>
            <div><strong>Line Item:</strong> <span class="alert-line-item" onclick="testNavigation('alert-123')">Complete customer contact form</span></div>
            <div><strong>Phase:</strong> LEAD</div>
            <div><strong>Priority:</strong> HIGH</div>
        </div>
        
        <div class="alert-item">
            <div><strong>Alert ID:</strong> alert-456</div>
            <div><strong>Project:</strong> Project #002 - Another Project</div>
            <div><strong>Section:</strong> <span class="alert-section">Schedule Initial Inspection</span></div>
            <div><strong>Line Item:</strong> <span class="alert-line-item" onclick="testNavigation('alert-456')">Book inspection appointment</span></div>
            <div><strong>Phase:</strong> LEAD</div>
            <div><strong>Priority:</strong> MEDIUM</div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Navigation Test</h2>
        <button class="test-button" onclick="testNavigation('alert-123')">Test Navigation - Alert 123</button>
        <button class="test-button" onclick="testNavigation('alert-456')">Test Navigation - Alert 456</button>
        <button class="test-button" onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-section">
        <h2>Test Log</h2>
        <div id="testLog" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>Expected Behavior</h2>
        <ul>
            <li><strong>Section Field Mapping:</strong> The correct section from the database should be displayed</li>
            <li><strong>Navigation:</strong> Clicking line items should navigate to the project workflow page</li>
            <li><strong>Phase Expansion:</strong> The correct phase should open automatically</li>
            <li><strong>Section Expansion:</strong> The correct section should open automatically</li>
            <li><strong>Line Item Highlighting:</strong> The specific line item should be highlighted in blue</li>
        </ul>
    </div>

    <script>
        function log(message) {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }
        
        function testNavigation(alertId) {
            log(`ðŸŽ¯ Testing navigation for alert: ${alertId}`);
            
            // Simulate the alert data structure
            const alertData = {
                id: alertId,
                projectId: alertId === 'alert-123' ? 'project-001' : 'project-002',
                stepName: alertId === 'alert-123' ? 'Complete customer contact form' : 'Book inspection appointment',
                section: alertId === 'alert-123' ? 'Input Customer Information' : 'Schedule Initial Inspection',
                phase: 'LEAD',
                metadata: {
                    section: alertId === 'alert-123' ? 'Input Customer Information' : 'Schedule Initial Inspection',
                    lineItem: alertId === 'alert-123' ? 'Complete customer contact form' : 'Book inspection appointment',
                    phase: 'LEAD',
                    lineItemId: `lineitem-${alertId}`,
                    sectionId: alertId === 'alert-123' ? 'input-customer-info' : 'schedule-inspection'
                }
            };
            
            log(`ðŸ“‹ Alert data: ${JSON.stringify(alertData, null, 2)}`);
            
            // Simulate the navigation logic from CurrentAlertsSection
            const metadata = alertData.metadata || {};
            const phase = metadata.phase || alertData.phase || 'LEAD';
            const sectionName = alertData.section || metadata.section || 'Unknown Section';
            const lineItemName = alertData.stepName || alertData.title || 'Unknown Item';
            
            log(`ðŸŽ¯ Navigation data:`);
            log(`   Phase: ${phase}`);
            log(`   Section: ${sectionName}`);
            log(`   Line Item: ${lineItemName}`);
            
            // Generate target IDs
            const targetLineItemId = alertData.stepId || 
                                   metadata.stepId || 
                                   metadata.lineItemId || 
                                   `${phase}-${sectionName}-0`;
            
            const targetSectionId = alertData.sectionId || 
                                  metadata.sectionId || 
                                  sectionName.toLowerCase().replace(/\s+/g, '-');
            
            log(`ðŸŽ¯ Target IDs:`);
            log(`   targetLineItemId: ${targetLineItemId}`);
            log(`   targetSectionId: ${targetSectionId}`);
            
            // Simulate navigation target
            const navigationTarget = {
                phase: phase,
                section: sectionName,
                lineItem: lineItemName,
                stepName: lineItemName,
                alertId: alertData.id,
                lineItemId: alertData.stepId || metadata.stepId || metadata.lineItemId,
                workflowId: alertData.workflowId || metadata.workflowId,
                highlightMode: 'line-item',
                scrollBehavior: 'smooth',
                targetElementId: `lineitem-${targetLineItemId}`,
                highlightColor: '#0066CC',
                highlightDuration: 3000,
                targetSectionId: targetSectionId,
                expandPhase: true,
                expandSection: true
            };
            
            log(`ðŸŽ¯ Navigation target: ${JSON.stringify(navigationTarget, null, 2)}`);
            
            // Simulate what ProjectChecklistPage would do
            log(`ðŸ”§ ProjectChecklistPage would:`);
            log(`   1. Set openPhase to: ${phase}`);
            log(`   2. Set openItem[${targetSectionId}] to: true`);
            log(`   3. Scroll to element: lineitem-${targetLineItemId}`);
            log(`   4. Apply blue highlighting with color: #0066CC`);
            
            log(`âœ… Navigation test completed successfully!`);
        }
        
        // Initialize log
        log('ðŸš€ Alert Navigation Test initialized');
        log('Click on line items or test buttons to simulate navigation');
    </script>
</body>
</html>
